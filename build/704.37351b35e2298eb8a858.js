/*! For license information please see 704.37351b35e2298eb8a858.js.LICENSE.txt */
(self.webpackChunkpb_connect=self.webpackChunkpb_connect||[]).push([[704],{1589:(e,t,r)=>{"use strict";r.d(t,{fG:()=>E,wl:()=>_,xg:()=>S,zf:()=>T});var i=r(6540),n=r(3085),s=Object.defineProperty,o=(e,t,r)=>(((e,t,r)=>{t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r),a={exports:{}},c={};Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,!function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()||Object.assign;var d=i,l=60103;if(c.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var u=Symbol.for;l=u("react.element"),c.Fragment=u("react.fragment")}var p=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h=Object.prototype.hasOwnProperty,m={key:!0,ref:!0,__self:!0,__source:!0};function f(e,t,r){var i,n={},s=null,o=null;for(i in void 0!==r&&(s=""+r),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(o=t.ref),t)h.call(t,i)&&!m.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===n[i]&&(n[i]=t[i]);return{$$typeof:l,type:e,key:s,ref:o,props:n,_owner:p.current}}c.jsx=f,c.jsxs=f,a.exports=c;const g=a.exports.jsx;class v{constructor(e){var t,r,i,n,s,a,c,d,l,u,p,h,m,f,g,v,y,_;o(this,"meeting"),o(this,"l"),o(this,"onUpdate",(()=>{this.l.forEach((e=>{e()}))})),this.meeting=e,this.l=new Set,null==(t=this.meeting.self)||t.addListener("*",this.onUpdate),null==(r=this.meeting.meta)||r.addListener("*",this.onUpdate),null==(i=this.meeting.participants)||i.addListener("*",this.onUpdate),null==(s=null==(n=this.meeting.participants)?void 0:n.joined)||s.addListener("*",this.onUpdate),null==(c=null==(a=this.meeting.participants)?void 0:a.active)||c.addListener("*",this.onUpdate),null==(l=null==(d=this.meeting.participants)?void 0:d.waitlisted)||l.addListener("*",this.onUpdate),null==(u=this.meeting.stage)||u.addListener("*",this.onUpdate),null==(p=this.meeting.livestream)||p.addListener("*",this.onUpdate),null==(h=this.meeting.chat)||h.addListener("*",this.onUpdate),null==(m=this.meeting.plugins)||m.all.addListener("*",this.onUpdate),null==(f=this.meeting.recording)||f.addListener("*",this.onUpdate),null==(g=this.meeting.connectedMeetings)||g.addListener("*",this.onUpdate),null==(v=this.meeting.spotlight)||v.addListener("*",this.onUpdate),null==(y=this.meeting.remote)||y.addListener("*",this.onUpdate),null==(_=this.meeting.polls)||_.addListener("*",this.onUpdate)}clean(){var e,t,r,i,n,s,o,a,c,d,l,u,p,h,m,f,g,v;null==(e=this.meeting.self)||e.removeListener("*",this.onUpdate),null==(t=this.meeting.meta)||t.removeListener("*",this.onUpdate),null==(r=this.meeting.participants)||r.removeListener("*",this.onUpdate),null==(n=null==(i=this.meeting.participants)?void 0:i.joined)||n.removeListener("*",this.onUpdate),null==(o=null==(s=this.meeting.participants)?void 0:s.active)||o.removeListener("*",this.onUpdate),null==(c=null==(a=this.meeting.participants)?void 0:a.waitlisted)||c.removeListener("*",this.onUpdate),null==(d=this.meeting.stage)||d.removeListener("*",this.onUpdate),null==(l=this.meeting.livestream)||l.removeListener("*",this.onUpdate),null==(u=this.meeting.chat)||u.removeListener("*",this.onUpdate),null==(p=this.meeting.plugins)||p.all.removeListener("*",this.onUpdate),null==(h=this.meeting.recording)||h.removeListener("*",this.onUpdate),null==(m=this.meeting.connectedMeetings)||m.removeListener("*",this.onUpdate),null==(f=this.meeting.spotlight)||f.removeListener("*",this.onUpdate),null==(g=this.meeting.remote)||g.removeListener("*",this.onUpdate),null==(v=this.meeting.polls)||v.removeListener("*",this.onUpdate)}addListener(e){this.l.add(e)}removeListener(e){this.l.delete(e)}}const y=(0,i.createContext)({meeting:void 0,updates:void 0});function _({value:e,children:t,fallback:r}){const[n,s]=(0,i.useState)(),o=(0,i.useRef)();return(0,i.useEffect)((()=>(e&&s(new v(e)),()=>{var e;null==(e=o.current)||e.clean()})),[e]),g(y.Provider,{value:{meeting:e,updates:n},children:e?t:r})}const S=()=>{const{meeting:e}=(0,i.useContext)(y);if(!e)throw new Error("useDyteMeeting must be used within the DyteProvider");return{meeting:e}},E=e=>{const t=(0,i.useRef)(!1),[r,s]=(0,i.useState)(),o=null==e?void 0:e.resetOnLeave;return[r,async e=>{if(!t.current)return t.current=!0,n.A.init(e).then((e=>(s(e),o&&e.self.on("roomLeft",(()=>s(void 0))),e.connectedMeetings.on("meetingChanged",(e=>{s(e)})),e))).finally((()=>{t.current=!1}))}]},T=e=>{const{meeting:t,updates:r}=(0,i.useContext)(y);if(!t)throw new Error("useDyteSelector must be used within the DyteProvider");const n=(0,i.useRef)(e(t)),[,s]=(0,i.useReducer)((e=>e+1),0);return(0,i.useEffect)((()=>{const i=t&&e(t),o=()=>{const r=t&&e(t);var i,o;((i=n.current)!==(o=r)||Array.isArray(i)&&Array.isArray(o)&&i.length!==o.length)&&(n.current=r,s())};return i&&"object"==typeof i&&"addListener"in i?(i.addListener("*",s),()=>{i.removeListener("*",s)}):(null==r||r.addListener(o),()=>{null==r||r.removeListener(o)})}),[t,r]),n.current}},3085:(e,t,r)=>{"use strict";r.d(t,{A:()=>ML});var i={};r.r(i),r.d(i,{Decoder:()=>Tt,Encoder:()=>St,PacketType:()=>_t,protocol:()=>yt});const n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&n.test(e)};var o,a=new Uint8Array(16);function c(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(a)}for(var d=[],l=0;l<256;++l)d.push((l+256).toString(16).substr(1));const u=function(e,t,r){var i=(e=e||{}).random||(e.rng||c)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!s(r))throw TypeError("Stringified UUID is invalid");return r}(i)};var p=r(1726),h=r.n(p),m=r(6880),f=r.n(m),g=r(7363);const v=Symbol.for("protobuf-ts/message-type");function y(e){let t=!1;const r=[];for(let i=0;i<e.length;i++){let n=e.charAt(i);"_"==n?t=!0:/\d/.test(n)?(r.push(n),t=!0):t?(r.push(n.toUpperCase()),t=!1):0==i?r.push(n.toLowerCase()):r.push(n)}return r.join("")}var _,S,E;function T(e){var t,r,i,n;return e.localName=null!==(t=e.localName)&&void 0!==t?t:y(e.name),e.jsonName=null!==(r=e.jsonName)&&void 0!==r?r:y(e.name),e.repeat=null!==(i=e.repeat)&&void 0!==i?i:E.NO,e.opt=null!==(n=e.opt)&&void 0!==n?n:!e.repeat&&!e.oneof&&"message"==e.kind,e}function b(e){if("object"!=typeof e||null===e||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return void 0!==e[e.oneofKind]&&2==Object.keys(e).length;case"undefined":return 1==Object.keys(e).length;default:return!1}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(_||(_={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(S||(S={})),function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"}(E||(E={}));class w{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}prepare(){if(this.data)return;const e=[],t=[],r=[];for(let i of this.fields)if(i.oneof)r.includes(i.oneof)||(r.push(i.oneof),e.push(i.oneof),t.push(i.oneof));else switch(t.push(i.localName),i.kind){case"scalar":case"enum":i.opt&&!i.repeat||e.push(i.localName);break;case"message":i.repeat&&e.push(i.localName);break;case"map":e.push(i.localName)}this.data={req:e,known:t,oneofs:Object.values(r)}}is(e,t,r=!1){if(t<0)return!0;if(null==e||"object"!=typeof e)return!1;this.prepare();let i=Object.keys(e),n=this.data;if(i.length<n.req.length||n.req.some((e=>!i.includes(e))))return!1;if(!r&&i.some((e=>!n.known.includes(e))))return!1;if(t<1)return!0;for(const i of n.oneofs){const n=e[i];if(!b(n))return!1;if(void 0===n.oneofKind)continue;const s=this.fields.find((e=>e.localName===n.oneofKind));if(!s)return!1;if(!this.field(n[n.oneofKind],s,r,t))return!1}for(const i of this.fields)if(void 0===i.oneof&&!this.field(e[i.localName],i,r,t))return!1;return!0}field(e,t,r,i){let n=t.repeat;switch(t.kind){case"scalar":return void 0===e?t.opt:n?this.scalars(e,t.T,i,t.L):this.scalar(e,t.T,t.L);case"enum":return void 0===e?t.opt:n?this.scalars(e,_.INT32,i):this.scalar(e,_.INT32);case"message":return void 0===e||(n?this.messages(e,t.T(),r,i):this.message(e,t.T(),r,i));case"map":if("object"!=typeof e||null===e)return!1;if(i<2)return!0;if(!this.mapKeys(e,t.K,i))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,i,t.V.L);case"enum":return this.scalars(Object.values(e),_.INT32,i);case"message":return this.messages(Object.values(e),t.V.T(),r,i)}}return!0}message(e,t,r,i){return r?t.isAssignable(e,i):t.is(e,i)}messages(e,t,r,i){if(!Array.isArray(e))return!1;if(i<2)return!0;if(r){for(let r=0;r<e.length&&r<i;r++)if(!t.isAssignable(e[r],i-1))return!1}else for(let r=0;r<e.length&&r<i;r++)if(!t.is(e[r],i-1))return!1;return!0}scalar(e,t,r){let i=typeof e;switch(t){case _.UINT64:case _.FIXED64:case _.INT64:case _.SFIXED64:case _.SINT64:switch(r){case S.BIGINT:return"bigint"==i;case S.NUMBER:return"number"==i&&!isNaN(e);default:return"string"==i}case _.BOOL:return"boolean"==i;case _.STRING:return"string"==i;case _.BYTES:return e instanceof Uint8Array;case _.DOUBLE:case _.FLOAT:return"number"==i&&!isNaN(e);default:return"number"==i&&Number.isInteger(e)}}scalars(e,t,r,i){if(!Array.isArray(e))return!1;if(r<2)return!0;if(Array.isArray(e))for(let n=0;n<e.length&&n<r;n++)if(!this.scalar(e[n],t,i))return!1;return!0}mapKeys(e,t,r){let i=Object.keys(e);switch(t){case _.INT32:case _.FIXED32:case _.SFIXED32:case _.SINT32:case _.UINT32:return this.scalars(i.slice(0,r).map((e=>parseInt(e))),t,r);case _.BOOL:return this.scalars(i.slice(0,r).map((e=>"true"==e||"false"!=e&&e)),t,r);default:return this.scalars(i,t,r,S.STRING)}}}function k(e){let t=typeof e;if("object"==t){if(Array.isArray(e))return"array";if(null===e)return"null"}return t}function R(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}let C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),A=[];for(let e=0;e<C.length;e++)A[C[e].charCodeAt(0)]=e;function I(){let e=0,t=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(e|=(127&i)<<r,0==(128&i))return this.assertBounds(),[e,t]}let r=this.buf[this.pos++];if(e|=(15&r)<<28,t=(112&r)>>4,0==(128&r))return this.assertBounds(),[e,t];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(t|=(127&i)<<r,0==(128&i))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function P(e,t,r){for(let i=0;i<28;i+=7){const n=e>>>i,s=!(n>>>7==0&&0==t),o=255&(s?128|n:n);if(r.push(o),!s)return}const i=e>>>28&15|(7&t)<<4,n=!(t>>3==0);if(r.push(255&(n?128|i:i)),n){for(let e=3;e<31;e+=7){const i=t>>>e,n=!(i>>>7==0),s=255&(n?128|i:i);if(r.push(s),!n)return}r.push(t>>>31&1)}}A["-".charCodeAt(0)]=C.indexOf("+"),A["_".charCodeAt(0)]=C.indexOf("/");const D=4294967296;function M(e){let t="-"==e[0];t&&(e=e.slice(1));const r=1e6;let i=0,n=0;function s(t,s){const o=Number(e.slice(t,s));n*=r,i=i*r+o,i>=D&&(n+=i/D|0,i%=D)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),[t,i,n]}function O(e,t){if(t>>>0<=2097151)return""+(D*t+(e>>>0));let r=(e>>>24|t<<8)>>>0&16777215,i=t>>16&65535,n=(16777215&e)+6777216*r+6710656*i,s=r+8147497*i,o=2*i,a=1e7;function c(e,t){let r=e?String(e):"";return t?"0000000".slice(r.length)+r:r}return n>=a&&(s+=Math.floor(n/a),n%=a),s>=a&&(o+=Math.floor(s/a),s%=a),c(o,0)+c(s,o)+c(n,1)}function N(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let r=0;r<9;r++)t.push(127&e|128),e>>=7;t.push(1)}}function x(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;0!=(128&e)&&t<10;t++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}let L;function j(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}!function(){const e=new DataView(new ArrayBuffer(8)),t=void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64;L=t?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}();const U=/^-?[0-9]+$/,F=4294967296,V=2147483648;class B{constructor(e,t){this.lo=0|e,this.hi=0|t}isZero(){return 0==this.lo&&0==this.hi}toNumber(){let e=this.hi*F+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class W extends B{static from(e){if(L)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=L.C(e);case"number":if(0===e)return this.ZERO;e=L.C(e);case"bigint":if(!e)return this.ZERO;if(e<L.UMIN)throw new Error("signed value for ulong");if(e>L.UMAX)throw new Error("ulong too large");return L.V.setBigUint64(0,e,!0),new W(L.V.getInt32(0,!0),L.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!U.test(e))throw new Error("string is no integer");let[t,r,i]=M(e);if(t)throw new Error("signed value for ulong");return new W(r,i);case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new W(e,e/F)}throw new Error("unknown value "+typeof e)}toString(){return L?this.toBigInt().toString():O(this.lo,this.hi)}toBigInt(){return j(L),L.V.setInt32(0,this.lo,!0),L.V.setInt32(4,this.hi,!0),L.V.getBigUint64(0,!0)}}W.ZERO=new W(0,0);class H extends B{static from(e){if(L)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=L.C(e);case"number":if(0===e)return this.ZERO;e=L.C(e);case"bigint":if(!e)return this.ZERO;if(e<L.MIN)throw new Error("signed long too small");if(e>L.MAX)throw new Error("signed long too large");return L.V.setBigInt64(0,e,!0),new H(L.V.getInt32(0,!0),L.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!U.test(e))throw new Error("string is no integer");let[t,r,i]=M(e);if(t){if(i>V||i==V&&0!=r)throw new Error("signed long too small")}else if(i>=V)throw new Error("signed long too large");let n=new H(r,i);return t?n.negate():n;case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new H(e,e/F):new H(-e,-e/F).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return 0!=(this.hi&V)}negate(){let e=~this.hi,t=this.lo;return t?t=1+~t:e+=1,new H(t,e)}toString(){if(L)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+O(e.lo,e.hi)}return O(this.lo,this.hi)}toBigInt(){return j(L),L.V.setInt32(0,this.lo,!0),L.V.setInt32(4,this.hi,!0),L.V.getBigInt64(0,!0)}}function G(e,t){if(!e)throw new Error(t)}function $(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function q(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function z(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}function J(e,t){switch(t){case S.BIGINT:return e.toBigInt();case S.NUMBER:return e.toNumber();default:return e.toString()}}H.ZERO=new H(0,0);class K{constructor(e){this.info=e}prepare(){var e;if(void 0===this.fMap){this.fMap={};const t=null!==(e=this.info.fields)&&void 0!==e?e:[];for(const e of t)this.fMap[e.name]=e,this.fMap[e.jsonName]=e,this.fMap[e.localName]=e}}assert(e,t,r){if(!e){let e=k(r);throw"number"!=e&&"boolean"!=e||(e=r.toString()),new Error(`Cannot parse JSON ${e} for ${this.info.typeName}#${t}`)}}read(e,t,r){this.prepare();const i=[];for(const[n,s]of Object.entries(e)){const e=this.fMap[n];if(!e){if(!r.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${n}`);continue}const o=e.localName;let a;if(e.oneof){if(null===s&&("enum"!==e.kind||"google.protobuf.NullValue"!==e.T()[0]))continue;if(i.includes(e.oneof))throw new Error(`Multiple members of the oneof group "${e.oneof}" of ${this.info.typeName} are present in JSON.`);i.push(e.oneof),a=t[e.oneof]={oneofKind:o}}else a=t;if("map"==e.kind){if(null===s)continue;this.assert(R(s),e.name,s);const t=a[o];for(const[i,n]of Object.entries(s)){let s;switch(this.assert(null!==n,e.name+" map value",null),e.V.kind){case"message":s=e.V.T().internalJsonRead(n,r);break;case"enum":if(s=this.enum(e.V.T(),n,e.name,r.ignoreUnknownFields),!1===s)continue;break;case"scalar":s=this.scalar(n,e.V.T,e.V.L,e.name)}this.assert(void 0!==s,e.name+" map value",n);let o=i;e.K==_.BOOL&&(o="true"==o||"false"!=o&&o),o=this.scalar(o,e.K,S.STRING,e.name).toString(),t[o]=s}}else if(e.repeat){if(null===s)continue;this.assert(Array.isArray(s),e.name,s);const t=a[o];for(const i of s){let n;switch(this.assert(null!==i,e.name,null),e.kind){case"message":n=e.T().internalJsonRead(i,r);break;case"enum":if(n=this.enum(e.T(),i,e.name,r.ignoreUnknownFields),!1===n)continue;break;case"scalar":n=this.scalar(i,e.T,e.L,e.name)}this.assert(void 0!==n,e.name,s),t.push(n)}}else switch(e.kind){case"message":if(null===s&&"google.protobuf.Value"!=e.T().typeName){this.assert(void 0===e.oneof,e.name+" (oneof member)",null);continue}a[o]=e.T().internalJsonRead(s,r,a[o]);break;case"enum":let t=this.enum(e.T(),s,e.name,r.ignoreUnknownFields);if(!1===t)continue;a[o]=t;break;case"scalar":a[o]=this.scalar(s,e.T,e.L,e.name)}}}enum(e,t,r,i){if("google.protobuf.NullValue"==e[0]&&G(null===t||"NULL_VALUE"===t,`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} only accepts null.`),null===t)return 0;switch(typeof t){case"number":return G(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${r}, enum can only be integral number, got ${t}.`),t;case"string":let n=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(n=t.substring(e[2].length));let s=e[1][n];return(void 0!==s||!i)&&(G("number"==typeof s,`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} has no value for "${t}".`),s)}G(!1,`Unable to parse field ${this.info.typeName}#${r}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,r,i){let n;try{switch(t){case _.DOUBLE:case _.FLOAT:if(null===e)return 0;if("NaN"===e)return Number.NaN;if("Infinity"===e)return Number.POSITIVE_INFINITY;if("-Infinity"===e)return Number.NEGATIVE_INFINITY;if(""===e){n="empty string";break}if("string"==typeof e&&e.trim().length!==e.length){n="extra whitespace";break}if("string"!=typeof e&&"number"!=typeof e)break;let i=Number(e);if(Number.isNaN(i)){n="not a number";break}if(!Number.isFinite(i)){n="too large or small";break}return t==_.FLOAT&&z(i),i;case _.INT32:case _.FIXED32:case _.SFIXED32:case _.SINT32:case _.UINT32:if(null===e)return 0;let s;if("number"==typeof e?s=e:""===e?n="empty string":"string"==typeof e&&(e.trim().length!==e.length?n="extra whitespace":s=Number(e)),void 0===s)break;return t==_.UINT32?q(s):$(s),s;case _.INT64:case _.SFIXED64:case _.SINT64:if(null===e)return J(H.ZERO,r);if("number"!=typeof e&&"string"!=typeof e)break;return J(H.from(e),r);case _.FIXED64:case _.UINT64:if(null===e)return J(W.ZERO,r);if("number"!=typeof e&&"string"!=typeof e)break;return J(W.from(e),r);case _.BOOL:if(null===e)return!1;if("boolean"!=typeof e)break;return e;case _.STRING:if(null===e)return"";if("string"!=typeof e){n="extra whitespace";break}try{encodeURIComponent(e)}catch(n){n="invalid UTF8";break}return e;case _.BYTES:if(null===e||""===e)return new Uint8Array(0);if("string"!=typeof e)break;return function(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let r,i=new Uint8Array(t),n=0,s=0,o=0;for(let t=0;t<e.length;t++){if(r=A[e.charCodeAt(t)],void 0===r)switch(e[t]){case"=":s=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=r,s=1;break;case 1:i[n++]=o<<2|(48&r)>>4,o=r,s=2;break;case 2:i[n++]=(15&o)<<4|(60&r)>>2,o=r,s=3;break;case 3:i[n++]=(3&o)<<6|r,s=0}}if(1==s)throw Error("invalid base64 string.");return i.subarray(0,n)}(e)}}catch(e){n=e.message}this.assert(!1,i+(n?" - "+n:""),e)}}class Y{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}write(e,t){const r={},i=e;for(const e of this.fields){if(!e.oneof){let n=this.field(e,i[e.localName],t);void 0!==n&&(r[t.useProtoFieldName?e.name:e.jsonName]=n);continue}const n=i[e.oneof];if(n.oneofKind!==e.localName)continue;const s="scalar"==e.kind||"enum"==e.kind?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let o=this.field(e,n[e.localName],s);G(void 0!==o),r[t.useProtoFieldName?e.name:e.jsonName]=o}return r}field(e,t,r){let i;if("map"==e.kind){G("object"==typeof t&&null!==t);const n={};switch(e.V.kind){case"scalar":for(const[r,i]of Object.entries(t)){const t=this.scalar(e.V.T,i,e.name,!1,!0);G(void 0!==t),n[r.toString()]=t}break;case"message":const i=e.V.T();for(const[s,o]of Object.entries(t)){const t=this.message(i,o,e.name,r);G(void 0!==t),n[s.toString()]=t}break;case"enum":const s=e.V.T();for(const[i,o]of Object.entries(t)){G(void 0===o||"number"==typeof o);const t=this.enum(s,o,e.name,!1,!0,r.enumAsInteger);G(void 0!==t),n[i.toString()]=t}}(r.emitDefaultValues||Object.keys(n).length>0)&&(i=n)}else if(e.repeat){G(Array.isArray(t));const n=[];switch(e.kind){case"scalar":for(let r=0;r<t.length;r++){const i=this.scalar(e.T,t[r],e.name,e.opt,!0);G(void 0!==i),n.push(i)}break;case"enum":const i=e.T();for(let s=0;s<t.length;s++){G(void 0===t[s]||"number"==typeof t[s]);const o=this.enum(i,t[s],e.name,e.opt,!0,r.enumAsInteger);G(void 0!==o),n.push(o)}break;case"message":const s=e.T();for(let i=0;i<t.length;i++){const o=this.message(s,t[i],e.name,r);G(void 0!==o),n.push(o)}}(r.emitDefaultValues||n.length>0||r.emitDefaultValues)&&(i=n)}else switch(e.kind){case"scalar":i=this.scalar(e.T,t,e.name,e.opt,r.emitDefaultValues);break;case"enum":i=this.enum(e.T(),t,e.name,e.opt,r.emitDefaultValues,r.enumAsInteger);break;case"message":i=this.message(e.T(),t,e.name,r)}return i}enum(e,t,r,i,n,s){if("google.protobuf.NullValue"==e[0])return n||i?null:void 0;if(void 0!==t){if(0!==t||n||i)return G("number"==typeof t),G(Number.isInteger(t)),s||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}else G(i)}message(e,t,r,i){return void 0===t?i.emitDefaultValues?null:void 0:e.internalJsonWrite(t,i)}scalar(e,t,r,i,n){if(void 0===t)return void G(i);const s=n||i;switch(e){case _.INT32:case _.SFIXED32:case _.SINT32:return 0===t?s?0:void 0:($(t),t);case _.FIXED32:case _.UINT32:return 0===t?s?0:void 0:(q(t),t);case _.FLOAT:z(t);case _.DOUBLE:return 0===t?s?0:void 0:(G("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case _.STRING:return""===t?s?"":void 0:(G("string"==typeof t),t);case _.BOOL:return!1===t?!s&&void 0:(G("boolean"==typeof t),t);case _.UINT64:case _.FIXED64:G("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let e=W.from(t);if(e.isZero()&&!s)return;return e.toString();case _.INT64:case _.SFIXED64:case _.SINT64:G("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let r=H.from(t);if(r.isZero()&&!s)return;return r.toString();case _.BYTES:return G(t instanceof Uint8Array),t.byteLength?function(e){let t,r="",i=0,n=0;for(let s=0;s<e.length;s++)switch(t=e[s],i){case 0:r+=C[t>>2],n=(3&t)<<4,i=1;break;case 1:r+=C[n|t>>4],n=(15&t)<<2,i=2;break;case 2:r+=C[n|t>>6],r+=C[63&t],i=0}return i&&(r+=C[n],r+="=",1==i&&(r+="=")),r}(t):s?"":void 0}}}var Q,X;function Z(e,t=S.STRING){switch(e){case _.BOOL:return!1;case _.UINT64:case _.FIXED64:return J(W.ZERO,t);case _.INT64:case _.SFIXED64:case _.SINT64:return J(H.ZERO,t);case _.DOUBLE:case _.FLOAT:return 0;case _.BYTES:return new Uint8Array(0);case _.STRING:return"";default:return 0}}!function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(r,i,n,s,o)=>{(t(i)?i[e.symbol]:i[e.symbol]=[]).push({no:n,wireType:s,data:o})},e.onWrite=(t,r,i)=>{for(let{no:t,wireType:n,data:s}of e.list(r))i.tag(t,n).raw(s)},e.list=(r,i)=>{if(t(r)){let t=r[e.symbol];return i?t.filter((e=>e.no==i)):t}return[]},e.last=(t,r)=>e.list(t,r).slice(-1)[0];const t=t=>t&&Array.isArray(t[e.symbol])}(Q||(Q={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(X||(X={}));class ee{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=null!==(e=this.info.fields)&&void 0!==e?e:[];this.fieldNoToField=new Map(t.map((e=>[e.no,e])))}}read(e,t,r,i){this.prepare();const n=void 0===i?e.len:e.pos+i;for(;e.pos<n;){const[i,n]=e.tag(),s=this.fieldNoToField.get(i);if(!s){let s=r.readUnknownField;if("throw"==s)throw new Error(`Unknown field ${i} (wire type ${n}) for ${this.info.typeName}`);let o=e.skip(n);!1!==s&&(!0===s?Q.onRead:s)(this.info.typeName,t,i,n,o);continue}let o=t,a=s.repeat,c=s.localName;switch(s.oneof&&(o=o[s.oneof],o.oneofKind!==c&&(o=t[s.oneof]={oneofKind:c})),s.kind){case"scalar":case"enum":let t="enum"==s.kind?_.INT32:s.T,i="scalar"==s.kind?s.L:void 0;if(a){let r=o[c];if(n==X.LengthDelimited&&t!=_.STRING&&t!=_.BYTES){let n=e.uint32()+e.pos;for(;e.pos<n;)r.push(this.scalar(e,t,i))}else r.push(this.scalar(e,t,i))}else o[c]=this.scalar(e,t,i);break;case"message":if(a){let t=o[c],i=s.T().internalBinaryRead(e,e.uint32(),r);t.push(i)}else o[c]=s.T().internalBinaryRead(e,e.uint32(),r,o[c]);break;case"map":let[d,l]=this.mapEntry(s,e,r);o[c][d]=l}}}mapEntry(e,t,r){let i,n,s=t.uint32(),o=t.pos+s;for(;t.pos<o;){let[s,o]=t.tag();switch(s){case 1:i=e.K==_.BOOL?t.bool().toString():this.scalar(t,e.K,S.STRING);break;case 2:switch(e.V.kind){case"scalar":n=this.scalar(t,e.V.T,e.V.L);break;case"enum":n=t.int32();break;case"message":n=e.V.T().internalBinaryRead(t,t.uint32(),r)}break;default:throw new Error(`Unknown field ${s} (wire type ${o}) in map entry for ${this.info.typeName}#${e.name}`)}}if(void 0===i){let t=Z(e.K);i=e.K==_.BOOL?t.toString():t}if(void 0===n)switch(e.V.kind){case"scalar":n=Z(e.V.T,e.V.L);break;case"enum":n=0;break;case"message":n=e.V.T().create()}return[i,n]}scalar(e,t,r){switch(t){case _.INT32:return e.int32();case _.STRING:return e.string();case _.BOOL:return e.bool();case _.DOUBLE:return e.double();case _.FLOAT:return e.float();case _.INT64:return J(e.int64(),r);case _.UINT64:return J(e.uint64(),r);case _.FIXED64:return J(e.fixed64(),r);case _.FIXED32:return e.fixed32();case _.BYTES:return e.bytes();case _.UINT32:return e.uint32();case _.SFIXED32:return e.sfixed32();case _.SFIXED64:return J(e.sfixed64(),r);case _.SINT32:return e.sint32();case _.SINT64:return J(e.sint64(),r)}}}class te{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort(((e,t)=>e.no-t.no))}}write(e,t,r){this.prepare();for(const i of this.fields){let n,s,o=i.repeat,a=i.localName;if(i.oneof){const t=e[i.oneof];if(t.oneofKind!==a)continue;n=t[a],s=!0}else n=e[a],s=!1;switch(i.kind){case"scalar":case"enum":let e="enum"==i.kind?_.INT32:i.T;if(o)if(G(Array.isArray(n)),o==E.PACKED)this.packed(t,e,i.no,n);else for(const r of n)this.scalar(t,e,i.no,r,!0);else void 0===n?G(i.opt):this.scalar(t,e,i.no,n,s||i.opt);break;case"message":if(o){G(Array.isArray(n));for(const e of n)this.message(t,r,i.T(),i.no,e)}else this.message(t,r,i.T(),i.no,n);break;case"map":G("object"==typeof n&&null!==n);for(const[e,s]of Object.entries(n))this.mapEntry(t,r,i,e,s)}}let i=r.writeUnknownFields;!1!==i&&(!0===i?Q.onWrite:i)(this.info.typeName,e,t)}mapEntry(e,t,r,i,n){e.tag(r.no,X.LengthDelimited),e.fork();let s=i;switch(r.K){case _.INT32:case _.FIXED32:case _.UINT32:case _.SFIXED32:case _.SINT32:s=Number.parseInt(i);break;case _.BOOL:G("true"==i||"false"==i),s="true"==i}switch(this.scalar(e,r.K,1,s,!0),r.V.kind){case"scalar":this.scalar(e,r.V.T,2,n,!0);break;case"enum":this.scalar(e,_.INT32,2,n,!0);break;case"message":this.message(e,t,r.V.T(),2,n)}e.join()}message(e,t,r,i,n){void 0!==n&&(r.internalBinaryWrite(n,e.tag(i,X.LengthDelimited).fork(),t),e.join())}scalar(e,t,r,i,n){let[s,o,a]=this.scalarInfo(t,i);a&&!n||(e.tag(r,s),e[o](i))}packed(e,t,r,i){if(!i.length)return;G(t!==_.BYTES&&t!==_.STRING),e.tag(r,X.LengthDelimited),e.fork();let[,n]=this.scalarInfo(t);for(let t=0;t<i.length;t++)e[n](i[t]);e.join()}scalarInfo(e,t){let r,i=X.Varint,n=void 0===t,s=0===t;switch(e){case _.INT32:r="int32";break;case _.STRING:s=n||!t.length,i=X.LengthDelimited,r="string";break;case _.BOOL:s=!1===t,r="bool";break;case _.UINT32:r="uint32";break;case _.DOUBLE:i=X.Bit64,r="double";break;case _.FLOAT:i=X.Bit32,r="float";break;case _.INT64:s=n||H.from(t).isZero(),r="int64";break;case _.UINT64:s=n||W.from(t).isZero(),r="uint64";break;case _.FIXED64:s=n||W.from(t).isZero(),i=X.Bit64,r="fixed64";break;case _.BYTES:s=n||!t.byteLength,i=X.LengthDelimited,r="bytes";break;case _.FIXED32:i=X.Bit32,r="fixed32";break;case _.SFIXED32:i=X.Bit32,r="sfixed32";break;case _.SFIXED64:s=n||H.from(t).isZero(),i=X.Bit64,r="sfixed64";break;case _.SINT32:r="sint32";break;case _.SINT64:s=n||H.from(t).isZero(),r="sint64"}return[i,r,n||s]}}function re(e,t,r){let i,n,s=r;for(let r of e.fields){let e=r.localName;if(r.oneof){const o=s[r.oneof];if(null==(null==o?void 0:o.oneofKind))continue;if(i=o[e],n=t[r.oneof],n.oneofKind=o.oneofKind,null==i){delete n[e];continue}}else if(i=s[e],n=t,null==i)continue;switch(r.repeat&&(n[e].length=i.length),r.kind){case"scalar":case"enum":if(r.repeat)for(let t=0;t<i.length;t++)n[e][t]=i[t];else n[e]=i;break;case"message":let t=r.T();if(r.repeat)for(let r=0;r<i.length;r++)n[e][r]=t.create(i[r]);else void 0===n[e]?n[e]=t.create(i):t.mergePartial(n[e],i);break;case"map":switch(r.V.kind){case"scalar":case"enum":Object.assign(n[e],i);break;case"message":let t=r.V.T();for(let r of Object.keys(i))n[e][r]=t.create(i[r])}}}}const ie={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},ne={ignoreUnknownFields:!1},se=Object.values;function oe(e,t,r){if(t===r)return!0;if(e!==_.BYTES)return!1;let i=t,n=r;if(i.length!==n.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!=n[e])return!1;return!0}function ae(e,t,r){if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!oe(e,t[i],r[i]))return!1;return!0}function ce(e,t,r){if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!e.equals(t[i],r[i]))return!1;return!0}const de={writeUnknownFields:!0,writerFactory:()=>new le};class le{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),r=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],r),r+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(q(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return $(e),N(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){z(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){q(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){$(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return $(e),N(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=H.from(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=W.from(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=H.from(e);return P(t.lo,t.hi,this.buf),this}sint64(e){let t=H.from(e),r=t.hi>>31;return P(t.lo<<1^r,(t.hi<<1|t.lo>>>31)^r,this.buf),this}uint64(e){let t=W.from(e);return P(t.lo,t.hi,this.buf),this}}const ue={readUnknownField:!0,readerFactory:e=>new pe(e)};class pe{constructor(e,t){this.varint64=I,this.uint32=x,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,r=7&e;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e){let t=this.pos;switch(e){case X.Varint:for(;128&this.buf[this.pos++];);break;case X.Bit64:this.pos+=4;case X.Bit32:this.pos+=4;break;case X.LengthDelimited:let t=this.uint32();this.pos+=t;break;case X.StartGroup:let r;for(;(r=this.tag()[1])!==X.EndGroup;)this.skip(r);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return new H(...this.varint64())}uint64(){return new W(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(1&e);return e=(e>>>1|(1&t)<<31)^r,t=t>>>1^r,new H(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new W(this.sfixed32(),this.sfixed32())}sfixed64(){return new H(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}const he=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class me{constructor(e,t,r){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(T),this.options=null!=r?r:{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},he),{[v]:{value:this}})),this.refTypeCheck=new w(this),this.refJsonReader=new K(this),this.refJsonWriter=new Y(this),this.refBinReader=new ee(this),this.refBinWriter=new te(this)}create(e){let t=function(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},v,{value:e});for(let r of e.fields){let e=r.localName;if(!r.opt)if(r.oneof)t[r.oneof]={oneofKind:void 0};else if(r.repeat)t[e]=[];else switch(r.kind){case"scalar":t[e]=Z(r.T,r.L);break;case"enum":t[e]=0;break;case"map":t[e]={}}}return t}(this);return void 0!==e&&re(this,t,e),t}clone(e){let t=this.create();return re(this,t,e),t}equals(e,t){return function(e,t,r){if(t===r)return!0;if(!t||!r)return!1;for(let i of e.fields){let e=i.localName,n=i.oneof?t[i.oneof][e]:t[e],s=i.oneof?r[i.oneof][e]:r[e];switch(i.kind){case"enum":case"scalar":let e="enum"==i.kind?_.INT32:i.T;if(!(i.repeat?ae(e,n,s):oe(e,n,s)))return!1;break;case"map":if(!("message"==i.V.kind?ce(i.V.T(),se(n),se(s)):ae("enum"==i.V.kind?_.INT32:i.V.T,se(n),se(s))))return!1;break;case"message":let t=i.T();if(!(i.repeat?ce(t,n,s):t.equals(n,s)))return!1}}return!0}(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){re(this,e,t)}fromBinary(e,t){let r=function(e){return e?Object.assign(Object.assign({},ue),e):ue}(t);return this.internalBinaryRead(r.readerFactory(e),e.byteLength,r)}fromJson(e,t){return this.internalJsonRead(e,function(e){return e?Object.assign(Object.assign({},ne),e):ne}(t))}fromJsonString(e,t){let r=JSON.parse(e);return this.fromJson(r,t)}toJson(e,t){return this.internalJsonWrite(e,function(e){return e?Object.assign(Object.assign({},ie),e):ie}(t))}toJsonString(e,t){var r;let i=this.toJson(e,t);return JSON.stringify(i,null,null!==(r=null==t?void 0:t.prettySpaces)&&void 0!==r?r:0)}toBinary(e,t){let r=function(e){return e?Object.assign(Object.assign({},de),e):de}(t);return this.internalBinaryWrite(e,r.writerFactory(),r).finish()}internalJsonRead(e,t,r){if(null!==e&&"object"==typeof e&&!Array.isArray(e)){let i=null!=r?r:this.create();return this.refJsonReader.read(e,i,t),i}throw new Error(`Unable to parse message ${this.typeName} from JSON ${k(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,r){return this.refBinWriter.write(e,t,r),t}internalBinaryRead(e,t,r,i){let n=null!=i?i:this.create();return this.refBinReader.read(e,n,r,t),n}}const fe=Object.create(null);fe.open="0",fe.close="1",fe.ping="2",fe.pong="3",fe.message="4",fe.upgrade="5",fe.noop="6";const ge=Object.create(null);Object.keys(fe).forEach((e=>{ge[fe[e]]=e}));const ve={type:"error",data:"parser error"},ye="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),_e="function"==typeof ArrayBuffer,Se=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)},Ee=({type:e,data:t},r,i)=>{return ye&&t instanceof Blob?r?i(t):Se(t,i):_e&&(t instanceof ArrayBuffer||(n=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer))?r?i(t):Se(new Blob([t]),i):i(fe[e]+(t||""));var n},Te="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)Te["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const be="function"==typeof ArrayBuffer,we=(e,t)=>{if(be){const r=(e=>{let t,r,i,n,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const d=new ArrayBuffer(o),l=new Uint8Array(d);for(t=0;t<a;t+=4)r=Te[e.charCodeAt(t)],i=Te[e.charCodeAt(t+1)],n=Te[e.charCodeAt(t+2)],s=Te[e.charCodeAt(t+3)],l[c++]=r<<2|i>>4,l[c++]=(15&i)<<4|n>>2,l[c++]=(3&n)<<6|63&s;return d})(e);return ke(r,t)}return{base64:!0,data:e}},ke=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,Re=(e,t)=>{if("string"!=typeof e)return{type:"message",data:ke(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:we(e.substring(1),t)}:ge[r]?e.length>1?{type:ge[r],data:e.substring(1)}:{type:ge[r]}:ve},Ce=String.fromCharCode(30);function Ae(e){if(e)return function(e){for(var t in Ae.prototype)e[t]=Ae.prototype[t];return e}(e)}Ae.prototype.on=Ae.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Ae.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},Ae.prototype.off=Ae.prototype.removeListener=Ae.prototype.removeAllListeners=Ae.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n=0;n<i.length;n++)if((r=i[n])===t||r.fn===t){i.splice(n,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},Ae.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(r){i=0;for(var n=(r=r.slice(0)).length;i<n;++i)r[i].apply(this,t)}return this},Ae.prototype.emitReserved=Ae.prototype.emit,Ae.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Ae.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ie="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Pe(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const De=Ie.setTimeout,Me=Ie.clearTimeout;function Oe(e,t){t.useNativeTimers?(e.setTimeoutFn=De.bind(Ie),e.clearTimeoutFn=Me.bind(Ie)):(e.setTimeoutFn=Ie.setTimeout.bind(Ie),e.clearTimeoutFn=Ie.clearTimeout.bind(Ie))}class Ne extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class xe extends Ae{constructor(e){super(),this.writable=!1,Oe(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new Ne(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Re(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const Le="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),je=64,Ue={};let Fe,Ve=0,Be=0;function We(e){let t="";do{t=Le[e%je]+t,e=Math.floor(e/je)}while(e>0);return t}function He(){const e=We(+new Date);return e!==Fe?(Ve=0,Fe=e):e+"."+We(Ve++)}for(;Be<je;Be++)Ue[Le[Be]]=Be;function Ge(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}let $e=!1;try{$e="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const qe=$e;function ze(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||qe))return new XMLHttpRequest}catch(e){}if(!t)try{return new(Ie[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function Je(){}const Ke=null!=new ze({xdomain:!1}).responseType;class Ye extends Ae{constructor(e,t){super(),Oe(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=Pe(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new ze(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Ye.requestsCount++,Ye.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Je,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Ye.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function Qe(){for(let e in Ye.requests)Ye.requests.hasOwnProperty(e)&&Ye.requests[e].abort()}Ye.requestsCount=0,Ye.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Qe):"function"==typeof addEventListener&&addEventListener("onpagehide"in Ie?"pagehide":"unload",Qe,!1));const Xe="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Ze=Ie.WebSocket||Ie.MozWebSocket,et="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),tt={websocket:class extends xe{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=et?{}:Pe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=et?new Ze(e,t,r):t?new Ze(e,t):new Ze(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;Ee(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}i&&Xe((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=He()),this.supportsBinary||(e.b64=1);const i=Ge(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!Ze}},polling:class extends xe{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=Ke&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(Ce),i=[];for(let e=0;e<r.length;e++){const n=Re(r[e],t);if(i.push(n),"error"===n.type)break}return i})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,i=new Array(r);let n=0;e.forEach(((e,s)=>{Ee(e,!1,(e=>{i[s]=e,++n===r&&t(i.join(Ce))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=He()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const i=Ge(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Ye(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},rt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,it=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function nt(e){const t=e,r=e.indexOf("["),i=e.indexOf("]");-1!=r&&-1!=i&&(e=e.substring(0,r)+e.substring(r,i).replace(/:/g,";")+e.substring(i,e.length));let n=rt.exec(e||""),s={},o=14;for(;o--;)s[it[o]]=n[o]||"";return-1!=r&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,s.path),s.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(r[t]=i)})),r}(0,s.query),s}class st extends Ae{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=nt(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=nt(t.host).host),Oe(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,i=r.length;e<i;e++){let i=r[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new tt[e](r)}open(){let e;if(this.opts.rememberUpgrade&&st.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;st.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;st.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function n(){r||(r=!0,d(),t.close(),t=null)}const s=e=>{const r=new Error("probe error: "+e);r.transport=t.name,n(),this.emitReserved("upgradeError",r)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){t&&e.name!==t.name&&n()}const d=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",i),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",st.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(e+="string"==typeof(t=i)?function(e){let t=0,r=0;for(let i=0,n=e.length;i<n;i++)t=e.charCodeAt(i),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(i++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof r&&(i=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const n={type:e,data:t,options:r};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){st.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}st.protocol=4,st.protocol;const ot="function"==typeof ArrayBuffer,at=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,ct=Object.prototype.toString,dt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ct.call(Blob),lt="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ct.call(File);function ut(e){return ot&&(e instanceof ArrayBuffer||at(e))||dt&&e instanceof Blob||lt&&e instanceof File}function pt(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(pt(e[t]))return!0;return!1}if(ut(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return pt(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&pt(e[t]))return!0;return!1}function ht(e){const t=[],r=e.data,i=e;return i.data=mt(r,t),i.attachments=t.length,{packet:i,buffers:t}}function mt(e,t){if(!e)return e;if(ut(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=mt(e[i],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=mt(e[i],t));return r}return e}function ft(e,t){return e.data=gt(e.data,t),delete e.attachments,e}function gt(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=gt(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=gt(e[r],t));return e}const vt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],yt=5;var _t;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(_t||(_t={}));class St{constructor(e){this.replacer=e}encode(e){return e.type!==_t.EVENT&&e.type!==_t.ACK||!pt(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===_t.EVENT?_t.BINARY_EVENT:_t.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==_t.BINARY_EVENT&&e.type!==_t.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ht(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function Et(e){return"[object Object]"===Object.prototype.toString.call(e)}class Tt extends Ae{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===_t.BINARY_EVENT;r||t.type===_t.BINARY_ACK?(t.type=r?_t.EVENT:_t.ACK,this.reconstructor=new bt(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!ut(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===_t[r.type])throw new Error("unknown packet type "+r.type);if(r.type===_t.BINARY_EVENT||r.type===_t.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const n=e.substring(i,t);if(n!=Number(n)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(n)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(i,t)}else r.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!Tt.isPayloadValid(r.type,i))throw new Error("invalid payload");r.data=i}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case _t.CONNECT:return Et(t);case _t.DISCONNECT:return void 0===t;case _t.CONNECT_ERROR:return"string"==typeof t||Et(t);case _t.EVENT:case _t.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===vt.indexOf(t[0]));case _t.ACK:case _t.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class bt{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ft(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function wt(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const kt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Rt extends Ae{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[wt(e,"open",this.onopen.bind(this)),wt(e,"packet",this.onpacket.bind(this)),wt(e,"error",this.onerror.bind(this)),wt(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(kt.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:_t.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,i=t.pop();this._registerAckCallback(e,i),r.id=e}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const n=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),i);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...e])}}emitWithAck(e,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((i,n)=>{t.push(((e,t)=>r?e?n(e):i(t):i(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...i)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),r.pending=!1,this._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:_t.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case _t.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _t.EVENT:case _t.BINARY_EVENT:this.onevent(e);break;case _t.ACK:case _t.BINARY_ACK:this.onack(e);break;case _t.DISCONNECT:this.ondisconnect();break;case _t.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:_t.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_t.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Ct(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ct.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Ct.prototype.reset=function(){this.attempts=0},Ct.prototype.setMin=function(e){this.ms=e},Ct.prototype.setMax=function(e){this.max=e},Ct.prototype.setJitter=function(e){this.jitter=e};class At extends Ae{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Oe(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Ct({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||i;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new st(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=wt(t,"open",(function(){r.onopen(),e&&e()})),n=wt(t,"error",(t=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",t),e?e(t):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&i();const r=this.setTimeoutFn((()=>{i(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}return this.subs.push(i),this.subs.push(n),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(wt(e,"ping",this.onping.bind(this)),wt(e,"data",this.ondata.bind(this)),wt(e,"error",this.onerror.bind(this)),wt(e,"close",this.onclose.bind(this)),wt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){Xe((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Rt(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const It={};function Pt(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let i=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),i=nt(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const n=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+n+":"+i.port+t,i.href=i.protocol+"://"+n+(r&&r.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),i=r.source,n=r.id,s=r.path,o=It[n]&&s in It[n].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new At(i,t):(It[n]||(It[n]=new At(i,t)),a=It[n]),r.query&&!t.query&&(t.query=r.queryKey),a.socket(r.path,t)}Object.assign(Pt,{Manager:At,Socket:Rt,io:Pt,connect:Pt});var Dt=r(8389);const Mt=((e,t)=>{let r=null;return()=>{if(null!==r)return r;const e=new Blob(['(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'],{type:"application/javascript; charset=utf-8"}),t=URL.createObjectURL(e);return r=(e=>{const t=new Map([[0,()=>{}]]),r=new Map([[0,()=>{}]]),i=new Map,n=new Worker(e);return n.addEventListener("message",(({data:e})=>{if(void 0!==(n=e).method&&"call"===n.method){const{params:{timerId:n,timerType:s}}=e;if("interval"===s){const e=t.get(n);if("number"==typeof e){const t=i.get(e);if(void 0===t||t.timerId!==n||t.timerType!==s)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e()}}else if("timeout"===s){const e=r.get(n);if("number"==typeof e){const t=i.get(e);if(void 0===t||t.timerId!==n||t.timerType!==s)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e(),r.delete(n)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(e)){const{error:{message:t}}=e;throw new Error(t)}{const{id:n}=e,s=i.get(n);if(void 0===s)throw new Error("The timer is in an undefined state.");const{timerId:o,timerType:a}=s;i.delete(n),"interval"===a?t.delete(o):r.delete(o)}}var n})),{clearInterval:e=>{const r=(0,Dt.generateUniqueNumber)(i);i.set(r,{timerId:e,timerType:"interval"}),t.set(e,r),n.postMessage({id:r,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=(0,Dt.generateUniqueNumber)(i);i.set(t,{timerId:e,timerType:"timeout"}),r.set(e,t),n.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,r=0)=>{const i=(0,Dt.generateUniqueNumber)(t);return t.set(i,(()=>{e(),"function"==typeof t.get(i)&&n.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}})})),n.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}}),i},setTimeout:(e,t=0)=>{const i=(0,Dt.generateUniqueNumber)(r);return r.set(i,e),n.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:i,timerType:"timeout"}}),i}}})(t),setTimeout((()=>URL.revokeObjectURL(t))),r}})(),Ot=e=>Mt().clearInterval(e),Nt=(e,t)=>Mt().setInterval(e,t);e=r.hmd(e);var xt,Lt=Object.defineProperty,jt=Object.defineProperties,Ut=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertySymbols,Vt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty,Wt=Object.prototype.propertyIsEnumerable,Ht=Reflect.get,Gt=Math.pow,$t=(e,t,r)=>t in e?Lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,qt=(e,t)=>{for(var r in t||(t={}))Bt.call(t,r)&&$t(e,r,t[r]);if(Ft)for(var r of Ft(t))Wt.call(t,r)&&$t(e,r,t[r]);return e},zt=(e,t)=>jt(e,Ut(t)),Jt=(e,t)=>{var r={};for(var i in e)Bt.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&Ft)for(var i of Ft(e))t.indexOf(i)<0&&Wt.call(e,i)&&(r[i]=e[i]);return r},Kt=(e,t,r)=>($t(e,"symbol"!=typeof t?t+"":t,r),r),Yt=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},Qt=(e,t,r)=>(Yt(e,t,"read from private field"),r?r.call(e):t.get(e)),Xt=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Zt=(e,t,r,i)=>(Yt(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),er=(e,t,r)=>(Yt(e,t,"access private method"),r),tr=(e,t,r)=>new Promise(((i,n)=>{var s=e=>{try{a(r.next(e))}catch(e){n(e)}},o=e=>{try{a(r.throw(e))}catch(e){n(e)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(s,o);a((r=r.apply(e,t)).next())})),rr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},ir={},nr={get exports(){return ir},set exports(e){ir=e}},sr="object"==typeof Reflect?Reflect:null,or=sr&&"function"==typeof sr.apply?sr.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};xt=sr&&"function"==typeof sr.ownKeys?sr.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var ar=Number.isNaN||function(e){return e!=e};function cr(){cr.init.call(this)}nr.exports=cr,ir.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}yr(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&yr(e,"error",t,{once:!0})}(e,n)}))},cr.EventEmitter=cr,cr.prototype._events=void 0,cr.prototype._eventsCount=0,cr.prototype._maxListeners=void 0;var dr=10;function lr(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function ur(e){return void 0===e._maxListeners?cr.defaultMaxListeners:e._maxListeners}function pr(e,t,r,i){var n,s,o;if(lr(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),(n=ur(e))>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,function(e){console&&console.warn&&console.warn(e)}(a)}return e}function hr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mr(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=hr.bind(i);return n.listener=r,i.wrapFn=n,n}function fr(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):vr(n,n.length)}function gr(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function vr(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function yr(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(cr,"defaultMaxListeners",{enumerable:!0,get:function(){return dr},set:function(e){if("number"!=typeof e||e<0||ar(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");dr=e}}),cr.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},cr.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||ar(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},cr.prototype.getMaxListeners=function(){return ur(this)},cr.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=n[e];if(void 0===a)return!1;if("function"==typeof a)or(a,this,t);else{var c=a.length,d=vr(a,c);for(r=0;r<c;++r)or(d[r],this,t)}return!0},cr.prototype.addListener=function(e,t){return pr(this,e,t,!1)},cr.prototype.on=cr.prototype.addListener,cr.prototype.prependListener=function(e,t){return pr(this,e,t,!0)},cr.prototype.once=function(e,t){return lr(t),this.on(e,mr(this,e,t)),this},cr.prototype.prependOnceListener=function(e,t){return lr(t),this.prependListener(e,mr(this,e,t)),this},cr.prototype.removeListener=function(e,t){var r,i,n,s,o;if(lr(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},cr.prototype.off=cr.prototype.removeListener,cr.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},cr.prototype.listeners=function(e){return fr(this,e,!0)},cr.prototype.rawListeners=function(e){return fr(this,e,!1)},cr.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):gr.call(e,t)},cr.prototype.listenerCount=gr,cr.prototype.eventNames=function(){return this._eventsCount>0?xt(this._events):[]};var _r,Sr,Er={},Tr={get exports(){return Er},set exports(e){Er=e}};var br=function(e){function t(e){let i,n,s,o=null;function a(...e){if(!a.enabled)return;const r=a,n=Number(new Date),s=n-(i||n);r.diff=s,r.prev=i,r.curr=n,i=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((i,n)=>{if("%%"===i)return"%";o++;const s=t.formatters[n];if("function"==typeof s){const t=e[o];i=s.call(r,t),e.splice(o,1),o--}return i})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const i=t(this.namespace+(void 0===r?":":r)+e);return i.log=this.log,i}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=function(){if(Sr)return _r;Sr=1;var e=1e3,t=60*e,r=60*t,i=24*r;function n(e,t,r,i){var n=t>=1.5*r;return Math.round(e/r)+" "+i+(n?"s":"")}return _r=function(s,o){o=o||{};var a=typeof s;if("string"===a&&s.length>0)return function(n){if(!((n=String(n)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(s){var o=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*t;case"seconds":case"second":case"secs":case"sec":case"s":return o*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(s);if("number"===a&&isFinite(s))return o.long?function(s){var o=Math.abs(s);return o>=i?n(s,o,i,"day"):o>=r?n(s,o,r,"hour"):o>=t?n(s,o,t,"minute"):o>=e?n(s,o,e,"second"):s+" ms"}(s):function(n){var s=Math.abs(n);return s>=i?Math.round(n/i)+"d":s>=r?Math.round(n/r)+"h":s>=t?Math.round(n/t)+"m":s>=e?Math.round(n/e)+"s":n+"ms"}(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))}}(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=br(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(Tr,Er);const wr="mediasoup-client",kr=new class{constructor(e){e?(this._debug=Er(`${wr}:${e}`),this._warn=Er(`${wr}:WARN:${e}`),this._error=Er(`${wr}:ERROR:${e}`)):(this._debug=Er(wr),this._warn=Er(`${wr}:WARN`),this._error=Er(`${wr}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}("EnhancedEventEmitter");let Rr=class extends ir.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){const r=super.listenerCount(e);try{return super.emit(e,...t)}catch(t){return kr.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,t),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}};var Cr,Ar,Ir;(Ar=Cr||(Cr={}))[Ar.MAJOR_EVENT=0]="MAJOR_EVENT",Ar[Ar.MINOR_EVENT=1]="MINOR_EVENT",function(e){e.PRECALL_TEST_BEGIN="precall_begin",e.PRECALL_TEST_COMPLETE="precall_end",e.CALL_JOIN_BEGIN="call_join",e.NET_QUALITY_TEST_BEGIN="net_quality_test_begin",e.NET_QUALITY_TEST_END="net_quality_test_end",e.WEBSOCKET_CONNECTED="websocket_connected",e.TRANSPORT_CONNECTED="transport_connected",e.AUDIO_ON="audio_on",e.AUDIO_OFF="audio_off",e.VIDEO_ON="video_on",e.VIDEO_OFF="video_off",e.PARTICIPANT_ROLE="participant_role",e.PING_STAT="ping_stat",e.DISCONNECT="disconnect",e.RECONNECT_ATTEMPT="reconnect_attempt",e.SCREENSHARE_START_REQUESTED="screenshare_start_requested",e.SCREENSHARE_STARTED="screenshare_started",e.SCREENSHARE_STOPPED="screenshare_stopped",e.TAB_CHANGE="tab_change",e.BROWSER_BACKGROUNDED="browser_backgrounded",e.BROWSER_FOREGROUNDED="browser_foregrounded",e.DOMINANT_SPEAKER="dominant_speaker",e.AUDIO_DEVICES_UPDATES="audio_devices_updates",e.VIDEO_DEVICES_UPDATES="video_devices_updates",e.SPEAKER_DEVICES_UPDATES="speaker_devices_updates",e.SELECTED_MICROHPONE_UPDATE="selected_microphone_update",e.SELECTED_CAMERA_UPDATE="selected_camera_update",e.SELECTED_SPEAKER_UPDATE="selected_speaker_update",e.MEDIA_PERMISSION="camera_permission",e.LEGACY_SWITCH="legacy_switch",e.AUDIO_PLAY_FAILED="audio_play_failed",e.VIDEO_PLAY_FAILED="video_play_failed",e.AUDIO_TRACK_MUTED="audio_track_muted",e.VIDEO_TRACK_MUTED="video_track_muted",e.IVS_PLAYER_REBUFFERING="ivs_player_rebuffering",e.IVS_PLAYER_AUDIO_BLOCKED="ivs_player_audio_blocked",e.IVS_PLAYER_PLAYBACK_BLOCKED="ivs_player_playback_blocked",e.IVS_PLAYER_ERROR="ivs_player_error",e.IVS_PLAYER_RECOVERABLE_ERROR="ivs_player_recoverable_error",e.IVS_PLAYER_WORKER_ERROR="ivs_player_worker_error",e.IVS_PLAYER_NETWORK_UNAVAILABLE="ivs_player_network_unavailable",e.LIVESTREAM_LATENCY="livestream_latency",e.IVS_PLAYER_ANALYTICS_EVENT="ivs_player_analytics_event",e.IVS_PLAYER_PLAYBACK_RATE_CHANGED="ivs_player_playback_rate_changed",e.IVS_PLAYER_QUALITY_CHANGED="ivs_player_quality_changed",e.IVS_PLAYER_INITIALIZED="ivs_player_initialized"}(Ir||(Ir={}));const Pr=new Map([[Ir.PRECALL_TEST_BEGIN,Cr.MINOR_EVENT],[Ir.PRECALL_TEST_COMPLETE,Cr.MINOR_EVENT],[Ir.CALL_JOIN_BEGIN,Cr.MAJOR_EVENT],[Ir.NET_QUALITY_TEST_BEGIN,Cr.MINOR_EVENT],[Ir.NET_QUALITY_TEST_END,Cr.MINOR_EVENT],[Ir.WEBSOCKET_CONNECTED,Cr.MINOR_EVENT],[Ir.TRANSPORT_CONNECTED,Cr.MAJOR_EVENT],[Ir.AUDIO_ON,Cr.MINOR_EVENT],[Ir.AUDIO_OFF,Cr.MINOR_EVENT],[Ir.VIDEO_ON,Cr.MINOR_EVENT],[Ir.VIDEO_OFF,Cr.MINOR_EVENT],[Ir.PARTICIPANT_ROLE,Cr.MINOR_EVENT],[Ir.PING_STAT,Cr.MAJOR_EVENT],[Ir.DISCONNECT,Cr.MAJOR_EVENT],[Ir.RECONNECT_ATTEMPT,Cr.MAJOR_EVENT],[Ir.SCREENSHARE_START_REQUESTED,Cr.MINOR_EVENT],[Ir.SCREENSHARE_STARTED,Cr.MINOR_EVENT],[Ir.SCREENSHARE_STOPPED,Cr.MINOR_EVENT],[Ir.TAB_CHANGE,Cr.MINOR_EVENT],[Ir.BROWSER_BACKGROUNDED,Cr.MINOR_EVENT],[Ir.BROWSER_FOREGROUNDED,Cr.MINOR_EVENT],[Ir.DOMINANT_SPEAKER,Cr.MINOR_EVENT],[Ir.AUDIO_DEVICES_UPDATES,Cr.MINOR_EVENT],[Ir.VIDEO_DEVICES_UPDATES,Cr.MINOR_EVENT],[Ir.SPEAKER_DEVICES_UPDATES,Cr.MINOR_EVENT],[Ir.SELECTED_MICROHPONE_UPDATE,Cr.MINOR_EVENT],[Ir.SELECTED_CAMERA_UPDATE,Cr.MINOR_EVENT],[Ir.SELECTED_SPEAKER_UPDATE,Cr.MINOR_EVENT],[Ir.MEDIA_PERMISSION,Cr.MINOR_EVENT],[Ir.LEGACY_SWITCH,Cr.MINOR_EVENT],[Ir.AUDIO_PLAY_FAILED,Cr.MINOR_EVENT],[Ir.VIDEO_PLAY_FAILED,Cr.MINOR_EVENT],[Ir.AUDIO_TRACK_MUTED,Cr.MINOR_EVENT],[Ir.VIDEO_TRACK_MUTED,Cr.MINOR_EVENT],[Ir.IVS_PLAYER_REBUFFERING,Cr.MAJOR_EVENT],[Ir.IVS_PLAYER_AUDIO_BLOCKED,Cr.MAJOR_EVENT],[Ir.IVS_PLAYER_PLAYBACK_BLOCKED,Cr.MAJOR_EVENT],[Ir.IVS_PLAYER_ERROR,Cr.MAJOR_EVENT],[Ir.IVS_PLAYER_RECOVERABLE_ERROR,Cr.MAJOR_EVENT],[Ir.IVS_PLAYER_WORKER_ERROR,Cr.MAJOR_EVENT],[Ir.IVS_PLAYER_NETWORK_UNAVAILABLE,Cr.MAJOR_EVENT],[Ir.LIVESTREAM_LATENCY,Cr.MAJOR_EVENT],[Ir.IVS_PLAYER_ANALYTICS_EVENT,Cr.MINOR_EVENT],[Ir.IVS_PLAYER_PLAYBACK_RATE_CHANGED,Cr.MINOR_EVENT],[Ir.IVS_PLAYER_QUALITY_CHANGED,Cr.MINOR_EVENT],[Ir.IVS_PLAYER_INITIALIZED,Cr.MINOR_EVENT]]);class Dr{constructor(){Kt(this,"events"),this.events=[]}add(e){this.events.push(e)}flush(){return{entries:this.events.splice(0,25)}}}class Mr extends ir{constructor({logger:e,peerId:t,apiHostnames:r}){super(),Kt(this,"logger"),Kt(this,"peerId"),Kt(this,"eventStore"),Kt(this,"apiEndpoint"),this.logger=e,this.peerId=t,this.apiEndpoint=`https://${r.daCollector}/api/v1/message`,this.eventStore=new Dr}sendEventsChunkToServer(e){return tr(this,null,(function*(){var t;const r={payload:e,peerId:this.peerId};try{return yield fetch(this.apiEndpoint,{method:"POST",body:JSON.stringify(r)}),!0}catch(r){return this.logger.error("callStats::sendEventsChunkToServer::catch",{error:r}),null==(t=e.entries)||t.forEach((e=>{this.eventStore.add(e)})),!1}}))}callEvent(e){e.timestamp=new Date,this.eventStore.add(e),this.emit(e.event,e.metaData),Pr.get(e.event)===Cr.MAJOR_EVENT&&this.flush()}flush(){return tr(this,null,(function*(){var e;const t=this.eventStore.flush();return!(null==(e=null==t?void 0:t.entries)||!e.length||(yield this.sendEventsChunkToServer(t),0))}))}}var Or;!function(e){e.CHROMIUM="chromum",e.FIREFOX="firefox",e.SAFARI="safari"}(Or||(Or={}));const Nr="prod";var xr,Lr;!function(e){e.AUDIO="AUDIO",e.VIDEO="VIDEO",e.SPEAKER="SPEAKER"}(xr||(xr={})),function(e){e[e.INIT=0]="INIT",e[e.ACCEPTED=1]="ACCEPTED",e[e.DENIED=2]="DENIED",e[e.SYS_DENIED=3]="SYS_DENIED",e[e.FAILED=4]="FAILED",e[e.NOTFOUND=5]="NOTFOUND",e[e.NOT_APPLICABLE=6]="NOT_APPLICABLE"}(Lr||(Lr={}));const jr=.02,Ur=.03;function Fr({stat:e,weight:t,rangeMin:r,rangeMax:i,rangeRankingDirection:n}){return null==e?t:r===i?"UP"===n?e<=r?t:0:e>=i?t:0:"UP"===n?(1-Math.max(Math.min(i,Math.abs(e))-r,0)/(i-r))*t:"DOWN"===n?Math.max(Math.min(i,Math.abs(e))-r,0)/(i-r)*t:t}function Vr({isLowQualityVideo:e,isVideoStuck:t,isVideoLagging:r,jitterQuality:i,packetsLostQuality:n}){const s=(e?.85:1)*(r?.7:1)*(t?.5:1)*.8+i*n*.2;return Math.round(100*(s+Number.EPSILON))/100}function Br({packetsLost:e,packetsSent:t}){return t>0?100*e/t:0}function Wr({packetsLost:e,packetsSent:t,jitter:r}){return Fr({stat:Br({packetsLost:e,packetsSent:t}),weight:.7,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"})+Fr({stat:r,weight:.3,rangeMin:jr,rangeMax:Ur,rangeRankingDirection:"UP"})}function Hr({frameWidth:e,framesPerSecond:t,packetsLost:r,packetsSent:i,jitter:n,isScreenShare:s,framesEncoded:o}){const a=Fr({stat:Br({packetsLost:r,packetsSent:i}),weight:1,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"}),c=Fr({stat:n,weight:1,rangeMin:jr,rangeMax:Ur,rangeRankingDirection:"UP"}),d=function({frameWidth:e,isScreenShare:t}){return e<(t?720:240)}({frameWidth:e,isScreenShare:s}),l=function({framesPerSecond:e,isScreenShare:t}){return e<(t?3:8)}({framesPerSecond:t,isScreenShare:s}),u=function({framesEncoded:e}){return 0===e}({framesEncoded:o,isScreenShare:s});return Vr({isLowQualityVideo:d,isVideoLagging:l,isVideoStuck:u,jitterQuality:c,packetsLostQuality:a})}function Gr({packetsLost:e,packetsReceived:t}){return t+e>0?100*e/(t+e):0}function $r({concealmentEvents:e,packetsLost:t,packetsReceived:r,jitter:i}){return Fr({stat:e,weight:.2,rangeMin:0,rangeMax:3,rangeRankingDirection:"UP"})+Fr({stat:Gr({packetsLost:t,packetsReceived:r}),weight:.5,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"})+Fr({stat:i,weight:.3,rangeMin:jr,rangeMax:Ur,rangeRankingDirection:"UP"})}function qr({frameWidth:e,framesPerSecond:t,packetsLost:r,packetsReceived:i,jitter:n,isScreenShare:s,framesDecoded:o}){const a=Fr({stat:Gr({packetsLost:r,packetsReceived:i}),weight:1,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"}),c=Fr({stat:n,weight:1,rangeMin:jr,rangeMax:Ur,rangeRankingDirection:"UP"}),d=function({frameWidth:e,isScreenShare:t}){return e<(t?720:240)}({frameWidth:e,isScreenShare:s}),l=function({framesPerSecond:e,isScreenShare:t}){return e<(t?3:8)}({framesPerSecond:t,isScreenShare:s}),u=function({framesDecoded:e}){return 0===e}({framesDecoded:o,isScreenShare:s});return Vr({isLowQualityVideo:d,isVideoLagging:l,isVideoStuck:u,jitterQuality:c,packetsLostQuality:a})}class zr{constructor(e){Kt(this,"pc1"),Kt(this,"pc2"),Kt(this,"constrainVideoBitrateKbps"),Kt(this,"constrainOfferToRemoveVideoFec",!1),Kt(this,"iceCandidateFilter");const t=new RTCPeerConnection(e),r=new RTCPeerConnection(e);this.pc1=t,this.pc2=r,this.iceCandidateFilter=zr.noFilter,this.pc1.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc2)),this.pc2.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc1))}static parseCandidate(e){const t=e.indexOf("candidate:")+10,r=e.substr(t).split(" ");return{type:r[7],protocol:r[2],address:r[4]}}static isNotHostCandidate(e){return"host"!==e.type}static isHost(e){return"host"===e.type}static isRelay(e){return"relay"===e.type}static isReflexive(e){return"srflx"===e.type}static noFilter(e){return!0}onIceCandidate(e,t){if(t.candidate){const r=zr.parseCandidate(t.candidate.candidate);this.iceCandidateFilter(r)&&e.addIceCandidate(t.candidate)}}setIceCandidateFilter(e){this.iceCandidateFilter=e}constrainVideoBitrate(e){this.constrainVideoBitrateKbps=e}disableVideoFec(){this.constrainOfferToRemoveVideoFec=!0}gotOffer(e){this.constrainOfferToRemoveVideoFec&&(e.sdp=e.sdp.replace(/(m=video 1 [^\r]+)(116 117)(\r\n)/g,"$1\r\n"),e.sdp=e.sdp.replace(/a=rtpmap:116 red\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=rtpmap:117 ulpfec\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=rtpmap:98 rtx\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=fmtp:98 apt=116\r\n/g,"")),this.pc1.setLocalDescription(e),this.pc2.setRemoteDescription(e),this.pc2.createAnswer().then(this.gotAnswer.bind(this),this.reportFatal.bind(this))}gotAnswer(e){this.constrainVideoBitrateKbps&&(e.sdp=e.sdp.replace(/a=mid:video\r\n/g,`a=mid:video\r\nb=AS:${this.constrainVideoBitrateKbps}\r\n`)),this.pc2.setLocalDescription(e),this.pc1.setRemoteDescription(e)}establishConnection(){this.pc1.createOffer().then(this.gotOffer.bind(this),this.reportFatal.bind(this))}reportFatal(e){console.error("Error:",e)}getRoundTripTime(){return tr(this,null,(function*(){const[e,t]=yield Promise.all([this.pc1.getStats(),this.pc2.getStats()]);let r,i;if(e.forEach((e=>{"candidate-pair"===e.type&&!0===e.nominated&&e.bytesSent>0&&(r=e)})),t.forEach((e=>{"candidate-pair"===e.type&&!0===e.nominated&&e.bytesReceived>0&&(i=e)})),r&&i)try{if(r.currentRoundTripTime&&i.currentRoundTripTime)return{rtt:r.currentRoundTripTime,backendRTT:i.currentRoundTripTime};const e=(i.lastPacketReceivedTimestamp-r.lastPacketSentTimestamp)/1e3;return{rtt:e,backendRTT:e}}catch(e){return}}))}close(){this.pc1.close(),this.pc2.close()}}class Jr extends ir{constructor(e){super(),Kt(this,"call"),Kt(this,"timeOut"),this.call=new zr(e)}start(e=1e4){this.call.establishConnection(),this.timeOut=setTimeout(this.testFailed.bind(this),e)}testComplete(e){clearTimeout(this.timeOut),this.call.close(),this.emit("done",e)}testFailed(e){this.call.close(),this.emit("failed",e)}}class Kr extends Jr{constructor(e){super(e),Kt(this,"senderChannel"),Kt(this,"recieveChannel"),Kt(this,"startTime"),Kt(this,"lastBitrateMeasureTime"),Kt(this,"sentPayloadBytes",0),Kt(this,"recievedPayloadBytes",0),Kt(this,"lastReceivedPayloadBytes",0),Kt(this,"stopSending",!1),Kt(this,"testProgress",0),Kt(this,"samplePacket",""),Kt(this,"finalBitrateSum",0),Kt(this,"bitRateSampels",0),Kt(this,"maxNumberOfPacketsToSend",0),Kt(this,"bytesToKeepBuffered",0),Kt(this,"testDurationSeconds",5),this.call.setIceCandidateFilter(zr.isNotHostCandidate),this.senderChannel=this.call.pc1.createDataChannel(null);for(let e=0;e<262144;e+=1)this.samplePacket+="h";this.maxNumberOfPacketsToSend=1,this.bytesToKeepBuffered=1024*this.maxNumberOfPacketsToSend,this.testDurationSeconds=4,this.senderChannel.addEventListener("open",this.sendingStep.bind(this)),this.call.pc2.addEventListener("datachannel",this.onRecieverChannel.bind(this))}sendingStep(){const e=new Date;this.startTime||(this.startTime=e,this.lastBitrateMeasureTime=e);for(let e=0;e!==this.maxNumberOfPacketsToSend&&!(this.senderChannel.bufferedAmount>=this.bytesToKeepBuffered);e+=1){this.sentPayloadBytes+=this.samplePacket.length;try{this.senderChannel.send(this.samplePacket)}catch(e){}}const t=e.getTime()-this.startTime.getTime();t>=1e3*this.testDurationSeconds?(this.stopSending=!0,this.testProgress=100):(this.testProgress=t/(10*this.testDurationSeconds),setTimeout(this.sendingStep.bind(this),1))}onMessageRecieved(e){this.recievedPayloadBytes+=e.data.length;const t=new Date,r=t.getTime()-this.lastBitrateMeasureTime.getTime();if(r>=1e3){const e=8*(this.recievedPayloadBytes-this.lastReceivedPayloadBytes)/(r/1e3);this.finalBitrateSum+=e,this.bitRateSampels+=1,this.lastReceivedPayloadBytes=this.recievedPayloadBytes,this.lastBitrateMeasureTime=t}if(this.stopSending&&this.sentPayloadBytes===this.recievedPayloadBytes){const e=this.finalBitrateSum/this.bitRateSampels;this.testComplete({throughput:Math.round(.001*e)})}}testComplete(e){this.call.getRoundTripTime().then((({rtt:t,backendRTT:r})=>super.testComplete({RTT:t,backendRTT:r,throughput:e.throughput})))}onRecieverChannel(e){this.recieveChannel=e.channel,this.recieveChannel.addEventListener("message",this.onMessageRecieved.bind(this))}}class Yr extends Jr{constructor(e,t=zr.noFilter){super(e),Kt(this,"ch1"),Kt(this,"ch2"),this.call.setIceCandidateFilter(t);const r=this.call.pc1.createDataChannel(null);this.ch1=r,r.addEventListener("open",(()=>{r.send("hello")})),r.addEventListener("message",this.onCh1Recieve.bind(this)),this.call.pc2.addEventListener("datachannel",this.dataChannelHandler.bind(this))}onCh1Recieve(e){"world"!==e.data?this.hangup("Invalid data transmitted."):this.testComplete({connectivity:!0})}onCh2Recieve(e){if("hello"!==e.data)this.hangup("Invalid data transmitted.");else try{this.ch2.send("world")}catch(e){}}dataChannelHandler(e){const t=e.channel;this.ch2=t,t.addEventListener("message",this.onCh2Recieve.bind(this))}hangup(e){this.testFailed(e)}}class Qr extends Yr{constructor(e){super(e,zr.isHost)}}class Xr extends Yr{constructor(e){super(e,zr.isRelay)}}class Zr extends Yr{constructor(e){super(e,zr.isReflexive)}}const ei=new class{constructor(){Kt(this,"ipInformation",null)}getIPDetails(e){return tr(this,arguments,(function*({peerId:e,apiHostnames:t}){var r;if(!this.ipInformation){try{const e=`https://${t.location}`,i=yield(yield fetch(e)).json();if((null==(r=i.loc)?void 0:r.length)>5)return this.ipInformation=i,i;throw Error("Insufficient data")}catch(e){}const i=yield fetch(`https://${t.locationLegacy}/?token=3c493932b0624c&peerId=${e}`,{method:"POST"});this.ipInformation=yield i.json()}return this.ipInformation}))}},ti=[{urls:"turn:turn.dyte.in:443?transport=tcp",username:"dyte",credential:"dytein",credentialType:"password"},{urls:"turn:turn.dyte.in:3478?transport=udp",username:"dyte",credential:"dytein",credentialType:"password"}];function ri(e){const[t,r]=e.split(",");return{coords:{latitude:Number(t),longitude:Number(r)}}}class ii{constructor(){Kt(this,"transport"),Kt(this,"candidatePair"),Kt(this,"outboundVideoRtp",new Map),Kt(this,"inboundVideoRtp",new Map),Kt(this,"outboundAudioRtp",new Map),Kt(this,"inboundAudioRtp",new Map),Kt(this,"remoteInboundRtp",new Map),Kt(this,"producerStreamMap",new Map),Kt(this,"consumerStreamMap",new Map),Kt(this,"staleProducerStreamMap",!1),Kt(this,"staleConsumerStreamMap",!1)}}class ni extends Rr{constructor(){super(),Kt(this,"observer"),Kt(this,"outboundProducerMap",new Map),Kt(this,"inboundConsumerMap",new Map),Kt(this,"consumerPeerIdMap",new Map),Kt(this,"pausedConsumerMap",new Map),Kt(this,"pausedProducerMap",new Map),Kt(this,"overallProducingTransportsStatsMap",{}),Kt(this,"overallConsumingTransportsStatsMap",{}),Kt(this,"overallConsumersStatsMap",{}),Kt(this,"overallProducersStatsMap",{}),Kt(this,"videoProducerToStatsMap",new Map),Kt(this,"audioProducerToStatsMap",new Map),Kt(this,"videoConsumerToStatsMap",new Map),Kt(this,"audioConsumerToStatsMap",new Map),Kt(this,"consumerIdsWithFreezedVideo",new Set),Kt(this,"consumerIdsWithFreezedAudio",new Set),Kt(this,"producerIdsWithFreezedVideo",new Set),Kt(this,"producerIdsWithFreezedAudio",new Set),Kt(this,"freezedProducingTransportIds",new Set),Kt(this,"freezedConsumingTransportIds",new Set),Kt(this,"screenShareProducers",new Set),Kt(this,"screenShareConsumers",new Set),Kt(this,"ipDetails"),Kt(this,"callStatsInstance"),this.observer=new Rr}registerProducer(e){return tr(this,null,(function*(){yield this.generateProducerStreamMap(e),e.observer.on("close",this.deregisterProducer.bind(this,e)),e.observer.on("pause",this.pauseProducer.bind(this,e.id)),e.observer.on("resume",this.resumeProducer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareProducers.add(e.id)}))}pauseProducer(e){this.pausedProducerMap.set(e,{lastReportCalculated:!1})}resumeProducer(e){this.pausedProducerMap.delete(e)}processInboundConsumerVideoStats(e,t,r){var i,n;const s=(null==(n=null==(i=null==this?void 0:this.callStatsInstance)?void 0:i.consumerSharedMediaStatesMap)?void 0:n.get(e))||{};t.totalVideoPacketsReceived===r.packetsReceived?(this.consumerIdsWithFreezedVideo.add(e),this.callStatsInstance&&s.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoFreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_video_status","pause",e))):(t.totalVideoPacketsReceived=r.packetsReceived,this.consumerIdsWithFreezedVideo.has(e)&&(this.consumerIdsWithFreezedVideo.delete(e),this.callStatsInstance&&s.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoDefreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_video_status","resume",e))))}processInboundConsumerAudioStats(e,t,r){var i,n;const s=(null==(n=null==(i=null==this?void 0:this.callStatsInstance)?void 0:i.consumerSharedMediaStatesMap)?void 0:n.get(e))||{};t.totalAudioPacketsReceived===r.packetsReceived?(this.consumerIdsWithFreezedAudio.add(e),this.callStatsInstance&&s.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioFreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","pause",e))):(t.totalAudioPacketsReceived=r.packetsReceived,this.consumerIdsWithFreezedAudio.has(e)&&(this.consumerIdsWithFreezedAudio.delete(e),this.callStatsInstance&&s.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioDefreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","resume",e))))}processOutboundProducerVideoStats(e,t,r){var i;const n=(null==(i=null==this?void 0:this.callStatsInstance)?void 0:i.currentUserMediaStates)||{};t.totalVideoPacketsSent===r.packetsSent?(this.producerIdsWithFreezedVideo.add(e),this.callStatsInstance&&n.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoFreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_video_status","pause",e))):(t.totalVideoPacketsSent=r.packetsSent,this.producerIdsWithFreezedVideo.has(e)&&(this.producerIdsWithFreezedVideo.delete(e),this.callStatsInstance&&n.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoDefreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_video_status","resume",e))))}processOutboundProducerAudioStats(e,t,r){var i;const n=(null==(i=null==this?void 0:this.callStatsInstance)?void 0:i.currentUserMediaStates)||{};t.totalAudioPacketsSent===r.packetsSent?(this.producerIdsWithFreezedAudio.add(e),this.callStatsInstance&&n.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioFreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_audio_status","pause",e))):(t.totalAudioPacketsSent=r.packetsSent,this.producerIdsWithFreezedAudio.has(e)&&(this.producerIdsWithFreezedAudio.delete(e),this.callStatsInstance&&n.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioDefreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_audio_status","resume",e))))}processProducingTransportStats(e,t,r){var i;const n=(null==(i=null==this?void 0:this.callStatsInstance)?void 0:i.currentUserMediaStates)||{},{audio:s,video:o,screen:a}=n,c=s||o||a;t.totalPacketsSent===r.packetsSent?(this.freezedProducingTransportIds.add(e),this.callStatsInstance&&c&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportFreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("producing_transport_status","pause",e))):(t.totalPacketsSent=r.packetsSent,this.freezedProducingTransportIds.has(e)&&(this.freezedProducingTransportIds.delete(e),this.callStatsInstance&&c&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportDefreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("producing_transport_status","resume",e))))}processConsumingTransportStats(e,t,r){var i,n;const s=!!Array.from((null==(n=null==(i=null==this?void 0:this.callStatsInstance)?void 0:i.consumerSharedMediaStatesMap)?void 0:n.values())||[]).reduce(((e,t)=>e||t.audio||t.video||t.screen),!1);t.totalPacketsReceived===r.packetsSent?(this.freezedConsumingTransportIds.add(e),this.callStatsInstance&&s&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportFreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","pause",e))):(t.totalPacketsReceived=r.packetsSent,this.freezedConsumingTransportIds.has(e)&&(this.freezedConsumingTransportIds.delete(e),this.callStatsInstance&&s&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportDefreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","resume",e))))}registerConsumer(e){return tr(this,null,(function*(){yield this.generateConsumerStreamMap(e),this.consumerPeerIdMap.set(e.id,{producerId:e.producerId,peerId:e.appData.peerId,appData:e.appData}),e.observer.on("close",this.deregisterConsumer.bind(this,e)),e.observer.on("pause",this.pauseConsumer.bind(this,e.id)),e.observer.on("resume",this.resumeConsumer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareConsumers.add(e.id)}))}pauseConsumer(e){this.pausedConsumerMap.set(e,{lastReportCalculated:!1})}resumeConsumer(e){this.pausedConsumerMap.delete(e)}generateProducerStreamMap(e,t=!1){return tr(this,null,(function*(){const r=yield e.getStats(),i=t?this.getProducerStatsFromReport(this.parseRTCReport(r,["outbound-rtp","remote-inbound-rtp"],!1,e.id))[0]:void 0;for(const t of r.values())"outbound-rtp"===t.type&&this.outboundProducerMap.set(t.id,e.id);return i}))}generateConsumerStreamMap(e,t=!1){return tr(this,null,(function*(){const r=yield e.getStats(),i=t?this.getConsumerStatsFromReport(this.parseRTCReport(r,["inbound-rtp"],!1,e.id))[0]:void 0;for(const t of r.values())"inbound-rtp"===t.type&&this.inboundConsumerMap.set(t.id,e.id);return i}))}deregisterProducer(e){this.outboundProducerMap.forEach(((t,r)=>{t===e.id&&this.outboundProducerMap.delete(r)})),this.pausedProducerMap.delete(e.id),this.screenShareProducers.delete(e.id)}deregisterConsumer(e){this.inboundConsumerMap.forEach(((t,r)=>{t===e.id&&this.inboundConsumerMap.delete(r)})),this.consumerPeerIdMap.delete(e.id),this.pausedConsumerMap.delete(e.id),this.screenShareConsumers.delete(e.id)}getIceCandidateStats(e){var t;return{id:e.id,type:e.candidateType||e.type,address:e.address,port:e.port,url:e.url,protocol:null!=(t=e.relayProtocol)?t:e.protocol,networkType:e.networkType,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort}}getWorkingSimulcastVideoStats(e){return e.find((e=>{const t=e.framesEncoded>0,r=e.packetsSent>0,i=e.frameWidth&&e.frameHeight;return t&&r&&!!i}))||e[e.length-1]}parseRTCReport(e,t=[],r=!1,i=void 0,n=void 0){var s,o,a,c,d,l,u;const p=e,h=new ii,m=t.length?new Set(t):void 0,f=[],g=[],v=[],y=new Map,_=new Map;for(const e of p.values()){if(m){if(0===m.size)break;if(!m.has(e.type))continue;r&&m.delete(e.type)}switch(e.type){case"local-candidate":f.push(this.getIceCandidateStats(e));break;case"remote-candidate":g.push(this.getIceCandidateStats(e));break;case"candidate-pair":{const{nominated:t}=e,{selected:r}=e,i=e,n={nominated:null!=t?t:r,currentRoundTripTime:i.currentRoundTripTime,totalRoundTripTime:i.totalRoundTripTime,bytesReceived:i.bytesReceived,bytesSent:i.bytesSent,availableOutgoingBitrate:i.availableOutgoingBitrate,lastPacketReceivedTimestamp:i.lastPacketReceivedTimestamp,lastPacketSentTimestamp:i.lastPacketSentTimestamp,localCandidateId:i.localCandidateId,remoteCandidateId:i.remoteCandidateId,bytesDiscardedOnSend:i.bytesDiscardedOnSend,packetsSent:i.packetsSent,packetsReceived:i.packetsReceived,packetsDiscardedOnSend:i.packetsDiscardedOnSend};v.push(n),(!0===e.nominated||!0===e.selected)&&(h.candidatePair=n);break}case"transport":{const t=e;n&&(n.producing&&(this.overallProducingTransportsStatsMap[n.id]||(this.overallProducingTransportsStatsMap[n.id]={totalPacketsSent:0})),n.consuming&&(this.overallConsumingTransportsStatsMap[n.id]||(this.overallConsumingTransportsStatsMap[n.id]={totalPacketsReceived:0})));const r={bytesReceived:t.bytesReceived,bytesSent:t.bytesSent,packetsSent:t.packetsSent,packetsReceived:t.packetsReceived,dtlsCipher:t.dtlsCipher,dtlsState:t.dtlsState,iceRole:t.iceRole};if(h.transport=r,n){if(n.producing){const e=this.overallProducingTransportsStatsMap[n.id];this.processProducingTransportStats(n.id,e,r)}if(n.consuming){const e=this.overallConsumingTransportsStatsMap[n.id];this.processConsumingTransportStats(n.id,e,r)}}break}case"remote-inbound-rtp":{const t=e,r={jitter:t.jitter,fractionLost:t.fractionLost,roundTripTime:t.roundTripTime,roundTripTimeMeasurements:t.roundTripTimeMeasurements,totalRoundTripTime:t.totalRoundTripTime,packetsLost:t.packetsLost};h.remoteInboundRtp.set(t.localId,r);break}case"outbound-rtp":{const t=e,r=i||this.outboundProducerMap.get(e.id),n=this.pausedProducerMap.get(r);if(n){if(!0===n.lastReportCalculated)break;this.pausedProducerMap.set(r,{lastReportCalculated:!0})}this.overallProducersStatsMap[r]||(this.overallProducersStatsMap[r]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const o=this.overallProducersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.outboundProducerMap.has(e.id)){h.staleProducerStreamMap=!0;break}const i=this.callStatsInstance.producers.get(r);if("ended"===(null==(s=null==i?void 0:i.track)?void 0:s.readyState))break;h.producerStreamMap.has(r)||h.producerStreamMap.set(r,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const n={bytesSent:t.bytesSent,packetsSent:t.packetsSent,nackCount:t.nackCount,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const i=t,s=qt({frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesEncoded:i.framesEncoded,framesDropped:i.framesDropped,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,keyFramesEncoded:i.keyFramesEncoded,firCount:i.firCount,encoderImplementation:i.encoderImplementation,hugeFramesSent:i.hugeFramesSent,pliCount:i.pliCount,qpSum:i.qpSum,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,totalEncodeTime:i.targetBitrate,totalPacketSendDelay:i.totalPacketSendDelay,retransmittedBytesSent:i.retransmittedBytesSent,retransmittedPacketsSent:i.retransmittedPacketsSent},n);this.videoProducerToStatsMap.set(r,s),h.outboundVideoRtp.set(e.id,s),h.producerStreamMap.get(r).outboundVideoRtpId.push(e.id),this.processOutboundProducerVideoStats(r,o,s)}else if("audio"===t.mediaType||"audio"===t.kind){const i=t,s=qt({retransmittedBytesSent:i.retransmittedBytesSent,retransmittedPacketsSent:i.retransmittedPacketsSent},n);this.audioProducerToStatsMap.set(r,s),h.outboundAudioRtp.set(e.id,s),h.producerStreamMap.get(r).outboundAudioRtpId.push(e.id),this.processOutboundProducerAudioStats(r,o,s)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}case"inbound-rtp":{const t=e,r=i||this.inboundConsumerMap.get(e.id),n=this.pausedConsumerMap.get(r);if(n){if(!0===n.lastReportCalculated)break;this.pausedConsumerMap.set(r,{lastReportCalculated:!0})}if(1234===t.ssrc)break;this.overallConsumersStatsMap[r]||(this.overallConsumersStatsMap[r]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const s=this.overallConsumersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.inboundConsumerMap.has(e.id)){h.staleConsumerStreamMap=!0;break}h.consumerStreamMap.has(r)||h.consumerStreamMap.set(r,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const i={bytesReceived:t.bytesReceived,packetsReceived:t.packetsReceived,packetsLost:t.packetsLost,jitter:t.jitter,nackCount:t.nackCount,jitterBufferDelay:t.jitterBufferDelay,jitterBufferEmittedCount:t.jitterBufferEmittedCount,lastPacketReceivedTimestamp:t.lastPacketReceivedTimestamp,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const n=t,d=qt({frameHeight:n.frameHeight,frameWidth:n.frameWidth,framesDecoded:n.framesDecoded,framesDropped:n.framesDropped,framesPerSecond:n.framesPerSecond,framesReceived:n.framesReceived,keyFramesDecoded:n.keyFramesDecoded,firCount:n.firCount,decoderImplementation:n.decoderImplementation,pliCount:n.pliCount,totalProcessingDelay:n.totalProcessingDelay},i);d.score=qr({frameWidth:d.frameWidth||0,framesDecoded:(d.framesDecoded||0)-((null==(o=this.videoConsumerToStatsMap.get(r))?void 0:o.framesDecoded)||0),framesPerSecond:d.framesPerSecond||0,packetsLost:(d.packetsLost||0)-((null==(a=this.videoConsumerToStatsMap.get(r))?void 0:a.packetsLost)||0),packetsReceived:(d.packetsReceived||0)-((null==(c=this.videoConsumerToStatsMap.get(r))?void 0:c.packetsReceived)||0),jitter:d.jitter||0,isScreenShare:this.screenShareConsumers.has(r)}),_.set(r,d.score),this.videoConsumerToStatsMap.set(r,d),h.inboundVideoRtp.set(e.id,d),h.consumerStreamMap.get(r).inboundVideoRtpId.push(e.id),this.processInboundConsumerVideoStats(r,s,d)}else if("audio"===t.mediaType||"audio"===t.kind){const n=t,o=qt({audioLevel:n.audioLevel,concealedSampels:n.concealedSampels,concealmentEvents:n.concealmentEvents,totalAudioEnergy:n.totalAudioEnergy,totalSamplesDuration:n.totalSamplesDuration,totalSamplesReceived:n.totalSamplesReceived},i);o.score=$r({concealmentEvents:(o.concealmentEvents||0)-((null==(d=this.audioConsumerToStatsMap.get(r))?void 0:d.concealmentEvents)||0),packetsLost:(o.packetsLost||0)-((null==(l=this.audioConsumerToStatsMap.get(r))?void 0:l.packetsLost)||0),packetsReceived:(o.packetsReceived||0)-((null==(u=this.audioConsumerToStatsMap.get(r))?void 0:u.packetsReceived)||0),jitter:o.jitter||0}),_.set(r,o.score),this.audioConsumerToStatsMap.set(r,o),h.inboundAudioRtp.set(e.id,o),h.consumerStreamMap.get(r).inboundAudioRtpId.push(e.id),this.processInboundConsumerAudioStats(r,s,o)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}}}if(h.producerStreamMap.forEach(((e,t)=>{var r,i,n,s,o,a,c,d,l,u,p;if(e.outboundVideoRtpId.length>0){const c=[];e.outboundVideoRtpId.forEach((e=>{c.push(h.outboundVideoRtp.get(e))}));const d=this.getWorkingSimulcastVideoStats(c);d.score=Hr({frameWidth:d.frameWidth||0,framesPerSecond:d.framesPerSecond||0,jitter:(null==(r=d.remoteData)?void 0:r.jitter)||0,isScreenShare:this.screenShareProducers.has(t),packetsSent:(d.packetsSent||0)-((null==(i=this.videoProducerToStatsMap.get(t))?void 0:i.packetsSent)||0),packetsLost:((null==(n=d.remoteData)?void 0:n.packetsLost)||0)-((null==(o=null==(s=this.videoProducerToStatsMap.get(t))?void 0:s.remoteData)?void 0:o.packetsLost)||0),framesEncoded:(d.framesEncoded||0)-((null==(a=this.videoProducerToStatsMap.get(t))?void 0:a.framesEncoded)||0)}),y.set(t,d.score)}else if(e.outboundAudioRtpId.length>0){const r=h.outboundAudioRtp.get(e.outboundAudioRtpId[0]);r.score=Wr({packetsSent:(r.packetsSent||0)-((null==(c=this.audioProducerToStatsMap.get(t))?void 0:c.packetsSent)||0),packetsLost:((null==(d=r.remoteData)?void 0:d.packetsLost)||0)-((null==(u=null==(l=this.audioProducerToStatsMap.get(t))?void 0:l.remoteData)?void 0:u.packetsLost)||0),jitter:(null==(p=r.remoteData)?void 0:p.jitter)||0}),y.set(t,r.score)}})),v.forEach((e=>{const t=f.find((t=>t.id===e.localCandidateId?(e.localCandidateId=t.id,t):null)),r=g.find((t=>t.id===e.remoteCandidateId?(e.remoteCandidateId=t.id,t):null));t&&(e.localCandidateType=t.type,e.localCandidateAddress=t.address,e.localCandidatePort=t.port,e.localCandidateProtocol=t.protocol,e.localCandidateUrl=t.url,e.localCandidateNetworkType=t.networkType,e.localCandidateRelatedAddress=t.relatedAddress,e.localCandidateRelatedPort=t.relatedPort),r&&(e.remoteCandidateType=r.type,e.remoteCandidateAddress=r.address,e.remoteCandidatePort=r.port,e.remoteCandidateProtocol=r.protocol,e.remoteCandidateUrl=r.url)})),h.candidatePair&&(h.transport?(h.transport.totalRoundTripTime=h.candidatePair.totalRoundTripTime,h.transport.availableOutgoingBitrate=h.candidatePair.availableOutgoingBitrate,h.transport.roundTripTime=h.candidatePair.currentRoundTripTime):h.transport={bytesReceived:h.candidatePair.bytesReceived,bytesSent:h.candidatePair.bytesSent,totalRoundTripTime:h.candidatePair.totalRoundTripTime,availableOutgoingBitrate:h.candidatePair.availableOutgoingBitrate,roundTripTime:h.candidatePair.currentRoundTripTime}),h.transport&&(h.transport.candidatePairs=v),h.transport&&!h.transport.roundTripTime){let e=0,t=0;h.remoteInboundRtp.forEach(((r,i)=>{r.roundTripTime&&r.roundTripTime>e&&(e=r.roundTripTime,t=r.totalRoundTripTime)})),h.transport.roundTripTime=e,h.transport.totalRoundTripTime=t}return _.size>0&&this.observer.safeEmit("consumer_score",_),y.size>0&&this.observer.safeEmit("producer_score",y),h}getProducersReport(e){return tr(this,null,(function*(){const t=e.map((e=>this.generateProducerStreamMap(e,!0)));return t.length>0?Promise.all(t):void 0}))}getConsumersReport(e){return tr(this,null,(function*(){const t=e.map((e=>this.generateConsumerStreamMap(e,!0)));return t.length>0?Promise.all(t):void 0}))}getTransportReport(e){return tr(this,null,(function*(){return e.getStats()}))}getProcessedStats(e,t,r){return tr(this,null,(function*(){const i=yield this.getTransportReport(e),n={producing:r,consuming:t,id:e.id},s=i,o=this.parseRTCReport(s,["transport","candidate-pair","inbound-rtp","outbound-rtp","remote-inbound-rtp","local-candidate","remote-candidate"],!1,void 0,n);if(o)return{transportReport:{stats:o.transport,transportId:e.id,consuming:t,producing:r},producerReport:o.staleProducerStreamMap?void 0:this.getProducerStatsFromReport(o),consumerReport:o.staleConsumerStreamMap?void 0:this.getConsumerStatsFromReport(o)}}))}getProducerStatsFromReport(e){const t=[];try{e.producerStreamMap.forEach(((r,i)=>{var n,s;t.push({producerId:i,videoStats:r.outboundVideoRtpId.map((t=>e.outboundVideoRtp.get(t))),audioStats:r.outboundAudioRtpId.map((t=>e.outboundAudioRtp.get(t))),appData:(null==(s=null==(n=this.callStatsInstance.producers)?void 0:n.get(i))?void 0:s.appData)||null})}))}catch(e){this.callStatsInstance.logger.error("callStats::measurements::getProducerStatsFromReport",{error:{reason:e.reason,message:e.message}})}return t}getConsumerStatsFromReport(e){const t=[];try{e.consumerStreamMap.forEach(((r,i)=>{const{peerId:n,producerId:s,appData:o}=this.consumerPeerIdMap.get(i);t.push({consumerId:i,peerId:n,producerId:s,appData:o,videoStats:r.inboundVideoRtpId.map((t=>e.inboundVideoRtp.get(t))),audioStats:r.inboundAudioRtpId.map((t=>e.inboundAudioRtp.get(t)))})}))}catch(t){console.error("getConsumersReport: ",t,e)}return t}getUserLocation(){return tr(this,null,(function*(){return new Promise(((e,t)=>{try{navigator.geolocation?navigator.geolocation.getCurrentPosition((t=>{e(t)})):t()}catch(e){t(e)}}))}))}getConnectivity(e){return tr(this,null,(function*(){try{const t={iceServers:e||ti},r=new Promise(((e,r)=>{try{const r=new Qr(t);r.addListener("done",e),r.addListener("failed",(()=>{e({connectivity:!1})})),r.start(2e3)}catch(e){r(e)}})),i=new Promise(((e,r)=>{try{const r=new Xr(t);r.addListener("done",e),r.addListener("failed",(()=>{e({connectivity:!1})})),r.start(2e3)}catch(e){r(e)}})),n=new Promise(((e,r)=>{try{const r=new Zr(t);r.addListener("done",e),r.addListener("failed",(()=>{e({connectivity:!1})})),r.start(2e3)}catch(e){r(e)}})),[s,o,a]=yield Promise.all([r,i,n]);return{host:null==s?void 0:s.connectivity,relay:null==o?void 0:o.connectivity,reflexive:null==a?void 0:a.connectivity}}catch(e){return{host:!1,relay:!1,reflexive:!1}}}))}getThroughput(e){return tr(this,null,(function*(){try{const t=yield new Promise(((t,r)=>{try{const i=new Kr({iceServers:e||ti});i.addListener("done",t),i.addListener("failed",r),i.start(1e4)}catch(e){r(e)}}));return{throughput:t.throughput,fractionalLoss:0,RTT:t.RTT,jitter:0,backendRTT:t.backendRTT}}catch(e){return}}))}getIPDetails(){return tr(this,null,(function*(){var e,t;try{return this.ipDetails||(this.ipDetails=yield ei.getIPDetails({peerId:null==(e=this.callStatsInstance)?void 0:e.peerId,apiHostnames:null==(t=this.callStatsInstance)?void 0:t.apiHostnames})),this.ipDetails}catch(e){return}}))}getNetworkQuality(e){return tr(this,null,(function*(){const[t,r]=yield Promise.all([this.getConnectivity(e),this.getThroughput(e)]);return{connectivity:t,throughput:null==r?void 0:r.throughput,fractionalLoss:null==r?void 0:r.fractionalLoss,RTT:null==r?void 0:r.RTT,jitter:null==r?void 0:r.jitter,backendRTT:null==r?void 0:r.backendRTT}}))}getNetworkInfo(e,t=!1){return tr(this,null,(function*(){var r,i;if(t){const e=yield this.getIPDetails();return{ipDetails:e,effectiveNetworkType:null==(r=navigator.connection)?void 0:r.effectiveType,location:e.loc?ri(e.loc):void 0}}const[n,s,o]=yield Promise.all([this.getConnectivity(e),this.getThroughput(e),this.getIPDetails()]);return{ipDetails:o,effectiveNetworkType:null==(i=navigator.connection)?void 0:i.effectiveType,location:o.loc?ri(o.loc):void 0,turnConnectivity:!!n&&(n.host||n.relay||n.reflexive),connectivity:n,throughput:null==s?void 0:s.throughput,fractionalLoss:null==s?void 0:s.fractionalLoss,RTT:null==s?void 0:s.RTT,jitter:null==s?void 0:s.jitter,backendRTT:null==s?void 0:s.backendRTT}}))}}class si extends ni{}class oi extends ni{constructor(){super(...arguments),Kt(this,"producerMap",new Map),Kt(this,"consumerMap",new Map)}registerProducer(e){return tr(this,null,(function*(){this.producerMap.set(e.id,e),yield this.generateProducerStreamMap(e),e.observer.on("close",this.deregisterProducer.bind(this,e)),e.observer.on("pause",this.pauseProducer.bind(this,e.id)),e.observer.on("resume",this.resumeProducer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareProducers.add(e.id)}))}registerConsumer(e){return tr(this,null,(function*(){this.consumerMap.set(e.id,e),yield this.generateConsumerStreamMap(e),this.consumerPeerIdMap.set(e.id,{producerId:e.producerId,peerId:e.appData.peerId,appData:e.appData}),e.observer.on("close",this.deregisterConsumer.bind(this,e)),e.observer.on("pause",this.pauseConsumer.bind(this,e.id)),e.observer.on("resume",this.resumeConsumer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareConsumers.add(e.id)}))}generateConsumerStreamMap(e,t=!1){return tr(this,null,(function*(){const r=yield e.getStats(),i=this.parseRTCReport(r,["inbound-rtp"],!1,e.id),n=[...i.consumerStreamMap.values()][0],s=t?this.getConsumerStatsFromParsedConsumerStats(i,n,e.id):void 0;for(const t of r.values())"inbound-rtp"===t.type&&this.inboundConsumerMap.set(t.id,e.id);return s}))}deregisterProducer(e){this.producerMap.delete(e.id),this.outboundProducerMap.forEach(((t,r)=>{t===e.id&&this.outboundProducerMap.delete(r)})),this.pausedProducerMap.delete(e.id),this.screenShareProducers.delete(e.id)}deregisterConsumer(e){this.consumerMap.delete(e.id),this.inboundConsumerMap.forEach(((t,r)=>{t===e.id&&this.inboundConsumerMap.delete(r)})),this.consumerPeerIdMap.delete(e.id),this.pausedConsumerMap.delete(e.id),this.screenShareConsumers.delete(e.id)}getIceCandidateStats(e){var t;return{id:e.id,type:e.candidateType||e.type,address:e.address,port:e.port,url:e.url,protocol:null!=(t=e.relayProtocol)?t:e.protocol,networkType:e.networkType,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort}}parseRTCReport(e,t=[],r=!1,i=void 0,n=void 0){var s,o,a,c,d,l,u;const p=e,h=new ii,m=t.length?new Set(t):void 0,f=[],g=[],v=[],y=new Map,_=new Map;for(const e of p.values()){if(m){if(0===m.size)break;if(!m.has(e.type))continue;r&&m.delete(e.type)}switch(e.type){case"local-candidate":f.push(this.getIceCandidateStats(e));break;case"remote-candidate":g.push(this.getIceCandidateStats(e));break;case"candidate-pair":{const{nominated:t}=e,{selected:r}=e,i=e,n={nominated:null!=t?t:r,currentRoundTripTime:i.currentRoundTripTime,totalRoundTripTime:i.totalRoundTripTime,bytesReceived:i.bytesReceived,bytesSent:i.bytesSent,availableOutgoingBitrate:i.availableOutgoingBitrate,lastPacketReceivedTimestamp:i.lastPacketReceivedTimestamp,lastPacketSentTimestamp:i.lastPacketSentTimestamp,localCandidateId:i.localCandidateId,remoteCandidateId:i.remoteCandidateId,bytesDiscardedOnSend:i.bytesDiscardedOnSend,packetsSent:i.packetsSent,packetsReceived:i.packetsReceived,packetsDiscardedOnSend:i.packetsDiscardedOnSend};v.push(n),(!0===e.nominated||!0===e.selected)&&(h.candidatePair=n);break}case"transport":{const t=e;n&&(n.producing&&(this.overallProducingTransportsStatsMap[n.id]||(this.overallProducingTransportsStatsMap[n.id]={totalPacketsSent:0})),n.consuming&&(this.overallConsumingTransportsStatsMap[n.id]||(this.overallConsumingTransportsStatsMap[n.id]={totalPacketsReceived:0})));const r={bytesReceived:t.bytesReceived,bytesSent:t.bytesSent,packetsSent:t.packetsSent,packetsReceived:t.packetsReceived,dtlsCipher:t.dtlsCipher,dtlsState:t.dtlsState,iceRole:t.iceRole};if(h.transport=r,n){if(n.producing){const e=this.overallProducingTransportsStatsMap[n.id];this.processProducingTransportStats(n.id,e,r)}if(n.consuming){const e=this.overallConsumingTransportsStatsMap[n.id];this.processConsumingTransportStats(n.id,e,r)}}break}case"remote-inbound-rtp":{const t=e,r={jitter:t.jitter,fractionLost:t.fractionLost,roundTripTime:t.roundTripTime,roundTripTimeMeasurements:t.roundTripTimeMeasurements,totalRoundTripTime:t.totalRoundTripTime,packetsLost:t.packetsLost};h.remoteInboundRtp.set(t.localId,r);break}case"outbound-rtp":{const t=e,r=i||this.outboundProducerMap.get(e.id),n=this.pausedProducerMap.get(r);if(n){if(!0===n.lastReportCalculated)break;this.pausedProducerMap.set(r,{lastReportCalculated:!0})}this.overallProducersStatsMap[r]||(this.overallProducersStatsMap[r]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const o=this.overallProducersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.outboundProducerMap.has(e.id)){h.staleProducerStreamMap=!0;break}const i=this.callStatsInstance.producers.get(r);if("ended"===(null==(s=null==i?void 0:i.track)?void 0:s.readyState))break;h.producerStreamMap.has(r)||h.producerStreamMap.set(r,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const n={bytesSent:t.bytesSent,packetsSent:t.packetsSent,nackCount:t.nackCount,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const i=t,s=qt({frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesEncoded:i.framesEncoded,framesDropped:i.framesDropped?i.framesDropped:i.droppedFrames,framesPerSecond:i.framesPerSecond?i.framesPerSecond:i.framerateMean,framesSent:i.framesSent,keyFramesEncoded:i.keyFramesEncoded,firCount:i.firCount,encoderImplementation:i.encoderImplementation,hugeFramesSent:i.hugeFramesSent,pliCount:i.pliCount,qpSum:i.qpSum,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,totalEncodeTime:i.totalEncodeTime,totalPacketSendDelay:i.totalEncodeTime,retransmittedBytesSent:i.retransmittedBytesSent,retransmittedPacketsSent:i.retransmittedPacketsSent},n);this.videoProducerToStatsMap.set(e.id,s),h.outboundVideoRtp.set(e.id,s),h.producerStreamMap.get(r).outboundVideoRtpId.push(e.id),this.processOutboundProducerVideoStats(r,o,s)}else if("audio"===t.mediaType||"audio"===t.kind){const i=t,s=qt({retransmittedBytesSent:i.retransmittedBytesSent,retransmittedPacketsSent:i.retransmittedPacketsSent},n);this.audioProducerToStatsMap.set(e.id,s),h.outboundAudioRtp.set(e.id,s),h.producerStreamMap.get(r).outboundAudioRtpId.push(e.id),this.processOutboundProducerAudioStats(r,o,s)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}case"inbound-rtp":{const t=e,r=i||this.inboundConsumerMap.get(e.id),n=this.pausedConsumerMap.get(r);if(n){if(!0===n.lastReportCalculated)break;this.pausedConsumerMap.set(r,{lastReportCalculated:!0})}if(1234===t.ssrc)break;this.overallConsumersStatsMap[r]||(this.overallConsumersStatsMap[r]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const s=this.overallConsumersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.inboundConsumerMap.has(e.id)){h.staleConsumerStreamMap=!0;break}h.consumerStreamMap.has(r)||h.consumerStreamMap.set(r,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const i={bytesReceived:t.bytesReceived,packetsReceived:t.packetsReceived,packetsLost:t.packetsLost,jitter:t.jitter,nackCount:t.nackCount,jitterBufferDelay:t.jitterBufferDelay,jitterBufferEmittedCount:t.jitterBufferEmittedCount,lastPacketReceivedTimestamp:t.lastPacketReceivedTimestamp,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const n=t,d=qt({frameHeight:n.frameHeight,frameWidth:n.frameWidth,framesDecoded:n.framesDecoded,framesDropped:n.framesDropped?n.framesDropped:n.droppedFrames,framesPerSecond:n.framesPerSecond?n.framesPerSecond:n.framerateMean,framesReceived:n.framesReceived,keyFramesDecoded:n.keyFramesDecoded,firCount:n.firCount,decoderImplementation:n.decoderImplementation,pliCount:n.pliCount,totalProcessingDelay:n.totalProcessingDelay},i);d.score=qr({frameWidth:d.frameWidth||0,framesDecoded:(d.framesDecoded||0)-((null==(o=this.videoConsumerToStatsMap.get(r))?void 0:o.framesDecoded)||0),framesPerSecond:d.framesPerSecond||0,packetsLost:(d.packetsLost||0)-((null==(a=this.videoConsumerToStatsMap.get(r))?void 0:a.packetsLost)||0),packetsReceived:(d.packetsReceived||0)-((null==(c=this.videoConsumerToStatsMap.get(r))?void 0:c.packetsReceived)||0),jitter:d.jitter||0,isScreenShare:this.screenShareConsumers.has(r)}),_.set(r,d.score),this.videoConsumerToStatsMap.set(r,d),h.inboundVideoRtp.set(e.id,d),h.consumerStreamMap.get(r).inboundVideoRtpId.push(e.id),this.processInboundConsumerVideoStats(r,s,d)}else if("audio"===t.mediaType||"audio"===t.kind){const n=t,o=qt({audioLevel:n.audioLevel,concealedSampels:n.concealedSampels,concealmentEvents:n.concealmentEvents,totalAudioEnergy:n.totalAudioEnergy,totalSamplesDuration:n.totalSamplesDuration,totalSamplesReceived:n.totalSamplesReceived},i);o.score=$r({concealmentEvents:(o.concealmentEvents||0)-((null==(d=this.audioConsumerToStatsMap.get(r))?void 0:d.concealmentEvents)||0),packetsLost:(o.packetsLost||0)-((null==(l=this.audioConsumerToStatsMap.get(r))?void 0:l.packetsLost)||0),packetsReceived:(o.packetsReceived||0)-((null==(u=this.audioConsumerToStatsMap.get(r))?void 0:u.packetsReceived)||0),jitter:o.jitter||0}),_.set(r,o.score),this.audioConsumerToStatsMap.set(r,o),h.inboundAudioRtp.set(e.id,o),h.consumerStreamMap.get(r).inboundAudioRtpId.push(e.id),this.processInboundConsumerAudioStats(r,s,o)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}}}if(h.producerStreamMap.forEach(((e,t)=>{var r,i,n,s,o,a,c,d,l,u,p;if(e.outboundVideoRtpId.length>0){const c=[];e.outboundVideoRtpId.forEach((e=>{c.push(h.outboundVideoRtp.get(e))}));const d=this.getWorkingSimulcastVideoStats(c);d.score=Hr({frameWidth:d.frameWidth||0,framesPerSecond:d.framesPerSecond||0,jitter:(null==(r=d.remoteData)?void 0:r.jitter)||0,isScreenShare:this.screenShareProducers.has(t),packetsSent:(d.packetsSent||0)-((null==(i=this.videoProducerToStatsMap.get(t))?void 0:i.packetsSent)||0),packetsLost:((null==(n=d.remoteData)?void 0:n.packetsLost)||0)-((null==(o=null==(s=this.videoProducerToStatsMap.get(t))?void 0:s.remoteData)?void 0:o.packetsLost)||0),framesEncoded:(d.framesEncoded||0)-((null==(a=this.videoProducerToStatsMap.get(t))?void 0:a.framesEncoded)||0)}),y.set(t,d.score)}else if(e.outboundAudioRtpId.length>0){const r=h.outboundAudioRtp.get(e.outboundAudioRtpId[0]);r.score=Wr({packetsSent:(r.packetsSent||0)-((null==(c=this.audioProducerToStatsMap.get(t))?void 0:c.packetsSent)||0),packetsLost:((null==(d=r.remoteData)?void 0:d.packetsLost)||0)-((null==(u=null==(l=this.audioProducerToStatsMap.get(t))?void 0:l.remoteData)?void 0:u.packetsLost)||0),jitter:(null==(p=r.remoteData)?void 0:p.jitter)||0}),y.set(t,r.score)}})),v.forEach((e=>{const t=f.find((t=>t.id===e.localCandidateId?(e.localCandidateId=t.id,t):null)),r=g.find((t=>t.id===e.remoteCandidateId?(e.remoteCandidateId=t.id,t):null));t&&(e.localCandidateType=t.type,e.localCandidateAddress=t.address,e.localCandidatePort=t.port,e.localCandidateProtocol=t.protocol,e.localCandidateUrl=t.url,e.localCandidateNetworkType=t.networkType,e.localCandidateRelatedAddress=t.relatedAddress,e.localCandidateRelatedPort=t.relatedPort),r&&(e.remoteCandidateType=r.type,e.remoteCandidateAddress=r.address,e.remoteCandidatePort=r.port,e.remoteCandidateProtocol=r.protocol,e.remoteCandidateUrl=r.url)})),h.candidatePair&&(h.transport?(h.transport.bytesReceived=h.candidatePair.bytesReceived,h.transport.bytesSent=h.candidatePair.bytesSent,h.transport.totalRoundTripTime=h.candidatePair.totalRoundTripTime,h.transport.availableOutgoingBitrate=h.candidatePair.availableOutgoingBitrate,h.transport.roundTripTime=h.candidatePair.currentRoundTripTime):h.transport={bytesReceived:h.candidatePair.bytesReceived,bytesSent:h.candidatePair.bytesSent,totalRoundTripTime:h.candidatePair.totalRoundTripTime,availableOutgoingBitrate:h.candidatePair.availableOutgoingBitrate,roundTripTime:h.candidatePair.currentRoundTripTime}),h.transport&&(h.transport.candidatePairs=v),h.transport&&!h.transport.roundTripTime){let e=0,t=0;h.remoteInboundRtp.forEach(((r,i)=>{r.roundTripTime&&r.roundTripTime>e&&(e=r.roundTripTime,t=r.totalRoundTripTime)})),h.transport.roundTripTime=e,h.transport.totalRoundTripTime=t}return _.size>0&&this.observer.safeEmit("consumer_score",_),y.size>0&&this.observer.safeEmit("producer_score",y),h}getProducerStatsFromReport(e){const t=[];try{e.producerStreamMap.forEach(((r,i)=>{const n=this.producerMap.get(i),s=n.track.getSettings(),o=r.outboundVideoRtpId.map((t=>{const r=e.outboundVideoRtp.get(t);return r.frameHeight||(r.frameHeight=s.height,r.frameWidth=s.width,r.framesPerSecond=s.frameRate),r})),a={producerId:i,appData:n.appData,videoStats:o,audioStats:r.outboundAudioRtpId.map((t=>e.outboundAudioRtp.get(t)))};t.push(a)}))}catch(t){console.error("getProducersReport: ",t,e)}return t}getConsumerStatsFromParsedConsumerStats(e,t,r){let i;try{const{peerId:n,producerId:s,appData:o}=this.consumerPeerIdMap.get(r),a=null==t?void 0:t.inboundVideoRtpId.map((t=>{const i=this.consumerMap.get(r).track.getSettings(),n=e.inboundVideoRtp.get(t);return n.frameHeight||(n.frameHeight=i.height,n.frameWidth=i.width,n.framesPerSecond=i.frameRate),n}));i={consumerId:r,peerId:n,producerId:s,appData:o,videoStats:a,audioStats:null==t?void 0:t.inboundAudioRtpId.map((t=>e.inboundAudioRtp.get(t)))}}catch(t){console.error("getConsumerStatsFromParsedConsumerStats: ",t,e)}return i}getConsumerStatsFromReport(e){const t=[];try{e.consumerStreamMap.forEach(((r,i)=>{t.push(this.getConsumerStatsFromParsedConsumerStats(e,r,i))}))}catch(t){console.error("getConsumerStatsFromReport: ",t,e)}return t}}class ai extends oi{}function ci(e,t,r,i){if(null!=e&&e.logger&&e.logger.error("Callstats::handleError",{error:i}),!("function"==typeof r&&i instanceof t))throw i;r.call(null,i,e)}function di(e,t,r){const i=e.value;return e.value=function(...e){try{const n=i.apply(this,e);return n&&n instanceof Promise?n.catch((e=>{ci(this,t,r,e)})):n}catch(e){ci(this,t,r,e)}return null},e}const li=(e,t)=>(r,i,n)=>{const s=n.value;return n.value=function(...r){try{const i=s.apply(this,r);return i&&i instanceof Promise?i.catch((r=>{ci(this,e,t,r)})):i}catch(r){ci(this,e,t,r)}return null},n};var ui=globalThis&&globalThis.__decorate||function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const pi=console;let hi=class extends Rr{constructor(e="https://api.testingv3.dyte.in",t="Blink",r=Nr,i,n,s,o){switch(super(),Kt(this,"observer"),Kt(this,"eventHandler"),Kt(this,"measurements"),Kt(this,"producingTransport"),Kt(this,"consumingTransport"),Kt(this,"producers",new Map),Kt(this,"consumers",new Map),Kt(this,"iceServers"),Kt(this,"connectionInfoPromise"),Kt(this,"pingStatsTimeout"),Kt(this,"logger"),Kt(this,"env"),Kt(this,"apiHostnames"),Kt(this,"peerId"),Kt(this,"consumerSharedMediaStatesMap",new Map),Kt(this,"currentUserMediaStates",{}),this.env=r,this.apiHostnames=o,this.logger=n,this.peerId=s,this.eventHandler=new Mr({logger:n,peerId:s,apiHostnames:o}),this.logger.debug("callStats::engineName: ",{engineName:t}),t){case"Blink":this.measurements=new si;break;case"Gecko":this.measurements=new oi;break;case"WebKit":this.measurements=new ai;break;default:throw Error(`Unknown engineName! ${t}`)}this.measurements.callStatsInstance=this,this.registerProducer=this.registerProducer.bind(this),this.registerConsumer=this.registerConsumer.bind(this),this.observer=new Rr,this.measurements.observer.on("consumer_score",(e=>{n.debug(`callStats::consumer_score ${[...e.entries()]}`),this.eventHandler.emit("consumer_score",e)})),this.measurements.observer.on("producer_score",(e=>{n.debug(`callStats::producer_score ${[...e.entries()]}`),this.eventHandler.emit("producer_score",e)}))}registerIceServers(e){this.iceServers=e}registerConsumer(e){var t;this.consumerSharedMediaStatesMap.has(e.id)||this.consumerSharedMediaStatesMap.set(e.id,{}),this.consumers.set(e.id,e),this.measurements.registerConsumer(e),this.logger.debug("callStats::registerConsumer",{consumerId:e.id,consumerkind:e.kind,isScreenShare:!(null==(t=e.appData)||!t.screenShare)}),e.observer.on("close",this.deRegisterConsumer.bind(this,e))}registerProducer(e){var t;this.producers.set(e.id,e),this.measurements.registerProducer(e),this.logger.debug("callStats::registerProducer",{producerId:e.id,producerKind:e.kind,isScreenShare:!(null==(t=e.appData)||!t.screenShare)}),e.observer.on("close",this.deRegisterProducer.bind(this,e))}sendConsumerSharedMediaStateEvent(e,t){this.consumerSharedMediaStatesMap.has(e)||this.consumerSharedMediaStatesMap.set(e,{});const r=this.consumerSharedMediaStatesMap.get(e);this.consumerSharedMediaStatesMap.set(e,Object.assign(r,t))}registerProducingTransport(e){var t;this.producingTransport=e,e.observer.on("close",this.disconnectProducingTransport.bind(this,e)),e.observer.on("disconnect",this.disconnectProducingTransport.bind(this,e)),Array.from((null==(t=e._producers)?void 0:t.values())||[]).forEach((e=>{this.registerProducer(e)})),e.observer.on("newproducer",this.registerProducer)}registerConsumingTransport(e){var t;this.consumingTransport=e,e.observer.on("close",this.disconnectConsumingTransport.bind(this,e)),e.observer.on("disconnect",this.disconnectConsumingTransport.bind(this,e)),Array.from((null==(t=e._consumers)?void 0:t.values())||[]).forEach((e=>{this.registerConsumer(e)})),e.observer.on("newconsumer",this.registerConsumer)}deRegisterConsumer(e){this.consumers.delete(e.id)}deRegisterProducer(e){var t;this.producers.delete(e.id),this.logger.debug("callStats::deRegisterProducer",{producerId:e.id,producerKind:e.kind,isScreenShare:!(null==(t=e.appData)||!t.screenShare)})}disconnectConsumingTransport(){this.consumingTransport=void 0}disconnectProducingTransport(){this.producingTransport=void 0}callEvent(e){this.eventHandler.callEvent(e)}sendPreCallTestBeginEvent(e=!1){this.connectionInfoPromise=this.measurements.getNetworkInfo(this.iceServers,e),this.eventHandler.callEvent({event:Ir.PRECALL_TEST_BEGIN,timestamp:new Date}),this.connectionInfoPromise&&this.connectionInfoPromise.then((e=>{this.eventHandler.callEvent({event:Ir.PRECALL_TEST_COMPLETE,metaData:{connectionInfo:e},timestamp:new Date})}))}sendScreenShareToggleEvent(e,t){this.currentUserMediaStates.screen=e,this.eventHandler.callEvent({event:e?Ir.SCREENSHARE_STARTED:Ir.SCREENSHARE_STOPPED,metaData:{ssrc:t},timestamp:new Date})}sendScreenShareRequestedEvent(){this.eventHandler.callEvent({event:Ir.SCREENSHARE_START_REQUESTED,timestamp:new Date})}sendActiveSpeakerEvent(e){this.eventHandler.callEvent({event:Ir.DOMINANT_SPEAKER,metaData:{peerId:e},timestamp:new Date})}devices(e,t){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ir.AUDIO_DEVICES_UPDATES||e===xr.VIDEO&&Ir.VIDEO_DEVICES_UPDATES||e===xr.SPEAKER&&Ir.SPEAKER_DEVICES_UPDATES,metaData:{deviceList:t},timestamp:new Date})}selectedDevice(e,t){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ir.SELECTED_MICROHPONE_UPDATE||e===xr.VIDEO&&Ir.SELECTED_CAMERA_UPDATE||e===xr.SPEAKER&&Ir.SELECTED_SPEAKER_UPDATE,metaData:{device:t},timestamp:new Date})}mediaPermission(e,t){this.eventHandler.callEvent({event:Ir.MEDIA_PERMISSION,metaData:{deviceType:e,permission:t},timestamp:new Date})}mediaPlaybackFailed(e){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ir.AUDIO_PLAY_FAILED||e===xr.VIDEO&&Ir.VIDEO_PLAY_FAILED,metaData:{deviceType:e},timestamp:new Date})}mediaTrackMuted(e){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ir.AUDIO_TRACK_MUTED||e===xr.VIDEO&&Ir.VIDEO_TRACK_MUTED,metaData:{deviceType:e},timestamp:new Date})}tabChanged(e){this.eventHandler.callEvent({event:Ir.TAB_CHANGE,metaData:{isMeetingsTabActive:e},timestamp:new Date})}browserBackgrounded(){this.eventHandler.callEvent({event:Ir.BROWSER_BACKGROUNDED,timestamp:new Date})}browserForegrounded(){this.eventHandler.callEvent({event:Ir.BROWSER_FOREGROUNDED,timestamp:new Date})}legacySwitch(e){this.eventHandler.callEvent({event:Ir.LEGACY_SWITCH,metadata:{on:e},timestamp:new Date})}getPreCallTestResults(){return tr(this,null,(function*(){return this.connectionInfoPromise}))}sendCallJoinBeginEvent(e){(e=zt(qt({},e),{meetingEnv:this.env})).deviceInfo=zt(qt({},e.deviceInfo),{userAgent:navigator.userAgent,cpus:navigator.hardwareConcurrency,memory:navigator.deviceMemory}),this.eventHandler.callEvent({event:Ir.CALL_JOIN_BEGIN,metaData:{peerMetaData:e},timestamp:new Date})}sendNetworkQualityTestBeginEvent(e){this.eventHandler.callEvent({event:Ir.NET_QUALITY_TEST_BEGIN,timestamp:new Date}),new Promise(((t,r)=>tr(this,null,(function*(){const i=[];try{for(const t of e)try{if(t.iceServers&&t.iceServers.length>0){const e=yield this.measurements.getNetworkQuality(t.iceServers);i.push(zt(qt({},t),{networkResults:e}))}}catch(e){console.warn("Error handling ",e)}t({regionData:i})}catch(e){console.warn("Error in callstats, ",e),r(e)}})))).then((e=>{this.eventHandler.callEvent({event:Ir.NET_QUALITY_TEST_END,timestamp:new Date,metaData:e})}))}sendWebSocketConnectedEvent(){this.eventHandler.callEvent({event:Ir.WEBSOCKET_CONNECTED,timestamp:new Date})}sendTransportConnectedEvent(){this.eventHandler.callEvent({event:Ir.TRANSPORT_CONNECTED,timestamp:new Date})}sendAudioToggleEvent(e){let t;this.currentUserMediaStates.audio=e,t=e?Ir.AUDIO_ON:Ir.AUDIO_OFF,this.eventHandler.callEvent({event:t,timestamp:new Date})}sendVideoToggleEvent(e){let t;this.currentUserMediaStates.video=e,t=e?Ir.VIDEO_ON:Ir.VIDEO_OFF,this.eventHandler.callEvent({event:t,timestamp:new Date})}sendParticipantRoleToggleEvent(e){this.eventHandler.callEvent({event:Ir.PARTICIPANT_ROLE,timestamp:new Date,metaData:e})}startPingStats(e=7e3){this.sendPingStatsEvent(!1),this.pingStatsTimeout=setInterval(this.sendPingStatsEvent.bind(this),e)}stopPingStats(){clearInterval(this.pingStatsTimeout)}sendPingStatsEvent(e=!0){return tr(this,null,(function*(){let t,r;if(this.producingTransport&&(t=yield this.measurements.getProcessedStats(this.producingTransport,!1,!0),!t||null==t||!t.producerReport)){this.logger.debug("callStats::sendPingStatsEvent::staleProducingTransport",{disclaimer:"Stale producer? Regenerating Stream Maps!"});const e=yield this.measurements.getProducersReport([...this.producers.values()]);t&&e?t.producerReport=e:(t=yield this.measurements.getProcessedStats(this.producingTransport,!1,!0),(!t||null==t||!t.producerReport)&&this.logger.debug("callStats::sendPingStatsEvent::noProducingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}if(this.consumingTransport&&(r=yield this.measurements.getProcessedStats(this.consumingTransport,!0,!1),!r||!r.consumerReport)){this.logger.debug("callStats::sendPingStatsEvent::staleConsumingTransport",{disclaimer:"Stale consumer? Regenerating Stream Maps!"});const e=yield this.measurements.getConsumersReport([...this.consumers.values()]);r&&e?r.consumerReport=e:(r=yield this.measurements.getProcessedStats(this.consumingTransport,!0,!1),(!r||!r.consumerReport)&&this.logger.debug("callStats::sendPingStatsEvent::noConsumingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}const i={producingTransportStats:t?null==t?void 0:t.transportReport:void 0,consumingTransportStats:r?null==r?void 0:r.transportReport:void 0,producerStats:[].concat((null==t?void 0:t.producerReport)||[]).concat((null==r?void 0:r.producerReport)||[]),consumerStats:[].concat((null==r?void 0:r.consumerReport)||[]).concat((null==t?void 0:t.consumerReport)||[])};e&&0===i.producerStats.length&&0===i.consumerStats.length?yield this.eventHandler.flush():this.eventHandler.callEvent({event:Ir.PING_STAT,metaData:i,timestamp:new Date})}))}sendIVSPlayerRebufferEvent(){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_REBUFFERING,timestamp:new Date})}sendIVSPlayerAudioBlockEvent(){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_AUDIO_BLOCKED,timestamp:new Date})}sendIVSPlayerPlaybackBlockedEvent(){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_PLAYBACK_BLOCKED,timestamp:new Date})}sendIVSPlayerNetworkUnavailableEvent(){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_NETWORK_UNAVAILABLE,timestamp:new Date})}sendIVSPlayerInitializedEvent(){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_INITIALIZED,timestamp:new Date})}sendIVSPlayerWorkerErrorEvent(){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_WORKER_ERROR,timestamp:new Date})}sendIVSPlayerErrorEvent(e){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_ERROR,timestamp:new Date,metaData:e})}sendIVSPlayerRecoverableErrorEvent(e){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_RECOVERABLE_ERROR,timestamp:new Date,metaData:e})}sendIVSPlayerAnalyticsEvent(e){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_ANALYTICS_EVENT,timestamp:new Date,metaData:e})}sendIVSPlayerPlaybackRateChangedEvent(e){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_PLAYBACK_RATE_CHANGED,timestamp:new Date,metaData:{updatedPlaybackRate:e}})}sendIVSPlayerQualityChanged(e){this.eventHandler.callEvent({event:Ir.IVS_PLAYER_QUALITY_CHANGED,timestamp:new Date,metaData:e})}sendPlayerLiveLatency(e){this.eventHandler.callEvent({event:Ir.LIVESTREAM_LATENCY,timestamp:new Date,metaData:{latency:e}})}sendDisconnectEvent(){this.eventHandler.callEvent({event:Ir.DISCONNECT,timestamp:new Date})}sendReconnectEvent(){this.eventHandler.callEvent({event:Ir.RECONNECT_ATTEMPT,timestamp:new Date})}};ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"registerIceServers",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"registerConsumer",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"registerProducer",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendConsumerSharedMediaStateEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"registerProducingTransport",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"registerConsumingTransport",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"deRegisterConsumer",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"deRegisterProducer",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"disconnectConsumingTransport",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"disconnectProducingTransport",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendPreCallTestBeginEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendScreenShareToggleEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendScreenShareRequestedEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendActiveSpeakerEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"devices",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"selectedDevice",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"mediaPermission",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"mediaPlaybackFailed",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"mediaTrackMuted",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"tabChanged",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"browserBackgrounded",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"browserForegrounded",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"legacySwitch",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"getPreCallTestResults",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendCallJoinBeginEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendNetworkQualityTestBeginEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendWebSocketConnectedEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendTransportConnectedEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendAudioToggleEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendVideoToggleEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendParticipantRoleToggleEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"startPingStats",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"stopPingStats",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendPingStatsEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerRebufferEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerAudioBlockEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerPlaybackBlockedEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerNetworkUnavailableEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerInitializedEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerWorkerErrorEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerErrorEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerRecoverableErrorEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerAnalyticsEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerPlaybackRateChangedEvent",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendIVSPlayerQualityChanged",null),ui([li(TypeError,((e,t)=>pi.error(t,e)))],hi.prototype,"sendPlayerLiveLatency",null),hi=ui([((e,t)=>(r,i,n)=>{if(n)return di(n,e,t);for(const i of Reflect.ownKeys(r.prototype).filter((e=>"constructor"!==e))){const n=Object.getOwnPropertyDescriptor(r.prototype,i);n.value instanceof Function&&Object.defineProperty(r.prototype,i,di(n,e,t))}})(TypeError,((e,t)=>pi.error(t,e)))],hi);const mi=hi,fi=new class extends ir{constructor(){super(...arguments),Kt(this,"stats"),Kt(this,"roomURL"),Kt(this,"peerId"),Kt(this,"backend"),Kt(this,"iceServers"),Kt(this,"initialized",!1),Kt(this,"stalled",!1),Kt(this,"ipInformation"),Kt(this,"logger")}initialize(e){return tr(this,arguments,(function*({peerId:e,engineName:t,env:r=Nr,iceServers:i,apiBase:n="https://api.cluster.dyte.in",flags:s,logger:o=console,apiHostnames:a,skipConnectivityChecks:c=!1}){var d,l,u;try{this.peerId=e,this.logger=o,this.ipInformation=yield ei.getIPDetails({peerId:e,apiHostnames:a}),this.backend=new mi(n,t,r,s,o,e,a),this.iceServers=i,null==(d=this.backend)||d.registerIceServers(this.iceServers),this.initialized=!0,null==(u=null==(l=this.backend)?void 0:l.eventHandler)||u.emit("initialized",this.ipInformation),this.emit("initialized",this.ipInformation),this.startPreCallTest(c)}catch(e){this.logger.error("callStats::CallStatsIntegration: ",{error:e}),this.stallCallStats()}}))}setRoomName(e){this.roomURL=e}configureSendTransport(e){var t;null==(t=this.backend)||t.registerProducingTransport(e)}configureRecvTransport(e){var t;null==(t=this.backend)||t.registerConsumingTransport(e)}candidateRegionalNetworkQualityTest(e){return tr(this,null,(function*(){var t;try{null==(t=this.backend)||t.sendNetworkQualityTestBeginEvent(e)}catch(e){this.logger.error("callStats::sendNetworkQualityTestBeginEvent",{error:{reason:e.reason}})}}))}roomJoined(e){return tr(this,null,(function*(){var t,r;null==(t=this.backend)||t.sendCallJoinBeginEvent(e),this.backend,null==(r=this.backend)||r.startPingStats()}))}audioOff(){var e;null==(e=this.backend)||e.sendAudioToggleEvent(!1)}audioOn(){var e;null==(e=this.backend)||e.sendAudioToggleEvent(!0)}videoOff(){var e;null==(e=this.backend)||e.sendVideoToggleEvent(!1)}videoOn(){var e;null==(e=this.backend)||e.sendVideoToggleEvent(!0)}callEnded(){var e,t;null==(e=this.backend)||e.stopPingStats(),null==(t=this.backend)||t.sendDisconnectEvent()}screenShareStart(e){var t;null==(t=this.backend)||t.sendScreenShareToggleEvent(!0,e)}consumerSharedMediaState(e,t){var r;null==(r=this.backend)||r.sendConsumerSharedMediaStateEvent(e,t)}screenShareStop(e){var t;null==(t=this.backend)||t.sendScreenShareToggleEvent(!1,e)}screenShareRequested(){var e;null==(e=this.backend)||e.sendScreenShareRequestedEvent()}activeSpeaker(e){var t;e===this.peerId&&(null==(t=this.backend)||t.sendActiveSpeakerEvent(e))}devices(e,t){var r;null==(r=this.backend)||r.devices(e,t)}selectedDevice(e,t){var r;null==(r=this.backend)||r.selectedDevice(e,t)}mediaPermission(e,t){var r;null==(r=this.backend)||r.mediaPermission(e,t)}mediaPlaybackFailed(e){var t;null==(t=this.backend)||t.mediaPlaybackFailed(e)}mediaTrackMuted(e){var t;null==(t=this.backend)||t.mediaTrackMuted(e)}tabChanged(e=!1){var t;null==(t=this.backend)||t.tabChanged(e)}browserBackgrounded(){var e;null==(e=this.backend)||e.browserBackgrounded()}browserForegrounded(){var e;null==(e=this.backend)||e.browserForegrounded()}legacySwitch(e){var t;null==(t=this.backend)||t.legacySwitch(e)}startPreCallTest(e=!1){return tr(this,null,(function*(){var t;null==(t=this.backend)||t.sendPreCallTestBeginEvent(e)}))}onPreCallTestResults(e){var t;return null==(t=this.backend)||t.eventHandler.once("precall_end",e),e}onReceivingConsumerAudioStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("consumer_audio_status",e)}onReceivingConsumerVideoStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("consumer_video_status",e)}onReceivingProducerAudioStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("producer_audio_status",e)}onReceivingProducerVideoStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("producer_video_status",e)}onReceivingProducingTransportStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("producing_transport_status",e)}onReceivingConsumingTransportStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("consuming_transport_status",e)}onProducerScore(e){var t;null==(t=this.backend)||t.eventHandler.on("producer_score",e)}onConsumerScore(e){var t;null==(t=this.backend)||t.eventHandler.on("consumer_score",e)}onSafeInitialization(e){if(this.initialized)e(this.ipInformation,!1);else if(!this.stalled){const t=t=>{e(t,!0)};return this.once("initialized",t),t}return()=>{}}removeInitializationListener(e){this.removeListener("initialized",e)}stallCallStats(){this.stalled=!0,this.removeAllListeners("initialized")}ivsPlayerEvent(e,t){var r,i,n,s,o,a,c,d,l,u,p;switch(e){case"PlayerRebuffering":null==(r=this.backend)||r.sendIVSPlayerRebufferEvent();break;case"PlayerAudioBlocked":null==(i=this.backend)||i.sendIVSPlayerAudioBlockEvent();break;case"PlayerPlaybackBlocked":null==(n=this.backend)||n.sendIVSPlayerPlaybackBlockedEvent();break;case"PlayerNetworkUnavailable":null==(s=this.backend)||s.sendIVSPlayerNetworkUnavailableEvent();break;case"PlayerInitialized":null==(o=this.backend)||o.sendIVSPlayerInitializedEvent();break;case"PlayerWorkerError":null==(a=this.backend)||a.sendIVSPlayerWorkerErrorEvent();break;case"PlayerError":null==(c=this.backend)||c.sendIVSPlayerErrorEvent(t);break;case"PlayerRecoverableError":null==(d=this.backend)||d.sendIVSPlayerRecoverableErrorEvent(t);break;case"PlayerAnalyticsEvent":null==(l=this.backend)||l.sendIVSPlayerAnalyticsEvent(t);break;case"PlayerPlaybackRateChanged":null==(u=this.backend)||u.sendIVSPlayerPlaybackRateChangedEvent(t);break;case"PlayerQualityChanged":null==(p=this.backend)||p.sendIVSPlayerQualityChanged(t)}}livestreamLatency(e){var t;null==(t=this.backend)||t.sendPlayerLiveLatency(e)}};var gi,vi,yi,_i,Si,Ei,Ti,bi,wi;fi.setMaxListeners(30),Array.prototype.at||Object.assign(Array.prototype,{at:function(e){const{length:t}=this,r=e>=0?e:t+e;return r<0||r>=t?void 0:this[r]}}),String.prototype.at||Object.assign(String.prototype,{at:function(e){const{length:t}=this,r=e>=0?e:t+e;return r<0||r>=t?void 0:this[r]}}),function(e){e.GroupCall="GROUP_CALL",e.Webinar="WEBINAR",e.AudioRoom="AUDIO_ROOM",e.Livestream="LIVESTREAM",e.Chat="CHAT"}(gi||(gi={})),function(e){e.Skip="SKIP",e.OnPrivilegedUserEntry="ON_PRIVILEGED_USER_ENTRY",e.SkipOnAccept="SKIP_ON_ACCEPT"}(vi||(vi={})),function(e){e.Allowed="ALLOWED",e.NotAllowed="NOT_ALLOWED",e.CanRequest="CAN_REQUEST"}(yi||(yi={})),function(e){e.Allowed="ALLOWED",e.NotAllowed="NOT_ALLOWED"}(_i||(_i={})),function(e){e.FULL_ACCESS="FULL_ACCESS",e.VIEW_ONLY="VIEW_ONLY"}(Si||(Si={})),function(e){e.skip="SKIP",e.onAccept="ON_ACCEPT",e.skipOnPrivilegedUserEntry="SKIP_ON_PRIVILEGED_USER_ENTRY",e.skipOnAccept="SKIP_ON_ACCEPT"}(Ei||(Ei={})),function(e){e.none="NONE",e.recorder="RECORDER",e.livestreamer="LIVESTREAMER"}(Ti||(Ti={})),function(e){e.groupCall="GROUP_CALL",e.webinar="WEBINAR",e.audioRoom="AUDIO_ROOM",e.livestream="LIVESTREAM",e.chat="CHAT"}(bi||(bi={})),function(e){e.SKIP="skip",e.SKIP_ON_PRIVILEGED_USER_ENTRY="skipOnPrivilegedUserEntry",e.ON_ACCEPT="skipOnAccept",e.SKIP_ON_ACCEPT="skipOnAccept"}(wi||(wi={})),bi.groupCall,Ei.skipOnAccept,Ti.none;let ki="hXgU8Wc8pwuGNq9ms5q9Hh";var Ri;"undefined"!=typeof process&&null!=(Ri=null==process?void 0:process.env)&&Ri.FLAGSMITH_ENVIRONMENT_KEY&&(ki=process.env.FLAGSMITH_ENVIRONMENT_KEY);const Ci=new class{constructor(e=ki){Kt(this,"flags",{}),Kt(this,"environmentKey",null),this.environmentKey=e,this.identify=this.identify.bind(this),this.getValue=this.getValue.bind(this),this.hasFeature=this.hasFeature.bind(this),this.getAllFlags=this.getAllFlags.bind(this)}identify(e){return tr(this,arguments,(function*(e,t={},r=!1,i=5e3,n="edge.api.flagsmith.com"){const s=JSON.parse(JSON.stringify(t)),o=Object.entries(s).map((e=>({trait_key:e[0],trait_value:e[1]})));try{const t="_"+(Math.random()+1).toString(36).substring(2),s=yield h().post(`https://${n}/api/v1/identities/`,{identifier:e+(r?t:""),traits:o},{headers:{"Content-Type":"application/json","X-Environment-Key":this.environmentKey},timeout:i});this.flags=function(e=[]){const t={};return e.forEach((e=>{t[e.feature.name]={enabled:e.enabled,value:e.feature_state_value}})),t}(s.data.flags||[])}catch(e){}return this.flags}))}getValue(e){return this.flags&&this.flags[e]&&this.flags[e].value}hasFeature(e){return this.flags&&this.flags[e]&&this.flags[e].enabled}getAllFlags(){return this.flags}},Ai=[-2,-1,0,1,2],Ii=[0,1,2,3,4],Pi=(e,t,r)=>{let i,n,s;if(0==t)i=n=s=r;else{const o=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<.16666666666666666?e+6*(t-e)*r:r<.5?t:r<.6666666666666666?e+(t-e)*(.6666666666666666-r)*6:e),a=r<.5?r*(1+t):r+t-r*t,c=2*r-a;i=o(c,a,e+1/3),n=o(c,a,e),s=o(c,a,e-1/3)}return[Math.round(255*i),Math.round(255*n),Math.round(255*s)]},Di=(e,t,r)=>{const i=e=>e.toString(16).padStart(2,"0");return`#${i(e)}${i(t)}${i(r)}`},Mi=(e,t=Ai,r=.4)=>{const i=[],[n,s,o]=function(e){let t="0",r="0",i="0";return 4==(e=e.trim()).length?(t="0x"+e[1]+e[1],r="0x"+e[2]+e[2],i="0x"+e[3]+e[3]):e.length>6&&(t="0x"+e[1]+e[2],r="0x"+e[3]+e[4],i="0x"+e[5]+e[6]),[+t,+r,+i]}(e),[a,c,d]=((e,t,r)=>{e/=255,t/=255,r/=255;const i=Math.max(e,t,r),n=Math.min(e,t,r);let s,o;const a=(i+n)/2;if(i==n)s=o=0;else{const c=i-n;switch(o=a>.5?c/(2-i-n):c/(i+n),i){case e:s=(t-r)/c+(t<r?6:0);break;case t:s=(r-e)/c+2;break;case r:s=(e-t)/c+4}s/=6}return[s,o,a]})(n,s,o),l=Math.round(100*d);l>70?r=.8:l>60?r=.9:l<10?r=.075:l<42&&(r=.3);const u=t.findIndex((e=>0===e));if(-1===u)throw new Error("Invalid reducer provided, it must contain atleast one zero");const p=(100-l)/(5-u),h=l/(u+1);for(const e of t){let t;t=e<0?l+e*h*r:e>0?l+e*p*r:l;const[n,s,o]=Pi(a,c,t/100);i.push(Di(n,s,o))}return i};function Oi(e,t){return e===t||e!=e&&t!=t}function Ni(e,t){for(var r=e.length;r--;)if(Oi(e[r][0],t))return r;return-1}var xi=Array.prototype.splice;function Li(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Li.prototype.clear=function(){this.__data__=[],this.size=0},Li.prototype.delete=function(e){var t=this.__data__,r=Ni(t,e);return!(r<0||(r==t.length-1?t.pop():xi.call(t,r,1),--this.size,0))},Li.prototype.get=function(e){var t=this.__data__,r=Ni(t,e);return r<0?void 0:t[r][1]},Li.prototype.has=function(e){return Ni(this.__data__,e)>-1},Li.prototype.set=function(e,t){var r=this.__data__,i=Ni(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this};const ji="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;var Ui="object"==typeof self&&self&&self.Object===Object&&self;const Fi=ji||Ui||Function("return this")(),Vi=Fi.Symbol;var Bi=Object.prototype,Wi=Bi.hasOwnProperty,Hi=Bi.toString,Gi=Vi?Vi.toStringTag:void 0,$i=Object.prototype.toString,qi="[object Null]",zi="[object Undefined]",Ji=Vi?Vi.toStringTag:void 0;function Ki(e){return null==e?void 0===e?zi:qi:Ji&&Ji in Object(e)?function(e){var t=Wi.call(e,Gi),r=e[Gi];try{e[Gi]=void 0;var i=!0}catch(e){}var n=Hi.call(e);return i&&(t?e[Gi]=r:delete e[Gi]),n}(e):function(e){return $i.call(e)}(e)}function Yi(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Qi="[object AsyncFunction]",Xi="[object Function]",Zi="[object GeneratorFunction]",en="[object Proxy]";function tn(e){if(!Yi(e))return!1;var t=Ki(e);return t==Xi||t==Zi||t==Qi||t==en}const rn=Fi["__core-js_shared__"];var nn=function(){var e=/[^.]+$/.exec(rn&&rn.keys&&rn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),sn=Function.prototype.toString;function on(e){if(null!=e){try{return sn.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var an=/^\[object .+?Constructor\]$/,cn=Function.prototype,dn=Object.prototype,ln=cn.toString,un=dn.hasOwnProperty,pn=RegExp("^"+ln.call(un).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function hn(e){return!(!Yi(e)||function(e){return!!nn&&nn in e}(e))&&(tn(e)?pn:an).test(on(e))}function mn(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return hn(r)?r:void 0}const fn=mn(Fi,"Map"),gn=mn(Object,"create");var vn=Object.prototype.hasOwnProperty,yn=Object.prototype.hasOwnProperty;function _n(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function Sn(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function En(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function Tn(e){var t=this.__data__=new Li(e);this.size=t.size}function bn(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e}_n.prototype.clear=function(){this.__data__=gn?gn(null):{},this.size=0},_n.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},_n.prototype.get=function(e){var t=this.__data__;if(gn){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return vn.call(t,e)?t[e]:void 0},_n.prototype.has=function(e){var t=this.__data__;return gn?void 0!==t[e]:yn.call(t,e)},_n.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=gn&&void 0===t?"__lodash_hash_undefined__":t,this},En.prototype.clear=function(){this.size=0,this.__data__={hash:new _n,map:new(fn||Li),string:new _n}},En.prototype.delete=function(e){var t=Sn(this,e).delete(e);return this.size-=t?1:0,t},En.prototype.get=function(e){return Sn(this,e).get(e)},En.prototype.has=function(e){return Sn(this,e).has(e)},En.prototype.set=function(e,t){var r=Sn(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},Tn.prototype.clear=function(){this.__data__=new Li,this.size=0},Tn.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Tn.prototype.get=function(e){return this.__data__.get(e)},Tn.prototype.has=function(e){return this.__data__.has(e)},Tn.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Li){var i=r.__data__;if(!fn||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new En(i)}return r.set(e,t),this.size=r.size,this};var wn=function(){try{var e=mn(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const kn=wn;function Rn(e,t,r){"__proto__"==t&&kn?kn(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Cn=Object.prototype.hasOwnProperty;function An(e,t,r){var i=e[t];(!Cn.call(e,t)||!Oi(i,r)||void 0===r&&!(t in e))&&Rn(e,t,r)}function In(e,t,r,i){var n=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=i?i(r[a],e[a],a,r,e):void 0;void 0===c&&(c=e[a]),n?Rn(r,a,c):An(r,a,c)}return r}function Pn(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}function Dn(e){return null!=e&&"object"==typeof e}function Mn(e){return Dn(e)&&"[object Arguments]"==Ki(e)}var On=Object.prototype,Nn=On.hasOwnProperty,xn=On.propertyIsEnumerable,Ln=Mn(function(){return arguments}())?Mn:function(e){return Dn(e)&&Nn.call(e,"callee")&&!xn.call(e,"callee")};const jn=Ln,Un=Array.isArray;function Fn(){return!1}var Vn="object"==typeof exports&&exports&&!exports.nodeType&&exports,Bn=Vn&&e&&!e.nodeType&&e,Wn=Bn&&Bn.exports===Vn?Fi.Buffer:void 0;const Hn=(Wn?Wn.isBuffer:void 0)||Fn;var Gn=9007199254740991,$n=/^(?:0|[1-9]\d*)$/;function qn(e,t){var r=typeof e;return!!(t=null==t?Gn:t)&&("number"==r||"symbol"!=r&&$n.test(e))&&e>-1&&e%1==0&&e<t}var zn=9007199254740991;function Jn(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=zn}var Kn={};function Yn(e){return function(t){return e(t)}}Kn["[object Float32Array]"]=Kn["[object Float64Array]"]=Kn["[object Int8Array]"]=Kn["[object Int16Array]"]=Kn["[object Int32Array]"]=Kn["[object Uint8Array]"]=Kn["[object Uint8ClampedArray]"]=Kn["[object Uint16Array]"]=Kn["[object Uint32Array]"]=!0,Kn["[object Arguments]"]=Kn["[object Array]"]=Kn["[object ArrayBuffer]"]=Kn["[object Boolean]"]=Kn["[object DataView]"]=Kn["[object Date]"]=Kn["[object Error]"]=Kn["[object Function]"]=Kn["[object Map]"]=Kn["[object Number]"]=Kn["[object Object]"]=Kn["[object RegExp]"]=Kn["[object Set]"]=Kn["[object String]"]=Kn["[object WeakMap]"]=!1;var Qn="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xn=Qn&&e&&!e.nodeType&&e,Zn=Xn&&Xn.exports===Qn&&ji.process;const es=function(){try{return Xn&&Xn.require&&Xn.require("util").types||Zn&&Zn.binding&&Zn.binding("util")}catch(e){}}();var ts=es&&es.isTypedArray,rs=ts?Yn(ts):function(e){return Dn(e)&&Jn(e.length)&&!!Kn[Ki(e)]};const is=rs;var ns=Object.prototype.hasOwnProperty;function ss(e,t){var r=Un(e),i=!r&&jn(e),n=!r&&!i&&Hn(e),s=!r&&!i&&!n&&is(e),o=r||i||n||s,a=o?Pn(e.length,String):[],c=a.length;for(var d in e)(t||ns.call(e,d))&&(!o||!("length"==d||n&&("offset"==d||"parent"==d)||s&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||qn(d,c)))&&a.push(d);return a}var os=Object.prototype;function as(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||os)}function cs(e,t){return function(r){return e(t(r))}}const ds=cs(Object.keys,Object);var ls=Object.prototype.hasOwnProperty;function us(e){if(!as(e))return ds(e);var t=[];for(var r in Object(e))ls.call(e,r)&&"constructor"!=r&&t.push(r);return t}function ps(e){return null!=e&&Jn(e.length)&&!tn(e)}function hs(e){return ps(e)?ss(e):us(e)}function ms(e,t){return e&&In(t,hs(t),e)}var fs=Object.prototype.hasOwnProperty;function gs(e){return ps(e)?ss(e,!0):function(e){if(!Yi(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=as(e),r=[];for(var i in e)"constructor"==i&&(t||!fs.call(e,i))||r.push(i);return r}(e)}var vs="object"==typeof exports&&exports&&!exports.nodeType&&exports,ys=vs&&e&&!e.nodeType&&e,_s=ys&&ys.exports===vs?Fi.Buffer:void 0,Ss=_s?_s.allocUnsafe:void 0;function Es(e,t){if(t)return e.slice();var r=e.length,i=Ss?Ss(r):new e.constructor(r);return e.copy(i),i}function Ts(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}function bs(e,t){for(var r=-1,i=null==e?0:e.length,n=0,s=[];++r<i;){var o=e[r];t(o,r,e)&&(s[n++]=o)}return s}function ws(){return[]}var ks=Object.prototype.propertyIsEnumerable,Rs=Object.getOwnPropertySymbols,Cs=Rs?function(e){return null==e?[]:(e=Object(e),bs(Rs(e),(function(t){return ks.call(e,t)})))}:ws;const As=Cs;function Is(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}const Ps=cs(Object.getPrototypeOf,Object);var Ds=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Is(t,As(e)),e=Ps(e);return t}:ws;const Ms=Ds;function Os(e,t,r){var i=t(e);return Un(e)?i:Is(i,r(e))}function Ns(e){return Os(e,hs,As)}function xs(e){return Os(e,gs,Ms)}const Ls=mn(Fi,"DataView"),js=mn(Fi,"Promise"),Us=mn(Fi,"Set"),Fs=mn(Fi,"WeakMap");var Vs="[object Map]",Bs="[object Promise]",Ws="[object Set]",Hs="[object WeakMap]",Gs="[object DataView]",$s=on(Ls),qs=on(fn),zs=on(js),Js=on(Us),Ks=on(Fs),Ys=Ki;(Ls&&Ys(new Ls(new ArrayBuffer(1)))!=Gs||fn&&Ys(new fn)!=Vs||js&&Ys(js.resolve())!=Bs||Us&&Ys(new Us)!=Ws||Fs&&Ys(new Fs)!=Hs)&&(Ys=function(e){var t=Ki(e),r="[object Object]"==t?e.constructor:void 0,i=r?on(r):"";if(i)switch(i){case $s:return Gs;case qs:return Vs;case zs:return Bs;case Js:return Ws;case Ks:return Hs}return t});const Qs=Ys;var Xs=Object.prototype.hasOwnProperty;const Zs=Fi.Uint8Array;function eo(e){var t=new e.constructor(e.byteLength);return new Zs(t).set(new Zs(e)),t}var to=/\w*$/,ro=Vi?Vi.prototype:void 0,io=ro?ro.valueOf:void 0;function no(e,t){var r=t?eo(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var so="[object Boolean]",oo="[object Date]",ao="[object Map]",co="[object Number]",lo="[object RegExp]",uo="[object Set]",po="[object String]",ho="[object Symbol]",mo="[object ArrayBuffer]",fo="[object DataView]",go="[object Float32Array]",vo="[object Float64Array]",yo="[object Int8Array]",_o="[object Int16Array]",So="[object Int32Array]",Eo="[object Uint8Array]",To="[object Uint8ClampedArray]",bo="[object Uint16Array]",wo="[object Uint32Array]";var ko=Object.create,Ro=function(){function e(){}return function(t){if(!Yi(t))return{};if(ko)return ko(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();const Co=Ro;function Ao(e){return"function"!=typeof e.constructor||as(e)?{}:Co(Ps(e))}var Io=es&&es.isMap,Po=Io?Yn(Io):function(e){return Dn(e)&&"[object Map]"==Qs(e)};const Do=Po;var Mo=es&&es.isSet,Oo=Mo?Yn(Mo):function(e){return Dn(e)&&"[object Set]"==Qs(e)};const No=Oo;var xo=1,Lo=2,jo=4,Uo="[object Arguments]",Fo="[object Function]",Vo="[object GeneratorFunction]",Bo="[object Object]",Wo={};function Ho(e,t,r,i,n,s){var o,a=t&xo,c=t&Lo,d=t&jo;if(r&&(o=n?r(e,i,n,s):r(e)),void 0!==o)return o;if(!Yi(e))return e;var l=Un(e);if(l){if(o=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Xs.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!a)return Ts(e,o)}else{var u=Qs(e),p=u==Fo||u==Vo;if(Hn(e))return Es(e,a);if(u==Bo||u==Uo||p&&!n){if(o=c||p?{}:Ao(e),!a)return c?function(e,t){return In(e,Ms(e),t)}(e,function(e,t){return e&&In(t,gs(t),e)}(o,e)):function(e,t){return In(e,As(e),t)}(e,ms(o,e))}else{if(!Wo[u])return n?e:{};o=function(e,t,r){var i=e.constructor;switch(t){case mo:return eo(e);case so:case oo:return new i(+e);case fo:return function(e,t){var r=t?eo(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case go:case vo:case yo:case _o:case So:case Eo:case To:case bo:case wo:return no(e,r);case ao:return new i;case co:case po:return new i(e);case lo:return function(e){var t=new e.constructor(e.source,to.exec(e));return t.lastIndex=e.lastIndex,t}(e);case uo:return new i;case ho:return function(e){return io?Object(io.call(e)):{}}(e)}}(e,u,a)}}s||(s=new Tn);var h=s.get(e);if(h)return h;s.set(e,o),No(e)?e.forEach((function(i){o.add(Ho(i,t,r,i,e,s))})):Do(e)&&e.forEach((function(i,n){o.set(n,Ho(i,t,r,n,e,s))}));var m=l?void 0:(d?c?xs:Ns:c?gs:hs)(e);return bn(m||e,(function(i,n){m&&(i=e[n=i]),An(o,n,Ho(i,t,r,n,e,s))})),o}Wo[Uo]=Wo["[object Array]"]=Wo["[object ArrayBuffer]"]=Wo["[object DataView]"]=Wo["[object Boolean]"]=Wo["[object Date]"]=Wo["[object Float32Array]"]=Wo["[object Float64Array]"]=Wo["[object Int8Array]"]=Wo["[object Int16Array]"]=Wo["[object Int32Array]"]=Wo["[object Map]"]=Wo["[object Number]"]=Wo[Bo]=Wo["[object RegExp]"]=Wo["[object Set]"]=Wo["[object String]"]=Wo["[object Symbol]"]=Wo["[object Uint8Array]"]=Wo["[object Uint8ClampedArray]"]=Wo["[object Uint16Array]"]=Wo["[object Uint32Array]"]=!0,Wo["[object Error]"]=Wo[Fo]=Wo["[object WeakMap]"]=!1;var Go=1,$o=4;function qo(e){return Ho(e,Go|$o)}var zo="[object Symbol]";function Jo(e){return"symbol"==typeof e||Dn(e)&&Ki(e)==zo}var Ko=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yo=/^\w*$/;function Qo(e,t){if(Un(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Jo(e))||Yo.test(e)||!Ko.test(e)||null!=t&&e in Object(t)}function Xo(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var o=e.apply(this,i);return r.cache=s.set(n,o)||s,o};return r.cache=new(Xo.Cache||En),r}Xo.Cache=En;var Zo,ea,ta=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ra=/\\(\\)?/g,ia=(Zo=Xo((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ta,(function(e,r,i,n){t.push(i?n.replace(ra,"$1"):r||e)})),t}),(function(e){return 500===ea.size&&ea.clear(),e})),ea=Zo.cache,Zo);const na=ia;function sa(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}var oa=1/0,aa=Vi?Vi.prototype:void 0,ca=aa?aa.toString:void 0;function da(e){if("string"==typeof e)return e;if(Un(e))return sa(e,da)+"";if(Jo(e))return ca?ca.call(e):"";var t=e+"";return"0"==t&&1/e==-oa?"-0":t}function la(e){return null==e?"":da(e)}function ua(e,t){return Un(e)?e:Qo(e,t)?[e]:na(la(e))}var pa=1/0;function ha(e){if("string"==typeof e||Jo(e))return e;var t=e+"";return"0"==t&&1/e==-pa?"-0":t}function ma(e,t){for(var r=0,i=(t=ua(t,e)).length;null!=e&&r<i;)e=e[ha(t[r++])];return r&&r==i?e:void 0}function fa(e,t,r){var i=null==e?void 0:ma(e,t);return void 0===i?r:i}var ga=Object.prototype.hasOwnProperty;function va(e,t){return null!=e&&ga.call(e,t)}function ya(e,t,r){for(var i=-1,n=(t=ua(t,e)).length,s=!1;++i<n;){var o=ha(t[i]);if(!(s=null!=e&&r(e,o)))break;e=e[o]}return s||++i!=n?s:!!(n=null==e?0:e.length)&&Jn(n)&&qn(o,n)&&(Un(e)||jn(e))}function _a(e,t,r,i){if(!Yi(e))return e;for(var n=-1,s=(t=ua(t,e)).length,o=s-1,a=e;null!=a&&++n<s;){var c=ha(t[n]),d=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(n!=o){var l=a[c];void 0===(d=i?i(l,c,a):void 0)&&(d=Yi(l)?l:qn(t[n+1])?[]:{})}An(a,c,d),a=a[c]}return e}const Sa={border_radius:"rounded",border_width:"thin",spacing_base:4,theme:"dark",colors:{brand:(e=>{const[t,r,i,n,s]=Mi("#2160FD",Ai);return{300:t,400:r,500:i,600:n,700:s}})(),background:(e=>{const[t,r,i,n,s]=Mi(e,Ii);return{1e3:t,900:r,800:i,700:n,600:s}})("#141414"),danger:"#FF2D2D",text:"#EEEEEE",text_on_brand:"#EEEEEE",success:"#62A504",video_bg:"#191919",warning:"#FFCD07"}};function Ea(){return qo(Sa)}const Ta={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:vi.Skip,plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:yi.Allowed,can_consume:_i.Allowed},audio:{can_produce:yi.Allowed},screenshare:{can_produce:yi.Allowed,can_consume:_i.Allowed}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1},channel:{can_create:"ALL",can_delete:"ALL",can_update:"ALL",can_read_all:!1},message:{can_delete:"ALL",can_edit:"ALL",delete_cutoff_time_seconds:0,edit_cutoff_time_seconds:0}},hidden_participant:!1,is_recorder:!1,recorder_type:Ti.none,show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{oldTheme:{setup_screen:{is_enabled:!1},alone_here:{is_enabled:!1},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!1,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,colors:{primary:"#2160FD",secondary:"#1A1A1A",text:"#EEEEEE",background:"#1A1A1A",textPrimary:"#EEEEEE",videoBackground:"#1A1A1A"},dimensions:{mode:"fillParent"},grid:{multi:{maxVideoCount:6,videoFit:"cover"},single:{maxVideoCount:6,videoFit:"cover"},defaultView:"MULTI"},controls:{pip_toggle:!1},plugins:[]},design_tokens:Ea(),config_diff:{}},config:{view_type:gi.GroupCall,media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"hybrid"};Ti.none,Ei.skip;const ba={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:vi.Skip,plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:yi.Allowed},audio:{can_produce:yi.Allowed},screenshare:{can_produce:yi.Allowed}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},hidden_participant:!1,is_recorder:!1,recorder_type:Ti.none,show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{design_tokens:Ea(),config_diff:{}},config:{view_type:gi.GroupCall,media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"2.0.0"};function wa(){return qo(ba)}const ka="mediasoup-client";let Ra=class{constructor(e){e?(this._debug=Er(`${ka}:${e}`),this._warn=Er(`${ka}:WARN:${e}`),this._error=Er(`${ka}:ERROR:${e}`)):(this._debug=Er(ka),this._warn=Er(`${ka}:WARN`),this._error=Er(`${ka}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};const Ca=new Ra("EnhancedEventEmitter");let Aa=class extends ir.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){const r=super.listenerCount(e);try{return super.emit(e,...t)}catch(t){return Ca.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,t),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}},Ia=class e extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,e):this.stack=new Error(t).stack}},Pa=class e extends Error{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,e):this.stack=new Error(t).stack}};function Da(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))}function Ma(){return Math.round(1e7*Math.random())}var Oa={};function Na(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)xa(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)ja(t)}function xa(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,(!e.parameters||"object"!=typeof e.parameters)&&(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)La(t)}function La(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");(!e.parameter||"string"!=typeof e.parameter)&&(e.parameter="")}function ja(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function Ua(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)Fa(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)Va(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)Ba(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),function(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");(!e.reducedSize||"boolean"!=typeof e.reducedSize)&&(e.reducedSize=!0)}(e.rtcp)}function Fa(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,(!e.parameters||"object"!=typeof e.parameters)&&(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)La(t)}function Va(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),(!e.parameters||"object"!=typeof e.parameters)&&(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function Ba(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if((!e.dtx||"boolean"!=typeof e.dtx)&&(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function Wa(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")}function Ha(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const i of t.codecs){if(i.kind!==e)continue;const t={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(t),i.localRtxPayloadType){const e={mimeType:`${i.kind}/rtx`,payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const i of t.headerExtensions){if(i.kind&&i.kind!==e||"sendrecv"!==i.direction&&"sendonly"!==i.direction)continue;const t={uri:i.uri,id:i.sendId,encrypt:i.encrypt,parameters:{}};r.headerExtensions.push(t)}return r}function Ga(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const i of t.codecs){if(i.kind!==e)continue;const t={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.remoteParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(t),i.localRtxPayloadType){const e={mimeType:`${i.kind}/rtx`,payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const i of t.headerExtensions){if(i.kind&&i.kind!==e||"sendrecv"!==i.direction&&"sendonly"!==i.direction)continue;const t={uri:i.uri,id:i.sendId,encrypt:i.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r}function $a(e,t){const r=[];if(t){for(let i=0;i<e.length;++i)if(Ja(e[i],t)){r.push(e[i]),za(e[i+1])&&r.push(e[i+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),za(e[1])&&r.push(e[1]);return r}function qa(e,t){return t.codecs.some((t=>t.kind===e))}function za(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function Ja(e,t,{strict:r=!1,modify:i=!1}={}){const n=e.mimeType.toLowerCase();if(n!==t.mimeType.toLowerCase()||e.clockRate!==t.clockRate||e.channels!==t.channels)return!1;switch(n){case"video/h264":if(r){if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0)||!Oa.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=Oa.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}i&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r&&(e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}return!0}function Ka(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function Ya(e,t){const r=[];for(const i of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===i.type&&(e.parameter===i.parameter||!e.parameter&&!i.parameter)));e&&r.push(e)}return r}!function(e){const t=Er("h264-profile-level-id");t.log=console.info.bind(console),e.ProfileConstrainedBaseline=1,e.ProfileBaseline=2,e.ProfileMain=3,e.ProfileConstrainedHigh=4,e.ProfileHigh=5;e.Level1_b=0,e.Level1=10,e.Level1_1=11,e.Level1_2=12,e.Level1_3=13,e.Level2=20,e.Level2_1=21,e.Level2_2=22,e.Level3=30,e.Level3_1=31,e.Level3_2=32,e.Level4=40,e.Level4_1=41,e.Level4_2=42,e.Level5=50,e.Level5_1=51,e.Level5_2=52;class r{constructor(e,t){this.profile=e,this.level=t}}e.ProfileLevelId=r;const i=new r(1,31);class n{constructor(e){this._mask=~a("x",e),this._maskedValue=a("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class s{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const o=[new s(66,new n("x1xx0000"),1),new s(77,new n("1xxx0000"),1),new s(88,new n("11xx0000"),1),new s(66,new n("x0xx0000"),2),new s(88,new n("10xx0000"),2),new s(77,new n("0x0x0000"),3),new s(100,new n("00000000"),5),new s(100,new n("00001100"),4)];function a(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function c(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}e.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const i=parseInt(e,16);if(0===i)return null;const n=255&i,s=i>>8&255,a=i>>16&255;let c;switch(n){case 11:c=16&s?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:c=n;break;default:return t("parseProfileLevelId() | unrecognized level_idc:%s",n),null}for(const e of o)if(a===e.profile_idc&&e.profile_iop.isMatch(s))return new r(e.profile,c);return t("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},e.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return t("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let r;switch(e.profile){case 1:r="42e0";break;case 2:r="4200";break;case 3:r="4d00";break;case 4:r="640c";break;case 5:r="6400";break;default:return t("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let i=e.level.toString(16);return 1===i.length&&(i=`0${i}`),`${r}${i}`},e.parseSdpProfileLevelId=function(t={}){const r=t["profile-level-id"];return r?e.parseProfileLevelId(r):i},e.isSameProfile=function(t={},r={}){const i=e.parseSdpProfileLevelId(t),n=e.parseSdpProfileLevelId(r);return Boolean(i&&n&&i.profile===n.profile)},e.generateProfileLevelIdForAnswer=function(i={},n={}){if(!i["profile-level-id"]&&!n["profile-level-id"])return t("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const s=e.parseSdpProfileLevelId(i),o=e.parseSdpProfileLevelId(n);if(!s)throw new TypeError("invalid local_profile_level_id");if(!o)throw new TypeError("invalid remote_profile_level_id");if(s.profile!==o.profile)throw new TypeError("H264 Profile mismatch");const a=c(i)&&c(n),d=s.level,l=function(e,t){return function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(e,t)?e:t}(d,o.level),u=a?d:l;return t("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",s.profile,u),e.profileLevelIdToString(new r(s.profile,u))}}(Oa);var Qa={},Xa={},Za=rr&&rr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.Logger=void 0;const ec=Za(Er),tc="awaitqueue";Xa.Logger=class{constructor(e){e?(this._debug=(0,ec.default)(`${tc}:${e}`),this._warn=(0,ec.default)(`${tc}:WARN:${e}`),this._error=(0,ec.default)(`${tc}:ERROR:${e}`)):(this._debug=(0,ec.default)(tc),this._warn=(0,ec.default)(`${tc}:WARN`),this._error=(0,ec.default)(`${tc}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}},Object.defineProperty(Qa,"__esModule",{value:!0});var rc=Qa.AwaitQueue=Qa.AwaitQueueRemovedTaskError=Qa.AwaitQueueStoppedError=void 0;const ic=new Xa.Logger;class nc extends Error{constructor(e){super(null!=e?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,nc)}}Qa.AwaitQueueStoppedError=nc;class sc extends Error{constructor(e){super(null!=e?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,sc)}}let oc;Qa.AwaitQueueRemovedTaskError=sc,rc=Qa.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}push(e,t){return tr(this,null,(function*(){if(t=null!=t?t:e.name,ic.debug(`push() [name:${t}]`),"function"!=typeof e)throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,i)=>{const n={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{if(n.completed)return;n.completed=!0,this.pendingTasks.delete(n.id),ic.debug(`resolving task [name:${n.name}]`),r(e);const[t]=this.pendingTasks.values();t&&!t.executedAt&&this.execute(t)},reject:e=>{if(!n.completed&&(n.completed=!0,this.pendingTasks.delete(n.id),ic.debug(`rejecting task [name:${n.name}]: %s`,String(e)),i(e),!this.stopping)){const[e]=this.pendingTasks.values();e&&!e.executedAt&&this.execute(e)}}};this.pendingTasks.set(n.id,n),1===this.pendingTasks.size&&this.execute(n)}))}))}stop(){ic.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())ic.debug(`stop() | stopping task [name:${e.name}]`);this.stopping=!1}remove(e){ic.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];t?t.reject(new sc):ic.debug(`stop() | no task with given idx [taskIdx:${e}]`)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map((r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0})))}execute(e){return tr(this,null,(function*(){if(ic.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=yield e.task();e.resolve(t)}catch(t){e.reject(t)}}))}};var ac="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:rr):e=>(oc||(oc=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)));const cc=new Ra("Producer");let dc=class extends Aa{constructor({id:e,localId:t,rtpSender:r,track:i,rtpParameters:n,stopTracks:s,disableTrackOnPause:o,zeroRtpOnPause:a,appData:c}){super(),this._closed=!1,this._observer=new Aa,cc.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=i,this._kind=i.kind,this._rtpParameters=n,this._paused=!!o&&!i.enabled,this._maxSpatialLayer=void 0,this._stopTracks=s,this._disableTrackOnPause=o,this._zeroRtpOnPause=a,this._appData=c||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(cc.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(cc.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");return new Promise(((e,t)=>{this.safeEmit("@getstats",e,t)}))}))}pause(){cc.debug("pause()"),this._closed?cc.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@pause",e,t)})).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){cc.debug("resume()"),this._closed?cc.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@resume",e,t)})).catch((()=>{})),this._observer.safeEmit("resume"))}replaceTrack(e){return tr(this,arguments,(function*({track:e}){if(cc.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new Pa("closed")}if(e&&"ended"===e.readyState)throw new Pa("track ended");e!==this._track?(yield new Promise(((t,r)=>{this.safeEmit("@replacetrack",e,t,r)})),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()):cc.debug("replaceTrack() | same track, ignored")}))}setMaxSpatialLayer(e){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");if("video"!==this._kind)throw new Ia("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(yield new Promise(((t,r)=>{this.safeEmit("@setmaxspatiallayer",e,t,r)})).catch((()=>{})),this._maxSpatialLayer=e)}))}setRtpEncodingParameters(e){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");if("object"!=typeof e)throw new TypeError("invalid params");yield new Promise(((t,r)=>{this.safeEmit("@setrtpencodingparameters",e,t,r)}))}))}onTrackEnded(){cc.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}};const lc=new Ra("Consumer");let uc=class extends Aa{constructor({id:e,localId:t,producerId:r,rtpReceiver:i,track:n,rtpParameters:s,appData:o}){super(),this._closed=!1,this._observer=new Aa,lc.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=i,this._track=n,this._rtpParameters=s,this._paused=!n.enabled,this._appData=o||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(lc.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(lc.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");return new Promise(((e,t)=>{this.safeEmit("@getstats",e,t)}))}))}pause(){lc.debug("pause()"),this._closed?lc.error("pause() | Consumer closed"):this._paused?lc.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){lc.debug("resume()"),this._closed?lc.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):lc.debug("resume() | Consumer is already resumed")}onTrackEnded(){lc.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}};const pc=new Ra("DataProducer");class hc extends Aa{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:i}){super(),this._closed=!1,this._observer=new Aa,pc.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=i||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(pc.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(pc.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(pc.debug("send()"),this._closed)throw new Pa("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(pc.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?pc.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):pc.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(pc.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||pc.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}const mc=new Ra("DataConsumer");class fc extends Aa{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:i,appData:n}){super(),this._closed=!1,this._observer=new Aa,mc.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=n||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(mc.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(mc.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(mc.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?mc.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):mc.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(mc.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}const gc=new Ra("Transport");class vc{constructor(e){this.consumerOptions=e,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}let yc=class extends Aa{constructor({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:u,extendedRtpCapabilities:p,canProduceByKind:h}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new rc,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new Aa,gc.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=p,this._canProduceByKind=h,this._maxSctpMessageSize=s?s.maxMessageSize:null,delete(c=Da(c,{})).iceServers,delete c.iceTransportPolicy,delete c.bundlePolicy,delete c.rtcpMuxPolicy,delete c.sdpSemantics,this._handler=u(),this._handler.run({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:p}),this._appData=l||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}get producers(){return this._producers}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){gc.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");return this._handler.getTransportStats()}))}restartIce(e){return tr(this,arguments,(function*({iceParameters:e}){if(gc.debug("restartIce()"),this._closed)throw new Pa("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.restartIce(e)}))),"transport.restartIce()")}))}updateIceServers(){return tr(this,arguments,(function*({iceServers:e}={}){if(gc.debug("updateIceServers()"),this._closed)throw new Pa("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.updateIceServers(e)}))),"transport.updateIceServers()")}))}produce(){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:i,stopTracks:n=!0,disableTrackOnPause:s=!0,zeroRtpOnPause:o=!1,appData:a={}}={}){if(gc.debug("produce() [track:%o]",e),this._closed)throw new Pa("closed");if(!e)throw new TypeError("missing track");if("send"!==this._direction)throw new Ia("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new Ia(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new Pa("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(a&&"object"!=typeof a)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((()=>tr(this,null,(function*(){let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?c=void 0:t&&(c=t.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:d,rtpParameters:l,rtpSender:u}=yield this._handler.send({track:e,encodings:c,codecOptions:r,codec:i});try{Ua(l);const{id:t}=yield new Promise(((t,r)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:l,appData:a},t,r)})),r=new dc({id:t,localId:d,rtpSender:u,track:e,rtpParameters:l,stopTracks:n,disableTrackOnPause:s,zeroRtpOnPause:o,appData:a});return this._producers.set(r.id,r),this.handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(e){throw this._handler.stopSending(d).catch((()=>{})),e}}))),"transport.produce()").catch((t=>{if(n)try{e.stop()}catch(e){}throw t}))}))}consume(e){return tr(this,arguments,(function*({id:e,producerId:t,kind:r,rtpParameters:i,streamId:n,appData:s={}}){if(gc.debug("consume()"),i=Da(i,void 0),this._closed)throw new Pa("closed");if("recv"!==this._direction)throw new Ia("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");if(!function(e,t){if(Ua(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some((e=>e.remotePayloadType===r.payloadType))}(i,this._extendedRtpCapabilities))throw new Ia("cannot consume this Producer");const o=new vc({id:e,producerId:t,kind:r,rtpParameters:i,streamId:n,appData:s});return this._pendingConsumerTasks.push(o),ac((()=>{if(this._closed)throw new Pa("closed");!1===this._consumerCreationInProgress&&this.createPendingConsumers()})),o.promise}))}produceData(){return tr(this,arguments,(function*({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:i="",protocol:n="",appData:s={}}={}){if(gc.debug("produceData()"),this._closed)throw new Pa("closed");if("send"!==this._direction)throw new Ia("not a sending Transport");if(!this._maxSctpMessageSize)throw new Ia("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push((()=>tr(this,null,(function*(){const{dataChannel:o,sctpStreamParameters:a}=yield this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n});Wa(a);const{id:c}=yield new Promise(((e,t)=>{this.safeEmit("producedata",{sctpStreamParameters:a,label:i,protocol:n,appData:s},e,t)})),d=new hc({id:c,dataChannel:o,sctpStreamParameters:a,appData:s});return this._dataProducers.set(d.id,d),this.handleDataProducer(d),this._observer.safeEmit("newdataproducer",d),d}))),"transport.produceData()")}))}consumeData(e){return tr(this,arguments,(function*({id:e,dataProducerId:t,sctpStreamParameters:r,label:i="",protocol:n="",appData:s={}}){if(gc.debug("consumeData()"),r=Da(r,void 0),this._closed)throw new Pa("closed");if("recv"!==this._direction)throw new Ia("not a receiving Transport");if(!this._maxSctpMessageSize)throw new Ia("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return Wa(r),this._awaitQueue.push((()=>tr(this,null,(function*(){const{dataChannel:o}=yield this._handler.receiveDataChannel({sctpStreamParameters:r,label:i,protocol:n}),a=new fc({id:e,dataProducerId:t,dataChannel:o,sctpStreamParameters:r,appData:s});return this._dataConsumers.set(a.id,a),this.handleDataConsumer(a),this._observer.safeEmit("newdataconsumer",a),a}))),"transport.consumeData()")}))}createPendingConsumers(){return tr(this,null,(function*(){this._consumerCreationInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingConsumerTasks.length)return void gc.debug("createPendingConsumers() | there is no Consumer to be created");const e=[...this._pendingConsumerTasks];let t;this._pendingConsumerTasks=[];const r=[];for(const t of e){const{id:e,kind:i,rtpParameters:n,streamId:s}=t.consumerOptions;r.push({trackId:e,kind:i,rtpParameters:n,streamId:s})}try{const i=yield this._handler.receive(r);for(let r=0;r<i.length;r++){const n=e[r],s=i[r],{id:o,producerId:a,kind:c,rtpParameters:d,appData:l}=n.consumerOptions,{localId:u,rtpReceiver:p,track:h}=s,m=new uc({id:o,localId:u,producerId:a,rtpReceiver:p,track:h,rtpParameters:d,appData:l});this._consumers.set(m.id,m),this.handleConsumer(m),!this._probatorConsumerCreated&&!t&&"video"===c&&(t=m),this._observer.safeEmit("newconsumer",m),n.resolve(m)}}catch(t){for(const r of e)r.reject(t)}if(t)try{const e=function(e){Ua(e=Da(e,{}));const t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t}(t.rtpParameters);yield this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:e}]),gc.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){gc.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",e)}}))),"transport.createPendingConsumers()").then((()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()})).catch((()=>{}))}))}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingPauseConsumers.size)return void gc.debug("pausePendingConsumers() | there is no Consumer to be paused");const e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const t=e.map((e=>e.localId));yield this._handler.pauseReceiving(t)}catch(e){gc.error("pausePendingConsumers() | failed to pause Consumers:",e)}}))),"transport.pausePendingConsumers").then((()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()})).catch((()=>{}))}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingResumeConsumers.size)return void gc.debug("resumePendingConsumers() | there is no Consumer to be resumed");const e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const t=e.map((e=>e.localId));yield this._handler.resumeReceiving(t)}catch(e){gc.error("resumePendingConsumers() | failed to resume Consumers:",e)}}))),"transport.resumePendingConsumers").then((()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()})).catch((()=>{}))}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingCloseConsumers.size)return void gc.debug("closePendingConsumers() | there is no Consumer to be closed");const e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{yield this._handler.stopReceiving(e.map((e=>e.localId)))}catch(e){gc.error("closePendingConsumers() | failed to close Consumers:",e)}}))),"transport.closePendingConsumers").then((()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()})).catch((()=>{}))}handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new Pa("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(gc.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}handleProducer(e){e.on("@close",(()=>{this._producers.delete(e.id),!this._closed&&this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.stopSending(e.localId)}))),"producer @close event").catch((e=>gc.warn("producer.close() failed:%o",e)))})),e.on("@pause",((t,r)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.pauseSending(e.localId)}))),"producer @pause event").then(t).catch(r)})),e.on("@resume",((t,r)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.resumeSending(e.localId)}))),"producer @resume event").then(t).catch(r)})),e.on("@replacetrack",((t,r,i)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.replaceTrack(e.localId,t)}))),"producer @replacetrack event").then(r).catch(i)})),e.on("@setmaxspatiallayer",((t,r,i)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.setMaxSpatialLayer(e.localId,t)}))),"producer @setmaxspatiallayer event").then(r).catch(i)})),e.on("@setrtpencodingparameters",((t,r,i)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.setRtpEncodingParameters(e.localId,t)}))),"producer @setrtpencodingparameters event").then(r).catch(i)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new Pa("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),!this._closed&&(this._pendingCloseConsumers.set(e.id,e),!1===this._consumerCloseInProgress&&this.closePendingConsumers())})),e.on("@pause",(()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),ac((()=>{this._closed||!1===this._consumerPauseInProgress&&this.pausePendingConsumers()}))})),e.on("@resume",(()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),ac((()=>{this._closed||!1===this._consumerResumeInProgress&&this.resumePendingConsumers()}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new Pa("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}};const _c=new Ra("Device");class Sc{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new Aa,_c.debug("constructor()"),r){if(_c.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)_c.debug("constructor() | handler given: %s",e);else{if(e=function(){var e,t,r,i;if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void _c.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):"undefined"!=typeof RTCRtpTransceiver?(_c.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(_c.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if("object"==typeof navigator&&"string"==typeof navigator.userAgent){let n=navigator.userAgent;n=null==n?void 0:n.replace("motorola edge","motorola x");const s=f().getParser(n),o=s.getEngine();if(s.satisfies({chrome:">=111",chromium:">=111","microsoft edge":">=111"}))return"Chrome111";if(s.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(s.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(s.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(s.satisfies({firefox:">=111"}))return"Firefox111";if(s.satisfies({firefox:">=60"}))return"Firefox60";if(s.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if("iOS"===(null===(t=null===(e=s.parsedResult)||void 0===e?void 0:e.os)||void 0===t?void 0:t.name)&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(s.satisfies({"microsoft edge":">=11"})&&s.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(o.name&&"blink"===o.name.toLowerCase()){const e=n.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(e){const t=Number(e[1]);return t>=111?"Chrome111":t>=74?"Chrome74":"Chrome70"}return"Chrome111"}return"iOS"===(null===(i=null===(r=s.parsedResult)||void 0===r?void 0:r.os)||void 0===i?void 0:i.name)&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")||o.name&&"webkit"===o.name.toLowerCase()&&o.version&&parseFloat(o.version)>605?"Safari12":void _c.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",s.getBrowserName(),s.getBrowserVersion())}_c.warn("this._detectDevice() | unknown device")}(),!e)throw new Ia("device not supported");_c.debug("constructor() | detected handler: %s",e)}this.switchDevice(e)}const i=this._handlerFactory();this._handlerName=i.name,i.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new Pa("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new Pa("not loaded");return this._sctpCapabilities}get observer(){return this._observer}load(e){return tr(this,arguments,(function*({routerRtpCapabilities:e}){let t;_c.debug("load() [routerRtpCapabilities:%o]",e),e=Da(e,void 0);try{if(this._loaded)throw new Pa("already loaded");Na(e),t=this._handlerFactory();const r=yield t.getNativeRtpCapabilities();_c.debug("load() | got native RTP capabilities:%o",r),Na(r),this._extendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const i of t.codecs||[]){if(za(i))continue;const t=(e.codecs||[]).find((e=>Ja(e,i,{strict:!0,modify:!0})));if(!t)continue;const n={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:i.parameters,rtcpFeedback:Ya(t,i)};r.codecs.push(n)}for(const i of r.codecs){const r=e.codecs.find((e=>za(e)&&e.parameters.apt===i.localPayloadType)),n=t.codecs.find((e=>za(e)&&e.parameters.apt===i.remotePayloadType));r&&n&&(i.localRtxPayloadType=r.preferredPayloadType,i.remoteRtxPayloadType=n.preferredPayloadType)}for(const i of t.headerExtensions){const t=e.headerExtensions.find((e=>Ka(e,i)));if(!t)continue;const n={kind:i.kind,uri:i.uri,sendId:t.preferredId,recvId:i.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(i.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}r.headerExtensions.push(n)}return r}(r,e),_c.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=qa("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=qa("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const i={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(i)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t}(this._extendedRtpCapabilities),Na(this._recvRtpCapabilities),_c.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=yield t.getNativeSctpCapabilities(),_c.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");!function(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}(e.numStreams)}(this._sctpCapabilities),_c.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}))}canProduce(e){if(!this._loaded)throw new Pa("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d}){return _c.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d}){return _c.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d})}createTransport({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l}){if(!this._loaded)throw new Pa("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(i))throw new TypeError("missing iceCandidates");if("object"!=typeof n)throw new TypeError("missing dtlsParameters");if(s&&"object"!=typeof s)throw new TypeError("wrong sctpParameters");if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");const u=new yc({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",u),u}}function Ec({sdpObject:e}){const t=new Map,r=[];let i=!1,n=!1;for(const s of e.media){const e=s.type;switch(e){case"audio":if(i)continue;i=!0;break;case"video":if(n)continue;n=!0;break;default:continue}for(const r of s.rtp){const i={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(i.preferredPayloadType,i)}for(const e of s.fmtp||[]){const r=g.Sl(e.config),i=t.get(e.payload);i&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),i.parameters=r)}for(const r of s.rtcpFb||[]){const i={type:r.type,parameter:r.subtype};if(i.parameter||delete i.parameter,"*"!==r.payload){const e=t.get(r.payload);if(!e)continue;e.rtcpFeedback.push(i)}else for(const r of t.values())r.kind===e&&!/.+\/rtx$/i.test(r.mimeType)&&r.rtcpFeedback.push(i)}for(const t of s.ext||[]){if(t["encrypt-uri"])continue;const i={kind:e,uri:t.uri,preferredId:t.value};r.push(i)}}return{codecs:Array.from(t.values()),headerExtensions:r}}function Tc({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let i;switch(t.setup){case"active":i="client";break;case"passive":i="server";break;case"actpass":i="auto"}return{role:i,fingerprints:[{algorithm:r.type,value:r.hash}]}}function bc({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""}function wc({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e||!(t.rtp||[]).find((e=>e.payload===r.payloadType)))continue;t.fmtp=t.fmtp||[];let i=t.fmtp.find((e=>e.payload===r.payloadType));i||(i={payload:r.payloadType,config:""},t.fmtp.push(i));const n=g.Sl(i.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(n.stereo=e?1:0);break}}i.config="";for(const e of Object.keys(n))i.config&&(i.config+=";"),i.config+=`${e}=${n[e]}`}}function kc({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const i of e.ssrcGroups||[]){if("FID"!==i.semantics)continue;let[e,n]=i.ssrcs.split(/\s+/);e=Number(e),n=Number(n),t.has(e)&&(t.delete(e),t.delete(n),r.set(e,n))}for(const e of t)r.set(e,null);const i=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),i.push(r)}return i}function Rc({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new Error("a=ssrc line with msid information not found");const[i,n]=r.value.split(" "),s=r.id;let o;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===s&&(o=Number(t[1]),!0)}));const a=e.ssrcs.find((e=>"cname"===e.attribute));if(!a)throw new Error("a=ssrc line with cname information not found");const c=a.value,d=[],l=[];for(let e=0;e<t;++e)d.push(s+e),o&&l.push(o+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let t=0;t<d.length;++t){const r=d[t];e.ssrcs.push({id:r,attribute:"cname",value:c}),e.ssrcs.push({id:r,attribute:"msid",value:`${i} ${n}`})}for(let t=0;t<l.length;++t){const r=d[t],s=l[t];e.ssrcs.push({id:s,attribute:"cname",value:c}),e.ssrcs.push({id:s,attribute:"msid",value:`${i} ${n}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${s}`})}}let Cc=class extends Aa{constructor(){super()}};class Ac{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i=!1}){if(this._mediaObject={},this._planB=i,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}muxSimulcastStreams(e){if(this._mediaObject.simulcast&&this._mediaObject.simulcast.list1){const t={};e.forEach((e=>{e.rid&&(t[e.rid]=e)}));const r=this._mediaObject.simulcast.list1,i=g.hy(r);i.forEach((e=>{e.forEach((e=>{var r;e.paused=!(null!==(r=t[e.scid])&&void 0!==r&&r.active)}))})),this._mediaObject.simulcast.list1=i.map((e=>e.map((e=>`${e.paused?"~":""}${e.scid}`)).join(","))).join(";")}}}class Ic extends Ac{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:n,planB:s=!1,offerMediaObject:o,offerRtpParameters:a,answerRtpParameters:c,codecOptions:d,extmapAllowMixed:l=!1,forceGoogConference:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:s}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of c.codecs){const t={payload:e.payloadType,codec:Dc(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=Da(e.parameters,{});if(d){const{opusStereo:t,opusFec:i,opusDtx:n,opusMaxPlaybackRate:s,opusMaxAverageBitrate:o,opusPtime:c,videoGoogleStartBitrate:l,videoGoogleMaxBitrate:u,videoGoogleMinBitrate:p}=d,h=a.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(h.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==i&&(h.parameters.useinbandfec=i?1:0,r.useinbandfec=i?1:0),void 0!==n&&(h.parameters.usedtx=n?1:0,r.usedtx=n?1:0),void 0!==s&&(r.maxplaybackrate=s),void 0!==o&&(r.maxaveragebitrate=o),void 0!==c&&(h.parameters.ptime=c,r.ptime=c);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==l&&(r["x-google-start-bitrate"]=l),void 0!==u&&(r["x-google-max-bitrate"]=u),void 0!==p&&(r["x-google-min-bitrate"]=p)}}const i={payload:e.payloadType,config:""};for(const e of Object.keys(r))i.config&&(i.config+=";"),i.config+=`${e}=${r[e]}`;i.config&&this._mediaObject.fmtp.push(i);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions)(o.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id});if(l&&"extmap-allow-mixed"===o.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",(this._planB||u)&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof o.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var t;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const r={};for(const t of e)t.rid&&(r[t.rid]=t);const i=this._mediaObject.simulcast.list1,n=g.hy(i);for(const e of n)for(const i of e)i.paused=!(null!==(t=r[i.scid])&&void 0!==t&&t.active);this._mediaObject.simulcast.list1=n.map((e=>e.map((e=>`${e.paused?"~":""}${e.scid}`)).join(","))).join(";")}}class Pc extends Ac{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:n,planB:s=!1,mid:o,kind:a,offerRtpParameters:c,streamId:d,trackId:l,oldDataChannelSpec:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:s}),this._mediaObject.mid=String(o),this._mediaObject.type=a,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=i?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),a){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${d||"-"} ${l}`);for(const e of c.codecs){const t={payload:e.payloadType,codec:Dc(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(const t of Object.keys(e.parameters))r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=c.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${d||"-"} ${l}`}),r&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${d||"-"} ${l}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":u?(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const i=e.encodings[0],n=i.ssrc,s=i.rtx&&i.rtx.ssrc?i.rtx.ssrc:void 0,o=this._mediaObject.payloads.split(" ");for(const t of e.codecs){if(o.includes(String(t.payloadType)))continue;const e={payload:t.payloadType,codec:Dc(t),rate:t.clockRate};t.channels>1&&(e.encoding=t.channels),this._mediaObject.rtp.push(e);const r={payload:t.payloadType,config:""};for(const e of Object.keys(t.parameters))r.config&&(r.config+=";"),r.config+=`${e}=${t.parameters[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const e of t.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:e.type,subtype:e.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter((e=>!this._mediaObject.payloads.includes(e.payloadType))).map((e=>e.payloadType)).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${r}`}),s&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${s}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,i=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==i)),i&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${i}`)))}}function Dc(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}const Mc=new Ra("RemoteSdp");class Oc{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:n,planB:s=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=i,this._plainRtpParameters=n,this._planB=s,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){Mc.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){Mc.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:i,codecOptions:n,extmapAllowMixed:s=!1,forceGoogConference:o=!1}){const a=new Ic({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:i,codecOptions:n,extmapAllowMixed:s,forceGoogConference:o});t?this._replaceMediaSection(a,t):this._midToIndex.has(a.mid)?this._replaceMediaSection(a):this._addMediaSection(a)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:i,trackId:n}){const s=this._midToIndex.get(e);let o;if(void 0!==s&&(o=this._mediaSections[s]),o)o.planBReceive({offerRtpParameters:r,streamId:i,trackId:n}),this._replaceMediaSection(o);else{o=new Pc({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:i,trackId:n});const s=this._mediaSections.find((e=>e.closed));s?this._replaceMediaSection(o,s.mid):this._addMediaSection(o)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const t=this._findMediaSection(e);return e===this._firstMid?(Mc.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){const r=this._midToIndex.get(e);if(void 0===r)throw new Error(`no media section found with mid '${e}'`);const i=this._mediaSections[r];if(void 0===i)throw new Error(`no media section found with idx '${r}'`);i.muxSimulcastStreams(t),this._replaceMediaSection(i)}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._findMediaSection(e);r.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const t=new Ic({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new Pc({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,g.M9(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const i=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(i.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_findMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}const Nc=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function xc(e){const t=Nc.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}const Lc=new Ra("Chrome70"),jc={OS:1024,MIS:1024};class Uc extends Cc{static createFactory(){return()=>new Uc}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(Lc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Lc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Ec({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Lc.debug("getNativeSctpCapabilities()"),{numStreams:jc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Lc.debug("run()"),this._direction=e,this._remoteSdp=new Oc({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Ha("audio",d),video:Ha("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(qt({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(Lc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){return tr(this,null,(function*(){Lc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Lc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Lc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Lc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),Lc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=$a(s.codecs,i);const o=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=$a(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d,l=yield this._pc.createOffer(),u=g.qg(l.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:u})),t&&t.length>1&&(Lc.debug("send() | enabling legacy simulcast"),u=g.qg(l.sdp),d=u.media[a.idx],Rc({offerMediaObject:d,numStreams:t.length}),l={type:"offer",sdp:g.M9(u)});let p=!1;const h=xc((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&h.spatialLayers>1&&"video/vp9"===s.codecs[0].mimeType.toLowerCase()&&(Lc.debug("send() | enabling legacy simulcast for VP9 SVC"),p=!0,u=g.qg(l.sdp),d=u.media[a.idx],Rc({offerMediaObject:d,numStreams:h.spatialLayers}),l={type:"offer",sdp:g.M9(u)}),Lc.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),yield this._pc.setLocalDescription(l),t){Lc.debug("send() | applying given encodings");const e=c.sender.getParameters();for(let r=0;r<(e.encodings||[]).length;++r){const i=e.encodings[r],n=t[r];if(!n)break;e.encodings[r]=Object.assign(i,n)}yield c.sender.setParameters(e)}const m=c.mid;if(s.mid=m,u=g.qg(this._pc.localDescription.sdp),d=u.media[a.idx],s.rtcp.cname=bc({offerMediaObject:d}),s.encodings=kc({offerMediaObject:d}),t)for(let e=0;e<s.encodings.length;++e)t[e]&&Object.assign(s.encodings[e],t[e]);if(p&&(s.encodings=[s.encodings[0]]),s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};return Lc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),yield this._pc.setRemoteDescription(f),this._mapMidTransceiver.set(m,c),{localId:m,rtpParameters:s,rtpSender:c.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Lc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Lc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){}))}resumeSending(e){return tr(this,null,(function*(){}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Lc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Lc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Lc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Lc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Lc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Lc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};Lc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%jc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Lc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;Lc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=n.mid||String(this._mapMidTransceiver.size);i.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),yield this._pc.setRemoteDescription(n);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===n))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Lc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Lc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Lc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){}))}resumeReceiving(e){return tr(this,null,(function*(){}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:a,protocol:r};Lc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}Lc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Tc({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}const Fc=new Ra("Chrome74"),Vc={OS:1024,MIS:1024};let Bc=class e extends Cc{static createFactory(){return()=>new e}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(Fc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Fc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Ec({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Fc.debug("getNativeSctpCapabilities()"),{numStreams:Vc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Fc.debug("run()"),this._direction=e,this._remoteSdp=new Oc({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Ha("audio",d),video:Ha("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(qt({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(Fc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}updateIceServers(e){return tr(this,null,(function*(){Fc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Fc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Fc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Fc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:i}){var n,s;this.assertSendDirection(),Fc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach(((e,t)=>{e.rid=`r${t}`}));const o=Da(this._sendingRtpParametersByKind[e.kind],{});o.codecs=$a(o.codecs,i);const a=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});a.codecs=$a(a.codecs,i);const c=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let l,u=yield this._pc.createOffer(),p=g.qg(u.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:p}));let h=!1;const m=xc((t||[{}])[0].scalabilityMode);t&&1===t.length&&m.spatialLayers>1&&"video/vp9"===o.codecs[0].mimeType.toLowerCase()&&(Fc.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,p=g.qg(u.sdp),l=p.media[c.idx],Rc({offerMediaObject:l,numStreams:m.spatialLayers}),u={type:"offer",sdp:g.M9(p)}),Fc.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),yield this._pc.setLocalDescription(u);const f=d.mid;if(o.mid=f,p=g.qg(this._pc.localDescription.sdp),l=p.media[c.idx],o.rtcp.cname=bc({offerMediaObject:l}),t)if(1===t.length){let e=kc({offerMediaObject:l});Object.assign(e[0],t[0]),h&&(e=[e[0]]),o.encodings=e}else o.encodings=t;else o.encodings=kc({offerMediaObject:l});if(o.encodings.length>1&&("video/vp8"===o.codecs[0].mimeType.toLowerCase()||"video/h264"===o.codecs[0].mimeType.toLowerCase()))for(const e of o.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${m.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:l,reuseMid:c.reuseMid,offerRtpParameters:o,answerRtpParameters:a,codecOptions:r,extmapAllowMixed:!0,forceGoogConference:null!==(s=null==r?void 0:r.forceGoogConference)&&void 0!==s&&s});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return Fc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),yield this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(f,d),{localId:f,rtpParameters:o,rtpSender:d.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Fc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Fc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=yield this._pc.createOffer();Fc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Fc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Fc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Fc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Fc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};Fc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Vc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Fc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;Fc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=n.mid||String(this._mapMidTransceiver.size);i.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),yield this._pc.setRemoteDescription(n);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===n))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Fc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Fc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Fc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Fc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Fc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Fc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Fc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:r};Fc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}Fc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Tc({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}};const Wc=new Ra("Chrome111"),Hc={OS:1024,MIS:1024};class Gc extends Cc{static createFactory(){return()=>new Gc}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(Wc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Wc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Ec({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Wc.debug("getNativeSctpCapabilities()"),{numStreams:Hc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Wc.debug("run()"),this._direction=e,this._remoteSdp=new Oc({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Ha("audio",d),video:Ha("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(qt({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(Wc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}updateIceServers(e){return tr(this,null,(function*(){Wc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Wc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Wc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Wc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Wc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Wc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:i}){var n;if(this.assertSendDirection(),Wc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){t.forEach(((e,t)=>{e.rid=`r${t}`}));let e=1,r=1;for(const e of t){const t=e.scalabilityMode?xc(e.scalabilityMode).temporalLayers:3;t>r&&(r=t)}for(const i of t)i.rid="r"+e++,i.scalabilityMode=`L1T${r}`}const s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=$a(s.codecs,i);const o=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=$a(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),d=yield this._pc.createOffer();let l=g.qg(d.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:l})),Wc.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),yield this._pc.setLocalDescription(d);const u=c.mid;s.mid=u,l=g.qg(this._pc.localDescription.sdp);const p=l.media[a.idx];if(s.rtcp.cname=bc({offerMediaObject:p}),t)if(1===t.length){const e=kc({offerMediaObject:p});Object.assign(e[0],t[0]),s.encodings=e}else s.encodings=t;else s.encodings=kc({offerMediaObject:p});this._remoteSdp.send({offerMediaObject:p,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return Wc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),yield this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(u,c),{localId:u,rtpParameters:s,rtpSender:c.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Wc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Wc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Wc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Wc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Wc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Wc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Wc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=yield this._pc.createOffer();Wc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Wc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Wc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Wc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Wc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Wc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Wc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Wc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Wc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Wc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};Wc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Hc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Wc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};Wc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;Wc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=n.mid||String(this._mapMidTransceiver.size);i.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};Wc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),yield this._pc.setRemoteDescription(n);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===n))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Wc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Wc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Wc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Wc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Wc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Wc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Wc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Wc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Wc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Wc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:r};Wc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Wc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}Wc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Tc({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}function $c(e){const t=Da(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const e of t.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return t}const qc=new Ra("Edge11");class zc extends Cc{static createFactory(){return()=>new zc}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){qc.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){return qc.debug("getNativeRtpCapabilities()"),function(){const e=Da(RTCRtpReceiver.getCapabilities(),{});for(const t of e.codecs){if(t.channels=t.numChannels,delete t.numChannels,t.mimeType=t.mimeType||`${t.kind}/${t.name}`,t.parameters){const e=t.parameters;e.apt&&(e.apt=Number(e.apt)),e["packetization-mode"]&&(e["packetization-mode"]=Number(e["packetization-mode"]))}for(const e of t.rtcpFeedback||[])e.parameter||(e.parameter="")}return e}()}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return qc.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){qc.debug("run()"),this._sendingRtpParametersByKind={audio:Ha("audio",d),video:Ha("video",d)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=i,this._cname=`CNAME-${Ma()}`,this.setIceGatherer({iceServers:s,iceTransportPolicy:o}),this.setIceTransport(),this.setDtlsTransport()}updateIceServers(e){return tr(this,null,(function*(){throw new Ia("not supported")}))}restartIce(e){return tr(this,null,(function*(){if(qc.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){qc.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}))}getTransportStats(){return tr(this,null,(function*(){return this._iceTransport.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:i}){qc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"})),qc.debug("send() | calling new RTCRtpSender()");const n=new RTCRtpSender(e,this._dtlsTransport),s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=$a(s.codecs,i);const o=s.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType)));t||(t=[{}]);for(const e of t)e.ssrc=Ma(),o&&(e.rtx={ssrc:Ma()});s.encodings=t,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const a=$c(s);qc.debug("send() | calling rtpSender.send() [params:%o]",a),yield n.send(a);const c=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(c,n),{localId:c,rtpParameters:s,rtpSender:n}}))}stopSending(e){return tr(this,null,(function*(){qc.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{qc.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw qc.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}))}pauseSending(e){return tr(this,null,(function*(){}))}resumeSending(e){return tr(this,null,(function*(){}))}replaceTrack(e,t){return tr(this,null,(function*(){t?qc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):qc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){qc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.setParameters(i)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){qc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const i=r.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.setParameters(i)}))}getSenderStats(e){return tr(this,null,(function*(){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}))}sendDataChannel(e){return tr(this,null,(function*(){throw new Ia("not implemented")}))}receive(e){return tr(this,null,(function*(){const t=[];for(const t of e){const{trackId:e,kind:r}=t;qc.debug("receive() [trackId:%s, kind:%s]",e,r)}this._transportReady||(yield this.setupTransport({localDtlsRole:"server"}));for(const r of e){const{trackId:e,kind:i,rtpParameters:n}=r;qc.debug("receive() | calling new RTCRtpReceiver()");const s=new RTCRtpReceiver(this._dtlsTransport,i);s.addEventListener("error",(e=>{qc.error('rtpReceiver "error" event [event:%o]',e)}));const o=$c(n);qc.debug("receive() | calling rtpReceiver.receive() [params:%o]",o),yield s.receive(o);const a=e;this._rtpReceivers.set(a,s),t.push({localId:a,track:s.track,rtpReceiver:s})}return t}))}stopReceiving(e){return tr(this,null,(function*(){for(const t of e){qc.debug("stopReceiving() [localId:%s]",t);const e=this._rtpReceivers.get(t);if(!e)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(t);try{qc.debug("stopReceiving() | calling rtpReceiver.stop()"),e.stop()}catch(e){qc.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}}))}pauseReceiving(e){return tr(this,null,(function*(){}))}resumeReceiving(e){return tr(this,null,(function*(){}))}getReceiverStats(e){return tr(this,null,(function*(){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}))}receiveDataChannel(e){return tr(this,null,(function*(){throw new Ia("not implemented")}))}setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",(e=>{qc.error('iceGatherer "error" event [event:%o]',e)}));try{r.gather()}catch(e){qc.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{qc.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{qc.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{qc.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{qc.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e}){qc.debug("setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,yield new Promise(((e,r)=>{this.safeEmit("@connect",{dtlsParameters:t},e,r)})),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}))}}const Jc=new Ra("Firefox60"),Kc={OS:16,MIS:2048};let Yc=class e extends Cc{static createFactory(t=!1){return()=>new e(t)}constructor(e=!1){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1,this.supportsSendEncoding=!1,this.supportsSendEncoding=e}get name(){return"Firefox60"}close(){if(Jc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Jc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const i=e.addTransceiver(r,{direction:"sendrecv"}),n=i.sender.getParameters(),s=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];n.encodings=s,yield i.sender.setParameters(n);const o=yield e.createOffer();try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}return Ec({sdpObject:g.qg(o.sdp)})}catch(i){try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}throw i}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Jc.debug("getNativeSctpCapabilities()"),{numStreams:Kc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Jc.debug("run()"),this._direction=e,this._remoteSdp=new Oc({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Ha("audio",d),video:Ha("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},this._pc=new RTCPeerConnection(qt({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(Jc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){return tr(this,null,(function*(){throw new Ia("not supported")}))}restartIce(e){return tr(this,null,(function*(){if(Jc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Jc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Jc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:i}){this.assertSendDirection(),Jc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=Da(t,[])).length>1&&(t.forEach(((e,t)=>{e.rid=`r${t}`})),t.reverse());const n=Da(this._sendingRtpParametersByKind[e.kind],{});n.codecs=$a(n.codecs,i);const s=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=$a(s.codecs,i);const o=this.supportsSendEncoding&&void 0!==t?{sendEncodings:t}:{},a=this._pc.addTransceiver(e,qt({direction:"sendonly",streams:[this._sendStream]},o));if(!this.supportsSendEncoding&&t){const e=a.sender.getParameters();e.encodings=t,yield a.sender.setParameters(e)}const c=yield this._pc.createOffer();let d=g.qg(c.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:d}));const l=xc((t||[{}])[0].scalabilityMode);Jc.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),yield this._pc.setLocalDescription(c);const u=a.mid;n.mid=u,d=g.qg(this._pc.localDescription.sdp);const p=d.media[d.media.length-1];if(n.rtcp.cname=bc({offerMediaObject:p}),t)if(1===t.length){const e=kc({offerMediaObject:p});Object.assign(e[0],t[0]),n.encodings=e}else n.encodings=t.reverse();else n.encodings=kc({offerMediaObject:p});if(n.encodings.length>1&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const e of n.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${l.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:n,answerRtpParameters:s,codecOptions:r,extmapAllowMixed:!0});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return Jc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),yield this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(u,a),{localId:u,rtpParameters:n,rtpSender:a.sender}}))}stopSending(e){return tr(this,null,(function*(){Jc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=yield this._pc.createOffer();Jc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Jc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=yield this._pc.createOffer();Jc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Jc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Jc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const i=r.sender.getParameters();t=i.encodings.length-1-t,i.encodings.forEach(((e,r)=>{e.active=r>=t})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Jc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Jc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};Jc.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(i,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Kc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:t})),Jc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=[],r=new Map;for(const t of e){const{trackId:e,kind:i,rtpParameters:n,streamId:s}=t;Jc.debug("receive() [trackId:%s, kind:%s]",e,i);const o=n.mid||String(this._mapMidTransceiver.size);r.set(e,o),this._remoteSdp.receive({mid:o,kind:i,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),yield this._pc.setRemoteDescription(i);let n=yield this._pc.createAnswer();const s=g.qg(n.sdp);for(const t of e){const{trackId:e,rtpParameters:i}=t,o=r.get(e);wc({offerRtpParameters:i,answerMediaObject:s.media.find((e=>String(e.mid)===o))}),n={type:"answer",sdp:g.M9(s)}}this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:s})),Jc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),yield this._pc.setLocalDescription(n);for(const i of e){const{trackId:e}=i,n=r.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),t.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return t}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Jc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Jc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Jc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Jc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Jc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Jc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:i,ordered:n,maxPacketLifeTime:s,maxRetransmits:o}=e,a={negotiated:!0,id:i,ordered:n,maxPacketLifeTime:s,maxRetransmits:o,protocol:r};Jc.debug("receiveDataChannel() [options:%o]",a);const c=this._pc.createDataChannel(t,a);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:"client",localSdpObject:e})}Jc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Tc({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}};const Qc=new Ra("Safari12"),Xc={OS:1024,MIS:1024};let Zc=class e extends Cc{static createFactory(){return()=>new e}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(Qc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Qc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Ec({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Qc.debug("getNativeSctpCapabilities()"),{numStreams:Xc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Qc.debug("run()"),this._direction=e,this._remoteSdp=new Oc({iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Ha("audio",d),video:Ha("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},i.role&&"auto"!==i.role&&(this._forcedLocalDtlsRole="server"===i.role?"client":"server"),this._pc=new RTCPeerConnection(qt({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(Qc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){return tr(this,null,(function*(){Qc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Qc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Qc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Qc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Qc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Qc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:i}){var n;this.assertSendDirection(),Qc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=$a(s.codecs,i);const o=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=$a(o.codecs,i);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d,l=yield this._pc.createOffer(),u=g.qg(l.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:u}));const p=xc((t||[{}])[0].scalabilityMode);t&&t.length>1&&(Qc.debug("send() | enabling legacy simulcast"),u=g.qg(l.sdp),d=u.media[a.idx],Rc({offerMediaObject:d,numStreams:t.length}),l={type:"offer",sdp:g.M9(u)}),Qc.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),yield this._pc.setLocalDescription(l);const h=c.mid;if(s.mid=h,u=g.qg(this._pc.localDescription.sdp),d=u.media[a.idx],s.rtcp.cname=bc({offerMediaObject:d}),s.encodings=kc({offerMediaObject:d}),t)for(let e=0;e<s.encodings.length;++e)t[e]&&Object.assign(s.encodings[e],t[e]);if(s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${p.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return Qc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),yield this._pc.setRemoteDescription(m),this._mapMidTransceiver.set(h,c),{localId:h,rtpParameters:s,rtpSender:c.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Qc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Qc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Qc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Qc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Qc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Qc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Qc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=yield this._pc.createOffer();Qc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Qc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Qc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Qc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Qc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Qc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Qc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Qc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);const n=yield this._pc.createOffer();Qc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),yield this._pc.setLocalDescription(n);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Qc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:i,protocol:n}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};Qc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Xc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Qc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const i={type:"answer",sdp:this._remoteSdp.getSdp()};Qc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),yield this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],i=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:n,streamId:s}=t;Qc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=n.mid||String(this._mapMidTransceiver.size);i.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:n,streamId:s||n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};Qc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),yield this._pc.setRemoteDescription(n);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,n=i.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===n))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Qc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,n=i.get(e),s=this._pc.getTransceivers().find((e=>e.mid===n));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,s),r.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Qc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Qc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Qc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Qc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Qc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Qc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Qc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Qc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Qc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var i;this.assertRecvDirection();const{streamId:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:n,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:r};Qc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Qc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:e})}Qc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Tc({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},ed=class extends Sc{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){super({handlerName:e,handlerFactory:t,Handler:r})}switchDevice(e){switch(e){case"Chrome111":this._handlerFactory=Gc.createFactory();break;case"Chrome74":this._handlerFactory=Bc.createFactory();break;case"Chrome70":this._handlerFactory=Uc.createFactory();break;case"Firefox111":this._handlerFactory=Yc.createFactory(!0);break;case"Firefox60":this._handlerFactory=Yc.createFactory(!1);break;case"Safari12":this._handlerFactory=Zc.createFactory();break;case"Edge11":this._handlerFactory=zc.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}};const td={roomName:void 0,authToken:void 0,peerId:void 0,apiBase:void 0,baseURI:void 0,defaults:{audio:!0,video:!0},modules:void 0,organizationId:void 0,overrides:{},viewType:void 0,env:void 0};function rd(e){var t;null!=td.roomName||(td.roomName=null==e?void 0:e.roomName),null!=td.authToken||(td.authToken=null==e?void 0:e.authToken),null!=td.peerId||(td.peerId=null==e?void 0:e.peerId),null!=td.apiBase||(td.apiBase=null==e?void 0:e.apiBase),null!=td.baseURI||(td.baseURI=null==e?void 0:e.baseURI),null!=td.modules||(td.modules=null==e?void 0:e.modules),null!=td.organizationId||(td.organizationId=null==e?void 0:e.organizationId),td.defaults=qt(qt({},td.defaults),null!=(t=null==e?void 0:e.defaults)?t:{}),null!=td.env||(td.env=Nr),td.apiBase&&(td.apiBase.includes("api.cluster.dyte")||td.apiBase.includes("api.dyte")?td.env=Nr:td.apiBase.includes("api.preprod.dyte")?td.env="preprod":td.apiBase.includes("api.devel.dyte")&&(td.env="devel"))}const id="1.30.0",nd="web-core";function sd({servicePrefix:e,apiBase:t,baseURI:r}){return r?`${e}.${r}`:null!=t&&t.includes("api.preprod.dyte")?`${e}.preprod.dyte.io`:null!=t&&t.includes("api.devel.dyte")?`${e}.devel.dyte.io`:`${e}.dyte.io`}var od=NaN;function ad(e){return"number"==typeof e?e:Jo(e)?od:+e}function cd(e,t){return function(r,i){var n;if(void 0===r&&void 0===i)return t;if(void 0!==r&&(n=r),void 0!==i){if(void 0===n)return i;"string"==typeof r||"string"==typeof i?(r=da(r),i=da(i)):(r=ad(r),i=ad(i)),n=e(r,i)}return n}}var dd=cd((function(e,t){return e+t}),0);const ld=dd;var ud=/\s/;function pd(e){for(var t=e.length;t--&&ud.test(e.charAt(t)););return t}var hd=/^\s+/;function md(e){return e&&e.slice(0,pd(e)+1).replace(hd,"")}var fd=NaN,gd=/^[-+]0x[0-9a-f]+$/i,vd=/^0b[01]+$/i,yd=/^0o[0-7]+$/i,_d=parseInt;function Sd(e){if("number"==typeof e)return e;if(Jo(e))return fd;if(Yi(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Yi(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=md(e);var r=vd.test(e);return r||yd.test(e)?_d(e.slice(2),r?2:8):gd.test(e)?fd:+e}var Ed=1/0,Td=17976931348623157e292;function bd(e){return e?(e=Sd(e))===Ed||e===-Ed?(e<0?-1:1)*Td:e==e?e:0:0===e?e:0}function wd(e){var t=bd(e),r=t%1;return t==t?r?t-r:t:0}function kd(e){return e}const Rd=Fs&&new Fs;var Cd=Rd?function(e,t){return Rd.set(e,t),e}:kd;const Ad=Cd;function Id(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Co(e.prototype),i=e.apply(r,t);return Yi(i)?i:r}}var Pd=1;function Dd(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var Md=Math.max;function Od(e,t,r,i){for(var n=-1,s=e.length,o=r.length,a=-1,c=t.length,d=Md(s-o,0),l=Array(c+d),u=!i;++a<c;)l[a]=t[a];for(;++n<o;)(u||n<s)&&(l[r[n]]=e[n]);for(;d--;)l[a++]=e[n++];return l}var Nd=Math.max;function xd(e,t,r,i){for(var n=-1,s=e.length,o=-1,a=r.length,c=-1,d=t.length,l=Nd(s-a,0),u=Array(l+d),p=!i;++n<l;)u[n]=e[n];for(var h=n;++c<d;)u[h+c]=t[c];for(;++o<a;)(p||n<s)&&(u[h+r[o]]=e[n++]);return u}function Ld(){}var jd=4294967295;function Ud(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=jd,this.__views__=[]}function Fd(){}Ud.prototype=Co(Ld.prototype),Ud.prototype.constructor=Ud;var Vd=Rd?function(e){return Rd.get(e)}:Fd;const Bd=Vd,Wd={};var Hd=Object.prototype.hasOwnProperty;function Gd(e){for(var t=e.name+"",r=Wd[t],i=Hd.call(Wd,t)?r.length:0;i--;){var n=r[i],s=n.func;if(null==s||s==e)return n.name}return t}function $d(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function qd(e){if(e instanceof Ud)return e.clone();var t=new $d(e.__wrapped__,e.__chain__);return t.__actions__=Ts(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}$d.prototype=Co(Ld.prototype),$d.prototype.constructor=$d;var zd=Object.prototype.hasOwnProperty;function Jd(e){if(Dn(e)&&!Un(e)&&!(e instanceof Ud)){if(e instanceof $d)return e;if(zd.call(e,"__wrapped__"))return qd(e)}return new $d(e)}function Kd(e){var t=Gd(e),r=Jd[t];if("function"!=typeof r||!(t in Ud.prototype))return!1;if(e===r)return!0;var i=Bd(r);return!!i&&e===i[0]}Jd.prototype=Ld.prototype,Jd.prototype.constructor=Jd;var Yd=Date.now;function Qd(e){var t=0,r=0;return function(){var i=Yd(),n=16-(i-r);if(r=i,n>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}const Xd=Qd(Ad);var Zd=/\{\n\/\* \[wrapped with (.+)\] \*/,el=/,? & /,tl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;function rl(e){return function(){return e}}var il=kn?function(e,t){return kn(e,"toString",{configurable:!0,enumerable:!1,value:rl(t),writable:!0})}:kd;const nl=Qd(il);function sl(e,t,r,i){for(var n=e.length,s=r+(i?1:-1);i?s--:++s<n;)if(t(e[s],s,e))return s;return-1}function ol(e){return e!=e}function al(e,t,r){return t==t?function(e,t,r){for(var i=r-1,n=e.length;++i<n;)if(e[i]===t)return i;return-1}(e,t,r):sl(e,ol,r)}function cl(e,t){return!(null==e||!e.length)&&al(e,t,0)>-1}var dl=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];function ll(e,t,r){var i=t+"";return nl(e,function(e,t){var r=t.length;if(!r)return e;var i=r-1;return t[i]=(r>1?"& ":"")+t[i],t=t.join(r>2?", ":" "),e.replace(tl,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return bn(dl,(function(r){var i="_."+r[0];t&r[1]&&!cl(e,i)&&e.push(i)})),e.sort()}(function(e){var t=e.match(Zd);return t?t[1].split(el):[]}(i),r)))}var ul=1,pl=2,hl=4,ml=8,fl=32,gl=64;function vl(e,t,r,i,n,s,o,a,c,d){var l=t&ml;t|=l?fl:gl,(t&=~(l?gl:fl))&hl||(t&=~(ul|pl));var u=[e,t,n,l?s:void 0,l?o:void 0,l?void 0:s,l?void 0:o,a,c,d],p=r.apply(void 0,u);return Kd(e)&&Xd(p,u),p.placeholder=i,ll(p,e,t)}function yl(e){return e.placeholder}var _l=Math.min,Sl="__lodash_placeholder__";function El(e,t){for(var r=-1,i=e.length,n=0,s=[];++r<i;){var o=e[r];(o===t||o===Sl)&&(e[r]=Sl,s[n++]=r)}return s}var Tl=1,bl=2,wl=8,kl=16,Rl=128,Cl=512;function Al(e,t,r,i,n,s,o,a,c,d){var l=t&Rl,u=t&Tl,p=t&bl,h=t&(wl|kl),m=t&Cl,f=p?void 0:Id(e);return function g(){for(var v=arguments.length,y=Array(v),_=v;_--;)y[_]=arguments[_];if(h)var S=yl(g),E=function(e,t){for(var r=e.length,i=0;r--;)e[r]===t&&++i;return i}(y,S);if(i&&(y=Od(y,i,n,h)),s&&(y=xd(y,s,o,h)),v-=E,h&&v<d){var T=El(y,S);return vl(e,t,Al,g.placeholder,r,y,T,a,c,d-v)}var b=u?r:this,w=p?b[e]:e;return v=y.length,a?y=function(e,t){for(var r=e.length,i=_l(t.length,r),n=Ts(e);i--;){var s=t[i];e[i]=qn(s,r)?n[s]:void 0}return e}(y,a):m&&v>1&&y.reverse(),l&&c<v&&(y.length=c),this&&this!==Fi&&this instanceof g&&(w=f||Id(w)),w.apply(b,y)}}var Il=1,Pl="__lodash_placeholder__",Dl=1,Ml=2,Ol=4,Nl=8,xl=128,Ll=256,jl=Math.min,Ul="Expected a function",Fl=1,Vl=2,Bl=8,Wl=16,Hl=32,Gl=64,$l=Math.max;function ql(e,t,r,i,n,s,o,a){var c=t&Vl;if(!c&&"function"!=typeof e)throw new TypeError(Ul);var d=i?i.length:0;if(d||(t&=~(Hl|Gl),i=n=void 0),o=void 0===o?o:$l(wd(o),0),a=void 0===a?a:wd(a),d-=n?n.length:0,t&Gl){var l=i,u=n;i=n=void 0}var p=c?void 0:Bd(e),h=[e,t,r,i,n,l,u,s,o,a];if(p&&function(e,t){var r=e[1],i=t[1],n=r|i,s=n<(Dl|Ml|xl),o=i==xl&&r==Nl||i==xl&&r==Ll&&e[7].length<=t[8]||i==(xl|Ll)&&t[7].length<=t[8]&&r==Nl;if(!s&&!o)return e;i&Dl&&(e[2]=t[2],n|=r&Dl?0:Ol);var a=t[3];if(a){var c=e[3];e[3]=c?Od(c,a,t[4]):a,e[4]=c?El(e[3],Pl):t[4]}(a=t[5])&&(c=e[5],e[5]=c?xd(c,a,t[6]):a,e[6]=c?El(e[5],Pl):t[6]),(a=t[7])&&(e[7]=a),i&xl&&(e[8]=null==e[8]?t[8]:jl(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=n}(h,p),e=h[0],t=h[1],r=h[2],i=h[3],n=h[4],!(a=h[9]=void 0===h[9]?c?0:e.length:$l(h[9]-d,0))&&t&(Bl|Wl)&&(t&=~(Bl|Wl)),t&&t!=Fl)m=t==Bl||t==Wl?function(e,t,r){var i=Id(e);return function n(){for(var s=arguments.length,o=Array(s),a=s,c=yl(n);a--;)o[a]=arguments[a];var d=s<3&&o[0]!==c&&o[s-1]!==c?[]:El(o,c);return(s-=d.length)<r?vl(e,t,Al,n.placeholder,void 0,o,d,void 0,void 0,r-s):Dd(this&&this!==Fi&&this instanceof n?i:e,this,o)}}(e,t,a):t!=Hl&&t!=(Fl|Hl)||n.length?Al.apply(void 0,h):function(e,t,r,i){var n=t&Il,s=Id(e);return function t(){for(var o=-1,a=arguments.length,c=-1,d=i.length,l=Array(d+a),u=this&&this!==Fi&&this instanceof t?s:e;++c<d;)l[c]=i[c];for(;a--;)l[c++]=arguments[++o];return Dd(u,n?r:this,l)}}(e,t,r,i);else var m=function(e,t,r){var i=t&Pd,n=Id(e);return function t(){return(this&&this!==Fi&&this instanceof t?n:e).apply(i?r:this,arguments)}}(e,t,r);return ll((p?Ad:Xd)(m,h),e,t)}function zl(e,t,r){return t=r?void 0:t,ql(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}var Jl=Math.max;function Kl(e,t,r){return t=Jl(void 0===t?e.length-1:t,0),function(){for(var i=arguments,n=-1,s=Jl(i.length-t,0),o=Array(s);++n<s;)o[n]=i[t+n];n=-1;for(var a=Array(t+1);++n<t;)a[n]=i[n];return a[t]=r(o),Dd(e,this,a)}}function Yl(e,t){return nl(Kl(e,t,kd),e+"")}function Ql(e,t,r){if(!Yi(r))return!1;var i=typeof t;return!!("number"==i?ps(r)&&qn(t,r.length):"string"==i&&t in r)&&Oi(r[t],e)}function Xl(e){return Yl((function(t,r){var i=-1,n=r.length,s=n>1?r[n-1]:void 0,o=n>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(n--,s):void 0,o&&Ql(r[0],r[1],o)&&(s=n<3?void 0:s,n=1),t=Object(t);++i<n;){var a=r[i];a&&e(t,a,i,s)}return t}))}var Zl=Object.prototype.hasOwnProperty,eu=Xl((function(e,t){if(as(t)||ps(t))In(t,hs(t),e);else for(var r in t)Zl.call(t,r)&&An(e,r,t[r])}));const tu=eu;var ru=Xl((function(e,t){In(t,gs(t),e)}));const iu=ru;var nu=Xl((function(e,t,r,i){In(t,gs(t),e,i)}));const su=nu;var ou=Xl((function(e,t,r,i){In(t,hs(t),e,i)}));const au=ou;function cu(e,t){for(var r=-1,i=t.length,n=Array(i),s=null==e;++r<i;)n[r]=s?void 0:fa(e,t[r]);return n}var du=Vi?Vi.isConcatSpreadable:void 0;function lu(e){return Un(e)||jn(e)||!!(du&&e&&e[du])}function uu(e,t,r,i,n){var s=-1,o=e.length;for(r||(r=lu),n||(n=[]);++s<o;){var a=e[s];t>0&&r(a)?t>1?uu(a,t-1,r,i,n):Is(n,a):i||(n[n.length]=a)}return n}function pu(e){return null!=e&&e.length?uu(e,1):[]}function hu(e){return nl(Kl(e,void 0,pu),e+"")}const mu=hu(cu);var fu="[object Object]",gu=Function.prototype,vu=Object.prototype,yu=gu.toString,_u=vu.hasOwnProperty,Su=yu.call(Object);function Eu(e){if(!Dn(e)||Ki(e)!=fu)return!1;var t=Ps(e);if(null===t)return!0;var r=_u.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&yu.call(r)==Su}function Tu(e){if(!Dn(e))return!1;var t=Ki(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Eu(e)}var bu=Yl((function(e,t){try{return Dd(e,void 0,t)}catch(e){return Tu(e)?e:new Error(e)}}));const wu=bu;function ku(e,t){var r;if("function"!=typeof t)throw new TypeError("Expected a function");return e=wd(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}var Ru=Yl((function(e,t,r){var i=1;if(r.length){var n=El(r,yl(Ru));i|=32}return ql(e,i,t,r,n)}));Ru.placeholder={};const Cu=Ru;var Au=hu((function(e,t){return bn(t,(function(t){t=ha(t),Rn(e,t,Cu(e[t],e))})),e}));const Iu=Au;var Pu=Yl((function(e,t,r){var i=3;if(r.length){var n=El(r,yl(Pu));i|=32}return ql(t,i,e,r,n)}));Pu.placeholder={};const Du=Pu;function Mu(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(r=r>n?n:r)<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(n);++i<n;)s[i]=e[i+t];return s}function Ou(e,t,r){var i=e.length;return r=void 0===r?i:r,!t&&r>=i?e:Mu(e,t,r)}var Nu=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function xu(e){return Nu.test(e)}var Lu="\\ud800-\\udfff",ju="["+Lu+"]",Uu="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Fu="\\ud83c[\\udffb-\\udfff]",Vu="[^"+Lu+"]",Bu="(?:\\ud83c[\\udde6-\\uddff]){2}",Wu="[\\ud800-\\udbff][\\udc00-\\udfff]",Hu="(?:"+Uu+"|"+Fu+")?",Gu="[\\ufe0e\\ufe0f]?",$u=Gu+Hu+"(?:\\u200d(?:"+[Vu,Bu,Wu].join("|")+")"+Gu+Hu+")*",qu="(?:"+[Vu+Uu+"?",Uu,Bu,Wu,ju].join("|")+")",zu=RegExp(Fu+"(?="+Fu+")|"+qu+$u,"g");function Ju(e){return xu(e)?function(e){return e.match(zu)||[]}(e):function(e){return e.split("")}(e)}function Ku(e){return function(t){var r=xu(t=la(t))?Ju(t):void 0,i=r?r[0]:t.charAt(0),n=r?Ou(r,1).join(""):t.slice(1);return i[e]()+n}}const Yu=Ku("toUpperCase");function Qu(e){return Yu(la(e).toLowerCase())}function Xu(e,t,r,i){var n=-1,s=null==e?0:e.length;for(i&&s&&(r=e[++n]);++n<s;)r=t(r,e[n],n,e);return r}function Zu(e){return function(t){return null==e?void 0:e[t]}}const ep=Zu({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});var tp=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,rp=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");function ip(e){return(e=la(e))&&e.replace(tp,ep).replace(rp,"")}var np=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,op="\\ud800-\\udfff",ap="\\u2700-\\u27bf",cp="a-z\\xdf-\\xf6\\xf8-\\xff",dp="A-Z\\xc0-\\xd6\\xd8-\\xde",lp="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",up="["+lp+"]",pp="\\d+",hp="["+ap+"]",mp="["+cp+"]",fp="[^"+op+lp+pp+ap+cp+dp+"]",gp="(?:\\ud83c[\\udde6-\\uddff]){2}",vp="[\\ud800-\\udbff][\\udc00-\\udfff]",yp="["+dp+"]",_p="(?:"+mp+"|"+fp+")",Sp="(?:"+yp+"|"+fp+")",Ep="(?:['’](?:d|ll|m|re|s|t|ve))?",Tp="(?:['’](?:D|LL|M|RE|S|T|VE))?",bp="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",wp="[\\ufe0e\\ufe0f]?",kp=wp+bp+"(?:\\u200d(?:"+["[^"+op+"]",gp,vp].join("|")+")"+wp+bp+")*",Rp="(?:"+[hp,gp,vp].join("|")+")"+kp,Cp=RegExp([yp+"?"+mp+"+"+Ep+"(?="+[up,yp,"$"].join("|")+")",Sp+"+"+Tp+"(?="+[up,yp+_p,"$"].join("|")+")",yp+"?"+_p+"+"+Ep,yp+"+"+Tp,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",pp,Rp].join("|"),"g");function Ap(e,t,r){return e=la(e),void 0===(t=r?void 0:t)?function(e){return sp.test(e)}(e)?function(e){return e.match(Cp)||[]}(e):function(e){return e.match(np)||[]}(e):e.match(t)||[]}var Ip=RegExp("['’]","g");function Pp(e){return function(t){return Xu(Ap(ip(t).replace(Ip,"")),e,"")}}var Dp=Pp((function(e,t,r){return t=t.toLowerCase(),e+(r?Qu(t):t)}));const Mp=Dp;var Op=Fi.isFinite,Np=Math.min;function xp(e){var t=Math[e];return function(e,r){if(e=Sd(e),(r=null==r?0:Np(wd(r),292))&&Op(e)){var i=(la(e)+"e").split("e");return+((i=(la(t(i[0]+"e"+(+i[1]+r)))+"e").split("e"))[0]+"e"+(+i[1]-r))}return t(e)}}const Lp=xp("ceil");function jp(e){var t=Jd(e);return t.__chain__=!0,t}var Up=Math.ceil,Fp=Math.max;function Vp(e,t,r){return e==e&&(void 0!==r&&(e=e<=r?e:r),void 0!==t&&(e=e>=t?e:t)),e}function Bp(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new En;++t<r;)this.add(e[t])}function Wp(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}function Hp(e,t){return e.has(t)}Bp.prototype.add=Bp.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Bp.prototype.has=function(e){return this.__data__.has(e)};var Gp=1,$p=2;function qp(e,t,r,i,n,s){var o=r&Gp,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var d=s.get(e),l=s.get(t);if(d&&l)return d==t&&l==e;var u=-1,p=!0,h=r&$p?new Bp:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var m=e[u],f=t[u];if(i)var g=o?i(f,m,u,t,e,s):i(m,f,u,e,t,s);if(void 0!==g){if(g)continue;p=!1;break}if(h){if(!Wp(t,(function(e,t){if(!Hp(h,t)&&(m===e||n(m,e,r,i,s)))return h.push(t)}))){p=!1;break}}else if(m!==f&&!n(m,f,r,i,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function zp(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}function Jp(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var Kp=1,Yp=2,Qp="[object Boolean]",Xp="[object Date]",Zp="[object Error]",eh="[object Map]",th="[object Number]",rh="[object RegExp]",ih="[object Set]",nh="[object String]",sh="[object Symbol]",oh="[object ArrayBuffer]",ah="[object DataView]",ch=Vi?Vi.prototype:void 0,dh=ch?ch.valueOf:void 0,lh=1,uh=Object.prototype.hasOwnProperty,ph=1,hh="[object Arguments]",mh="[object Array]",fh="[object Object]",gh=Object.prototype.hasOwnProperty;function vh(e,t,r,i,n){return e===t||(null==e||null==t||!Dn(e)&&!Dn(t)?e!=e&&t!=t:function(e,t,r,i,n,s){var o=Un(e),a=Un(t),c=o?mh:Qs(e),d=a?mh:Qs(t),l=(c=c==hh?fh:c)==fh,u=(d=d==hh?fh:d)==fh,p=c==d;if(p&&Hn(e)){if(!Hn(t))return!1;o=!0,l=!1}if(p&&!l)return s||(s=new Tn),o||is(e)?qp(e,t,r,i,n,s):function(e,t,r,i,n,s,o){switch(r){case ah:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case oh:return!(e.byteLength!=t.byteLength||!s(new Zs(e),new Zs(t)));case Qp:case Xp:case th:return Oi(+e,+t);case Zp:return e.name==t.name&&e.message==t.message;case rh:case nh:return e==t+"";case eh:var a=zp;case ih:var c=i&Kp;if(a||(a=Jp),e.size!=t.size&&!c)return!1;var d=o.get(e);if(d)return d==t;i|=Yp,o.set(e,t);var l=qp(a(e),a(t),i,n,s,o);return o.delete(e),l;case sh:if(dh)return dh.call(e)==dh.call(t)}return!1}(e,t,c,r,i,n,s);if(!(r&ph)){var h=l&&gh.call(e,"__wrapped__"),m=u&&gh.call(t,"__wrapped__");if(h||m){var f=h?e.value():e,g=m?t.value():t;return s||(s=new Tn),n(f,g,r,i,s)}}return!!p&&(s||(s=new Tn),function(e,t,r,i,n,s){var o=r&lh,a=Ns(e),c=a.length;if(c!=Ns(t).length&&!o)return!1;for(var d=c;d--;){var l=a[d];if(!(o?l in t:uh.call(t,l)))return!1}var u=s.get(e),p=s.get(t);if(u&&p)return u==t&&p==e;var h=!0;s.set(e,t),s.set(t,e);for(var m=o;++d<c;){var f=e[l=a[d]],g=t[l];if(i)var v=o?i(g,f,l,t,e,s):i(f,g,l,e,t,s);if(!(void 0===v?f===g||n(f,g,r,i,s):v)){h=!1;break}m||(m="constructor"==l)}if(h&&!m){var y=e.constructor,_=t.constructor;y!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _)&&(h=!1)}return s.delete(e),s.delete(t),h}(e,t,r,i,n,s))}(e,t,r,i,vh,n))}var yh=1,_h=2;function Sh(e,t,r,i){var n=r.length,s=n,o=!i;if(null==e)return!s;for(e=Object(e);n--;){var a=r[n];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++n<s;){var c=(a=r[n])[0],d=e[c],l=a[1];if(o&&a[2]){if(void 0===d&&!(c in e))return!1}else{var u=new Tn;if(i)var p=i(d,l,c,e,t,u);if(!(void 0===p?vh(l,d,yh|_h,i,u):p))return!1}}return!0}function Eh(e){return e==e&&!Yi(e)}function Th(e){for(var t=hs(e),r=t.length;r--;){var i=t[r],n=e[i];t[r]=[i,n,Eh(n)]}return t}function bh(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}function wh(e){var t=Th(e);return 1==t.length&&t[0][2]?bh(t[0][0],t[0][1]):function(r){return r===e||Sh(r,e,t)}}function kh(e,t){return null!=e&&t in Object(e)}function Rh(e,t){return null!=e&&ya(e,t,kh)}var Ch=1,Ah=2;function Ih(e,t){return Qo(e)&&Eh(t)?bh(ha(e),t):function(r){var i=fa(r,e);return void 0===i&&i===t?Rh(r,e):vh(t,i,Ch|Ah)}}function Ph(e){return function(t){return null==t?void 0:t[e]}}function Dh(e){return Qo(e)?Ph(ha(e)):function(e){return function(t){return ma(t,e)}}(e)}function Mh(e){return"function"==typeof e?e:null==e?kd:"object"==typeof e?Un(e)?Ih(e[0],e[1]):wh(e):Dh(e)}function Oh(e,t,r){var i=r.length;if(null==e)return!i;for(e=Object(e);i--;){var n=r[i],s=t[n],o=e[n];if(void 0===o&&!(n in e)||!s(o))return!1}return!0}function Nh(e,t,r,i){for(var n=-1,s=null==e?0:e.length;++n<s;){var o=e[n];t(i,o,r(o),e)}return i}function xh(e){return function(t,r,i){for(var n=-1,s=Object(t),o=i(t),a=o.length;a--;){var c=o[e?a:++n];if(!1===r(s[c],c,s))break}return t}}const Lh=xh();function jh(e,t){return e&&Lh(e,t,hs)}function Uh(e,t){return function(r,i){if(null==r)return r;if(!ps(r))return e(r,i);for(var n=r.length,s=t?n:-1,o=Object(r);(t?s--:++s<n)&&!1!==i(o[s],s,o););return r}}const Fh=Uh(jh);function Vh(e,t,r,i){return Fh(e,(function(e,n,s){t(i,e,r(e),s)})),i}function Bh(e,t){return function(r,i){var n=Un(r)?Nh:Vh,s=t?t():{};return n(r,e,Mh(i),s)}}var Wh=Object.prototype.hasOwnProperty,Hh=Bh((function(e,t,r){Wh.call(e,r)?++e[r]:Rn(e,r,1)}));const Gh=Hh;function $h(e,t,r){var i=ql(e,8,void 0,void 0,void 0,void 0,void 0,t=r?void 0:t);return i.placeholder=$h.placeholder,i}function qh(e,t,r){var i=ql(e,16,void 0,void 0,void 0,void 0,void 0,t=r?void 0:t);return i.placeholder=qh.placeholder,i}$h.placeholder={},qh.placeholder={};const zh=function(){return Fi.Date.now()};var Jh=Math.max,Kh=Math.min;function Yh(e,t,r){var i,n,s,o,a,c,d=0,l=!1,u=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var r=i,s=n;return i=n=void 0,d=t,o=e.apply(s,r)}function m(e){var r=e-c;return void 0===c||r>=t||r<0||u&&e-d>=s}function f(){var e=zh();if(m(e))return g(e);a=setTimeout(f,function(e){var r=t-(e-c);return u?Kh(r,s-(e-d)):r}(e))}function g(e){return a=void 0,p&&i?h(e):(i=n=void 0,o)}function v(){var e=zh(),r=m(e);if(i=arguments,n=this,c=e,r){if(void 0===a)return function(e){return d=e,a=setTimeout(f,t),l?h(e):o}(c);if(u)return clearTimeout(a),a=setTimeout(f,t),h(c)}return void 0===a&&(a=setTimeout(f,t)),o}return t=Sd(t)||0,Yi(r)&&(l=!!r.leading,s=(u="maxWait"in r)?Jh(Sd(r.maxWait)||0,t):s,p="trailing"in r?!!r.trailing:p),v.cancel=function(){void 0!==a&&clearTimeout(a),d=0,i=c=n=a=void 0},v.flush=function(){return void 0===a?o:g(zh())},v}var Qh=Object.prototype,Xh=Qh.hasOwnProperty,Zh=Yl((function(e,t){e=Object(e);var r=-1,i=t.length,n=i>2?t[2]:void 0;for(n&&Ql(t[0],t[1],n)&&(i=1);++r<i;)for(var s=t[r],o=gs(s),a=-1,c=o.length;++a<c;){var d=o[a],l=e[d];(void 0===l||Oi(l,Qh[d])&&!Xh.call(e,d))&&(e[d]=s[d])}return e}));const em=Zh;function tm(e,t,r){(void 0!==r&&!Oi(e[t],r)||void 0===r&&!(t in e))&&Rn(e,t,r)}function rm(e){return Dn(e)&&ps(e)}function im(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function nm(e){return In(e,gs(e))}function sm(e,t,r,i,n){e!==t&&Lh(t,(function(s,o){if(n||(n=new Tn),Yi(s))!function(e,t,r,i,n,s,o){var a=im(e,r),c=im(t,r),d=o.get(c);if(d)tm(e,r,d);else{var l=s?s(a,c,r+"",e,t,o):void 0,u=void 0===l;if(u){var p=Un(c),h=!p&&Hn(c),m=!p&&!h&&is(c);l=c,p||h||m?Un(a)?l=a:rm(a)?l=Ts(a):h?(u=!1,l=Es(c,!0)):m?(u=!1,l=no(c,!0)):l=[]:Eu(c)||jn(c)?(l=a,jn(a)?l=nm(a):(!Yi(a)||tn(a))&&(l=Ao(c))):u=!1}u&&(o.set(c,l),n(l,c,i,s,o),o.delete(c)),tm(e,r,l)}}(e,t,o,r,sm,i,n);else{var a=i?i(im(e,o),s,o+"",e,t,n):void 0;void 0===a&&(a=s),tm(e,o,a)}}),gs)}function om(e,t,r,i,n,s){return Yi(e)&&Yi(t)&&(s.set(t,e),sm(e,t,void 0,om,s),s.delete(t)),e}var am=Xl((function(e,t,r,i){sm(e,t,r,i)}));const cm=am;var dm=Yl((function(e){return e.push(void 0,om),Dd(cm,void 0,e)}));const lm=dm;function um(e,t,r){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,r)}),t)}var pm=Yl((function(e,t){return um(e,1,t)}));const hm=pm;var mm=Yl((function(e,t,r){return um(e,Sd(t)||0,r)}));const fm=mm;function gm(e,t,r){for(var i=-1,n=null==e?0:e.length;++i<n;)if(r(t,e[i]))return!0;return!1}var vm=200;function ym(e,t,r,i){var n=-1,s=cl,o=!0,a=e.length,c=[],d=t.length;if(!a)return c;r&&(t=sa(t,Yn(r))),i?(s=gm,o=!1):t.length>=vm&&(s=Hp,o=!1,t=new Bp(t));e:for(;++n<a;){var l=e[n],u=null==r?l:r(l);if(l=i||0!==l?l:0,o&&u==u){for(var p=d;p--;)if(t[p]===u)continue e;c.push(l)}else s(t,u,i)||c.push(l)}return c}var _m=Yl((function(e,t){return rm(e)?ym(e,uu(t,1,rm,!0)):[]}));const Sm=_m;function Em(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Tm=Yl((function(e,t){var r=Em(t);return rm(r)&&(r=void 0),rm(e)?ym(e,uu(t,1,rm,!0),Mh(r)):[]}));const bm=Tm;var wm=Yl((function(e,t){var r=Em(t);return rm(r)&&(r=void 0),rm(e)?ym(e,uu(t,1,rm,!0),void 0,r):[]}));const km=wm;var Rm=cd((function(e,t){return e/t}),1);const Cm=Rm;function Am(e,t,r,i){for(var n=e.length,s=i?n:-1;(i?s--:++s<n)&&t(e[s],s,e););return r?Mu(e,i?0:s,i?s+1:n):Mu(e,i?s+1:0,i?n:s)}function Im(e){return"function"==typeof e?e:kd}function Pm(e,t){return(Un(e)?bn:Fh)(e,Im(t))}function Dm(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}const Mm=xh(!0);function Om(e,t){return e&&Mm(e,t,hs)}const Nm=Uh(Om,!0);function xm(e,t){return(Un(e)?Dm:Nm)(e,Im(t))}function Lm(e){return function(t){var r=Qs(t);return"[object Map]"==r?zp(t):"[object Set]"==r?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):function(e,t){return sa(t,(function(t){return[t,e[t]]}))}(t,e(t))}}const jm=Lm(hs),Um=Lm(gs),Fm=Zu({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});var Vm=/[&<>"']/g,Bm=RegExp(Vm.source);function Wm(e){return(e=la(e))&&Bm.test(e)?e.replace(Vm,Fm):e}var Hm=/[\\^$.*+?()[\]{}|]/g,Gm=RegExp(Hm.source);function $m(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(!t(e[r],r,e))return!1;return!0}function qm(e,t){var r=!0;return Fh(e,(function(e,i,n){return r=!!t(e,i,n)})),r}function zm(e){return e?Vp(wd(e),0,4294967295):0}function Jm(e,t){var r=[];return Fh(e,(function(e,i,n){t(e,i,n)&&r.push(e)})),r}function Km(e){return function(t,r,i){var n=Object(t);if(!ps(t)){var s=Mh(r);t=hs(t),r=function(e){return s(n[e],e,n)}}var o=e(t,r,i);return o>-1?n[s?t[o]:o]:void 0}}var Ym=Math.max;function Qm(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=null==r?0:wd(r);return n<0&&(n=Ym(i+n,0)),sl(e,Mh(t),n)}const Xm=Km(Qm);function Zm(e,t,r){var i;return r(e,(function(e,r,n){if(t(e,r,n))return i=r,!1})),i}var ef=Math.max,tf=Math.min;function rf(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=i-1;return void 0!==r&&(n=wd(r),n=r<0?ef(i+n,0):tf(n,i-1)),sl(e,Mh(t),n,!0)}const nf=Km(rf);function sf(e){return e&&e.length?e[0]:void 0}function of(e,t){var r=-1,i=ps(e)?Array(e.length):[];return Fh(e,(function(e,n,s){i[++r]=t(e,n,s)})),i}function af(e,t){return(Un(e)?sa:of)(e,Mh(t))}const cf=xp("floor");function df(e){return hu((function(t){var r=t.length,i=r,n=$d.prototype.thru;for(e&&t.reverse();i--;){var s=t[i];if("function"!=typeof s)throw new TypeError("Expected a function");if(n&&!o&&"wrapper"==Gd(s))var o=new $d([],!0)}for(i=o?i:r;++i<r;){var a=Gd(s=t[i]),c="wrapper"==a?Bd(s):void 0;o=c&&Kd(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?o[Gd(c[0])].apply(o,c[3]):1==s.length&&Kd(s)?o[a]():o.thru(s)}return function(){var e=arguments,i=e[0];if(o&&1==e.length&&Un(i))return o.plant(i).value();for(var n=0,s=r?t[n].apply(this,e):i;++n<r;)s=t[n].call(this,s);return s}}))}const lf=df(),uf=df(!0);function pf(e,t){return bs(t,(function(t){return tn(e[t])}))}var hf=Object.prototype.hasOwnProperty,mf=Bh((function(e,t,r){hf.call(e,r)?e[r].push(t):Rn(e,r,[t])}));const ff=mf;function gf(e,t){return e>t}function vf(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=Sd(t),r=Sd(r)),e(t,r)}}const yf=vf(gf);var _f=vf((function(e,t){return e>=t}));const Sf=_f;var Ef=Math.max,Tf=Math.min,bf="[object String]";function wf(e){return"string"==typeof e||!Un(e)&&Dn(e)&&Ki(e)==bf}function kf(e,t){return sa(t,(function(t){return e[t]}))}function Rf(e){return null==e?[]:kf(e,hs(e))}var Cf=Math.max,Af=Math.max,If=Math.min;function Pf(e,t,r){for(var i=r?gm:cl,n=e[0].length,s=e.length,o=s,a=Array(s),c=1/0,d=[];o--;){var l=e[o];o&&t&&(l=sa(l,Yn(t))),c=If(l.length,c),a[o]=!r&&(t||n>=120&&l.length>=120)?new Bp(o&&l):void 0}l=e[0];var u=-1,p=a[0];e:for(;++u<n&&d.length<c;){var h=l[u],m=t?t(h):h;if(h=r||0!==h?h:0,!(p?Hp(p,m):i(d,m,r))){for(o=s;--o;){var f=a[o];if(!(f?Hp(f,m):i(e[o],m,r)))continue e}p&&p.push(m),d.push(h)}}return d}function Df(e){return rm(e)?e:[]}var Mf=Yl((function(e){var t=sa(e,Df);return t.length&&t[0]===e[0]?Pf(t):[]}));const Of=Mf;var Nf=Yl((function(e){var t=Em(e),r=sa(e,Df);return t===Em(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?Pf(r,Mh(t)):[]}));const xf=Nf;var Lf=Yl((function(e){var t=Em(e),r=sa(e,Df);return(t="function"==typeof t?t:void 0)&&r.pop(),r.length&&r[0]===e[0]?Pf(r,void 0,t):[]}));const jf=Lf;function Uf(e,t){return function(r,i){return function(e,t,r,i){return jh(e,(function(e,n,s){t(i,r(e),n,s)})),i}(r,e,t(i),{})}}var Ff=Object.prototype.toString,Vf=Uf((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ff.call(t)),e[t]=r}),rl(kd));const Bf=Vf;var Wf=Object.prototype,Hf=Wf.hasOwnProperty,Gf=Wf.toString,$f=Uf((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Gf.call(t)),Hf.call(e,t)?e[t].push(r):e[t]=[r]}),Mh);const qf=$f;function zf(e,t){return t.length<2?e:ma(e,Mu(t,0,-1))}function Jf(e,t,r){var i=null==(e=zf(e,t=ua(t,e)))?e:e[ha(Em(t))];return null==i?void 0:Dd(i,e,r)}const Kf=Yl(Jf);var Yf=Yl((function(e,t,r){var i=-1,n="function"==typeof t,s=ps(e)?Array(e.length):[];return Fh(e,(function(e){s[++i]=n?Dd(t,e,r):Jf(e,t,r)})),s}));const Qf=Yf;var Xf=es&&es.isArrayBuffer,Zf=Xf?Yn(Xf):function(e){return Dn(e)&&"[object ArrayBuffer]"==Ki(e)};const eg=Zf;var tg=es&&es.isDate,rg=tg?Yn(tg):function(e){return Dn(e)&&"[object Date]"==Ki(e)};const ig=rg;var ng=Object.prototype.hasOwnProperty;function sg(e){if(null==e)return!0;if(ps(e)&&(Un(e)||"string"==typeof e||"function"==typeof e.splice||Hn(e)||is(e)||jn(e)))return!e.length;var t=Qs(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(as(e))return!us(e).length;for(var r in e)if(ng.call(e,r))return!1;return!0}function og(e,t){return vh(e,t)}var ag=Fi.isFinite;function cg(e){return"number"==typeof e&&e==wd(e)}function dg(e){return"number"==typeof e||Dn(e)&&"[object Number]"==Ki(e)}const lg=rn?tn:Fn;var ug=es&&es.isRegExp,pg=ug?Yn(ug):function(e){return Dn(e)&&"[object RegExp]"==Ki(e)};const hg=pg;var mg=9007199254740991,fg=Array.prototype.join,gg=Pp((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}));const vg=gg;var yg=Bh((function(e,t,r){Rn(e,r,t)}));const _g=yg;var Sg=Math.max,Eg=Math.min,Tg=Pp((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}));const bg=Tg,wg=Ku("toLowerCase");function kg(e,t){return e<t}const Rg=vf(kg);var Cg=vf((function(e,t){return e<=t}));const Ag=Cg;function Ig(e,t,r){for(var i=-1,n=e.length;++i<n;){var s=e[i],o=t(s);if(null!=o&&(void 0===a?o==o&&!Jo(o):r(o,a)))var a=o,c=s}return c}function Pg(e,t){for(var r,i=-1,n=e.length;++i<n;){var s=t(e[i]);void 0!==s&&(r=void 0===r?s:r+s)}return r}function Dg(e,t){var r=null==e?0:e.length;return r?Pg(e,t)/r:NaN}var Mg=Xl((function(e,t,r){sm(e,t,r)}));const Og=Mg;var Ng=Yl((function(e,t){return function(r){return Jf(r,e,t)}}));const xg=Ng;var Lg=Yl((function(e,t){return function(r){return Jf(e,r,t)}}));const jg=Lg;function Ug(e,t,r){var i=hs(t),n=pf(t,i),s=!(Yi(r)&&"chain"in r&&!r.chain),o=tn(e);return bn(n,(function(r){var i=t[r];e[r]=i,o&&(e.prototype[r]=function(){var t=this.__chain__;if(s||t){var r=e(this.__wrapped__);return(r.__actions__=Ts(this.__actions__)).push({func:i,args:arguments,thisArg:e}),r.__chain__=t,r}return i.apply(e,Is([this.value()],arguments))})})),e}var Fg=cd((function(e,t){return e*t}),1);const Vg=Fg;function Bg(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}var Wg=Vi?Vi.iterator:void 0;function Hg(e){if(!e)return[];if(ps(e))return wf(e)?Ju(e):Ts(e);if(Wg&&e[Wg])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Wg]());var t=Qs(e);return("[object Map]"==t?zp:"[object Set]"==t?Jp:Rf)(e)}function Gg(e,t){var r=e.length;if(r)return qn(t+=t<0?r:0,r)?e[t]:void 0}function $g(e,t){return null==(e=zf(e,t=ua(t,e)))||delete e[ha(Em(t))]}function qg(e){return Eu(e)?void 0:e}var zg=hu((function(e,t){var r={};if(null==e)return r;var i=!1;t=sa(t,(function(t){return t=ua(t,e),i||(i=t.length>1),t})),In(e,xs(e),r),i&&(r=Ho(r,7,qg));for(var n=t.length;n--;)$g(r,t[n]);return r}));const Jg=zg;function Kg(e,t,r){for(var i=-1,n=t.length,s={};++i<n;){var o=t[i],a=ma(e,o);r(a,o)&&_a(s,ua(o,e),a)}return s}function Yg(e,t){if(null==e)return{};var r=sa(xs(e),(function(e){return[e]}));return t=Mh(t),Kg(e,r,(function(e,r){return t(e,r[0])}))}function Qg(e,t){if(e!==t){var r=void 0!==e,i=null===e,n=e==e,s=Jo(e),o=void 0!==t,a=null===t,c=t==t,d=Jo(t);if(!a&&!d&&!s&&e>t||s&&o&&c&&!a&&!d||i&&o&&c||!r&&c||!n)return 1;if(!i&&!s&&!d&&e<t||d&&r&&n&&!i&&!s||a&&r&&n||!o&&n||!c)return-1}return 0}function Xg(e,t,r){t=t.length?sa(t,(function(e){return Un(e)?function(t){return ma(t,1===e.length?e[0]:e)}:e})):[kd];var i=-1;return t=sa(t,Yn(Mh)),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(of(e,(function(e,r,n){return{criteria:sa(t,(function(t){return t(e)})),index:++i,value:e}})),(function(e,t){return function(e,t,r){for(var i=-1,n=e.criteria,s=t.criteria,o=n.length,a=r.length;++i<o;){var c=Qg(n[i],s[i]);if(c)return i>=a?c:c*("desc"==r[i]?-1:1)}return e.index-t.index}(e,t,r)}))}function Zg(e){return hu((function(t){return t=sa(t,Yn(Mh)),Yl((function(r){var i=this;return e(t,(function(e){return Dd(e,i,r)}))}))}))}const ev=Zg(sa),tv=Yl;var rv=Math.min,iv=tv((function(e,t){var r=(t=1==t.length&&Un(t[0])?sa(t[0],Yn(Mh)):sa(uu(t,1),Yn(Mh))).length;return Yl((function(i){for(var n=-1,s=rv(i.length,r);++n<s;)i[n]=t[n].call(this,i[n]);return Dd(e,this,i)}))}));const nv=iv,sv=Zg($m),ov=Zg(Wp);var av=9007199254740991,cv=Math.floor;function dv(e,t){var r="";if(!e||t<1||t>av)return r;do{t%2&&(r+=e),(t=cv(t/2))&&(e+=e)}while(t);return r}const lv=Ph("length");var uv="\\ud800-\\udfff",pv="["+uv+"]",hv="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",mv="\\ud83c[\\udffb-\\udfff]",fv="[^"+uv+"]",gv="(?:\\ud83c[\\udde6-\\uddff]){2}",vv="[\\ud800-\\udbff][\\udc00-\\udfff]",yv="(?:"+hv+"|"+mv+")?",_v="[\\ufe0e\\ufe0f]?",Sv=_v+yv+"(?:\\u200d(?:"+[fv,gv,vv].join("|")+")"+_v+yv+")*",Ev="(?:"+[fv+hv+"?",hv,gv,vv,pv].join("|")+")",Tv=RegExp(mv+"(?="+mv+")|"+Ev+Sv,"g");function bv(e){return xu(e)?function(e){for(var t=Tv.lastIndex=0;Tv.test(e);)++t;return t}(e):lv(e)}var wv=Math.ceil;function kv(e,t){var r=(t=void 0===t?" ":da(t)).length;if(r<2)return r?dv(t,e):t;var i=dv(t,wv(e/bv(t)));return xu(t)?Ou(Ju(i),0,e).join(""):i.slice(0,e)}var Rv=Math.ceil,Cv=Math.floor,Av=/^\s+/,Iv=Fi.parseInt,Pv=Yl((function(e,t){return ql(e,32,void 0,t,El(t,yl(Pv)))}));Pv.placeholder={};const Dv=Pv;var Mv=Yl((function(e,t){return ql(e,64,void 0,t,El(t,yl(Mv)))}));Mv.placeholder={};const Ov=Mv;var Nv=Bh((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]}));const xv=Nv;var Lv=hu((function(e,t){return null==e?{}:function(e,t){return Kg(e,t,(function(t,r){return Rh(e,r)}))}(e,t)}));const jv=Lv;function Uv(e,t,r,i){for(var n=r-1,s=e.length;++n<s;)if(i(e[n],t))return n;return-1}var Fv=Array.prototype.splice;function Vv(e,t,r,i){var n=i?Uv:al,s=-1,o=t.length,a=e;for(e===t&&(t=Ts(t)),r&&(a=sa(e,Yn(r)));++s<o;)for(var c=0,d=t[s],l=r?r(d):d;(c=n(a,l,c,i))>-1;)a!==e&&Fv.call(a,c,1),Fv.call(e,c,1);return e}function Bv(e,t){return e&&e.length&&t&&t.length?Vv(e,t):e}const Wv=Yl(Bv);var Hv=Array.prototype.splice;function Gv(e,t){for(var r=e?t.length:0,i=r-1;r--;){var n=t[r];if(r==i||n!==s){var s=n;qn(n)?Hv.call(e,n,1):$g(e,n)}}return e}var $v=hu((function(e,t){var r=null==e?0:e.length,i=cu(e,t);return Gv(e,sa(t,(function(e){return qn(e,r)?+e:e})).sort(Qg)),i}));const qv=$v;var zv=Math.floor,Jv=Math.random;function Kv(e,t){return e+zv(Jv()*(t-e+1))}var Yv=parseFloat,Qv=Math.min,Xv=Math.random,Zv=Math.ceil,ey=Math.max;function ty(e){return function(t,r,i){return i&&"number"!=typeof i&&Ql(t,r,i)&&(r=i=void 0),t=bd(t),void 0===r?(r=t,t=0):r=bd(r),function(e,t,r,i){for(var n=-1,s=ey(Zv((t-e)/(r||1)),0),o=Array(s);s--;)o[i?s:++n]=e,e+=r;return o}(t,r,i=void 0===i?t<r?1:-1:bd(i),e)}}const ry=ty(),iy=ty(!0);var ny=hu((function(e,t){return ql(e,256,void 0,void 0,void 0,t)}));const sy=ny;function oy(e,t,r,i,n){return n(e,(function(e,n,s){r=i?(i=!1,e):t(r,e,n,s)})),r}function ay(e,t,r,i){var n=null==e?0:e.length;for(i&&n&&(r=e[--n]);n--;)r=t(r,e[n],n,e);return r}var cy=Array.prototype.reverse;function dy(e){return null==e?e:cy.call(e)}const ly=xp("round");function uy(e){var t=e.length;return t?e[Kv(0,t-1)]:void 0}function py(e){return uy(Rf(e))}function hy(e,t){var r=-1,i=e.length,n=i-1;for(t=void 0===t?i:t;++r<t;){var s=Kv(r,n),o=e[s];e[s]=e[r],e[r]=o}return e.length=t,e}function my(e,t){return hy(Ts(e),Vp(t,0,e.length))}function fy(e,t){var r=Rf(e);return hy(r,Vp(t,0,r.length))}function gy(e){return hy(Ts(e))}function vy(e){return hy(Rf(e))}var yy=Pp((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}));const _y=yy;function Sy(e,t){var r;return Fh(e,(function(e,i,n){return!(r=t(e,i,n))})),!!r}var Ey=Yl((function(e,t){if(null==e)return[];var r=t.length;return r>1&&Ql(e,t[0],t[1])?t=[]:r>2&&Ql(t[0],t[1],t[2])&&(t=[t[0]]),Xg(e,uu(t,1),[])}));const Ty=Ey;var by=4294967294,wy=Math.floor,ky=Math.min;function Ry(e,t,r,i){var n=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=r(t))!=t,a=null===t,c=Jo(t),d=void 0===t;n<s;){var l=wy((n+s)/2),u=r(e[l]),p=void 0!==u,h=null===u,m=u==u,f=Jo(u);if(o)var g=i||m;else g=d?m&&(i||p):a?m&&p&&(i||!h):c?m&&p&&!h&&(i||!f):!h&&!f&&(i?u<=t:u<t);g?n=l+1:s=l}return ky(s,by)}function Cy(e,t,r){var i=0,n=null==e?i:e.length;if("number"==typeof t&&t==t&&n<=2147483647){for(;i<n;){var s=i+n>>>1,o=e[s];null!==o&&!Jo(o)&&(r?o<=t:o<t)?i=s+1:n=s}return n}return Ry(e,t,kd,r)}function Ay(e,t){for(var r=-1,i=e.length,n=0,s=[];++r<i;){var o=e[r],a=t?t(o):o;if(!r||!Oi(a,c)){var c=a;s[n++]=0===o?0:o}}return s}var Iy=Math.max,Py=Pp((function(e,t,r){return e+(r?" ":"")+Yu(t)}));const Dy=Py;var My=cd((function(e,t){return e-t}),0);const Oy=My;var Ny=Object.prototype,xy=Ny.hasOwnProperty;function Ly(e,t,r,i){return void 0===e||Oi(e,Ny[r])&&!xy.call(i,r)?t:e}var jy={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function Uy(e){return"\\"+jy[e]}const Fy=/<%=([\s\S]+?)%>/g,Vy={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Fy,variable:"",imports:{_:{escape:Wm}}};var By=/\b__p \+= '';/g,Wy=/\b(__p \+=) '' \+/g,Hy=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Gy=/[()=,{}\[\]\/\s]/,$y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qy=/($^)/,zy=/['\n\r\u2028\u2029\\]/g,Jy=Object.prototype.hasOwnProperty;function Ky(e,t){return t(e)}var Yy=4294967295,Qy=Math.min;function Xy(e,t){var r=e;return r instanceof Ud&&(r=r.value()),Xu(t,(function(e,t){return t.func.apply(t.thisArg,Is([e],t.args))}),r)}function Zy(){return Xy(this.__wrapped__,this.__actions__)}var e_=9007199254740991;function t_(e,t){for(var r=e.length;r--&&al(t,e[r],0)>-1;);return r}function r_(e,t){for(var r=-1,i=e.length;++r<i&&al(t,e[r],0)>-1;);return r}var i_=/^\s+/,n_=/\w*$/;const s_=Zu({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var o_=/&(?:amp|lt|gt|quot|#39);/g,a_=RegExp(o_.source),c_=Us&&1/Jp(new Us([,-0]))[1]==1/0?function(e){return new Us(e)}:Fd;const d_=c_;var l_=200;function u_(e,t,r){var i=-1,n=cl,s=e.length,o=!0,a=[],c=a;if(r)o=!1,n=gm;else if(s>=l_){var d=t?null:d_(e);if(d)return Jp(d);o=!1,n=Hp,c=new Bp}else c=t?[]:a;e:for(;++i<s;){var l=e[i],u=t?t(l):l;if(l=r||0!==l?l:0,o&&u==u){for(var p=c.length;p--;)if(c[p]===u)continue e;t&&c.push(u),a.push(l)}else n(c,u,r)||(c!==a&&c.push(u),a.push(l))}return a}var p_=Yl((function(e){return u_(uu(e,1,rm,!0))}));const h_=p_;var m_=Yl((function(e){var t=Em(e);return rm(t)&&(t=void 0),u_(uu(e,1,rm,!0),Mh(t))}));const f_=m_;var g_=Yl((function(e){var t=Em(e);return t="function"==typeof t?t:void 0,u_(uu(e,1,rm,!0),void 0,t)}));const v_=g_;var y_=0,__=Math.max;function S_(e){if(!e||!e.length)return[];var t=0;return e=bs(e,(function(e){if(rm(e))return t=__(e.length,t),!0})),Pn(t,(function(t){return sa(e,Ph(t))}))}function E_(e,t){if(!e||!e.length)return[];var r=S_(e);return null==t?r:sa(r,(function(e){return Dd(t,void 0,e)}))}function T_(e,t,r,i){return _a(e,t,r(ma(e,t)),i)}var b_=Pp((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}));const w_=b_;var k_=Yl((function(e,t){return rm(e)?ym(e,t):[]}));const R_=k_;var C_=hu((function(e){var t=e.length,r=t?e[0]:0,i=this.__wrapped__,n=function(t){return cu(t,e)};return!(t>1||this.__actions__.length)&&i instanceof Ud&&qn(r)?((i=i.slice(r,+r+(t?1:0))).__actions__.push({func:Ky,args:[n],thisArg:void 0}),new $d(i,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(n)}));const A_=C_;function I_(e,t,r){var i=e.length;if(i<2)return i?u_(e[0]):[];for(var n=-1,s=Array(i);++n<i;)for(var o=e[n],a=-1;++a<i;)a!=n&&(s[n]=ym(s[n]||o,e[a],t,r));return u_(uu(s,1),t,r)}var P_=Yl((function(e){return I_(bs(e,rm))}));const D_=P_;var M_=Yl((function(e){var t=Em(e);return rm(t)&&(t=void 0),I_(bs(e,rm),Mh(t))}));const O_=M_;var N_=Yl((function(e){var t=Em(e);return t="function"==typeof t?t:void 0,I_(bs(e,rm),void 0,t)}));const x_=N_,L_=Yl(S_);function j_(e,t,r){for(var i=-1,n=e.length,s=t.length,o={};++i<n;){var a=i<s?t[i]:void 0;r(o,e[i],a)}return o}var U_=Yl((function(e){var t=e.length,r=t>1?e[t-1]:void 0;return r="function"==typeof r?(e.pop(),r):void 0,E_(e,r)}));const F_={chunk:function(e,t,r){t=(r?Ql(e,t,r):void 0===t)?1:Fp(wd(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var n=0,s=0,o=Array(Up(i/t));n<i;)o[s++]=Mu(e,n,n+=t);return o},compact:function(e){for(var t=-1,r=null==e?0:e.length,i=0,n=[];++t<r;){var s=e[t];s&&(n[i++]=s)}return n},concat:function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Is(Un(r)?Ts(r):[r],uu(t,1))},difference:Sm,differenceBy:bm,differenceWith:km,drop:function(e,t,r){var i=null==e?0:e.length;return i?Mu(e,(t=r||void 0===t?1:wd(t))<0?0:t,i):[]},dropRight:function(e,t,r){var i=null==e?0:e.length;return i?Mu(e,0,(t=i-(t=r||void 0===t?1:wd(t)))<0?0:t):[]},dropRightWhile:function(e,t){return e&&e.length?Am(e,Mh(t),!0,!0):[]},dropWhile:function(e,t){return e&&e.length?Am(e,Mh(t),!0):[]},fill:function(e,t,r,i){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&Ql(e,t,r)&&(r=0,i=n),function(e,t,r,i){var n=e.length;for((r=wd(r))<0&&(r=-r>n?0:n+r),(i=void 0===i||i>n?n:wd(i))<0&&(i+=n),i=r>i?0:zm(i);r<i;)e[r++]=t;return e}(e,t,r,i)):[]},findIndex:Qm,findLastIndex:rf,first:sf,flatten:pu,flattenDeep:function(e){return null!=e&&e.length?uu(e,1/0):[]},flattenDepth:function(e,t){return null!=e&&e.length?uu(e,t=void 0===t?1:wd(t)):[]},fromPairs:function(e){for(var t=-1,r=null==e?0:e.length,i={};++t<r;){var n=e[t];i[n[0]]=n[1]}return i},head:sf,indexOf:function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=null==r?0:wd(r);return n<0&&(n=Af(i+n,0)),al(e,t,n)},initial:function(e){return null!=e&&e.length?Mu(e,0,-1):[]},intersection:Of,intersectionBy:xf,intersectionWith:jf,join:function(e,t){return null==e?"":fg.call(e,t)},last:Em,lastIndexOf:function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=i;return void 0!==r&&(n=(n=wd(r))<0?Sg(i+n,0):Eg(n,i-1)),t==t?function(e,t,r){for(var i=r+1;i--;)if(e[i]===t)return i;return i}(e,t,n):sl(e,ol,n,!0)},nth:function(e,t){return e&&e.length?Gg(e,wd(t)):void 0},pull:Wv,pullAll:Bv,pullAllBy:function(e,t,r){return e&&e.length&&t&&t.length?Vv(e,t,Mh(r)):e},pullAllWith:function(e,t,r){return e&&e.length&&t&&t.length?Vv(e,t,void 0,r):e},pullAt:qv,remove:function(e,t){var r=[];if(!e||!e.length)return r;var i=-1,n=[],s=e.length;for(t=Mh(t);++i<s;){var o=e[i];t(o,i,e)&&(r.push(o),n.push(i))}return Gv(e,n),r},reverse:dy,slice:function(e,t,r){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&Ql(e,t,r)?(t=0,r=i):(t=null==t?0:wd(t),r=void 0===r?i:wd(r)),Mu(e,t,r)):[]},sortedIndex:function(e,t){return Cy(e,t)},sortedIndexBy:function(e,t,r){return Ry(e,t,Mh(r))},sortedIndexOf:function(e,t){var r=null==e?0:e.length;if(r){var i=Cy(e,t);if(i<r&&Oi(e[i],t))return i}return-1},sortedLastIndex:function(e,t){return Cy(e,t,!0)},sortedLastIndexBy:function(e,t,r){return Ry(e,t,Mh(r),!0)},sortedLastIndexOf:function(e,t){if(null!=e&&e.length){var r=Cy(e,t,!0)-1;if(Oi(e[r],t))return r}return-1},sortedUniq:function(e){return e&&e.length?Ay(e):[]},sortedUniqBy:function(e,t){return e&&e.length?Ay(e,Mh(t)):[]},tail:function(e){var t=null==e?0:e.length;return t?Mu(e,1,t):[]},take:function(e,t,r){return e&&e.length?Mu(e,0,(t=r||void 0===t?1:wd(t))<0?0:t):[]},takeRight:function(e,t,r){var i=null==e?0:e.length;return i?Mu(e,(t=i-(t=r||void 0===t?1:wd(t)))<0?0:t,i):[]},takeRightWhile:function(e,t){return e&&e.length?Am(e,Mh(t),!1,!0):[]},takeWhile:function(e,t){return e&&e.length?Am(e,Mh(t)):[]},union:h_,unionBy:f_,unionWith:v_,uniq:function(e){return e&&e.length?u_(e):[]},uniqBy:function(e,t){return e&&e.length?u_(e,Mh(t)):[]},uniqWith:function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?u_(e,void 0,t):[]},unzip:S_,unzipWith:E_,without:R_,xor:D_,xorBy:O_,xorWith:x_,zip:L_,zipObject:function(e,t){return j_(e||[],t||[],An)},zipObjectDeep:function(e,t){return j_(e||[],t||[],_a)},zipWith:U_},V_={countBy:Gh,each:Pm,eachRight:xm,every:function(e,t,r){var i=Un(e)?$m:qm;return r&&Ql(e,t,r)&&(t=void 0),i(e,Mh(t))},filter:function(e,t){return(Un(e)?bs:Jm)(e,Mh(t))},find:Xm,findLast:nf,flatMap:function(e,t){return uu(af(e,t),1)},flatMapDeep:function(e,t){return uu(af(e,t),1/0)},flatMapDepth:function(e,t,r){return r=void 0===r?1:wd(r),uu(af(e,t),r)},forEach:Pm,forEachRight:xm,groupBy:ff,includes:function(e,t,r,i){e=ps(e)?e:Rf(e),r=r&&!i?wd(r):0;var n=e.length;return r<0&&(r=Cf(n+r,0)),wf(e)?r<=n&&e.indexOf(t,r)>-1:!!n&&al(e,t,r)>-1},invokeMap:Qf,keyBy:_g,map:af,orderBy:function(e,t,r,i){return null==e?[]:(Un(t)||(t=null==t?[]:[t]),Un(r=i?void 0:r)||(r=null==r?[]:[r]),Xg(e,t,r))},partition:xv,reduce:function(e,t,r){var i=Un(e)?Xu:oy,n=arguments.length<3;return i(e,Mh(t),r,n,Fh)},reduceRight:function(e,t,r){var i=Un(e)?ay:oy,n=arguments.length<3;return i(e,Mh(t),r,n,Nm)},reject:function(e,t){return(Un(e)?bs:Jm)(e,Bg(Mh(t)))},sample:function(e){return(Un(e)?uy:py)(e)},sampleSize:function(e,t,r){return t=(r?Ql(e,t,r):void 0===t)?1:wd(t),(Un(e)?my:fy)(e,t)},shuffle:function(e){return(Un(e)?gy:vy)(e)},size:function(e){if(null==e)return 0;if(ps(e))return wf(e)?bv(e):e.length;var t=Qs(e);return"[object Map]"==t||"[object Set]"==t?e.size:us(e).length},some:function(e,t,r){var i=Un(e)?Wp:Sy;return r&&Ql(e,t,r)&&(t=void 0),i(e,Mh(t))},sortBy:Ty},B_=zh,W_={after:function(e,t){if("function"!=typeof t)throw new TypeError("Expected a function");return e=wd(e),function(){if(--e<1)return t.apply(this,arguments)}},ary:zl,before:ku,bind:Cu,bindKey:Du,curry:$h,curryRight:qh,debounce:Yh,defer:hm,delay:fm,flip:function(e){return ql(e,512)},memoize:Xo,negate:Bg,once:function(e){return ku(2,e)},overArgs:nv,partial:Dv,partialRight:Ov,rearg:sy,rest:function(e,t){if("function"!=typeof e)throw new TypeError("Expected a function");return Yl(e,t=void 0===t?t:wd(t))},spread:function(e,t){if("function"!=typeof e)throw new TypeError("Expected a function");return t=null==t?0:Iy(wd(t),0),Yl((function(r){var i=r[t],n=Ou(r,0,t);return i&&Is(n,i),Dd(e,this,n)}))},throttle:function(e,t,r){var i=!0,n=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Yi(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),Yh(e,t,{leading:i,maxWait:t,trailing:n})},unary:function(e){return zl(e,1)},wrap:function(e,t){return Dv(Im(t),e)}},H_={castArray:function(){if(!arguments.length)return[];var e=arguments[0];return Un(e)?e:[e]},clone:function(e){return Ho(e,4)},cloneDeep:qo,cloneDeepWith:function(e,t){return Ho(e,5,t="function"==typeof t?t:void 0)},cloneWith:function(e,t){return Ho(e,4,t="function"==typeof t?t:void 0)},conformsTo:function(e,t){return null==t||Oh(e,t,hs(t))},eq:Oi,gt:yf,gte:Sf,isArguments:jn,isArray:Un,isArrayBuffer:eg,isArrayLike:ps,isArrayLikeObject:rm,isBoolean:function(e){return!0===e||!1===e||Dn(e)&&"[object Boolean]"==Ki(e)},isBuffer:Hn,isDate:ig,isElement:function(e){return Dn(e)&&1===e.nodeType&&!Eu(e)},isEmpty:sg,isEqual:og,isEqualWith:function(e,t,r){var i=(r="function"==typeof r?r:void 0)?r(e,t):void 0;return void 0===i?vh(e,t,void 0,r):!!i},isError:Tu,isFinite:function(e){return"number"==typeof e&&ag(e)},isFunction:tn,isInteger:cg,isLength:Jn,isMap:Do,isMatch:function(e,t){return e===t||Sh(e,t,Th(t))},isMatchWith:function(e,t,r){return r="function"==typeof r?r:void 0,Sh(e,t,Th(t),r)},isNaN:function(e){return dg(e)&&e!=+e},isNative:function(e){if(lg(e))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return hn(e)},isNil:function(e){return null==e},isNull:function(e){return null===e},isNumber:dg,isObject:Yi,isObjectLike:Dn,isPlainObject:Eu,isRegExp:hg,isSafeInteger:function(e){return cg(e)&&e>=-mg&&e<=mg},isSet:No,isString:wf,isSymbol:Jo,isTypedArray:is,isUndefined:function(e){return void 0===e},isWeakMap:function(e){return Dn(e)&&"[object WeakMap]"==Qs(e)},isWeakSet:function(e){return Dn(e)&&"[object WeakSet]"==Ki(e)},lt:Rg,lte:Ag,toArray:Hg,toFinite:bd,toInteger:wd,toLength:zm,toNumber:Sd,toPlainObject:nm,toSafeInteger:function(e){return e?Vp(wd(e),-e_,e_):0===e?e:0},toString:la},G_={add:ld,ceil:Lp,divide:Cm,floor:cf,max:function(e){return e&&e.length?Ig(e,kd,gf):void 0},maxBy:function(e,t){return e&&e.length?Ig(e,Mh(t),gf):void 0},mean:function(e){return Dg(e,kd)},meanBy:function(e,t){return Dg(e,Mh(t))},min:function(e){return e&&e.length?Ig(e,kd,kg):void 0},minBy:function(e,t){return e&&e.length?Ig(e,Mh(t),kg):void 0},multiply:Vg,round:ly,subtract:Oy,sum:function(e){return e&&e.length?Pg(e,kd):0},sumBy:function(e,t){return e&&e.length?Pg(e,Mh(t)):0}},$_={assign:tu,assignIn:iu,assignInWith:su,assignWith:au,at:mu,create:function(e,t){var r=Co(e);return null==t?r:ms(r,t)},defaults:em,defaultsDeep:lm,entries:jm,entriesIn:Um,extend:iu,extendWith:su,findKey:function(e,t){return Zm(e,Mh(t),jh)},findLastKey:function(e,t){return Zm(e,Mh(t),Om)},forIn:function(e,t){return null==e?e:Lh(e,Im(t),gs)},forInRight:function(e,t){return null==e?e:Mm(e,Im(t),gs)},forOwn:function(e,t){return e&&jh(e,Im(t))},forOwnRight:function(e,t){return e&&Om(e,Im(t))},functions:function(e){return null==e?[]:pf(e,hs(e))},functionsIn:function(e){return null==e?[]:pf(e,gs(e))},get:fa,has:function(e,t){return null!=e&&ya(e,t,va)},hasIn:Rh,invert:Bf,invertBy:qf,invoke:Kf,keys:hs,keysIn:gs,mapKeys:function(e,t){var r={};return t=Mh(t),jh(e,(function(e,i,n){Rn(r,t(e,i,n),e)})),r},mapValues:function(e,t){var r={};return t=Mh(t),jh(e,(function(e,i,n){Rn(r,i,t(e,i,n))})),r},merge:Og,mergeWith:cm,omit:Jg,omitBy:function(e,t){return Yg(e,Bg(Mh(t)))},pick:jv,pickBy:Yg,result:function(e,t,r){var i=-1,n=(t=ua(t,e)).length;for(n||(n=1,e=void 0);++i<n;){var s=null==e?void 0:e[ha(t[i])];void 0===s&&(i=n,s=r),e=tn(s)?s.call(e):s}return e},set:function(e,t,r){return null==e?e:_a(e,t,r)},setWith:function(e,t,r,i){return i="function"==typeof i?i:void 0,null==e?e:_a(e,t,r,i)},toPairs:jm,toPairsIn:Um,transform:function(e,t,r){var i=Un(e),n=i||Hn(e)||is(e);if(t=Mh(t),null==r){var s=e&&e.constructor;r=n?i?new s:[]:Yi(e)&&tn(s)?Co(Ps(e)):{}}return(n?bn:jh)(e,(function(e,i,n){return t(r,e,i,n)})),r},unset:function(e,t){return null==e||$g(e,t)},update:function(e,t,r){return null==e?e:T_(e,t,Im(r))},updateWith:function(e,t,r,i){return i="function"==typeof i?i:void 0,null==e?e:T_(e,t,Im(r),i)},values:Rf,valuesIn:function(e){return null==e?[]:kf(e,gs(e))}},q_={at:A_,chain:jp,commit:function(){return new $d(this.value(),this.__chain__)},lodash:Jd,next:function(){void 0===this.__values__&&(this.__values__=Hg(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},plant:function(e){for(var t,r=this;r instanceof Ld;){var i=qd(r);i.__index__=0,i.__values__=void 0,t?n.__wrapped__=i:t=i;var n=i;r=r.__wrapped__}return n.__wrapped__=e,t},reverse:function(){var e=this.__wrapped__;if(e instanceof Ud){var t=e;return this.__actions__.length&&(t=new Ud(this)),(t=t.reverse()).__actions__.push({func:Ky,args:[dy],thisArg:void 0}),new $d(t,this.__chain__)}return this.thru(dy)},tap:function(e,t){return t(e),e},thru:Ky,toIterator:function(){return this},toJSON:Zy,value:Zy,valueOf:Zy,wrapperChain:function(){return jp(this)}},z_={camelCase:Mp,capitalize:Qu,deburr:ip,endsWith:function(e,t,r){e=la(e),t=da(t);var i=e.length,n=r=void 0===r?i:Vp(wd(r),0,i);return(r-=t.length)>=0&&e.slice(r,n)==t},escape:Wm,escapeRegExp:function(e){return(e=la(e))&&Gm.test(e)?e.replace(Hm,"\\$&"):e},kebabCase:vg,lowerCase:bg,lowerFirst:wg,pad:function(e,t,r){e=la(e);var i=(t=wd(t))?bv(e):0;if(!t||i>=t)return e;var n=(t-i)/2;return kv(Cv(n),r)+e+kv(Rv(n),r)},padEnd:function(e,t,r){e=la(e);var i=(t=wd(t))?bv(e):0;return t&&i<t?e+kv(t-i,r):e},padStart:function(e,t,r){e=la(e);var i=(t=wd(t))?bv(e):0;return t&&i<t?kv(t-i,r)+e:e},parseInt:function(e,t,r){return r||null==t?t=0:t&&(t=+t),Iv(la(e).replace(Av,""),t||0)},repeat:function(e,t,r){return t=(r?Ql(e,t,r):void 0===t)?1:wd(t),dv(la(e),t)},replace:function(){var e=arguments,t=la(e[0]);return e.length<3?t:t.replace(e[1],e[2])},snakeCase:_y,split:function(e,t,r){return r&&"number"!=typeof r&&Ql(e,t,r)&&(t=r=void 0),(r=void 0===r?4294967295:r>>>0)?(e=la(e))&&("string"==typeof t||null!=t&&!hg(t))&&!(t=da(t))&&xu(e)?Ou(Ju(e),0,r):e.split(t,r):[]},startCase:Dy,startsWith:function(e,t,r){return e=la(e),r=null==r?0:Vp(wd(r),0,e.length),t=da(t),e.slice(r,r+t.length)==t},template:function(e,t,r){var i=Vy.imports._.templateSettings||Vy;r&&Ql(e,t,r)&&(t=void 0),e=la(e),t=su({},t,i,Ly);var n,s,o=su({},t.imports,i.imports,Ly),a=hs(o),c=kf(o,a),d=0,l=t.interpolate||qy,u="__p += '",p=RegExp((t.escape||qy).source+"|"+l.source+"|"+(l===Fy?$y:qy).source+"|"+(t.evaluate||qy).source+"|$","g"),h=Jy.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/\s/g," ")+"\n":"";e.replace(p,(function(t,r,i,o,a,c){return i||(i=o),u+=e.slice(d,c).replace(zy,Uy),r&&(n=!0,u+="' +\n__e("+r+") +\n'"),a&&(s=!0,u+="';\n"+a+";\n__p += '"),i&&(u+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),d=c+t.length,t})),u+="';\n";var m=Jy.call(t,"variable")&&t.variable;if(m){if(Gy.test(m))throw new Error("Invalid `variable` option passed into `_.template`")}else u="with (obj) {\n"+u+"\n}\n";u=(s?u.replace(By,""):u).replace(Wy,"$1").replace(Hy,"$1;"),u="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(n?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}";var f=wu((function(){return Function(a,h+"return "+u).apply(void 0,c)}));if(f.source=u,Tu(f))throw f;return f},templateSettings:Vy,toLower:function(e){return la(e).toLowerCase()},toUpper:function(e){return la(e).toUpperCase()},trim:function(e,t,r){if((e=la(e))&&(r||void 0===t))return md(e);if(!e||!(t=da(t)))return e;var i=Ju(e),n=Ju(t);return Ou(i,r_(i,n),t_(i,n)+1).join("")},trimEnd:function(e,t,r){if((e=la(e))&&(r||void 0===t))return e.slice(0,pd(e)+1);if(!e||!(t=da(t)))return e;var i=Ju(e);return Ou(i,0,t_(i,Ju(t))+1).join("")},trimStart:function(e,t,r){if((e=la(e))&&(r||void 0===t))return e.replace(i_,"");if(!e||!(t=da(t)))return e;var i=Ju(e);return Ou(i,r_(i,Ju(t))).join("")},truncate:function(e,t){var r=30,i="...";if(Yi(t)){var n="separator"in t?t.separator:n;r="length"in t?wd(t.length):r,i="omission"in t?da(t.omission):i}var s=(e=la(e)).length;if(xu(e)){var o=Ju(e);s=o.length}if(r>=s)return e;var a=r-bv(i);if(a<1)return i;var c=o?Ou(o,0,a).join(""):e.slice(0,a);if(void 0===n)return c+i;if(o&&(a+=c.length-a),hg(n)){if(e.slice(a).search(n)){var d,l=c;for(n.global||(n=RegExp(n.source,la(n_.exec(n))+"g")),n.lastIndex=0;d=n.exec(l);)var u=d.index;c=c.slice(0,void 0===u?a:u)}}else if(e.indexOf(da(n),a)!=a){var p=c.lastIndexOf(n);p>-1&&(c=c.slice(0,p))}return c+i},unescape:function(e){return(e=la(e))&&a_.test(e)?e.replace(o_,s_):e},upperCase:w_,upperFirst:Yu,words:Ap},J_={attempt:wu,bindAll:Iu,cond:function(e){var t=null==e?0:e.length,r=Mh;return e=t?sa(e,(function(e){if("function"!=typeof e[1])throw new TypeError("Expected a function");return[r(e[0]),e[1]]})):[],Yl((function(r){for(var i=-1;++i<t;){var n=e[i];if(Dd(n[0],this,r))return Dd(n[1],this,r)}}))},conforms:function(e){return function(e){var t=hs(e);return function(r){return Oh(r,e,t)}}(Ho(e,1))},constant:rl,defaultTo:function(e,t){return null==e||e!=e?t:e},flow:lf,flowRight:uf,identity:kd,iteratee:function(e){return Mh("function"==typeof e?e:Ho(e,1))},matches:function(e){return wh(Ho(e,1))},matchesProperty:function(e,t){return Ih(e,Ho(t,1))},method:xg,methodOf:jg,mixin:Ug,noop:Fd,nthArg:function(e){return e=wd(e),Yl((function(t){return Gg(t,e)}))},over:ev,overEvery:sv,overSome:ov,property:Dh,propertyOf:function(e){return function(t){return null==e?void 0:ma(e,t)}},range:ry,rangeRight:iy,stubArray:ws,stubFalse:Fn,stubObject:function(){return{}},stubString:function(){return""},stubTrue:function(){return!0},times:function(e,t){if((e=wd(e))<1||e>9007199254740991)return[];var r=Yy,i=Qy(e,Yy);t=Im(t),e-=Yy;for(var n=Pn(i,t);++r<e;)t(r);return n},toPath:function(e){return Un(e)?sa(e,ha):Jo(e)?[e]:Ts(na(la(e)))},uniqueId:function(e){var t=++y_;return la(e)+t}};var K_=Math.max,Y_=Math.min,Q_=Math.min,X_=4294967295,Z_=Array.prototype,eS=Object.prototype.hasOwnProperty,tS=Vi?Vi.iterator:void 0,rS=Math.max,iS=Math.min,nS=function(e){return function(t,r,i){if(null==i){var n=Yi(r),s=n&&hs(r),o=s&&s.length&&pf(r,s);(o?o.length:n)||(i=r,r=t,t=this)}return e(t,r,i)}}(Ug);Jd.after=W_.after,Jd.ary=W_.ary,Jd.assign=$_.assign,Jd.assignIn=$_.assignIn,Jd.assignInWith=$_.assignInWith,Jd.assignWith=$_.assignWith,Jd.at=$_.at,Jd.before=W_.before,Jd.bind=W_.bind,Jd.bindAll=J_.bindAll,Jd.bindKey=W_.bindKey,Jd.castArray=H_.castArray,Jd.chain=q_.chain,Jd.chunk=F_.chunk,Jd.compact=F_.compact,Jd.concat=F_.concat,Jd.cond=J_.cond,Jd.conforms=J_.conforms,Jd.constant=J_.constant,Jd.countBy=V_.countBy,Jd.create=$_.create,Jd.curry=W_.curry,Jd.curryRight=W_.curryRight,Jd.debounce=W_.debounce,Jd.defaults=$_.defaults,Jd.defaultsDeep=$_.defaultsDeep,Jd.defer=W_.defer,Jd.delay=W_.delay,Jd.difference=F_.difference,Jd.differenceBy=F_.differenceBy,Jd.differenceWith=F_.differenceWith,Jd.drop=F_.drop,Jd.dropRight=F_.dropRight,Jd.dropRightWhile=F_.dropRightWhile,Jd.dropWhile=F_.dropWhile,Jd.fill=F_.fill,Jd.filter=V_.filter,Jd.flatMap=V_.flatMap,Jd.flatMapDeep=V_.flatMapDeep,Jd.flatMapDepth=V_.flatMapDepth,Jd.flatten=F_.flatten,Jd.flattenDeep=F_.flattenDeep,Jd.flattenDepth=F_.flattenDepth,Jd.flip=W_.flip,Jd.flow=J_.flow,Jd.flowRight=J_.flowRight,Jd.fromPairs=F_.fromPairs,Jd.functions=$_.functions,Jd.functionsIn=$_.functionsIn,Jd.groupBy=V_.groupBy,Jd.initial=F_.initial,Jd.intersection=F_.intersection,Jd.intersectionBy=F_.intersectionBy,Jd.intersectionWith=F_.intersectionWith,Jd.invert=$_.invert,Jd.invertBy=$_.invertBy,Jd.invokeMap=V_.invokeMap,Jd.iteratee=J_.iteratee,Jd.keyBy=V_.keyBy,Jd.keys=hs,Jd.keysIn=$_.keysIn,Jd.map=V_.map,Jd.mapKeys=$_.mapKeys,Jd.mapValues=$_.mapValues,Jd.matches=J_.matches,Jd.matchesProperty=J_.matchesProperty,Jd.memoize=W_.memoize,Jd.merge=$_.merge,Jd.mergeWith=$_.mergeWith,Jd.method=J_.method,Jd.methodOf=J_.methodOf,Jd.mixin=nS,Jd.negate=Bg,Jd.nthArg=J_.nthArg,Jd.omit=$_.omit,Jd.omitBy=$_.omitBy,Jd.once=W_.once,Jd.orderBy=V_.orderBy,Jd.over=J_.over,Jd.overArgs=W_.overArgs,Jd.overEvery=J_.overEvery,Jd.overSome=J_.overSome,Jd.partial=W_.partial,Jd.partialRight=W_.partialRight,Jd.partition=V_.partition,Jd.pick=$_.pick,Jd.pickBy=$_.pickBy,Jd.property=J_.property,Jd.propertyOf=J_.propertyOf,Jd.pull=F_.pull,Jd.pullAll=F_.pullAll,Jd.pullAllBy=F_.pullAllBy,Jd.pullAllWith=F_.pullAllWith,Jd.pullAt=F_.pullAt,Jd.range=J_.range,Jd.rangeRight=J_.rangeRight,Jd.rearg=W_.rearg,Jd.reject=V_.reject,Jd.remove=F_.remove,Jd.rest=W_.rest,Jd.reverse=F_.reverse,Jd.sampleSize=V_.sampleSize,Jd.set=$_.set,Jd.setWith=$_.setWith,Jd.shuffle=V_.shuffle,Jd.slice=F_.slice,Jd.sortBy=V_.sortBy,Jd.sortedUniq=F_.sortedUniq,Jd.sortedUniqBy=F_.sortedUniqBy,Jd.split=z_.split,Jd.spread=W_.spread,Jd.tail=F_.tail,Jd.take=F_.take,Jd.takeRight=F_.takeRight,Jd.takeRightWhile=F_.takeRightWhile,Jd.takeWhile=F_.takeWhile,Jd.tap=q_.tap,Jd.throttle=W_.throttle,Jd.thru=Ky,Jd.toArray=H_.toArray,Jd.toPairs=$_.toPairs,Jd.toPairsIn=$_.toPairsIn,Jd.toPath=J_.toPath,Jd.toPlainObject=H_.toPlainObject,Jd.transform=$_.transform,Jd.unary=W_.unary,Jd.union=F_.union,Jd.unionBy=F_.unionBy,Jd.unionWith=F_.unionWith,Jd.uniq=F_.uniq,Jd.uniqBy=F_.uniqBy,Jd.uniqWith=F_.uniqWith,Jd.unset=$_.unset,Jd.unzip=F_.unzip,Jd.unzipWith=F_.unzipWith,Jd.update=$_.update,Jd.updateWith=$_.updateWith,Jd.values=$_.values,Jd.valuesIn=$_.valuesIn,Jd.without=F_.without,Jd.words=z_.words,Jd.wrap=W_.wrap,Jd.xor=F_.xor,Jd.xorBy=F_.xorBy,Jd.xorWith=F_.xorWith,Jd.zip=F_.zip,Jd.zipObject=F_.zipObject,Jd.zipObjectDeep=F_.zipObjectDeep,Jd.zipWith=F_.zipWith,Jd.entries=$_.toPairs,Jd.entriesIn=$_.toPairsIn,Jd.extend=$_.assignIn,Jd.extendWith=$_.assignInWith,nS(Jd,Jd),Jd.add=G_.add,Jd.attempt=J_.attempt,Jd.camelCase=z_.camelCase,Jd.capitalize=z_.capitalize,Jd.ceil=G_.ceil,Jd.clamp=function(e,t,r){return void 0===r&&(r=t,t=void 0),void 0!==r&&(r=(r=Sd(r))==r?r:0),void 0!==t&&(t=(t=Sd(t))==t?t:0),Vp(Sd(e),t,r)},Jd.clone=H_.clone,Jd.cloneDeep=H_.cloneDeep,Jd.cloneDeepWith=H_.cloneDeepWith,Jd.cloneWith=H_.cloneWith,Jd.conformsTo=H_.conformsTo,Jd.deburr=z_.deburr,Jd.defaultTo=J_.defaultTo,Jd.divide=G_.divide,Jd.endsWith=z_.endsWith,Jd.eq=H_.eq,Jd.escape=z_.escape,Jd.escapeRegExp=z_.escapeRegExp,Jd.every=V_.every,Jd.find=V_.find,Jd.findIndex=F_.findIndex,Jd.findKey=$_.findKey,Jd.findLast=V_.findLast,Jd.findLastIndex=F_.findLastIndex,Jd.findLastKey=$_.findLastKey,Jd.floor=G_.floor,Jd.forEach=V_.forEach,Jd.forEachRight=V_.forEachRight,Jd.forIn=$_.forIn,Jd.forInRight=$_.forInRight,Jd.forOwn=$_.forOwn,Jd.forOwnRight=$_.forOwnRight,Jd.get=$_.get,Jd.gt=H_.gt,Jd.gte=H_.gte,Jd.has=$_.has,Jd.hasIn=$_.hasIn,Jd.head=F_.head,Jd.identity=kd,Jd.includes=V_.includes,Jd.indexOf=F_.indexOf,Jd.inRange=function(e,t,r){return t=bd(t),void 0===r?(r=t,t=0):r=bd(r),function(e,t,r){return e>=Tf(t,r)&&e<Ef(t,r)}(e=Sd(e),t,r)},Jd.invoke=$_.invoke,Jd.isArguments=H_.isArguments,Jd.isArray=Un,Jd.isArrayBuffer=H_.isArrayBuffer,Jd.isArrayLike=H_.isArrayLike,Jd.isArrayLikeObject=H_.isArrayLikeObject,Jd.isBoolean=H_.isBoolean,Jd.isBuffer=H_.isBuffer,Jd.isDate=H_.isDate,Jd.isElement=H_.isElement,Jd.isEmpty=H_.isEmpty,Jd.isEqual=H_.isEqual,Jd.isEqualWith=H_.isEqualWith,Jd.isError=H_.isError,Jd.isFinite=H_.isFinite,Jd.isFunction=H_.isFunction,Jd.isInteger=H_.isInteger,Jd.isLength=H_.isLength,Jd.isMap=H_.isMap,Jd.isMatch=H_.isMatch,Jd.isMatchWith=H_.isMatchWith,Jd.isNaN=H_.isNaN,Jd.isNative=H_.isNative,Jd.isNil=H_.isNil,Jd.isNull=H_.isNull,Jd.isNumber=H_.isNumber,Jd.isObject=Yi,Jd.isObjectLike=H_.isObjectLike,Jd.isPlainObject=H_.isPlainObject,Jd.isRegExp=H_.isRegExp,Jd.isSafeInteger=H_.isSafeInteger,Jd.isSet=H_.isSet,Jd.isString=H_.isString,Jd.isSymbol=H_.isSymbol,Jd.isTypedArray=H_.isTypedArray,Jd.isUndefined=H_.isUndefined,Jd.isWeakMap=H_.isWeakMap,Jd.isWeakSet=H_.isWeakSet,Jd.join=F_.join,Jd.kebabCase=z_.kebabCase,Jd.last=Em,Jd.lastIndexOf=F_.lastIndexOf,Jd.lowerCase=z_.lowerCase,Jd.lowerFirst=z_.lowerFirst,Jd.lt=H_.lt,Jd.lte=H_.lte,Jd.max=G_.max,Jd.maxBy=G_.maxBy,Jd.mean=G_.mean,Jd.meanBy=G_.meanBy,Jd.min=G_.min,Jd.minBy=G_.minBy,Jd.stubArray=J_.stubArray,Jd.stubFalse=J_.stubFalse,Jd.stubObject=J_.stubObject,Jd.stubString=J_.stubString,Jd.stubTrue=J_.stubTrue,Jd.multiply=G_.multiply,Jd.nth=F_.nth,Jd.noop=J_.noop,Jd.now=B_,Jd.pad=z_.pad,Jd.padEnd=z_.padEnd,Jd.padStart=z_.padStart,Jd.parseInt=z_.parseInt,Jd.random=function(e,t,r){if(r&&"boolean"!=typeof r&&Ql(e,t,r)&&(t=r=void 0),void 0===r&&("boolean"==typeof t?(r=t,t=void 0):"boolean"==typeof e&&(r=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=bd(e),void 0===t?(t=e,e=0):t=bd(t)),e>t){var i=e;e=t,t=i}if(r||e%1||t%1){var n=Xv();return Qv(e+n*(t-e+Yv("1e-"+((n+"").length-1))),t)}return Kv(e,t)},Jd.reduce=V_.reduce,Jd.reduceRight=V_.reduceRight,Jd.repeat=z_.repeat,Jd.replace=z_.replace,Jd.result=$_.result,Jd.round=G_.round,Jd.sample=V_.sample,Jd.size=V_.size,Jd.snakeCase=z_.snakeCase,Jd.some=V_.some,Jd.sortedIndex=F_.sortedIndex,Jd.sortedIndexBy=F_.sortedIndexBy,Jd.sortedIndexOf=F_.sortedIndexOf,Jd.sortedLastIndex=F_.sortedLastIndex,Jd.sortedLastIndexBy=F_.sortedLastIndexBy,Jd.sortedLastIndexOf=F_.sortedLastIndexOf,Jd.startCase=z_.startCase,Jd.startsWith=z_.startsWith,Jd.subtract=G_.subtract,Jd.sum=G_.sum,Jd.sumBy=G_.sumBy,Jd.template=z_.template,Jd.times=J_.times,Jd.toFinite=H_.toFinite,Jd.toInteger=wd,Jd.toLength=H_.toLength,Jd.toLower=z_.toLower,Jd.toNumber=H_.toNumber,Jd.toSafeInteger=H_.toSafeInteger,Jd.toString=H_.toString,Jd.toUpper=z_.toUpper,Jd.trim=z_.trim,Jd.trimEnd=z_.trimEnd,Jd.trimStart=z_.trimStart,Jd.truncate=z_.truncate,Jd.unescape=z_.unescape,Jd.uniqueId=J_.uniqueId,Jd.upperCase=z_.upperCase,Jd.upperFirst=z_.upperFirst,Jd.each=V_.forEach,Jd.eachRight=V_.forEachRight,Jd.first=F_.head,nS(Jd,function(){var e={};return jh(Jd,(function(t,r){eS.call(Jd.prototype,r)||(e[r]=t)})),e}(),{chain:!1}),Jd.VERSION="4.17.21",(Jd.templateSettings=z_.templateSettings).imports._=Jd,bn(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Jd[e].placeholder=Jd})),bn(["drop","take"],(function(e,t){Ud.prototype[e]=function(r){r=void 0===r?1:rS(wd(r),0);var i=this.__filtered__&&!t?new Ud(this):this.clone();return i.__filtered__?i.__takeCount__=iS(r,i.__takeCount__):i.__views__.push({size:iS(r,X_),type:e+(i.__dir__<0?"Right":"")}),i},Ud.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),bn(["filter","map","takeWhile"],(function(e,t){var r=t+1,i=1==r||3==r;Ud.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Mh(e),type:r}),t.__filtered__=t.__filtered__||i,t}})),bn(["head","last"],(function(e,t){var r="take"+(t?"Right":"");Ud.prototype[e]=function(){return this[r](1).value()[0]}})),bn(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");Ud.prototype[e]=function(){return this.__filtered__?new Ud(this):this[r](1)}})),Ud.prototype.compact=function(){return this.filter(kd)},Ud.prototype.find=function(e){return this.filter(e).head()},Ud.prototype.findLast=function(e){return this.reverse().find(e)},Ud.prototype.invokeMap=Yl((function(e,t){return"function"==typeof e?new Ud(this):this.map((function(r){return Jf(r,e,t)}))})),Ud.prototype.reject=function(e){return this.filter(Bg(Mh(e)))},Ud.prototype.slice=function(e,t){e=wd(e);var r=this;return r.__filtered__&&(e>0||t<0)?new Ud(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),void 0!==t&&(r=(t=wd(t))<0?r.dropRight(-t):r.take(t-e)),r)},Ud.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Ud.prototype.toArray=function(){return this.take(X_)},jh(Ud.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),n=Jd[i?"take"+("last"==t?"Right":""):t],s=i||/^find/.test(t);n&&(Jd.prototype[t]=function(){var t=this.__wrapped__,o=i?[1]:arguments,a=t instanceof Ud,c=o[0],d=a||Un(t),l=function(e){var t=n.apply(Jd,Is([e],o));return i&&u?t[0]:t};d&&r&&"function"==typeof c&&1!=c.length&&(a=d=!1);var u=this.__chain__,p=!!this.__actions__.length,h=s&&!u,m=a&&!p;if(!s&&d){t=m?t:new Ud(this);var f=e.apply(t,o);return f.__actions__.push({func:Ky,args:[l],thisArg:void 0}),new $d(f,u)}return h&&m?e.apply(this,o):(f=this.thru(l),h?i?f.value()[0]:f.value():f)})})),bn(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Z_[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);Jd.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var n=this.value();return t.apply(Un(n)?n:[],e)}return this[r]((function(r){return t.apply(Un(r)?r:[],e)}))}})),jh(Ud.prototype,(function(e,t){var r=Jd[t];if(r){var i=r.name+"";eS.call(Wd,i)||(Wd[i]=[]),Wd[i].push({name:t,func:r})}})),Wd[Al(void 0,2).name]=[{name:"wrapper",func:void 0}],Ud.prototype.clone=function(){var e=new Ud(this.__wrapped__);return e.__actions__=Ts(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ts(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ts(this.__views__),e},Ud.prototype.reverse=function(){if(this.__filtered__){var e=new Ud(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Ud.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=Un(e),i=t<0,n=r?e.length:0,s=function(e,t,r){for(var i=-1,n=r.length;++i<n;){var s=r[i],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=Y_(t,e+o);break;case"takeRight":e=K_(e,t-o)}}return{start:e,end:t}}(0,n,this.__views__),o=s.start,a=s.end,c=a-o,d=i?a:o-1,l=this.__iteratees__,u=l.length,p=0,h=Q_(c,this.__takeCount__);if(!r||!i&&n==c&&h==c)return Xy(e,this.__actions__);var m=[];e:for(;c--&&p<h;){for(var f=-1,g=e[d+=t];++f<u;){var v=l[f],y=v.iteratee,_=v.type,S=y(g);if(2==_)g=S;else if(!S){if(1==_)continue e;break e}}m[p++]=g}return m},Jd.prototype.at=q_.at,Jd.prototype.chain=q_.wrapperChain,Jd.prototype.commit=q_.commit,Jd.prototype.next=q_.next,Jd.prototype.plant=q_.plant,Jd.prototype.reverse=q_.reverse,Jd.prototype.toJSON=Jd.prototype.valueOf=Jd.prototype.value=q_.value,Jd.prototype.first=Jd.prototype.head,tS&&(Jd.prototype[tS]=q_.toIterator);const sS="chrome",oS="opera",aS="firefox",cS="iexplorer",dS="safari",lS="nwjs",uS="electron",pS="react-native",hS="unknown",mS={Chrome:sS,Chromium:sS,Opera:oS,Firefox:aS,"Internet Explorer":cS,Safari:dS};function fS(){const{userAgent:e}=navigator;if(e.match(/Electron/)){const t=e.match(/Electron\/([\d.]+)/)[1];return{name:uS,version:t}}return null}function gS(){const{userAgent:e}=navigator;if(e.match(/JitsiMeetNW/)){const t=e.match(/JitsiMeetNW\/([\d.]+)/)[1];return{name:lS,version:t}}}function vS(){const e=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i);let t;if(e||"ReactNative"===navigator.product)return e&&e.length>2&&(e[1],t=e[2]),t||(t="unknown"),{name:pS,version:t}}class yS{constructor(){Kt(this,"_bowser"),Kt(this,"_name"),Kt(this,"_version"),Kt(this,"getDeviceInfo",(()=>({isMobile:this.isMobile(),browserName:this._bowser.getBrowserName(),osName:this._bowser.getOSName(),browserVersion:this._bowser.getBrowserVersion(),osVersionName:this._bowser.getOSVersion(),engineName:this._bowser.getEngineName()})))}init(e){let t,r;if(this._bowser=f().getParser(navigator.userAgent),void 0===e){const e=function(e){let t;const r=[vS,fS,gS];for(let e=0;e<r.length;e+=1)if(t=r[e](),t)return t;const i=e.getBrowserName();return i in mS?{name:mS[i],version:e.getBrowserVersion()}:(t=function(){const{userAgent:e}=navigator,t={name:hS,version:void 0};if(e.match(/Chrome/)&&!e.match(/Edge/))if(e.match(/Edg(A?)/)){const r=e.match(/Chrome\/([\d.]+)/)[1];Number.parseInt(r,10)>72&&(t.name=sS,t.version=r)}else t.name=sS,t.version=e.match(/Chrome\/([\d.]+)/)[1];return t}(),t||{name:hS,version:void 0})}(this._bowser);t=e.name,r=e.version}else e.name in mS?(t=mS[e.name],r=e.version):(t=hS,r=void 0);this._name=t,this._version=r}getName(){return this._name}isChrome(){return this._name===sS}isOpera(){return this._name===oS}isFirefox(){return this._name===aS}isIExplorer(){return this._name===cS}isSafari(){return this._name===dS}isNWJS(){return this._name===lS}isElectron(){return this._name===uS}isReactNative(){return this._name===pS||!0===navigator.isReactNative}getVersion(){return this._version}isMobile(){return"mobile"===this._bowser.getPlatformType()}_checkCondition(e){if(this._version)return this._bowser.satisfies(e)}isVersionGreaterThan(e){return this._checkCondition({[this._name]:`>${e}`})}isVersionLessThan(e){return this._checkCondition({[this._name]:`<${e}`})}isVersionEqualTo(e){return this._checkCondition({[this._name]:`~${e}`})}}const _S=new class extends yS{doesVideoMuteByStreamRemove(){return this.isChromiumBased()||this.isWebKitBased()}supportsP2P(){return!this.usesUnifiedPlan()}isChromiumBased(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()}isWebKitBased(){return this._bowser.isEngine("webkit")&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&void 0!==window.RTCRtpTransceiver&&Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection")>-1}isSupported(){return this.isChromiumBased()&&this._getChromiumBasedVersion()>=72||this.isFirefox()||this.isReactNative()||this.isWebKitBased()}isUserInteractionRequiredForUnmute(){return this.isFirefox()&&this.isVersionLessThan("68")}supportsVideoMuteOnConnInterrupted(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsBandwidthStatistics(){return!this.isFirefox()&&!this.isWebKitBased()}supportsCodecPreferences(){return this.usesUnifiedPlan()&&void 0!==window.RTCRtpTransceiver&&Object.keys(window.RTCRtpTransceiver.prototype).indexOf("setCodecPreferences")>-1&&Object.keys(RTCRtpSender.prototype).indexOf("getCapabilities")>-1&&!this.isWebKitBased()}supportsDeviceChangeEvent(){return navigator.mediaDevices&&void 0!==navigator.mediaDevices.ondevicechange&&void 0!==navigator.mediaDevices.addEventListener}supportsLocalCandidateRttStatistics(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsPerformanceObserver(){return void 0!==window.PerformanceObserver&&PerformanceObserver.supportedEntryTypes.indexOf("longtask")>-1}supportsReceiverStats(){return void 0!==window.RTCRtpReceiver&&Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources")>-1}supportsRTTStatistics(){return!this.isFirefox()}usesPlanB(){return!this.usesUnifiedPlan()}usesSdpMungingForSimulcast(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}usesUnifiedPlan(){return!(!this.isFirefox()&&!this.isWebKitBased())}usesNewGumFlow(){return!!(this.isChromiumBased()||this.isFirefox()||this.isWebKitBased())}usesAdapter(){return this.usesNewGumFlow()}usesRidsForSimulcast(){return!1}supportsGetDisplayMedia(){return void 0!==navigator.getDisplayMedia||void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getDisplayMedia}supportsInsertableStreams(){if(void 0===window.RTCRtpSender||!window.RTCRtpSender.prototype.createEncodedStreams&&!window.RTCRtpSender.prototype.createEncodedVideoStreams)return!1;const e=new ReadableStream;try{return window.postMessage(e,"*",[e]),!0}catch(e){return!1}}supportsAudioRed(){return Boolean(window.RTCRtpSender&&window.RTCRtpSender.getCapabilities&&window.RTCRtpSender.getCapabilities("audio").codecs.some((e=>"audio/red"===e.mimeType))&&window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("audio").codecs.some((e=>"audio/red"===e.mimeType)))}supportsSdpSemantics(){return this.isChromiumBased()}_getChromiumBasedVersion(){if(this.isChromiumBased()){if(this.isNWJS())return Number.parseInt(process.versions.chromium,10);const e=navigator.userAgent;if(e.match(/Chrome/))return Number.parseInt(e.match(/Chrome\/([\d.]+)/)[1],10)}return-1}isIOSMobile(){return this.isMobile&&"iOS"===this._bowser.getOSName()}},SS={gross:{width:{ideal:192},height:{ideal:144}},qvga:{width:{ideal:384},height:{ideal:288}},pvga:{width:{ideal:480},height:{ideal:360}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}},hd_cropped:{width:{ideal:900},height:{ideal:720}},fhd:{width:{ideal:1920},height:{ideal:1080}}},ES={},TS=[{active:!1,adaptivePtime:!1,networkPriority:"low",priority:"low"},{active:!1,adaptivePtime:!1,networkPriority:"low",priority:"low"},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:25e5}],bS=[{active:!1,priority:"low"},{active:!1,priority:"low"},{active:!0,priority:"low"}],wS={320:[{rid:"q",maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"}],640:[{rid:"q",scaleResolutionDownBy:2,maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:7e5,maxFramerate:30,scalabilityMode:"L1T1"}],1280:[{rid:"q",scaleResolutionDownBy:2,maxBitrate:5e5,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:13e5,maxFramerate:30,scalabilityMode:"L1T1"}]},kS=[{scalabilityMode:"L3T3_KEY"}];var RS=(e=>(e.WEBCAM="webcam",e.MIC="mic",e.SCREENSHARE_VIDEO="screenshare_video",e.SCREENSHARE_AUDIO="screenshare_audio",e))(RS||{});function CS(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>CS(e)));const t={};return Object.keys(e).forEach((r=>{const i=s(r)?r:function(e){return e.replace(/([-_]\w)/g,(e=>e[1].toUpperCase()))}(r);t[i]=CS(e[r])})),t}function AS(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>AS(e)));const t={};return Object.keys(e).forEach((r=>{const i=s(r)?r:function(e){return e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))}(r);t[i]=e[r]})),t}function IS(e,t={}){return null==e?{}:(Object.getOwnPropertyNames(e).forEach((r=>{if("function"!=typeof e[r]){if("object"==typeof e[r])return void IS(e[r],t[r]={});t[r]=e[r]}})),t)}var PS=(e=>(e.PARTICIPANT="PARTICIPANT",e.PEER="PEER",e.CLIENT="CLIENT",e))(PS||{});const DS={INTERNAL_CALL_STATS:"internal_call_stats",SIMULCAST:"simulcast",CHAT_SOCKET_SERVER:"chat_socket_server",POLL_SOCKET_SERVER:"poll_socket_server",PLUGIN_SOCKET_SERVER:"plugin_socket_server",NR_OTEL_WEB:"nr_otel_web",CONNECTED_MEETINGS:"connected_meetings",ICE_RESTART_ON_FAILED_STATE:"ice_restart_on_failed_state",ICE_RESTART_ON_DISCONNECTED_STATE:"ice_restart_on_disconnected_state",ENABLE_ICE_STATE_LOGGING:"enable_ice_state_logging",REMOVE_OPERATIONAL_MIC:"web_core_remove_operational_mic",SUPPRESS_PEER_MUTE_UNMUTE_EMITS:"web_core_suppress_peer_mute_unmute_emits",SKIP_OTEL_TRACES:"skip_otel_traces",NEW_LOCAL_MEDIA_HANDLER:"new_local_media_handler",CALLSTATS_INGESTION_LAYER:"callstats_ingestion_layer",USE_USERIDS_IN_CHAT:"use_userids_in_chat",CUSTOM_PING_PONG:"custom_ping_pong",ENABLE_HIVE_SIMULCAST:"enable_hive_simulcast",ENABLE_HIVE_TRANSPORT_RECONNECTION_ON_ICE_FAILED:"enable_hive_transport_reconnection_on_ice_failed",ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY:"enable_hive_fail_recovery",ENABLE_HIVE_INFINITE_RETRIES:"enable_hive_infinite_retries",BYPASS_LOG_EXCLUSION_LIST:"bypass_log_exclusion_list",LOG_LEVEL:"log_level",V1_PLUGINS:"v1_plugins",SCREENSHARE_DTX:"screenshare_dtx",SCREENSHARE_PRIORITY:"screenshare_priority",SCREENSHARE_MIN_BITRATE:"screenshare_minbitrate",SCREENSHARE_MAX_DIMENSIONS:"screenshare_maxdimensions",SCREENSHARE_SIMULCAST:"screenshare_simulcast",DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE:"disable_webcam_layers_on_screenshare",SCREENSHARE_FORCE_GOOG_CONFERENCE:"screenshare_force_goog_conference",LIVESTREAM:"feat_livestream",FETCH_RETRY:"fetch_retry",DEVICE_REMOVE_EXP:"device_remove_exp",DISABLE_WEBCAM_SIMULCAST:"webcore_disable_webcam_simulcast",OVERRIDE_WEBCAM_SIMULCAST:"override_webcam_simulcast",SOCKET_POLLING:"socket_polling",NS_NETWORK_SCORE:"ns_network_score",FEAT_PAGINATED_CHAT:"feat_paginated_chat",VAL_MIN_FRAMERATE:"val_min_framerate",EXTENSION_HACK:"extension_hack",VAL_MAX_FRAMERATE_EXT:"val_max_framerate_ext",VAL_MIN_FRAMERATE_EXT:"val_min_framerate_ext",SCREEENSHARE_ERR_HACK:"screenshare_err_hack",TROUBLESHOOTING:"feat_troubleshooting",VIDEO_CONSTRAINTS:"video_constraints",SCREENSHARE_CONSTRAINTS:"screenshare_constraints",FEAT_CHAT_SDK:"feat_chat_sdk",FEAT_CHAT_SDK_SEARCH:"chat_search",OBS_QUALITY:"obs_quality",ALLOW_SAFARI_MEDIA_MIDDLEWARES:"allow_safari_media_middlewares",DYNAMIC_VIDEO_QUALITY:"dynamic_video_quality",EXP_RESHARE:"exp_reshare",LEAVE_STAGE_ON_END:"leave_stage_on_end",SKIP_SETTING_IN_USE_DEVICE:"skip_setting_in_use_device",PRECALL_BANDWIDTH_TEST:"precall_bandwidth_test"},MS=CS(qo(Ta).config.media);var OS;class NS{constructor(e){Xt(this,OS,void 0),Kt(this,"getScreenShareConstraints",(()=>{var e,t,r,i,n,s,o,a,c,d;const{displaySurface:l}=null!=(e=td.defaults.screenShare)?e:{},u=null==(t=Qt(this,OS))?void 0:t.screenshare,p=null!=(i=null==(r=null==u?void 0:u.width)?void 0:r.max)?i:1920,h=null!=(s=null==(n=null==u?void 0:u.height)?void 0:n.max)?s:1080,m=null!=(a=null==(o=null==u?void 0:u.frameRate)?void 0:o.max)?a:5;let f=null!=(d=null==(c=null==u?void 0:u.frameRate)?void 0:c.ideal)?d:5;Ci.getValue(DS.VAL_MIN_FRAMERATE)&&(f=parseInt(Ci.getValue(DS.VAL_MIN_FRAMERATE),10));let g={width:{max:p},height:{max:h},frameRate:{ideal:f,max:m}};if(Ci.hasFeature(DS.SCREENSHARE_CONSTRAINTS)){const e=Ci.getValue(DS.SCREENSHARE_CONSTRAINTS);g=JSON.parse(e)}return void 0!==l&&["monitor","browser","window"].includes(l)&&(g=zt(qt({},g),{displaySurface:l})),{audio:!0,video:g}})),Kt(this,"getAudioConstraints",(e=>{var t,r,i,n,s,o,a,c;const d={},l=null==(t=Qt(this,OS))?void 0:t.audio,u=null!=l&&l.enableStereo?2:1;return _S.isFirefox()||_S.isWebKitBased()?(d.audio={deviceId:e,autoGainControl:null==(r=null==l?void 0:l.autoGainControl)||r,echoCancellation:null==(i=null==l?void 0:l.echoCancellation)||i,noiseSuppression:null==(n=null==l?void 0:l.noiseSupression)||n,channelCount:u},d):(d.audio={},d.audio.optional=[e?{sourceId:e}:{sourceId:"default"},{channelCount:u},{echoCancellation:null==(s=null==l?void 0:l.echoCancellation)||s},{googEchoCancellation:null==(o=null==l?void 0:l.echoCancellation)||o},{googAutoGainControl:null==(a=null==l?void 0:l.autoGainControl)||a},{googNoiseSuppression:null==(c=null==l?void 0:l.noiseSupression)||c},{googHighpassFilter:!0}],d)})),Kt(this,"getVideoConstraints",(e=>{var t,r,i;const n={},s=null==(t=Qt(this,OS))?void 0:t.video;let o=SS.vga;if("string"==typeof s?o=SS[s]:void 0!==s&&(o.height.ideal=s.height.ideal,o.width.ideal=s.width.ideal),o.frameRate={ideal:null!=(i=null==(r=o.frameRate)?void 0:r.ideal)?i:24},_S.isChromiumBased()&&(o.frameRate.max=30),Ci.hasFeature(DS.VIDEO_CONSTRAINTS)){const e=Ci.getValue(DS.VIDEO_CONSTRAINTS);o=JSON.parse(e)}return n.video=o,e?n.video.deviceId={exact:e}:n.video.facingMode="user",n})),Zt(this,OS,e)}getUpdatedVideoConstraints(e){return e}}function xS(e){const t={};return"number"==typeof(null==e?void 0:e.code)&&(t.code=e.code),"string"==typeof(null==e?void 0:e.code)&&(t.code=e.code.substring(0,100)),"string"==typeof(null==e?void 0:e.name)&&(t.name=e.name.substring(0,500)),"string"==typeof(null==e?void 0:e.message)&&(t.message=e.message.substring(0,500)),"string"==typeof(null==e?void 0:e.reason)&&(t.reason=e.reason.substring(0,500)),"string"==typeof(null==e?void 0:e.stack)&&(t.stack=e.stack.substring(0,500)),t}function LS(){var e,t,r,i;const n="undefined"!=typeof navigator&&!navigator.isReactNative&&(null==(e=window.location.host)?void 0:e.includes("devel"))&&(null==(t=window.location.host)?void 0:t.includes("dyte.io")),s=!(null==(i=null==(r=td.modules)?void 0:r.devTools)||!i.logs);return n||s}function jS(e,t,r={}){return Object.getOwnPropertyNames(e).forEach((i=>{var n;if([null,void 0,NaN].includes(e[i])||t&&((null==(n=t.match(/\./g))?void 0:n.length)||0)>=10)return;const s=t?`${t}.${i}`:i;"object"==typeof e[i]?jS(e[i],s,r):["number","string","boolean"].includes(typeof e[i])&&(r[s]=e[i])})),r}function US(e,t={},r=""){const i={};try{const i=JSON.stringify(t),n=jS(JSON.parse(i),r),s=JSON.stringify(n);if(s.length>5e3){const r=`Log named: "${e}" is trying to log an flattened object of size ${s.length} chars that is beyond permitted limit of 5000 chars. Please optimize.`;throw LS()&&console.error(r,{log:t,flattened:s}),new Error(r)}return JSON.parse(s)}catch(e){const t=xS(e);i[`${r}.error.message`]=t.message||"",i[`${r}.error.stack`]=t.stack||"",i[`${r}.error.reason`]=t.reason||"",i[`${r}.error.source`]="safelyFlattenObjForOpenTelemetry"}return i}OS=new WeakMap;const FS=class{static get logsEndpoint(){return`https://${sd({servicePrefix:"api-silos",apiBase:td.apiBase,baseURI:td.baseURI})}/otel/logs`}static init(e,t){navigator.isReactNative||(FS.tracingEnabled=t,FS.meetingMetadata.peerId=e,FS.meetingMetadata.sdkVersion=id,FS.meetingMetadata.deviceInfo=_S.getDeviceInfo(),FS.meetingMetadata.visitedUrl=!navigator.isReactNative&&"undefined"!=typeof window&&window.location.href,document.addEventListener("visibilitychange",FS.processCachedLogs),FS.logsProcessorTimer=setInterval(FS.processCachedLogs,FS.logsProcessingInterval),t&&(FS.initialized=!0))}static trace(e){return(t,r,i)=>{const n=i.value;return i.value=function(...t){if(!FS.initialized||navigator.isReactNative||!FS.tracingEnabled||Ci.hasFeature(DS.SKIP_OTEL_TRACES))return n.apply(this,t);FS.addLogInCurrentSpan("info",e);const r=performance.now(),i=n.apply(this,t);return Promise.resolve(i).then((()=>{const t=performance.now();FS.addLogInCurrentSpan("info",`${e}_timing`,{execTime:t-r})})).catch((()=>{const t=performance.now();FS.addLogInCurrentSpan("info",`${e}_timing`,{execTime:t-r})})),i},i}}static injectContext(e){var t;const r=u().replace(/-/g,"").substring(0,16),i=null==(t=FS.meetingMetadata.peerId)?void 0:t.replace(/-/g,"");e.TRACEPARENT=`00-${i}-${r}-01`}static addLogInCurrentSpan(e,t,r={},i=!1){if(null!=r&&r.error&&Object.assign(r,{error:xS(r.error)}),LS()&&(sg(r)?console[e]("DyteInternalLogs:: ",e,t):console[e]("DyteInternalLogs:: ",e,t,r)),function(e){if(Ci.hasFeature(DS.LOG_LEVEL)){let t=Ci.getValue(DS.LOG_LEVEL)||"all";if(t=t.toLowerCase().trim(),"off"===t)return!1;if("all"!==t){const r=["debug","log","info","warn","error"];if(r.indexOf(e)<r.indexOf(t))return!1}}return!0}(e))try{const n=US(t,r,"metadata"),s=new Date,o=zt(qt({message:t,level:e},n),{loggedAt:s.toISOString(),loggedAtTzOffset:s.getTimezoneOffset()});i?FS.sendOtelLogsToNewRelic([o]):FS.logsCache.push(o)}catch(e){FS.addLogInCurrentSpan("error","opentelemetry::addLogInCurrentSpan_failed",{error:xS(e)})}}static sendOtelLogsToNewRelic(e){h().post(FS.logsEndpoint,{meetingMetadata:US("sendOtelLogsToNewRelic",FS.meetingMetadata,"meetingMetadata"),serviceName:nd,logs:e}).catch((t=>{FS.addLogInCurrentSpan("error","opentelemetry::sendOtelLogToNewRelic_failed",{error:xS(t)}),FS.logsCache.push(...e)}))}static processCachedLogs(){const e=FS.logsCache.splice(0,25);null!=e&&e.length&&FS.sendOtelLogsToNewRelic(e)}static destruct(){clearInterval(FS.logsProcessorTimer),FS.processCachedLogs(),!navigator.isReactNative&&document.removeEventListener("visibilitychange",FS.processCachedLogs)}};let VS=FS;Kt(VS,"logsCache",[]),Kt(VS,"logsProcessorTimer"),Kt(VS,"tracingEnabled",!0),Kt(VS,"initialized",!1),Kt(VS,"logsProcessingInterval",7e3),Kt(VS,"logExclusionList",["message","websocket/message","roomMessage","websocket/room-message","websocket/room-legacy-mode","chatMessage","websocket/new-chat-message","websocket/no-active-speaker","websocket/selected-peers","websocket/active-speaker","ping","websocket/new-consumer","websocket/producer-score","websocket/consumer-score","websocket/plugin-event","websocket/plugin-data","websocket/plugin-internal-data"]),Kt(VS,"meetingMetadata",{});class BS{static info(e,t,r){VS.addLogInCurrentSpan("info",e,t,r)}static error(e,t,r){VS.addLogInCurrentSpan("error",e,t,r)}static debug(e,t,r){VS.addLogInCurrentSpan("debug",e,t,r)}static log(e,t,r){VS.addLogInCurrentSpan("log",e,t,r)}static warn(e,t,r){VS.addLogInCurrentSpan("warn",e,t,r)}}class WS extends ir.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(e,...t){return super.emit("*",e,...t),super.emit(e,...t)}on(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.on(e,t)}addListener(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.addListener(e,t)}off(e,t){return super.off(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}listeners(e){return super.listeners(e)}listenerCount(e){return super.listenerCount(e)}}class HS extends ir.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(e,...t){return super.emit("*",e,...t),super.emit(e,...t)}on(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.on(e,t)}addListener(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.addListener(e,t)}off(e,t){return super.off(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}listeners(e){return super.listeners(e)}listenerCount(e){return super.listenerCount(e)}}const GS={"00":"DyteClient","01":"Controller","02":"RoomNodeClient","03":"HiveNodeClient","04":"SocketService","05":"Chat","06":"Plugin","07":"Polls","08":"Meta","09":"Preset",10:"Recording",11:"Self",12:"Participant",13:"Spotlight",14:"Remote Request",15:"Webinar",16:"LocalMediaHandler"},$S={"0000":"Internal exception.","0001":"Failed to initialize.","0002":"Failed to join room.","0003":"Failed to leave room.","0100":"Internal exception","0200":"Internal exception.","0300":"Internal exception","0400":"Internal exception","0500":"Internal exception","0501":"Permission denied.","0502":"Invalid message body.","0510":"Invalid channel name.","0600":"Internal exception","0700":"Internal exception","0800":"Internal exception","0900":"Internal exception",1e3:"Internal exception",1100:"Internal exception",1200:"Internal exception",1300:"Internal exception",1400:"Internal exception",1500:"Internal exception",1600:"Internal exception",1601:"Failed to get audio track",1602:"Failed to get video track",1603:"Incorrect device",1604:"Failed to change device",1700:"Internal exception"};Object.keys($S).forEach((e=>{$S[e]=`{${GS[e.slice(0,2)]}} ${$S[e]}`}));class qS extends Error{constructor(e,t,r=!1){super(e),Kt(this,"code"),this.code=t,this.name="DyteError",this.message=`[ERR${this.code}]: ${$S[this.code]}\n${this.message}`;try{let e=r;t&&t.endsWith("00")&&(e=!0),e&&BS.error("DyteError",{error:{message:this.message,name:this.name,code:t}})}catch(e){}}}function zS(e,t,r,i){if(!("function"==typeof r&&i instanceof t))throw i;r.call(null,i,e)}function JS(e,t,r){if(!e.value){const i=e.get,n=e.set;return i&&(e.get=function(){try{return i.apply(this)}catch(e){zS(this,t,r,e)}}),n&&(e.set=function(e){try{return n.apply(this,[e])}catch(e){zS(this,t,r,e)}}),e}const i=e.value;return e.value=function(...e){try{const n=i.apply(this,e);return n&&n instanceof Promise?n.catch((e=>{zS(this,t,r,e)})):n}catch(e){zS(this,t,r,e)}},e}const KS=e=>function(e,t){return(r,i,n)=>{if(n)return JS(n,e,t);for(const i of Reflect.ownKeys(r.prototype).filter((e=>"constructor"!==e))){const n=Object.getOwnPropertyDescriptor(r.prototype,i);(n.value instanceof Function||n.get instanceof Function||n.set instanceof Function)&&Object.defineProperty(r.prototype,i,JS(n,e,t))}}}(Error,e);var YS,QS,XS=(e=>(e.NEW_PRODUCER="NEW_PRODUCER",e.PRODUCER_TRACK_ENDED="PRODUCER_TRACK_ENDED",e.ROOM_NODE_CONNECTED="ROOM_NODE_CONNECTED",e.ROOM_NODE_DISCONNECTED="ROOM_NODE_DISCONNECTED",e.ROOM_NODE_CONNECTION_ERROR="ROOM_NODE_CONNECTION_ERROR",e.SOCKET_SERVICE_CONNECTED="SOCKET_SERVICE_CONNECTED",e.SOCKET_SERVICE_DISCONNECTED="SOCKET_SERVICE_DISCONNECTED",e.SOCKET_SERVICE_RECONNECTING="SOCKET_SERVICE_RECONNECTING",e.SOCKET_SERVICE_RECONNECTION_ATTEMPT="SOCKET_SERVICE_RECONNECTION_ATTEMPT",e.SOCKET_SERVICE_RECONNECT_FAILURE="SOCKET_SERVICE_RECONNECT_FAILURE",e.SOCKET_SERVICE_RECONNECTED="SOCKET_SERVICE_RECONNECTED",e.SOCKET_SERVICE_FAILED="SOCKET_SERVICE_FAILED",e.ROOM_JOINED="ROOM_JOINED",e.SOCKET_SERVICE_ROOM_JOINED="SOCKET_SERVICE_ROOM_JOINED",e.SELF_ROOM_JOINED="SELF_ROOM_JOINED",e.PRODUCER_SCORE_UPDATE="PRODUCER_SCORE_UPDATE",e.CONSUMER_SCORE_UPDATE="CONSUMER_SCORE_UPDATE",e.PRODUCER_STATUS_UPDATE="PRODUCER_STATUS_UPDATE",e.CONSUMER_STATUS_UPDATE="CONSUMER_STATUS_UPDATE",e.LOW_PRODUCER_SCORE="LOW_PRODUCER_SCORE",e.LOW_CONSUMER_SCORE="LOW_CONSUMER_SCORE",e.MEDIA_PERMISSION_ERROR="MEDIA_PERMISSION_ERROR",e.MEDIA_PERMISSION_UPDATE="MEDIA_PERMISSION_UPDATE",e.WAITLISTED="WAIT_LISTED",e.WAITLIST_ACCEPTED="websocket/waitlist-accepted",e.WAITLIST_REJECTED="websocket/waitlist-rejected",e.WAITLIST_PEER_ADDED="websocket/waitlist-peer-added",e.WAITLIST_PEER_REMOVED="websocket/waitlist-peer-closed",e.MESSAGE="websocket/message",e.ROOM_MESSAGE="websocket/room-message",e.DISABLE_AUDIO="websocket/disable-audio",e.DISABLE_VIDEO="websocket/disable-video",e.PEER_JOINED="websocket/peer-joined",e.PEER_CLOSED="websocket/peer-closed",e.PEER_MUTED="websocket/peer-muted",e.PEER_UNMUTED="websocket/peer-unmuted",e.PEER_PINNED="websocket/pin-peer",e.PEER_UNPINNED="websocker/unpin-peer",e.MUTE_ALL="websocket/mute-all",e.MUTE_ALL_VIDEO="websocket/mute-all-video",e.CONSUMER_CLOSED="websocket/consumer-closed",e.CONSUMER_PAUSED="websocket/consumer-paused",e.CONSUMER_RESUMED="websocket/consumer-resumed",e.PRODUCER_CLOSED="websocket/producer-closed",e.NEW_CONSUMER="websocket/new-consumer",e.CONNECTED_MEETING_STATE="websocket/connectedMeetingState",e.MOVE_TO_CONNECTED_MEETING="websocket/transferMeeting",e.GET_CHAT_MESSAGES="websocket/get-chat-messages",e.NEW_CHAT_MESSAGE="websocket/new-chat-message",e.PIN_CHAT_MESSAGE="websocket/pin-chat-message",e.UNPIN_CHAT_MESSAGE="websocket/unpin-chat-message",e.GET_POLLS="websocket/get-polls",e.UPDATE_POLL="websocket/update-poll",e.SELECTED_PEERS="websocket/selected-peers",e.GET_PAGE="websocket/get-page",e.ACTIVE_SPEAKER="websocket/active-speaker",e.NO_ACTIVE_SPEAKER="websocket/no-active-speaker",e.PRODUCER_SCORE="websocket/producer-score",e.CONSUMER_SCORE="websocket/consumer-score",e.ENABLE_PLUGIN="websocket/enable-plugin",e.DISABLE_PLUGIN="websocket/disable-plugin",e.PLUGIN_EVENT="websocket/plugin-event",e.PLUGIN_DATA="websocket/plugin-data",e.PLUGIN_INTERNAL_DATA="websocket/plugin-internal-data",e.KICKED="websocket/kicked",e.ICE_CONNECTED="ICE_CONNECTED",e.ICE_DISCONNECTED="ICE_DISCONNECTED",e.ICE_FAILED="ICE_FAILED",e.ICE_RECONNECTING="ICE_RECONNECTING",e.AUDIO_TRACK_ANALYSIS="AUDIO_TRACK_ANALYSIS",e.AUDIO_TRACK_CLOSED="AUDIO_TRACK_CLOSED",e.AUDIO_TRACK_CHANGED="AUDIO_TRACK_CHANGED",e.AUDIO_TRACK_CREATED="AUDIO_TRACK_CREATED",e.VIDEO_TRACK_ANALYSIS="VIDEO_TRACK_ANALYSIS",e.VIDEO_TRACK_ANALYSIS_ERROR="VIDEO_TRACK_ANALYSIS_ERROR",e.VIDEO_TRACK_CLOSED="VIDEO_TRACK_CLOSED",e.VIDEO_TRACK_CHANGED="VIDEO_TRACK_CHANGED",e.VIDEO_TRACK_CREATED="VIDEO_TRACK_CREATED",e.SCREENSHARE_AUDIO_TRACK_ANALYSIS="SCREENSHARE_AUDIO_TRACK_ANALYSIS",e.SCREENSHARE_AUDIO_TRACK_CLOSED="SCREENSHARE_AUDIO_TRACK_CLOSED",e.SCREENSHARE_AUDIO_TRACK_CREATED="SCREENSHARE_AUDIO_TRACK_CREATED",e.SCREENSHARE_VIDEO_TRACK_ANALYSIS="SCREENSHARE_VIDEO_TRACK_ANALYSIS",e.SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR="SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR",e.SCREENSHARE_VIDEO_TRACK_CLOSED="SCREENSHARE_VIDEO_TRACK_CLOSED",e.SCREENSHARE_VIDEO_TRACK_CREATED="SCREENSHARE_VIDEO_TRACK_CREATED",e.SCREENSHARE_TRACK_CHANGED="SCREENSHARE_TRACK_CHANGED",e.CANDIDATE_PEER_UPDATE="CANDIDATE_PEER_UPDATE",e.INBOUND_RTP_UPDATE="INBOUND_RTP_UPDATE",e.OUTBOUND_RTP_UPDATE="OUTBOUND_RTP_UPDATE",e.SEND_TRANSPORT_CLOSED="SEND_TRANSPORT_CLOSED",e.RECV_TRANSPORT_CLOSED="RECV_TRANSPORT_CLOSED",e.SEND_TRANSPORT_CREATED="SEND_TRANSPORT_CREATED",e.RECV_TRANSPORT_CREATED="RECV_TRANSPORT_CREATED",e.PRODUCER_TOGGLE="hive/producer-toggle",e.CONSUMER_TOGGLE="hive/consumer-toggle",e.SELECTED_PEERS_DIFF="hive/selected-peers-diff",e.REFRESH_GRID="hive/refresh-grid",e.RESET_PRODUCER_STATE="hive/reset-producer-state",e.HIVE_TRANSPORT_STATE_CHANGED="hive/transport-state-changed",e.HIVE_ROOM_REJOINING="hive/room-rejoining",e.HIVE_ROOM_REJOIN_FAILED="hive/room-rejoining-failed",e.HIVE_ROOM_REJOINED="hive/room-rejoined",e.HIVE_TRANPSORT_RECONNECTING="hive/transport-reconnecting",e.ROOM_STATE="sockethub/room-state",e.PEER_DISPLAY_NAME_CHANGED="hive/display-name-changed",e.ASSERT_SPOTLIGHTER="websocket/assert-spotlighter",e.GET_STAGE_REQUESTS="GET_STAGE_REQUESTS",e.UPDATE_STAGE_REQUESTS="UPDATE_STAGE_REQUESTS",e.PEER_REQUESTED_TO_JOIN_STAGE="websocket/request-to-join-stage-peer-added",e.PEER_WITHDRAWN_REQUEST_TO_JOIN_STAGE="websocket/request-to-join-stage-peer-withdrawn",e.PEER_REJECTED_TO_JOIN_STAGE="websocket/peer-rejected-to-join-stage",e.PEER_ADDED_TO_STAGE="websocket/peer-added-to-stage",e.PEER_REMOVED_FROM_STAGE="websocket/peer-removed-from-stage",e.PEER_STARTED_PRESENTING="websocket/peer-started-presenting",e.PEER_STOPPED_PRESENTING="websocket/peer-stopped-presenting",e.STAGE_REQUESTS_UPDATED="STAGE_REQUESTS_UPDATED",e.KICK_PEER="KICK_PEER",e.REQUEST_TO_JOIN_STAGE_ACCEPTED="websocket/request-to-join-stage-accepted",e.REQUEST_TO_JOIN_STAGE_REJECTED="websocket/request-to-join-stage-rejected",e.STARTED_PRESENTING="websocket/started-presenting",e.STOPPED_PRESENTING="websocket/stopped-presenting",e.REMOVED_FROM_STAGE="websocket/removed-from-stage",e.JOIN_MEDIA_ROOM="JOIN_MEDIA_ROOM",e.LEAVE_MEDIA_ROOM="LEAVE_MEDIA_ROOM",e.UPDATE_PEER_STAGE_STATUS="UPDATE_PEER_STAGE_STATUS",e.GET_WEBINAR_STAGE_STATUS="GET_WEBINAR_STAGE_STATUS",e.REQUEST_TO_JOIN_STAGE="REQUEST_TO_JOIN_STAGE",e.WITHDRAW_REQUEST_TO_JOIN_STAGE="WITHDRAW_REQUEST_TO_JOIN_STAGE",e.LEAVE_STAGE="LEAVE_STAGE",e.JOIN_STAGE="JOIN_STAGE",e.SET_WEBINAR_STAGE_STATUS="SET_WEBINAR_STAGE_STATUS",e.SET_STAGE_STATUS="SET_STAGE_STATUS",e.NEW_STAGE_REQUEST="NEW_STAGE_REQUEST",e.ACCEPT_JOIN_STAGE_REQUEST="ACCEPT_JOIN_STAGE_REQUEST",e.REMOVE_FROM_STAGE="REMOVE_FROM_STAGE",e.REJECT_REQUEST_TO_JOIN_STAGE="REJECT_REQUEST_TO_JOIN_STAGE",e.ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE="ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE",e.PIP_HANGUP="PIP_HANGUP",e.SOCKET_PEERS="SOCKET_PEERS",e.UPDATE_PERMISSIONS="UPDATE_PERMISSIONS",e))(XS||{});const ZS=class extends ir.EventEmitter{constructor(){super(),Xt(this,YS,void 0),Xt(this,QS,void 0),Kt(this,"asyncPromiseTimeout"),Zt(this,YS,new Map),Zt(this,QS,new Map),this.asyncPromiseTimeout=8e3}emitAsync(e,...t){return tr(this,null,(function*(){Qt(this,YS).set(e,[]);const r=Qt(this,QS).get(e).map((()=>new Promise((t=>{Qt(this,YS).get(e).push(t)}))));((e,t,r)=>Ht(Vt(e),"emit",t))(ZS.prototype,this).call(this,e,...t),yield Promise.race([Promise.all(r),new Promise(((t,r)=>setTimeout((()=>r(new Error(`emitAsync failed to resolve for event ${e}.`))),this.asyncPromiseTimeout)))]),Qt(this,YS).delete(e)}))}onAsync(e,t){const r=Qt(this,YS),i=(...i)=>tr(this,null,(function*(){var n;try{yield t(...i)}catch(e){BS.error("[onAsync]",{error:e})}const s=null==(n=r.get(e))?void 0:n.shift();null==s||s()}));return Qt(this,QS).get(e)||Qt(this,QS).set(e,[]),Qt(this,QS).get(e).push(i),super.on(e,i)}reset(){Zt(this,YS,new Map),Zt(this,QS,new Map),super.removeAllListeners()}};let eE=ZS;YS=new WeakMap,QS=new WeakMap;const tE=new eE;var rE=(e=>(e.allowed="ALLOWED",e.notAllowed="NOT_ALLOWED",e.canRequest="CAN_REQUEST",e))(rE||{});const iE=CS({view_type:gi.GroupCall,accept_waiting_requests:!1,request_produce:!1,can_allow_participant_audio:!0,can_allow_participant_screensharing:!1,can_allow_participant_video:!0,request_kick_participant:!1,kick_participant:!0,pin_participant:!0,can_record:!1,waiting_room_type:"SKIP",plugins:{can_close:!0,can_start:!0,can_edit_acl:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},produce:{video:{allow:!0,quality:MS.video.quality,frame_rate:MS.video.frameRate},audio:!0,screenshare:{allow:!0,quality:MS.screenshare.quality,frame_rate:MS.screenshare.frameRate}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},reactions:!1,hidden_participant:!1,show_participant_list:!0,can_change_participant_role:!0,can_change_theme:!1,can_present:!1,accept_present_requests:!1,can_edit_display_name:!1,max_screenshare_count:1,is_recorder:!1,can_spotlight:!1});var nE,sE,oE;const aE=class extends HS{constructor(e,t,r=!1){if(super(),Xt(this,nE,void 0),Xt(this,sE,void 0),Xt(this,oE,void 0),!e)throw BS.error("DytePermissionsPresetV1::load_preset_permissions_failed"),new qS("Could not load preset permissions.");Zt(this,sE,t),Zt(this,nE,e),r&&this.setupEvents()}setupEvents(){tE.onAsync(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){Zt(this,oE,e)}))))}static fromResponse(e,t){return new aE(e,t,!0)}static default(e){return new aE(iE,e)}get mediaRoomType(){return Qt(this,sE)?"HIVE":"ROOM_NODE"}get viewType(){return Qt(this,nE).viewType}get stageEnabled(){return this.viewType===gi.Webinar||this.viewType===gi.Livestream}get stageAccess(){return Qt(this,nE).requestProduce?"CAN_REQUEST":Qt(this,nE).produce.video.allow||Qt(this,nE).produce.audio||Qt(this,nE).produce.screenshare.allow?"ALLOWED":"NOT_ALLOWED"}get acceptWaitingRequests(){return Qt(this,nE).acceptWaitingRequests}get requestProduce(){return Qt(this,nE).requestProduce}get requestProduceAudio(){return this.requestProduce}get requestProduceScreenshare(){return this.requestProduce}get canAllowParticipantAudio(){return Qt(this,nE).canAllowParticipantAudio}get canAllowParticipantScreensharing(){return Qt(this,nE).canAllowParticipantScreensharing}get canAllowParticipantVideo(){return Qt(this,nE).canAllowParticipantVideo}get canDisableParticipantAudio(){return this.canAllowParticipantAudio}get canDisableParticipantVideo(){return this.canAllowParticipantVideo}get kickParticipant(){return Qt(this,nE).kickParticipant}get pinParticipant(){return Qt(this,nE).pinParticipant}get canRecord(){return Qt(this,nE).canRecord}get waitingRoomType(){return Qt(this,nE).waitingRoomType}get waitingRoomBehaviour(){return"SKIP"===Qt(this,nE).waitingRoomType?"SKIP":"SKIP_ON_PRIVILEGED_USER_ENTRY"===Qt(this,nE).waitingRoomType?"ON_PRIVILEGED_USER_ENTRY":"ON_ACCEPT"===Qt(this,nE).waitingRoomType?"SKIP_ON_ACCEPT":"SKIP"}get plugins(){return Qt(this,nE).plugins}get polls(){return zt(qt({},Qt(this,nE).polls),{canViewResults:Qt(this,nE).polls.canView})}get produceVideo(){return zt(qt({},Qt(this,nE).produce.video),{allow:this.canProduceVideo})}get canProduceVideo(){const e=this.requestProduce?"CAN_REQUEST":Qt(this,nE).produce.video.allow?"ALLOWED":"NOT_ALLOWED";return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Qt(this,oE)&&"ON_STAGE"!==Qt(this,oE)||"CAN_REQUEST"!==e?!this.stageEnabled||"OFF_STAGE"!==Qt(this,oE)&&"REQUESTED_TO_JOIN_STAGE"!==Qt(this,oE)||"ALLOWED"!==e?e:"NOT_ALLOWED":"ALLOWED"}get produceScreenshare(){return zt(qt({},Qt(this,nE).produce.screenshare),{allow:this.canProduceScreenshare})}get canProduceScreenshare(){const e=this.requestProduce?"CAN_REQUEST":Qt(this,nE).produce.screenshare?"ALLOWED":"NOT_ALLOWED";return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Qt(this,oE)&&"ON_STAGE"!==Qt(this,oE)||"CAN_REQUEST"!==e?!this.stageEnabled||"OFF_STAGE"!==Qt(this,oE)&&"REQUESTED_TO_JOIN_STAGE"!==Qt(this,oE)||"ALLOWED"!==e?e:"NOT_ALLOWED":"ALLOWED"}get produceAudio(){return this.canProduceAudio}get canProduceAudio(){const e=this.requestProduce?"CAN_REQUEST":Qt(this,nE).produce.audio?"ALLOWED":"NOT_ALLOWED";return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Qt(this,oE)&&"ON_STAGE"!==Qt(this,oE)||"CAN_REQUEST"!==e?!this.stageEnabled||"OFF_STAGE"!==Qt(this,oE)&&"REQUESTED_TO_JOIN_STAGE"!==Qt(this,oE)||"ALLOWED"!==e?e:"NOT_ALLOWED":"ALLOWED"}get chatPublic(){return Qt(this,nE).chat.public}get transcriptionEnabled(){return!1}get chatPrivate(){return Qt(this,nE).chat.private}get chatChannel(){return{canCreate:"NONE",canDelete:"NONE",canUpdate:"NONE",canReadAll:!1}}get chatMessage(){return{canDelete:"NONE",canEdit:"NONE",deleteCutoffTimeSeconds:0,editCutoffTimeSeconds:0}}get connectedMeetings(){return{canAlterConnectedMeetings:!1,canSwitchConnectedMeetings:!1,canSwitchToParentMeeting:!1}}get reactions(){return Qt(this,nE).reactions}get hiddenParticipant(){return Qt(this,nE).hiddenParticipant}get showParticipantList(){return Qt(this,nE).showParticipantList}get canChangeParticipantRole(){return Qt(this,nE).canChangeParticipantRole}get canChangeTheme(){return Qt(this,nE).canChangeTheme}get canPresent(){return Qt(this,nE).canPresent}get acceptPresentRequests(){return Qt(this,nE).acceptPresentRequests}get acceptStageRequests(){return Qt(this,nE).acceptPresentRequests}get canEditDisplayName(){return Qt(this,nE).canEditDisplayName}get maxScreenShareCount(){return Qt(this,nE).maxScreenshareCount}get isRecorder(){return Qt(this,nE).isRecorder}get canLivestream(){return!1}get canSpotlight(){return Qt(this,nE).canSpotlight}get isV2(){return!1}};let cE=aE;var dE,lE;nE=new WeakMap,sE=new WeakMap,oE=new WeakMap,function(e){e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER"}(dE||(dE={})),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"}(lE||(lE={})),new class extends me{constructor(){super("media.Codec",[])}},new class extends me{constructor(){super("media.Fingerprint",[{no:1,name:"algorithm",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:9}])}};const uE=new class extends me{constructor(){super("media.SessionDescription",[{no:1,name:"target",kind:"enum",T:()=>["media.Target",dE]},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"sdp",kind:"scalar",T:9}])}},pE=new class extends me{constructor(){super("media.CreateTransportRequest",[{no:1,name:"consuming",kind:"scalar",T:8},{no:2,name:"force_tcp",kind:"scalar",opt:!0,T:8},{no:3,name:"description",kind:"message",T:()=>uE}])}},hE=new class extends me{constructor(){super("media.CreateTransportResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uE},{no:3,name:"transcription_enabled",kind:"scalar",opt:!0,T:8}])}},mE=new class extends me{constructor(){super("media.RenegotiateRequest",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uE}])}};new class extends me{constructor(){super("media.RenegotiateResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uE}])}};const fE=new class extends me{constructor(){super("media.NestedScore",[{no:1,name:"encoding_idx",kind:"scalar",T:5},{no:2,name:"rid",kind:"scalar",T:9},{no:3,name:"score",kind:"scalar",T:5},{no:4,name:"ssrc",kind:"scalar",T:3,L:0}])}},gE=new class extends me{constructor(){super("media.ProducerTrack",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9},{no:3,name:"stream_id",kind:"scalar",T:9}])}};new class extends me{constructor(){super("media.ProducerEntry",[{no:1,name:"producing_transport_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.ConsumerEntry",[{no:1,name:"consuming_transport_id",kind:"scalar",T:9},{no:2,name:"consumer_id",kind:"scalar",T:9}])}};const vE=new class extends me{constructor(){super("media.ProducerState",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"kind",kind:"enum",T:()=>["media.ProducerKind",lE]},{no:3,name:"pause",kind:"scalar",T:8},{no:4,name:"screen_share",kind:"scalar",T:8},{no:5,name:"app_data",kind:"scalar",opt:!0,T:9}])}},yE=new class extends me{constructor(){super("media.ConsumerState",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vE},{no:3,name:"producer_track",kind:"message",T:()=>gE}])}},_E=new class extends me{constructor(){super("media.ProducerIdToConsumerMap",[{no:1,name:"map",kind:"map",K:9,V:{kind:"message",T:()=>yE}}])}},SE=new class extends me{constructor(){super("media.edge.GeoLocation",[{no:1,name:"latitude",kind:"scalar",T:2},{no:2,name:"longitude",kind:"scalar",T:2},{no:3,name:"region",kind:"scalar",opt:!0,T:9}])}},EE=new class extends me{constructor(){super("media.edge.PeerJoinRequest",[{no:1,name:"display_name",kind:"scalar",opt:!0,T:9},{no:2,name:"prejoined",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:5,name:"preset",kind:"scalar",opt:!0,T:12},{no:6,name:"user_id",kind:"scalar",opt:!0,T:9},{no:7,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:8,name:"location",kind:"message",T:()=>SE}])}},TE=new class extends me{constructor(){super("media.edge.PeerJoinCompleteRequest",[])}},bE=new class extends me{constructor(){super("media.edge.PeerLeaveRequest",[{no:1,name:"close_room",kind:"scalar",T:8}])}};new class extends me{constructor(){super("media.edge.ConsumeMultipleProducerRequest",[{no:1,name:"producer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8}])}};const wE=new class extends me{constructor(){super("media.edge.ConsumePeerRequest",[{no:1,name:"producing_peer_id",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8},{no:3,name:"producer_id",kind:"scalar",opt:!0,T:9}])}},kE=new class extends me{constructor(){super("media.edge.ProducerCreateRequest",[{no:1,name:"kind",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"description",kind:"message",T:()=>uE},{no:5,name:"msid",kind:"scalar",T:9},{no:6,name:"app_data",kind:"scalar",opt:!0,T:9}])}};new class extends me{constructor(){super("media.edge.SelectedPeersRequest",[])}};const RE=new class extends me{constructor(){super("media.edge.GlobalPeerPinningRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},CE=new class extends me{constructor(){super("media.edge.ProducerToggleRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}},AE=new class extends me{constructor(){super("media.edge.ConsumerToggleRequest",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}},IE=new class extends me{constructor(){super("media.edge.ProducerCloseRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uE}])}},PE=new class extends me{constructor(){super("media.edge.ConsumerCloseRequest",[{no:1,name:"consumer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"description",kind:"message",T:()=>uE}])}},DE=new class extends me{constructor(){super("media.edge.KickPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},ME=new class extends me{constructor(){super("media.edge.KickAllPeersRequest",[])}},OE=new class extends me{constructor(){super("media.edge.PeerDisplayNameEditRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}},NE=new class extends me{constructor(){super("media.edge.HostMediaControlForPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"audio",kind:"scalar",T:8},{no:3,name:"video",kind:"scalar",T:8},{no:4,name:"scree_share",kind:"scalar",T:8}])}},xE=new class extends me{constructor(){super("media.edge.HostMediaControlForAllPeerRequest",[{no:1,name:"audio",kind:"scalar",T:8},{no:2,name:"video",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8}])}},LE=new class extends me{constructor(){super("media.edge.GetRoomStateResponse",[{no:1,name:"display_title",kind:"scalar",T:9},{no:2,name:"locked_mode",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"room_name",kind:"scalar",T:9},{no:5,name:"current_peer_id",kind:"scalar",T:9},{no:6,name:"is_recording",kind:"scalar",opt:!0,T:8},{no:7,name:"recorder_participant_id",kind:"scalar",opt:!0,T:9},{no:8,name:"pinned_peer_ids",kind:"scalar",repeat:2,T:9}])}},jE=new class extends me{constructor(){super("media.edge.ErrorResponse",[{no:1,name:"error_message",kind:"scalar",T:9},{no:2,name:"event_id",kind:"scalar",T:5}])}};new class extends me{constructor(){super("media.edge.EmptyResponse",[])}};const UE=new class extends me{constructor(){super("media.edge.RoomParticipants",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"producer_states",kind:"message",repeat:1,T:()=>vE},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"user_id",kind:"scalar",opt:!0,T:9}])}},FE=new class extends me{constructor(){super("media.edge.SelectedPeersResponse",[{no:1,name:"audio_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"compulsory_peers",kind:"scalar",repeat:2,T:9}])}},VE=new class extends me{constructor(){super("media.edge.SelectedPeersDiffEntry",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"priority",kind:"scalar",T:5}])}},BE=new class extends me{constructor(){super("media.edge.SelectedPeersDiffResponse",[{no:1,name:"entries",kind:"message",repeat:1,T:()=>VE}])}};new class extends me{constructor(){super("media.edge.PeerJoinResponse",[])}};const WE=new class extends me{constructor(){super("media.edge.PeerJoinCompleteResponse",[{no:1,name:"room_state",kind:"message",T:()=>LE},{no:2,name:"participants",kind:"message",repeat:1,T:()=>UE},{no:3,name:"selected_peers",kind:"message",T:()=>FE},{no:4,name:"max_preferred_streams",kind:"scalar",T:5}])}},HE=new class extends me{constructor(){super("media.edge.PeerLeaveResponse",[{no:1,name:"closed",kind:"scalar",T:8}])}};new class extends me{constructor(){super("media.edge.ConsumeMultipleProducerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>_E}])}};const GE=new class extends me{constructor(){super("media.edge.ConsumePeerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>_E}])}},$E=new class extends me{constructor(){super("media.edge.ProducerCreateResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"producer_id",kind:"scalar",T:9},{no:4,name:"description",kind:"message",T:()=>uE}])}};new class extends me{constructor(){super("media.edge.ProducerScoreResponse",[{no:1,name:"responseid",kind:"scalar",T:9},{no:2,name:"score",kind:"message",T:()=>fE}])}},new class extends me{constructor(){super("media.edge.ActiveSpeakerResponse",[{no:1,name:"responsepeer_id",kind:"scalar",T:9},{no:2,name:"volume",kind:"scalar",T:5}])}},new class extends me{constructor(){super("media.edge.NoActiveSpeakerResponse",[])}},new class extends me{constructor(){super("media.edge.ProducerToggleResponse",[])}},new class extends me{constructor(){super("media.edge.ConsumerToggleResponse",[])}};const qE=new class extends me{constructor(){super("media.edge.ProducerClosingResponse",[{no:1,name:"description",kind:"message",T:()=>uE}])}};new class extends me{constructor(){super("media.edge.ConsumerClosingResponse",[])}},new class extends me{constructor(){super("media.edge.GlobalPeerPinningResponse",[])}};const zE=new class extends me{constructor(){super("media.edge.KickPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},JE=new class extends me{constructor(){super("media.edge.KickAllPeersResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},KE=new class extends me{constructor(){super("media.edge.HostMediaControlForPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},YE=new class extends me{constructor(){super("media.edge.HostMediaControlForAllPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},QE=new class extends me{constructor(){super("media.edge.PeerDisplayNameEditResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},XE=new class extends me{constructor(){super("media.edge.PeerJoinBroadcastResponse",[{no:1,name:"participant",kind:"message",T:()=>UE}])}};new class extends me{constructor(){super("media.edge.PeerProducingTransportCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"transport_details",kind:"message",T:()=>hE}])}};const ZE=new class extends me{constructor(){super("media.edge.PeerProducerCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vE}])}},eT=new class extends me{constructor(){super("media.edge.PeerProducerToggleBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vE}])}},tT=new class extends me{constructor(){super("media.edge.PeerProducerCloseBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vE}])}},rT=new class extends me{constructor(){super("media.edge.PeerLeaveBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},iT=new class extends me{constructor(){super("media.edge.GlobalPeerPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}};new class extends me{constructor(){super("media.edge.GlobalPeerUnPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.edge.RecordingStartedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.edge.RecordingStoppedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}};const nT=new class extends me{constructor(){super("media.edge.PeerDisplayNameEditBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}};new class extends me{constructor(){super("media.edge.PeerPingRequestBroadcastResponse",[{no:1,name:"password",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.edge.MediaRoomTerminationBroadcastResponse",[{no:1,name:"reason",kind:"scalar",T:9}])}};const sT=new class extends me{constructor(){super("socket.ai.MeetingTranscript",[{no:1,name:"meeting_id",kind:"scalar",T:9},{no:2,name:"transcript",kind:"scalar",T:9}])}};new class extends me{constructor(){super("socket.api.BaseSocketHubMessage",[{no:1,name:"event",kind:"scalar",T:5},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9},{no:4,name:"room_id",kind:"scalar",T:9},{no:5,name:"user_id",kind:"scalar",T:9},{no:6,name:"payload",kind:"scalar",T:12},{no:7,name:"error",kind:"scalar",opt:!0,T:8},{no:8,name:"sid",kind:"scalar",opt:!0,T:9}])}};const oT=new class extends me{constructor(){super("socket.api.ErrorMessage",[{no:1,name:"code",kind:"scalar",opt:!0,T:5},{no:2,name:"message",kind:"scalar",T:9}])}},aT=new class extends me{constructor(){super("socket.preset.PollsPermissionUpdate",[{no:1,name:"can_create",kind:"scalar",opt:!0,T:8},{no:2,name:"can_vote",kind:"scalar",opt:!0,T:8},{no:3,name:"can_view",kind:"scalar",opt:!0,T:8}])}},cT=new class extends me{constructor(){super("socket.preset.PluginsPermissionsUpdate",[{no:1,name:"can_close",kind:"scalar",opt:!0,T:8},{no:2,name:"can_start",kind:"scalar",opt:!0,T:8}])}},dT=new class extends me{constructor(){super("socket.preset.PublicChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"text",kind:"scalar",opt:!0,T:8},{no:3,name:"files",kind:"scalar",opt:!0,T:8}])}},lT=new class extends me{constructor(){super("socket.preset.PrivateChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"can_receive",kind:"scalar",opt:!0,T:8},{no:3,name:"text",kind:"scalar",opt:!0,T:8},{no:4,name:"files",kind:"scalar",opt:!0,T:8}])}},uT=new class extends me{constructor(){super("socket.preset.ChatPermissionUpdate",[{no:1,name:"public",kind:"message",T:()=>dT},{no:2,name:"private",kind:"message",T:()=>lT}])}},pT=new class extends me{constructor(){super("socket.preset.PresetUpdates",[{no:1,name:"polls",kind:"message",T:()=>aT},{no:2,name:"plugins",kind:"message",T:()=>cT},{no:3,name:"chat",kind:"message",T:()=>uT}])}},hT=new class extends me{constructor(){super("socket.preset.ReadPeersPresetRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},mT=new class extends me{constructor(){super("socket.preset.PeerPreset",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"preset",kind:"scalar",T:12}])}},fT=new class extends me{constructor(){super("socket.preset.ReadPeersPresetResponse",[{no:1,name:"peer_presets",kind:"message",repeat:1,T:()=>mT}])}},gT=new class extends me{constructor(){super("socket.preset.UpdatePeerPreset",[{no:1,name:"user_ids",kind:"scalar",T:9},{no:2,name:"patch",kind:"message",T:()=>pT}])}},vT=new class extends me{constructor(){super("socket.preset.UpdatePeersPresetRequest",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>gT}])}},yT=new class extends me{constructor(){super("socket.preset.UpdatePeersPresetResponse",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>gT}])}},_T=new class extends me{constructor(){super("socket.chat.ChatMessage",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"user_id",kind:"scalar",T:9},{no:4,name:"display_name",kind:"scalar",T:9},{no:5,name:"pinned",kind:"scalar",T:8},{no:6,name:"is_edited",kind:"scalar",T:8},{no:7,name:"payload_type",kind:"scalar",T:5},{no:8,name:"payload",kind:"scalar",T:9},{no:10,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:11,name:"created_at",kind:"scalar",T:4,L:2},{no:12,name:"created_at_ms",kind:"scalar",opt:!0,T:4,L:2},{no:13,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:14,name:"channel_index",kind:"scalar",opt:!0,T:9}])}},ST=new class extends me{constructor(){super("socket.chat.GetPaginatedChatMessageRoomRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},ET=new class extends me{constructor(){super("socket.chat.GetPaginatedChatMessageRoomResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>_T},{no:2,name:"next",kind:"scalar",T:8}])}},TT=new class extends me{constructor(){super("socket.chat.GetChatMessagesResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>_T}])}},bT=new class extends me{constructor(){super("socket.chat.SendChatMessageToRoomRequest",[{no:1,name:"payload_type",kind:"scalar",T:5},{no:2,name:"payload",kind:"scalar",T:9}])}},wT=new class extends me{constructor(){super("socket.chat.SendChatMessageToRoomResponse",[{no:1,name:"message",kind:"message",T:()=>_T}])}},kT=new class extends me{constructor(){super("socket.chat.SendChatMessageToPeersRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}},RT=new class extends me{constructor(){super("socket.chat.SendChatMessageToPeersResponse",[{no:1,name:"message",kind:"message",T:()=>_T}])}},CT=new class extends me{constructor(){super("socket.chat.SendChatMessageToChannelRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}};new class extends me{constructor(){super("socket.chat.SendChatMessageToChannelResponse",[{no:1,name:"message",kind:"message",T:()=>_T}])}};const AT=new class extends me{constructor(){super("socket.chat.EditChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",opt:!0,T:5},{no:3,name:"payload",kind:"scalar",opt:!0,T:9},{no:4,name:"pinned",kind:"scalar",opt:!0,T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},IT=new class extends me{constructor(){super("socket.chat.PinChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},PT=new class extends me{constructor(){super("socket.chat.PinChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},DT=new class extends me{constructor(){super("socket.chat.EditChatMessageResponse",[{no:1,name:"message",kind:"message",T:()=>_T}])}},MT=new class extends me{constructor(){super("socket.chat.DeleteChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},OT=new class extends me{constructor(){super("socket.chat.DeleteChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},NT=new class extends me{constructor(){super("socket.chat.SearchChatMessagesRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:6,name:"search_term",kind:"scalar",T:9}])}},xT=new class extends me{constructor(){super("socket.chat.MarkChannelIndexAsReadRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"channel_index",kind:"scalar",T:9}])}},LT=new class extends me{constructor(){super("socket.chat.MarkChannelIndexAsReadResponse",[{no:1,name:"channel_index",kind:"scalar",T:9}])}},jT=new class extends me{constructor(){super("socket.chat.CreateChatChannelRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8}])}},UT=new class extends me{constructor(){super("socket.chat.UpdateChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:4,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:5,name:"visibility",kind:"scalar",opt:!0,T:9},{no:6,name:"is_direct_message",kind:"scalar",opt:!0,T:8}])}};new class extends me{constructor(){super("socket.chat.CreateChatChannelResponse",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}};const FT=new class extends me{constructor(){super("socket.chat.GetChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}},VT=new class extends me{constructor(){super("socket.chat.LatestMessageAndUnreadCount",[{no:1,name:"message",kind:"message",T:()=>_T},{no:2,name:"unread_count",kind:"scalar",T:4,L:2}])}},BT=new class extends me{constructor(){super("socket.chat.ChatChannel",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8},{no:6,name:"latest_message_and_unread_count",kind:"message",T:()=>VT},{no:7,name:"target_user_ids",kind:"scalar",repeat:2,T:9}])}},WT=new class extends me{constructor(){super("socket.chat.GetChatChannelResponse",[{no:1,name:"chat_channels",kind:"message",repeat:1,T:()=>BT}])}},HT=new class extends me{constructor(){super("socket.chat.ChannelMember",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}},GT=new class extends me{constructor(){super("socket.chat.GetChatChannelMembersResponse",[{no:1,name:"channel_members",kind:"message",repeat:1,T:()=>HT}])}};var $T,qT,zT,JT;!function(e){e[e.BROWSER=0]="BROWSER",e[e.TRACK=1]="TRACK",e[e.COMPOSITE=2]="COMPOSITE"}($T||($T={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ON_STAGE=1]="ON_STAGE",e[e.APPROVED_STAGE=2]="APPROVED_STAGE",e[e.REQUESTED_STAGE=3]="REQUESTED_STAGE",e[e.OFF_STAGE=4]="OFF_STAGE"}(qT||(qT={})),function(e){e[e.NONE=0]="NONE",e[e.RECORDER=1]="RECORDER",e[e.LIVESTREAMER=2]="LIVESTREAMER"}(zT||(zT={})),function(e){e[e.HIVE=0]="HIVE",e[e.CHAT=1]="CHAT",e[e.PING=2]="PING"}(JT||(JT={}));const KT=new class extends me{constructor(){super("socket.room.PeerFlags",[{no:1,name:"preset_name",kind:"scalar",T:9},{no:2,name:"recorder_type",kind:"scalar",T:9},{no:3,name:"hidden_participant",kind:"scalar",T:8}])}},YT=new class extends me{constructor(){super("socket.room.Peer",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",qT,"STAGE_TYPE_"]},{no:5,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:6,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:7,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:8,name:"waitlisted",kind:"scalar",T:8},{no:9,name:"flags",kind:"message",T:()=>KT}])}},QT=new class extends me{constructor(){super("socket.room.PeerInfoResponse",[{no:1,name:"peer",kind:"message",T:()=>YT}])}},XT=new class extends me{constructor(){super("socket.room.PeerStatusUpdate",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",qT,"STAGE_TYPE_"]}])}},ZT=new class extends me{constructor(){super("socket.room.RoomPeersInfoRequest",[{no:1,name:"seach_query",kind:"scalar",T:9},{no:2,name:"limit",kind:"scalar",T:5},{no:3,name:"offset",kind:"scalar",T:5}])}},eb=new class extends me{constructor(){super("socket.room.RoomPeersInfoResponse",[{no:1,name:"peers",kind:"message",repeat:1,T:()=>YT}])}},tb=new class extends me{constructor(){super("socket.room.RoomPeerCountResponse",[{no:1,name:"count",kind:"scalar",T:4,L:2}])}},rb=new class extends me{constructor(){super("socket.room.Room",[{no:1,name:"room_id",kind:"scalar",T:9},{no:2,name:"title",kind:"scalar",T:9},{no:4,name:"created_at",kind:"scalar",T:4,L:2},{no:5,name:"active_recordings",kind:"message",repeat:1,T:()=>ib}])}},ib=new class extends me{constructor(){super("socket.room.ActiveRecording",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",$T]},{no:3,name:"recording_status",kind:"scalar",T:9}])}},nb=new class extends me{constructor(){super("socket.room.RoomInfoResponse",[{no:1,name:"room",kind:"message",T:()=>rb}])}},sb=new class extends me{constructor(){super("socket.room.GetPeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9}])}};new class extends me{constructor(){super("socket.room.UpdatePeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9}])}};const ob=new class extends me{constructor(){super("socket.room.JoinRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>YT},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:5,name:"use_hive",kind:"scalar",opt:!0,T:8},{no:6,name:"preset",kind:"scalar",opt:!0,T:12},{no:7,name:"capabilities",kind:"enum",repeat:1,T:()=>["socket.room.Capabilities",JT,"CAPABILITIES_"]},{no:8,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}},ab=new class extends me{constructor(){super("socket.room.LeaveRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>YT},{no:2,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}};new class extends me{constructor(){super("socket.room.UpdateRoomInfoRequest",[{no:1,name:"room",kind:"message",T:()=>rb}])}},new class extends me{constructor(){super("socket.room.GetConnectedRoomsDumpRequest",[])}};const cb=new class extends me{constructor(){super("socket.room.ServiceError",[{no:1,name:"message",kind:"scalar",opt:!0,T:9},{no:2,name:"code",kind:"scalar",opt:!0,T:9}])}},db=new class extends me{constructor(){super("socket.room.ConnectedMeetingPeer",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:4,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:5,name:"display_picture_url",kind:"scalar",opt:!0,T:9}])}},lb=new class extends me{constructor(){super("socket.room.ConnectedMeetingDump",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>db}])}},ub=new class extends me{constructor(){super("socket.room.GetConnectedRoomsDumpResponse",[{no:1,name:"parent_meeting",kind:"message",T:()=>lb},{no:2,name:"meetings",kind:"message",repeat:1,T:()=>lb}])}},pb=new class extends me{constructor(){super("socket.room.CreateRoomRequestPayload",[{no:1,name:"title",kind:"scalar",opt:!0,T:9}])}},hb=new class extends me{constructor(){super("socket.room.CreateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>pb}])}},mb=new class extends me{constructor(){super("socket.room.CreateRoomResponsePayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>cb}])}},fb=new class extends me{constructor(){super("socket.room.CreateConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>mb}])}},gb=new class extends me{constructor(){super("socket.room.UpdateRoomRequestPayload",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9}])}};new class extends me{constructor(){super("socket.room.UpdateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>gb}])}};const vb=new class extends me{constructor(){super("socket.room.DisableRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9}])}},yb=new class extends me{constructor(){super("socket.room.DisableConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>vb}])}},_b=new class extends me{constructor(){super("socket.room.DisableConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>Sb}])}},Sb=new class extends me{constructor(){super("socket.room.DisableConnectedRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"status",kind:"scalar",opt:!0,T:9},{no:3,name:"title",kind:"scalar",opt:!0,T:9},{no:4,name:"error",kind:"message",T:()=>cb}])}},Eb=new class extends me{constructor(){super("socket.room.MovePeerPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9}])}},Tb=new class extends me{constructor(){super("socket.room.MovePeersBetweenRoomsRequest",[{no:1,name:"source_meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"destination_meeting_id",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>Eb}])}},bb=new class extends me{constructor(){super("socket.room.MovedPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>cb}])}};new class extends me{constructor(){super("socket.room.MovePeersBetweenRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>bb}])}};const wb=new class extends me{constructor(){super("socket.room.TransferPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"auth_token",kind:"scalar",opt:!0,T:9}])}},kb=new class extends me{constructor(){super("socket.room.GetAllAddedParticipantsResponse",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>Rb}])}},Rb=new class extends me{constructor(){super("socket.room.AddedParticipant",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}},Cb=new class extends me{constructor(){super("socket.room.RemoveParticipantsRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Ab=new class extends me{constructor(){super("socket.room.BroadcastMessage",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"timestamp",kind:"scalar",T:4,L:2},{no:4,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Ib=new class extends me{constructor(){super("socket.room.AcceptWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},Pb=new class extends me{constructor(){super("socket.room.DenyWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},Db=new class extends me{constructor(){super("socket.room.WaitingRoomRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9}])}},Mb=new class extends me{constructor(){super("socket.room.GetWaitingRoomRequests",[{no:1,name:"requests",kind:"message",repeat:1,T:()=>Db}])}},Ob=new class extends me{constructor(){super("socket.room.GetRoomStageStateResponse",[{no:1,name:"on_stage_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"approved_stage_peers",kind:"scalar",repeat:2,T:9},{no:3,name:"requested_stage_peers",kind:"scalar",repeat:2,T:9}])}},Nb=new class extends me{constructor(){super("socket.plugin.AddPluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}},xb=new class extends me{constructor(){super("socket.plugin.RemovePluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}},Lb=new class extends me{constructor(){super("socket.plugin.EnablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}},jb=new class extends me{constructor(){super("socket.plugin.DisablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}},Ub=new class extends me{constructor(){super("socket.plugin.EnablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Fb=new class extends me{constructor(){super("socket.plugin.DisablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Vb=new class extends me{constructor(){super("socket.plugin.PluginEventToRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}},Bb=new class extends me{constructor(){super("socket.plugin.PluginEventToPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"plugin_data",kind:"scalar",T:12}])}},Wb=new class extends me{constructor(){super("socket.plugin.StoreKeys",[{no:1,name:"store_key",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",opt:!0,T:12}])}},Hb=new class extends me{constructor(){super("socket.plugin.PluginStoreInsertKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"insert_keys",kind:"message",repeat:1,T:()=>Wb}])}},Gb=new class extends me{constructor(){super("socket.plugin.PluginStoreGetKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"get_keys",kind:"message",repeat:1,T:()=>Wb}])}},$b=new class extends me{constructor(){super("socket.plugin.PluginStoreDeleteKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"delete_keys",kind:"message",repeat:1,T:()=>Wb}])}},qb=new class extends me{constructor(){super("socket.plugin.PluginStoreDeleteRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9}])}},zb=new class extends me{constructor(){super("socket.plugin.EnablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"enabled_by",kind:"scalar",T:9}])}},Jb=new class extends me{constructor(){super("socket.plugin.EnablePluginsResponse",[{no:1,name:"plugins",kind:"message",repeat:1,T:()=>zb}])}},Kb=new class extends me{constructor(){super("socket.plugin.DisablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"disabled_by",kind:"scalar",T:9}])}},Yb=new class extends me{constructor(){super("socket.plugin.PluginStoreItem",[{no:1,name:"timestamp",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"store_key",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}])}},Qb=new class extends me{constructor(){super("socket.plugin.PluginStoreResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"store_items",kind:"message",repeat:1,T:()=>Yb}])}},Xb=new class extends me{constructor(){super("socket.plugin.PluginEventResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}},Zb=new class extends me{constructor(){super("socket.livestreaming.LiveStreamingEvent",[{no:1,name:"livestream_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",T:9},{no:5,name:"playback_url",kind:"scalar",T:9},{no:6,name:"org_id",kind:"scalar",T:9},{no:7,name:"room_name",kind:"scalar",T:9},{no:8,name:"room_uuid",kind:"scalar",T:9},{no:9,name:"status",kind:"scalar",T:9}])}},ew=new class extends me{constructor(){super("socket.livestreaming.GetStagePeersResponse",[{no:1,name:"stage_peers",kind:"scalar",repeat:2,T:9}])}},tw=new class extends me{constructor(){super("socket.livestreaming.StageRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9}])}},rw=new class extends me{constructor(){super("socket.livestreaming.GetStageRequestsResponse",[{no:1,name:"stage_requests",kind:"message",repeat:1,T:()=>tw}])}},iw=new class extends me{constructor(){super("socket.livestreaming.GrantStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},nw=new class extends me{constructor(){super("socket.livestreaming.DenyStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},sw=new class extends me{constructor(){super("socket.livestreaming.LeaveStageRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},ow=new class extends me{constructor(){super("socket.polls.Poll",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"created_by",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"question",kind:"scalar",T:9},{no:5,name:"options",kind:"message",repeat:1,T:()=>aw},{no:6,name:"hide_votes",kind:"scalar",T:8},{no:7,name:"anonymous",kind:"scalar",T:8},{no:8,name:"votes",kind:"scalar",repeat:2,T:9}])}},aw=new class extends me{constructor(){super("socket.polls.PollOption",[{no:1,name:"text",kind:"scalar",T:9},{no:2,name:"count",kind:"scalar",opt:!0,T:4,L:2},{no:3,name:"votes",kind:"message",repeat:1,T:()=>cw}])}},cw=new class extends me{constructor(){super("socket.polls.PollVote",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}])}},dw=new class extends me{constructor(){super("socket.polls.NewPollRequest",[{no:1,name:"question",kind:"scalar",T:9},{no:2,name:"options",kind:"scalar",repeat:2,T:9},{no:3,name:"anonymous",kind:"scalar",T:8},{no:4,name:"hide_votes",kind:"scalar",T:8},{no:5,name:"created_by",kind:"scalar",opt:!0,T:9},{no:6,name:"created_by_user_id",kind:"scalar",opt:!0,T:9}])}},lw=new class extends me{constructor(){super("socket.polls.VotePollRequest",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"index",kind:"scalar",T:4,L:2}])}},uw=new class extends me{constructor(){super("socket.polls.UpdatePollResponse",[{no:1,name:"poll",kind:"message",T:()=>ow}])}},pw=new class extends me{constructor(){super("socket.polls.GetPollsResponse",[{no:1,name:"polls",kind:"message",repeat:1,T:()=>ow}])}},hw=new class extends me{constructor(){super("socket.recording.RecordingEvent",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",$T]}])}};var mw,fw;!function(e){e[e.ACTION=0]="ACTION",e[e.RESPONSE=1]="RESPONSE",e[e.EVENT=2]="EVENT"}(mw||(mw={})),function(e){e[e.SERVICE_NOT_FOUND=0]="SERVICE_NOT_FOUND",e[e.PARAMETER_VALIDATION_ERROR=1]="PARAMETER_VALIDATION_ERROR",e[e.TIMEOUT_ERROR=2]="TIMEOUT_ERROR",e[e.APPLICATION_ERROR=3]="APPLICATION_ERROR"}(fw||(fw={})),new class extends me{constructor(){super("bridge.BridgeMessage",[{no:1,name:"type",kind:"enum",T:()=>["bridge.BridgeMessageType",mw]},{no:2,name:"action",kind:"message",oneof:"data",T:()=>gw},{no:3,name:"response",kind:"message",oneof:"data",T:()=>vw},{no:4,name:"event",kind:"message",oneof:"data",T:()=>_w}])}};const gw=new class extends me{constructor(){super("bridge.BridgeAction",[{no:1,name:"action",kind:"scalar",T:9},{no:2,name:"params",kind:"scalar",T:9}])}},vw=new class extends me{constructor(){super("bridge.BridgeResponse",[{no:1,name:"success",kind:"scalar",T:8},{no:2,name:"response",kind:"scalar",T:12},{no:3,name:"error",kind:"message",T:()=>yw}])}},yw=new class extends me{constructor(){super("bridge.BridgeError",[{no:1,name:"type",kind:"enum",T:()=>["bridge.ErrorType",fw]},{no:2,name:"message",kind:"scalar",T:9}])}},_w=new class extends me{constructor(){super("bridge.BridgeEvent",[{no:1,name:"event",kind:"scalar",T:9},{no:2,name:"params",kind:"scalar",T:9}])}};new class extends me{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3,L:0},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),t=Date.now();return e.seconds=H.from(Math.floor(t/1e3)).toBigInt(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*H.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){const t=this.create(),r=e.getTime();return t.seconds=H.from(Math.floor(r/1e3)).toBigInt(),t.nanos=r%1e3*1e6,t}internalJsonWrite(e,t){let r=1e3*H.from(e.seconds).toNumber();if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let i="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);i="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(r).toISOString().replace(".000Z",i)}internalJsonRead(e,t,r){if("string"!=typeof e)throw new Error("Unable to parse Timestamp from JSON "+k(e)+".");let i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let n=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(n))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return r||(r=this.create()),r.seconds=H.from(n/1e3).toBigInt(),r.nanos=0,i[7]&&(r.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),r}};const Sw={isV2AuthToken:!1,meetingId:null,overrides:{},roomNodeOptions:void 0},Ew={baseURL:"http://localhost:5000",createdAt:"2021-08-05T10:49:56.602Z",description:"Develop plugins locally",id:"09259e3b-7be8-46f6-9801-106bf1866e1c",name:"Localhost Dev",organizationId:"4ad15a19-80e2-4105-bf43-48039fd2963e",picture:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/dyte.png",private:!1,published:!0,staggered:!1,tags:["#localhost","#dev"],type:"self_hosted",updatedAt:"2021-08-05T10:50:07.681Z"};function Tw(e){return!(!Sw.overrides||!Sw.overrides[e])&&Sw.overrides[e]}function bw(e){Sw.roomNodeOptions=e}function ww(e,t){return!!function(e,t){return!!(Sw.isV2AuthToken&&(Ci.hasFeature(DS.CONNECTED_MEETINGS)||e===gi.Livestream||e===gi.Chat)||t.includes("HIVE"))}(e,t)||"socket-service"===(Ci.getValue(DS.CHAT_SOCKET_SERVER)||Tw(DS.CHAT_SOCKET_SERVER)||"socket-service")}function kw(e,t){return!(e!==gi.Livestream&&e!==gi.Chat&&!t.includes("HIVE"))||"socket-service"===(Ci.getValue(DS.POLL_SOCKET_SERVER)||"socket-service")}function Rw(e,t){return!!t.includes("HIVE")||"socket-service"===(Ci.getValue(DS.PLUGIN_SOCKET_SERVER)||"socket-service")}function Cw(e,t){return ww(e,t)||kw(e,t)||Rw(0,t)}const Aw=3,Iw=30,Pw=8e3;class Dw{constructor(e){Kt(this,"ipInfo"),Kt(this,"axios"),Kt(this,"requests"),Kt(this,"roomName"),Kt(this,"roomUUID"),Kt(this,"peerId"),Kt(this,"authToken"),Kt(this,"organizationId"),Kt(this,"iceServers"),Kt(this,"pluginInformation"),Kt(this,"userDetails"),Kt(this,"roomDetails");const{timeout:t=Pw,retry:r=Aw,retryDelay:i=Iw,baseURL:n="https://api.cluster.dyte.in",authToken:s,cachedUserDetails:o}=e||{};this.iceServers=null==o?void 0:o.iceServers,this.pluginInformation=null==o?void 0:o.pluginInformation,this.userDetails=null==o?void 0:o.userDetails,this.roomDetails=null==o?void 0:o.roomDetails,this.requests=h().create({baseURL:n,responseType:"json",timeout:t,retry:r,retryDelay:i}),this.axios=h(),this.setAuthToken(s,{bearer:!0}),this.requests.interceptors.request.use((e=>(VS.injectContext(this.requests.defaults.headers.common),e)),(e=>tr(this,null,(function*(){BS.error("xhr::axios",{debuggingHint:"otelRequestInterceptor failed.",error:e})})))),this.requests.interceptors.response.use((e=>{try{e.config.url!==VS.logsEndpoint&&BS.debug("xhr::axios",{networkCall:{status:e.status,statusText:e.statusText,baseURL:e.config.baseURL,url:e.config.url,method:e.config.method}})}catch(t){console.error("xhr::dyte",{error:"responseInterceptorFailed",err:t,response:e})}return e}),(e=>tr(this,null,(function*(){var t;try{if(!e)return Promise.reject(new Error("Unknown error occurred"));e&&e.config&&(null==(t=e.config)?void 0:t.url)!==VS.logsEndpoint&&BS.error("xhr::axios",{error:e,networkCall:{status:e.status,statusText:e.statusText,baseURL:e.config.baseURL,url:e.config.url,retries:e.config.retry,method:e.config.method,isOnline:navigator.onLine?"online":"offline"}});const{config:r,message:i}=e;return r&&i&&void 0!==r.retry&&r.retry>0&&(i.includes("timeout")||i.includes("Network Error"))?(r.retry-=1,this.requests(r)):Promise.reject(e)}catch(t){return console.error("xhr::dyte",{error:"responseInterceptorFailed",err:t,responseError:e}),Promise.reject(t)}}))))}setAuthToken(e,t){const{bearer:r}=t||{};this.authToken=e,this.requests.defaults.headers.common.Authorization=r?`Bearer ${e}`:e}setHeader(e,t){this.requests.defaults.headers.common[e]=t}setRoomName(e){this.roomName=e}setRoomUUID(e){this.roomUUID=e}setPeerId(e){this.peerId=e}setOrganizationId(e){this.organizationId=e}}function Mw(){return{location:sd({servicePrefix:"location",apiBase:td.apiBase,baseURI:td.baseURI}),locationLegacy:sd({servicePrefix:"location-legacy",apiBase:td.apiBase,baseURI:td.baseURI}),daCollector:sd({servicePrefix:"da-collector",apiBase:td.apiBase,baseURI:td.baseURI})}}var Ow=Object.defineProperty,Nw=Object.getOwnPropertyDescriptor,xw=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?Nw(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&Ow(t,r,s),s};class Lw extends Dw{constructor(e){super(e),this.setHeader("x-dyte-web-core-version",id)}getIPDetails(e){return tr(this,arguments,(function*({peerId:e}){var t;try{const r=yield ei.getIPDetails({peerId:e,apiHostnames:Mw()});if(BS.log("ipInfo",{ipInfo:r}),(null==(t=r.loc)?void 0:t.length)>5)return r;throw Error("Insufficient data")}catch(e){return void BS.warn("ApiClient.getRoomNodeLinkAndTitleV1 Failed to get ip details",{error:{name:e.name,message:e.message}})}}))}getICEServers(){return tr(this,null,(function*(){if(this.iceServers)return this.iceServers;const{success:e,iceServers:t}=(yield this.requests.get("/iceservers")).data;return e?t:void 0}))}getPlugins(e){return tr(this,null,(function*(){var t,r,i,n,s,o,a;if(this.pluginInformation)return this.pluginInformation;let{plugins:c}=(yield this.requests.get("/v2/plugins/user")).data.data;const d=(null==(r=null==(t=Ci.getValue(DS.V1_PLUGINS))?void 0:t.toString())?void 0:r.split(","))||[],l=c.reduce(((e,t)=>(e[d.includes(t.id)?"v1":"v2"].push(t),e)),{v1:[],v2:[]});return c=e?l.v2:l.v1,null!=(s=null==(n=null==(i=td.modules)?void 0:i.devTools)?void 0:n.plugins)&&s.length&&(null==(a=null==(o=td.modules)?void 0:o.devTools)||a.plugins.forEach((e=>{var t,r,i;const n=zt(qt({},Ew),{tags:[...Ew.tags]});n.baseURL=`http://localhost:${e.port}`,n.name=e.name,n.picture=null!=(t=e.picture)?t:Ew.picture,n.description=null!=(r=e.description)?r:Ew.description,n.staggered=null!=(i=e.staggered)?i:Ew.staggered,n.createdAt=(new Date).toISOString(),n.updatedAt=(new Date).toISOString(),n.id=e.id,n.organizationId=this.organizationId,c.push(n)}))),c}))}getPluginDetails(e){return tr(this,null,(function*(){const{plugin:t}=(yield this.requests.get(`/v2/plugins/view/${e}`)).data.data;return t}))}getPluginConfig(e){return tr(this,null,(function*(){return(yield this.axios.get(`${e}/dyte-config.json`)).data}))}authorizePlugin(e){return tr(this,null,(function*(){const t={peerId:this.peerId};Sw.isV2AuthToken||(t.roomName=this.roomName);const{token:r}=(yield this.requests.post(`/v2/plugins/authorize/${e}`,t)).data.data;return r}))}getPresignedUrls(e,t){return tr(this,null,(function*(){const r={roomUUID:this.roomUUID,filename:e};Ci.hasFeature(DS.FEAT_CHAT_SDK)&&(r.viewType=t);const{getLocation:i,putLocation:n}=(yield this.requests.post("/v1/meetings/genPreSignedUploadUrl",r)).data.data;return{getLocation:i,putLocation:n}}))}uploadFile(e,t){return tr(this,null,(function*(){if(navigator.isReactNative&&"uri"in e)try{yield fetch(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:{uri:e.uri,name:e.name}})}catch(e){BS.error(`sendFileMessage::${e}`)}else yield this.axios.put(t,e,{headers:{"Content-Type":e.type}})}))}}xw([VS.trace("APIClient.getIPDetails")],Lw.prototype,"getIPDetails",1),xw([VS.trace("APIClient.getICEServers")],Lw.prototype,"getICEServers",1);var jw=Object.defineProperty,Uw=Object.getOwnPropertyDescriptor,Fw=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?Uw(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&jw(t,r,s),s};class Vw extends Lw{startLivestreaming(){return tr(this,null,(function*(){var e,t;return null==(t=null==(e=(yield this.requests.post(`/v2/meetings/${Sw.meetingId}/livestreams`)).data)?void 0:e.data)?void 0:t.playback_url}))}stopLivestreaming(){return tr(this,null,(function*(){return this.requests.post(`/v2/meetings/${Sw.meetingId}/active-livestream/stop`)}))}getActiveLivestream(){return tr(this,null,(function*(){const{playbackUrl:e,status:t}=CS((yield this.requests.get(`/v2/meetings/${Sw.meetingId}/active-livestream`)).data.data);return{status:t,playbackUrl:e}}))}getUserDetails(){return tr(this,null,(function*(){return this.userDetails?this.userDetails:CS((yield this.requests.get("v2/internals/participant-details")).data.data)}))}getUserPreset(){throw new Error("getUserPreset does not exist for v2")}startRecording(e,t){return tr(this,null,(function*(){return(yield this.requests.post("/v2/recordings",zt(qt({},AS(e)),{meeting_id:Sw.meetingId,allow_multiple_recordings:!!t}))).data.data.id}))}updateRecording(e,t){return tr(this,null,(function*(){return this.requests.put(`v2/recordings/${e}`,{action:t})}))}getActiveRecording(){return tr(this,null,(function*(){const{status:e,id:t}=(yield this.requests.get(`v2/recordings/active-recording/${Sw.meetingId}`)).data.data;return{status:e,id:t}}))}getActiveTranscript(){return tr(this,null,(function*(){const{transcript_download_url:e}=(yield this.requests.get(`v2/meetings/${Sw.meetingId}/active-transcript`)).data.data;try{return{transcript:(yield this.axios.get(e)).data}}catch(e){throw new qS("Cant fetch transcript s3 url")}}))}getRoomNodeData(e){return tr(this,arguments,(function*({peerId:e}){if(this.roomDetails)return this.roomDetails;const t=yield this.getIPDetails({peerId:e});this.ipInfo=t;const{roomNodeLink:r,title:i,useHiveMedia:n}=CS((yield this.requests.post("v2/internals/rooms",{ip_information:t})).data.data);return{roomNodeUrl:r,meetingTitle:i,useHiveMedia:null!=n&&n}}))}}Fw([VS.trace("APIClient.startLivestreaming")],Vw.prototype,"startLivestreaming",1),Fw([VS.trace("APIClient.stopLivestreaming")],Vw.prototype,"stopLivestreaming",1),Fw([VS.trace("APIClient.getActiveLivestream")],Vw.prototype,"getActiveLivestream",1),Fw([VS.trace("APIClient.getUserDetails")],Vw.prototype,"getUserDetails",1),Fw([VS.trace("APIClient.getUserPreset")],Vw.prototype,"getUserPreset",1),Fw([VS.trace("APIClient.startRecording")],Vw.prototype,"startRecording",1),Fw([VS.trace("APIClient.stopRecording")],Vw.prototype,"updateRecording",1),Fw([VS.trace("APIClient.getActiveRecording")],Vw.prototype,"getActiveRecording",1),Fw([VS.trace("APIClient.getActiveTranscript")],Vw.prototype,"getActiveTranscript",1),Fw([VS.trace("APIClient.getRoomNodeData")],Vw.prototype,"getRoomNodeData",1);var Bw=Object.defineProperty,Ww=Object.getOwnPropertyDescriptor,Hw=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?Ww(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&Bw(t,r,s),s};class Gw extends Lw{startLivestreaming(){throw new Error("Method not implemented.")}stopLivestreaming(){throw new Error("Method not implemented.")}getActiveLivestream(){throw new Error("Method not implemented.")}getUserDetails(){return tr(this,null,(function*(){const{user:e}=(yield this.requests.get("/auth/basicUserDetails")).data;return e}))}getUserPreset(e){return tr(this,null,(function*(){const{preset:t}=(yield this.requests.post("/v1/userpreset",{roomName:e,authToken:this.authToken,clientType:"CLIENT_APP",version:"0.5.0"})).data.data;return CS(t)}))}startRecording(e){return tr(this,null,(function*(){const t=yield this.requests.post(`/v1/organizations/${this.organizationId}/rooms/${this.roomName}/recording`,e);if(201!==t.status)throw new Error("Recording failed to start");return t.data.data.recording.id}))}updateRecording(e,t){return tr(this,null,(function*(){if("stop"===t&&201!==(yield this.requests.put(`/v1/organizations/${this.organizationId}/rooms/${this.roomName}/recordings/${e}`,{recordingAction:"stop"})).status)throw new Error("Recording failed to stop")}))}getActiveRecording(){return tr(this,null,(function*(){return this.organizationId?(yield this.requests.get(`/v1/organizations/${this.organizationId}/rooms/${this.roomName}/active-recording?limit=50`)).data.data.recording:{}}))}getActiveTranscript(){return tr(this,null,(function*(){return BS.error("getActiveTranscript does not work in v1 meeting"),{transcript:""}}))}getRoomNodeData(e){return tr(this,arguments,(function*({roomName:e,peerId:t}){const r=yield this.getIPDetails({peerId:t});this.ipInfo=r;const{roomNodeLink:i,title:n,useHiveMedia:s}=(yield this.requests.post("/graphql",{query:"\n\t\t\t\tquery Session($roomName: String!, $password: String, $ipInformation: String) {\n\t\t\t\t\t\tsession(roomName: $roomName, password: $password) {\n\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\troomNodeLink(ipInformation: $ipInformation),\n\t\t\t\t\t\t\tuseHiveMedia,\n\t\t\t\t\t\t\troomName,\n\t\t\t\t\t\t\tpassword\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t",variables:{roomName:e,ipInformation:JSON.stringify(r)}})).data.data.session;return{roomNodeUrl:i,meetingTitle:n,useHiveMedia:null!=s&&s}}))}}let $w;function qw(){return $w}function zw(e,t){return Object.keys(t).reduce(((r,i)=>(r[i]=(e<<16)+t[i],r)),{})}Hw([VS.trace("APIClientV1.getUserDetails")],Gw.prototype,"getUserDetails",1),Hw([VS.trace("APIClientV1.getUserPreset")],Gw.prototype,"getUserPreset",1),Hw([VS.trace("APIClientV1.startRecording")],Gw.prototype,"startRecording",1),Hw([VS.trace("APIClientV1.updateRecording")],Gw.prototype,"updateRecording",1),Hw([VS.trace("APIClientV1.getActiveRecording")],Gw.prototype,"getActiveRecording",1),Hw([VS.trace("APIClient.getActiveTranscript")],Gw.prototype,"getActiveTranscript",1),Hw([VS.trace("APIClientV1.getRoomNodeData")],Gw.prototype,"getRoomNodeData",1);const Jw=zw(0,{getPeerInfo:0,updatePeerInfo:1,getRoomPeersInfo:2,joinRoom:3,leaveRoom:4,getRoomInfo:5,updateRoomInfo:6,closeRoom:7,startedLivestream:8,stoppedLivestream:9,erroredLivestream:10,getStagePeers:11,getStageRequests:12,requestStageAccess:13,cancelStageRequest:14,grantStageAccess:15,denyStageAccess:16,roomPeerCount:17,joinStage:18,leaveStage:19,getConnectedRoomsDump:20,createConnectedRooms:21,deleteConnectedRooms:22,movePeers:23,transferPeer:24,movedPeer:25,connectedRoomsUpdated:26,connectedRoomsDeleted:27,getAllAddedParticipants:28,broadcastMessage:29,kick:30,kickAll:31,transcript:32,getWaitingRoomRequests:33,acceptWaitingRoomRequests:34,waitingRoomRequestAccepted:35,denyWaitingRoomRequests:36,waitingRoomRequestDenied:37,peerStageStatusUpdate:38,broadcastToPeers:39,recordingStarted:40,recordingStopped:41,recordingPaused:42,getRoomStageState:43}),Kw=zw(1,{getMessages:0,sendMessageToRoom:1,sendMessageToPeers:2,editMessage:3,deleteMessage:4,getPaginatedMessages:5,sendMessageToChannel:6,searchChannelMessages:7,getAllChatChannels:8,markChannelIndexAsRead:9,pinMessage:10}),Yw=zw(2,{getPlugins:0,addPlugin:1,enablePluginForRoom:2,disablePluginForPeers:3,enablePluginForPeers:4,disablePluginForRoom:5,removePlugin:6,customPluginEventToRoom:7,customPluginEventToPeers:8,storeInsertKeys:9,storeGetKeys:10,storeDeleteKeys:11,storeDelete:12}),Qw=zw(3,{createPoll:0,getPolls:1,votePoll:2,updatePoll:3}),Xw=zw(4,{createChatChannel:0,getChatChannel:1,deprecatedGetAllChatChannels:2,getChannelMembers:3,updateChatChannel:4}),Zw=function(e){return Object.keys(e).reduce(((t,r)=>(t[r]=16777216|e[r],t)),{})}({unknown:0,createWebRTCTransport:1,produce:2,consume:3,toggleProducer:4,toggleConsumer:5,closeProducer:6,closeConsumer:7,joinRoom:16,leaveRoom:17,selectedPeer:18,globalPinPeer:19,selfJoinComplete:20,peerJoinedBroadcast:25,peerLeaveBroadcast:26,peerProducerCreateBroadcast:27,peerProducerToggleBroadcast:28,peerProducerCloseBroadcast:29,globalPeerPinBroadcast:30,recordingStartedBroadcast:31,recordingStoppedBroadcast:32,peerDisplayNameEditBroadcast:33,mediaRoomTerminationBroadcastResponse:36,selectedPeerDiff:40,renegotiateSessionDescription:50,errorResponse:60,kickPeer:90,kickAll:91,changeDisplayName:92,hostControlPeer:93,hostControlAllPeers:94}),ek=zw(5,{getUserPresets:0,updateUserPreset:1});var tk;class rk{constructor(){Kt(this,"meetingTitle"),Kt(this,"roomName"),Kt(this,"roomUUID"),Kt(this,"isDisconnected"),Kt(this,"roomJoined"),Xt(this,tk,void 0),Kt(this,"peerId"),Kt(this,"authToken"),Kt(this,"maxPreferredStreams"),Kt(this,"mediaConnected")}get sfuHandler(){return Qt(this,tk)}reconnect(){throw new qS("Method not implemented.")}joinRoom(e,t,r,i){return tr(this,arguments,(function*(e,t,r,i,n={}){throw new qS("Method not implemented.")}))}leaveRoom(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}handleSocketCallbacks(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}handleSockets(e,t){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}shareMic(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}shareWebcam(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}shareScreen(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}unmuteSelf(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}muteSelf(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}pauseWebcam(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}disableScreenShare(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}acceptWaitingRequest(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}rejectWaitingRequest(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}muteAll(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}muteAllVideo(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}disableAudio(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}disableVideo(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}kickAll(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}kick(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}pinPeer(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}getChatMessages(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}requestRemoteControl(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}acceptRemoteControl(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}terminateRemoteControl(e,t){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}sendEventRemoteControl(e,t,r){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}getPolls(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}newPoll(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}votePoll(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}getPage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}getConsumers(){throw new qS("Method not implemented.")}sendMessage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}getRoomState(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}addRoomPlugin(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}removeRoomPlugin(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}unpinChatMessage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}pinChatMessage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}sendChatMessage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}broadcastMessage(e,t){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}acceptAllRequestToJoinStage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}grantStageAccess(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}stopPresenting(){return tr(this,null,(function*(){}))}startPresenting(){return tr(this,null,(function*(){}))}requestToJoinStage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}rejectRequestToJoinStage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}denyStageAccess(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}withdrawRequestToJoinStage(){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}removePeerFromStage(e,t){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}kickPeerFromStage(e){return tr(this,null,(function*(){throw new qS("Method not implemented.")}))}stopAllProducers(){throw new qS("Method not implemented.")}}tk=new WeakMap;var ik,nk,sk,ok,ak,ck,dk,lk,uk,pk,hk,mk,fk,gk,vk,yk,_k=(e=>(e.INITIALIZING="INITIALIZING",e.INITIALIZED="INITIALIZED",e.NOT_INITIALIZED="NOT_INITIALIZED",e))(_k||{});class Sk extends ir.EventEmitter{}class Ek extends ir.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return BS.error(`EnhancedEventEmitter:: safeEmit() | event listener ${e} threw an error`,{error:t}),Boolean(r)}}safeEmitAsPromise(e,...t){return tr(this,null,(function*(){const r={}.EVENT_PROMISE_TIMEOUT?parseInt({}.EVENT_PROMISE_TIMEOUT,10):1e4;return this.safeEmitAsPromiseWithTimeout(e,r,...t)}))}safeEmitAsPromiseWithTimeout(e,t,...r){return tr(this,null,(function*(){return new Promise(((i,n)=>{setTimeout(n,t,"event request timeout");try{this.emit(e,...r,i,n)}catch(t){BS.error(`EnhancedEventEmitter:: safeEmitAsPromise() | event listener for event ${e} threw an error [event:%s]:%o`,{error:t}),n(t)}}))}))}}class Tk extends Ek{constructor(){super(),Kt(this,"_mapMidTransceiver",new Map),Kt(this,"_enableHighBitrate",!1),Kt(this,"_enableStereo",!1),this._mapMidTransceiver=new Map,this._enableHighBitrate=!1}get midTransceiverMap(){return this._mapMidTransceiver}}class bk extends Tk{constructor(){super(),Kt(this,"_direction"),Kt(this,"_pc"),Kt(this,"_sendWebStream",new MediaStream),Kt(this,"_sendScreenShareStream",new MediaStream),Kt(this,"_transportReady",!1)}static createFactory(){return()=>new bk}get name(){return"Chrome74"}get pc(){return this._pc}close(){if(BS.debug("close()"),this._pc)try{this._pc.close()}catch(e){BS.error("pc.close()",e)}}init({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:i,proprietaryConstraints:n,onTrackHandler:s}){this._direction=e,this._pc=new RTCPeerConnection(qt({iceServers:t||[],iceTransportPolicy:r||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},i),n),s&&this._pc.addEventListener("track",(e=>{s(e)})),this._addEventListeners()}connect(){return tr(this,null,(function*(){const e=this._pc.createDataChannel("dyte"),t=yield this._pc.createOffer();return BS.info(`connect offer: ${JSON.stringify(t)}`),yield this._pc.setLocalDescription(t),{offerSdp:t,callback:t=>tr(this,null,(function*(){BS.debug(`Chrome74::connect() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),e.close()}))}}))}updateIceServers(e){return tr(this,null,(function*(){BS.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(){return tr(this,null,(function*(){BS.debug("restartIce()");const e=yield this.pc.createOffer({iceRestart:!0});return BS.debug(`restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:e=>tr(this,null,(function*(){BS.info(`restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOption:r,screenShare:i}){var n;this._assertSendDirection(),BS.debug(`send() [kind:${e.kind}, track.id:${e.id}]`);const s=this._pc.addTransceiver(e,{direction:"sendonly",streams:[i?this._sendScreenShareStream:this._sendWebStream],sendEncodings:t});if(!navigator.isReactNative){BS.debug("creating new transceiver");const t=RTCRtpSender.getCapabilities(e.kind);BS.info(`senders available params: ${JSON.stringify(t)}`);const i=[];if(r){const e=t.codecs.find((e=>e.mimeType.includes(r.name)));if(r.parameters){BS.info(`codecOption.parameters:${JSON.stringify(r.parameters)}`);const t=(null==(n=e.sdpFmtpLine)?void 0:n.split(";"))||[];t.push(...r.parameters);const i=Array.from(new Set(t).values());e.sdpFmtpLine=i.join(";")}i.push(e)}BS.info(`selected codecs: ${JSON.stringify(i)}`),s.setCodecPreferences(i)}const o=yield this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(yield this._pc.setLocalDescription(o),r&&"opus"===r.name){const e=this._enableStereo,t=this._enableHighBitrate?e?128e3:64e3:e?64e3:32e3;o.sdp=o.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${e?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${t}`),o.sdp+="a=rtcp-fb:111 nack\r\n"}return{offerSdp:o,callback:e=>tr(this,null,(function*(){return BS.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e),this.midTransceiverMap.set(s.mid,s),s.mid}))}}))}stopSending(e){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`stopSending() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}replaceTrack(e,t){return tr(this,null,(function*(){this._assertSendDirection(),t?BS.debug(`replaceTrack() [localId:${e}, track.id:${t.id}]`):BS.debug(`replaceTrack() [localId:${e}, no track]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${t}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(i)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(t)}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i)}))}getSenderStats(e){this._assertSendDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}stopReceiving(e){return tr(this,null,(function*(){throw this._assertRecvDirection(),BS.debug(`stopReceiving() [localId:${e}]`),Error("method not implemented")}))}pauseReceiving(e){return tr(this,null,(function*(){throw this._assertRecvDirection(),BS.debug(`pauseReceiving() [localId:${e}]`),Error("method not implemented")}))}resumeReceiving(e){return tr(this,null,(function*(){throw this._assertRecvDirection(),BS.debug(`resumeReceiving() [localId:${e}]`),Error("method not implemented")}))}getReceiverStats(e){return tr(this,null,(function*(){this._assertRecvDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}_generateOffer(){return tr(this,null,(function*(){const e=yield this._pc.createOffer();return yield this._pc.setLocalDescription(e),e}))}_setAnswer(e){return tr(this,null,(function*(){BS.debug(`setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}_addEventListeners(){this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidate",(e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})})),this._pc.addEventListener("negotiationneeded",(()=>{this.emit("@negotiationneeded",{}),BS.debug("negotiationneeded")})),this._pc.addEventListener("icegatheringstatechange",(()=>{switch(this._pc.iceGatheringState){case"gathering":BS.debug("icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":BS.debug("icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidateerror",(e=>{BS.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})})),this._pc.addEventListener("datachannel",(e=>{BS.info("data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:t}=e;t.onopen=()=>{BS.info("data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel.label)},t.onclose=()=>{BS.warn("data channel closed: ",{rtcChannel:{label:e.channel.label}})},t.onerror=()=>{BS.error("data channel error: ",{rtcChannel:{label:e.channel.label}})},t.onmessage=t=>{this.safeEmit("datachannel",e.channel,String.fromCharCode(...new Uint8Array(t.data)))}}))}}class wk extends Tk{constructor(e){super(),Kt(this,"_direction"),Kt(this,"_pc"),Kt(this,"_sendWebStream",new MediaStream),Kt(this,"_sendScreenShareStream",new MediaStream),Kt(this,"_transportReady",!1),Kt(this,"supportsSendEncodings",!1),this.supportsSendEncodings=e.supportsSendEncodings}static createFactory(e){return()=>new wk(e)}get name(){return"Firefox60"}get pc(){return this._pc}close(){if(BS.debug("Firefox60::close()"),this._pc)try{this._pc.close()}catch(e){BS.error("Firefox60::pc.close()",{error:e})}}init({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:i,proprietaryConstraints:n,onTrackHandler:s}){BS.debug("Firefox60::init()"),this._direction=e,this._pc=new RTCPeerConnection(qt({iceServers:t||[],iceTransportPolicy:r||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},i),n),s&&this._pc.addEventListener("track",(e=>{s(e)})),this._addEventListeners()}connect(){return tr(this,null,(function*(){const e=this._pc.createDataChannel("dyte"),t=yield this._pc.createOffer();return BS.info(`Firefox60::connect offer: ${JSON.stringify(t)}`),yield this._pc.setLocalDescription(t),{offerSdp:t,callback:t=>tr(this,null,(function*(){BS.debug(`Firefox60::connect() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),e.close()}))}}))}updateIceServers(e){return tr(this,null,(function*(){throw BS.debug("Firefox60::updateIceServers()"),new Error("not supported")}))}restartIce(){return tr(this,null,(function*(){BS.debug("Firefox60::restartIce()");const e=yield this.pc.createOffer({iceRestart:!0});return BS.debug(`Firefox60::restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:e=>tr(this,null,(function*(){BS.info(`Firefox60::restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,screenShare:r}){this._assertSendDirection(),BS.debug(`Firefox60::send() [kind:${e.kind}, track.id:${e.id}]`),BS.debug("Firefox60::creating new transceiver");const i=this.supportsSendEncodings&&void 0!==t?{sendEncodings:t}:{},n=this._pc.addTransceiver(e,qt({direction:"sendonly",streams:[r?this._sendScreenShareStream:this._sendWebStream]},i));if(!this.supportsSendEncodings&&t){t.reverse();const e=n.sender.getParameters();e.encodings=t,yield n.sender.setParameters(e)}const s=yield this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(yield this._pc.setLocalDescription(s),"audio"===e.kind){const e=this._enableStereo,t=this._enableHighBitrate?e?128e3:64e3:e?64e3:32e3;s.sdp=s.sdp.replace("minptime=10;useinbandfec=1","minptime=10;useinbandfec=1;usedtx=1"+(this.supportsSendEncodings?"":`${e?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${t}`))}return{offerSdp:s,callback:e=>tr(this,null,(function*(){return BS.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e),this.midTransceiverMap.set(n.mid,n),n.mid}))}}))}stopSending(e){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`Firefox60::stopSending() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}replaceTrack(e,t){return tr(this,null,(function*(){this._assertSendDirection(),t?BS.debug(`replaceTrack() [localId:${e}, track.id:${t.id}]`):BS.debug(`Firefox60::replaceTrack() [localId:${e}, no track]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${t}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters(),n=i.encodings.length-1-t;i.encodings.forEach(((e,t)=>{e.active=t>=n})),yield r.sender.setParameters(i)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(t)}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i)}))}getSenderStats(e){this._assertSendDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}stopReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Firefox60::stopReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",BS.info(`Firefox60::active transcievers: ${JSON.stringify(this._pc.getTransceivers())}`);const r=yield this._pc.createOffer();return BS.debug(`Firefox60::stopRecieving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`Firefox60::stopRecieving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}pauseReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Firefox60::pauseReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`pauseReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`pauseReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}resumeReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Firefox60::resumeReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r=yield this._generateOffer();return BS.debug(`resumeReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`resumeReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getReceiverStats(e){return tr(this,null,(function*(){this._assertRecvDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}_generateOffer(){return tr(this,null,(function*(){const e=yield this._pc.createOffer();return yield this._pc.setLocalDescription(e),e}))}_setAnswer(e){return tr(this,null,(function*(){BS.debug(`_setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}_addEventListeners(){this._pc.addEventListener("datachannel",(e=>{BS.info("Firefox60::data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:t}=e;t.onopen=()=>{BS.info("Firefox60::data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel.label)},t.onclose=()=>{BS.warn("data channel closed: ",{rtcChannel:{label:e.channel.label}})},t.onerror=()=>{BS.error("Firefox60::data channel error: ",{rtcChannel:{label:e.channel.label}})},t.onmessage=t=>tr(this,null,(function*(){const r=yield t.data.arrayBuffer();this.safeEmit("datachannel",e.channel,String.fromCharCode(...new Uint8Array(r)))}))})),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidate",(e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})})),this._pc.addEventListener("negotiationneeded",(()=>{this.emit("@negotiationneeded",{}),BS.debug("Firefox60::negotiationneeded")})),this._pc.addEventListener("icegatheringstatechange",(()=>{switch(this._pc.iceGatheringState){case"gathering":BS.debug("Firefox60::icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":BS.debug("Firefox60::icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidateerror",(e=>{BS.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})}))}}class kk extends Tk{constructor(){super(),Kt(this,"_direction"),Kt(this,"_pc"),Kt(this,"_sendWebStream",new MediaStream),Kt(this,"_sendScreenShareStream",new MediaStream),Kt(this,"_transportReady",!1)}static createFactory(){return()=>new kk}get name(){return"Chrome74"}get pc(){return this._pc}close(){if(BS.debug("Safari12::close()"),this._pc)try{this._pc.close()}catch(e){BS.error("Safari12::pc.close()",e)}}init({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:i,proprietaryConstraints:n,onTrackHandler:s}){BS.debug("Safari12::init()"),this._direction=e,this._pc=new RTCPeerConnection(qt({iceServers:t||[],iceTransportPolicy:r||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},i),n),s&&this._pc.addEventListener("track",(e=>{s(e)})),this._addEventListeners()}connect(){return tr(this,null,(function*(){const e=this._pc.createDataChannel("dyte"),t=yield this._pc.createOffer();return BS.info(`Safari12::connect offer: ${JSON.stringify(t)}`),yield this._pc.setLocalDescription(t),{offerSdp:t,callback:t=>tr(this,null,(function*(){BS.debug(`Safari12::connect() | calling pc.setRemoteDescription() [answer: ${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),e.close()}))}}))}updateIceServers(e){return tr(this,null,(function*(){BS.debug("Safari12::updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(){return tr(this,null,(function*(){BS.debug("Safari12::restartIce()");const e=yield this.pc.createOffer({iceRestart:!0});return BS.debug(`restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:e=>tr(this,null,(function*(){BS.info(`restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOption:r,screenShare:i}){var n;this._assertSendDirection(),BS.debug(`Safari12::send() [kind: ${e.kind}, track.id: ${e.id}]`),BS.debug("Safari12::creating new transceiver");const s=this._pc.addTransceiver(e,{direction:"sendonly",streams:[i?this._sendScreenShareStream:this._sendWebStream],sendEncodings:t}),o=RTCRtpSender.getCapabilities(e.kind);BS.info(`Safari12::senders available params: ${JSON.stringify(o)}`);const a=[];if(r){const e=o.codecs.find((e=>e.mimeType.includes(r.name)));if(r.parameters){BS.info(`Safari12::codecOption.parameters:, ${JSON.stringify(r.parameters)}`);const t=(null==(n=e.sdpFmtpLine)?void 0:n.split(";"))||[];t.push(...r.parameters);const i=[...new Set(t).values()];e.sdpFmtpLine=i.join(";")}a.push(e)}BS.info(`Safari12::selected codecs: ${JSON.stringify(a)}`),s.setCodecPreferences(a);const c=yield this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(yield this._pc.setLocalDescription(c),"audio"===e.kind){const e=this._enableStereo,t=this._enableHighBitrate?e?128e3:64e3:e?64e3:32e3;c.sdp=c.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${e?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${t}`)}return{offerSdp:c,callback:e=>tr(this,null,(function*(){return BS.debug(`Safari12::send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e),this.midTransceiverMap.set(s.mid,s),s.mid}))}}))}stopSending(e){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`Safari12::stopSending() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`Safari12::stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`Safari12::stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}replaceTrack(e,t){return tr(this,null,(function*(){this._assertSendDirection(),t?BS.debug(`Safari12::replaceTrack() [localId:${e}, track.id:${t.id}]`):BS.debug(`Safari12::replaceTrack() [localId:${e}, no track]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${t}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(i)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(t)}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach(((e,r)=>{i.encodings[r]=qt(qt({},e),t)})),yield r.sender.setParameters(i)}))}getSenderStats(e){this._assertSendDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}receive(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`recieve() | calling pc.setLocalDescription() [answer:${JSON.stringify(e)}]`);const t=this._pc.getTransceivers().at(-1);return BS.info("Safari12::Transceiver is now receiving"),this.midTransceiverMap.set(t.mid,t),{track:t.receiver.track,localId:t.mid}}))}stopReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Safari12::stopReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",BS.info(`Safari12::active transcievers: ${JSON.stringify(this._pc.getTransceivers())}`);const r=yield this._pc.createOffer();return BS.debug(`stopRecieving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`stopRecieving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}pauseReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Safari12::pauseReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`pauseReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`pauseReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}resumeReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Safari12::resumeReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r=yield this._generateOffer();return BS.debug(`Safari12::resumeReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`Safari12::resumeReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getReceiverStats(e){return tr(this,null,(function*(){this._assertRecvDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}_generateOffer(){return tr(this,null,(function*(){const e=yield this._pc.createOffer();return yield this._pc.setLocalDescription(e),e}))}_setAnswer(e){return tr(this,null,(function*(){BS.debug(`Safari12::_setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}_addEventListeners(){this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:BS.warn("Safari12::unknown state")}})),this._pc.addEventListener("icecandidate",(e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})})),this._pc.addEventListener("negotiationneeded",(()=>{this.emit("@negotiationneeded",{}),BS.debug("Safari12::negotiationneeded")})),this._pc.addEventListener("icegatheringstatechange",(()=>{switch(this._pc.iceGatheringState){case"gathering":BS.debug("Safari12::icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":BS.debug("Safari12::icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:BS.warn("Safari12::unknown state")}})),this._pc.addEventListener("icecandidateerror",(e=>{BS.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})})),this._pc.ondatachannel=e=>{BS.info("Safari12::data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:t}=e;t.onopen=()=>{BS.info("Safari12::data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel.label)},t.onclose=()=>{BS.warn("Safari12::data channel closed: ",{rtcChannel:{label:e.channel.label}})},t.onerror=()=>{BS.error("Safari12::data channel error: ",{rtcChannel:{label:e.channel.label}})},t.onmessage=t=>tr(this,null,(function*(){const r=String.fromCharCode(...new Uint8Array(t.data));this.safeEmit("datachannel",e.channel,r)}))}}}class Rk extends qS{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Rk):this.stack=new Error(e).stack}}class Ck extends qS{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Ck):this.stack=new Error(e).stack}}class Ak extends Ek{constructor({id:e,localId:t,track:r,stopTracks:i,disableTrackOnPause:n,zeroRtpOnPause:s,handler:o,appData:a}){super(),Kt(this,"_id"),Kt(this,"_localId"),Kt(this,"_closed",!1),Kt(this,"_handler"),Kt(this,"_track"),Kt(this,"_kind"),Kt(this,"_paused"),Kt(this,"_maxSpatialLayer"),Kt(this,"_stopTracks"),Kt(this,"_disableTrackOnPause"),Kt(this,"_zeroRtpOnPause"),Kt(this,"_appData"),Kt(this,"observer"),this._id=e,this._localId=t,this._track=r,this._kind=r.kind,this._paused=!!n&&!r.enabled,this._maxSpatialLayer=void 0,this._stopTracks=i,this._disableTrackOnPause=n,this._zeroRtpOnPause=s,this._appData=a||{},this._onTrackEnded=this._onTrackEnded.bind(this),this._handler=o,this.observer=new Ek,this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get track(){return this._track}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}close(e){return tr(this,null,(function*(){if(this._closed)return;if(BS.debug("Producer::close() with reason:"),this._closed=!0,this._destroyTrack(),e===Ok)return void this.observer.emit("close");const{offerSdp:t,callback:r}=yield this._handler.stopSending(this.localId);this.observer.emit("close");const{answer:i}=yield this.safeEmitAsPromise("close",{offer:t,reason:e});r(i)}))}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Ck("closed");return this._handler.getSenderStats(this.localId)}))}pause(){BS.debug("Producer::pause()",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._closed&&BS.error("Producer::pause() | Producer closed",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this._handler.replaceTrack(this.localId,null),this.observer.emit("pause")}resume(){BS.debug("Producer::resume()",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._closed?BS.error("Producer::resume() | Producer closed",{producer:{id:this.id,appData:this.appData,kind:this.kind}}):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this._handler.replaceTrack(this.localId,this._track),this.observer.emit("resume"))}replaceTrack(e){return tr(this,arguments,(function*({track:e}){if(BS.debug("Producer::replaceTrack()",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==e?void 0:e.id}}),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(t){BS.error("Producer::replaceTrack",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==e?void 0:e.id},error:t})}throw new Ck("closed")}if(e&&"ended"===e.readyState)throw new Ck("track ended");e!==this._track?((!this._zeroRtpOnPause||!this._paused)&&(yield this._handler.replaceTrack(this.localId,e)),this._destroyTrack(),this._track=e,this._handleTrack()):BS.debug("replaceTrack() | same track, ignored",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==e?void 0:e.id}})}))}setMaxSpatialLayer(e){return tr(this,null,(function*(){if(this._closed)throw new Ck("closed");if("video"!==this._kind)throw new Rk("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");yield this._handler.setMaxSpatialLayer(this.localId,e),this._maxSpatialLayer=e}))}setRtpEncodingParameters(e){return tr(this,null,(function*(){if(this._closed)throw new Ck("closed");if("object"!=typeof e)throw new TypeError("invalid params");yield this._handler.setRtpEncodingParameters(this.localId,e)}))}_onTrackEnded(){BS.debug('Producer::track "ended" event',{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:this.track.id}}),this.observer.emit("trackended"),this.safeEmit("trackended",this.track.id)}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){var e;if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(t){BS.error("Producer::_destroyTrack",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==(e=this._track)?void 0:e.id},error:t})}}}class Ik extends Ek{constructor({id:e,localId:t,producerId:r,producingPeerId:i,handler:n,track:s,appData:o,paused:a,reuseTrack:c}){super(),Xt(this,hk),Xt(this,fk),Xt(this,vk),Kt(this,"observer"),Xt(this,ik,void 0),Xt(this,nk,void 0),Xt(this,sk,void 0),Xt(this,ok,void 0),Xt(this,ak,void 0),Xt(this,ck,void 0),Xt(this,dk,void 0),Xt(this,lk,void 0),Xt(this,uk,void 0),Xt(this,pk,void 0),Zt(this,ik,e),Zt(this,nk,t),Zt(this,ck,n),Zt(this,pk,o),Zt(this,uk,i),Zt(this,ok,!1),Zt(this,sk,r),Zt(this,dk,s),Zt(this,lk,null!=a&&a),Zt(this,ak,c),this.observer=new Ek,er(this,fk,gk).call(this)}get id(){return Qt(this,ik)}get peerId(){return Qt(this,uk)}get localId(){return Qt(this,nk)}get producerId(){return Qt(this,sk)}get closed(){return Qt(this,ok)}get kind(){return Qt(this,dk).kind}get track(){return Qt(this,dk)}get paused(){return Qt(this,lk)}get remotelyPaused(){return this.paused}get appData(){return Qt(this,pk)}close(e){Qt(this,ok)||(BS.debug("Consumer::close() with reason:",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,closureReason:e,kind:this.kind}}),Zt(this,ok,!0),Qt(this,ak)||er(this,vk,yk).call(this),this.emit("close",e),this.observer.safeEmit("close",e))}getStats(){return tr(this,null,(function*(){if(Qt(this,ok))throw new Ck("closed");return Qt(this,ck).getReceiverStats(this.localId)}))}pause(){BS.debug("consumer::pause()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),Qt(this,ok)?BS.error("consumer::pause() | Consumer closed",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}):(Zt(this,lk,!0),Qt(this,dk).enabled=!1,this.observer.safeEmit("pause"))}resume(){BS.debug("consumer::resume()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),Qt(this,ok)?BS.error("Consumer::resume() | Consumer closed",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}):(Zt(this,lk,!1),Qt(this,dk).enabled=!0,this.observer.safeEmit("resume"))}}ik=new WeakMap,nk=new WeakMap,sk=new WeakMap,ok=new WeakMap,ak=new WeakMap,ck=new WeakMap,dk=new WeakMap,lk=new WeakMap,uk=new WeakMap,pk=new WeakMap,hk=new WeakSet,mk=function(){BS.debug('Consumer::track "ended" event',{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),this.safeEmit("trackended"),this.observer.safeEmit("trackended")},fk=new WeakSet,gk=function(){Qt(this,dk).addEventListener("ended",er(this,hk,mk).bind(this))},vk=new WeakSet,yk=function(){try{Qt(this,dk).removeEventListener("ended",er(this,hk,mk)),Qt(this,dk).stop()}catch(e){BS.error("Consumer::destroyTrack()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind},error:e})}};const Pk=e=>new Promise((t=>setTimeout(t,e)));function Dk(e,t){return tr(this,null,(function*(){return new Promise(((r,i)=>tr(this,null,(function*(){const{strategy:n,maxRetryCount:s,delayTime:o}=qt({strategy:"linear",maxRetryCount:3,delayTime:10},t);let a,c=0,d=!1;const l=e=>{d=!0,i(e)};for(;c<s;){try{const t=yield e(c,l);return r(t)}catch(e){if(a=e,d)break;if(!(c<s))break;"linear"===n?yield Pk(o*(c+1)):"exponential"===n&&(yield Pk(o*(c+Math.max(0,c-1))))}c+=1}return i(a)}))))}))}function Mk(e){if(Promise.allSettled)return Promise.allSettled(e);const t=e.map((e=>e.then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))));return Promise.all(t)}const Ok="transport closed";var Nk,xk,Lk,jk,Uk,Fk,Vk,Bk,Wk,Hk,Gk,$k,qk,zk,Jk,Kk,Yk,Qk,Xk,Zk,eR,tR,rR,iR,nR;class sR extends Ek{constructor({id:e,direction:t,handlerFactory:r,iceServers:i,iceTransportPolicy:n,proprietaryConstraints:s,additionalSettings:o,appData:a,config:c}){var d,l;super(),Xt(this,Xk),Xt(this,eR),Xt(this,rR),Kt(this,"awaitQueue"),Kt(this,"observer"),Xt(this,Nk,void 0),Xt(this,xk,void 0),Xt(this,Lk,!1),Xt(this,jk,void 0),Xt(this,Uk,void 0),Xt(this,Fk,void 0),Xt(this,Vk,"new"),Xt(this,Bk,void 0),Xt(this,Wk,void 0),Xt(this,Hk,void 0),Xt(this,Gk,!1),Xt(this,$k,null),Xt(this,qk,void 0),Xt(this,zk,void 0),Xt(this,Jk,void 0),Xt(this,Kk,void 0),Xt(this,Yk,void 0),Xt(this,Qk,new Map),BS.debug(`constructor() [id: ${e}, direction: ${t}]`),Zt(this,Nk,e),Zt(this,jk,t);const u=function(e,t){return void 0===e?{}:"undefined"!=typeof window&&Object.getOwnPropertyDescriptor(window,"structuredClone")?structuredClone(e):JSON.parse(JSON.stringify(e))}(o);delete u.iceServers,delete u.iceTransportPolicy,delete u.bundlePolicy,delete u.rtcpMuxPolicy,delete u.sdpSemantics,Zt(this,Bk,new Map),Zt(this,Wk,new Map),Zt(this,Hk,new Map),Zt(this,zk,new Map),Zt(this,Kk,new Map),Zt(this,Jk,new Map),this.awaitQueue=new rc,this.observer=new Ek,Zt(this,Fk,r()),Qt(this,Fk)._enableHighBitrate=null!=(d=null==c?void 0:c.enableHighBitrate)&&d,Qt(this,Fk)._enableStereo=null!=(l=null==c?void 0:c.enableStereo)&&l,Qt(this,Fk).init({onTrackHandler:this._ontrack.bind(this),direction:t,iceServers:i,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:s}),Zt(this,Yk,a||{}),Zt(this,qk,new Promise((e=>{this.observer.once("connected",(()=>{e(!0)})),this.observer.once("disconnect",(()=>{e(!1)})),this.observer.once("close",(()=>{e(!1)}))}))),Qt(this,Fk).on("@connectionstatechange",(e=>{e!==Qt(this,Vk)&&(BS.debug(`connection state changed to ${e}`),Zt(this,Vk,e),"connected"===e&&(Zt(this,Gk,!0),this.observer.emit("connected")),"disconnected"===e&&(Zt(this,Gk,!1),this.observer.emit("disconnect")),("failed"===e||"closed"===e)&&(Zt(this,Gk,!1),this.observer.emit("close")),Qt(this,Lk)||this.safeEmit("connectionstatechange",e))})),Qt(this,Fk).on("@icecandidate",(({candidate:e})=>{Qt(this,Lk)||this.safeEmit("icecandidate",e)})),Qt(this,Fk).on("dc_open",(e=>{Zt(this,$k,!1),setTimeout((()=>{"events"===e&&!Qt(this,$k)&&this.safeEmit("dc_error",e)}),5e3)})),Qt(this,Fk).on("datachannel",((e,t)=>{var r,i;"events"===e.label&&Zt(this,$k,!0),Qt(this,Hk).has(e.label)||Qt(this,Hk).set(e.label,e);const n=JSON.parse(t);if(Qt(this,Qk).has(n.id)||Qt(this,Qk).set(n.id,[]),null==(r=Qt(this,Qk).get(n.id))||r.push(n),(null==(i=Qt(this,Qk).get(n.id))?void 0:i.length)===n.count){const t=Qt(this,Qk).get(n.id),r=null==t?void 0:t.reduce(((e,t)=>e+t.chunk),"");Qt(this,Qk).delete(n.id);try{const t=JSON.parse(r);this.safeEmit(`datachannel:${e.label}`,e,t)}catch(e){BS.error("error parsing message",{error:e})}}}))}get id(){return Qt(this,Nk)}get serverId(){return Qt(this,xk)}get connected(){return Qt(this,Gk)}get isConnected(){return Qt(this,qk)}get datachannels(){return Qt(this,Hk)}get eventsDCReady(){return Qt(this,$k)}get closed(){return Qt(this,Lk)}get direction(){return Qt(this,jk)}get handler(){return Qt(this,Fk)}get connectionState(){return Qt(this,Vk)}get appData(){return Qt(this,Yk)}setServerId(e){Zt(this,xk,e)}getDatachannel(e){return Qt(this,Hk).get(e)}close(){Qt(this,Lk)||(BS.debug("close()"),Zt(this,Gk,!1),Zt(this,Lk,!0),Qt(this,Fk).close(),Array.from(Qt(this,Bk).values()).forEach((e=>{e.close(Ok).catch((()=>{}))})),Qt(this,Bk).clear(),Array.from(Qt(this,Wk).values()).forEach((e=>{e.close(Ok)})),Qt(this,Wk).clear(),Qt(this,Kk).clear(),Qt(this,zk).clear(),this.emit("close"),this.observer.emit("close"))}getStats(){return tr(this,null,(function*(){if(Qt(this,Lk))throw new Ck("closed");return Qt(this,Fk).getTransportStats()}))}connect(){return tr(this,null,(function*(){try{const{offerSdp:e,callback:t}=yield Qt(this,Fk).connect(),{answer:r}=yield this.safeEmitAsPromise("connect",{offer:e});if(yield t(r),!(yield this.isConnected))throw new Error("ice connection failed")}catch(e){throw BS.error("transport failed to connect:",e),e}}))}restartIce(){return tr(this,null,(function*(){if(BS.debug("restartIce()"),Qt(this,Lk))throw new Ck("closed");return Qt(this,Fk).restartIce()}))}updateIceServers(){return tr(this,arguments,(function*({iceServers:e}={}){if(BS.debug("updateIceServers()"),Qt(this,Lk))throw new Ck("closed");return Qt(this,Fk).updateIceServers(e)}))}produce(){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,stopTracks:i=!0,disableTrackOnPause:n=!0,zeroRtpOnPause:s=!1,appData:o={}}={}){if(BS.debug(`produce() [track:${e.id}]`),!e)throw new TypeError("missing track");if("send"!==Qt(this,jk))throw new Rk("not a sending Transport");if("ended"===e.readyState)throw new Ck("track ended");if(0===this.listenerCount("connect")&&"new"===Qt(this,Vk))throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");if(!(yield this.isConnected))return Promise.reject(new Error("Transport not connected"));const{producerId:a,localId:c}=yield this.awaitQueue.push((()=>tr(this,null,(function*(){const{offerSdp:i,callback:s}=yield Qt(this,Fk).send({track:e,encodings:t,codecOption:r,screenShare:null==o?void 0:o.screenShare}),{answer:a,producerId:c}=yield this.safeEmitAsPromise("produce",{offer:i,kind:e.kind,paused:!!n&&!e.enabled,appData:o});return{producerId:c,localId:yield s(a)}}))),"producer"),d=new Ak({id:a,localId:c,track:e,stopTracks:i,disableTrackOnPause:n,zeroRtpOnPause:s,appData:o,handler:this.handler});return Qt(this,Bk).set(a,d),d.observer.on("close",(()=>{Qt(this,Bk).delete(d.id)})),this.emit("newproducer",d),this.observer.emit("newproducer",d),d}))}consumePeer(e){return tr(this,arguments,(function*(e,t={}){if(BS.debug(`consumePeer() producingPeerId: ${e}`),Qt(this,Lk))throw new Ck("closed");if("recv"!==Qt(this,jk))throw new Rk("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing producingPeerId");if(0===this.listenerCount("connect")&&"new"===Qt(this,Vk))throw new TypeError('no "connect" listener set into this transport');if(t&&"object"!=typeof t)throw new TypeError("if given, appData must be an object");if(!(yield this.isConnected))return Promise.reject(new Error("Transport not connected"));const r=[],{consumersMap:i}=yield this.safeEmitAsPromise("consume_peer",{producingPeerId:e});return i.forEach(((i,n)=>{const{consumerId:s,trackId:o,screenShare:a,paused:c,streamId:d,kind:l}=i;r.push(Dk((r=>tr(this,null,(function*(){return r>0&&BS.warn("retrying consumer creation task:",{consumer:{id:s,kind:l,appData:{screenShare:a}}}),er(this,Xk,Zk).call(this,{consumerId:s,trackId:o,streamId:d,kind:l,producerId:n,producingPeerId:e,paused:c,screenShare:a,appData:t})})))))})),Mk(r)}))}consume(e){return tr(this,arguments,(function*({producerId:e,producingPeerId:t,appData:r={}}){if(BS.debug("consume()"),Qt(this,Lk))throw new Ck("closed");if("recv"!==Qt(this,jk))throw new Rk("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing producerId");if(0===this.listenerCount("connect")&&"new"===Qt(this,Vk))throw new TypeError('no "connect" listener set into this transport');if(r&&"object"!=typeof r)throw new TypeError("if given, appData must be an object");if(!(yield this.isConnected))return Promise.reject(new Error("Transport not connected"));try{const{consumerId:i,screenShare:n,trackId:s,paused:o,streamId:a,kind:c}=yield this.safeEmitAsPromise("consume",{producerId:e,producingPeerId:t});return yield Dk((d=>tr(this,null,(function*(){return d>0&&BS.warn("retrying consumer creation task:",{consumer:{id:i,kind:c,appData:{screenShare:n}}}),er(this,Xk,Zk).call(this,{consumerId:i,screenShare:n,trackId:s,streamId:a,kind:c,paused:o,producerId:e,producingPeerId:t,appData:r})}))))}catch(e){throw BS.error("consume failed:",e),e}}))}setRemoteOffer(e){return tr(this,null,(function*(){yield er(this,eR,tR).call(this,e);const t=yield Qt(this,Fk).pc.createAnswer(),r=g.qg(t.sdp);return r.media=r.media.map((e=>{if("audio"===e.type){const t=qt({},e),r=t.fmtp.find((e=>111===e.payload));return r&&(r.config+=";stereo=1;sprop-stereo=1"),t.rtcpFb||(t.rtcpFb=[]),t.rtcpFb.some((e=>"nack"===e.type))||t.rtcpFb.push({payload:parseInt(t.payloads,10),type:"nack"}),t}return e})),t.sdp=g.M9(r),yield er(this,rR,iR).call(this,t),t}))}retryFailedConsumerCreationTasks(e){return tr(this,null,(function*(){return Mk(e.map((e=>tr(this,null,(function*(){return Dk((t=>tr(this,null,(function*(){return t>0&&BS.warn(`retrying failed consumer creation task: ${JSON.stringify(e)}`),er(this,Xk,Zk).call(this,qt({},e))}))))})))))}))}_ontrack(e){const{track:t,transceiver:r,streams:i}=e;BS.info(`track event received [trackId: ${t.id}]`);const n=`${i[0].id}:${t.kind}`;t.addEventListener("ended",(()=>{BS.info(`rtc consumer track ended [trackId: ${t.id}]`),Qt(this,Kk).delete(t.id),Qt(this,Jk).delete(n)})),Qt(this,Kk).set(t.id,[t,r]);const s=Qt(this,zk).get(n);s?(s(t,r),Qt(this,zk).delete(n)):(BS.warn(`track event handler not found ${n}`),Qt(this,Jk).set(n,e))}}Nk=new WeakMap,xk=new WeakMap,Lk=new WeakMap,jk=new WeakMap,Uk=new WeakMap,Fk=new WeakMap,Vk=new WeakMap,Bk=new WeakMap,Wk=new WeakMap,Hk=new WeakMap,Gk=new WeakMap,$k=new WeakMap,qk=new WeakMap,zk=new WeakMap,Jk=new WeakMap,Kk=new WeakMap,Yk=new WeakMap,Qk=new WeakMap,Xk=new WeakSet,Zk=function(e){return tr(this,arguments,(function*({consumerId:e,producerId:t,producingPeerId:r,streamId:i,trackId:n,paused:s,screenShare:o,appData:a,kind:c}){const d=`${i}:${c}`,l={consumerId:e,producerId:t,producingPeerId:r,streamId:i,trackId:n,appData:a,kind:c,paused:s,screenShare:o,name:"consumer creation task error",message:"consumer creation failed"};return new Promise(((i,n)=>{const u=setTimeout((()=>{Qt(this,zk).delete(d),l.isTimedout=!0,n(l)}),5e3),p=(d,p)=>{try{if("ended"===d.readyState)clearTimeout(u),n(l);else{const n=d;n.enabled=!0,this.handler.midTransceiverMap.set(p.mid,p);const l=new Ik({id:e,localId:p.mid,track:n,paused:s,producerId:t,producingPeerId:r,handler:Qt(this,Fk),appData:zt(qt({},a),{screenShare:o}),reuseTrack:!0});Qt(this,Wk).set(e,l),l.once("close",(()=>{Qt(this,Wk).delete(l.id),this.handler.midTransceiverMap.delete(p.mid)})),BS.info("consumer created for ",{consumer:{id:e,kind:c,appData:{screenShare:o},peerId:r,producerId:t}}),this.observer.emit("newconsumer",l),clearTimeout(u),i(l)}}catch(e){BS.warn("error while creating consumer:",e),clearTimeout(u),n(l)}},h=Qt(this,Kk).get(e);if(2===(null==h?void 0:h.length))return void p(h[0],h[1]);const m=Qt(this,Jk).get(d);m?(Qt(this,Jk).delete(d),p(m.track,m.transceiver)):Qt(this,zk).set(d,p)}))}))},eR=new WeakSet,tR=function(e){return tr(this,null,(function*(){yield Qt(this,Fk).pc.setRemoteDescription(e)}))},rR=new WeakSet,iR=function(e){return tr(this,null,(function*(){BS.debug(`${this.direction}() {transportId: ${Qt(this,xk)}} | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),yield Qt(this,Fk).pc.setLocalDescription(e)}))};class oR{constructor({handlerName:e,handlerFactory:t}={}){if(Kt(this,"_handlerFactory"),Kt(this,"_handlerName"),Kt(this,"_observer"),BS.debug("constructor()"),e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)BS.debug(`Device::constructor() | handler given: ${e}`);else{if(e=function(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void BS.warn("Device::this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(BS.debug("Device::this._detectDevice() | ReactNative handler chosen"),"Chrome74");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)BS.warn("Device::this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=f().getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=110"}))return"Firefox110";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}})||t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}BS.warn("Device::this._detectDevice() | browser not supported")}}(),!e)throw new Error("device not supported");BS.debug(`Device::constructor() | detected handler: ${e}`)}switch(e){case"Chrome74":this._handlerFactory=bk.createFactory();break;case"Safari12":this._handlerFactory=kk.createFactory();break;case"Firefox60":this._handlerFactory=wk.createFactory({supportsSendEncodings:!1});break;case"Firefox110":this._handlerFactory=wk.createFactory({supportsSendEncodings:!0});break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const r=this._handlerFactory();this._handlerName=r.name,r.close(),this._observer=new ir}get handlerName(){return this._handlerName}createSendTransport({iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:i,appData:n,config:s}){return BS.debug("Device::createSendTransport()"),this._createTransport({direction:"send",iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:i,appData:n,config:s})}createRecvTransport({iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:i,appData:n}){return BS.debug("Device::createRecvTransport()"),this._createTransport({direction:"recv",iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:i,appData:n})}_createTransport({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:i,proprietaryConstraints:n,appData:s,config:o}){const a=u(),c=new sR({id:a,direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:i,proprietaryConstraints:n,appData:s,handlerFactory:this._handlerFactory,config:o});return this._observer.emit("newtransport",c),c}}class aR{constructor(e){Xt(this,nR,void 0),Zt(this,nR,e)}joinRoom(e,t,r=!1,i=null){return tr(this,null,(function*(){const n={roomUuid:e,displayName:t,prejoined:r};return i&&(n.location=i),(yield Qt(this,nR).sendMessagePromiseWithTimeout({event:Zw.joinRoom,protobuf:EE.toBinary(n),timeout:5e3})).payload}))}connectTransport(e){return tr(this,null,(function*(){const t=(yield Qt(this,nR).sendMessagePromise(Zw.createWebRTCTransport,pE.toBinary(e))).payload,{transportId:r,description:i}=hE.fromBinary(t);return{transportId:r,answer:{sdp:null==i?void 0:i.sdp,type:i.type}}}))}produce(e){return tr(this,null,(function*(){var t,r;const i=(yield Qt(this,nR).sendMessagePromise(Zw.produce,kE.toBinary(e))).payload,n=$E.fromBinary(i);return{answer:{sdp:null==(t=null==n?void 0:n.description)?void 0:t.sdp,type:null==(r=null==n?void 0:n.description)?void 0:r.type},producerId:n.producerId}}))}consume(e){return tr(this,null,(function*(){const t=(yield Qt(this,nR).sendMessagePromise(Zw.consume,wE.toBinary(e))).payload,{consumerIdsMap:{map:r}}=GE.fromBinary(t);return r}))}closeProducer(e){return tr(this,null,(function*(){const t=(yield Qt(this,nR).sendMessagePromise(Zw.closeProducer,IE.toBinary(e))).payload,{description:r}=qE.fromBinary(t);return r}))}closeConsumer(e){return tr(this,null,(function*(){return(yield Qt(this,nR).sendMessagePromise(Zw.closeConsumer,PE.toBinary(e))).payload}))}hostControlForPeer(e,t){return tr(this,null,(function*(){const r={audio:"audio"===t,screeShare:!1,video:"video"===t,participantId:e},i=(yield Qt(this,nR).sendMessagePromise(Zw.hostControlPeer,NE.toBinary(r))).payload;if(!i)return!1;const{status:n}=KE.fromBinary(i);return"success"===n}))}hostControlForAll(e){return tr(this,null,(function*(){const t={audio:"audio"===e,screenShare:!1,video:"video"===e},r=(yield Qt(this,nR).sendMessagePromise(Zw.hostControlAllPeers,xE.toBinary(t))).payload;if(!r)return!1;const{status:i}=YE.fromBinary(r);return"success"===i}))}kickAll(){return tr(this,null,(function*(){const e=(yield Qt(this,nR).sendMessagePromise(Zw.kickAll,ME.toBinary({}))).payload;if(!e)return!1;const{status:t}=JE.fromBinary(e);return"success"===t}))}kickPeer(e){return tr(this,null,(function*(){const t=(yield Qt(this,nR).sendMessagePromise(Zw.kickPeer,DE.toBinary(e))).payload;if(!t)return!1;const{status:r}=zE.fromBinary(t);return"success"===r}))}changeDisplayName(e){return tr(this,null,(function*(){const t=(yield Qt(this,nR).sendMessagePromise(Zw.changeDisplayName,OE.toBinary(e))).payload;if(!t)return!1;const{status:r}=QE.fromBinary(t);return"success"===r}))}notifySelfJoinComplete(){return tr(this,null,(function*(){const e=(yield Qt(this,nR).sendMessagePromise(Zw.selfJoinComplete,TE.toBinary({}))).payload;return WE.fromBinary(e)}))}}nR=new WeakMap;const cR=Error("task execution aborted");class dR{constructor(e,t){Kt(this,"id"),Kt(this,"executor"),Kt(this,"cancel"),this.id=e,this.executor=t}execute(){return tr(this,null,(function*(){return new Promise(((e,t)=>{this.cancel=()=>t(cR),this.executor.then((t=>e(t)))}))}))}}let lR=0;const uR=new Map;class pR{static execute(e){const t=lR;lR+=1;const r=new dR(t,e);return uR.set(t,r),{id:t,value:r.execute().finally((()=>uR.delete(t)))}}static stop(e){const t=uR.get(e);t&&(t.cancel(),uR.delete(e))}}class hR extends Sk{constructor(e){super(),Kt(this,"_device"),Kt(this,"_sendTransport"),Kt(this,"_recvTransport"),Kt(this,"_consumers"),Kt(this,"_producers"),Kt(this,"_producerStatus"),Kt(this,"_producerIdToConsumerIdMap"),Kt(this,"_socket"),Kt(this,"_socketHandler"),Kt(this,"_totalTransportReconnectionCount"),Kt(this,"_transportReconnectFailureCount"),Kt(this,"_consumerCreationFailureCount"),Kt(this,"_producerNotReadyFailureCount"),Kt(this,"_consumerNotBoundFailureCount"),Kt(this,"_transportDisconnectedTimer"),Kt(this,"transportConnectionStatus"),this._device=new oR({}),this._socket=e,this._socketHandler=new aR(e),this.reset()}get socket(){return this._socket}get producers(){return this._producers}get consumers(){return this._consumers}get producerIdToConsumerIdMap(){return this._producerIdToConsumerIdMap}get hiveSocketHandler(){return this._socketHandler}get sendTransport(){return this._sendTransport}get recvTransport(){return this._recvTransport}reset(){this._producers=new Map,this._consumers=new Map,this._producerStatus=new Map,this._producerIdToConsumerIdMap=new Map,this.transportConnectionStatus=new Map,this._transportReconnectFailureCount=0,this._consumerCreationFailureCount=0,this._totalTransportReconnectionCount=0,this._producerNotReadyFailureCount=0,this._consumerNotBoundFailureCount=0,this._transportDisconnectedTimer={consuming:void 0,producing:void 0}}setupTransports(e,t){return tr(this,null,(function*(){const r=yield qw().getICEServers().catch((e=>(BS.warn(`failed to get iceservers from server: ${e.message}`),[]))),i=e.map((e=>{var i,n,s,o,a,c;const d=this.transportConnectionStatus.get(e);if(d&&!t)return d;switch(d&&t&&pR.stop(d.id),e){case"send":{const t=pR.execute(this.createSendTransport({iceServers:r,config:{enableHighBitrate:null!=(s=null==(n=null==(i=td.defaults.mediaConfiguration)?void 0:i.audio)?void 0:n.enableHighBitrate)&&s,enableStereo:null!=(c=null==(a=null==(o=td.defaults.mediaConfiguration)?void 0:o.audio)?void 0:a.enableStereo)&&c}}));return this.transportConnectionStatus.set(e,t),t.value}case"recv":{const t=pR.execute(this.createRecvTransport({iceServers:r}));return this.transportConnectionStatus.set(e,t),t.value}default:return BS.warn(`What are you thinking when passing this transportType: ${e}?`,{transport:{type:e}}),Promise.reject(Error("TYPE_OF_TRANSPORT_UNKNOWN"))}}));return Promise.all(i).finally((()=>{e.forEach((e=>{this.transportConnectionStatus.delete(e)}))}))}))}stopAllTransports(){var e,t,r,i;BS.info(" closing all the transports"),null==(e=this._sendTransport)||e.close(),null==(t=this._sendTransport)||t.removeAllListeners(),null==(r=this._recvTransport)||r.close(),null==(i=this._recvTransport)||i.removeAllListeners(),this._sendTransport=void 0,this._recvTransport=void 0,this.reset()}createSendTransport(e){return tr(this,null,(function*(){var t,r,i,n,s,o,a;if(this._sendTransport&&this._sendTransport.connected)return void BS.info("sendTransport::already_exists_in_connected_state",{transport:{id:null==(t=this._sendTransport)?void 0:t.id,type:"send"}});BS.info("sendTransport::initializing_transport",{transport:{id:null==(r=this._sendTransport)?void 0:r.id,type:"send"}});const c=this._device.createSendTransport(e);this._transportDisconnectedTimer.producing=void 0,BS.info("sendTransport::initialized_transport",{transport:{id:null==(i=this._sendTransport)?void 0:i.id,type:"send"}}),this.handleTransport(c,!1),BS.info("sendTransport::connecting_transport",{transport:{id:null==(n=this._sendTransport)?void 0:n.id,type:"send"}});try{yield Dk(((e,t)=>tr(this,null,(function*(){this.socket.isConnected||t(new Error("socket is not connected")),"closed"===c.connectionState&&t(new Error("transport is closed")),e>0&&BS.debug(`retrying transport connect, count: ${e}`,{transport:{id:c.id,type:"send"}});try{yield c.connect()}catch(e){throw BS.error(`failed to connect send transport: ${c.id}`,{error:e,transport:{id:c.id,type:"send"}}),"ice connection failed"===e.message&&t(e),e}}))),{delayTime:100,strategy:"exponential",maxRetryCount:Ci.hasFeature(DS.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),BS.info("sendTransport::connected_transport",{transport:{id:null==(s=this._sendTransport)?void 0:s.id,serverId:null==(o=this._sendTransport)?void 0:o.serverId,type:"send"}}),this._transportReconnectFailureCount=Math.max(0,this._transportReconnectFailureCount-1),this._producerNotReadyFailureCount=0,this._sendTransport=c,fi.onSafeInitialization((()=>{fi.configureSendTransport(c)}))}catch(e){throw BS.error(`failed to connect send transport after retry:${c.id}`,{error:e,transport:{id:null==(a=this._sendTransport)?void 0:a.id,type:"send"}}),c.close(),c.removeAllListeners(),this._transportReconnectFailureCount+=1,this.handleFailure(),e}}))}createRecvTransport(e){return tr(this,null,(function*(){var t,r;if(this._recvTransport&&this._recvTransport.connected)return void BS.info("recvTransport::already_exists_in_connected_state",{transport:{id:null==(t=this._recvTransport)?void 0:t.id,type:"recv"}});BS.info("recvTransport::initializing_transport",{transport:{id:null==(r=this._recvTransport)?void 0:r.id,type:"recv"}});const i=this._device.createRecvTransport(zt(qt({},e),{additionalSettings:{rtcAudioJitterBufferMaxPackets:25,rtcAudioJitterBufferFastAccelerate:!0,rtcAudioJitterBufferMinDelayMs:20}}));this._transportDisconnectedTimer.consuming=void 0,BS.info("recvTransport::initialized_transport",{transport:{id:null==i?void 0:i.id,type:"recv"}}),this.handleTransport(i,!0),BS.info("recvTransport::connecting_transport",{transport:{id:null==i?void 0:i.id,type:"recv"}});try{yield Dk(((e,t)=>tr(this,null,(function*(){this.socket.isConnected||t(new Error("socket is not connected")),"closed"===i.connectionState&&t(new Error("transport is closed")),e>0&&BS.debug(`retrying transport connect, count: ${e}`,{transport:{id:null==i?void 0:i.id,type:"recv"}});try{yield i.connect()}catch(e){throw BS.error(`fail to connect recv transport: ${i.id}`,{error:e,transport:{id:null==i?void 0:i.id,type:"recv"}}),"ice connection failed"===e.message&&t(e),e}}))),{delayTime:100,strategy:"exponential",maxRetryCount:Ci.hasFeature(DS.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),BS.info("recvTransport::connected_transport",{transport:{id:null==i?void 0:i.id,serverId:null==i?void 0:i.serverId,type:"recv"}}),this._transportReconnectFailureCount=Math.max(0,this._transportReconnectFailureCount-1),this._consumerCreationFailureCount=0,this._consumerNotBoundFailureCount=0,this.producerIdToConsumerIdMap.clear(),this._recvTransport=i,fi.onSafeInitialization((()=>{fi.configureRecvTransport(i)}))}catch(e){throw BS.error(`failed to connect recv transport after retry:${i.id}`,{error:e,transport:{id:null==i?void 0:i.id,type:"recv"}}),i.close(),i.removeAllListeners(),this._transportReconnectFailureCount+=1,this.handleFailure(),e}}))}handleTransport(e,t){e.on("connect",((r,i,n)=>tr(this,[r,i,n],(function*({offer:r},i,n){try{const n={consuming:t,description:{sdp:r.sdp,type:r.type,target:t?dE.SUBSCRIBER:dE.PUBLISHER}},{transportId:s,answer:o}=yield this._socketHandler.connectTransport(n);e.setServerId(s),i({answer:o})}catch(r){BS.error((t?"consumer":"producer")+" transport connection error:",{error:r,transport:{id:null==e?void 0:e.id,type:t?"recv":"send"}}),n(r)}})))),e.on("connectionstatechange",(r=>tr(this,null,(function*(){BS.info((t?"consumer":"producer")+" transport connectionState:",{transport:{id:null==e?void 0:e.id,type:t?"recv":"send",status:r}});const i=()=>{void 0!==this._transportDisconnectedTimer[t?"consuming":"producing"]&&(clearTimeout(this._transportDisconnectedTimer[t?"consuming":"producing"]),this._transportDisconnectedTimer[t?"consuming":"producing"]=void 0)};switch(r){case"connected":i();break;case"disconnected":this._transportDisconnectedTimer[t?"consuming":"producing"]=setTimeout((()=>{this.triggerTransportReconnection(e,t)&&tE.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:r,transportDirection:t?"recv":"send"})}),2e3);break;case"failed":if(e.closed)return;i(),this.triggerTransportReconnection(e,t)||tE.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:r,transportDirection:t?"recv":"send"});break;case"new":case"closed":break;default:tE.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:r,transportDirection:t?"recv":"send"})}})))),e.on("icecandidate",(e=>tr(this,null,(function*(){BS.debug("sending icecandidate:",{iceCandidate:e})})))),e.on("datachannel:events",((t,r)=>tr(this,null,(function*(){var i,n;BS.debug("got data channel message on event:",{rtcChannel:{label:t.label,message:r}});try{switch(r.type){case"offer":this.negotiateOverDC(r.payload,t,e);break;case"handshake":t.send(JSON.stringify({type:"handshake",payload:{message:"pong"}}));break;case"consumer_toggle":this.handleConsumerToggle(r.payload);break;case"hub-disconnect":BS.debug(`media hub disconnected, full_reconnect: ${null==(i=r.payload)?void 0:i.full_reconnect}`),!0===(null==(n=r.payload)?void 0:n.full_reconnect)&&this.emit("rejoin");break;case"error":this.handleErrorOverDC(r.payload);break;default:BS.warn(`unknown event received from hive node, event: ${r.type}`)}}catch(e){BS.error(`Unable to handle the incoming datachannel message on channel ${t.label}`)}})))),e.on("dc_error",(()=>{"recv"===e.direction&&(BS.warn("events datachannel did not open in 5s"),this.handleFailure())})),e.on("negotiate",((t,r,i)=>tr(this,[t,r,i],(function*({description:t},r,i){try{const i={sdp:null==t?void 0:t.sdp,type:null==t?void 0:t.type};r({answer:yield this.negotiate(e,i)})}catch(t){BS.error("negotiate error:",{transport:{id:e.id,type:e.direction},error:t}),i(t)}})))),t?(e.on("datachannel:negotiation",((t,r)=>tr(this,null,(function*(){try{BS.info("datachannel message recieved:",{rtcChannel:{label:t.label,messageStringified:r}});const i={sdp:r,type:"offer"},n=yield e.setRemoteOffer(i);BS.info("datachannel answer:",{transport:{id:e.id,status:e.connectionState,remoteOfferAnswer:n}}),t.send(n.sdp)}catch(e){BS.error("datachannel:negotiation::Error:",{error:e})}})))),e.on("consume_peer",((e,t,r)=>tr(this,[e,t,r],(function*({producingPeerId:e},t,r){BS.info("consumePeer:",e);const i={producingPeerId:e};try{const r=yield this._socketHandler.consume(i);BS.debug(`consumePeer response for ${e}:`,{consumerStateMap:r});const n=new Map;Object.entries(r).forEach((([e,t])=>{var r,i,s;n.set(e,{consumerId:t.consumerId,trackId:null==(r=t.producerTrack)?void 0:r.trackId,streamId:t.producerTrack.streamId,kind:t.producerState.kind===lE.VIDEO?"video":"audio",screenShare:null==(i=t.producerState)?void 0:i.screenShare,paused:null==(s=t.producerState)?void 0:s.pause})})),t({consumersMap:n})}catch(e){BS.error("consumePeer error:",{error:e}),r(e)}})))),e.on("consume",((e,t,r)=>tr(this,[e,t,r],(function*({producerId:e,producingPeerId:t},r,i){var n,s,o,a,c,d,l,u;const p={producingPeerId:t,producerId:e};try{const t=(yield this._socketHandler.consume(p))[e];BS.info("consumer create response:",{consumer:{remotelyPaused:null==(n=t.producerState)?void 0:n.pause,producerId:null==(s=t.producerState)?void 0:s.producerId,kind:null==(a=null==(o=t.producerState)?void 0:o.kind)?void 0:a.toString(),appData:{screenShare:null==(c=t.producerState)?void 0:c.screenShare},id:t.consumerId},consumerState:t}),r({consumerId:t.consumerId,screenShare:null==(d=t.producerState)?void 0:d.screenShare,trackId:null==(l=t.producerTrack)?void 0:l.trackId,streamId:t.producerTrack.streamId,kind:t.producerState.kind===lE.VIDEO?"video":"audio",paused:null==(u=t.producerState)?void 0:u.pause})}catch(e){BS.error("error during consuming on server:",e),i(e)}}))))):e.on("produce",((e,t,r)=>tr(this,[e,t,r],(function*({offer:e,kind:t,paused:r,appData:i},n,s){var o;const a=g.qg(e.sdp).media.filter((e=>"video"===t?"video"===e.type:"audio"===e.type)).at(-1).msid,c={description:{sdp:e.sdp,type:e.type,target:dE.PUBLISHER},paused:r,kind:t,msid:a,screenShare:null!=(o=i.screenShare)&&o};try{const{answer:e,producerId:t}=yield this._socketHandler.produce(c);n({answer:e,producerId:t})}catch(e){BS.error("create producer error:",e),s(e)}}))))}createProducer(e,t,r){return tr(this,null,(function*(){if(void 0===this._sendTransport||this._sendTransport.closed)return null;BS.info("createProducer::initializing_producer",{producer:{id:"TO_BE_CREATED",kind:e,status:"initializing",appData:null==t?void 0:t.appData}});const i=this._producerStatus.get(e);if((null==i?void 0:i.trackId)===t.track.id&&(null==i?void 0:i.status)===_k.INITIALIZING)return BS.info("createProducer::producer getting initializing",{producer:{id:"GETTING_CREATED",status:"initializing",kind:e,appData:null==t?void 0:t.appData}}),null;this._producerStatus.set(e,{trackId:t.track.id,status:_k.INITIALIZING});try{const i=yield this._sendTransport.produce(t);return BS.info("createProducer::initialized_producer",{producer:{id:null==i?void 0:i.id,kind:e,status:"producing",appData:null==t?void 0:t.appData}}),i.on("close",((n,s)=>tr(this,[n,s],(function*({offer:n,reason:s},o){BS.info("producer::closing",{debuggingHint:s,producer:{id:null==i?void 0:i.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}});const a={producerId:i.id,description:{sdp:n.sdp,type:n.type,target:dE.PUBLISHER}};try{const e=yield this._socketHandler.closeProducer(a);o({answer:{sdp:null==e?void 0:e.sdp,type:null==e?void 0:e.type}})}catch(e){BS.error("producer close error",e)}BS.info("producer::closed",{producer:{id:null==i?void 0:i.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),this._producerStatus.delete(e),this._producers.delete(e),r(),this.reconfigureWebcamLayers()})))),i.on("trackended",(()=>{BS.info("producer::trackended",{producer:{id:null==i?void 0:i.id,kind:e,status:"UNKNOWN",appData:null==i?void 0:i.appData}}),[RS.MIC,RS.WEBCAM].includes(e)||r()})),this._producers.set(e,i),this._producerStatus.set(e,{trackId:t.track.id,status:_k.INITIALIZED}),this.reconfigureWebcamLayers(),i.track}catch(r){throw this._producerStatus.set(e,{status:_k.NOT_INITIALIZED,trackId:t.track.id}),BS.error("createProducer::transport_initialization_failed",{producer:{id:"FAILED_TO_CREATE",kind:e,status:"failed",appData:null==t?void 0:t.appData}}),r}}))}reconfigureWebcamLayers(){return tr(this,null,(function*(){if(!Ci.hasFeature(DS.DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE))return;const e=this.producers.get(RS.WEBCAM);e&&(yield this._switchProducerSpatialLayer(e,this.producers.get(RS.SCREENSHARE_VIDEO)?0:3))}))}_switchProducerSpatialLayer(e,t){return tr(this,null,(function*(){try{BS.debug("switching layer of webcam producer to:",{media:{video:{layer:t}},producer:{id:e.id,kind:e.kind,appData:e.appData}}),yield e.setMaxSpatialLayer(t)}catch(e){BS.error("failed to switch spatial layer",{error:e})}}))}_initConsumer(e){e&&(e.observer.on("close",(t=>tr(this,null,(function*(){BS.debug("consumer closed",{consumer:{closureReason:t,id:e.id,kind:e.kind,appData:e.appData}}),this._consumers.delete(e.id),tE.emit(XS.CONSUMER_CLOSED,{id:e.id})})))),this._consumers.set(e.id,e),this.producerIdToConsumerIdMap.set(e.producerId,e.id),tE.emit(XS.NEW_CONSUMER,{id:e.id}))}consumePeer(e){return tr(this,null,(function*(){if(void 0===this._recvTransport||this._recvTransport.closed||!this._recvTransport.connected)throw Error("Receiving transport not connected");yield Dk((t=>tr(this,null,(function*(){t>0&&BS.debug(`retrying consumePeer call, retryCount: ${t}`);try{const t=yield this._recvTransport.consumePeer(e),r=[];t.forEach((e=>{"rejected"===e.status?r.push(e.reason):this._initConsumer(e.value)})),this._recvTransport.retryFailedConsumerCreationTasks(r).then((e=>{e.forEach((e=>{"rejected"===e.status?(BS.error("consumer creation task is failing",e.reason),this._consumerCreationFailureCount+=1,setTimeout(this.handleFailure.bind(this),0)):this._initConsumer(e.value)}))}))}catch(e){throw BS.error("got error in consumePeer",e),e}})))).catch((e=>{BS.error("consumePeer failed after retries",e),this._consumerCreationFailureCount+=1,this.handleFailure()}))}))}createConsumer(e){return tr(this,null,(function*(){if(void 0===this._recvTransport||this._recvTransport.closed||!this._recvTransport.connected)return;const{producerId:t,producingPeerId:r,appData:i}=e,n=this.getProducer(t);n?BS.warn("why are you creating a consumer for local producer?"):yield Dk((e=>tr(this,null,(function*(){e>0&&BS.debug(`retrying createConsumer call, retryCount: ${e}`);const n=yield this._recvTransport.consume({producerId:t,producingPeerId:r,appData:zt(qt({},i),{peerId:r})});this._initConsumer(n)})))).catch((e=>{BS.error("createConsumer failed after retries",{producer:{id:t,kind:null==n?void 0:n.kind,appData:i},error:e}),this._consumerCreationFailureCount+=1,this.handleFailure()}))}))}pauseProducer(e){return tr(this,null,(function*(){const t=this._producers.get(e);t?(t.pause(),BS.info(`Paused the producer of type: ${t.kind}`,{producer:{id:t.id,kind:t.kind,appData:t.appData}})):BS.warn(`producer type: ${e} not found`)}))}resumeProducer(e){return tr(this,null,(function*(){const t=this._producers.get(e);t?(t.resume(),BS.info(`Resumed the producer of type: ${t.kind}`,{producer:{id:t.id,kind:t.kind,appData:t.appData}})):BS.warn(`producer type: ${e} not found`)}))}replaceTrack(e,t){return tr(this,null,(function*(){const r=this._producers.get(e);r?(yield r.replaceTrack({track:t}),BS.info(`Replaced track for the producer of type: ${r.kind}`,{producer:{id:r.id,kind:r.kind,appData:r.appData,trackId:t.id}})):BS.warn(`producer type: ${e} not found`)}))}removeProducer(e,t){return tr(this,null,(function*(){const r=this._producers.get(e);r?(t&&r.track.stop(),yield this.sendTransport.awaitQueue.push(r.close.bind(r),"producer").catch((e=>{BS.error("failed to close producer on server",e)}))):BS.warn(`producer type: ${e} not found`)}))}pauseConsumer(e){return tr(this,null,(function*(){const t=this._consumers.get(e);t?(this.toggleConsumerOverDC(e,!0),BS.info(`Paused the consumer of type: ${t.kind}`,{consumer:{id:t.id,kind:t.kind,appData:t.appData}})):BS.warn(`consumer with id: ${e} not found`)}))}pauseConsumerOverSocket(e){return tr(this,null,(function*(){try{const t={consumerId:e.id,pause:!0};yield this.socket.sendMessagePromise(Zw.toggleConsumer,AE.toBinary(t)),e.pause(),tE.emit(XS.CONSUMER_PAUSED,{id:e.id}),BS.info(`Paused the consumer of type: ${e.kind} over socket`,{consumer:{id:e.id,kind:e.kind,appData:e.appData}})}catch(t){BS.error("error on pausing consumer",{error:t,consumer:{id:e.id,kind:e.kind,appData:e.appData}})}}))}toggleConsumerOverDC(e,t){return tr(this,null,(function*(){const r={type:"consumer_toggle",payload:{consumerId:e,mute:t}},i=this._recvTransport.getDatachannel("events");i?i.send(JSON.stringify(r)):BS.warn("recvTransport:: events datachannel not found")}))}resumeConsumer(e){return tr(this,null,(function*(){const t=this._consumers.get(e);if(t)if(t.paused)try{const r={consumerId:e,pause:!1};yield this.socket.sendMessagePromise(Zw.toggleConsumer,AE.toBinary(r)),t.resume(),tE.emit(XS.CONSUMER_RESUMED,{id:t.id}),BS.info(`Resumed the consumer of type: ${t.kind}`,{consumer:{id:t.id,kind:t.kind,appData:t.appData}})}catch(e){BS.error("error on resuming consumer",e)}else BS.warn(`consumer with id:${e} is not paused so not resuming`);else BS.warn(`consumer with id: ${e} not found`)}))}closeConsumer(e,t){return tr(this,null,(function*(){return this.closeConsumers([e],t)}))}closeConsumers(e,t=!1){return tr(this,null,(function*(){BS.info(`Closing consumers: ${JSON.stringify(e)} with force: ${t}`);let r=!0;const i=e.filter((e=>!!this._consumers.get(e)||(BS.warn(`consumer with id: ${e} not found`),!1))),n={consumerIds:i},s=()=>tr(this,null,(function*(){var e;return null==(e=this._recvTransport)?void 0:e.awaitQueue.push((()=>tr(this,null,(function*(){yield this._socketHandler.closeConsumer(n)}))),"close_consumer").catch((e=>{BS.warn("error on closing consumer:",{error:e}),r=t}))}));t?s():yield s(),r&&i.forEach((e=>{const r=this.consumers.get(e);this.producerIdToConsumerIdMap.delete(r.producerId),r.close(t?"force closed":void 0)}))}))}cleanupConsumers(e){return tr(this,null,(function*(){BS.debug("cleaning up all consumers");const t=[];this._consumers.forEach((r=>{e?r.peerId===e&&t.push(r.id):t.push(r.id)})),this.closeConsumers(t,!0)}))}stopAllProducers(){return tr(this,null,(function*(){BS.info("stopping all available producers"),this._producers.forEach(((e,t)=>{BS.debug(`closing producer type: ${t}`,{producer:{id:null==e?void 0:e.id,kind:e.kind,appData:e.appData}}),e.close()}))}))}getProducer(e){return Array.from(this.producers.values()).filter((t=>t.id===e)).at(0)}hasProducer(e){return void 0!==this.getProducer(e)}negotiate(e,t){return tr(this,null,(function*(){BS.debug(`setting remote offer : ${JSON.stringify(t)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}});const r=yield e.setRemoteOffer(t),i={transportId:e.serverId,description:{sdp:r.sdp,type:r.type,target:dE.SUBSCRIBER}};return BS.debug(`sending renegotiate request: ${JSON.stringify(i)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}}),yield this.socket.sendMessagePromise(Zw.renegotiateSessionDescription,mE.toBinary(i)),BS.info("renegotiation done",{transport:{serverId:e.serverId}}),r}))}negotiateOverDC(e,t,r){return tr(this,null,(function*(){const i={sdp:e.sdp,type:"offer"};let n;try{const e=yield r.setRemoteOffer(i);n={type:"answer",payload:{type:e.type,sdp:e.sdp}}}catch(e){BS.error("datachannel:events::Error:",e),n={type:"error",payload:{error:e.message}}}BS.debug(`datachannel answer: ${JSON.stringify(n)}`),t.send(JSON.stringify(n))}))}handleConsumerToggle(e){const{mute:t,trackId:r}=e;BS.info(`consumer toggled for trackId: ${r} muted: ${t}`);const i=this.consumers.get(r);i?i.paused!==t&&(BS.debug("consumer state is not same",{consumer:{id:i.id,remotelyPaused:i.paused}}),t?(i.pause(),tE.emit(XS.CONSUMER_PAUSED,{id:i.id})):(i.resume(),tE.emit(XS.CONSUMER_RESUMED,{id:i.id}))):BS.warn(`consumer with trackId: ${r} not found`)}handleErrorOverDC(e){return tr(this,null,(function*(){BS.error(`got error over dc: ${JSON.stringify(e)}`);const{type:t,error:r,id:i}=e;if("consumer"===t){if("bind-fail"===r){if(this._consumerNotBoundFailureCount>=2)return void this.handleFailure();this._consumerNotBoundFailureCount+=1;const e=this.consumers.get(i);if(!e)return;try{yield this.closeConsumer(e.id),yield this.createConsumer({producerId:e.producerId,producingPeerId:e.peerId,appData:e.appData})}catch(t){BS.error("failed to recreate consumer on downtrack bound failure,",{consumer:{id:e.id,producerId:e.producerId,kind:e.kind,appData:e.appData}})}}}else if("producer"===t)if("ready-fail"===r){if(this._producerNotReadyFailureCount>=2)return void this.handleFailure();this._producerNotReadyFailureCount+=1;const[e]=Array.from(this.producers.entries()).find((e=>e[1].id===i));if(!e)return;yield this.removeProducer(e).catch((t=>{BS.error("failed to remove ready-fail producer:",{error:t,producer:{id:i,kind:e,appData:null}})}))}else"general-failure"===r&&this.emit("reconnect_transport",this._sendTransport)}))}handleFailure(){return tr(this,null,(function*(){var e;if(this._transportReconnectFailureCount>0||!1===(null==(e=this._recvTransport)?void 0:e.eventsDCReady)||this._totalTransportReconnectionCount>3)return BS.warn("transport failure detected"),void(Ci.hasFeature(DS.ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY)&&(BS.debug("rejoining room"),this.emit("rejoin")));(this._consumerCreationFailureCount>0||this._consumerNotBoundFailureCount>=2)&&(BS.warn("consumer creation failure detected or consumer not bound failure increased"),Ci.hasFeature(DS.ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY)&&(BS.debug("reconnecting recv transport"),this._totalTransportReconnectionCount+=1,this.emit("reconnect_transport",this._recvTransport))),this._producerNotReadyFailureCount>=2&&(BS.warn("producer receiver not getting added needs to reconnect send transport"),this._totalTransportReconnectionCount+=1,this.emit("reconnect_transport",this._sendTransport))}))}triggerTransportReconnection(e,t){return BS.info("triggerTransportReconnection:: reconnecting transport",{transport:{type:e.direction,id:e.id,serverId:e.serverId}}),!!Ci.hasFeature(DS.ENABLE_HIVE_TRANSPORT_RECONNECTION_ON_ICE_FAILED)&&(tE.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:"reconnecting",transportDirection:t?"recv":"send"}),this.emit("reconnect_transport",e),!0)}switchConsumersToLayer(e,t){return tr(this,null,(function*(){const r=this._recvTransport.getDatachannel("events");if(!r)return void BS.warn("events datachannel not found");const i={type:"switch_consumer_layer",payload:{consumerIds:e,layer:t}};r.send(JSON.stringify(i))}))}}var mR=Object.defineProperty,fR=Object.getOwnPropertyDescriptor,gR=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?fR(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&mR(t,r,s),s};const vR={joinAttempted:!1};var yR,_R,SR,ER,TR,bR,wR,kR,RR,CR,AR,IR,PR;const DR=(PR=class extends rk{constructor(e){super(),Xt(this,yR,void 0),Xt(this,_R,void 0),Xt(this,SR,void 0),Xt(this,ER,void 0),Xt(this,TR,void 0),Xt(this,bR,void 0),Xt(this,wR,void 0),Xt(this,kR,void 0),Xt(this,RR,void 0),Xt(this,CR,void 0),Xt(this,AR,void 0),Xt(this,IR,void 0),Kt(this,"legacyMode"),Kt(this,"roomNodeUrl"),Kt(this,"peerDisplayName"),Kt(this,"activatedProducingPeerIds");const{roomName:t,peerId:r,authToken:i,legacyMode:n,socketClient:s,meetingTitle:o}=e;this.roomName=t,this.peerId=r,this.authToken=i,this.legacyMode=n,this.roomJoined=!1,this.mediaConnected=!!s.isConnected,this.meetingTitle=o,Zt(this,ER,!1),Zt(this,yR,s),Zt(this,_R,new hR(s)),this.maxPreferredStreams=6,this.activatedProducingPeerIds=new Set,Zt(this,AR,new Set),Zt(this,TR,!1),Zt(this,bR,0),Zt(this,wR,new rc),fi.legacySwitch(n),this.handleSocketEvents(),this.handleSFUEvents(),this.handleCallstatsEvents(),Zt(this,SR,(()=>{BS.info("HiveNodeClient::noop reconnection handler")})),Zt(this,kR,Yh((()=>{Zt(this,ER,!0),this.reset(),Qt(this,wR).push((()=>this._joinRoom(this.peerDisplayName,this.roomUUID,{},!0,Qt(this,IR))),"joinRoom").then((()=>{tE.emit(XS.HIVE_ROOM_REJOINED)})).catch((()=>{tE.emit(XS.HIVE_ROOM_REJOIN_FAILED)}))}),5e3,{leading:!0,maxWait:1e3})),Zt(this,RR,Yh((e=>tr(this,null,(function*(){e.close(),e.removeAllListeners(),yield this.sfuHandler.setupTransports(["send"]),BS.info("send transport reconected!"),tE.emit(XS.RESET_PRODUCER_STATE)}))),1e3)),Zt(this,CR,Yh((e=>tr(this,null,(function*(){e.close(),e.removeAllListeners(),yield this.sfuHandler.setupTransports(["recv"]),BS.info("recv transport reconnected!"),this.activatedProducingPeerIds=new Set,tE.emit(XS.REFRESH_GRID,!0)}))),1e3))}static init(e){return tr(this,null,(function*(){const{legacyMode:t=!0,roomName:r,peerId:i,authToken:n,meetingTitle:s,socket:o}=e,a=new DR({legacyMode:t,authToken:n,socketClient:o,peerId:i,roomName:r,meetingTitle:s});o.onStateEvent("disconnected",(e=>{var t;a.isDisconnected=!0,null==(t=Qt(a,_R))||t.cleanupConsumers(),a.mediaConnected=o.isConnected,tE.emit(XS.ROOM_NODE_DISCONNECTED,e),a.roomJoined=!1,a.activatedProducingPeerIds=new Set,BS.info("HiveNodeClient::HIVE_NODE_DISCONNECTED")})),o.onStateEvent("reconnected",(()=>tr(this,null,(function*(){a.mediaConnected=o.isConnected}))));const c=e=>{a.mediaConnected=o.isConnected,tE.emit(XS.ROOM_NODE_CONNECTED,zt(qt({},e),{wasDisconnected:a.isDisconnected,wasJoinAttempted:vR.joinAttempted})),a.isDisconnected=!1,BS.info("HiveNodeClient::HIVE_NODE_CONNECTED")};return o.onStateEvent("connected",(e=>tr(this,null,(function*(){c(e)})))),o.isConnected&&c({}),a}))}get sfuHandler(){return Qt(this,_R)}set onSocketReconnection(e){Zt(this,SR,e)}get rejoinRoom(){return Qt(this,kR)}reset(){Qt(this,AR).clear(),this.activatedProducingPeerIds.clear(),Qt(this,wR).stop(),this.sfuHandler.stopAllTransports(),this.sfuHandler.reset(),Zt(this,wR,new rc)}reconnectTransport(e){return tr(this,null,(function*(){BS.info(`HiveNodeClient::Room joining state: ${Qt(this,ER)}`),e&&!Qt(this,ER)&&("send"===e.direction?yield Qt(this,RR).call(this,e):yield Qt(this,CR).call(this,e))}))}setupTransports(e=!1){return tr(this,null,(function*(){yield Qt(this,_R).setupTransports(["recv","send"],e)}))}joinRoom(e,t,r,i){return tr(this,arguments,(function*(e,t,r,i,n={}){vR.joinAttempted=!0,Zt(this,ER,!0),this.reset();const s=qw().ipInfo;if(null!=s&&s.loc){const e=s.loc.split(",");Zt(this,IR,{latitude:parseFloat(e[0]),longitude:parseFloat(e[1])})}return Qt(this,wR).push((()=>this._joinRoom(e,r,n,!1,Qt(this,IR))),"joinRoom")}))}_joinRoom(e,t){return tr(this,arguments,(function*(e,t,r={},i=!1,n=null){this.peerDisplayName=e;try{return yield Dk(((r,s)=>(Qt(this,yR).isConnected||s(new Error("socket is not connected")),r>0&&BS.warn(`retrying sending join room request, count: ${r}`),this.sfuHandler.hiveSocketHandler.joinRoom(t,e,i,n).catch((e=>{throw BS.error("failed to send join room request, error:",{error:e}),e})))),{delayTime:1e3,strategy:"exponential",maxRetryCount:Ci.hasFeature(DS.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),yield this.setupTransports(!0),Ci.hasFeature(DS.INTERNAL_CALL_STATS)&&"ReactNative"!==navigator.product&&setTimeout((()=>tr(this,null,(function*(){var i;const n=yield qw().getUserDetails(),s=Sw.isV2AuthToken?n.participant:n,o={userId:null!=(i=s.id)?i:s.participant.id,peerId:this.peerId,displayName:e,roomUUID:t,roomViewType:"groupCall",roomName:this.roomName,deviceInfo:zt(qt({},_S.getDeviceInfo()),{userAgent:navigator.userAgent,memory:navigator.deviceMemory,cpus:navigator.hardwareConcurrency}),sdkName:nd,sdkVersion:id,metaData:{},permissions:{}};fi.roomJoined(o),null!=r&&r.audio?fi.audioOn():fi.audioOff(),null!=r&&r.video?fi.videoOn():fi.videoOff()})))),{roomJoined:yield this.completeJoinRoom()}}catch(e){return BS.error("error on sending join room request",{error:e}),{roomJoined:!1}}}))}completeJoinRoom(){return tr(this,null,(function*(){try{let e=Ob.create();try{const t=yield Qt(this,yR).sendMessagePromise(Jw.getRoomStageState);t.payload&&(e=Ob.fromBinary(t.payload))}catch(e){throw BS.error("getRoomStageState::binary_decode_error",{error:e}),new qS("Unable to get stage status of participants")}const{maxPreferredStreams:t,participants:r,roomState:i,selectedPeers:n}=yield this.sfuHandler.hiveSocketHandler.notifySelfJoinComplete();this.roomUUID=i.roomUuid,this.maxPreferredStreams=null!=t?t:6;const s=r.map((t=>{const r=t.producerStates,i={id:t.peerId,isHost:!1,displayName:t.displayName,flags:{},userId:t.userId,audioMuted:!0,videoEnabled:!1,audioTrack:null,videoTrack:null,producers:[]};let n=OI.OFF_STAGE;return e.approvedStagePeers.includes(i.userId)&&(n=OI.ACCEPTED_TO_JOIN_STAGE),e.requestedStagePeers.includes(i.userId)&&(n=OI.REQUESTED_TO_JOIN_STAGE),e.onStagePeers.includes(i.userId)&&(n=OI.ON_STAGE),i.stageStatus=n,r.forEach((e=>{e.kind!==lE.AUDIO||e.screenShare?e.kind===lE.VIDEO&&!e.screenShare&&(i.videoEnabled=!e.pause):i.audioMuted=e.pause,i.producers.push({producerId:e.producerId,kind:e.kind===lE.AUDIO?"audio":"video",pause:e.pause,screenShare:e.screenShare})})),i})),{audioPeers:o,compulsoryPeers:a}=null!=n?n:{},c=s.filter((e=>e.id!==this.peerId));return Zt(this,ER,!1),Zt(this,TR,!0),this.roomJoined=!0,this.mediaConnected=Qt(this,yR).isConnected,BS.info("HiveNodeClient::joinRoom::pre_emitasync_room_joined"),yield tE.emitAsync(XS.ROOM_JOINED,{peers:c}),0!==i.pinnedPeerIds.length&&tE.emit(XS.PEER_PINNED,{peerId:i.pinnedPeerIds[0]}),BS.info("HiveNodeClient::joinRoom::post_emitasync_room_joined"),tE.emit(XS.SELF_ROOM_JOINED),tE.emit(XS.SELECTED_PEERS,{peerIds:null!=o?o:[],compulsoryPeers:a}),tE.emit(XS.REFRESH_GRID,!0),!0}catch(e){return BS.error("error on completing join room:",{error:e}),!1}}))}leaveRoom(){return tr(this,null,(function*(){Qt(this,_R).stopAllTransports(),Zt(this,TR,!1),vR.joinAttempted=!1,Qt(this,yR).sendMessagePromise(Zw.leaveRoom,bE.toBinary({closeRoom:!1})).then((e=>{var t;(null==(t=HE.fromBinary(e.payload))?void 0:t.closed)||BS.warn("weird state on peer closed and should not happen")})).catch((e=>{BS.error("error on sending leave room request",{error:e})})),fi.callEnded(),VS.destruct()}))}getConsumers(){return Qt(this,_R).consumers}activatePeers(e){return tr(this,null,(function*(){const t=e.map((({peerId:e,producers:t,force:r})=>{if(0===t.length)return Promise.resolve();if(r)return this.consumePeer(e,r);const i=[];return t.every((e=>{const t=this.sfuHandler.producerIdToConsumerIdMap.get(e.producerId);if(!t)return!1;const r=this.sfuHandler.consumers.get(t);return r&&!e.pause&&r.paused&&i.push(t),!0}))?i.length>0?this.resumeConsumers(i):Promise.resolve():this.consumePeer(e)}));yield Promise.all(t)}))}deactivatePeers(e){return tr(this,null,(function*(){BS.info("deactivating producers"),e.producers.some((e=>e.screenShare&&"video"===e.kind))?BS.debug("peer is screensharing can't deactivate"):(e.producers.forEach((({producerId:e,kind:t})=>{if("audio"===t)return void BS.debug("we don't want to deactive audio consumers");const r=this.sfuHandler.producerIdToConsumerIdMap.get(e);r?this.sfuHandler.closeConsumer(r):BS.warn(`consumer not found in deactivate producers: ${e}`)})),this.activatedProducingPeerIds.delete(e.peerId))}))}createConsumer(e){return tr(this,arguments,(function*({producerId:e,producingPeerId:t,screenShare:r}){return this.sfuHandler.createConsumer({producerId:e,producingPeerId:t,appData:{screenShare:r}})}))}pauseConsumers(e){return tr(this,null,(function*(){e.forEach((e=>{this.sfuHandler.pauseConsumer(e)}))}))}resumeConsumers(e){return tr(this,null,(function*(){e.forEach((e=>{this.sfuHandler.resumeConsumer(e)}))}))}closeConsumers(e){return tr(this,null,(function*(){const t=Array.from(this.getConsumers().values()).filter((t=>e.includes(t.peerId))).map((e=>e.id));return e.forEach((e=>{this.activatedProducingPeerIds.delete(e)})),this.sfuHandler.closeConsumers(t)}))}consumePeer(e,t){return tr(this,null,(function*(){if(BS.info(`current activated Peer ids: ${JSON.stringify(Array.from(this.activatedProducingPeerIds.values()))}, forced?:${t}`),!this.activatedProducingPeerIds.has(e)||t)try{yield Qt(this,_R).consumePeer(e),this.activatedProducingPeerIds.add(e)}catch(e){BS.error("consumePeer failed in HiveNodeClient.ts",{error:e})}else BS.info(`not creating consumer for this peerId: ${e}`)}))}shareWebcam(e){return tr(this,null,(function*(){if(void 0===e)return null;if(Qt(this,_R).producers.has(RS.WEBCAM)){const t=Qt(this,_R).producers.get(RS.WEBCAM);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),yield this.resumeWebcam(),e;yield Qt(this,_R).removeProducer(RS.WEBCAM)}const t={track:e,codecOptions:{name:"VP8"},appData:{screenShare:!1},stopTracks:!1};if(Ci.hasFeature(DS.ENABLE_HIVE_SIMULCAST)){let r=e.getConstraints().width;r in wS||(r=320),t.encodings=wS[r]}return Qt(this,_R).createProducer(RS.WEBCAM,t,(()=>{this.disableWebcam()}))}))}shareScreen(e){return tr(this,null,(function*(){const{video:t,audio:r}=e;if(void 0===t)return;const i={track:t,codecOptions:{name:"VP8"},appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},stopTracks:!1};let n=()=>{this.disableScreenShare()};if(fi.screenShareRequested(),yield Qt(this,_R).createProducer(RS.SCREENSHARE_VIDEO,i,n),r){const e={track:r,codecOptions:{name:"opus"},appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},stopTracks:!1,zeroRtpOnPause:!0};n=()=>{},yield Qt(this,_R).createProducer(RS.SCREENSHARE_AUDIO,e,n)}}))}shareMic(e){return tr(this,null,(function*(){try{if(void 0===e)throw new Ck("track undefined");if(Qt(this,_R).producers.has(RS.MIC)){const t=Qt(this,_R).producers.get(RS.MIC);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),void(yield this.resumeMic());yield Qt(this,_R).removeProducer(RS.MIC,!1)}const t={track:e,encodings:[{priority:"high"}],codecOptions:{name:"opus"},stopTracks:!1,zeroRtpOnPause:!0},r=()=>{this.disableMic()};yield Qt(this,_R).createProducer(RS.MIC,t,r)}catch(e){throw new qS(e)}}))}pauseMic(){const e=Qt(this,_R).producers.get(RS.MIC);if(!e)return void BS.error("pauseMic::could_not_find_mic_producer");if(e.paused)return void BS.info("pauseMic::mic_producer_already_paused");e.pause();const t={producerId:e.id,pause:!0};Qt(this,yR).sendMessage(Zw.toggleProducer,CE.toBinary(t))}pauseWebcam(){return tr(this,null,(function*(){const e=Qt(this,_R).producers.get(RS.WEBCAM);if(!e)return void BS.error("pauseWebcam::could_not_find_webcam_producer");e.pause();const t={producerId:e.id,pause:!0};Qt(this,yR).sendMessage(Zw.toggleProducer,CE.toBinary(t))}))}resumeMic(){return tr(this,null,(function*(){const e=Qt(this,_R).producers.get(RS.MIC);if(!e)return void BS.error("resumeMic::could_not_find_mic_producer");if(!e.pause)return void BS.info("resumeMic::mic_producer_already_resumed");e.resume();const t={producerId:e.id,pause:!1};Qt(this,yR).sendMessage(Zw.toggleProducer,CE.toBinary(t))}))}resumeWebcam(){return tr(this,null,(function*(){const e=Qt(this,_R).producers.get(RS.WEBCAM);if(!e)return void BS.error("resumeWebcam::could_not_find_webcam_producer");e.resume();const t={producerId:e.id,pause:!1};Qt(this,yR).sendMessage(Zw.toggleProducer,CE.toBinary(t))}))}disableWebcam(){return tr(this,null,(function*(){yield Qt(this,_R).removeProducer(RS.WEBCAM)}))}disableMic(){return tr(this,null,(function*(){yield Qt(this,_R).removeProducer(RS.MIC)}))}disableScreenShare(){return tr(this,null,(function*(){BS.info("screen_sharing_stopped"),yield Qt(this,_R).removeProducer(RS.SCREENSHARE_VIDEO),yield Qt(this,_R).removeProducer(RS.SCREENSHARE_AUDIO),Qt(this,AR).clear()}))}muteSelf(){return tr(this,null,(function*(){this.pauseMic()}))}unmuteSelf(){return tr(this,null,(function*(){}))}resetVideoProducers(e,t){return tr(this,null,(function*(){e&&(yield Qt(this,_R).removeProducer(RS.WEBCAM,!1),this.shareWebcam(e)),t&&(yield Qt(this,_R).removeProducer(RS.SCREENSHARE_VIDEO,!1),this.shareScreen({video:t}))}))}getPolls(){return tr(this,null,(function*(){return{payload:{polls:{}}}}))}changeDisplayName(e,t){return tr(this,null,(function*(){const r={displayName:e,participantId:null!=t?t:this.peerId};if(!(yield this.sfuHandler.hiveSocketHandler.changeDisplayName(r)))throw new Error("failed to change display name!")}))}kick(e){return tr(this,null,(function*(){const t={participantId:e};if(!(yield this.sfuHandler.hiveSocketHandler.kickPeer(t)))throw new Error("failed to kickout the participant!")}))}kickAll(){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.kickAll()))throw new Error("failed to kickout all participant!")}))}muteAll(e){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForAll("audio")))throw new Error("failed to mute all participant")}))}muteAllVideo(){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForAll("video")))throw new Error("failed to mute all video participant")}))}disableAudio(e){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForPeer(e,"audio")))throw new Error("failed to mute given participant")}))}disableVideo(e){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForPeer(e,"video")))throw new Error("failed to mute video of given participant")}))}pinPeer(e){return tr(this,null,(function*(){const t={participantId:null!=e?e:""};try{yield Qt(this,yR).sendMessagePromise(Zw.globalPinPeer,RE.toBinary(t))}catch(e){BS.error("Error in pinning peer:",{error:e})}}))}validateScreenShare(e){return this.peerId===e.peerId&&this.sfuHandler.hasProducer(e.producerId)&&Qt(this,AR).add(e.consumerPeerId),Qt(this,AR).size}handleSocketEvents(){return tr(this,null,(function*(){Qt(this,yR).on(Zw.peerJoinedBroadcast,(({id:e,payload:t})=>{if(this.roomJoined)try{const{participant:{peerId:e,displayName:r,producerStates:i,userId:n}}=XE.fromBinary(t);if(e===this.peerId)return;const s={id:e,isHost:!1,displayName:r,flags:{},userId:n,audioMuted:!0,videoEnabled:!1,audioTrack:null,videoTrack:null,producers:[]};i.forEach((e=>{e.kind!==lE.AUDIO||e.screenShare?e.kind===lE.VIDEO&&!e.screenShare&&(s.videoEnabled=!e.pause):s.audioMuted=e.pause,s.producers.push({producerId:e.producerId,kind:e.kind===lE.AUDIO?"audio":"video",pause:e.pause,screenShare:e.screenShare})})),tE.emit(XS.PEER_JOINED,s)}catch(e){BS.error("error in peer-joined-broadcast",{error:e})}})),Qt(this,yR).on(Zw.peerProducerCreateBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t,producerState:r}=ZE.fromBinary(e);if(t===this.peerId)return;BS.info(`producer created broadcast: ${t}, producer state: ${r}`),tE.emit(XS.NEW_PRODUCER,{peerId:t,producer:{producerId:r.producerId,kind:r.kind===lE.AUDIO?"audio":"video",pause:r.pause,screenShare:r.screenShare}})}catch(e){BS.error("error in peer-producer-create-broadcast",{error:e})}})),Qt(this,yR).on(Zw.peerProducerToggleBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t,producerState:{kind:r,pause:i,producerId:n}}=eT.fromBinary(e),s=r===lE.AUDIO?"audio":"video";if(BS.info(`producer toggle broadcast: ${t}, producerId: ${n}, kind:${s}, paused:${i}`),t===this.peerId&&i)return void tE.emit("audio"===s?XS.MUTE_ALL:XS.MUTE_ALL_VIDEO);tE.emit(XS.PRODUCER_TOGGLE,{peerId:t,producerId:n,paused:i,kind:s}),[...this.getConsumers().values()].filter((e=>e.producerId===n)).forEach((e=>{e.paused!==i&&(BS.debug(`consumer state mismatched for ${e.id}. updating consumer pause state ${e.paused} to ${i}`),i?(e.pause(),tE.emit(XS.CONSUMER_PAUSED,{id:e.id})):(e.resume(),tE.emit(XS.CONSUMER_RESUMED,{id:e.id})))}))}catch(e){BS.error("error in producer toggle broadcast handler",{error:e})}})),Qt(this,yR).on(Zw.selectedPeer,(({payload:e})=>{if(this.roomJoined)try{const{audioPeers:t,compulsoryPeers:r}=FE.fromBinary(e);tE.emit(XS.SELECTED_PEERS,{peerIds:r.concat(t)})}catch(e){BS.error("error in selected-peer",{error:e})}})),Qt(this,yR).on(Zw.selectedPeerDiff,(({payload:e})=>{if(this.roomJoined)try{const{entries:t}=BE.fromBinary(e),r=t.map((e=>({peerId:e.peerId,priority:e.priority})));tE.emit(XS.SELECTED_PEERS_DIFF,{entries:r})}catch(e){BS.error("error in selected-peer-diff",{error:e})}})),Qt(this,yR).on(Zw.peerLeaveBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t}=rT.fromBinary(e);if(t===this.peerId)return;BS.info(`peer left broadcast:${t}`),Qt(this,AR).delete(t),this.sfuHandler.cleanupConsumers(t),tE.emit(XS.PEER_CLOSED,{id:t})}catch(e){BS.error("error in peer left broadcast",{error:e})}})),Qt(this,yR).on(Zw.peerProducerCloseBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t,producerState:{producerId:r}}=tT.fromBinary(e);if(t===this.peerId)return;BS.info(`producer closed broadcast:${t}`),tE.emit(XS.PRODUCER_CLOSED,{peerId:t,producerId:r});const i=this.sfuHandler.producerIdToConsumerIdMap.get(r);if(!i)return void BS.warn(`no consumer found for producer:${r}`);BS.info(`closing consumer ${i}, producer id: ${r}`),this.sfuHandler.closeConsumer(i).then((()=>{BS.info(`closed consumer: ${i}`),this.sfuHandler.producerIdToConsumerIdMap.delete(r),tE.emit(XS.CONSUMER_CLOSED,{id:i})})).catch((e=>{BS.error("error closing consumer",{error:e})}))}catch(e){BS.error("error on producer close broadcast",{error:e})}})),Qt(this,yR).on(Zw.globalPeerPinBroadcast,(({payload:e})=>{if(this.roomJoined)try{let t;if(e){const r=iT.fromBinary(e);BS.info("pinning peerId: data.participantId"),t=r.participantId}tE.emit(XS.PEER_PINNED,{peerId:t})}catch(e){BS.error("error on global peer pin broadcast",{error:e})}})),Qt(this,yR).on(Zw.peerDisplayNameEditBroadcast,(({payload:e})=>{if(this.roomJoined)try{const t=nT.fromBinary(e);BS.debug(`peer display name changed to: ${t.displayName}`),tE.emit(XS.PEER_DISPLAY_NAME_CHANGED,t.participantId)}catch(e){BS.error("failed to handle peerDisplayNameEditBroadcast:",{error:e})}})),Qt(this,yR).on(Zw.mediaRoomTerminationBroadcastResponse,(()=>{!this.roomJoined&&!Qt(this,ER)&&!Qt(this,TR)||(BS.warn("media hub termination broadcast received, rejoining room"),this.rejoinRoom())}))}))}handleSFUEvents(){Qt(this,_R).on("reconnect_transport",(e=>tr(this,null,(function*(){try{tE.emit(XS.HIVE_TRANPSORT_RECONNECTING),yield this.reconnectTransport(e),BS.info(`transport reconnected [id:${e.id}]`)}catch(e){BS.error("error on reconnection transports",{error:e})}})))),Qt(this,_R).on("rejoin",(e=>{Qt(this,bR)>3&&!e?BS.warn("cannot rejoin more already rejoined 3 times"):!Qt(this,ER)||e?(Zt(this,bR,Qt(this,bR)+1),BS.warn(`rejoining the room because transports are failing. [rejoinCount: ${Qt(this,bR)}]`),tE.emit(XS.HIVE_ROOM_REJOINING),this.rejoinRoom()):BS.warn("room joining in progress, cannot start rejoining")}))}handleCallstatsEvents(){fi.onSafeInitialization((()=>{fi.onConsumerScore((e=>{e.forEach(((e,t)=>{const r=this.sfuHandler.consumers.get(t);r&&tE.emit(XS.CONSUMER_SCORE_UPDATE,{id:t,kind:r.kind,peerId:r.peerId,score:+(10*e).toFixed()})}))})),fi.onProducerScore((e=>{e.forEach(((e,t)=>{const r=[...this.sfuHandler.producers.values()].find((e=>e.id===t));r&&tE.emit(XS.PRODUCER_SCORE_UPDATE,{id:t,kind:r.kind,appData:r.appData,score:+(10*e).toFixed()})}))}))}))}},yR=new WeakMap,_R=new WeakMap,SR=new WeakMap,ER=new WeakMap,TR=new WeakMap,bR=new WeakMap,wR=new WeakMap,kR=new WeakMap,RR=new WeakMap,CR=new WeakMap,AR=new WeakMap,IR=new WeakMap,PR);let MR=DR;gR([VS.trace("HiveNodeClient.reset")],MR.prototype,"reset",1),gR([VS.trace("HiveNodeClient.reconnect")],MR.prototype,"reconnectTransport",1),gR([VS.trace("HiveNodeClient.setupTransport")],MR.prototype,"setupTransports",1),gR([VS.trace("HiveNodeClient.joinRoom")],MR.prototype,"joinRoom",1),gR([VS.trace("HiveNodeClient.completeJoinRoom")],MR.prototype,"completeJoinRoom",1),gR([VS.trace("HiveNodeClient.leaveRoom")],MR.prototype,"leaveRoom",1),gR([VS.trace("HiveNodeClient.activatePeers")],MR.prototype,"activatePeers",1),gR([VS.trace("HiveNodeClient.deactivatePeers")],MR.prototype,"deactivatePeers",1),gR([VS.trace("HiveNodeClient.createConsumer")],MR.prototype,"createConsumer",1),gR([VS.trace("HiveNodeClient.pauseConsumers")],MR.prototype,"pauseConsumers",1),gR([VS.trace("HiveNodeClient.resumeConsumers")],MR.prototype,"resumeConsumers",1),gR([VS.trace("HiveNodeClient.closeConsumers")],MR.prototype,"closeConsumers",1),gR([VS.trace("HiveNodeClient.consumePeer")],MR.prototype,"consumePeer",1),gR([VS.trace("HiveNodeClient.shareWebcam")],MR.prototype,"shareWebcam",1),gR([VS.trace("HiveNodeClient.shareScreen")],MR.prototype,"shareScreen",1),gR([VS.trace("HiveNodeClient.shareMic")],MR.prototype,"shareMic",1),gR([VS.trace("HiveNodeClient.pauseMic")],MR.prototype,"pauseMic",1),gR([VS.trace("HiveNodeClient.pauseWebcam")],MR.prototype,"pauseWebcam",1),gR([VS.trace("HiveNodeClient.resumeMic")],MR.prototype,"resumeMic",1),gR([VS.trace("HiveNodeClient.resumeWebcam")],MR.prototype,"resumeWebcam",1),gR([VS.trace("HiveNodeClient.disableWebcam")],MR.prototype,"disableWebcam",1),gR([VS.trace("HiveClient.disableMic")],MR.prototype,"disableMic",1),gR([VS.trace("HiveClient.disableScreenShare")],MR.prototype,"disableScreenShare",1),gR([VS.trace("HiveNodeClient.muteSelf")],MR.prototype,"muteSelf",1),gR([VS.trace("HiveNodeClient.resetVideoProducers")],MR.prototype,"resetVideoProducers",1),gR([VS.trace("HiveNodeClient.getPolls")],MR.prototype,"getPolls",1),gR([VS.trace("HiveNodeClient.changeDisplayName")],MR.prototype,"changeDisplayName",1),gR([VS.trace("HiveNodeClient.kickPeer")],MR.prototype,"kick",1),gR([VS.trace("HiveNodeClient.kickAllPeers")],MR.prototype,"kickAll",1),gR([VS.trace("HiveNodeClient.muteAll")],MR.prototype,"muteAll",1),gR([VS.trace("HiveNodeClient.muteAllVideo")],MR.prototype,"muteAllVideo",1),gR([VS.trace("HiveNodeClient.disableAudio")],MR.prototype,"disableAudio",1),gR([VS.trace("HiveNodeClient.disableVideo")],MR.prototype,"disableVideo",1),gR([VS.trace("HiveNodeClient.pinPeer")],MR.prototype,"pinPeer",1),gR([VS.trace("HiveNodeClient.validateScreenShare")],MR.prototype,"validateScreenShare",1),gR([VS.trace("HiveNodeClient.init")],MR,"init",1);var OR,NR,xR,LR,jR,UR,FR=(e=>(e.SOCKET_CONNECTED="SOCKET_CONNECTED",e.SOCKET_DISCONNECTED="SOCKET_DISCONNECTED",e.SOCKET_CONNECTION_ERROR="SOCKET_CONNECTION_ERROR",e.SOCKET_MESSAGE="SOCKET_MESSAGE",e))(FR||{}),VR=(e=>(e[e.NOT_STARTED=0]="NOT_STARTED",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e[e.ERRORED=3]="ERRORED",e))(VR||{}),BR=Object.defineProperty,WR=Object.getOwnPropertyDescriptor,HR=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?WR(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&BR(t,r,s),s};class GR extends ir{constructor(e){super(),Kt(this,"socket"),Kt(this,"socketState"),Kt(this,"callbackHandler",null),this.socketState=VR.NOT_STARTED,e.callbackHandler&&(this.callbackHandler=e.callbackHandler)}connect(e){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect()),this.socket=Pt(e,{closeOnBeforeunload:!1}),this.setupSocket()}disconnect(){this.socket.disconnect()}reconnect(){this.socket.connect()}setupSocket(){this.socket.on("disconnect",(e=>{this.socketState=VR.DISCONNECTED,BS.warn("SocketClient::socket_disconnected",{error:{reason:e}}),this.emit(FR.SOCKET_DISCONNECTED,{reason:e})})),this.socket.on("connect_error",(e=>{this.socketState=VR.ERRORED,Ci.hasFeature(DS.SOCKET_POLLING)&&(this.socket.io.opts.transports=["polling","websocket"]),BS.error("SocketClient::socket_connection_errored",{error:e}),null!=e&&e.message.includes("not found")&&tE.emit(XS.KICKED),this.emit(FR.SOCKET_CONNECTION_ERROR,{err:e})})),this.socket.on("connect",(()=>{this.socketState=VR.CONNECTED,BS.info("SocketClient::socket_connected"),this.emit(FR.SOCKET_CONNECTED)})),this.socket.on("event://server-simple-message",((e,t)=>tr(this,null,(function*(){const r=JSON.parse(e);if((!VS.logExclusionList.includes(null==r?void 0:r.type)||Ci.hasFeature(DS.BYPASS_LOG_EXCLUSION_LIST))&&BS.info(`SocketClient::SIMPLE_SERVER_MESSAGE_EVENT::${null==r?void 0:r.type}`),t){let e="OK";this.callbackHandler&&(e=yield this.callbackHandler(r)),t(e)}else this.emit(FR.SOCKET_MESSAGE,r);Object.values(XS).find((e=>e===r.type))&&tE.emit(r.type,r.payload)}))))}sendMessage(e){return tr(this,null,(function*(){return(!VS.logExclusionList.includes(null==e?void 0:e.type)||Ci.hasFeature(DS.BYPASS_LOG_EXCLUSION_LIST))&&BS.info(`SocketClient::sendMessage::${null==e?void 0:e.type}`),Object.assign(e,{metadata:e.metadata||{}}),VS.injectContext(e.metadata),new Promise((t=>{this.socket.emit("event://send-message",JSON.stringify(e),(e=>{if(!e)return void t(void 0);const r=JSON.parse(e);t(r)}))}))}))}}HR([VS.trace("SocketClient.connect")],GR.prototype,"connect",1),HR([VS.trace("SocketClient.disconnect")],GR.prototype,"disconnect",1),HR([VS.trace("SocketClient.reconnect")],GR.prototype,"reconnect",1),HR([VS.trace("SocketClient.setupSocket")],GR.prototype,"setupSocket",1);const $R=class{constructor(e=1e3){Xt(this,OR),Xt(this,xR),Kt(this,"sendTransport"),Kt(this,"recvTransport"),Kt(this,"collectStpStats"),Kt(this,"collectRtpStats"),Kt(this,"pingInterval"),this.pingInterval=e}initSendTransport(e){this.sendTransport=e,tE.emit(XS.SEND_TRANSPORT_CREATED)}initRecvTransport(e){this.recvTransport=e,tE.emit(XS.RECV_TRANSPORT_CREATED)}collectSendTransportStats(){return!(!this.sendTransport||this.collectStpStats||(this.collectStpStats=setInterval(er(this,OR,NR).bind(this),this.pingInterval),0))}collectRecvTransportStats(){return!(!this.recvTransport||this.collectRtpStats||(this.collectRtpStats=setInterval(er(this,xR,LR).bind(this),this.pingInterval),0))}stopStatsCollection(e){return"send"===e?(clearInterval(this.collectStpStats),this.collectStpStats=void 0,!0):"receive"===e&&(clearInterval(this.collectRtpStats),this.collectRtpStats=void 0,!0)}cleanup(e){this.stopStatsCollection(e),"send"===e?(this.sendTransport=void 0,this.collectStpStats=void 0,tE.emit(XS.SEND_TRANSPORT_CLOSED)):(this.recvTransport=void 0,this.collectRtpStats=void 0,tE.emit(XS.RECV_TRANSPORT_CLOSED))}};let qR=$R;OR=new WeakSet,NR=function(){this.sendTransport||this.stopStatsCollection("send"),this.sendTransport.getStats().then((e=>{var t;return er(t=$R,jR,UR).call(t,e,"send")}))},xR=new WeakSet,LR=function(){this.recvTransport||this.stopStatsCollection("receive"),this.recvTransport.getStats().then((e=>{var t;return er(t=$R,jR,UR).call(t,e,"receive")}))},jR=new WeakSet,UR=function(e,t){e.forEach((e=>{"candidate-pair"===e.type&&tE.emit(XS.CANDIDATE_PEER_UPDATE,zt(qt({},e),{transport:t})),"inbound-rtp"===e.type&&tE.emit(XS.INBOUND_RTP_UPDATE,zt(qt({},e),{transport:t})),"outbound-rtp"===e.type&&tE.emit(XS.OUTBOUND_RTP_UPDATE,zt(qt({},e),{transport:t}))}))},Xt(qR,jR);const zR=new qR;var JR=Object.defineProperty,KR=Object.getOwnPropertyDescriptor,YR=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?KR(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&JR(t,r,s),s};class QR extends ir{constructor(e,t){super(),Kt(this,"device"),Kt(this,"sendTransport"),Kt(this,"recvTransport"),Kt(this,"sendTransportIceStateDisconnectTime"),Kt(this,"recvTransportIceStateDisconnectTime"),Kt(this,"producerCreationStatus"),Kt(this,"consumers"),Kt(this,"producers"),Kt(this,"socketClient"),Kt(this,"iceRestartInProgress"),this.producers=new Map,this.consumers=new Map,this.producerCreationStatus=new Map,this.iceRestartInProgress={sendTransport:!1,recvTransport:!1},this.device=void 0!==t?t:new ed,this.socketClient=e}setupTransports(){return tr(this,null,(function*(){const e=yield qw().getICEServers();yield this.loadRouter(),yield Promise.all([this.createRecvTransport(e),this.createSendTransport(e)])}))}loadRouter(){return tr(this,null,(function*(){(this.recvTransport||this.sendTransport)&&(yield this.stopAllTransports())}))}getRTPCapabilities(){return this.device.rtpCapabilities}createRecvTransport(e){return tr(this,null,(function*(){if(!this.socketClient)return;const t=(yield this.socketClient.sendMessage({type:"createWebRtcTransport",payload:{forceTcp:!1,producing:!1,consuming:!0}})).payload;if(BS.info("recvTransport::initializing_transport"),this.recvTransport=this.device.createRecvTransport(zt(qt({},t),{iceServers:e,proprietaryConstraints:ES})),zR.initRecvTransport(this.recvTransport),BS.info("recvTransport::initialized_transport"),fi.onSafeInitialization((()=>{fi.configureRecvTransport(this.recvTransport)})),this.recvTransport.on("connect",((e,t,r)=>tr(this,[e,t,r],(function*({dtlsParameters:e},t,r){var i,n,s,o;const a=yield this.socketClient.sendMessage({type:"connectWebRtcTransport",payload:{transportId:this.recvTransport.id,dtlsParameters:e}});null!=(i=a.payload)&&i.error?(BS.error("recvTransport::transport_status",{error:null==(s=a.payload)?void 0:s.error,transport:{id:null==(o=null==this?void 0:this.recvTransport)?void 0:o.id,status:"failed",type:"recv"}}),r(new Error("failed"))):(t(),BS.info("recvTransport::transport_status",{transport:{id:null==(n=null==this?void 0:this.recvTransport)?void 0:n.id,status:"connected",type:"recv"}}))})))),Ci.hasFeature(DS.ENABLE_ICE_STATE_LOGGING)){let e;BS.info("enabling_ice_state_logging_for_recv_transport"),this.recvTransport.on("connectionstatechange",(t=>tr(this,null,(function*(){var r,i,n,s,o,a,c,d;switch(BS.info("recvTransport::connection_state_change",{transport:{id:null==(r=null==this?void 0:this.recvTransport)?void 0:r.id,status:t,type:"recv"}}),t){case"failed":if(tE.emit(XS.ICE_FAILED,{transport:"recv"}),BS.warn("recvTransport::ice_state_failed"),Ci.hasFeature(DS.ICE_RESTART_ON_FAILED_STATE))try{yield this.restartIceTillSuccess(this.recvTransport)}catch(e){BS.error("recvTransport::ice_restart_failed",{error:e,transport:{id:null==(i=null==this?void 0:this.recvTransport)?void 0:i.id,status:"failed",type:"recv"}})}break;case"disconnected":tE.emit(XS.ICE_DISCONNECTED,{transport:"recv"}),BS.warn("recvTransport::ice_state_disconnected"),this.recvTransportIceStateDisconnectTime&&BS.warn("recvTransport::ice_state_disconnected_again",{transport:{id:null==(n=null==this?void 0:this.recvTransport)?void 0:n.id,status:"disconnected",type:"recv",lastDisconnectedTime:null==(s=this.recvTransportIceStateDisconnectTime)?void 0:s.toISOString(),lastDisconnectedTimeOffset:null==(o=this.recvTransportIceStateDisconnectTime)?void 0:o.getTimezoneOffset(),durationPassed:(new Date).getTime()-this.recvTransportIceStateDisconnectTime.getTime()}}),this.recvTransportIceStateDisconnectTime=new Date;try{e=Ci.getValue(DS.ICE_RESTART_ON_DISCONNECTED_STATE),"number"!=typeof e&&(e=void 0)}catch(t){e=void 0}e&&setTimeout((()=>tr(this,null,(function*(){var e,t,r,i,n;if(void 0!==this.recvTransportIceStateDisconnectTime){tE.emit(XS.ICE_RECONNECTING,{transport:"recv"}),BS.info("recvTransport::attempting_ice_restart",{transport:{id:null==(e=null==this?void 0:this.recvTransport)?void 0:e.id,type:"recv",status:"reconnecting",lastDisconnectedTime:null==(t=this.recvTransportIceStateDisconnectTime)?void 0:t.toISOString(),lastDisconnectedTimeOffset:null==(r=this.recvTransportIceStateDisconnectTime)?void 0:r.getTimezoneOffset()},iceRestart:{isSendTransport:null==(i=null==this?void 0:this.iceRestartInProgress)?void 0:i.sendTransport,isRecvTransport:null==(n=null==this?void 0:this.iceRestartInProgress)?void 0:n.recvTransport}});try{yield this.restartIceTillSuccess(this.recvTransport)}catch(e){BS.info("SFUHandler.disconnected.restartIceFailed",{error:e,iceRestart:{status:"failed",isRecvTransport:!0}})}}}))),e);break;case"connected":tE.emit(XS.ICE_CONNECTED,{transport:"recv"}),BS.info("recvTransport::ice_state_connected",{transport:{id:null==(a=null==this?void 0:this.recvTransport)?void 0:a.id,type:"recv",status:"connected",lastDisconnectedTime:null==(c=this.recvTransportIceStateDisconnectTime)?void 0:c.toISOString(),lastDisconnectedTimeOffset:null==(d=this.recvTransportIceStateDisconnectTime)?void 0:d.getTimezoneOffset(),durationPassed:this.recvTransportIceStateDisconnectTime?(new Date).getTime()-this.recvTransportIceStateDisconnectTime.getTime():null}}),this.recvTransportIceStateDisconnectTime=void 0}}))))}this.recvTransport.observer.on("close",(()=>{this.recvTransport=void 0,zR.cleanup("receive"),BS.warn("recvTransport_closed")}))}))}createSendTransport(e){return tr(this,null,(function*(){const t=(yield this.socketClient.sendMessage({type:"createWebRtcTransport",payload:{forceTcp:!1,producing:!0,consuming:!1}})).payload;if(BS.info("sendTransport::initializing_transport"),this.sendTransport=this.device.createSendTransport(zt(qt({},t),{iceServers:e,proprietaryConstraints:ES})),zR.initSendTransport(this.sendTransport),BS.info("sendTransport::initialized_transport"),fi.onSafeInitialization((()=>{fi.configureSendTransport(this.sendTransport)})),this.sendTransport.on("connect",((e,t,r)=>tr(this,[e,t,r],(function*({dtlsParameters:e},t,r){var i,n,s,o;null!=(n=(yield this.socketClient.sendMessage({type:"connectWebRtcTransport",payload:{transportId:null==(i=this.sendTransport)?void 0:i.id,dtlsParameters:e}})).payload)&&n.error?(BS.error("sendTransport::transport_status",{transport:{id:null==(o=null==this?void 0:this.sendTransport)?void 0:o.id,status:"failed",type:"send"}}),r(new Error("failed"))):(BS.info("sendTransport::transport_status",{transport:{id:null==(s=null==this?void 0:this.sendTransport)?void 0:s.id,status:"connected",type:"send"}}),t())})))),this.sendTransport.on("produce",((e,t,r)=>tr(this,[e,t,r],(function*({kind:e,rtpParameters:t,appData:r},i,n){var s,o,a,c,d,l;const u=yield this.socketClient.sendMessage({type:"produce",payload:{transportId:null==(s=this.sendTransport)?void 0:s.id,kind:e,rtpParameters:t,appData:r}});null!=(o=u.payload)&&o.error?(BS.info("sendTransport::producer_status::failed",{producer:{kind:e,appData:r,status:"failed",id:null==(d=null==u?void 0:u.payload)?void 0:d.id}}),n(null==(l=u.payload)?void 0:l.error)):(BS.info("sendTransport::producer_status::producing",{producer:{kind:e,appData:r,status:"producing",id:null==(a=null==u?void 0:u.payload)?void 0:a.id}}),i({id:null==(c=u.payload)?void 0:c.id}))})))),Ci.hasFeature(DS.ENABLE_ICE_STATE_LOGGING)){let e;BS.info("Enabling ice state logging for send transport"),this.sendTransport.on("connectionstatechange",(t=>tr(this,null,(function*(){var r,i,n,s;switch(BS.info("sendTransport::connection_state_change",{transport:{id:null==(r=null==this?void 0:this.sendTransport)?void 0:r.id,status:t,type:"send"}}),t){case"failed":if(tE.emit(XS.ICE_FAILED,{transport:"send"}),BS.warn("sendTransport::ice_state_failed"),Ci.hasFeature(DS.ICE_RESTART_ON_FAILED_STATE))try{yield this.restartIceTillSuccess(this.sendTransport)}catch(e){BS.error("sendTransport::ice_restart_failed",{error:e})}break;case"disconnected":tE.emit(XS.ICE_DISCONNECTED,{transport:"send"}),BS.warn("sendTransport::ice_state_disconnected"),this.sendTransportIceStateDisconnectTime&&BS.warn("sendTransport::ice_state_disconnected_again",{transport:{id:null==(i=null==this?void 0:this.sendTransport)?void 0:i.id,status:"disconnected",lastDisconnectedTime:this.sendTransportIceStateDisconnectTime.toLocaleTimeString(),durationPassed:(new Date).getTime()-this.sendTransportIceStateDisconnectTime.getTime(),type:"send"}}),this.sendTransportIceStateDisconnectTime=new Date;try{e=Ci.getValue(DS.ICE_RESTART_ON_DISCONNECTED_STATE),"number"!=typeof e&&(e=void 0)}catch(t){e=void 0}e&&setTimeout((()=>tr(this,null,(function*(){var e,t,r,i;if(void 0!==this.sendTransportIceStateDisconnectTime){tE.emit(XS.ICE_RECONNECTING,{transport:"send"}),BS.info("sendTransport::attempting_ice_restart",{transport:{id:null==(e=null==this?void 0:this.sendTransport)?void 0:e.id,status:"reconnecting",type:"send",lastDisconnectedTime:null==(t=this.sendTransportIceStateDisconnectTime)?void 0:t.toISOString(),lastDisconnectedTimeOffset:null==(r=this.sendTransportIceStateDisconnectTime)?void 0:r.getTimezoneOffset()},iceRestart:{status:"connecting"}});try{yield this.restartIceTillSuccess(this.sendTransport)}catch(e){BS.info("SFUHandler.disconnected.restartIceFailed",{error:e,transport:{id:null==(i=null==this?void 0:this.sendTransport)?void 0:i.id,type:"send",status:"failed"}})}}}))),e);break;case"connected":tE.emit(XS.ICE_CONNECTED,{transport:"send"}),BS.info("sendTransport::ice_state_connected",{transport:{id:null==(n=null==this?void 0:this.sendTransport)?void 0:n.id,type:"send",status:"connected",lastDisconnectedTime:null==(s=this.sendTransportIceStateDisconnectTime)?void 0:s.toLocaleTimeString(),durationPassed:this.sendTransportIceStateDisconnectTime?(new Date).getTime()-this.sendTransportIceStateDisconnectTime.getTime():null}}),this.sendTransportIceStateDisconnectTime=void 0}}))))}this.sendTransport.observer.on("close",(()=>{this.sendTransport=void 0,zR.cleanup("send"),BS.warn("sendTransport_closed")}))}))}restartIce(e){return tr(this,null,(function*(){const{direction:t}=e;if(!("recv"===t?this.iceRestartInProgress.recvTransport:this.iceRestartInProgress.sendTransport)){"recv"===t?this.iceRestartInProgress.recvTransport=!0:this.iceRestartInProgress.sendTransport=!0;try{const t=(yield this.socketClient.sendMessage({type:"restartIce",payload:{transportId:e.id}})).payload;yield e.restartIce(t)}catch(r){BS.error("SFUHandler.restartIce.Failed",{error:r,iceRestart:{status:"failed"},transport:{id:null==e?void 0:e.id,status:"failed",type:t}})}"recv"===t?this.iceRestartInProgress.recvTransport=!1:this.iceRestartInProgress.sendTransport=!1}}))}createConsumer(e){return tr(this,null,(function*(){if(void 0===this.recvTransport||this.recvTransport.closed)return;const{peerId:t,producerId:r,id:i,kind:n,rtpParameters:s,appData:o,remotelyPaused:a}=e;BS.info("createConsumer::initializing_consumer",{consumer:{id:i,peerId:t,kind:n,appData:o,remotelyPaused:a,producerId:r}});const c=yield this.recvTransport.consume({id:i,producerId:r,kind:n,rtpParameters:s,appData:zt(qt({},o),{peerId:t})});BS.info("createConsumer::initialized_consumer",{consumer:{id:c.id,peerId:t,kind:n,appData:o,remotelyPaused:a,producerId:r}});const d=c;d.peerId=t,d.remotelyPaused=a,d.score=10,this.consumers.set(c.id,d)}))}closeConsumer(e){return tr(this,null,(function*(){const{id:t}=e,r=this.consumers.get(t);r&&(BS.info("SFUHandler::close_consumer",{consumer:r}),r.close(),this.consumers.delete(t))}))}cleanupConsumers(){return tr(this,null,(function*(){var e;null==(e=this.consumers)||e.forEach((e=>{tE.emit(XS.CONSUMER_CLOSED,{id:e.id}),this.closeConsumer({id:e.id})}))}))}pauseConsumer(e){return tr(this,null,(function*(){const{id:t}=e,r=this.consumers.get(t);r&&r.pause()}))}resumeConsumer(e){return tr(this,null,(function*(){const{id:t}=e,r=this.consumers.get(t);r&&r.resume()}))}createProducer(e,t,r){return tr(this,null,(function*(){if(void 0===this.sendTransport||this.sendTransport.closed)return null;if(BS.info("createProducer::initializing_producer",{producer:{id:"TO_BE_CREATED",kind:e,status:"initializing",appData:null==t?void 0:t.appData}}),this.producerCreationStatus.get(e)&&this.producerCreationStatus.get(e)===_k.INITIALIZING)return BS.info("createProducer::producer getting initializing",{producer:{id:"GETTING_CREATED",status:"initializing",kind:e,appData:null==t?void 0:t.appData}}),null;this.producerCreationStatus.set(e,_k.INITIALIZING);const i=yield Promise.race([this.sendTransport.produce(t),new Promise((e=>setTimeout((()=>e(void 0)),6e3)))]);if(!i)return BS.error("createProducer::transport_initialization_timed_out",{producer:{id:"FAILED_TO_CREATE",kind:e,status:"failed",appData:null==t?void 0:t.appData}}),this.producerCreationStatus.set(e,_k.NOT_INITIALIZED),null;this.producerCreationStatus.set(e,_k.INITIALIZED),BS.info("createProducer::initialized_producer",{producer:{id:null==i?void 0:i.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),i.on("transportclose",(()=>{BS.info("producer::transportclose",{producer:{id:null==i?void 0:i.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),this.producerCreationStatus.set(e,_k.NOT_INITIALIZED),this.producers.delete(e)})),i.on("trackended",(()=>{tE.emit(XS.PRODUCER_TRACK_ENDED,{kind:e}),BS.info("producer::trackended",{producer:{id:null==i?void 0:i.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),[RS.MIC,RS.WEBCAM].includes(e)||r()}));const n=i;return n.score=10,this.producers.set(e,n),yield this.reconfigureWebcamLayers(),yield this.reconfigureSafariScreenshareLayers(),i.track}))}removeProducer(e,t=!0){return tr(this,null,(function*(){const r=this.producers.get(e);!r||r.closed||(BS.info("SFUHandler::remove_producer",{producer:{id:null==r?void 0:r.id,kind:e,status:"UNKNOWN",appData:null==r?void 0:r.appData},debuggingHint:`stopTrack was ${t}`}),t&&r.track.stop(),r.close(),yield this.socketClient.sendMessage({type:"closeProducer",payload:{producerId:r.id}}),this.producerCreationStatus.set(e,_k.NOT_INITIALIZED),this.producers.delete(e),yield this.reconfigureWebcamLayers())}))}stopAllProducers(){Array.from(this.producers.keys()).forEach((e=>{this.removeProducer(e)}))}stopAllTransports(){return tr(this,null,(function*(){if(this.sendTransport){try{this.sendTransport.close()}catch(e){BS.error("stopAllTransports",{error:e})}this.sendTransport=void 0}if(this.recvTransport){try{this.recvTransport.close()}catch(e){BS.error("SFUHandler::stopAllTransports::error",e)}this.recvTransport=void 0}}))}reconfigureWebcamLayers(){return tr(this,null,(function*(){if(!Ci.hasFeature(DS.DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE))return;const e=this.producers.get(RS.WEBCAM);e&&(yield e.setMaxSpatialLayer(this.producers.get(RS.SCREENSHARE_VIDEO)?0:1))}))}reconfigureSafariScreenshareLayers(){return tr(this,null,(function*(){if(!Ci.hasFeature(DS.SCREENSHARE_SIMULCAST)||!_S.isSafari())return;const e=this.producers.get(RS.SCREENSHARE_VIDEO);if(!e)return;const t=e.rtpSender.getParameters();t.encodings=bS,e.rtpSender.setParameters(t)}))}restartIceTillSuccess(e,t=3){return tr(this,null,(function*(){let r=!1,i=0;for(;!r&&i<t;)try{BS.info("SFUHandler.restartIceTillSuccess.AttemptRestart",{iceRestart:{currentAttempt:i,isSendTransport:"send"===e.direction,isRecvTransport:"recv"===e.direction}}),yield this.restartIce(e),r=!0}catch(e){i+=1}if(!r)throw new qS("Failed to restart Ice")}))}}YR([VS.trace("SFUHandler.setupTransports")],QR.prototype,"setupTransports",1),YR([VS.trace("SFUHandler.loadRouter")],QR.prototype,"loadRouter",1),YR([VS.trace("SFUHandler.createRecvTransport")],QR.prototype,"createRecvTransport",1),YR([VS.trace("SFUHandler.createSendTransport")],QR.prototype,"createSendTransport",1),YR([VS.trace("SFUHandler.restartIce")],QR.prototype,"restartIce",1),YR([VS.trace("SFUHandler.createConsumer")],QR.prototype,"createConsumer",1),YR([VS.trace("SFUHandler.closeConsumer")],QR.prototype,"closeConsumer",1),YR([VS.trace("SFUHandler.cleanupConsumers")],QR.prototype,"cleanupConsumers",1),YR([VS.trace("SFUHandler.pauseConsumer")],QR.prototype,"pauseConsumer",1),YR([VS.trace("SFUHandler.resumeConsumer")],QR.prototype,"resumeConsumer",1),YR([VS.trace("SFUHandler.createProducer")],QR.prototype,"createProducer",1),YR([VS.trace("SFUHandler.removeProducer")],QR.prototype,"removeProducer",1),YR([VS.trace("SFUHandler.stopAllProducers")],QR.prototype,"stopAllProducers",1),YR([VS.trace("SFUHandler.stopAllTransports")],QR.prototype,"stopAllTransports",1);Object.defineProperty,Object.getOwnPropertyDescriptor;var XR=(e=>(e.REQUEST="REQUEST",e.ACCEPT="ACCEPT",e.REJECT="REJECT",e.END="END",e.EVENT="EVENT",e))(XR||{}),ZR=(e=>(e.PENDING="PENDING",e.ACCEPTED="ACCEPTED",e.REJECTED="REJECTED",e.ENDED="ENDED",e))(ZR||{}),eC=(e=>(e.KEYBOARD="KEYBOARD",e.MOUSE="MOUSE",e))(eC||{}),tC=(e=>(e.LEFT_CLICK="click",e.RIGHT_CLICK="contextmenu",e.MOVE="mousemove",e))(tC||{}),rC=(e=>(e.REQUEST_RECEIVED="REQUEST_RECEIVED",e.REQUEST_SENT="REQUEST_SENT",e.INCOMING_REQUEST_ACCEPTED="INCOMING_REQUEST_ACCEPTED",e.OUTGOING_REQUEST_ACCEPTED="OUTGOING_REQUEST_ACCEPTED",e.INCOMING_REQUEST_ENDED="INCOMING_REQUEST_ENDED",e.OUTGOING_REQUEST_ENDED="OUTGOING_REQUEST_ENDED",e))(rC||{});let iC=class extends WS{constructor(e){super(),Kt(this,"id"),Kt(this,"remotePeerId"),Kt(this,"hostPeerId"),Kt(this,"state");const{remotePeerId:t,requestId:r,hostPeerId:i,state:n}=e;this.id=r,this.remotePeerId=t,this.hostPeerId=i,this.state=n}};iC=((e,t,r,i)=>{for(var n,s=t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(s)||s);return s})([KS((e=>{throw new qS(e.message,"1400")}))],iC);var nC=(e=>(e.REQUESTED_BY_PARTICIPANT="REQUESTED_BY_PARTICIPANT",e.REQUESTED_BY_MODERATOR="REQUESTED_BY_MODERATOR",e))(nC||{}),sC=(e=>(e.PRESENT="REQUEST_TO_PRESENT",e))(sC||{}),oC=Object.defineProperty,aC=Object.getOwnPropertyDescriptor,cC=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?aC(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&oC(t,r,s),s};const dC={joinAttempted:!1};var lC,uC,pC;const hC=(pC=class extends rk{constructor(e){super(),Xt(this,lC,void 0),Kt(this,"isV2AuthToken"),Xt(this,uC,void 0),Kt(this,"legacyMode"),Kt(this,"roomNodeUrl"),Kt(this,"peerDisplayName");const{roomName:t,roomNodeUrl:r,peerId:i,authToken:n,legacyMode:s,socketClient:o,meetingTitle:a,viewType:c}=e;this.roomName=t,this.roomNodeUrl=r,this.peerId=i,this.authToken=n,this.legacyMode=s,Zt(this,lC,o),this.roomJoined=!1,this.mediaConnected=!1,this.meetingTitle=a,this.isV2AuthToken=Sw.isV2AuthToken,Zt(this,uC,new QR(o,e.device)),fi.legacySwitch(s);let d=0;const l=e=>tr(this,[e],(function*({err:e}){var r;this.isDisconnected=!0,null==(r=this.sfuHandler)||r.cleanupConsumers(),this.mediaConnected=!1,tE.emit(XS.ROOM_NODE_CONNECTION_ERROR,e),this.roomJoined=!1,BS.error("RoomNodeClient::ROOM_NODE_CONNECTION_ERROR",{error:e});const s=Sw.isV2AuthToken?Sw.meetingId:t,o=qw(),{roomNodeUrl:a}=yield o.getRoomNodeData({roomName:s,peerId:i}),c=`${a}?roomURL=${t}&peerId=${i}&authToken=${n}&version=0.5.0`;d+=1,!(d>3)&&(BS.log("RoomNodeClient::SocketReconnection",{socket:{retryAttempt:d}}),Qt(this,lC).connect(c),bw(zt(qt({},Sw.roomNodeOptions),{roomNodeUrl:a})),this.roomNodeUrl=a)}));c===gi.Livestream&&(o.removeListener(FR.SOCKET_CONNECTION_ERROR,l.bind(this)),o.on(FR.SOCKET_CONNECTION_ERROR,l.bind(this)))}static init(e){return tr(this,null,(function*(){const{legacyMode:t=!0,roomName:r,peerId:i,authToken:n,meetingTitle:s,device:o,viewType:a}=e;let c;const d=`${e.roomNodeUrl}?roomURL=${r}&peerId=${i}&authToken=${n}&version=0.5.0`,l=new GR({callbackHandler:e=>tr(this,null,(function*(){yield c.handleSocketCallbacks(e)}))});return l.on(FR.SOCKET_MESSAGE,((e,t)=>tr(this,null,(function*(){yield c.handleSockets(e,t)})))),l.connect(d),c=new hC({legacyMode:t,authToken:n,peerId:i,roomName:r,roomNodeUrl:d,socketClient:l,meetingTitle:s,device:o,viewType:a}),l.on(FR.SOCKET_DISCONNECTED,(e=>{var t,r;c.isDisconnected=!0,null==(t=c.sfuHandler)||t.cleanupConsumers(),null==(r=c.sfuHandler)||r.stopAllTransports(),c.mediaConnected=!1,tE.emit(XS.ROOM_NODE_DISCONNECTED,e),c.roomJoined=!1,BS.info("RoomNodeClient::ROOM_NODE_DISCONNECTED")})),l.on(FR.SOCKET_CONNECTED,(e=>tr(this,null,(function*(){c.mediaConnected=!0,tE.emit(XS.ROOM_NODE_CONNECTED,zt(qt({},e),{wasDisconnected:c.isDisconnected,wasJoinAttempted:dC.joinAttempted})),c.isDisconnected=!1,BS.info("RoomNodeClient::ROOM_NODE_CONNECTED")})))),c}))}get sfuHandler(){return Qt(this,uC)}reconnect(){Qt(this,lC).reconnect()}setupTransports(){return tr(this,null,(function*(){yield this.sfuHandler.setupTransports()}))}handleSocketCallbacks(e){return tr(this,null,(function*(){return e.type===XS.NEW_CONSUMER?this.sfuHandler.createConsumer(e.payload):null}))}handleSockets(e,t){return tr(this,null,(function*(){if(e){switch((!VS.logExclusionList.includes(null==e?void 0:e.type)||Ci.hasFeature(DS.BYPASS_LOG_EXCLUSION_LIST))&&BS.info(`RoomNodeClient::handleSockets::${null==e?void 0:e.type}`),e.type){case XS.CONSUMER_CLOSED:this.sfuHandler.closeConsumer(e.payload);break;case XS.CONSUMER_PAUSED:this.sfuHandler.pauseConsumer(e.payload);break;case XS.CONSUMER_RESUMED:this.sfuHandler.resumeConsumer(e.payload);break;case XS.CONSUMER_SCORE:this.handleConsumerScore(e.payload);break;case XS.PRODUCER_SCORE:this.handleProducerScore(e.payload);break;case XS.PRODUCER_CLOSED:this.handleProducerClosed(e.payload)}"function"==typeof t&&t()}}))}joinRoom(e,t,r,i){return tr(this,arguments,(function*(e,t,r,i,n={}){var s,o,a;dC.joinAttempted=!0,this.peerDisplayName=e,this.roomUUID=r;const c=yield Qt(this,lC).sendMessage({type:"joinRoom",payload:{device:_S.getDeviceInfo(),displayName:e,rtpCapabilities:this.sfuHandler.getRTPCapabilities(),isLegacy:this.legacyMode,audioMuted:t}});if(null!=(s=c.payload)&&s.waitlisted)return tE.emit(XS.WAITLISTED),{roomJoined:!1};this.roomJoined=!0,this.mediaConnected=!0,null==(a=null==(o=c.payload)?void 0:o.waitlistedPeers)||a.forEach((e=>{tE.emit(XS.WAITLIST_PEER_ADDED,e)})),this.legacyMode=c.payload.legacyMode||this.legacyMode,i&&""!==i&&(yield this.changeRoomDisplayTitle(i)),this.maxPreferredStreams=c.payload.maxPreferredStreams;const d=qw();BS.info("RoomNodeClient::joinRoom::pre emitasync room_joined");try{yield tE.emitAsync(XS.ROOM_JOINED,c.payload)}catch(e){BS.error("RoomNodeClient::joinRoom::emitAsync",{error:e})}return BS.info("RoomNodeClient::joinRoom::post emitasync room_joined"),tE.emit(XS.SELF_ROOM_JOINED),Ci.hasFeature(DS.INTERNAL_CALL_STATS)&&"ReactNative"!==navigator.product&&setTimeout((()=>tr(this,null,(function*(){const t=yield d.getUserDetails(),r={userId:Sw.isV2AuthToken?t.participant.id:t.id,peerId:this.peerId,displayName:e,roomUUID:this.roomUUID,roomViewType:"groupCall",roomName:this.roomName,deviceInfo:zt(qt({},_S.getDeviceInfo()),{userAgent:navigator.userAgent,memory:navigator.deviceMemory,cpus:navigator.hardwareConcurrency}),sdkName:nd,sdkVersion:id,metaData:{},permissions:{}};fi.roomJoined(r),null!=n&&n.audio?fi.audioOn():fi.audioOff(),null!=n&&n.video?fi.videoOn():fi.videoOff()})))),{roomJoined:!0}}))}leaveRoom(){return tr(this,null,(function*(){dC.joinAttempted=!1,this.sfuHandler.stopAllProducers(),yield this.sfuHandler.stopAllTransports(),Qt(this,lC).disconnect(),fi.callEnded(),VS.destruct()}))}handleProducerClosed({id:e}){this.sfuHandler.producers.forEach(((t,r)=>{t.id===e&&this.sfuHandler.removeProducer(r)}))}getConsumers(){return this.sfuHandler.consumers}static getComputedScore(e){var t,r;let i=0;try{i=Array.isArray(e)?1===e.length?e[0].score:e.map((({score:e})=>null!=e?e:10)).filter((e=>e>0)).reduce(((e,t)=>e+t),0)/e.length:null!=(t=null==e?void 0:e.score)?t:10}catch(t){i=null!=(r=null==e?void 0:e.score)?r:10}return i}handleConsumerScore({id:e,score:t}){var r;const i=Qt(this,uC).consumers.get(e);i&&(i.score=t&&void 0!==t.producerScore&&t.producerScore>=0?t.producerScore:null!=(r=null==t?void 0:t.score)?r:10,tE.emit(XS.CONSUMER_SCORE_UPDATE,{id:i.id,kind:i.kind,peerId:i.peerId,score:i.score}))}handleProducerScore({id:e,score:t}){const r=Array.from(Qt(this,uC).producers.values()).find((t=>t.id===e));if(!r)return void BS.error(`RoomNodeClient::producer_not_found. ProducerId: ${e}`);if(!r)return;const i=hC.getComputedScore(t);void 0!==i&&i!==r.score&&(r.score=i,tE.emit(XS.PRODUCER_SCORE_UPDATE,{id:r.id,kind:r.kind,appData:r.appData,score:r.score}))}shareWebcam(e){return tr(this,null,(function*(){if(void 0===e)return null;if(this.sfuHandler.producers.has(RS.WEBCAM)){const t=this.sfuHandler.producers.get(RS.WEBCAM);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),yield this.resumeWebcam(),t.track;yield this.sfuHandler.removeProducer(RS.WEBCAM,!1)}let t=e.getConstraints().width;t in wS||(t=320);let r=wS[t];const i=this.sfuHandler.getRTPCapabilities().codecs.find((e=>"video/vp9"===e.mimeType.toLowerCase()))||void 0,n=this.sfuHandler.getRTPCapabilities().codecs.find((e=>"video/vp8"===e.mimeType.toLowerCase()))||void 0,s=Ci.getValue(DS.OVERRIDE_WEBCAM_SIMULCAST);if(i&&!this.legacyMode)r=kS;else if(void 0!==s)try{r=JSON.parse(s)}catch(e){BS.error("Failed to parse flagsmith simulcast")}const o={track:e,encodings:Ci.hasFeature(DS.DISABLE_WEBCAM_SIMULCAST)?void 0:r,codecOptions:{videoGoogleStartBitrate:1e3},codec:(()=>this.legacyMode?n:i)(),appData:{screenShare:!1},stopTracks:!1};return this.sfuHandler.createProducer(RS.WEBCAM,o,(()=>{this.disableWebcam()}))}))}shareScreen(e){return tr(this,null,(function*(){var t,r;const{video:i,audio:n}=e;if(void 0===i)return;let s;Ci.hasFeature(DS.SCREENSHARE_SIMULCAST)&&(s=TS);const o={track:i,appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},encodings:s,stopTracks:!1};let a=()=>{this.disableScreenShare()};fi.screenShareRequested(),yield this.sfuHandler.createProducer(RS.SCREENSHARE_VIDEO,o,a);const c={opusDtx:!1,opusStereo:!1,opusFec:!0,forceGoogConference:!1};if(Ci.hasFeature(DS.SCREENSHARE_FORCE_GOOG_CONFERENCE)&&(c.forceGoogConference=!0),n){const e={track:n,codecOptions:c,appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},stopTracks:!1};a=()=>{},yield this.sfuHandler.createProducer(RS.SCREENSHARE_AUDIO,e,a)}fi.screenShareStart(null==(r=null==(t=this.sfuHandler.producers.get(RS.SCREENSHARE_VIDEO))?void 0:t.rtpParameters.encodings[0])?void 0:r.ssrc)}))}shareMic(e){return tr(this,null,(function*(){try{if(void 0===e)throw new qS("track undefined");if(this.sfuHandler.producers.has(RS.MIC)){const t=this.sfuHandler.producers.get(RS.MIC);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),void(yield this.resumeMic());yield this.sfuHandler.removeProducer(RS.MIC,!1)}const t={track:e,codecOptions:{opusDtx:!1,opusStereo:!1,opusFec:!0,opusMaxAverageBitrate:16e3},stopTracks:!1},r=()=>{this.disableMic()};yield this.sfuHandler.createProducer(RS.MIC,t,r)}catch(e){throw new qS(e)}}))}pauseMic(){const e=this.sfuHandler.producers.get(RS.MIC);e?(e.pause(),Qt(this,lC).sendMessage({type:"pauseProducer",payload:{producerId:e.id}})):BS.error("pauseMic::could_not_find_mic_producer")}pauseWebcam(){return tr(this,null,(function*(){const e=this.sfuHandler.producers.get(RS.WEBCAM);e?(e.pause(),yield Qt(this,lC).sendMessage({type:"pauseProducer",payload:{producerId:e.id}})):BS.error("pauseWebcam::could_not_find_webcam_producer")}))}resumeMic(){return tr(this,null,(function*(){const e=this.sfuHandler.producers.get(RS.MIC);e?(e.resume(),yield Qt(this,lC).sendMessage({type:"resumeProducer",payload:{producerId:e.id}})):BS.error("resumeMic::could_not_find_mic_producer")}))}resumeWebcam(){return tr(this,null,(function*(){const e=this.sfuHandler.producers.get(RS.WEBCAM);e?(e.resume(),yield Qt(this,lC).sendMessage({type:"resumeProducer",payload:{producerId:e.id}})):BS.error("resumeWebcam::could_not_find_webcam_producer")}))}disableWebcam(){return tr(this,null,(function*(){yield this.sfuHandler.removeProducer(RS.WEBCAM)}))}disableMic(){return tr(this,null,(function*(){yield this.sfuHandler.removeProducer(RS.MIC)}))}disableScreenShare(){return tr(this,null,(function*(){var e,t;BS.info("screen_sharing_stopped"),fi.screenShareStop(null==(t=null==(e=this.sfuHandler.producers.get(RS.SCREENSHARE_VIDEO))?void 0:e.rtpParameters.encodings[0])?void 0:t.ssrc),yield this.sfuHandler.removeProducer(RS.SCREENSHARE_VIDEO),yield this.sfuHandler.removeProducer(RS.SCREENSHARE_AUDIO)}))}resetVideoProducers(e,t){return tr(this,null,(function*(){e&&(yield this.sfuHandler.removeProducer(RS.WEBCAM,!1),this.shareWebcam(e)),t&&(yield this.sfuHandler.removeProducer(RS.SCREENSHARE_VIDEO,!1),this.shareScreen({video:t}))}))}getRoomState(){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"getRoomState"})}))}changeRoomDisplayTitle(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"changeDisplayTitle",payload:{displayTitle:e}})}))}sendMessage(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage(e)}))}broadcastMessage(e,t){return tr(this,null,(function*(){const r={payload:t,type:e};return Qt(this,lC).sendMessage({type:"roomMessage",payload:r})}))}sendChatMessage(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"chatMessage",payload:e})}))}getChatMessages(){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"getChatMessages"})}))}pinChatMessage(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"pinChatMessage",payload:e})}))}unpinChatMessage(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"unpinChatMessage",payload:e})}))}getPolls(){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"getPolls"})}))}newPoll(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"newPoll",payload:e})}))}votePoll(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"votePoll",payload:e})}))}acceptWaitingRequest(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"acceptWaitingRequest",payload:{id:e}})}))}rejectWaitingRequest(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"rejectWaitingRequest",payload:{id:e}})}))}muteAll(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"muteAllNew",payload:{allowUnMute:e}})}))}muteAllVideo(){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"muteAllVideo"})}))}pinPeer(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"pinPeer",payload:{id:e}})}))}unpinPeer(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"unpinPeer",payload:{id:e}})}))}disableAudio(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"disableAudioPeerNew",payload:{id:e}})}))}disableVideo(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"disableVideoPeer",payload:{id:e}})}))}kickAll(){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"kickAll"})}))}kick(e){return tr(this,null,(function*(){yield Qt(this,lC).sendMessage({type:"kick",payload:{id:e}})}))}getPage(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"getPage",payload:{pageNum:e}})}))}muteSelf(){return tr(this,null,(function*(){this.pauseMic(),yield Qt(this,lC).sendMessage({type:"muteSelf"})}))}unmuteSelf(){return tr(this,null,(function*(){yield this.resumeMic(),yield Qt(this,lC).sendMessage({type:"unmuteSelf"})}))}addRoomPlugin(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"addPlugin",payload:e})}))}removeRoomPlugin(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"removePlugin",payload:e})}))}remoteControlMessage(e){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:"message",payload:e})}))}requestRemoteControl(e){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e.hostPeerId,remoteRequestId:e.id,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,remoteRequestType:XR.REQUEST})}))}acceptRemoteControl(e){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e.remotePeerId,remoteRequestId:e.id,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,remoteRequestType:XR.ACCEPT})}))}terminateRemoteControl(e,t){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e,remoteRequestId:t.id,hostPeerId:t.hostPeerId,remotePeerId:t.remotePeerId,remoteRequestType:XR.END})}))}sendEventRemoteControl(e,t,r){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e,remoteRequestId:t,remoteEvent:r,hostPeerId:this.peerId,remotePeerId:e,remoteRequestType:XR.EVENT})}))}assertSpotlight(e,t){return tr(this,null,(function*(){return Qt(this,lC).sendMessage({type:e,payload:zt(qt({},t),{roomMessageType:"spotlight"})})}))}assertSpotlightToRoom(e){return tr(this,null,(function*(){return this.assertSpotlight("roomMessage",e)}))}assertSpotlightToPeer(e){return tr(this,null,(function*(){return this.assertSpotlight("message",e)}))}requestToJoinStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"requestToJoinStage",payload:e})}))}withdrawRequestToJoinStage(){return tr(this,null,(function*(){yield this.sendMessage({type:"withdrawRequestToJoinStage"})}))}acceptAllRequestToJoinStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"acceptAllRequestToJoinStage",payload:e.map((e=>zt(qt({},e),{type:nC.REQUESTED_BY_MODERATOR})))})}))}grantStageAccess(e){return tr(this,null,(function*(){yield this.sendMessage({type:"grantStageAccess",payload:{userIDs:e}})}))}removePeerFromStage(e,t){return tr(this,null,(function*(){yield this.sendMessage({type:"removePeerFromStage",payload:{id:e,type:t}})}))}kickPeerFromStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"kickPeerFromStage",payload:{userIDs:e}})}))}stopAllProducers(){Qt(this,uC).stopAllProducers()}startPresenting(){return tr(this,null,(function*(){yield this.sendMessage({type:"startPresenting"})}))}stopPresenting(){return tr(this,null,(function*(){this.stopAllProducers(),yield this.sendMessage({type:"stopPresenting"})}))}rejectRequestToJoinStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"rejectRequestToJoinStage",payload:{id:e}})}))}denyStageAccess(e){return tr(this,null,(function*(){yield this.sendMessage({type:"denyStageAccess",payload:{userIDs:e}})}))}},lC=new WeakMap,uC=new WeakMap,pC);let mC,fC=hC;function gC(e){return tr(this,null,(function*(){if(null!=mC&&mC.roomJoined)throw new Error("Room Node Client already setup");mC&&(mC=void 0),mC=yield MR.init(e)}))}function vC(e){return tr(this,null,(function*(){if(null!=mC&&mC.roomJoined)throw new Error("Room Node Client already setup");mC&&(mC=void 0),mC=yield fC.init(e)}))}function yC(){try{null==mC||mC.leaveRoom()}catch(e){BS.error("roomNodeClient::cleanupRoomNodeClient")}mC=void 0}function _C(){return mC}function SC(e){var t,r,i,n,s,o,a,c,d,l,u,p,h;return e?{media:{audio:{enabled:e.audioEnabled,trackId:null==(t=e.audioTrack)?void 0:t.id,permission:"mediaPermissions"in e?null==(r=e.mediaPermissions)?void 0:r.audio:null},video:{enabled:e.videoEnabled,trackId:null==(i=e.videoTrack)?void 0:i.id,permission:"mediaPermissions"in e?null==(n=e.mediaPermissions)?void 0:n.video:null},screenshare:{enabled:e.screenShareEnabled,permission:"mediaPermissions"in e?null==(s=e.mediaPermissions)?void 0:s.screenshare:null,audio:{enabled:null==(a=null==(o=e.screenShareTracks)?void 0:o.audio)?void 0:a.enabled,trackId:null==(d=null==(c=e.screenShareTracks)?void 0:c.audio)?void 0:d.id},video:{enabled:null==(u=null==(l=e.screenShareTracks)?void 0:l.video)?void 0:u.enabled,trackId:null==(h=null==(p=e.screenShareTracks)?void 0:p.video)?void 0:h.id}}}}:{}}cC([VS.trace("RoomNodeClient.reconnect")],fC.prototype,"reconnect",1),cC([VS.trace("RoomNodeClient.joinRoom")],fC.prototype,"joinRoom",1),cC([VS.trace("RoomNodeClient.leaveRoom")],fC.prototype,"leaveRoom",1),cC([VS.trace("RoomNodeClient.shareWebcam")],fC.prototype,"shareWebcam",1),cC([VS.trace("RoomNodeClient.shareScreen")],fC.prototype,"shareScreen",1),cC([VS.trace("RoomNodeClient.shareMic")],fC.prototype,"shareMic",1),cC([VS.trace("RoomNodeClient.pauseMic")],fC.prototype,"pauseMic",1),cC([VS.trace("RoomNodeClient.pauseWebcam")],fC.prototype,"pauseWebcam",1),cC([VS.trace("RoomNodeClient.resumeMic")],fC.prototype,"resumeMic",1),cC([VS.trace("RoomNodeClient.resumeWebcam")],fC.prototype,"resumeWebcam",1),cC([VS.trace("RoomNodeClient.disableWebcam")],fC.prototype,"disableWebcam",1),cC([VS.trace("RoomNodeClient.disableMic")],fC.prototype,"disableMic",1),cC([VS.trace("RoomNodeClient.disableScreenShare")],fC.prototype,"disableScreenShare",1),cC([VS.trace("RoomNodeClient.resetVideoProducers")],fC.prototype,"resetVideoProducers",1);class EC extends Error{constructor(e,t){super(e),Kt(this,"code"),this.code=t}}class TC extends Error{constructor(e,t,r){super(t),Kt(this,"constraints"),Kt(this,"name"),this.name=e,this.constraints=r}}var bC=Object.defineProperty,wC=Object.getOwnPropertyDescriptor,kC=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?wC(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&bC(t,r,s),s};const RC={port:void 0},CC=["virtual","emulator","krisp","solstice conference","teams","manycam","blackHole"];function AC(e){const t=e.label.toLowerCase();return"macOS"===_S._bowser.getOSName()&&t.includes("iphone")?(BS.log("isVirtualDevice::ignore_macos_continuity"),!0):CC.some((e=>t.includes(e)))}var IC,PC,DC;const MC=(DC=class{constructor(e){Xt(this,IC,void 0),Xt(this,PC,void 0),Zt(this,IC,e),Zt(this,PC,new AbortController)}static init(){return tr(this,null,(function*(){let e=[];return MC.isDeviceListAvailable()?(e=yield MC.enumerateDevices(),BS.info("initial_full_device_list",{devices:JSON.stringify(e)})):BS.error("UnsupportedMediaAPI::navigator.mediaDevices.enumerateDevices",{debuggingHint:"Try checking meetingMetadata.visitedUrl. It should be running on localhost/127.0.0.1 or HTTPS, if not, there would be issues."}),new MC(e)}))}destruct(){return tr(this,null,(function*(){var e;null==(e=Qt(this,PC))||e.abort()}))}static isDeviceListAvailable(){return!(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)}static enumerateDevices(){try{return navigator.mediaDevices.enumerateDevices()}catch(e){return BS.error("enumerate_devices_failed",{error:e}),Promise.resolve([])}}static getAudioConstraints(e){const t={},{disableAP:r=!1,disableAEC:i=!1,disableNS:n=!1,disableAGC:s=!1,disableHPF:o=!1}=e.audioOptions||{};if(_S.isFirefox()||_S.isWebKitBased())t.audio={deviceId:e.audioDeviceId,autoGainControl:!s&&!r,echoCancellation:!i&&!r,noiseSuppression:!n&&!r};else{if("boolean"==typeof t.audio)return t;t.audio={},t.audio.optional=[e.audioDeviceId?{sourceId:e.audioDeviceId}:{sourceId:"default"},{echoCancellation:!i&&!r},{googEchoCancellation:!i&&!r},{googAutoGainControl:!s&&!r},{googNoiseSuppression:!n&&!r},{googHighpassFilter:!o&&!r},{googNoiseSuppression2:!n&&!r},{googEchoCancellation2:!i&&!r},{googAutoGainControl2:!s&&!r}]}return t}static getVideoConstraints(e){const t={},{videoDeviceId:r,videoTrackConstraints:i,facingMode:n="user",frameRate:s={ideal:24,max:30}}=e;return t.video=i||SS.vga,"boolean"==typeof t.video||(r&&(t.video.deviceId={exact:r}),t.video.facingMode=n,t.video.frameRate=s),t}static getUserMediaWithTimeout(){return tr(this,arguments,(function*(e={},t=0){try{if(BS.info("getUserMediaWithTimeout::requesting_user_media",{timeout:t,constraints:JSON.stringify(e)}),!t){const r=yield navigator.mediaDevices.getUserMedia(e);return BS.info("getUserMediaWithTimeout::received_user_media",{timeout:t,constraints:JSON.stringify(e)}),r}const r=yield Promise.race([navigator.mediaDevices.getUserMedia(e),new Promise(((e,r)=>{setTimeout((()=>r(new EC("Get user media timed out","ERR_GUM_TIMEOUT"))),t)}))]);return BS.info("getUserMediaWithTimeout::received_user_media",{timeout:t,constraints:JSON.stringify(e)}),r}catch(t){throw BS.error("getUserMediaWithTimeout::failed_to_access_local_media",{error:t,constraints:JSON.stringify(e)}),BS.error("Failed to get access to local media.",{error:t,constraints:JSON.stringify(e)}),new TC(t.name,t.message,e)}}))}static getAudioTrack(e){return tr(this,null,(function*(){return(yield MC.getUserMediaWithTimeout(e)).getAudioTracks()[0]}))}static getVideoTrack(e){return tr(this,null,(function*(){return(yield MC.getUserMediaWithTimeout(e)).getVideoTracks()[0]}))}static getScreenShareTracks(e){return tr(this,null,(function*(){var t,r;let i,n=Ci.hasFeature(DS.EXTENSION_HACK),s=null;if(n)try{RC.port=window.chrome.runtime.connect("nkeimhogjdpnpccoofpliimaahmaaome",{name:"chooseDesktopMedia"})}catch(e){VS.addLogInCurrentSpan("error","Extension connect error"),n=!1}return n&&(s=yield new Promise((e=>{const t=setTimeout((()=>e(void 0)),12e3);RC.port.onMessage.addListener((r=>tr(this,null,(function*(){if(r.value.streamId){const{streamId:i}=r.value;clearTimeout(t),e(i)}})))),RC.port.postMessage({method:"chooseDesktopMedia",sources:["screen"]})}))),s?(VS.addLogInCurrentSpan("error","Acquiring extension screenshare track"),i=yield navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{maxWidth:1920,maxHeight:1080,chromeMediaSource:"desktop",chromeMediaSourceId:s},optional:[{maxFrameRate:parseInt(null!=(t=Ci.getValue(DS.VAL_MAX_FRAMERATE_EXT))?t:"12",10)},{minFrameRate:parseInt(null!=(r=Ci.getValue(DS.VAL_MIN_FRAMERATE_EXT))?r:"8",10)}]}}),VS.addLogInCurrentSpan("error","Acquired extension screenshare track")):i=yield navigator.mediaDevices.getDisplayMedia(e),{video:i.getVideoTracks()[0],audio:i.getAudioTracks()[0]}}))}static getAudioAndVideoTrack(e){return tr(this,null,(function*(){const t=yield MC.getUserMediaWithTimeout(e);return{audioTrack:t.getAudioTracks()[0],videoTrack:t.getVideoTracks()[0]}}))}onDeviceChange(e){_S.supportsDeviceChangeEvent()&&navigator.mediaDevices.addEventListener("devicechange",Yh((t=>tr(this,null,(function*(){const r=this.availableDevices,i=new Set(r.map((e=>e.deviceId)));yield this.repopulateAvailableDevices();const n=this.availableDevices,s=new Set(n.map((e=>e.deviceId))),o={added:n.filter((e=>!i.has(e.deviceId))),removed:r.filter((e=>!s.has(e.deviceId)))};this.repopulateAvailableDevices().then((()=>e(t,o)))}))),100),{signal:Qt(this,PC).signal})}repopulateAvailableDevices(){return tr(this,null,(function*(){let e=yield MC.enumerateDevices();e=e.map((e=>e.toJSON())),!sg(x_(e,Qt(this,IC),og))&&(Zt(this,IC,e),fi.devices("AUDIO",this.getAudioDevices()),fi.devices("VIDEO",this.getVideoDevices()),fi.devices("SPEAKER",this.getSpeakerDevices()),BS.info("repopulated_full_device_list",{devices:JSON.stringify(e)}))}))}get availableDevices(){return Qt(this,IC)}getAvailableDevicesByKind(e){return Qt(this,IC).filter((t=>t.kind===e))}getDeviceById(e,t){return Qt(this,IC).find((r=>r.deviceId===e&&r.kind===t))}getAudioDevices(){return this.getAvailableDevicesByKind("audioinput").sort(((e,t)=>{const r=AC(e)?0:1;return(AC(t)?0:1)-r}))}getVideoDevices(){return this.getAvailableDevicesByKind("videoinput").sort(((e,t)=>{const r=AC(e)?0:1;return(AC(t)?0:1)-r}))}getSpeakerDevices(){return this.getAvailableDevicesByKind("audiooutput").sort(((e,t)=>{const r=AC(e)?0:1;return(AC(t)?0:1)-r}))}},IC=new WeakMap,PC=new WeakMap,DC);let OC=MC;kC([VS.trace("LocalMediaUtils.onDeviceChange")],OC.prototype,"onDeviceChange",1),kC([VS.trace("LocalMediaUtils.repopulateAvailableDevices")],OC.prototype,"repopulateAvailableDevices",1),kC([VS.trace("LocalMediaUtils.isDeviceListAvailable")],OC,"isDeviceListAvailable",1),kC([VS.trace("LocalMediaUtils.enumerateDevices")],OC,"enumerateDevices",1),kC([VS.trace("LocalMediaUtils.getUserMediaWithTimeout")],OC,"getUserMediaWithTimeout",1),kC([VS.trace("LocalMediaUtils.getAudioTrack")],OC,"getAudioTrack",1),kC([VS.trace("LocalMediaUtils.getVideoTrack")],OC,"getVideoTrack",1),kC([VS.trace("LocalMediaUtils.getScreenShareTracks")],OC,"getScreenShareTracks",1),kC([VS.trace("LocalMediaUtils.getAudioAndVideoTrack")],OC,"getAudioAndVideoTrack",1);const NC=(e,t)=>{try{localStorage.setItem(e,t)}catch(r){BS.error("LocalStorage::setItem::crashed",{error:r,localStorage:{key:e,value:t}})}},xC=e=>{try{return localStorage.getItem(e)}catch(t){BS.error("LocalStorage::getItem::crashed",{error:t,localStorage:{key:e}})}return null},LC="undefined"!=typeof AudioContext?AudioContext:null;class jC{constructor(e){Kt(this,"_AudioContext"),Kt(this,"audioContext"),Kt(this,"_audioContextRefContainers");const t=qt({AudioContext:LC},e);Object.defineProperties(this,{_AudioContext:{value:t.AudioContext},audioContext:{value:null,writable:!0},_audioContextRefContainers:{value:new Set},AudioContextProvider:{enumerable:!0,value:jC}})}getOrCreate(e){if(!this._audioContextRefContainers.has(e)&&(this._audioContextRefContainers.add(e),this._AudioContext&&!this.audioContext))try{this.audioContext=new this._AudioContext}catch(e){}return this.audioContext}release(e){this._audioContextRefContainers.has(e)&&(this._audioContextRefContainers.delete(e),!this._audioContextRefContainers.size&&this.audioContext&&(this.audioContext.close(),this.audioContext=null))}}const UC=new jC;function FC(e){return tr(this,null,(function*(){const t=new Audio,r=new MediaStream;r.addTrack(e),t.srcObject=r;let i=!1;try{const e=t.play();e&&(yield e),i=yield function(e){const t={},r=UC.getOrCreate(t);let i=3;return function t(){return i-=1,((e,t,r)=>{const i="number"==typeof r?r:250,n=e.createMediaStreamSource(t),s=e.createAnalyser();s.fftSize=2048,n.connect(s);const o=new Uint8Array(s.fftSize);let a=!1;return setTimeout((()=>{a=!0}),i),function e(){return a?Promise.resolve(!0):(s.getByteTimeDomainData(o),o.some((e=>128!==e&&0!==e))?Promise.resolve(!1):((e=0)=>new Promise((t=>setTimeout(t,e))))().then(e))}().then((e=>(n.disconnect(),e)),(e=>{throw n.disconnect(),e}))})(r,e.srcObject,250).then((e=>!!e&&(!(i>0)||t()))).catch((()=>!0))}().finally((()=>{UC.release(t)}))}(t),i&&BS.info("checkIfAudioTrackIsSilent::silence_detected")}catch(e){BS.error("checkIfAudioTrackIsSilent::failed_to_detect_silence",{error:e})}finally{t.pause(),t.remove()}return i}))}Object.defineProperty,Object.getOwnPropertyDescriptor;let VC=class extends WS{constructor(e,t,r){super(),Kt(this,"constructorName",this.constructor.name),Kt(this,"userSelectedDevice"),Kt(this,"mediaInterface"),Kt(this,"isNonPreferredDevice"),Kt(this,"_mediaTrack"),Kt(this,"transformedMediaTrack"),Kt(this,"middlewares",[]),Kt(this,"currentDevice"),this.mediaInterface=e,t&&this.setMediaTrack(t),this.userSelectedDevice=void 0,this.isNonPreferredDevice=r,this.onTrackEnded=this.onTrackEnded.bind(this),this.onTrackMuted=this.onTrackMuted.bind(this)}disableTrack(){var e,t;this.removeMediaTrackListeners(),null==(e=this._mediaTrack)||e.stop(),this._mediaTrack=void 0,null==(t=this.transformedMediaTrack)||t.stop(),this.transformedMediaTrack=void 0}get mediaTrack(){return this._mediaTrack}setMediaTrack(e){return tr(this,null,(function*(){const t=e=>{BS.error(`${this.constructorName}.setMediaTrack.error`,{error:e})};try{this.disableTrack()}catch(e){t(e)}this._mediaTrack=yield this.conditionallyChangeTrack(e),yield this.setTransformedTrack();try{this.addMediaTrackListeners(),yield this.setCurrentDevice()}catch(e){t(e)}}))}get trackEnabled(){return!!this.mediaTrack&&"live"===this.mediaTrack.readyState&&this.mediaTrack.enabled}muteTrack(){this.mediaTrack?(this.transformedMediaTrack&&(this.transformedMediaTrack.enabled=!1),this.mediaTrack.enabled=!1):BS.warn("BaseMediaHandler.muteTrack Tried muting with no track present")}unmuteTrack(){return tr(this,null,(function*(){try{this.mediaTrack?this.mediaTrack.enabled=!0:yield this.enableTrack(!1)}catch(e){throw BS.error(`${this.constructorName}.unmuteTrack.error`,{error:e}),this.disableTrack(),new qS("Failed to unmute track")}}))}setCurrentDevice(){return tr(this,null,(function*(){var e;this.mediaTrack?(null==(e=this.currentDevice)?void 0:e.deviceId)!==this.mediaTrack.getSettings().deviceId&&(this.currentDevice=yield this.mediaInterface.getDevice(this.mediaTrack.getSettings().deviceId)):this.currentDevice=void 0}))}addMiddleware(e){return tr(this,null,(function*(){if(_S.isWebKitBased()&&!Ci.hasFeature(DS.ALLOW_SAFARI_MEDIA_MIDDLEWARES))return{success:!1,message:"Middlewares are not supported in this WebKit engine based browser."};if(this.middlewares.includes(e))return{success:!1,message:"This middleware has been applied, already. Skipping."};try{return this.middlewares.push(e),this.trackEnabled&&(yield this.setTransformedTrack()),{success:!0,message:"Successfully added the middleware."}}catch(t){return BS.error("While adding middleware",{error:t}),this.removeMiddleware(e),{success:!1,message:null==t?void 0:t.message}}}))}removeMiddleware(e){return tr(this,null,(function*(){const t=this.middlewares.indexOf(e,0);if(t>-1)try{return this.middlewares.splice(t,1),yield this.setTransformedTrack(!0),{success:!0,message:"Successfully removed the middleware."}}catch(e){return BS.error("While removing middleware",{error:e}),{success:!1,message:null==e?void 0:e.message}}return{success:!1,message:"No such middleware was found. Skipping."}}))}addMediaTrackListeners(){var e,t,r;this.mediaTrack&&(BS.info(`${this.constructorName}.addMediaTrackListeners for deviceId ${null==(t=null==(e=this.mediaTrack)?void 0:e.getSettings())?void 0:t.deviceId} of type ${null==(r=this.mediaTrack)?void 0:r.kind}`),this.mediaTrack.addEventListener("ended",this.onTrackEnded),this.mediaTrack.addEventListener("mute",this.onTrackMuted))}removeMediaTrackListeners(){var e,t,r;this.mediaTrack&&(BS.info(`${this.constructorName}.removeMediaTrackListeners for deviceId ${null==(t=null==(e=this.mediaTrack)?void 0:e.getSettings())?void 0:t.deviceId} of type ${null==(r=this.mediaTrack)?void 0:r.kind}`),BS.info(`${this.constructorName}.removeMediaTrackListeners`),this.mediaTrack.removeEventListener("ended",this.onTrackEnded),this.mediaTrack.removeEventListener("mute",this.onTrackMuted))}};VC=((e,t,r,i)=>{for(var n,s=t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(s)||s);return s})([KS((e=>{throw new qS(e.message,"1600")}))],VC);const BC=VC;var WC=Object.defineProperty,HC=Object.getOwnPropertyDescriptor,GC=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?HC(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&WC(t,r,s),s};const $C="[Dyte]nonSilentDeviceLabels";class qC extends BC{setDevice(e){return tr(this,null,(function*(){if(!e)throw BS.warn("AudioMediaHandler.setDevice No device received"),new qS("No device received!","1603");if("audioinput"!==e.kind)throw BS.warn("AudioMediaHandler.setDevice Received non audio device"),new qS("Non audio device received while setting device!","1603");try{const t=this.trackEnabled;this.userSelectedDevice=e.deviceId,yield this.setMediaTrack(yield this.mediaInterface.getAudioTrack(!t,e.deviceId))}catch(e){throw BS.error("AudioMediaHandler.setDevice.error",{error:e}),this.disableTrack(),new qS(e.message,"1604")}}))}enableTrack(e){return tr(this,null,(function*(){if(this.trackEnabled)return void BS.warn("AudioMediaHandler.enableTrack Track already enabled!");const t=yield this.mediaInterface.getAudioTrack(e,this.userSelectedDevice);yield this.setMediaTrack(t)}))}setTransformedTrack(e){return tr(this,null,(function*(){var t;if(e||null!=(t=this.middlewares)&&t.length)try{this.transformedMediaTrack=yield function(e,t){return tr(this,null,(function*(){if(null==e||!e.length)return t;const r=new AudioContext,i=yield Promise.all(null==e?void 0:e.map((e=>e(r)))),n=r.createMediaStreamSource(new MediaStream([t])),s=r.createMediaStreamDestination();try{let e=n;for(let t=0;t<i.length;t+=1)e.connect(i[t]),e=i[t];e.connect(s)}catch(e){return BS.error("getTransformedAudioTrack::middleware_execution_failed",{error:e}),t}return s.stream.getAudioTracks()[0]}))}(this.middlewares,this.mediaTrack),this.emit("trackChanged")}catch(e){BS.error("AudioMediaHandler.setTransformedTrack",{error:e}),this.transformedMediaTrack=this.mediaTrack}else this.transformedMediaTrack=this.mediaTrack}))}onTrackEnded(){return tr(this,null,(function*(){BS.info("AudioMediaHandler.TrackEnded"),this.emit("trackEnded");const e=this.mediaTrack.enabled;this.disableTrack(),yield this.enableTrack(!e),yield this.setTransformedTrack(),this.emit("trackChanged")}))}onTrackMuted(){BS.info("AudioMediaHandler.TrackMuted"),this.emit("trackMuted")}conditionallyChangeTrack(e){return tr(this,null,(function*(){var t;if(!e||this.userSelectedDevice)return e;let r=e;const i=yield this.mediaInterface.getAudioInputDevices(),n=this.isNonPreferredDevice?i.filter((e=>e&&!this.isNonPreferredDevice(e))):i;if(null==n||!n.length)return r;n.find((t=>t.deviceId===e.getSettings().deviceId))||(r.stop(),BS.info("localmediahandler::setupstreams::found_audio_non_preferred"),r=yield this.mediaInterface.getAudioTrack(!1,n[0].deviceId));const s=JSON.parse(xC($C));if(null!=s&&s.devices.some((e=>e.label===r.label)))return r;if(!(yield FC(r))){const e=null!=(t=null==s?void 0:s.devices.concat({label:r.label}))?t:[{label:r.label}];return NC($C,JSON.stringify({devices:e})),r}BS.info("AudioMediaHandler.conditionallyChangeTrack.DetectedSilentTrack");const o=r.getSettings().deviceId;return n.filter((e=>e.deviceId!==o)).some((e=>tr(this,null,(function*(){if(r=yield this.mediaInterface.getAudioTrack(!1,e.deviceId),!(yield FC(r))){const e=s.devices.concat({label:r.label});return NC($C,JSON.stringify({devices:e})),BS.info("AudioMediaHandler.conditionallyChangeTrack.SuccesfullyChangedTrack"),!0}return BS.info("AudioMediaHandler.conditionallyChangeTrack.AnotherSilentTrackFound"),!1})))),r}))}}function zC(e,t,r){if(_S.isChromiumBased()){if("NotAllowedError"===t)return r.indexOf("by system")>0?"SYSTEM_DENIED":"screenshare"===e?"CANCELED":"DENIED";if("NotReadableError"===t)return"COULD_NOT_START"}else if(_S.isSafari()){if("NotAllowedError"===t)return"DENIED"}else if(_S.isFirefox()){if("NotFoundError"===t||"NotReadableError"===t)return"SYSTEM_DENIED";if("NotAllowedError"===t)return"DENIED";if("AbortError"===t)return"COULD_NOT_START"}return"COULD_NOT_START"}function JC(e){return e===2..toString()?Lr.DENIED:e===4..toString()?Lr.SYS_DENIED:e===1..toString()?Lr.ACCEPTED:Lr.FAILED}GC([VS.trace("AudioMediaHandler.setTransformedTrack")],qC.prototype,"setTransformedTrack",1),GC([VS.trace("AudioMediaHandler.onTrackEnded")],qC.prototype,"onTrackEnded",1),GC([VS.trace("AudioMediaHandler.conditionallyChangeTrack")],qC.prototype,"conditionallyChangeTrack",1);class KC{constructor(){Kt(this,"permissions"),this.permissions={audio:"NOT_REQUESTED",video:"NOT_REQUESTED",screenshare:"NOT_REQUESTED"}}getAudioInputDevices(){return tr(this,null,(function*(){return(yield this.getAvailableDevices()).filter((e=>"audioinput"===e.kind))}))}getVideoInputDevices(){return tr(this,null,(function*(){return(yield this.getAvailableDevices()).filter((e=>"videoinput"===e.kind))}))}getAudioOutputDevices(){return tr(this,null,(function*(){return(yield this.getAvailableDevices()).filter((e=>"audiooutput"===e.kind))}))}}var YC,QC,XC,ZC,eA=Object.defineProperty,tA=Object.getOwnPropertyDescriptor,rA=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?tA(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&eA(t,r,s),s};let iA=(ZC=class extends KC{constructor(e){super(),Xt(this,YC,void 0),Xt(this,QC,void 0),Xt(this,XC,void 0),Zt(this,XC,new NS(e)),Zt(this,QC,new AbortController),this.getAvailableDevices()}get constraintsBuilder(){return Qt(this,XC)}destruct(){return tr(this,null,(function*(){var e;null==(e=Qt(this,QC))||e.abort()}))}handlePermissionErrors(e,t){const r=zC(e,t.name,t.message);this.permissions[e]=r,tE.emit(XS.MEDIA_PERMISSION_ERROR,{message:r,constraints:t.constraints,kind:e})}getAudioAndVideoTrack(){return tr(this,null,(function*(){const e={audio:Qt(this,XC).getAudioConstraints().audio,video:Qt(this,XC).getVideoConstraints().video};try{BS.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(e)});const t=yield navigator.mediaDevices.getUserMedia(e);BS.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(e)});const r=t.getAudioTracks()[0];let i=t.getVideoTracks()[0];if(this.permissions.audio="ACCEPTED",this.permissions.video="ACCEPTED",Ci.hasFeature(DS.OBS_QUALITY)&&i.label.includes("OBS Virtual")){const e=(yield this.getVideoInputDevices()).find((e=>e.label.includes("OBS Virtual")));i=yield this.getVideoTrack(e.deviceId)}return tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),{audioTrack:r,videoTrack:i}}catch(e){throw BS.error("WebMediaInterface.getAudioAndVideoTrack",{error:e}),new qS("Couldnt fetch audio and video track")}}))}getAudioTrack(e,t){return tr(this,null,(function*(){const r=Qt(this,XC).getAudioConstraints(t);try{BS.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(r)});const t=(yield navigator.mediaDevices.getUserMedia(r)).getAudioTracks()[0];return BS.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(r)}),t.enabled=!e,this.permissions.audio="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),t}catch(e){throw this.handlePermissionErrors("audio",new TC(e.name,e.message,r)),new qS(e.message,"1601")}}))}getScreenShareTracks(){return tr(this,null,(function*(){const e=Qt(this,XC).getScreenShareConstraints();try{BS.info("getDisplayMediaWithoutTimeout::requesting_display_media",{constraints:JSON.stringify(e)});const t=yield navigator.mediaDevices.getDisplayMedia(e);return BS.info("getDisplayMediaWithoutTimeout::received_display_media",{constraints:JSON.stringify(e)}),this.permissions.screenshare="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.screenshare,kind:"screenshare"}),{audioTrack:t.getAudioTracks()[0],videoTrack:t.getVideoTracks()[0]}}catch(t){throw this.handlePermissionErrors("screenshare",new TC(t.name,t.message,e)),BS.error("WebMediaInterface.getScreenShareTracks Error while fetching screenshare tracks",{error:t}),new qS("Couldnt fetch screen share tracks")}}))}getCurrentDeviceLabel(e){return tr(this,null,(function*(){const t=yield this.getDevice(e||"default");return null==t?void 0:t.label}))}getVideoTrack(e){return tr(this,null,(function*(){const t=Ci.hasFeature(DS.OBS_QUALITY),r=yield this.getCurrentDeviceLabel(e),i=r&&r.includes("OBS Virtual"),{video:n}=Qt(this,XC).getVideoConstraints(e);let s={};s=t&&i&&"boolean"!=typeof n?{deviceId:n.deviceId}:n;try{const e=(yield navigator.mediaDevices.getUserMedia({video:s})).getVideoTracks()[0];if(t&&i&&"boolean"!=typeof n&&"object"==typeof n.width){const{width:t,height:r}=e.getSettings(),{ideal:i}=n.width;e.applyConstraints({width:{ideal:i},height:{ideal:Math.floor(r*i/t)},frameRate:n.frameRate})}return this.permissions.video="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),e}catch(e){throw this.handlePermissionErrors("video",new TC(e.name,e.message,s)),BS.error("WebMediaInterface.getVideoTrack Error while fetching video track",{error:e}),new qS("Couldnt fetch video track")}}))}getAvailableDevices(){return tr(this,null,(function*(){try{return yield navigator.mediaDevices.enumerateDevices()}catch(e){throw BS.error("enumerate_devices_failed",{error:e}),new qS("Failed to get available devices")}}))}getAvailableDevicesByKind(e){return tr(this,null,(function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((({kind:t})=>e===t))}catch(e){throw BS.error("enumerate_devices_failed",{error:e}),new qS("Failed to get available devices by kind")}}))}getDevice(e){return tr(this,null,(function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((t=>t.deviceId===e))[0]}catch(e){throw BS.error("enumerate_devices_failed",{error:e}),new qS("Failed to get device")}}))}onDeviceChange(e){return tr(this,null,(function*(){var t;if(null==(t=Qt(this,YC))||!t.length){const t=yield this.getAvailableDevices();null!=t&&t.length&&(Zt(this,YC,t),e(null,{added:t,removed:[]},!0))}_S.supportsDeviceChangeEvent()&&navigator.mediaDevices.addEventListener("devicechange",Yh((t=>tr(this,null,(function*(){var r,i;const n=Qt(this,YC),s=new Set(n.map((e=>e.deviceId))),o=yield this.getAvailableDevices(),a=new Set(o.map((e=>e.deviceId))),c={added:o.filter((e=>!s.has(e.deviceId))),removed:n.filter((e=>!a.has(e.deviceId)))};Zt(this,YC,o),(null!=(r=c.added)&&r.length||null!=(i=c.removed)&&i.length)&&e(t,c,!1)}))),100),{signal:Qt(this,QC).signal})}))}},YC=new WeakMap,QC=new WeakMap,XC=new WeakMap,ZC);rA([VS.trace("WebMediaInterface.destruct")],iA.prototype,"destruct",1),rA([VS.trace("WebMediaInterface.handlePermissionErrors")],iA.prototype,"handlePermissionErrors",1),rA([VS.trace("WebMediaInterface.getAudioAndVideoTrack")],iA.prototype,"getAudioAndVideoTrack",1),rA([VS.trace("WebMediaInterface.getAudioTrack")],iA.prototype,"getAudioTrack",1),rA([VS.trace("WebMediaInterface.getScreenShareTracks")],iA.prototype,"getScreenShareTracks",1),rA([VS.trace("WebMediaInterface.getVideoTrack")],iA.prototype,"getVideoTrack",1),rA([VS.trace("WebMediaInterface.getAvailableDevices")],iA.prototype,"getAvailableDevices",1),rA([VS.trace("WebMediaInterface.getAvailableDevicesByKind")],iA.prototype,"getAvailableDevicesByKind",1),rA([VS.trace("WebMediaInterface.getDevice")],iA.prototype,"getDevice",1),rA([VS.trace("WebMediaInterface.onDeviceChange")],iA.prototype,"onDeviceChange",1),iA=rA([KS((e=>{throw new qS(e.message,"1600")}))],iA);const nA=iA;var sA,oA;class aA{constructor(e){Xt(this,sA,void 0),Kt(this,"currentDevice"),Zt(this,sA,e)}setupSpeaker(e){return tr(this,null,(function*(){var t;if(!(Qt(this,sA)instanceof nA))return;let r=e;if(e||([r]=yield Qt(this,sA).getAvailableDevicesByKind("audiooutput")),!r)throw new qS("No speaker found");(null==(t=this.currentDevice)?void 0:t.deviceId)!==r.deviceId&&(null!=this.currentDevice||(this.currentDevice=r),document.querySelectorAll("audio").forEach((e=>tr(this,null,(function*(){if(void 0!==e.sinkId&&this.currentDevice.deviceId&&e.sinkId!==this.currentDevice.deviceId)try{yield e.setSinkId(this.currentDevice.deviceId)}catch(e){}})))))}))}}sA=new WeakMap;class cA extends WS{constructor(e){super(),Kt(this,"mediaInterface"),Kt(this,"audioMediaTrack"),Kt(this,"videoMediaTrack"),this.mediaInterface=e}get trackEnabled(){return!!this.videoMediaTrack}enableScreenShare(){return tr(this,null,(function*(){var e,t;const{audioTrack:r,videoTrack:i}=yield this.mediaInterface.getScreenShareTracks();this.audioMediaTrack=r,this.videoMediaTrack=i,this.addMediaTrackListeners(),"ACCEPTED"!==(null==(t=null==(e=this.mediaInterface)?void 0:e.permissions)?void 0:t.screenshare)&&this.mediaInterface.permissions&&(this.mediaInterface.permissions.screenshare="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.mediaInterface.permissions.screenshare,kind:"screenshare"}))}))}disableScreenShare(){var e,t;this.removeMediaTrackListeners(),null==(e=this.audioMediaTrack)||e.stop(),null==(t=this.videoMediaTrack)||t.stop(),this.videoMediaTrack=void 0,this.audioMediaTrack=void 0}updateConstraints(e){return tr(this,null,(function*(){if(!this.videoMediaTrack)throw new qS("No media track enabled!");const t=this.mediaInterface;if(!t.constraintsBuilder)throw new qS("update constraints not supported for non web clients","1100");try{this.videoMediaTrack.applyConstraints(t.constraintsBuilder.getUpdatedVideoConstraints(e)),this.addMediaTrackListeners()}catch(e){BS.error("ScreenShareHandler.updateConstraints.error",{error:e})}}))}addMediaTrackListeners(){var e;null==(e=this.videoMediaTrack)||e.addEventListener("ended",this.onTrackEnded.bind(this))}removeMediaTrackListeners(){var e;null==(e=this.videoMediaTrack)||e.removeEventListener("ended",this.onTrackEnded)}onTrackEnded(){this.emit("trackEnded")}}class dA{constructor(){Xt(this,oA,void 0)}terminateMiddlewareWebWorker(){if(Qt(this,oA))try{Ot(Qt(this,oA)),Zt(this,oA,void 0)}catch(e){BS.debug("WorkerTimers::terminateMiddlewareWebWorker::failed")}}getTransformedVideoTrack(e,t){return tr(this,null,(function*(){if(null==e||!e.length)return t;const r=yield Promise.all(null==e?void 0:e.map((e=>e()))),i=new MediaStream;i.addTrack(t);const n=document.createElement("canvas"),s=n.getContext("2d"),o=document.createElement("video");o.srcObject=i,o.autoplay=!0,this.terminateMiddlewareWebWorker();const a=()=>tr(this,null,(function*(){if(!1===t.enabled||"ended"===t.readyState)return this.terminateMiddlewareWebWorker(),o.remove(),void n.remove();try{s.drawImage(o,0,0);for(let e=0;e<r.length;e+=1)yield r[e](n,s)}catch(e){BS.error("getTransformedVideoTrack::middleware_execution_failed",{error:e})}}));try{o.play()}catch(e){}return o.addEventListener("play",(()=>{n.width=o.width||t.getSettings().width,n.height=o.width||t.getSettings().height,Zt(this,oA,Nt(a,50))}),!1),n.captureStream().getVideoTracks()[0]}))}}oA=new WeakMap;var lA,uA=Object.defineProperty,pA=Object.getOwnPropertyDescriptor,hA=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?pA(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&uA(t,r,s),s};class mA extends BC{constructor(e,t,r){super(e,t,r),Xt(this,lA,void 0),Zt(this,lA,new dA)}setDevice(e){return tr(this,null,(function*(){if(!e)throw BS.warn("VideoMediaHandler.setDevice No device received"),new qS("No device received!");if("videoinput"!==e.kind)throw BS.warn("VideoMediaHandler.setDevice Received non video device",{devices:[e]}),new qS("Non video device received while setting video device!");if(this.userSelectedDevice=e.deviceId,!this.mediaTrack||!this.mediaTrack.enabled)return BS.warn("VideoMediaHandler.setDevice Tried switching device with video disabled",{devices:[e]}),void(this.currentDevice=e);try{yield this.setMediaTrack(yield this.mediaInterface.getVideoTrack(this.userSelectedDevice))}catch(e){throw BS.error("VideoMediaHandler.setDevice.error",{error:e}),this.disableTrack(),new qS("Failed to change device")}}))}enableTrack(){return tr(this,null,(function*(){this.trackEnabled?BS.warn("VideoMediaHandler.enableTrack Track already enabled!"):yield this.setMediaTrack(yield this.mediaInterface.getVideoTrack(this.userSelectedDevice))}))}setTransformedTrack(e){return tr(this,null,(function*(){var t;if(e||null!=(t=this.middlewares)&&t.length)try{this.transformedMediaTrack=yield Qt(this,lA).getTransformedVideoTrack(this.middlewares,this.mediaTrack),this.emit("trackChanged")}catch(e){BS.error("VideoMediaHandler.setTransformedTrack",{error:e}),this.transformedMediaTrack=this.mediaTrack}else this.transformedMediaTrack=this.mediaTrack}))}updateConstraints(e){return tr(this,null,(function*(){if(!this._mediaTrack)throw new qS("No media track enabled!");const t=this.mediaInterface;if(!t.constraintsBuilder)throw new qS("update constraints not supported for non web clients","1100");try{this._mediaTrack.applyConstraints(t.constraintsBuilder.getUpdatedVideoConstraints(e)),yield this.setTransformedTrack(),this.addMediaTrackListeners(),yield this.setCurrentDevice()}catch(e){BS.error("VideoMediaHandler.updateConstraints.error",{error:e})}}))}terminateMiddlewareWebWorker(){Qt(this,lA).terminateMiddlewareWebWorker()}onTrackEnded(){return tr(this,null,(function*(){BS.info("VideoMediaHandler.TrackEnded"),this.disableTrack(),this.emit("trackEnded")}))}onTrackMuted(){BS.info("VideoMediaHandler.TrackMuted"),this.emit("trackMuted")}conditionallyChangeTrack(e){return tr(this,null,(function*(){if(!e||this.userSelectedDevice)return e;let t=e;const r=yield this.mediaInterface.getVideoInputDevices(),i=this.isNonPreferredDevice?r.filter((e=>!this.isNonPreferredDevice(e))):r;return!(null!=i&&i.length)||window.FAST_DYTE||i.find((t=>t.deviceId===e.getSettings().deviceId))||(t.stop(),BS.info("localmediahandler::setupstreams::found_video_non_preferred"),t=yield this.mediaInterface.getVideoTrack(i[0].deviceId)),t}))}}lA=new WeakMap,hA([VS.trace("VideoMediaHandler.setTransformedTrack")],mA.prototype,"setTransformedTrack",1),hA([VS.trace("VideoMediaHandler.onTrackEnded")],mA.prototype,"onTrackEnded",1),hA([VS.trace("VideoMediaHandler.conditionallyChangeTrack")],mA.prototype,"conditionallyChangeTrack",1);var fA,gA,vA,yA,_A,SA,EA=Object.defineProperty,TA=Object.getOwnPropertyDescriptor,bA=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?TA(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&EA(t,r,s),s};class wA extends WS{constructor(e,t=AC,r=!0){super(),Xt(this,fA,void 0),Xt(this,gA,void 0),Xt(this,vA,void 0),Xt(this,yA,void 0),Xt(this,_A,void 0),Xt(this,SA,void 0),Kt(this,"audioUpdateInProgress"),Kt(this,"videoUpdateInProgress"),this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,Zt(this,fA,new nA(e)),Zt(this,gA,new qC(Qt(this,fA),void 0,t)),Zt(this,vA,new mA(Qt(this,fA),void 0,t)),Zt(this,_A,new cA(Qt(this,fA))),Zt(this,yA,new aA(Qt(this,fA))),Zt(this,SA,r),Qt(this,gA).on("trackMuted",this.onAudioTrackMuted.bind(this)),Qt(this,gA).on("trackChanged",this.onAudioTrackChanged.bind(this)),Qt(this,vA).on("trackChanged",this.onVideoTrackChanged.bind(this)),Qt(this,vA).on("trackEnded",this.onVideoTrackEnded.bind(this)),Qt(this,_A).on("trackEnded",this.onScreenShareEnded.bind(this)),this.onVisibilityChange=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){fi.tabChanged("visible"===document.visibilityState),"visible"!==document.visibilityState?fi.browserBackgrounded():fi.browserForegrounded()}repopulateAvailableDevices(){return tr(this,null,(function*(){return!0}))}setupStreams(e){return tr(this,arguments,(function*({audio:e,video:t}){let r,i;if(e&&t)try{const e=yield Qt(this,fA).getAudioAndVideoTrack();r=e.audioTrack,i=e.videoTrack}catch(e){BS.error("LocalMediaHandler::init::Failed to get audio video tracks",{error:e})}if(!r&&e)try{r=yield Qt(this,fA).getAudioTrack(!1)}catch(e){BS.error("LocalMediaHandler::init::Failed to get audio track",{error:e})}if(!i&&t)try{i=yield Qt(this,fA).getVideoTrack()}catch(e){BS.error("LocalMediaHandler::init::Failed to get video track",{error:e})}yield Qt(this,gA).setMediaTrack(r),yield Qt(this,vA).setMediaTrack(i);try{yield Qt(this,yA).setupSpeaker()}catch(e){}Qt(this,fA).onDeviceChange(((e,t,r)=>{this.onDeviceChange(t,r)}))}))}getCurrentDevices(){return{audio:Qt(this,gA).currentDevice,video:Qt(this,vA).currentDevice,speaker:Qt(this,yA).currentDevice}}get permissions(){return Qt(this,fA).permissions}getAllDevices(){return Qt(this,fA).getAvailableDevices()}getDeviceById(e,t){return Qt(this,fA).getDevice(e)}onAudioTrackMuted(){this.emit("AUDIO_TRACK_SILENT")}onAudioTrackChanged(){this.emit("AUDIO_TRACK_CHANGE")}get rawAudioTrack(){return Qt(this,gA).mediaTrack}get audioTrack(){return Qt(this,gA).transformedMediaTrack}get audioEnabled(){return Qt(this,gA).trackEnabled}enableAudio(){return tr(this,null,(function*(){if(!this.audioUpdateInProgress){this.audioUpdateInProgress=!0;try{yield Qt(this,gA).unmuteTrack()}finally{this.audioUpdateInProgress=!1}}}))}disableAudio(){Qt(this,gA).muteTrack()}getAudioDevices(){return Qt(this,fA).getAudioInputDevices()}setAudioDevice(e){return tr(this,null,(function*(){yield Qt(this,gA).setDevice(e),this.emit("AUDIO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:e})}))}setupSpeaker(){return Qt(this,yA).setupSpeaker()}setSpeakerDevice(e){return tr(this,null,(function*(){yield Qt(this,yA).setupSpeaker(e),this.emit("DEVICE_CHANGE",{device:e})}))}onVideoTrackChanged(){this.emit("VIDEO_TRACK_CHANGE")}onVideoTrackEnded(){this.emit("VIDEO_TRACK_CHANGE")}get rawVideoTrack(){return Qt(this,vA).mediaTrack}get videoTrack(){return Qt(this,vA).transformedMediaTrack}get videoEnabled(){return Qt(this,vA).trackEnabled}enableVideo(){return tr(this,null,(function*(){if(!this.videoUpdateInProgress){this.videoUpdateInProgress=!0;try{yield Qt(this,vA).unmuteTrack()}finally{this.videoUpdateInProgress=!1}}}))}disableVideo(){Qt(this,vA).disableTrack()}getVideoDevices(){return Qt(this,fA).getVideoInputDevices()}setVideoDevice(e){return tr(this,null,(function*(){yield Qt(this,vA).setDevice(e),this.emit("VIDEO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:e})}))}updateVideoConstraints(e){return tr(this,null,(function*(){yield Qt(this,vA).updateConstraints(e)}))}onScreenShareEnded(){this.emit("SCREENSHARE_ENDED")}get screenShareTracks(){return{audio:Qt(this,_A).audioMediaTrack,video:Qt(this,_A).videoMediaTrack}}get screenShareEnabled(){return Qt(this,_A).trackEnabled}enableScreenShare(){return tr(this,null,(function*(){yield Qt(this,_A).enableScreenShare()}))}disableScreenShare(){return tr(this,null,(function*(){Qt(this,_A).disableScreenShare()}))}updateScreenshareConstraints(e){return tr(this,null,(function*(){yield Qt(this,_A).updateConstraints(e)}))}getSpeakerDevices(){return Qt(this,fA).getAudioOutputDevices()}addAudioMiddleware(e){return Qt(this,gA).addMiddleware(e)}removeAudioMiddleware(e){return Qt(this,gA).removeMiddleware(e)}addVideoMiddleware(e){return Qt(this,vA).addMiddleware(e)}removeVideoMiddleware(e){return Qt(this,vA).removeMiddleware(e)}destruct(){Qt(this,gA).disableTrack(),Qt(this,vA).disableTrack(),Qt(this,vA).terminateMiddlewareWebWorker(),Qt(this,_A).disableScreenShare(),Qt(this,fA).destruct()}onDeviceChange(e,t){return tr(this,null,(function*(){var r;const i=yield Qt(this,fA).getAvailableDevices();BS.info("repopulated_full_device_list",{devices:JSON.stringify(i)}),fi.onSafeInitialization((()=>tr(this,null,(function*(){fi.devices("AUDIO",null==i?void 0:i.filter((e=>"audioinput"===e.kind))),fi.devices("VIDEO",null==i?void 0:i.filter((e=>"videoinput"===e.kind))),fi.devices("SPEAKER",null==i?void 0:i.filter((e=>"audiooutput"===e.kind)))})))),this.emit("DEVICE_LIST_UPDATED",e),!t&&Qt(this,SA)&&(null==(r=null==e?void 0:e.added)||r.forEach((e=>tr(this,null,(function*(){var t;e&&!AC(e)&&("audioinput"===e.kind&&!0===(null==(t=this.audioTrack)?void 0:t.enabled)?yield this.setAudioDevice(e):"audiooutput"===e.kind&&(yield this.setSpeakerDevice(e)))})))))}))}removeAllTracks(){this.destruct()}removeDocumentEventListeners(){return tr(this,null,(function*(){document.removeEventListener("visibilitychange",this.onVisibilityChange)}))}}fA=new WeakMap,gA=new WeakMap,vA=new WeakMap,yA=new WeakMap,_A=new WeakMap,SA=new WeakMap,bA([VS.trace("MediaHandler.setupStreams")],wA.prototype,"setupStreams",1),bA([VS.trace("MediaHandler.enableAudio")],wA.prototype,"enableAudio",1),bA([VS.trace("MediaHandler.disableAudio")],wA.prototype,"disableAudio",1),bA([VS.trace("MediaHandler.setAudioDevice")],wA.prototype,"setAudioDevice",1),bA([VS.trace("MediaHandler.enableVideo")],wA.prototype,"enableVideo",1),bA([VS.trace("MediaHandler.disableVideo")],wA.prototype,"disableVideo",1),bA([VS.trace("MediaHandler.setVideoDevice")],wA.prototype,"setVideoDevice",1),bA([VS.trace("MediaHandler.updateVideoConstraints")],wA.prototype,"updateVideoConstraints",1),bA([VS.trace("MediaHandler.enableScreenShare")],wA.prototype,"enableScreenShare",1),bA([VS.trace("MediaHandler.disableScreenShare")],wA.prototype,"disableScreenShare",1),bA([VS.trace("MediaHandler.updateScreenshareConstraints")],wA.prototype,"updateScreenshareConstraints",1),bA([VS.trace("MediaHandler.destruct")],wA.prototype,"destruct",1),bA([VS.trace("MediaHandler.onDeviceChange")],wA.prototype,"onDeviceChange",1);var kA,RA,CA=Object.defineProperty,AA=Object.getOwnPropertyDescriptor,IA=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?AA(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&CA(t,r,s),s};class PA{constructor(e){Xt(this,kA,void 0),Kt(this,"audioMiddlewares",[]),Kt(this,"videoMiddlewares",[]),Xt(this,RA,void 0),Zt(this,kA,e)}terminateMiddlewareWebWorker(){if(Qt(this,RA))try{Ot(Qt(this,RA)),Zt(this,RA,void 0)}catch(e){BS.debug("WorkerTimers::terminateMiddlewareWebWorker::failed")}}getTransformedVideoTrack(e){return tr(this,null,(function*(){var t,r;if(null==(t=this.videoMiddlewares)||!t.length)return e;const i=yield Promise.all(null==(r=this.videoMiddlewares)?void 0:r.map((e=>e()))),n=new MediaStream;n.addTrack(e);const s=document.createElement("canvas"),o=s.getContext("2d"),a=document.createElement("video");a.srcObject=n,a.autoplay=!0,this.terminateMiddlewareWebWorker();const c=()=>tr(this,null,(function*(){if(!Qt(this,kA).videoEnabled||"ended"===e.readyState)return this.terminateMiddlewareWebWorker(),a.remove(),void s.remove();try{o.drawImage(a,0,0);for(let e=0;e<i.length;e+=1)yield i[e](s,o)}catch(e){BS.error("getTransformedVideoTrack::middleware_execution_failed",{error:e})}}));try{a.play()}catch(e){}return a.addEventListener("play",(()=>{s.width=a.width||e.getSettings().width,s.height=a.width||e.getSettings().height,Zt(this,RA,Nt(c,50))}),!1),s.captureStream().getVideoTracks()[0]}))}addVideoMiddleware(e){return tr(this,null,(function*(){return _S.isWebKitBased()&&!Ci.hasFeature(DS.ALLOW_SAFARI_MEDIA_MIDDLEWARES)?{success:!1,message:"Video middlewares are not supported in this WebKit engine based browser."}:this.videoMiddlewares.includes(e)?{success:!0,message:"This video middleware has been applied, already. Skipping."}:(this.videoMiddlewares.push(e),Qt(this,kA).videoEnabled?(Qt(this,kA).setVideoTrack(yield this.getTransformedVideoTrack(Qt(this,kA).rawVideoTrack)),Qt(this,kA).emit("VIDEO_TRACK_CHANGE"),{success:!0,message:"Successfully applied the video middleware."}):{success:!0,message:"Successfully added the video middleware. It will be applied automatically once webcam is turned on."})}))}removeVideoMiddleware(e){return tr(this,null,(function*(){const t=this.videoMiddlewares.indexOf(e,0);return t>-1?(this.videoMiddlewares.splice(t,1),Qt(this,kA).videoEnabled&&(Qt(this,kA).setVideoTrack(yield this.getTransformedVideoTrack(Qt(this,kA).rawVideoTrack)),Qt(this,kA).emit("VIDEO_TRACK_CHANGE")),{success:!0,message:"Successfully removed the video middleware."}):{success:!0,message:"No such video middleware was found. Skipping."}}))}getTransformedAudioTrack(e){return tr(this,null,(function*(){var t,r;if(null==(t=this.audioMiddlewares)||!t.length)return e;const i=new AudioContext,n=yield Promise.all(null==(r=this.audioMiddlewares)?void 0:r.map((e=>e(i)))),s=i.createMediaStreamSource(new MediaStream([e])),o=i.createMediaStreamDestination();try{let e=s;for(let t=0;t<n.length;t+=1)e.connect(n[t]),e=n[t];e.connect(o)}catch(t){return BS.error("getTransformedAudioTrack::middleware_execution_failed",{error:t}),e}return o.stream.getAudioTracks()[0]}))}addAudioMiddleware(e){return tr(this,null,(function*(){return _S.isWebKitBased()&&!Ci.hasFeature(DS.ALLOW_SAFARI_MEDIA_MIDDLEWARES)?{success:!1,message:"Audio middlewares are not supported in this WebKit engine based browser."}:this.audioMiddlewares.includes(e)?{success:!0,message:"This audio middleware has been applied, already. Skipping."}:(this.audioMiddlewares.push(e),Qt(this,kA).audioEnabled?(Qt(this,kA).setAudioTrack(yield this.getTransformedAudioTrack(Qt(this,kA).rawAudioTrack)),Qt(this,kA).emit("AUDIO_TRACK_CHANGE"),{success:!0,message:"Successfully applied the audio middleware."}):{success:!0,message:"Successfully added the audio middleware. It will be applied automatically once mic is turned on."})}))}removeAudioMiddleware(e){return tr(this,null,(function*(){const t=this.audioMiddlewares.indexOf(e,0);return t>-1?(this.audioMiddlewares.splice(t,1),Qt(this,kA).audioEnabled&&(Qt(this,kA).setAudioTrack(yield this.getTransformedAudioTrack(Qt(this,kA).rawAudioTrack)),Qt(this,kA).emit("AUDIO_TRACK_CHANGE")),{success:!0,message:"Successfully removed the audio middleware."}):{success:!0,message:"No such audio middleware was found. Skipping."}}))}}kA=new WeakMap,RA=new WeakMap,IA([VS.trace("MediaMiddlewareUtils.getTransformedVideoTrack")],PA.prototype,"getTransformedVideoTrack",1),IA([VS.trace("MediaMiddlewareUtils.addVideoMiddleware")],PA.prototype,"addVideoMiddleware",1),IA([VS.trace("MediaMiddlewareUtils.removeVideoMiddleware")],PA.prototype,"removeVideoMiddleware",1),IA([VS.trace("MediaMiddlewareUtils.getTransformedAudioTrack")],PA.prototype,"getTransformedAudioTrack",1),IA([VS.trace("MediaMiddlewareUtils.addAudioMiddleware")],PA.prototype,"addAudioMiddleware",1),IA([VS.trace("MediaMiddlewareUtils.removeAudioMiddleware")],PA.prototype,"removeAudioMiddleware",1);const DA=class{constructor(){Kt(this,"mediaPermissionEvent"),this.mediaPermissionEvent=!0}static getInstance(){return DA.instance||(DA.instance=new DA),DA.instance}get shouldEmitMediaPermissionEvent(){return this.mediaPermissionEvent}setEmitMediaPermissionEvent(e){this.mediaPermissionEvent=e}};let MA=DA;Kt(MA,"instance");const OA=MA.getInstance(),NA={lowVolumeThreshold:-40,clipThreshold:1,silentThreshold:1/1987,delay:500,media:"audio"};var xA,LA,jA,UA,FA,VA;const BA=class{constructor(e){Xt(this,jA),Xt(this,FA),Kt(this,"analyser"),Kt(this,"silentThreshold"),Kt(this,"lowVolumeThreshold"),Kt(this,"clipThreshold"),Kt(this,"delay"),Kt(this,"audioContext"),Kt(this,"audioSource"),Kt(this,"metadata",{}),Kt(this,"analysing"),Kt(this,"track"),Xt(this,xA,void 0),Xt(this,LA,void 0);const{lowVolumeThreshold:t,silentThreshold:r,clipThreshold:i,delay:n,media:s}=qt(qt({},NA),e);this.lowVolumeThreshold=t,this.silentThreshold=r,this.clipThreshold=i,this.delay=n,this.analysing=!1,Zt(this,LA,s)}setTrack(e){if(!e)return;this.track=e.clone();const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.analyser=this.audioContext.createAnalyser(),"screenshare"!==Qt(this,LA)?tE.emit(XS.AUDIO_TRACK_CREATED):tE.emit(XS.SCREENSHARE_AUDIO_TRACK_CREATED)}getTrackMetadata(){if(!this.track)return null;switch(this.metadata.label=this.track.label,this.metadata.channelCountMode=this.analyser.channelCountMode,this.metadata.channelCount=this.analyser.channelCount,this.metadata.channelInterpretation=this.analyser.channelInterpretation,this.metadata.outputs=this.analyser.numberOfOutputs,this.analyser.numberOfOutputs){case 1:this.metadata.channelType="MONO";break;case 2:this.metadata.channelType="STEREO";break;case 4:this.metadata.channelType="QUAD"}return this.metadata}startTrackAnalysis(){return tr(this,null,(function*(){if(!this.track||this.analysing)return!1;try{return yield this.audioContext.resume(),yield er(this,jA,UA).call(this),this.analysing=!0,!0}catch(e){return BS.error(e),!1}}))}stopTrackAnalysis(){this.analysing&&(this.analysing=!1,clearTimeout(Qt(this,xA)))}cleanup(){var e,t,r,i,n;this.stopTrackAnalysis(),null==(e=this.analyser)||e.disconnect(),null==(t=this.audioSource)||t.disconnect(this.analyser),null==(r=this.audioSource)||r.disconnect(),null==(i=this.audioContext)||i.close(),this.audioContext=void 0,this.analyser=void 0,this.audioSource=void 0,null==(n=this.track)||n.stop(),this.track=void 0,"screenshare"!==Qt(this,LA)?tE.emit(XS.AUDIO_TRACK_CLOSED):tE.emit(XS.SCREENSHARE_AUDIO_TRACK_CLOSED)}static dbFS(e){const t=Math.log(e)/Math.log(10)*20;return Math.round(10*t)/10}};let WA=BA;xA=new WeakMap,LA=new WeakMap,jA=new WeakSet,UA=function(){return tr(this,null,(function*(){try{const e=new MediaStream;e.addTrack(this.track),this.audioSource=this.audioContext.createMediaStreamSource(e),this.audioSource.connect(this.analyser),yield new Promise((e=>{window.requestAnimationFrame((()=>{er(this,FA,VA).call(this),e(!0)}))}))}catch(e){BS.error(e)}}))},FA=new WeakSet,VA=function(){const e=new Float32Array(this.analyser.fftSize);this.analyser.getFloatTimeDomainData(e);let t=0;for(const r of e)t+=r*r;const r=Math.sqrt(t/e.length),i={volume:r,lowVolume:BA.dbFS(r)<this.lowVolumeThreshold,silence:r<this.silentThreshold,clip:r>this.clipThreshold,timestamp:(new Date).getTime()};"screenshare"===Qt(this,LA)?tE.emit(XS.SCREENSHARE_AUDIO_TRACK_ANALYSIS,i):tE.emit(XS.AUDIO_TRACK_ANALYSIS,i),Zt(this,xA,setTimeout((()=>{window.requestAnimationFrame(er(this,FA,VA).bind(this))}),this.delay))};const HA=new WA,GA=new WA({media:"screenshare"}),$A={},qA=({methodName:e,lockName:t,timeout:r})=>(i,n,s)=>{const o=s.value;return s.value=function(...i){if($A[t]){const r=new Error(`Unsupported concurrent calls on Dyte method: ${e}.`);throw r.name="UnsupportedConcurrentMethodExecution",BS.error("DyteLocker::UnsupportedConcurrentMethodExecution",{error:{stack:r.stack},dyteLocker:{methodName:e,lockName:t}}),r}$A[t]=!0;const n=setTimeout((()=>delete $A[t]),r),s=o.apply(this,i);return Promise.resolve(s).then((()=>{delete $A[t],clearTimeout(n)})).catch((()=>{delete $A[t],clearTimeout(n)})),s},s};var zA,JA,KA,YA=Object.defineProperty,QA=Object.getOwnPropertyDescriptor,XA=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?QA(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&YA(t,r,s),s};const ZA=(KA=class extends ir.EventEmitter{constructor(e,t){super(),Xt(this,zA,void 0),Xt(this,JA,void 0),Kt(this,"mediaMiddlewareUtils"),Kt(this,"audioTrack"),Kt(this,"rawAudioTrack"),Kt(this,"videoTrack"),Kt(this,"rawVideoTrack"),Kt(this,"screenShareTracks"),Kt(this,"audioEnabled"),Kt(this,"videoEnabled"),Kt(this,"screenShareEnabled"),Kt(this,"currentDevices"),Kt(this,"permissions"),Kt(this,"audioUpdateInProgress"),Kt(this,"videoUpdateInProgress"),Kt(this,"screenShareUpdateInProgress"),Kt(this,"initialSetupComplete",!1),Kt(this,"isDeprecated",(()=>!0)),Zt(this,zA,e),Zt(this,JA,new NS(t)),this.audioEnabled=!0,this.videoEnabled=!0,this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,this.screenShareUpdateInProgress=!1,this.screenShareEnabled=!1,this.permissions={audio:"NOT_REQUESTED",video:"NOT_REQUESTED",screenshare:"NOT_REQUESTED"},this.screenShareTracks={audio:void 0,video:void 0},this.currentDevices={audio:void 0,video:void 0,speaker:void 0},Qt(this,zA).onDeviceChange(((e,t)=>{this.onDeviceChange(t,!1),this.emit("DEVICE_LIST_UPDATED",t)})),this.conditionallyRestartAudio=this.conditionallyRestartAudio.bind(this),this.conditionallyRestartVideo=this.conditionallyRestartVideo.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.onVisibilityChange),this.on("AUDIO_TRACK_CHANGE",(()=>{this.notifyIfTrackSilent()})),tE.on(XS.PRODUCER_TRACK_ENDED,(({kind:e})=>{"mic"===e&&this.conditionallyRestartAudio(),"webcam"===e&&this.conditionallyRestartVideo()}))}handlePermissionErrors(e,t){const r=zC(e,t.name,t.message);this.permissions[e]=r,tE.emit(XS.MEDIA_PERMISSION_ERROR,{message:r,constraints:t.constraints,kind:e})}repopulateAvailableDevices(){return tr(this,null,(function*(){return Qt(this,zA).repopulateAvailableDevices()}))}onVisibilityChange(e){"visible"===document.visibilityState&&(_S.isMobile()&&this.conditionallyRestartAudio(),this.conditionallyRestartVideo()),fi.tabChanged("visible"===document.visibilityState),"visible"!==document.visibilityState?fi.browserBackgrounded():fi.browserForegrounded()}conditionallyRestartAudio(e){return tr(this,null,(function*(){var t,r;yield new Promise((e=>setTimeout(e,50))),BS.info("performingCheck::shouldReacquireAudioTrack",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}});const i=yield this.shouldReacquireTrack("audio");BS.info("performedCheck::shouldReacquireAudioTrack",{actions:{trackRobustness:{reacquireTrack:i}}}),i&&(BS.info("reacquiring_audio_track"),this.removeMediaStreamTrackListeners(this.rawAudioTrack),_S.isChromiumBased()&&(yield Qt(this,zA).repopulateAvailableDevices()),yield this.setupAudioStream(null==(r=null==(t=this.currentDevices)?void 0:t.audio)?void 0:r.deviceId),this.addMediaStreamTrackListeners(this.rawAudioTrack),this.emit("AUDIO_TRACK_CHANGE"))}))}conditionallyRestartVideo(e){return tr(this,null,(function*(){var t,r;yield new Promise((e=>setTimeout(e,50))),BS.info("performingCheck::shouldReacquireVideoTrack",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}});const i=yield this.shouldReacquireTrack("video");BS.info("performedCheck::shouldReacquireVideoTrack",{actions:{trackRobustness:{reacquireTrack:i}}}),i&&(BS.info("reacquiring_video_track"),this.removeMediaStreamTrackListeners(this.rawVideoTrack),yield Qt(this,zA).repopulateAvailableDevices(),yield this.setupVideoStream(null==(r=null==(t=this.currentDevices)?void 0:t.video)?void 0:r.deviceId),this.addMediaStreamTrackListeners(this.rawVideoTrack),this.emit("VIDEO_TRACK_CHANGE"))}))}shouldReacquireTrack(e){return tr(this,null,(function*(){if("audio"===e){if(this.audioUpdateInProgress||!this.audioEnabled)return!1;if(!this.rawAudioTrack||!this.audioTrack)return!0;const e=this.rawAudioTrack.muted||this.audioTrack.muted;return("ended"===this.rawAudioTrack.readyState||"ended"===this.audioTrack.readyState)&&this.audioEnabled||e}if(this.videoUpdateInProgress||!this.videoEnabled)return!1;if(!this.rawVideoTrack||!this.videoTrack)return!0;const t=this.rawVideoTrack.muted||this.videoTrack.muted,r=("ended"===this.rawVideoTrack.readyState||"ended"===this.videoTrack.readyState)&&this.videoEnabled;return"visible"===document.visibilityState&&(r||t)}))}onAudioUnmute(e){BS.info("audio_track_unmuted",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}})}onVideoUnmute(e){BS.info("video_track_unmuted",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}})}removeMediaStreamTrackListeners(e){if(BS.info(`Removing ${e.kind} listerners`),!e)return;const t="audio"===e.kind?this.conditionallyRestartAudio:this.conditionallyRestartVideo;return e.removeEventListener("ended",t),e.removeEventListener("mute",t),e.removeEventListener("unmute","audio"===e.kind?this.onAudioUnmute:this.onVideoUnmute),e}addMediaStreamTrackListeners(e){if(!e)return null;BS.info(`adding_${e.kind}_stream_listerners`);const t="audio"===e.kind,r=t?this.conditionallyRestartAudio:this.conditionallyRestartVideo;return e.addEventListener("ended",(()=>tr(this,null,(function*(){yield r();const i=t?this.audioEnabled:this.videoEnabled,n=t?this.audioTrack:this.videoTrack,s=t?"FORCE_MUTE_AUDIO":"FORCE_MUTE_VIDEO";i&&(!n||"live"!==n.readyState||!n.enabled)&&(BS.info(`LocalMediaHandler::trackEnded::Failed to restart ${e.kind} track`),this.emit(s))})))),e.addEventListener("mute",r),e.addEventListener("unmute",t?this.onAudioUnmute:this.onVideoUnmute),e}notifyIfTrackSilent(){return tr(this,null,(function*(){var e,t,r,i,n,s;this.audioEnabled&&this.audioTrack&&"ended"!==this.audioTrack.readyState&&this.audioTrack.enabled&&!0===(yield FC(this.audioTrack))&&(BS.info("LocalMediaHandler:notifyIfTrackSilent:TrackSilent",{media:{audio:{enabled:this.audioEnabled,deviceId:null==(t=null==(e=this.audioTrack)?void 0:e.getSettings())?void 0:t.deviceId,permission:null==(r=this.permissions)?void 0:r.audio,deviceName:null==(n=null==(i=this.currentDevices)?void 0:i.audio)?void 0:n.label,trackId:null==(s=this.audioTrack)?void 0:s.id}}}),this.emit("AUDIO_TRACK_SILENT"))}))}setupAudioStream(e,t=!0){return tr(this,null,(function*(){var r,i,n;if(!this.audioUpdateInProgress)try{this.audioUpdateInProgress=!0;const s=Qt(this,zA).getAudioDevices();if(!s.length)throw this.audioEnabled=!1,new TC("COULD_NOT_START","No audio devices",{});let o=e;(!o||!s.find((e=>e.deviceId===o)))&&(o=yield this.getPreferredDeviceId("AUDIO"),BS.debug("setupAudioStream::AUDIO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:o,kind:"audio"}}));const a=OC.getAudioConstraints({audioDeviceId:o});t&&(null==(r=this.rawAudioTrack)||r.stop(),null==(i=this.audioTrack)||i.stop()),this.rawAudioTrack=yield OC.getAudioTrack(a),o=this.rawAudioTrack.getSettings().deviceId,(null==(n=this.currentDevices.audio)?void 0:n.deviceId)!==o&&(this.currentDevices.audio=Qt(this,zA).getDeviceById(o,"audioinput"),this.emit("DEVICE_CHANGE",{device:this.currentDevices.audio})),this.rawAudioTrack.enabled=this.audioEnabled,this.setAudioTrack(yield this.mediaMiddlewareUtils.getTransformedAudioTrack(this.rawAudioTrack)),this.addMediaStreamTrackListeners(this.rawAudioTrack),yield Qt(this,zA).repopulateAvailableDevices(),this.permissions.audio="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),fi.mediaPermission("AUDIO",Lr.ACCEPTED),fi.selectedDevice("AUDIO",this.currentDevices.audio),o&&NC("lastUsedAudioDeviceId",o)}catch(e){this.handlePermissionErrors("audio",e)}finally{this.audioUpdateInProgress=!1}}))}getPreferredDeviceId(e){return tr(this,null,(function*(){var t,r;let i;if("AUDIO"===e){const e=Qt(this,zA).getAudioDevices(),r=xC("lastUsedAudioDeviceId");let n;BS.debug("getPreferredDeviceId::lastUsedAudioDeviceId",{preferredDevice:{lastUsedPreferredDeviceId:r,kind:"audio"}}),r&&(n=e.find((e=>e.deviceId===r))),n?i=r:Ci.hasFeature(DS.REMOVE_OPERATIONAL_MIC)||(i=(yield this.getOperationalMicDeviceId()).deviceId),i||(i=null==(t=e[0])?void 0:t.deviceId)}if("VIDEO"===e){const e=xC("lastUsedVideoDeviceId");BS.debug("getPreferredDeviceId::lastUsedVideoDeviceId",{preferredDevice:{kind:"video",lastUsedPreferredDeviceId:e}});const t=Qt(this,zA).getVideoDevices();let n;e&&(n=t.find((t=>t.deviceId===e))),i=n?e:(yield this.getOperationalWebcamDeviceId()).deviceId,i||(i=null==(r=t[0])?void 0:r.deviceId)}return i}))}setupVideoStream(e,t=!0){return tr(this,null,(function*(){var r,i;if(!this.videoUpdateInProgress)try{this.videoUpdateInProgress=!0;const n=Qt(this,zA).getVideoDevices();if(!n.length)throw this.videoEnabled=!1,new TC("COULD_NOT_START","No video devices",{});let s=e;if((!s||!n.find((e=>e.deviceId===s)))&&(s=yield this.getPreferredDeviceId("VIDEO"),BS.debug("setupVideoStream::VIDEO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:s,kind:"video"}})),t&&(null==(r=this.videoTrack)||r.stop()),this.videoEnabled){const e=Qt(this,JA).getVideoConstraints(s);this.rawVideoTrack=yield OC.getVideoTrack(e),s=this.rawVideoTrack.getSettings().deviceId,this.setVideoTrack(yield this.mediaMiddlewareUtils.getTransformedVideoTrack(this.rawVideoTrack)),this.addMediaStreamTrackListeners(this.rawVideoTrack)}yield Qt(this,zA).repopulateAvailableDevices(),(null==(i=this.currentDevices.video)?void 0:i.deviceId)!==s&&(this.currentDevices.video=Qt(this,zA).getDeviceById(s,"videoinput"),this.emit("DEVICE_CHANGE",{device:this.currentDevices.video})),this.permissions.video="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),fi.mediaPermission("VIDEO",Lr.ACCEPTED),fi.selectedDevice("VIDEO",this.currentDevices.video),s&&NC("lastUsedVideoDeviceId",s)}catch(e){this.handlePermissionErrors("video",e)}finally{this.videoUpdateInProgress=!1}}))}setupScreenShareStreams(){return tr(this,null,(function*(){if(this.screenShareUpdateInProgress)return;const e=Qt(this,JA).getScreenShareConstraints();Ci.hasFeature(DS.SCREENSHARE_MAX_DIMENSIONS)&&(e.video.width.max=window.screen.width,e.video.height.max=window.screen.height);try{this.screenShareUpdateInProgress=!0;const t=yield OC.getScreenShareTracks(e);this.setScreenShareTracks(t)}catch(t){throw this.handlePermissionErrors("screenshare",new TC(t.name,t.message,e)),new qS(t.message)}finally{this.screenShareUpdateInProgress=!1}}))}setupSpeaker(e){return tr(this,null,(function*(){var t;const r=Qt(this,zA).getSpeakerDevices();if(!r.length)return;const i=null!=e?e:r[0].deviceId;(null==(t=this.currentDevices.speaker)?void 0:t.deviceId)!==i&&(this.currentDevices.speaker=Qt(this,zA).getDeviceById(i,"audiooutput"),fi.selectedDevice("SPEAKER",this.currentDevices.speaker),this.emit("DEVICE_CHANGE",{device:this.currentDevices.speaker})),document.querySelectorAll("audio").forEach((e=>tr(this,null,(function*(){if(void 0!==e.sinkId&&this.currentDevices.speaker.deviceId&&e.sinkId!==this.currentDevices.speaker.deviceId)try{yield e.setSinkId(this.currentDevices.speaker.deviceId)}catch(e){}}))))}))}getOperationalWebcamDeviceId(){return tr(this,null,(function*(){const e=Qt(this,zA).getVideoDevices();if(!e.length)return{isOperational:!1,deviceId:null};OA.setEmitMediaPermissionEvent(!1);const t=[],r=yield e.reduce(((e,r)=>tr(this,null,(function*(){const i=yield e;if(null!==i)return i;const n=Qt(this,JA).getVideoConstraints(r.deviceId);try{return(yield OC.getVideoTrack(n)).stop(),r.deviceId}catch(e){BS.error("getOperationalWebcamDeviceId::could_not_acquire_video_device",{error:e,constraints:n}),t.push({exception:e,constraints:n})}return i}))),Promise.resolve(null));if(OA.setEmitMediaPermissionEvent(!0),!r&&t.length>0&&t.length===e.length){const{exception:e,constraints:r}=t[0];throw new TC(e.name,e.message,r)}return r?{isOperational:!0,deviceId:r}:{isOperational:!1,deviceId:e[0].deviceId}}))}getOperationalMicDeviceId(){return tr(this,null,(function*(){const e=Qt(this,zA).getAudioDevices();if(!e.length)return{isOperational:!1,deviceId:null};const t=[];OA.setEmitMediaPermissionEvent(!1);const r=yield e.reduce(((e,r)=>tr(this,null,(function*(){const i=yield e;if(null!==i)return i;const n=OC.getAudioConstraints({audioDeviceId:r.deviceId});try{const e=yield OC.getAudioTrack(n),t=yield FC(e);if(null==e||e.stop(),!t)return r}catch(e){BS.error("getOperationalMicDeviceId::could_not_acquire_audio_device",{error:e,constraints:n}),t.push({exception:e,constraints:n})}return i}))),Promise.resolve(null));if(OA.setEmitMediaPermissionEvent(!0),!r&&t.length>0&&t.length===e.length){const{exception:e,constraints:r}=t[0];throw new TC(e.name,e.message,r)}return r?{isOperational:!0,deviceId:r.deviceId}:{isOperational:!1,deviceId:e[0].deviceId}}))}setupStreams(e){return tr(this,arguments,(function*({audio:e,video:t}){var r;const i={};this.currentDevices||(this.currentDevices={audio:void 0,video:void 0,speaker:void 0});try{if(e&&!this.audioUpdateInProgress&&0!==Qt(this,zA).getAudioDevices().length){const e=yield this.getPreferredDeviceId("AUDIO");BS.info("setupStreams::AUDIO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:e,kind:"audio"}});const t=OC.getAudioConstraints({audioDeviceId:e});i.audio=t.audio}if(t&&!this.videoUpdateInProgress&&0!==Qt(this,zA).getVideoDevices().length){const e=yield this.getPreferredDeviceId("VIDEO");BS.info("setupStreams::VIDEO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:e,kind:"video"}});const t=Qt(this,JA).getVideoConstraints(e);i.video=t.video}if(0===(null==(r=Object.keys(i))?void 0:r.length))return this.audioEnabled=null!=e?e:this.audioEnabled,this.videoEnabled=null!=t?t:this.videoEnabled,this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,void(this.initialSetupComplete=!0);const{audioTrack:n,videoTrack:s}=yield OC.getAudioAndVideoTrack(i);e&&n&&(this.audioTrack=n,this.rawAudioTrack=n,this.permissions.audio="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),this.currentDevices.audio=Qt(this,zA).getDeviceById(n.getSettings().deviceId,"audioinput"),NC("lastUsedAudioDeviceId",n.getSettings().deviceId)),t&&s&&(this.videoTrack=s,this.rawVideoTrack=s,this.permissions.video="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),this.currentDevices.video=Qt(this,zA).getDeviceById(s.getSettings().deviceId,"videoinput"),NC("lastUsedVideoDeviceId",s.getSettings().deviceId)),yield Qt(this,zA).repopulateAvailableDevices()}catch(r){"NotAllowedError"===r.name&&(e&&(yield this.setupAudioStream()),t&&(yield this.setupVideoStream()))}this.audioEnabled=!!this.audioTrack,this.videoEnabled=!!this.videoTrack,this.screenShareEnabled=!1,this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,this.initialSetupComplete=!0,yield this.setupSpeaker()}))}stopAudioTrack(){var e,t;this.audioUpdateInProgress||(this.audioUpdateInProgress=!0,null==(e=this.audioTrack)||e.stop(),null==(t=this.rawAudioTrack)||t.stop(),this.audioEnabled=!1,this.audioUpdateInProgress=!1)}stopVideoTrack(){var e,t;this.videoUpdateInProgress||(this.videoUpdateInProgress=!0,null==(e=this.videoTrack)||e.stop(),null==(t=this.rawVideoTrack)||t.stop(),this.videoEnabled=!1,this.videoUpdateInProgress=!1)}stopScreenShareTracks(e={}){var t,r,i,n;if(this.screenShareUpdateInProgress)return;this.screenShareUpdateInProgress=!0;const{audio:s=!0,video:o=!0}=e;s&&(null==(r=null==(t=this.screenShareTracks)?void 0:t.audio)||r.stop()),o&&(null==(n=null==(i=this.screenShareTracks)?void 0:i.video)||n.stop()),this.screenShareEnabled=!1,this.screenShareUpdateInProgress=!1}removeAudioTrack(){this.stopAudioTrack(),this.audioTrack=void 0,this.rawAudioTrack=void 0,Ci.hasFeature(DS.TROUBLESHOOTING)&&HA.cleanup()}removeVideoTrack(){this.stopVideoTrack(),this.videoTrack=void 0,this.rawVideoTrack=void 0}removeScreenShareTracks(e){var t;null==(t=this.screenShareTracks.video)||t.removeEventListener("ended",this.onScreenShareEnded),this.stopScreenShareTracks(e),this.screenShareTracks={audio:void 0,video:void 0}}removeAllTracks(){this.removeAudioTrack(),this.removeVideoTrack(),this.removeScreenShareTracks({audio:!!this.screenShareTracks.audio,video:!!this.screenShareTracks.video})}setAudioTrack(e){e!==this.audioTrack&&(void 0===e&&this.stopAudioTrack(),this.audioTrack=e,this.audioTrack&&(this.audioTrack.enabled=this.audioEnabled))}setVideoTrack(e){e!==this.videoTrack&&(void 0===e&&this.stopVideoTrack(),this.videoTrack=e)}setScreenShareTracks(e){var t;const{audio:r,video:i}=e;(!r||!i)&&this.stopScreenShareTracks({audio:!!r,video:!!i}),this.screenShareTracks=e,null==(t=this.screenShareTracks.video)||t.addEventListener("ended",this.onScreenShareEnded.bind(this))}onScreenShareEnded(){this.emit("SCREENSHARE_ENDED")}disableAudio(){this.audioEnabled=!1,this.audioTrack&&(this.audioTrack.enabled=this.audioEnabled),this.rawAudioTrack&&(this.rawAudioTrack.enabled=this.audioEnabled)}enableAudio(){return tr(this,null,(function*(){var e;if("DENIED"!==this.permissions.audio){try{if((!this.audioTrack||"ended"===this.audioTrack.readyState)&&(yield this.setupAudioStream(null==(e=this.currentDevices.audio)?void 0:e.deviceId)),!this.audioTrack||!this.rawAudioTrack)return this.audioEnabled=!1,void BS.error("LocalMediaHandler::enableAudio:Setting up audio stream failed while enabling audio",{debuggingHint:"Refer to SelfController::mediaPermissionError log."});this.audioEnabled=!0}catch(e){this.audioEnabled=!1,this.audioTrack=void 0,this.rawAudioTrack=void 0,BS.error("LocalMediaHandler::enableAudio",{error:e},!0)}this.audioTrack&&(this.audioTrack.enabled=!0),this.rawAudioTrack&&(this.rawAudioTrack.enabled=!0),"ACCEPTED"!==this.permissions.audio&&this.audioEnabled&&(this.permissions.audio="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}))}else this.audioEnabled=!1}))}toggleAudio(){return tr(this,null,(function*(){var e;if("DENIED"!==this.permissions.audio){try{if((!this.audioTrack||"ended"===this.audioTrack.readyState)&&(yield this.setupAudioStream(null==(e=this.currentDevices.audio)?void 0:e.deviceId)),!this.audioTrack||!this.rawAudioTrack)return void(this.audioEnabled=!1);this.audioEnabled=!this.audioEnabled}catch(e){this.audioEnabled=!1,BS.error("LocalMediaHandler::toggleAudio",{error:e},!0)}this.audioTrack&&(this.audioTrack.enabled=this.audioEnabled),this.rawAudioTrack&&(this.rawAudioTrack.enabled=this.audioEnabled)}else this.audioEnabled=!1}))}toggleVideo(){return tr(this,null,(function*(){var e;if("DENIED"!==this.permissions.video)if(this.videoEnabled)this.removeVideoTrack();else{this.videoEnabled=!0;try{yield this.setupVideoStream(null==(e=this.currentDevices.video)?void 0:e.deviceId)}catch(e){this.videoEnabled=!1}this.videoTrack&&(this.videoTrack.enabled=this.videoEnabled),this.rawVideoTrack&&(this.rawVideoTrack.enabled=this.videoEnabled),"ACCEPTED"!==this.permissions.video&&this.videoEnabled&&(this.permissions.video="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}))}else this.videoEnabled=!1}))}toggleScreenShare(){return tr(this,null,(function*(){if(this.screenShareEnabled)this.removeScreenShareTracks({audio:!!this.screenShareTracks.audio,video:!!this.screenShareTracks.video});else try{if(yield this.setupScreenShareStreams(),this.screenShareEnabled=!0,"ACCEPTED"===this.permissions.screenshare)return;this.permissions.screenshare="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.screenshare,kind:"screenshare"})}catch(e){this.screenShareEnabled=!1}}))}getAllDevices(){return Qt(this,zA).availableDevices}getDeviceById(e,t){return Qt(this,zA).getDeviceById(e,t)}getAudioDevices(){return Qt(this,zA).getAudioDevices()}getVideoDevices(){return Qt(this,zA).getVideoDevices()}getSpeakerDevices(){return Qt(this,zA).getSpeakerDevices()}onDeviceChange(e,t){return tr(this,null,(function*(){var r,i;this.initialSetupComplete&&(null==(r=null==e?void 0:e.added)||r.forEach((e=>tr(this,null,(function*(){e&&(t||!AC(e))&&("audioinput"===e.kind?(yield this.setupAudioStream(e.deviceId),this.emit("AUDIO_TRACK_CHANGE")):"videoinput"===e.kind&&this.videoEnabled?(yield this.setupVideoStream(e.deviceId),this.emit("VIDEO_TRACK_CHANGE")):"audiooutput"===e.kind&&(yield this.setupSpeaker(e.deviceId)))})))),null==(i=null==e?void 0:e.removed)||i.forEach((e=>tr(this,null,(function*(){var t,r,i;e&&(("audioinput"===e.kind&&!this.audioEnabled||"videoinput"===e.kind&&!this.videoEnabled||Ci.hasFeature(DS.DEVICE_REMOVE_EXP)||!_S.isChromiumBased())&&("audioinput"===e.kind&&e.deviceId===(null==(t=this.currentDevices.audio)?void 0:t.deviceId)?(yield this.setupAudioStream(),this.emit("AUDIO_TRACK_CHANGE")):"videoinput"===e.kind&&e.deviceId===(null==(r=this.currentDevices.video)?void 0:r.deviceId)&&(yield this.setupVideoStream(),this.emit("VIDEO_TRACK_CHANGE"))),"audiooutput"===e.kind&&e.deviceId===(null==(i=this.currentDevices.speaker)?void 0:i.deviceId)&&(yield this.setupSpeaker()))})))))}))}static init(e){return tr(this,null,(function*(){const t=yield OC.init(),r=new ZA(t,e),i=new PA(r);return r.mediaMiddlewareUtils=i,r}))}emit(e,...t){return super.emit(e,...t)}on(e,t){return super.on(e,t)}removeDocumentEventListeners(){return tr(this,null,(function*(){document.removeEventListener("visibilitychange",this.onVisibilityChange)}))}addAudioMiddleware(e){return this.mediaMiddlewareUtils.addAudioMiddleware(e)}removeAudioMiddleware(e){return this.mediaMiddlewareUtils.removeAudioMiddleware(e)}addVideoMiddleware(e){return this.mediaMiddlewareUtils.addVideoMiddleware(e)}removeVideoMiddleware(e){return this.mediaMiddlewareUtils.removeVideoMiddleware(e)}enableVideo(){return tr(this,null,(function*(){yield this.toggleVideo()}))}disableVideo(){return tr(this,null,(function*(){yield this.toggleVideo()}))}enableScreenShare(){return tr(this,null,(function*(){yield this.toggleScreenShare()}))}disableScreenShare(){return tr(this,null,(function*(){yield this.toggleScreenShare()}))}getCurrentDevices(){return this.currentDevices}destruct(){this.mediaMiddlewareUtils.terminateMiddlewareWebWorker(),Qt(this,zA).destruct(),this.removeAllTracks(),this.removeAllListeners()}},zA=new WeakMap,JA=new WeakMap,KA);let eI=ZA;XA([qA({methodName:"oldLocalMediaHandler.conditionallyRestartAudio",lockName:"oldLocalMediaHandler.conditionallyRestartAudio",timeout:3e3})],eI.prototype,"conditionallyRestartAudio",1),XA([qA({methodName:"oldLocalMediaHandler.conditionallyRestartVideo",lockName:"oldLocalMediaHandler.conditionallyRestartVideo",timeout:3e3})],eI.prototype,"conditionallyRestartVideo",1),XA([VS.trace("OldMediaHandler.shouldReacquireTrack")],eI.prototype,"shouldReacquireTrack",1),XA([VS.trace("OldMediaHandler.removeMediaStreamTrackListeners")],eI.prototype,"removeMediaStreamTrackListeners",1),XA([VS.trace("OldMediaHandler.addMediaStreamTrackListeners")],eI.prototype,"addMediaStreamTrackListeners",1),XA([VS.trace("OldMediaHandler.setupAudioStream")],eI.prototype,"setupAudioStream",1),XA([VS.trace("OldMediaHandler.getPreferredDeviceId")],eI.prototype,"getPreferredDeviceId",1),XA([VS.trace("OldMediaHandler.setupVideoStream")],eI.prototype,"setupVideoStream",1),XA([VS.trace("OldMediaHandler.setupScreenShareStreams")],eI.prototype,"setupScreenShareStreams",1),XA([VS.trace("OldMediaHandler.setupSpeaker")],eI.prototype,"setupSpeaker",1),XA([VS.trace("OldMediaHandler.getOperationalWebcamDeviceId")],eI.prototype,"getOperationalWebcamDeviceId",1),XA([VS.trace("OldMediaHandler.getOperationalMicDeviceId")],eI.prototype,"getOperationalMicDeviceId",1),XA([VS.trace("OldMediaHandler.setupStreams")],eI.prototype,"setupStreams",1),XA([VS.trace("OldMediaHandler.stopAudioTrack")],eI.prototype,"stopAudioTrack",1),XA([VS.trace("OldMediaHandler.stopVideoTrack")],eI.prototype,"stopVideoTrack",1),XA([VS.trace("OldMediaHandler.stopScreenShareTracks")],eI.prototype,"stopScreenShareTracks",1),XA([VS.trace("OldMediaHandler.removeAudioTrack")],eI.prototype,"removeAudioTrack",1),XA([VS.trace("OldMediaHandler.removeVideoTrack")],eI.prototype,"removeVideoTrack",1),XA([VS.trace("OldMediaHandler.removeScreenShareTracks")],eI.prototype,"removeScreenShareTracks",1),XA([VS.trace("OldMediaHandler.removeAllTracks")],eI.prototype,"removeAllTracks",1),XA([VS.trace("OldMediaHandler.setAudioTrack")],eI.prototype,"setAudioTrack",1),XA([VS.trace("OldMediaHandler.setVideoTrack")],eI.prototype,"setVideoTrack",1),XA([VS.trace("OldMediaHandler.setScreenShareTracks")],eI.prototype,"setScreenShareTracks",1),XA([VS.trace("OldMediaHandler::disableAudio")],eI.prototype,"disableAudio",1),XA([VS.trace("OldMediaHandler::enableAudio")],eI.prototype,"enableAudio",1),XA([VS.trace("OldMediaHandler.toggleAudio")],eI.prototype,"toggleAudio",1),XA([VS.trace("OldMediaHandler.toggleVideo")],eI.prototype,"toggleVideo",1),XA([VS.trace("OldMediaHandler.toggleScreenShare")],eI.prototype,"toggleScreenShare",1);class tI extends HS{constructor(){super(...arguments),Kt(this,"localMediaHandler")}updatePermission(){return tr(this,null,(function*(){var e,t;const r=(e,t)=>{this.mediaPermissions[e]=t;const r={message:this.mediaPermissions[e],kind:e};"DENIED"===t?tE.emit(XS.MEDIA_PERMISSION_ERROR,r):tE.emit(XS.MEDIA_PERMISSION_UPDATE,r)};if("firefox"===_S.getName())return;const i=yield null==(e=null==navigator?void 0:navigator.permissions)?void 0:e.query({name:"microphone"}),n=yield null==(t=null==navigator?void 0:navigator.permissions)?void 0:t.query({name:"camera"}),s=(e,t)=>{switch(t){case"granted":r(e,"ACCEPTED");break;case"denied":r(e,"DENIED")}this.localMediaHandler.repopulateAvailableDevices()};i&&(i.onchange=()=>s("audio",i.state)),n&&(n.onchange=()=>s("video",n.state))}))}init(){return tr(this,arguments,(function*(e={},t=!1){var r,i,n,s;if(_S.init(),!this.localMediaHandler){this.updatePermission();try{let o=!0;if(td.defaults.mediaHandler)o=!1,this.localMediaHandler=td.defaults.mediaHandler.localMediaHandler;else if(navigator.RNLocalMediaHandlerImpl){const{RNLocalMediaHandlerImpl:e}=navigator;this.localMediaHandler=yield e.init()}else Ci.hasFeature(DS.NEW_LOCAL_MEDIA_HANDLER)||window.FAST_DYTE?this.localMediaHandler=new wA(e.constraints,null==(r=null==td?void 0:td.defaults)?void 0:r.isNonPreferredDevice,null==(i=null==td?void 0:td.defaults)?void 0:i.autoSwitchAudioDevice):this.localMediaHandler=yield eI.init(e.constraints);if(tE.on(XS.MEDIA_PERMISSION_UPDATE,(e=>tr(this,null,(function*(){var t,r,i;if("ACCEPTED"===e.message){const n=this.getCurrentDevices(),s=yield this.getAudioDevices(),o=yield this.getVideoDevices(),a=yield this.getSpeakerDevices(),c=Ci.hasFeature(DS.NEW_LOCAL_MEDIA_HANDLER);switch(null==e?void 0:e.kind){case"audio":!n.audio&&s.length>0&&(c||this.setDevice(s[0]),fi.mediaPermission("AUDIO",Lr.ACCEPTED),fi.selectedDevice("AUDIO",null==(t=this.getCurrentDevices())?void 0:t.audio)),!n.speaker&&a.length>0&&(c||this.setDevice(a[0]),fi.mediaPermission("SPEAKER",Lr.ACCEPTED),fi.selectedDevice("SPEAKER",null==(r=this.getCurrentDevices())?void 0:r.speaker));break;case"video":!n.video&&o.length>0&&(c||this.setDevice(o[0]),fi.mediaPermission("VIDEO",Lr.ACCEPTED),fi.selectedDevice("VIDEO",null==(i=this.getCurrentDevices())?void 0:i.video))}}this.emit("mediaPermissionUpdate",e)})))),tE.on(XS.MEDIA_PERMISSION_ERROR,(e=>tr(this,null,(function*(){const{kind:t,message:r}=e;"audio"===t?(fi.mediaPermission("AUDIO",JC(r)),this.disableAudio()):"video"===t?(fi.mediaPermission("VIDEO",JC(r)),this.disableVideo()):"screenshare"===t&&(fi.mediaPermission("VIDEO",JC(r)),this.disableScreenShare()),BS.error("SelfController::mediaPermissionError",{error:{message:e.message},constraints:e.constraints,mediaPermissionsErrors:{kind:t,message:r}}),this.emit("mediaPermissionError",e),this.emit("mediaPermissionUpdate",{message:r,kind:t})})))),o){const r=this.localMediaHandler.setupStreams({video:null==(n=null==e?void 0:e.video)||n,audio:null==(s=null==e?void 0:e.audio)||s});t||(yield r)}}catch(e){BS.error("DyteSelf::init::Failed To Setup Streams",{error:{name:e.name,message:e.message}})}}}))}get audioTrack(){return this.localMediaHandler.audioTrack}get rawAudioTrack(){return this.localMediaHandler.rawAudioTrack}get mediaPermissions(){return this.localMediaHandler.permissions}addAudioMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.addAudioMiddleware(e)}))}removeAudioMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.removeAudioMiddleware(e)}))}get videoTrack(){return this.localMediaHandler.videoTrack}get rawVideoTrack(){return this.localMediaHandler.rawVideoTrack}addVideoMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.addVideoMiddleware(e)}))}removeVideoMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.removeVideoMiddleware(e)}))}get screenShareTracks(){return this.localMediaHandler.screenShareTracks}get audioEnabled(){return this.localMediaHandler.audioEnabled}get videoEnabled(){return this.localMediaHandler.videoEnabled}get screenShareEnabled(){return this.localMediaHandler.screenShareEnabled}enableAudio(){return tr(this,null,(function*(){yield this.localMediaHandler.enableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}))}enableVideo(){return tr(this,null,(function*(){yield this.localMediaHandler.enableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}))}disableAudio(){return tr(this,null,(function*(){this.localMediaHandler.disableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}))}disableVideo(){return tr(this,null,(function*(){yield this.localMediaHandler.disableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}))}disableScreenShare(){return tr(this,null,(function*(){}))}getCurrentDevices(){return this.localMediaHandler.getCurrentDevices()}getAudioDevices(){return tr(this,null,(function*(){return yield this.localMediaHandler.getAudioDevices()}))}getVideoDevices(){return tr(this,null,(function*(){return yield this.localMediaHandler.getVideoDevices()}))}getSpeakerDevices(){return tr(this,null,(function*(){return yield this.localMediaHandler.getSpeakerDevices()}))}getDeviceById(e,t){let r;return"audio"===t?r="audioinput":"video"===t?r="videoinput":"speaker"===t&&(r="audiooutput"),this.localMediaHandler.getDeviceById(e,r)}setDevice(e){return tr(this,null,(function*(){const t={added:[e],removed:[]};if("isDeprecated"in this.localMediaHandler)yield this.localMediaHandler.onDeviceChange(t,!0);else{switch(e.kind){case"audioinput":try{yield this.localMediaHandler.setAudioDevice(e)}catch(e){}finally{this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":yield this.localMediaHandler.setSpeakerDevice(e);break;case"videoinput":try{yield this.localMediaHandler.setVideoDevice(e)}catch(e){}finally{this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}}this.emit("deviceUpdate",{device:e})}}))}}const rI={nonBlackPixelLumaThreshold:20,identicalFrameSsimThreshold:.985,media:"video"};var iI,nI,sI,oI,aI,cI,dI,lI,uI,pI,hI,mI,fI,gI,vI;const yI=class{constructor(e){Xt(this,oI),Xt(this,cI),Xt(this,lI),Kt(this,"metadata",{}),Kt(this,"video"),Kt(this,"canvas"),Kt(this,"nonBlackPixelLumaThreshold"),Kt(this,"identicalFrameSsimThreshold"),Kt(this,"previousFrame",new Uint8ClampedArray),Xt(this,iI,void 0),Kt(this,"track"),Kt(this,"analysing"),Xt(this,nI,void 0),Xt(this,sI,void 0),Kt(this,"preview");const{nonBlackPixelLumaThreshold:t,identicalFrameSsimThreshold:r,media:i}=qt(qt({},rI),e);this.nonBlackPixelLumaThreshold=t,this.identicalFrameSsimThreshold=r,this.analysing=!1,Zt(this,nI,i),this.preview=!1}setTrack(e){var t,r,i;null==(t=this.track)||t.stop(),this.track=e;const{height:n,width:s}=null!=(i=null==(r=this.track)?void 0:r.getConstraints())?i:{};this.metadata.resolution=[s,n],"screenshare"!==Qt(this,nI)?tE.emit(XS.VIDEO_TRACK_CREATED):tE.emit(XS.SCREENSHARE_VIDEO_TRACK_CREATED)}getTrackMetadata(){return this.track?(this.metadata.label=this.track.label,this.metadata):null}startTrackAnalysis(){return tr(this,null,(function*(){var e;return!(!this.track||this.analysing||(!this.video&&!(null!=(e=this.video)&&e.src)&&(Zt(this,sI,new MediaStream),Qt(this,sI).addTrack(this.track),this.video=document.createElement("video"),this.canvas=document.createElement("canvas"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),[this.video.width,this.video.height]=this.metadata.resolution,this.video.srcObject=Qt(this,sI)),window.requestAnimationFrame(er(this,oI,aI).bind(this)),this.analysing=!0,0))}))}stopTrackAnalysis(){this.analysing&&(this.analysing=!1,clearTimeout(Qt(this,iI)))}cleanup(){var e;this.stopTrackAnalysis(),null==(e=this.track)||e.stop(),this.track=void 0,Zt(this,sI,void 0),this.video&&(this.video.srcObject=void 0,this.video=void 0),this.canvas=void 0,this.previousFrame=new Uint8ClampedArray,"screenshare"!==Qt(this,nI)?tE.emit(XS.VIDEO_TRACK_CLOSED):tE.emit(XS.SCREENSHARE_VIDEO_TRACK_CLOSED)}};let _I=yI;iI=new WeakMap,nI=new WeakMap,sI=new WeakMap,oI=new WeakSet,aI=function(){var e;try{const t=er(this,cI,dI).call(this),r=er(this,lI,uI).call(this,t.data,t.data.length),i=er(e=yI,pI,hI).call(e,this.previousFrame,t.data);this.previousFrame=t.data;const n={isBlackFrame:r,videoScore:i,isFrozenFrame:i>this.identicalFrameSsimThreshold,timestamp:(new Date).getTime()};"screenshare"===Qt(this,nI)?tE.emit(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS,n):tE.emit(XS.VIDEO_TRACK_ANALYSIS,n),Zt(this,iI,setTimeout((()=>{this.track&&window.requestAnimationFrame(er(this,oI,aI).bind(this))}),3e3))}catch(e){"screenshare"===Qt(this,nI)?tE.emit(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR):tE.emit(XS.VIDEO_TRACK_ANALYSIS_ERROR)}},cI=new WeakSet,dI=function(){var e,t;this.canvas.width=null==(e=this.video)?void 0:e.width,this.canvas.height=null==(t=this.video)?void 0:t.height;const r=this.canvas.getContext("2d",{willReadFrequently:!0});return r.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),r.getImageData(0,0,this.canvas.width,this.canvas.height)},lI=new WeakSet,uI=function(e,t){const r=this.nonBlackPixelLumaThreshold;let i=0;for(let n=4;n<t;n+=4)if(i+=.21*e[n]+.72*e[n+1]+.07*e[n+2],i>r*(n/4))return!1;return!0},pI=new WeakSet,hI=function(e,t){var r,i,n;if(e.length!==t.length)return 0;const s=255,o=.01*s*(.01*s),a=.03*s*(.03*s),c=a/2,d=er(r=yI,mI,fI).call(r,e),l=d.mean,u=d.variance,p=Math.sqrt(u),h=er(i=yI,mI,fI).call(i,t),m=h.mean,f=h.variance,g=Math.sqrt(f);return(2*l*m+o)/(l*l+m*m+o)*((2*p*g+a)/(u+f+a))*((er(n=yI,gI,vI).call(n,e,t,l,m)+c)/(p*g+c))},mI=new WeakSet,fI=function(e){let t,r=0;for(t=0;t<e.length;t++)r+=e[t];const i=r/(e.length-1);let n=0;for(t=1;t<e.length;t++)n=e[t-1]-i,r+=e[t]+n*n;return{mean:i,variance:r/e.length}},gI=new WeakSet,vI=function(e,t,r,i){let n=0;for(let s=0;s<e.length;s+=1)n+=(e[s]-r)*(t[s]-i);return n/e.length},Xt(_I,pI),Xt(_I,mI),Xt(_I,gI);const SI=new _I,EI=new _I({media:"screenshare"});function TI(e){return!("LIVESTREAM"===e.viewType||"CHAT"===e.viewType)}var bI,wI,kI,RI,CI,AI,II,PI=Object.defineProperty,DI=Object.getOwnPropertyDescriptor,MI=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?DI(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&PI(t,r,s),s},OI=(e=>(e.OFF_STAGE="OFF_STAGE",e.REQUESTED_TO_JOIN_STAGE="REQUESTED_TO_JOIN_STAGE",e.ACCEPTED_TO_JOIN_STAGE="ACCEPTED_TO_JOIN_STAGE",e.ON_STAGE="ON_STAGE",e))(OI||{});let NI,xI=(II=class extends tI{constructor(e,t,r,i,n){var s;super(),Xt(this,CI),Kt(this,"id"),Kt(this,"name"),Kt(this,"picture"),Kt(this,"customParticipantId"),Kt(this,"waitlistStatus"),Xt(this,bI,void 0),Xt(this,wI,void 0),Xt(this,kI,void 0),Kt(this,"role"),Kt(this,"userId"),Kt(this,"organizationId"),Kt(this,"supportsRemoteControl",!1),Kt(this,"device"),Xt(this,RI,void 0),Kt(this,"presetName"),Kt(this,"roomState","init"),this.id=e,this.userId=t.id,this.name=t.name,this.picture=t.picture,this.customParticipantId=null!=(s=t.customParticipantId)?s:t.clientSpecificId,this.waitlistStatus="none",Zt(this,wI,r),Zt(this,bI,i),Zt(this,kI,!1),this.organizationId=t.organizationId,this.supportsRemoteControl=_S.isElectron(),this.device=_S.getDeviceInfo(),this.presetName=n,i.viewType!==gi.Chat&&this.updatePermission()}get clientSpecificId(){return this.customParticipantId}get stageStatus(){return Qt(this,RI)}static __init__(e,t,r,i,n,s=!1){return tr(this,null,(function*(){var o,a,c,d,l;let u=null==(a=null==(o=td.defaults)?void 0:o.audio)||a,p=null==(d=null==(c=td.defaults)?void 0:c.video)||d;"ALLOWED"!==r.canProduceAudio&&(u=!1),"ALLOWED"!==r.canProduceVideo&&(p=!1);const h=new xI(e,t,r,i,n);if(i.viewType===gi.Chat)return h;const m=function(e){var t,r;const i={};return e.audio&&(i.audio={enableStereo:null!=(t=e.audio.enableStereo)&&t,enableHighBitrate:null!=(r=e.audio.enableHighBitrate)&&r}),i.video=e.video.quality,i}(i.mediaConstraints);return Og(m,null==(l=td.defaults)?void 0:l.mediaConfiguration),yield h.init({audio:u,video:p,constraints:m},s),h.setupEvents(),h}))}setupEvents(){tE.on(XS.ROOM_NODE_CONNECTED,(e=>tr(this,[e],(function*({wasDisconnected:e,wasJoinAttempted:t}){e&&(yield this.resetSelf(t))})))),tE.onAsync(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){switch(Zt(this,RI,e),e){case"ACCEPTED_TO_JOIN_STAGE":this.emit("joinStageRequestAccepted");break;case"REQUESTED_TO_JOIN_STAGE":this.emit("peerRequestToJoinStage");break;case"OFF_STAGE":this.emit("stageLeft")}})))),tE.on(XS.RESET_PRODUCER_STATE,(()=>tr(this,null,(function*(){if(this.roomJoined&&Qt(this,CI,AI)instanceof MR){if(this.localMediaHandler.videoEnabled&&(yield Qt(this,CI,AI).shareWebcam(this.localMediaHandler.videoTrack)),this.localMediaHandler.audioEnabled)try{yield Qt(this,CI,AI).shareMic(this.localMediaHandler.audioTrack)}catch(e){this.localMediaHandler.disableAudio()}this.localMediaHandler.screenShareEnabled&&(yield Qt(this,CI,AI).shareScreen({video:this.localMediaHandler.screenShareTracks.video,audio:this.localMediaHandler.screenShareTracks.audio}))}})))),tE.on(XS.STOPPED_PRESENTING,(()=>{this.localMediaHandler.destruct(),this.setWebinarStageStatus("OFF_STAGE"),this.emit("stageLeft")})),this.localMediaHandler.on("AUDIO_TRACK_CHANGE",(()=>tr(this,null,(function*(){if(tE.emit(XS.AUDIO_TRACK_CHANGED),BS.info("DyteSelf::setupEvents::AUDIO_TRACK_CHANGE",qt({},SC(this))),this.roomJoined&&this.audioEnabled)try{yield Qt(this,CI,AI).shareMic(this.audioTrack)}catch(e){BS.error("DyteSelf::setupEvents::Error while sharing mic",{error:e}),this.localMediaHandler.disableAudio()}this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})})))),this.localMediaHandler.on("VIDEO_TRACK_CHANGE",(()=>tr(this,null,(function*(){if(tE.emit(XS.VIDEO_TRACK_CHANGED),BS.info("DyteSelf::setupEvents::VIDEO_TRACK_CHANGE",qt({},SC(this))),this.roomJoined&&void 0===this.rawVideoTrack)BS.info("DyteSelf::VIDEO_TRACK_CHANGE::Forcing_disable_video"),this.disableVideo();else if(this.videoEnabled&&this.roomJoined)try{const e=yield Qt(this,CI,AI).shareWebcam(this.videoTrack);e&&e.id!==this.videoTrack.id&&Ci.hasFeature(DS.EXP_RESHARE)&&(yield Qt(this,CI,AI).shareWebcam(this.videoTrack))}catch(e){BS.error("DyteSelf::setupEvents::failed shareWebcam",{error:e}),this.videoEnabled&&(yield this.localMediaHandler.disableVideo())}this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})})))),this.localMediaHandler.on("DEVICE_CHANGE",(e=>tr(this,[e],(function*({device:e}){this.emit("deviceUpdate",{device:e})})))),this.localMediaHandler.on("DEVICE_LIST_UPDATED",(e=>{this.emit("deviceListUpdate",e)})),this.localMediaHandler.on("SCREENSHARE_TRACK_CHANGE",(()=>tr(this,null,(function*(){if(tE.emit(XS.SCREENSHARE_TRACK_CHANGED),this.roomJoined){if(this.screenShareEnabled)try{yield Qt(this,CI,AI).shareScreen(this.screenShareTracks)}catch(e){BS.error("DyteSelf::setupEvents::Error while sharing screen",{error:e}),this.screenShareEnabled&&(yield this.localMediaHandler.disableScreenShare())}BS.info("DyteSelf::setupEvents::SCREENSHARE_TRACK_CHANGE",qt({},SC(this))),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}else BS.error("DyteSelf.SCREENSHARE_TRACK_CHANGE.LocalMediaInitialized_WithoutRoomNode")})))),this.localMediaHandler.on("SCREENSHARE_ENDED",(()=>tr(this,null,(function*(){yield this.disableScreenShare(),BS.info("DyteSelf::setupEvents::SCREENSHARE_ENDED",qt({},SC(this)))})))),this.localMediaHandler.on("AUDIO_TRACK_SILENT",(()=>{fi.mediaTrackMuted("AUDIO")})),this.localMediaHandler.on("FORCE_MUTE_AUDIO",(()=>{this.disableAudio()})),this.localMediaHandler.on("FORCE_MUTE_VIDEO",(()=>tr(this,null,(function*(){this.roomJoined&&(yield Qt(this,CI,AI).pauseWebcam()),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),fi.videoOff()}))))}get permissions(){return Qt(this,wI)}get suggestedTheme(){return Qt(this,bI)}get config(){return Qt(this,bI)}get roomJoined(){var e;return!0===(null==(e=Qt(this,CI,AI))?void 0:e.roomJoined)}setName(e){if(!e)throw new qS("Name cannot be empty.");this.name=e}setupTracks(){return tr(this,arguments,(function*(e={}){var t,r;return e.forceReset&&(Qt(this,CI,AI).stopAllProducers(),this.localMediaHandler.removeAllTracks()),this.localMediaHandler.setupStreams({video:null==(t=e.video)||t,audio:null==(r=e.audio)||r})}))}resetSelf(e){return tr(this,null,(function*(){var t,r,i,n,s,o,a,c,d,l;if(fi.callEnded(),null==(i=null==(r=null==(t=Qt(this,CI,AI))?void 0:t.sfuHandler)?void 0:r.cleanupConsumers)||i.call(r),Qt(this,CI,AI)instanceof fC&&(yield null==(o=null==(s=null==(n=Qt(this,CI,AI))?void 0:n.sfuHandler)?void 0:s.setupTransports)?void 0:o.call(s)),e){if(TI(this.config)&&(yield null==(a=Qt(this,CI,AI))?void 0:a.joinRoom(this.name,!this.localMediaHandler.audioEnabled,Qt(this,CI,AI).roomUUID,Qt(this,CI,AI).meetingTitle,{audio:this.localMediaHandler.audioEnabled,video:this.localMediaHandler.videoEnabled,screen:this.localMediaHandler.screenShareEnabled})),this.localMediaHandler.videoEnabled&&(yield null==(c=Qt(this,CI,AI))?void 0:c.shareWebcam(this.localMediaHandler.videoTrack)),this.localMediaHandler.audioEnabled)try{yield null==(d=Qt(this,CI,AI))?void 0:d.shareMic(this.localMediaHandler.audioTrack)}catch(e){this.localMediaHandler.disableAudio()}this.localMediaHandler.screenShareEnabled&&(yield null==(l=Qt(this,CI,AI))?void 0:l.shareScreen({video:this.localMediaHandler.screenShareTracks.video,audio:this.localMediaHandler.screenShareTracks.audio}))}}))}destructMediaHandler(){return tr(this,null,(function*(){return this.localMediaHandler.destruct()}))}removeDocumentEventListeners(){return tr(this,null,(function*(){return this.localMediaHandler.removeDocumentEventListeners()}))}enableAudio(){return tr(this,null,(function*(){if(this.permissions.canProduceAudio!==rE.notAllowed&&(Qt(this,wI).canProduceAudio!==rE.canRequest||"OFF_STAGE"!==this.stageStatus&&"REQUESTED_TO_JOIN_STAGE"!==this.stageStatus)&&!this.audioEnabled){if(yield this.localMediaHandler.enableAudio(),this.roomJoined&&("HIVE"!==this.permissions.mediaRoomType||"ON_STAGE"===this.stageStatus)){if(this.audioTrack)try{yield Qt(this,CI,AI).shareMic(this.audioTrack)}catch(e){BS.error("DyteSelf::enableAudio::Error while sharing mic",{error:e}),this.localMediaHandler.disableAudio()}if(!this.audioEnabled)return;Qt(this,CI,AI).unmuteSelf()}if(this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}),fi.audioOn(),Ci.hasFeature(DS.TROUBLESHOOTING))try{HA.setTrack(this.rawAudioTrack)}catch(e){BS.error("Troubleshooter::micTest::Error while setting track",{error:e})}}}))}enableVideo(){return tr(this,null,(function*(){var e;if(Qt(this,wI).canProduceVideo!==rE.notAllowed&&(Qt(this,wI).canProduceVideo!==rE.canRequest||"OFF_STAGE"!==this.stageStatus&&"REQUESTED_TO_JOIN_STAGE"!==this.stageStatus)&&!this.videoEnabled){if(yield this.localMediaHandler.enableVideo(),this.roomJoined&&("HIVE"!==this.permissions.mediaRoomType||"ON_STAGE"===this.stageStatus))try{yield Qt(this,CI,AI).shareWebcam(this.videoTrack)}catch(e){BS.error("DyteSelf::enableVideo::Error while sharing video",{error:e}),this.videoEnabled&&(yield this.localMediaHandler.disableVideo())}if(this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),BS.info("DyteSelf.enableVideo",qt({},SC(this))),fi.videoOn(),Ci.hasFeature(DS.TROUBLESHOOTING))try{SI.setTrack(null==(e=this.videoTrack)?void 0:e.clone())}catch(e){BS.error("Troubleshooter::camTest::Error while setting track",{error:e})}}}))}updateVideoConstraints(e){return tr(this,null,(function*(){if(!this.localMediaHandler.updateVideoConstraints)throw new qS("Unsupported");yield this.localMediaHandler.updateVideoConstraints(e)}))}enableScreenShare(){return tr(this,null,(function*(){var e;if(!this.roomJoined)throw new qS("Can`t enable screenshare without joining room");if(Qt(this,wI).canProduceScreenshare===rE.notAllowed||Qt(this,wI).canProduceScreenshare===rE.canRequest&&("OFF_STAGE"===this.stageStatus||"REQUESTED_TO_JOIN_STAGE"===this.stageStatus)||this.screenShareEnabled)return;if(yield this.localMediaHandler.enableScreenShare(),this.screenShareTracks.audio||this.screenShareTracks.video)try{yield Qt(this,CI,AI).shareScreen(this.screenShareTracks)}catch(e){BS.error("DyteSelf::enableScreenShare::Error while sharing screen",{error:e}),this.screenShareEnabled&&(yield this.localMediaHandler.disableScreenShare())}this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks});const t=Ci.hasFeature(DS.TROUBLESHOOTING);if(t&&this.screenShareTracks.audio)try{GA.setTrack(this.screenShareTracks.audio)}catch(e){BS.error("Troubleshooter::screenshareMicTest::Error while setting track",{error:e})}if(t&&this.screenShareTracks.video)try{EI.setTrack(null==(e=this.screenShareTracks.video)?void 0:e.clone())}catch(e){BS.error("Troubleshooter::screenshareCamTest::Error while setting track",{error:e})}}))}updateScreenshareConstraints(e){return tr(this,null,(function*(){if(!this.localMediaHandler.updateScreenshareConstraints)throw new qS("Unsupported");yield this.localMediaHandler.updateScreenshareConstraints(e)}))}disableAudio(){return tr(this,null,(function*(){this.audioEnabled&&(this.localMediaHandler.disableAudio(),this.roomJoined&&Qt(this,CI,AI).muteSelf(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}),fi.audioOff())}))}disableVideo(){return tr(this,null,(function*(){this.videoEnabled&&(yield this.localMediaHandler.disableVideo(),this.roomJoined&&(yield Qt(this,CI,AI).pauseWebcam()),"ACCEPTED"===this.mediaPermissions.video)&&(this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),fi.videoOff(),Ci.hasFeature(DS.TROUBLESHOOTING)&&!SI.preview&&SI.cleanup())}))}disableScreenShare(){return tr(this,null,(function*(){this.screenShareEnabled&&(yield this.localMediaHandler.disableScreenShare(),this.roomJoined&&(yield Qt(this,CI,AI).disableScreenShare()),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks}),Ci.hasFeature(DS.TROUBLESHOOTING)&&(EI.cleanup(),GA.cleanup()))}))}getAllDevices(){return this.localMediaHandler.getAllDevices()}setIsPinned(e,t=!0){Zt(this,kI,e);const r=e?"pinned":"unpinned";t&&this.emit(r,this)}get isPinned(){return Qt(this,kI)}get webinarStageStatus(){return Qt(this,RI)}pin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new qS("Can`t pin participants without joining room");return Qt(this,CI,AI).pinPeer(this.id)}))}unpin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new qS("Can`t unpin participants without joining room");return Qt(this,CI,AI).pinPeer(null)}))}setDevice(e){return tr(this,null,(function*(){var t,r,i;if(!e)throw new qS("No device selected");const n={added:[e],removed:[]},s=this.getCurrentDevices();if(e.deviceId&&((null==(t=null==s?void 0:s.audio)?void 0:t.deviceId)===e.deviceId||(null==(r=null==s?void 0:s.video)?void 0:r.deviceId)===e.deviceId||(null==(i=null==s?void 0:s.speaker)?void 0:i.deviceId)===e.deviceId)&&(BS.warn("DyteSelf.setDevice.setting_to_in_use_device",{devices:[e]}),Ci.hasFeature(DS.SKIP_SETTING_IN_USE_DEVICE)))throw new qS("Cannot set device currently in use");if("isDeprecated"in this.localMediaHandler)yield this.localMediaHandler.onDeviceChange(n,!0);else switch(e.kind){case"audioinput":try{yield this.localMediaHandler.setAudioDevice(e)}catch(e){this.roomJoined&&(yield Qt(this,CI,AI).muteSelf()),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":yield this.localMediaHandler.setSpeakerDevice(e);break;case"videoinput":try{yield this.localMediaHandler.setVideoDevice(e)}catch(e){this.roomJoined&&(yield Qt(this,CI,AI).pauseWebcam()),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}}}))}cleanUpTracks(){var e,t,r,i;null==(e=this.audioTrack)||e.stop(),null==(t=this.rawAudioTrack)||t.stop(),null==(r=this.videoTrack)||r.stop(),null==(i=this.rawVideoTrack)||i.stop()}requestToJoinStage(){return tr(this,null,(function*(){tE.emitAsync(XS.REQUEST_TO_JOIN_STAGE)}))}withdrawRequestToJoinStage(){return tr(this,null,(function*(){tE.emitAsync(XS.WITHDRAW_REQUEST_TO_JOIN_STAGE)}))}leaveStage(){return tr(this,null,(function*(){tE.emitAsync(XS.LEAVE_STAGE)}))}joinStage(){return tr(this,null,(function*(){tE.emitAsync(XS.JOIN_STAGE)}))}setWebinarStageStatus(e){switch(Zt(this,RI,e),tE.emit(XS.SET_WEBINAR_STAGE_STATUS,e),e){case"ACCEPTED_TO_JOIN_STAGE":this.emit("joinStageRequestAccepted");break;case"REQUESTED_TO_JOIN_STAGE":this.emit("peerRequestToJoinStage");break;case"OFF_STAGE":this.emit("stageLeft")}}disablePreview(){return tr(this,null,(function*(){return this}))}},bI=new WeakMap,wI=new WeakMap,kI=new WeakMap,RI=new WeakMap,CI=new WeakSet,AI=function(){return _C()},II);MI([VS.trace("DyteSelf.setupEvents")],xI.prototype,"setupEvents",1),MI([VS.trace("DyteSelf.setupTracks")],xI.prototype,"setupTracks",1),MI([VS.trace("DyteSelf.resetSelf")],xI.prototype,"resetSelf",1),MI([VS.trace("DyteSelf.destructMediaHandler")],xI.prototype,"destructMediaHandler",1),MI([VS.trace("DyteSelf.removeDocumentEventListeners")],xI.prototype,"removeDocumentEventListeners",1),MI([qA({methodName:"meeting.self.enableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),VS.trace("DyteSelf.enableAudio")],xI.prototype,"enableAudio",1),MI([qA({methodName:"meeting.self.enableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),VS.trace("DyteSelf.enableVideo")],xI.prototype,"enableVideo",1),MI([VS.trace("DyteSelf.updateVideoConstraints")],xI.prototype,"updateVideoConstraints",1),MI([VS.trace("DyteSelf.enableScreenShare"),qA({methodName:"meeting.self.enableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3})],xI.prototype,"enableScreenShare",1),MI([VS.trace("DyteSelf.updateScreenshareConstraints")],xI.prototype,"updateScreenshareConstraints",1),MI([qA({methodName:"meeting.self.disableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),VS.trace("DyteSelf.disableAudio")],xI.prototype,"disableAudio",1),MI([qA({methodName:"meeting.self.disableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),VS.trace("DyteSelf.disableVideo")],xI.prototype,"disableVideo",1),MI([qA({methodName:"meeting.self.disableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3}),VS.trace("DyteSelf.disableScreenShare")],xI.prototype,"disableScreenShare",1),MI([VS.trace("DyteSelf.setDevice")],xI.prototype,"setDevice",1),MI([VS.trace("DyteSelf.requestToJoinStage")],xI.prototype,"requestToJoinStage",1),MI([VS.trace("DyteSelf.withdrawRequestToJoinStage")],xI.prototype,"withdrawRequestToJoinStage",1),MI([VS.trace("DyteSelf.leaveStage")],xI.prototype,"leaveStage",1),MI([VS.trace("DyteSelf.joinStage")],xI.prototype,"joinStage",1),MI([VS.trace("DyteSelf.deprecated.disablePreview")],xI.prototype,"disablePreview",1),xI=MI([KS((e=>{throw new qS(e.message,"1100")}))],xI);class LI{constructor(e){Kt(this,"socket"),this.socket=e,this.handleSocketEvents()}static create(e){return NI||(NI=new LI(e)),NI}static cleanup(){var e;try{null==(e=null==NI?void 0:NI.socket)||e.disconnect()}catch(e){BS.error("roomSocketHandler::cleanup")}NI=void 0}set onReconnect(e){this.socket.onStateEvent("reconnected",e)}joinRoom(e,t,r,i,n){return tr(this,null,(function*(){const s={capabilities:[],peer:{displayName:e,peerId:t,userId:r,waitlisted:!1},roomUuid:i},o=QT.fromBinary((yield this.socket.sendMessagePromise(Jw.joinRoom,ob.toBinary(s))).payload);yield tE.emitAsync(XS.SOCKET_SERVICE_ROOM_JOINED,o);try{const{room:e}=yield this.getRoomState();if(n===gi.GroupCall||n===gi.Webinar){const{peers:e}=yield this.getRoomPeersNonPaginated();yield tE.emitAsync(XS.SOCKET_PEERS,e)}tE.emit(XS.ROOM_STATE,e)}catch(e){BS.error("RoomSocketHandler.joinRoom.failedToGetRoomState",{error:e})}}))}getAllAddedParticipants(){return tr(this,null,(function*(){try{return kb.fromBinary((yield this.socket.sendMessagePromise(Jw.getAllAddedParticipants)).payload).participants.map((e=>{var t=e,{id:r}=t,i=Jt(t,["id"]);return zt(qt({},i),{userId:r})}))}catch(e){return[]}}))}getRoomPeers(e,t,r){return tr(this,null,(function*(){let i;try{const n={seachQuery:e,limit:t,offset:r},s=yield this.socket.sendMessagePromise(Jw.getRoomPeersInfo,ZT.toBinary(n));i=eb.fromBinary(s.payload)}catch(e){BS.error("getRoomPeers::binary_decode_error",{error:e})}return i}))}getRoomPeersNonPaginated(){return tr(this,null,(function*(){let e;try{const t=yield this.socket.sendMessagePromise(Jw.getRoomPeersInfo);e=eb.fromBinary(t.payload)}catch(e){BS.error("getRoomJoinedPeers::binary_decode_error",{error:e})}return e}))}getPeerInfo(e){return tr(this,null,(function*(){let t;try{const r=yield this.socket.sendMessagePromise(Jw.getPeerInfo,sb.toBinary({peerId:e}));t=QT.fromBinary(r.payload)}catch(e){BS.error("getPeerInfo::binary_decode_error",{error:e})}return t}))}getRoomState(){return tr(this,null,(function*(){let e=nb.create();try{const t=yield this.socket.sendMessagePromise(Jw.getRoomInfo);e=nb.fromBinary(t.payload)}catch(e){BS.error("getRoomState::binary_decode_error",{error:e})}return e}))}getRoomStageState(){return tr(this,null,(function*(){let e=Ob.create();try{const t=yield this.socket.sendMessagePromise(Jw.getRoomStageState);e=Ob.fromBinary(t.payload)}catch(e){BS.error("getRoomStageState::binary_decode_error",{error:e})}return e}))}broadcastMessage(e,t){return tr(this,null,(function*(){const r={type:e,payload:(new TextEncoder).encode(JSON.stringify(t)),timestamp:Date.now(),peerIds:[]};return this.socket.sendMessagePromise(Jw.broadcastMessage,Ab.toBinary(r))}))}broadcastToPeers(e,t,r){return tr(this,null,(function*(){const i={type:e,payload:(new TextEncoder).encode(JSON.stringify(r)),timestamp:Date.now(),peerIds:t};return this.socket.sendMessagePromise(Jw.broadcastToPeers,Ab.toBinary(i))}))}leaveRoom(){this.socket.sendMessage(Jw.leaveRoom,ab.toBinary({}))}kick(e){return tr(this,null,(function*(){const t={peerIds:[e]};this.socket.sendMessage(Jw.kick,Cb.toBinary(t))}))}kickAll(){return tr(this,null,(function*(){this.socket.sendMessage(Jw.kickAll)}))}getWaitingRoomRequests(){this.socket.sendMessage(Jw.getWaitingRoomRequests)}acceptWaitingRoomRequest(e){const t={userIds:e};this.socket.sendMessage(Jw.acceptWaitingRoomRequests,Ib.toBinary(t))}rejectWaitingRoomRequest(e){const t={userIds:e};this.socket.sendMessage(Jw.denyWaitingRoomRequests,Pb.toBinary(t))}updatePermissions(e,t){return tr(this,null,(function*(){const r={updatePeersPresets:[]};return e.forEach((e=>{r.updatePeersPresets.push({userIds:e,patch:t})})),this.socket.sendMessagePromise(ek.updateUserPreset,vT.toBinary(r))}))}handleSocketEvents(){this.socket.on(Jw.broadcastMessage,(({payload:e})=>{try{const t=Ab.fromBinary(e);tE.emit(XS.ROOM_MESSAGE,{payload:JSON.parse((new TextDecoder).decode(t.payload)),type:t.type,timestamp:t.timestamp})}catch(e){BS.error("failed to decode broadcast message:",e)}})),this.socket.on(Jw.broadcastToPeers,(({payload:e})=>{try{const t=Ab.fromBinary(e);tE.emit(XS.MESSAGE,{payload:JSON.parse((new TextDecoder).decode(t.payload)),type:t.type,timestamp:t.timestamp})}catch(e){BS.error("failed to decode peer broadcast message:",e)}}))}on(e,t){let r,i;switch(e){case Jw.joinRoom:case Jw.leaveRoom:case Jw.kick:case Jw.kickAll:r=QT.fromBinary.bind(QT),i=QT.create();break;case Jw.getWaitingRoomRequests:r=(e,t)=>e?Mb.fromBinary(e,t):{requests:[]},i=Mb.create();break;case Jw.recordingPaused:case Jw.recordingStarted:case Jw.recordingStopped:r=hw.fromBinary.bind(hw);break;case ek.updateUserPreset:r=yT.fromBinary.bind(yT)}this.socket.on(e,(({payload:e})=>{let n=i;if(!r)return t(void 0);try{n=r(e)}catch(e){BS.error("roomSocketHandler::on::binary_decode_error",{error:e})}return t(n)}))}getUserPermissions(e){return tr(this,null,(function*(){const t={userIds:[e]};try{const e=yield this.socket.sendMessagePromise(ek.getUserPresets,hT.toBinary(t)),r=fT.fromBinary(e.payload).peerPresets[0],i=(new TextDecoder).decode(r.preset),n=JSON.parse(i).permissions;return{chat:n.chat,polls:n.polls,plugins:n.plugins}}catch(e){throw BS.error("Error in getting user preset",{error:e}),e}}))}}var jI,UI,FI,VI,BI,WI=Object.defineProperty,HI=Object.getOwnPropertyDescriptor,GI=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?HI(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&WI(t,r,s),s};const $I=(BI=class{constructor(e,t,r,i){var n,s,o,a;Xt(this,FI),Kt(this,"self"),Kt(this,"authToken"),Kt(this,"peerId"),Xt(this,jI,void 0),Kt(this,"roomNodeSetupInProgress",!1),Kt(this,"viewType"),Xt(this,UI,void 0),Zt(this,jI,e),Zt(this,UI,r),this.authToken=null!=(s=null==(n=_C())?void 0:n.authToken)?s:e.authToken,this.peerId=null!=(a=null==(o=_C())?void 0:o.peerId)?a:e.peerId,this.self=t,this.viewType=i,t.config.viewType!==gi.Chat&&this.setupEvents()}get roomJoined(){var e;return!0===(null==(e=Qt(this,FI,VI))?void 0:e.roomJoined)}static init(e,t,r,i,n,s,o=!1){return tr(this,null,(function*(){var a,c;const d=qw(),{isV2AuthToken:l}=Sw,u=yield xI.__init__(null!=(c=null==(a=_C())?void 0:a.peerId)?c:e.peerId,Sw.isV2AuthToken?r.participant:r,i,n,s,o),p=l?r.participant.organizationId:r.organizationId;if(VS.meetingMetadata.organizationId=p,Ci.hasFeature(DS.INTERNAL_CALL_STATS)&&"ReactNative"!==navigator.product){Ci.getValue(DS.CALLSTATS_INGESTION_LAYER);const t=!Ci.hasFeature(DS.PRECALL_BANDWIDTH_TEST);setTimeout((()=>tr(this,null,(function*(){var r,i;fi.initialize({peerId:null!=(i=null==(r=_C())?void 0:r.peerId)?i:e.peerId,engineName:_S.getDeviceInfo().engineName,env:td.env,iceServers:yield d.getICEServers(),apiBase:td.apiBase,flags:Ci.getAllFlags(),logger:BS,apiHostnames:Mw(),skipConnectivityChecks:t})}))))}return new $I(e,u,t,n.viewType)}))}shareMediaTracks(){return tr(this,null,(function*(){if(this.self.audioTrack&&this.self.audioEnabled)try{yield Qt(this,FI,VI).shareMic(this.self.audioTrack)}catch(e){this.self.disableAudio()}if(this.self.videoTrack)try{const e=yield Qt(this,FI,VI).shareWebcam(this.self.videoTrack);e&&e.id!==this.self.videoTrack.id&&Ci.hasFeature(DS.EXP_RESHARE)&&(yield Qt(this,FI,VI).shareWebcam(this.self.videoTrack))}catch(e){this.self.disableVideo()}}))}kickHandler(e){return tr(this,null,(function*(){let t="kicked";"kickAll"===(null==e?void 0:e.kickType)&&(t="ended"),this.leaveRoom(t)}))}waitlistedHandler(e){BS.info("SelController.waitlisted",{source:e}),this.self.waitlistStatus="waiting",this.self.roomState="waitlisted",this.self.emit("waitlisted")}waitlistAcceptHandler(e){BS.info("SelController.waitlistAccepted",{source:e}),"accepted"!==this.self.waitlistStatus?(this.self.waitlistStatus="accepted",this.joinRoom()):BS.warn("SelfController.WAITLIST_ACCEPTED.UserAlreadyAccepted")}waitlistRejectedHandler(e){BS.info("SelfController.waitlistRejected",{source:e}),"rejected"!==this.self.waitlistStatus?(this.self.waitlistStatus="rejected",this.leaveRoom("rejected")):BS.warn("SelfController.WAITLIST_REJECTED.UserAlreadyRejected")}setupEvents(){tE.on(XS.DISABLE_AUDIO,(()=>tr(this,null,(function*(){this.self.audioEnabled&&(yield this.self.disableAudio(),fi.audioOff())})))),tE.on(XS.DISABLE_VIDEO,(()=>tr(this,null,(function*(){this.self.videoEnabled&&(yield this.self.disableVideo(),fi.videoOff())})))),tE.on(XS.MUTE_ALL,(()=>tr(this,null,(function*(){this.self.audioEnabled&&(yield this.self.disableAudio(),fi.audioOff())})))),tE.on(XS.MUTE_ALL_VIDEO,(()=>tr(this,null,(function*(){this.self.videoEnabled&&(yield this.self.disableVideo(),fi.videoOff())})))),tE.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(e=>tr(this,null,(function*(){var t;null!=(t=null==e?void 0:e.peer)&&t.waitlisted&&Qt(this,FI,VI)instanceof MR&&this.waitlistedHandler("socketservice")})))),tE.on(XS.WAITLISTED,(()=>{this.waitlistedHandler("roomnode")})),tE.on(XS.WAITLIST_ACCEPTED,(()=>tr(this,null,(function*(){this.waitlistAcceptHandler("roomnode")})))),Qt(this,UI).on(Jw.waitingRoomRequestAccepted,(()=>{this.waitlistAcceptHandler("socketservice")})),Qt(this,UI).on(ek.updateUserPreset,(e=>{e.updatePeersPresets.forEach((e=>{e.userIds===this.self.userId&&tE.emit(XS.UPDATE_PERMISSIONS,e.patch)}))})),tE.on(XS.WAITLIST_REJECTED,(()=>tr(this,null,(function*(){this.waitlistRejectedHandler("roomnode")})))),Qt(this,UI).on(Jw.waitingRoomRequestDenied,(()=>{this.waitlistRejectedHandler("socketservice")})),tE.on(XS.KICKED,this.kickHandler.bind(this)),Qt(this,UI).on(Jw.kick,(()=>{this.kickHandler({kickType:"kick"})})),Qt(this,UI).on(Jw.kickAll,(()=>{this.kickHandler({kickType:"kickAll"})})),tE.on(XS.PRODUCER_SCORE_UPDATE,(({score:e,kind:t,appData:r})=>{var i;const n="video"===t&&null!=(i=null==r?void 0:r.screenShare)&&i;this.self.emit("mediaScoreUpdate",{kind:t,isScreenshare:n,score:e,participantId:this.self.id})})),tE.onAsync(XS.JOIN_MEDIA_ROOM,this.setupRoomNode.bind(this)),tE.onAsync(XS.LEAVE_MEDIA_ROOM,this.leaveMediaRoom.bind(this)),tE.on(XS.PIP_HANGUP,this.leaveRoom.bind(this)),tE.onAsync(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){"ON_STAGE"===e&&(yield this.shareMediaTracks())})))),tE.on(XS.HIVE_ROOM_REJOINED,(()=>{this.shareMediaTracks()}))}setupRoomNode(){return tr(this,null,(function*(){var e;if(this.roomNodeSetupInProgress)return void BS.warn("SelfController.roomNodeSetupInProgress");if(null!=(e=Qt(this,FI,VI))&&e.roomJoined)return void BS.warn("SelfController.roomNodeAlreadySetup");this.roomNodeSetupInProgress=!0;const t=()=>tr(this,null,(function*(){var e,t;let r="";if(Qt(this,FI,VI)instanceof fC){yield Qt(this,FI,VI).setupTransports();const i=yield Qt(this,FI,VI).getRoomState();({roomUUID:r}=null!=(t=null==(e=null==i?void 0:i.payload)?void 0:e.roomState)?t:{}),qw().setRoomUUID(r)}yield this.joinMediaRoom(r),this.roomNodeSetupInProgress=!1})),r=Sw.roomNodeOptions;r.useHiveMedia?yield gC(zt(qt({},r),{roomName:r.roomName,peerId:r.peerId,socket:Qt(this,jI)})):yield vC(zt(qt({},r),{roomName:r.roomName,peerId:r.peerId,viewType:this.viewType})),Qt(this,FI,VI).mediaConnected||Qt(this,jI).isConnected&&"HIVE"===this.self.permissions.mediaRoomType?t():tE.once(XS.ROOM_NODE_CONNECTED,(()=>tr(this,null,(function*(){t()}))))}))}joinRoom(){return tr(this,null,(function*(){var e,t;try{const r=qw();let i="";if(Qt(this,FI,VI)instanceof fC){const n=yield Qt(this,FI,VI).getRoomState();({roomUUID:i}=null!=(t=null==(e=null==n?void 0:n.payload)?void 0:e.roomState)?t:{}),r.setRoomUUID(i)}else r.setRoomUUID(Sw.meetingId);Cw(this.self.config.viewType,Qt(this,jI).capabilities)&&(yield Qt(this,UI).joinRoom(this.self.name,this.self.id,this.self.userId,i,this.self.config.viewType),Qt(this,UI).socket.flush(),Qt(this,UI).onReconnect=()=>tr(this,null,(function*(){yield Qt(this,UI).joinRoom(this.self.name,this.self.id,this.self.userId,i,this.self.config.viewType),Qt(this,UI).socket.flush()}))),TI(this.self.config)&&(yield this.joinMediaRoom(i))}catch(e){throw BS.error("Error in joinRoom",{error:e}),e}}))}leaveRoom(e="left"){return tr(this,null,(function*(){var t;const{roomJoined:r}=this;Ci.hasFeature(DS.LEAVE_STAGE_ON_END)&&this.self.permissions.stageEnabled&&"ON_STAGE"===this.self.stageStatus&&"left"===e&&(yield tE.emitAsync(XS.LEAVE_STAGE)),yield this.leaveMediaRoom();try{null==(t=Qt(this,jI))||t.disconnect()}catch(e){BS.error("SelfController::leaveRoom::socketDisconnect")}this.self.roomState=e,yC(),LI.cleanup(),("rejected"===e||"LIVESTREAM"===this.self.config.viewType||r)&&this.self.emit("roomLeft",{state:e})}))}joinMediaRoom(e){return tr(this,null,(function*(){var t,r,i,n;if(null!=(t=Qt(this,FI,VI))&&t.isDisconnected&&Qt(this,FI,VI)instanceof fC)return void(null==(r=Qt(this,FI,VI))||r.reconnect());if(Qt(this,FI,VI)instanceof MR&&"waiting"===this.self.waitlistStatus)return;const{roomJoined:s}=null!=(n=yield null==(i=Qt(this,FI,VI))?void 0:i.joinRoom(this.self.name,!this.self.audioEnabled,e,void 0,{audio:this.self.audioEnabled,video:this.self.videoEnabled,screen:this.self.screenShareEnabled}))?n:{};Qt(this,FI,VI)instanceof MR&&(Qt(this,FI,VI).onSocketReconnection=this.joinMediaRoom.bind(this,e)),s&&(this.self.roomState="joined",this.self.emit("roomJoined"),yield this.shareMediaTracks())}))}leaveMediaRoom(){return tr(this,null,(function*(){yield this.cleanupSelf(),Qt(this,FI,VI)&&this.roomJoined&&(yield Qt(this,FI,VI).leaveRoom(),Qt(this,FI,VI).roomJoined=!1)}))}cleanupSelf(){return tr(this,null,(function*(){yield this.self.disableAudio(),yield this.self.disableVideo(),yield this.self.disableScreenShare(),this.self.cleanUpTracks(),this.self.destructMediaHandler(),this.self.removeDocumentEventListeners()}))}},jI=new WeakMap,UI=new WeakMap,FI=new WeakSet,VI=function(){return _C()},BI);let qI=$I;GI([VS.trace("SelfController.setupEvents")],qI.prototype,"setupEvents",1),GI([VS.trace("SelfController.joinRoom")],qI.prototype,"joinRoom",1),GI([VS.trace("SelfController.leaveRoom")],qI.prototype,"leaveRoom",1),GI([VS.trace("SelfController.joinMediaRoom")],qI.prototype,"joinMediaRoom",1),GI([VS.trace("SelfController.leaveMediaRoom")],qI.prototype,"leaveMediaRoom",1);var zI,JI,KI,YI,QI,XI,ZI,eP=Object.defineProperty,tP=Object.getOwnPropertyDescriptor,rP=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?tP(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&eP(t,r,s),s};let iP=(ZI=class extends HS{constructor(e,t,r){super(),Xt(this,KI),Kt(this,"id"),Kt(this,"userId"),Kt(this,"name"),Kt(this,"picture"),Kt(this,"isHost"),Kt(this,"customParticipantId"),Kt(this,"flags"),Kt(this,"device"),Kt(this,"videoTrack"),Kt(this,"audioTrack"),Kt(this,"screenShareTracks"),Kt(this,"videoEnabled"),Kt(this,"audioEnabled"),Kt(this,"screenShareEnabled"),Kt(this,"producers"),Xt(this,zI,void 0),Kt(this,"supportsRemoteControl",!1),Xt(this,JI,void 0),Kt(this,"presetName"),Xt(this,QI,void 0),Xt(this,XI,void 0);const{id:i,userId:n,displayName:s,device:o,picture:a,isHost:c,flags:d,clientSpecificId:l,stageStatus:u,customParticipantId:p,audioMuted:h,audioTrack:m,videoEnabled:f=!1,videoTrack:g,producers:v,metadata:y}=e;this.id=i,this.userId=n,this.name=s,this.device=o,this.picture=a,this.isHost=c,this.flags=d,Zt(this,JI,null!=u?u:OI.ON_STAGE),this.customParticipantId=null!=p?p:l,this.audioEnabled=!h,this.audioTrack=m,this.videoEnabled=f,this.videoTrack=g,this.screenShareTracks={audio:void 0,video:void 0},this.producers=null!=v?v:[],this.presetName=null==y?void 0:y.preset_name,Zt(this,zI,!1),Zt(this,QI,t),Zt(this,XI,r),this.setupEvents()}get clientSpecificId(){return this.customParticipantId}get webinarStageStatus(){return Qt(this,JI)}get stageStatus(){return Qt(this,JI)}get roomJoined(){var e;return!0===(null==(e=Qt(this,KI,YI))?void 0:e.roomJoined)}setVideoEnabled(e,t=!0){this.videoEnabled=e,t&&(BS.info("DyteParticipant::setVideoEnabled::videoUpdate",qt({},SC(this))),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}))}setAudioEnabled(e,t=!0){this.audioEnabled=e,t&&(BS.info("DyteParticipant::setAudioEnabled::audioUpdate",qt({},SC(this))),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}))}setScreenShareEnabled(e,t=!0){this.screenShareEnabled=e,t&&this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}setupEvents(){tE.onAsync(XS.UPDATE_PEER_STAGE_STATUS,(e=>tr(this,[e],(function*({id:e,status:t}){e===this.id&&t!==this.stageStatus&&this.setStageStatus(t)}))))}pin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new qS("Can`t pin participant without joining room");if(!Qt(this,QI).permissions.pinParticipant)throw new qS("You do not have permission to pin participants.");return Qt(this,KI,YI).pinPeer(this.id)}))}unpin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new qS("Can`t unpin participant without joining room");if(!Qt(this,QI).permissions.pinParticipant)throw new qS("You do not have permission to unpin participants.");return Qt(this,KI,YI).pinPeer(null)}))}setIsPinned(e,t=!0){Zt(this,zI,e);const r=e?"pinned":"unpinned";t&&this.emit(r,this)}disableAudio(){return tr(this,null,(function*(){const e=this.id;if(BS.info("DyteParticipant::disable_audio",{dyteParticipant:{id:e}}),!this.roomJoined)throw new qS("Can`t disable participant audio without joining room");if(Qt(this,QI).permissions.canDisableParticipantAudio)return Qt(this,KI,YI).disableAudio(e);throw BS.error("DyteParticipant::unauthorized_disable_audio",{dyteParticipant:{id:e}}),new qS("Unauthorized: User does not have permission to disable participant audio.")}))}kick(){return tr(this,null,(function*(){const e=this.id;if(BS.info("DyteParticipant::kick",{dyteParticipant:{id:e}}),!this.roomJoined)throw new qS("Can`t kick participant without joining room");if(!Qt(this,QI).permissions.kickParticipant)throw BS.error("DyteParticipant::unauthorized_kick",{dyteParticipant:{id:e}}),new qS("Unauthorized: User does not have permission to kick participants.");yield tE.emitAsync(XS.KICK_PEER,{peerId:e})}))}disableVideo(){return tr(this,null,(function*(){const e=this.id;if(BS.info("DyteParticipant::disable_video",{dyteParticipant:{id:e}}),!this.roomJoined)throw new qS("Can`t disable participant video without joining room");if(Qt(this,QI).permissions.canDisableParticipantVideo)return Qt(this,KI,YI).disableVideo(e);throw BS.error("DyteParticipant::unauthorized_disable_video",{dyteParticipant:{id:e}}),new qS("Unauthorized: User does not have permission to disable participant video.")}))}acceptJoinStageRequest(){return tr(this,null,(function*(){tE.emitAsync(XS.ACCEPT_JOIN_STAGE_REQUEST,{userId:this.userId})}))}rejectRequestToJoinStage(){return tr(this,null,(function*(){tE.emitAsync(XS.REJECT_REQUEST_TO_JOIN_STAGE,{userId:this.userId})}))}getPermissions(){return tr(this,null,(function*(){return Qt(this,XI).getUserPermissions(this.userId)}))}removeFromStage(){return tr(this,null,(function*(){tE.emitAsync(XS.REMOVE_FROM_STAGE,{userId:this.userId})}))}setStageStatus(e){let t;Zt(this,JI,e),e===OI.OFF_STAGE&&(t="peerStoppedPresenting"),e===OI.ON_STAGE&&(t="peerStartedPresenting"),e===OI.ACCEPTED_TO_JOIN_STAGE&&(t="peerAcceptedToJoinStage"),e===OI.REQUESTED_TO_JOIN_STAGE&&(Qt(this,KI,YI)instanceof fC&&tE.emit(XS.NEW_STAGE_REQUEST,{count:1}),t="peerRequestToJoinStage"),t&&this.emit(t,this),this.emit("stageStatusUpdate",this)}setWebinarStageStatus(e){this.setStageStatus(e)}get isPinned(){return Qt(this,zI)}},zI=new WeakMap,JI=new WeakMap,KI=new WeakSet,YI=function(){return _C()},QI=new WeakMap,XI=new WeakMap,ZI);var nP,sP,oP;rP([VS.trace("DyteParticipant.disableAudio")],iP.prototype,"disableAudio",1),rP([VS.trace("DyteParticipant.kick")],iP.prototype,"kick",1),rP([VS.trace("DyteParticipant.disableVideo")],iP.prototype,"disableVideo",1),rP([VS.trace("DyteParticipant.acceptJoinStageRequest")],iP.prototype,"acceptJoinStageRequest",1),rP([VS.trace("DyteParticipant.rejectRequestToJoinStage")],iP.prototype,"rejectRequestToJoinStage",1),rP([VS.trace("DyteParticipant.getPermissions")],iP.prototype,"getPermissions",1),rP([VS.trace("DyteParticipant.removeFromStage")],iP.prototype,"removeFromStage",1),rP([VS.trace("DyteParticipant.setStageStatus")],iP.prototype,"setStageStatus",1),iP=rP([KS((e=>{throw new qS(e.message,"1200")}))],iP);class aP extends Map{constructor(e){const{onAddEvent:t,onDeleteEvent:r,onClearEvent:i}=e;super(),Xt(this,nP,void 0),Xt(this,sP,void 0),Kt(this,"onAddEvent"),Kt(this,"onDeleteEvent"),Kt(this,"onClearEvent"),Zt(this,nP,new WS),this.onAddEvent=t,this.onDeleteEvent=r,this.onClearEvent=i,Zt(this,sP,new Map)}emit(e,...t){return Qt(this,nP).emit(e,...t)}on(e,t){return Qt(this,nP).on(e,t)}addListener(e,t){return Qt(this,nP).addListener(e,t)}off(e,t){return Qt(this,nP).off(e,t)}once(e,t){return Qt(this,nP).once(e,t)}prependListener(e,t){return Qt(this,nP).prependListener(e,t)}prependOnceListener(e,t){return Qt(this,nP).prependOnceListener(e,t)}removeListener(e,t){return Qt(this,nP).removeListener(e,t)}removeAllListeners(e){return Qt(this,nP).removeAllListeners(e)}listeners(e){return Qt(this,nP).listeners(e)}listenerCount(e){return Qt(this,nP).listenerCount(e)}getMaxListeners(){return Qt(this,nP).getMaxListeners()}setMaxListeners(e){return Qt(this,nP).setMaxListeners(e)}eventNames(){return Qt(this,nP).eventNames()}add(e,t=!0){return this.set(e.id,e,t)}set(e,t,r=!0){const i=super.set(e,t),n=(e,...r)=>{this.emit(e,t,...r)};return Qt(this,sP).set(e,n),t.on("*",n),r&&Qt(this,nP).emit(this.onAddEvent,t),i}delete(e,t=!0,r=!1){const i=this.get(e);if(!i)return!1;i.removeListener("*",Qt(this,sP).get(e));const n=super.delete(e);return r&&i.removeAllListeners(),t&&Qt(this,nP).emit(this.onDeleteEvent,i),n}clear(e=!0,t=!1){this.forEach((e=>{e.removeListener("*",Qt(this,sP).get(e.id)),t&&e.removeAllListeners()}));const r=super.clear();return e&&Qt(this,nP).emit(this.onClearEvent),r}toArray(){return Array.from(this.values())}}nP=new WeakMap,sP=new WeakMap;class cP extends aP{constructor(e){const{onAddEvent:t="participantJoined",onDeleteEvent:r="participantLeft",onClearEvent:i="participantsCleared"}=null!=e?e:{};super({onAddEvent:t,onDeleteEvent:r,onClearEvent:i})}add(e,t=!0){return this.has(e.id)&&!1===Object.is(this.get(e.id),e)&&this.delete(e.id),super.add(e,t)}clear(e=!0,t=!1){return super.clear(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}class dP{constructor(){Kt(this,"_orderedArray"),Kt(this,"_map"),this._map=new Map,this._orderedArray=[]}add(e,t){if(!this._map.has(e))return this._map.set(e,{peerId:e,priority:t}),this._orderedArray.splice(Math.max(t-1,0),0,e),this.index(e);const r=this.index(e);this.delete(e);const i=this.add(e,t);return r!==i?(BS.info("DyteSelectedPeer::add()::new_position_for_active_speaker",{selectedPeer:{oldIndex:r,newIndex:i}}),i):-1}delete(e){if(this._map.has(e)){const t=this.index(e);this._map.delete(e),this._orderedArray.splice(t,1)}}index(e){return this._map.has(e)?this._orderedArray.indexOf(e):-1}[Symbol.iterator](){return this._orderedArray[Symbol.iterator]()}}class lP{constructor(){Kt(this,"_activeSpeakerPeers"),Kt(this,"_compulsoryPeers"),this._activeSpeakerPeers=new dP,this._compulsoryPeers=new Set}add(e,t){if(t<0)return this._compulsoryPeers.add(e),0;if(this.compulsoryPeers.includes(e)&&(t>0||246267631===t)){if(BS.info("DyteSelectedPeer::removing_compulsory_peer",{selectedPeer:{peerId:e}}),this._removeFromCompulsoryPeer(e),246267631===t)return-1}else if(229490415===t)return this.delete(e),-1;return this._activeSpeakerPeers.add(e,t)}delete(e){BS.info("DyteSelectedPeer::deleting_peer_from_selectedPeer",{selectedPeer:{peerId:e}}),this._removeFromCompulsoryPeer(e),this._activeSpeakerPeers.delete(e)}index(e){return this._activeSpeakerPeers.index(e)}get peers(){return Array.from(new Set(this.compulsoryPeers.concat(this.activeSpeakerPeers)))}get compulsoryPeers(){return Array.from(this._compulsoryPeers.values())}get peerPriorities(){return Array.from(this._activeSpeakerPeers).map(((e,t)=>t))}get activeSpeakerPeers(){return Array.from(this._activeSpeakerPeers)}_removeFromCompulsoryPeer(e){this._compulsoryPeers.delete(e)}}class uP extends WS{constructor(){super(),Xt(this,oP,void 0),Zt(this,oP,new Map)}__set(e,t){return Qt(this,oP).set(e,t)}__clear(){return Qt(this,oP).clear()}get(e){return Qt(this,oP).get(e)}toArray(){return Array.from(Qt(this,oP).values())}}oP=new WeakMap;const pP=CS({setup_screen:{is_enabled:!1},alone_here:{is_enabled:!1},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!1,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{logo:"",timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,grid:{multi:{max_video_count:9,video_fit:"cover"},single:{max_video_count:6,video_fit:"cover"},default_view:"MULTI"},colors:{primary:"#2160FD",secondary:"#1A1A1A",text:"#EEEEEE",background:"#1A1A1A",text_primary:"#EEEEEE",video_background:"#1A1A1A"},controls:{pip_toggle:!1},plugins:[]});var hP,mP,fP,gP,vP;const yP=class{constructor(e){if(Xt(this,hP,void 0),Xt(this,mP,void 0),Xt(this,fP,void 0),Xt(this,gP,void 0),Xt(this,vP,[]),!e)throw new qS("Could not load preset theme.");Zt(this,hP,e),Zt(this,mP,1),Zt(this,fP,gi.GroupCall)}static fromResponse(e){return new yP(e)}static default(){return new yP(pP)}configFromPermissions(e){var t,r,i,n,s,o,a,c,d,l,u,p;Zt(this,mP,e.maxScreenshareCount||1),Zt(this,fP,e.viewType),Zt(this,gP,{audio:{enableHighBitrate:!1,enableStereo:!1},video:{quality:null!=(i=null==(r=null==(t=null==e?void 0:e.produce)?void 0:t.video)?void 0:r.quality)?i:MS.video.quality,frameRate:null!=(o=null==(s=null==(n=null==e?void 0:e.produce)?void 0:n.video)?void 0:s.frameRate)?o:MS.video.frameRate},screenshare:{quality:null!=(d=null==(c=null==(a=null==e?void 0:e.produce)?void 0:a.screenshare)?void 0:c.quality)?d:MS.screenshare.quality,frameRate:null!=(p=null==(u=null==(l=null==e?void 0:e.produce)?void 0:l.screenshare)?void 0:u.frameRate)?p:MS.screenshare.frameRate}})}setDisabledPlugins(e){const t=Qt(this,hP).plugins;t&&t.length>0&&Zt(this,vP,e.filter((e=>!t.includes(e))))}get setupScreen(){return Qt(this,hP).setupScreen}get aloneHere(){return Qt(this,hP).aloneHere}get waitingRoom(){return Qt(this,hP).waitingRoom}get controlBar(){return Qt(this,hP).controlBar}get header(){return Qt(this,hP).header}get pipMode(){var e;return(null==(e=Qt(this,hP).controls)?void 0:e.pipToggle)||Qt(this,hP).pipMode}get viewType(){return Qt(this,fP)}get autoTune(){return Qt(this,hP).autoTune}get grid(){return Qt(this,hP).grid}get maxVideoStreams(){return{mobile:this.grid.multi.maxVideoCount>6?6:this.grid.multi.maxVideoCount,desktop:this.grid.multi.maxVideoCount}}get maxScreenShareCount(){return Qt(this,mP)}get colors(){return Qt(this,hP).colors}get controls(){return Qt(this,hP).controls}get plugins(){return Qt(this,hP).plugins}get disabledPlugins(){return Qt(this,vP)}get mediaConstraints(){return Qt(this,gP)}get isV2(){return!1}};let _P=yP;function SP(e,t=2){return e.replace(/[^\u00BF-\u1FFF\u2C00-\uD7FF\w\s]/g,"").trim().split(/\s+/).slice(0,t).map((e=>e.charAt(0))).join("").toUpperCase()}hP=new WeakMap,mP=new WeakMap,fP=new WeakMap,gP=new WeakMap,vP=new WeakMap;const EP=(e,t,r,i,n,s)=>{const o=n,a=s,c=Math.min(r/o,i/a);let d,l,u,p,h=o*c,m=a*c,f=1;return h<r&&(f=r/h),Math.abs(f-1)<1e-14&&m<i&&(f=i/m),h*=f,m*=f,u=o/(h/r),p=a/(m/i),d=.5*(o-u),l=.5*(a-p),d<0&&(d=0),l<0&&(l=0),u>o&&(u=o),p>a&&(p=a),[d,l,u,p,e,t,r,i]};var TP,bP,wP,kP,RP,CP,AP,IP;class PP extends HS{constructor(e){var t,r,i,n,s,o,a,c;if(super(),Xt(this,TP,void 0),Xt(this,bP,void 0),Xt(this,wP,void 0),Xt(this,kP,{height:1080,width:1920}),Xt(this,RP,{brand:"#2160FD",background:"#141414",videoBackground:"#191919",textOnBrand:"#EEEEEE"}),Xt(this,CP,void 0),Xt(this,AP,{}),Xt(this,IP,void 0),Kt(this,"cleanupEventListeners",(()=>{Qt(this,IP).removeListener("stageJoined",this.enablePipMediaControls),Qt(this,IP).removeListener("stageLeft",this.unmountEvents),Qt(this,IP).removeListener("videoUpdate",this.onSelfVideoUpdateListener),Qt(this,IP).removeListener("audioUpdate",this.onSelfAudioUpdateListener),Qt(this,IP).removeListener("roomLeft",this.disable)})),Kt(this,"enablePipMediaControls",(()=>{this.mountAudioEvents(),this.mountVideoEvents()})),Kt(this,"onSelfVideoUpdateListener",(({videoEnabled:e})=>{this.updateMediaSession("CAMERA",e)})),Kt(this,"onSelfAudioUpdateListener",(({audioEnabled:e})=>{this.updateMediaSession("MIC",e)})),Kt(this,"eventCallback",(e=>{"CAMERA"===e&&(Qt(this,IP).videoEnabled?Qt(this,IP).disableVideo():Qt(this,IP).enableVideo(),this.emit("cameraToggled")),"MIC"===e&&(Qt(this,IP).audioEnabled?Qt(this,IP).disableAudio():Qt(this,IP).enableAudio(),this.emit("micToggled")),"END"===e&&(tE.emit(XS.PIP_HANGUP),this.cleanupEventListeners(),this.emit("hangup"),this.cleanup())})),Kt(this,"unmountEvents",(()=>{void 0===navigator.mediaSession||void 0===navigator.mediaSession.setCameraActive||(navigator.mediaSession.setActionHandler("togglemicrophone",void 0),navigator.mediaSession.setActionHandler("togglecamera",void 0))})),Kt(this,"animate",(()=>{void 0!==Qt(this,AP)&&this.paintCanvas(),void 0!==Qt(this,CP)&&Zt(this,CP,requestAnimationFrame((()=>this.animate())))})),Kt(this,"disable",(()=>{this.cleanupEventListeners(),cancelAnimationFrame(Qt(this,CP)),document.body.removeChild(Qt(this,bP)),Zt(this,CP,void 0),document.exitPictureInPicture()})),Zt(this,IP,e),!0===e.config.isV2)Zt(this,RP,{brand:e.config.designTokens.colors.brand[500],background:e.config.designTokens.colors.background[1e3],videoBackground:e.config.designTokens.colors.videoBg,textOnBrand:e.config.designTokens.colors.textOnBrand});else if(!1===e.config.isV2){const d=_P.default();Zt(this,RP,{brand:null!=(r=null==(t=e.config.colors)?void 0:t.primary)?r:d.colors.primary,background:null!=(n=null==(i=e.config.colors)?void 0:i.background)?n:d.colors.background,videoBackground:null!=(o=null==(s=e.config.colors)?void 0:s.videoBackground)?o:d.colors.videoBackground,textOnBrand:null!=(c=null==(a=e.config.colors)?void 0:a.textPrimary)?c:d.colors.textPrimary})}}createVideoContainer(){Zt(this,bP,document.createElement("div")),Qt(this,bP).style.width="0.1px",Qt(this,bP).style.height="0.1px",Qt(this,bP).style.overflow="hidden",Qt(this,bP).style.position="absolute",Qt(this,bP).style.bottom="0",Qt(this,bP).style.right="0",Qt(this,bP).style.opacity="0",Qt(this,bP).appendChild(Qt(this,wP))}setupEventListeners(){Qt(this,IP).addListener("stageJoined",this.enablePipMediaControls),Qt(this,IP).addListener("stageLeft",this.unmountEvents),Qt(this,IP).addListener("videoUpdate",this.onSelfVideoUpdateListener),Qt(this,IP).addListener("audioUpdate",this.onSelfAudioUpdateListener),Qt(this,IP).addListener("roomLeft",this.disable)}createCanvas(){const e=document.createElement("canvas");e.height=Qt(this,kP).height,e.width=Qt(this,kP).width,Zt(this,TP,e)}setupMediaSessionEvents(){void 0===navigator.mediaSession||void 0===navigator.mediaSession.setCameraActive||(navigator.mediaSession.setActionHandler("hangup",(()=>{this.eventCallback("END")})),this.mountAudioEvents(),this.mountVideoEvents())}mountAudioEvents(){void 0===navigator.mediaSession||void 0===navigator.mediaSession.setMicrophoneActive||Qt(this,IP).permissions.canProduceAudio&&navigator.mediaSession.setActionHandler("togglemicrophone",(()=>{this.eventCallback("MIC")}))}mountVideoEvents(){void 0===navigator.mediaSession||void 0===navigator.mediaSession.setCameraActive||Qt(this,IP).permissions.canProduceVideo&&navigator.mediaSession.setActionHandler("togglecamera",(()=>{this.eventCallback("CAMERA")}))}getSources(){const e=Object.values(Qt(this,AP)),t=e.filter((e=>e.pinned));return 1===t.length?t:e}drawEmptyTile(e,t,r,i,n){if(void 0===Qt(this,TP))return;const s=Qt(this,TP).getContext("2d"),o=Qt(this,TP).width,a=t-8,c=r-8,d=Math.floor(o/a),l=e%d*(a+4)+4,u=Math.floor(e/d)*(c+4)+4;s.fillStyle=Qt(this,RP).videoBackground,s.strokeStyle=Qt(this,RP).brand,s.beginPath(),s.moveTo(l+4,u),s.arcTo(l+a,u,l+a,u+4,4),s.arcTo(l+a,u+c,l+a-4,u+c,4),s.arcTo(l,u+c,l,u+c-4,4),s.arcTo(l,u,l+4,u,4),s.closePath(),s.fill(),s.stroke();const p=a/6,h=a/2+l,m=c/2+u;if(s.save(),(i||n)&&(s.beginPath(),s.arc(h,m,p,0,2*Math.PI),s.fillStyle=Qt(this,RP).brand,s.fill()),i&&(s.fillStyle=Qt(this,RP).textOnBrand,s.font=p/2+"px sans-serif",s.textAlign="center",s.textBaseline="middle",s.fillText(i,h,m)),n){const e=new Image;e.src=n,e.onload=()=>{s.drawImage(e,h-p,m-p,2*p,2*p),s.restore()}}}drawGrid(e,t,r){if(void 0===Qt(this,TP))return;const i=Qt(this,TP).getContext("2d");i.fillStyle=Qt(this,RP).background,i.fillRect(0,0,Qt(this,kP).width,Qt(this,kP).height);const n=this.getSources();let s=0,o=0;for(;s<Qt(this,kP).height-5;){let a=0;for(;a<Qt(this,kP).width-5&&o<r;){const r=n[o].element;if(n[o].enabled){const[n,o,c,d,l,u,p,h]=EP(a,s,e,t,r.videoWidth,r.videoHeight);i.drawImage(r,n,o,c,d,l,u,p,h)}else this.drawEmptyTile(o,e,t,n[o].displayText);o+=1,a+=e}s+=t}}calcGridElemSize(e){switch(e){case 0:case 1:return[Qt(this,kP).width,Qt(this,kP).height];case 2:return[Math.floor(Qt(this,kP).width/2),Qt(this,kP).height];case 3:case 4:return[Math.floor(Qt(this,kP).width/2),Math.floor(Qt(this,kP).height/2)];case 5:case 6:default:return[Math.floor(Qt(this,kP).width/3),Math.floor(Qt(this,kP).height/2)];case 7:case 8:case 9:return[Math.floor(Qt(this,kP).width/3),Math.floor(Qt(this,kP).height/3)]}}paintCanvas(){const e=this.getSources().length,[t,r]=this.calcGridElemSize(e);this.drawGrid(t,r,e)}isSupported(){return!!window.chrome&&document.pictureInPictureEnabled}get isActive(){return null!==document.pictureInPictureElement}cleanup(){if(this.isSupported()&&void 0!==document.exitPictureInPicture&&null!==document.pictureInPictureElement&&document.exitPictureInPicture(),Qt(this,bP))try{document.body.removeChild(Qt(this,bP))}catch(e){}this.removeAllSources(),Zt(this,TP,void 0),Zt(this,wP,void 0),Zt(this,CP,void 0)}init({height:e,width:t}={}){this.createCanvas(),this.setupMediaSessionEvents();const r=document.createElement("video");Zt(this,kP,{height:null!=e?e:1080,width:null!=t?t:1920}),r.height=Qt(this,kP).height,r.width=Qt(this,kP).width,r.autoplay=!0,r.muted=!0,r.srcObject=Qt(this,TP).captureStream(24),Zt(this,wP,r),Qt(this,wP).onloadedmetadata=()=>{try{this.emit("pipStarted"),Qt(this,wP).onleavepictureinpicture=()=>{this.emit("pipEnded")}}catch(e){this.emit("pipEnded")}},this.createVideoContainer(),this.paintCanvas()}updateMediaSession(e,t){void 0!==navigator.mediaSession&&("CAMERA"===e&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setCameraActive(t),"MIC"===e&&void 0!==navigator.mediaSession.setMicrophoneActive&&navigator.mediaSession.setMicrophoneActive(t))}enableSource(e){void 0!==Qt(this,AP)[e]&&(Qt(this,AP)[e].enabled=!0)}disableSource(e){void 0!==Qt(this,AP)[e]&&(Qt(this,AP)[e].enabled=!1)}addSource(e,t,r,i=!1,n=void 0){i&&this.removePinnedSource(),Qt(this,AP)[e]={id:e,element:t,enabled:r,pinned:i,displayText:n?SP(n):void 0}}removeSource(e){delete Qt(this,AP)[e]}removePinnedSource(){const[e]=this.getSources();e&&this.removeSource(e.id)}removeAllSources(){Zt(this,AP,{})}enable(){this.setupEventListeners(),this.updateMediaSession("CAMERA",Qt(this,IP).videoEnabled),this.updateMediaSession("MIC",Qt(this,IP).audioEnabled),document.body.appendChild(Qt(this,bP)),Zt(this,CP,requestAnimationFrame((()=>this.animate()))),Qt(this,wP).requestPictureInPicture()}}TP=new WeakMap,bP=new WeakMap,wP=new WeakMap,kP=new WeakMap,RP=new WeakMap,CP=new WeakMap,AP=new WeakMap,IP=new WeakMap;var DP,MP,OP,NP,xP,LP=Object.defineProperty,jP=Object.getOwnPropertyDescriptor,UP=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?jP(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&LP(t,r,s),s};let FP=(xP=class extends HS{constructor(e,t,r){var i;super(),Xt(this,DP),Kt(this,"waitlisted"),Kt(this,"joined"),Kt(this,"active"),Kt(this,"pinned"),Kt(this,"all"),Kt(this,"pip"),Xt(this,OP,void 0),Xt(this,NP,void 0),Kt(this,"viewMode"),Kt(this,"currentPage"),Kt(this,"lastActiveSpeaker"),Kt(this,"selectedPeers"),Zt(this,OP,e),Zt(this,NP,t),this.waitlisted=new cP,this.joined=new cP,this.active=new cP,this.pinned=new cP,this.all=new uP,this.selectedPeers=new lP,this.viewMode="ACTIVE_GRID",this.currentPage=0,(null==(i=null==r?void 0:r.pip)||i)&&(this.pip=new PP(e))}get roomJoined(){var e;return!0===(null==(e=Qt(this,DP,MP))?void 0:e.roomJoined)}get count(){return this.joined.size}get maxActiveParticipantsCount(){return Qt(this,DP,MP).maxPreferredStreams}get pageCount(){if("PAGINATED"===this.viewMode){const e=this.joined.toArray().filter((e=>"ON_STAGE"===e.stageStatus));return Math.ceil(e.length/this.maxActiveParticipantsCount)}return 0}acceptWaitingRoomRequest(e){var t,r;if(Qt(this,DP,MP)instanceof fC){if(!this.roomJoined)throw new qS("Can`t accept waiting room request without joining room");return Qt(this,DP,MP).acceptWaitingRequest(e)}const i=null!=(r=null==(t=this.waitlisted.get(e))?void 0:t.userId)?r:e;return Qt(this,NP).acceptWaitingRoomRequest([i])}acceptAllWaitingRoomRequest(e){return tr(this,null,(function*(){if(Qt(this,DP,MP)instanceof fC){const t=e.map((e=>this.acceptWaitingRoomRequest(e)));return Promise.all(t)}const t=e.map((e=>{var t,r;return null!=(r=null==(t=this.waitlisted.get(e))?void 0:t.userId)?r:e}));return Qt(this,NP).acceptWaitingRoomRequest(t)}))}rejectWaitingRoomRequest(e){return tr(this,null,(function*(){var t,r;if(Qt(this,DP,MP)instanceof fC){if(!this.roomJoined)throw new qS("Can`t reject waiting room request without joining room");yield Qt(this,DP,MP).rejectWaitingRequest(e),this.waitlisted.delete(e)}const i=null!=(r=null==(t=this.waitlisted.get(e))?void 0:t.userId)?r:e;Qt(this,NP).rejectWaitingRoomRequest([i])}))}setViewMode(e){return tr(this,null,(function*(){if(BS.info("DyteParticipants::set_view_mode",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),!["ACTIVE_GRID","PAGINATED"].includes(e))throw BS.error("DyteParticipants::setViewMode::invalid_view_mode",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new qS(`Invalid view mode: ${e}. Try ACTIVE_GRID or PAGINATED.`);if(this.viewMode!==e){if(this.viewMode=e,"PAGINATED"===e){this.currentPage=1;let e=[];Qt(this,DP,MP)instanceof fC?({peerIds:e}=(yield Qt(this,DP,MP).getPage(this.currentPage)).payload):e=this.getPeerIdsForCurrentPage(),tE.emit(XS.GET_PAGE,{peerIds:e})}else"ACTIVE_GRID"===e&&(this.currentPage=0,Qt(this,DP,MP)instanceof fC?Qt(this,DP,MP).getPage(this.currentPage):tE.emit(XS.REFRESH_GRID));this.emit("viewModeChanged",{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount})}else BS.info("DyteParticipants::setViewMode::view_mode_same_as_previous",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}})}))}getPeerIdsForCurrentPage(){BS.info("DyteParticipants::getPeerIdsForCurrentPage()",{pageNavigation:{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}});const{compulsoryPeers:e}=this.selectedPeers,t=e.filter((e=>this.joined.has(e))),r=Array.from(this.pinned.keys()).filter((e=>!t.includes(e))),i=Array.from(this.joined.toArray().filter((e=>"ON_STAGE"===e.stageStatus)).map((e=>e.id))),n=Math.max((this.currentPage-1)*(this.maxActiveParticipantsCount-t.length-r.length)),s=this.currentPage*(this.maxActiveParticipantsCount-t.length-r.length);return t.concat(r,i.slice(n,s))}setPage(e){return tr(this,null,(function*(){if(BS.info("DyteParticipants::set_page",{pageNavigation:{settingPage:e,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),"PAGINATED"!==this.viewMode)return;if(!Number.isInteger(e))throw BS.error("DyteParticipants::invalid_page_number",{pageNavigation:{settingPage:e,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new qS(`Invalid page: ${e}. Page must be an integer.`);if(e<1||e>this.pageCount)throw BS.error("DyteParticipants::invalid_page_number",{pageNavigation:{settingPage:e,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new qS(`Invalid page: ${e}. Page must be greater than 0 and less than or equal to ${this.pageCount}.`);this.currentPage=e;let t=[];Qt(this,DP,MP)instanceof fC?({peerIds:t}=(yield Qt(this,DP,MP).getPage(e)).payload):t=this.getPeerIdsForCurrentPage(),tE.emit(XS.GET_PAGE,{peerIds:t}),this.emit("pageChanged",{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount})}))}disableAllAudio(e){return tr(this,null,(function*(){if(BS.info("DyteParticipants::disable_all_audio",{actions:{disableAllAudio:{allowUnmute:e}}}),!this.roomJoined)throw new qS("Can`t disable all audio without joining room");if(Qt(this,OP).permissions.canAllowParticipantAudio)return Qt(this,DP,MP).muteAll(e);throw BS.error("DyteParticipants::unauthorized_disable_all_audio",{actions:{disableAllAudio:{allowUnmute:e}}}),new qS("Unauthorized: User does not have permission to disable peer audio.")}))}disableAllVideo(){return tr(this,null,(function*(){if(BS.info("DyteParticipants::disable_all_video"),!this.roomJoined)throw new qS("Can`t disable all video without joining room");if(Qt(this,OP).permissions.canAllowParticipantVideo)return Qt(this,DP,MP).muteAllVideo();throw BS.error("DyteParticipants::unauthorized_disable_all_video"),new qS("Unauthorized: User does not have permission to disable peer video.")}))}disableAudio(e){return tr(this,null,(function*(){this.joined.get(e).disableAudio()}))}disableVideo(e){return tr(this,null,(function*(){this.joined.get(e).disableVideo()}))}kick(e){return tr(this,null,(function*(){yield tE.emitAsync(XS.KICK_PEER,{peerId:e})}))}kickAll(){return tr(this,null,(function*(){if(BS.info("DyteParticipants::kick_all"),!this.roomJoined)throw new qS("Can`t kick all without joining room");if(!Qt(this,OP).permissions.kickParticipant)throw BS.error("DyteParticipants::unauthorized_kick_all"),new qS("Unauthorized: User does not have permission to kick peers.");Qt(this,DP,MP).kickAll(),Qt(this,NP).kickAll()}))}broadcastMessage(e,t,r){return tr(this,null,(function*(){if(BS.info("DyteParticipants::broadcastMessage"),!this.roomJoined)throw new qS("Can`t broadcast message without joining room");if(null==e||!e.trim())throw new qS("`type` must be a non-empty string.");if(Qt(this,DP,MP)instanceof fC&&"LIVESTREAM"!==Qt(this,OP).config.viewType&&"CHAT"!==Qt(this,OP).config.viewType)Qt(this,DP,MP).broadcastMessage(e,t);else if(r){let i=[];i="participantIds"in r?r.participantIds:this.joined.toArray().filter((e=>{var t;return null==(t=r.presetNames)?void 0:t.includes(e.presetName)})).map((e=>e.id)),Qt(this,NP).broadcastToPeers(e,i,t)}else Qt(this,NP).broadcastMessage(e,t)}))}acceptAllRequestToJoinStageRequests(e){return tr(this,null,(function*(){tE.emitAsync(XS.ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE,{data:e})}))}getAllJoinedPeers(e,t,r){return tr(this,null,(function*(){return(yield Qt(this,NP).getRoomPeers(e,t,r)).peers.map(ZP.formatSocketServiceMessage)}))}updatePermissions(e,t){return tr(this,null,(function*(){const r=this.joined.toArray().filter((t=>e.includes(t.id))).map((e=>e.userId)),i=[...new Set(r)];Qt(this,NP).updatePermissions(i,t)}))}getAllPeersInRoom(){return tr(this,null,(function*(){return Qt(this,NP).getRoomPeersNonPaginated()}))}},DP=new WeakSet,MP=function(){return _C()},OP=new WeakMap,NP=new WeakMap,xP);UP([VS.trace("DyteParticipants.setViewMode")],FP.prototype,"setViewMode",1),UP([VS.trace("DyteParticipants.setPage")],FP.prototype,"setPage",1),UP([VS.trace("DyteParticipants.disableAllAudio")],FP.prototype,"disableAllAudio",1),UP([VS.trace("DyteParticipants.disableAllVideo")],FP.prototype,"disableAllVideo",1),UP([VS.trace("DyteParticipants.disablePeerAudio")],FP.prototype,"disableAudio",1),UP([VS.trace("DyteParticipants.disablePeerVideo")],FP.prototype,"disableVideo",1),UP([VS.trace("DyteParticipants.kickPeer")],FP.prototype,"kick",1),UP([VS.trace("DyteParticipants.kickAll")],FP.prototype,"kickAll",1),UP([VS.trace("DyteParticipants.broadcastMessage")],FP.prototype,"broadcastMessage",1),UP([VS.trace("DyteParticipants.acceptAllRequestToJoinStageRequests")],FP.prototype,"acceptAllRequestToJoinStageRequests",1),UP([VS.trace("DyteParticipants.getAllJoinedPeers")],FP.prototype,"getAllJoinedPeers",1),UP([VS.trace("DyteParticipant.updatePermissions")],FP.prototype,"updatePermissions",1),UP([VS.trace("DyteParticipants.getAllPeersInRoom")],FP.prototype,"getAllPeersInRoom",1),FP=UP([KS((e=>{throw new qS(e.message,"1200")}))],FP);var VP,BP,WP,HP,GP,$P,qP,zP,JP,KP=Object.defineProperty,YP=Object.getOwnPropertyDescriptor,QP=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?YP(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&KP(t,r,s),s};const XP=(JP=class{constructor(e,t,r,i){Xt(this,qP),Kt(this,"participants"),Xt(this,VP,void 0),Xt(this,BP,void 0),Xt(this,WP,new Set),Xt(this,HP,new Map),Xt(this,GP,void 0),Xt(this,$P,void 0),Kt(this,"syncMembers",(()=>tr(this,null,(function*(){const e=yield Qt(this,$P).getAllAddedParticipants();this.participants.all.__clear(),e.forEach((e=>this.participants.all.__set(e.userId,e))),this.participants.all.emit("participantsUpdate")})))),Kt(this,"chatRoomJoinHandler",(e=>tr(this,null,(function*(){e.peer&&e.peer.userId!==Qt(this,VP).userId&&(yield this.syncMembers())})))),Kt(this,"updateSelfVideoConstraints",Yh((()=>tr(this,null,(function*(){var e,t,r,i,n,s,o;if(!Ci.hasFeature(DS.DYNAMIC_VIDEO_QUALITY))return;const a=this.participants.active.size;let c="vga";c=Qt(this,VP).isPinned||a<4?"hd":a<9?"vga":"pvga";try{if(Qt(this,VP).videoEnabled){const o={height:null==(e=SS[c])?void 0:e.height.ideal,width:null==(t=SS[c])?void 0:t.width.ideal},a=(null==(i=null==(r=Qt(this,VP).videoTrack)?void 0:r.getSettings())?void 0:i.width)!==o.width,d=(null==(s=null==(n=Qt(this,VP).videoTrack)?void 0:n.getSettings())?void 0:s.height)!==o.height;if(!a&&!d)return;yield Qt(this,VP).updateVideoConstraints({height:{ideal:o.height},width:{ideal:o.width}})}}catch(e){null!=(o=e.message)&&o.includes("Unsupported")||BS.error("Failure in setOptimalViewerBasedVideoConstraints::updateVideoConstraints",{error:e})}}))),1e3)),Zt(this,$P,t),this.participants=new FP(e,Qt(this,$P),i),Zt(this,BP,new Map),Zt(this,VP,e),Zt(this,GP,ww(e.config.viewType,r)?"socket-service":"room-node"),"socket-service"===Qt(this,GP)&&"CHAT"===e.config.viewType?this.setupChatEvents():this.setupEvents()}get roomJoined(){var e;return!0===(null==(e=Qt(this,qP,zP))?void 0:e.roomJoined)}updatePageParticipants(e){const t=new Set(e),r=new Map(this.participants.active);if(this.participants.active.forEach(((e,r)=>{this.participants.active.delete(r,!t.has(r))})),t.forEach((e=>{this.participants.joined.get(e)?this.participants.active.add(this.participants.joined.get(e),!r.get(e)):BS.warn("updatePageParticipants::participant_not_in_joined_list",{dyteParticipant:{id:e}})})),Qt(this,qP,zP)instanceof MR){Zt(this,WP,new Set(this.participants.active.keys())),Array.from(r.keys()).forEach((e=>{if(t.has(e))return;const r=this.participants.joined.get(e);if(!r)return;const i={producers:r.producers,peerId:r.id};Qt(this,qP,zP).deactivatePeers(i)}));const e=[];this.participants.active.forEach((t=>{const r={peerId:t.id,producers:t.producers};e.push(r)})),Qt(this,qP,zP).activatePeers(e)}this.updateSelfVideoConstraints()}updatePinnedParticipants(){this.participants.pinned.forEach((e=>{e.setIsPinned(!1),this.participants.pinned.delete(e.id)}))}refreshGridParticipants(e=!1){const t=new Map,r=Array.from(this.participants.joined.toArray().filter((e=>"ON_STAGE"===e.stageStatus)).map((e=>(t.set(e.id,!0),e.id)))),i=this.participants.selectedPeers.peers,n=this.participants.pinned.toArray().reduce(((e,t)=>("ON_STAGE"!==t.stageStatus?this.participants.pinned.delete(t.id):e.push(t.id),e)),[]);if("ACTIVE_GRID"!==this.participants.viewMode)return void BS.warn("ParticipantController::refreshGridParticipants::not_refreshing_grid_in_not_active_grid_mode");const s="ON_STAGE"===Qt(this,VP).stageStatus?1:0,o=this.participants.maxActiveParticipantsCount-s,a=new Set(i.concat(n).filter((e=>e!==Qt(this,VP).id&&t.has(e))));let c=Array.from(a);const d=o-a.size;if(d>=0){const e=r.filter((e=>!a.has(e)&&e!==Qt(this,VP).id)).slice(0,d);c=Array.from(a).concat(e)}else c=c.slice(0,o);this.updateActiveParticipantsHiveNode(c,e)}updateActiveParticipantsHiveNode(e,t=!1){if(!this.roomJoined)return void BS.warn("Skipped::ParticipantController::updateActiveParticipants",{roomJoined:this.roomJoined});const r=Array.from(this.participants.active.keys()),i=new Map(this.participants.active),n={};e.forEach((e=>{n[e]=!0}));const s=[];r.forEach(((e,t)=>{(!n[e]||!this.participants.joined.get(e))&&s.push(t)})),e.forEach((t=>{i.get(t)||(r.length<e.length?r.push(t):r[s.shift()]=t)})),r.forEach(((e,t)=>{n[e]||r.splice(t,1)})),Array.from(this.participants.active.keys()).forEach((e=>{this.participants.active.delete(e,!n[e])})),r.forEach((e=>{this.participants.joined.get(e)?this.participants.active.add(this.participants.joined.get(e),!i.get(e)):BS.warn("updateActiveParticipants::participant_not_in_joined_list",{dyteParticipant:{id:e}})})),this.participants.active.emit("participantsUpdate"),BS.info("ParticipantController::updateActiveParticipants::updating_current_selected_peers",{debuggingHint:t?"Forcefully updating currentActiveGridParticipants set":null}),t&&Zt(this,WP,new Set);const o=new Set(e),a=[],c=[];if(Qt(this,WP).forEach((e=>{o.has(e)||a.push(e)})),o.forEach((e=>{Qt(this,WP).has(e)||c.push(e)})),Zt(this,WP,o),0!==c.length||0!==a.length){if(Qt(this,qP,zP)instanceof MR){const e=[];a.forEach((t=>{const r=this.participants.joined.get(t);if(!r)return;const i={producers:r.producers,peerId:r.id};e.push(Qt(this,qP,zP).deactivatePeers(i))})),Promise.all(e).then((()=>{const e=[];c.forEach((r=>{const i=this.participants.active.get(r);if(!i)return void BS.warn("peer is not in active map which is going to activate, should not happen",{dyteParticipant:{id:r}});const n={peerId:i.id,producers:i.producers,force:t};e.push(n)})),Qt(this,qP,zP).activatePeers(e)})).catch((e=>{BS.info("Error on deactivating peers",e)}))}this.updateSelfVideoConstraints()}else BS.info("ParticipantController::updateActiveParticipants::current_selected_peers_is_same")}updateActiveParticipants(e){if(!this.roomJoined)return void BS.warn("Skipped::ParticipantController::updateActiveParticipants",{roomJoined:this.roomJoined});const t=Array.from(this.participants.active.keys()),r=new Map(this.participants.active),i={};e.forEach((e=>{i[e]=!0}));const n=[];t.forEach(((e,t)=>{(!i[e]||!this.participants.joined.get(e))&&n.push(t)})),e.forEach((i=>{r.get(i)||(t.length<e.length?t.push(i):t[n.shift()]=i)})),t.forEach(((e,r)=>{i[e]||t.splice(r,1)})),Array.from(this.participants.active.keys()).forEach((e=>{this.participants.active.delete(e,!i[e])})),t.forEach((e=>{this.participants.joined.get(e)?this.participants.active.add(this.participants.joined.get(e),!r.get(e)):BS.warn("updateActiveParticipants::participant_not_in_joined_list",{dyteParticipant:{id:e}})})),this.participants.active.emit("participantsUpdate"),this.updateSelfVideoConstraints()}updateActiveParticipantsWithPriorities(e,t=!1){if(!this.roomJoined)return void BS.warn("Skipped::ParticipantController::updateActiveParticipantsWithPriorities",{roomJoined:this.roomJoined});let r=null;e.forEach((e=>{this.participants.selectedPeers.add(e.peerId,e.priority),(null===r||e.priority>r.priority)&&(r=e)})),r&&r.peerId!==this.participants.lastActiveSpeaker&&(this.participants.lastActiveSpeaker=r.peerId,this.participants.emit("activeSpeaker",{peerId:r.peerId,volume:r.priority})),t&&this.refreshGridParticipants()}setupChatEvents(){tE.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,this.syncMembers),Qt(this,$P).on(Jw.joinRoom,this.chatRoomJoinHandler)}waitingRoomRequestHandler(e){if(Qt(this,qP,zP)instanceof fC)return;const t=e.requests.filter((e=>!this.participants.waitlisted.toArray().find((t=>t.userId===e.userId)))),r=this.participants.waitlisted.toArray().filter((t=>!e.requests.find((e=>e.userId===t.userId))));t.forEach((e=>this.participants.waitlisted.add(new iP({id:e.peerId,displayName:e.displayName,audioMuted:!0,videoEnabled:!1,audioTrack:void 0,videoTrack:void 0,stageStatus:OI.OFF_STAGE,userId:e.userId,flags:{},isHost:!1},Qt(this,VP),Qt(this,$P))))),r.forEach((e=>this.participants.waitlisted.delete(e.id)))}setupEvents(){tE.on(XS.PEER_JOINED,(e=>tr(this,null,(function*(){var t,r,i;let n;if(Qt(this,qP,zP)instanceof MR){if(n=XP.formatSocketServiceMessage(Qt(this,HP).get(e.id)),!n){const{peer:t}=yield Qt(this,$P).getPeerInfo(e.id);n=XP.formatSocketServiceMessage(t)}n.stageStatus||BS.warn("peerJoined::stageStatus is undefined.")}else e.stageStatus||BS.warn("peerJoined::stageStatus is undefined.");const s=new iP(qt(qt({},e),n),Qt(this,VP),Qt(this,$P));if(!(Qt(this,VP).id===s.id||null!=(t=e.flags)&&t.recorder||null!=(r=s.flags)&&r.hidden_participant||null!=(i=s.flags)&&i.hiddenParticipant)){if(this.participants.active.delete(s.id),this.participants.joined.add(s),this.participants.waitlisted.delete(s.id),s.stageStatus===OI.REQUESTED_TO_JOIN_STAGE&&tE.emit(XS.STAGE_REQUESTS_UPDATED,{request:{displayName:s.name,userId:s.userId,peerId:s.id},add:!0}),Qt(this,VP).config.viewType===gi.Webinar&&s.stageStatus!==OI.ON_STAGE)return;this.participants.currentPage===this.participants.pageCount&&Qt(this,qP,zP)instanceof fC&&tE.emit(XS.GET_PAGE,(yield Qt(this,qP,zP).getPage(this.participants.currentPage)).payload),"ACTIVE_GRID"===this.participants.viewMode&&tE.emit(XS.REFRESH_GRID)}"ACTIVE_GRID"===this.participants.viewMode&&"HIVE"===Qt(this,VP).permissions.mediaRoomType&&tE.emit(XS.REFRESH_GRID),this.updateSelfVideoConstraints()})))),Qt(this,$P).on(Jw.getWaitingRoomRequests,this.waitingRoomRequestHandler.bind(this)),tE.on(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>{Qt(this,qP,zP)instanceof fC||Qt(this,VP).permissions.acceptWaitingRequests&&Qt(this,$P).getWaitingRoomRequests()})),Qt(this,$P).on(Jw.joinRoom,(({peer:e})=>{Qt(this,HP).set(e.peerId,e)})),tE.onAsync(XS.SOCKET_PEERS,(e=>tr(this,null,(function*(){null==e||e.forEach((e=>Qt(this,HP).set(e.peerId,e)))})))),tE.on(XS.WAITLIST_PEER_ADDED,(({id:e,name:t,picture:r,metadata:i,clientSpecificId:n})=>{this.participants.waitlisted.add(new iP({id:e,displayName:t,audioMuted:!0,videoEnabled:!1,audioTrack:void 0,videoTrack:void 0,stageStatus:OI.OFF_STAGE,userId:void 0,flags:{},isHost:!1,picture:r,metadata:i,customParticipantId:n},Qt(this,VP),Qt(this,$P)))})),tE.on(XS.WAITLIST_PEER_REMOVED,(({id:e})=>{this.participants.waitlisted.delete(e)})),Qt(this,VP).on("videoUpdate",(()=>this.updateSelfVideoConstraints())),tE.on(XS.ROOM_JOINED,(e=>tr(this,[e],(function*({peers:e,pinnedPeerId:t,requestToJoinPeersList:r}){Qt(this,qP,zP)instanceof MR&&(this.participants.active.clear(),this.participants.joined.clear()),e.forEach((e=>tr(this,null,(function*(){var r,i,n;if(null!=(r=e.flags)&&r.recorder||null!=(i=e.flags)&&i.hidden_participant||null!=(n=e.flags)&&n.hiddenParticipant)return;let s;if(Qt(this,qP,zP)instanceof MR){if(s=XP.formatSocketServiceMessage(Qt(this,HP).get(e.id)),!s){const{peer:t}=yield Qt(this,$P).getPeerInfo(e.id);s=XP.formatSocketServiceMessage(t),s.stageStatus||BS.warn("peerJoined::stageStatus is undefined.")}}else e.stageStatus||BS.warn("peerJoined::stageStatus is undefined.");const o=new iP(qt(qt({},e),s),Qt(this,VP),Qt(this,$P));o.id===t&&(o.setIsPinned(!0,!1),this.participants.pinned.add(o)),this.participants.joined.add(o)})))),r&&r.forEach((({id:e})=>{tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.REQUESTED_TO_JOIN_STAGE})})),Qt(this,qP,zP)instanceof fC&&Qt(this,qP,zP).getPage(this.participants.currentPage)})))),tE.on(XS.PEER_CLOSED,(e=>tr(this,[e],(function*({id:e}){const t=this.participants.joined.get(e);if(t&&"REQUESTED_TO_JOIN_STAGE"===t.stageStatus&&tE.emit(XS.STAGE_REQUESTS_UPDATED,{request:{displayName:t.name,userId:t.userId,peerId:t.id},add:!1}),this.participants.joined.delete(e,!0,!0),this.participants.pinned.delete(e,!0,!0),this.participants.waitlisted.delete(e,!0,!0),Qt(this,qP,zP)instanceof MR&&(this.participants.selectedPeers.delete(e),this.participants.active.get(e)&&0===this.participants.currentPage))return void this.refreshGridParticipants();const{currentPage:r}=this.participants,i=Qt(this,VP).config.maxVideoStreams,n=(_S.isMobile()?i.mobile:i.desktop)*(r-1),s=this.participants.active.get(e);if(0===n)this.participants.setViewMode("ACTIVE_GRID");else if(this.participants.joined.size<=n)2===r?this.participants.setViewMode("ACTIVE_GRID"):this.participants.setPage(r-1);else if(s){let e=[];Qt(this,qP,zP)instanceof fC?({peerIds:e}=(yield Qt(this,qP,zP).getPage(r)).payload):e=this.participants.getPeerIdsForCurrentPage(),tE.emit(XS.GET_PAGE,{peerIds:e})}this.updateSelfVideoConstraints()})))),tE.on(XS.ROOM_NODE_DISCONNECTED,(()=>{Array.from(this.participants.joined.keys()).forEach((e=>{this.participants.joined.delete(e)})),Array.from(this.participants.active.keys()).forEach((e=>{this.participants.active.delete(e)})),Array.from(this.participants.pinned.keys()).forEach((e=>{this.participants.pinned.delete(e)})),this.participants.currentPage=0,this.participants.viewMode="ACTIVE_GRID",this.participants.emit("viewModeChanged",{viewMode:"ACTIVE_GRID",currentPage:this.participants.currentPage,pageCount:this.participants.pageCount}),Zt(this,WP,new Set)})),tE.on(XS.PEER_MUTED,(({peerId:e})=>{const t=this.participants.joined.get(e);t&&t.setAudioEnabled(!1)})),tE.on(XS.PEER_UNMUTED,(({peerId:e})=>{const t=this.participants.joined.get(e);t&&t.setAudioEnabled(!0)})),tE.on(XS.CONSUMER_PAUSED,(({id:e})=>{this.processConsumerPaused(e)})),tE.on(XS.CONSUMER_RESUMED,(({id:e})=>{this.processConsumerResumed(e)})),tE.on(XS.NEW_CONSUMER,(({id:e})=>{this.processNewConsumer(e)})),tE.on(XS.CONSUMER_CLOSED,(({id:e})=>{this.processConsumerClosed(e)})),tE.on(XS.GET_PAGE,(({peerIds:e})=>{"PAGINATED"===this.participants.viewMode&&this.updatePageParticipants(e)})),tE.on(XS.SELECTED_PEERS,(({peerIds:e,compulsoryPeers:t})=>{if("ACTIVE_GRID"!==this.participants.viewMode)return;if(Qt(this,qP,zP)instanceof fC)return void this.updateActiveParticipants(e);const r=e.map(((e,t)=>({peerId:e,priority:t+1}))),i=null==t?void 0:t.map(((e,t)=>({peerId:e,priority:-(t+1)})));r.push(...null!=i?i:[]),r.length>0&&this.updateActiveParticipantsWithPriorities(r)})),tE.on(XS.SELECTED_PEERS_DIFF,(({entries:e})=>{"ACTIVE_GRID"===this.participants.viewMode&&this.updateActiveParticipantsWithPriorities(e,!0)})),tE.on(XS.REFRESH_GRID,((e=!1)=>{"ACTIVE_GRID"===this.participants.viewMode&&Yh((()=>{this.refreshGridParticipants(e)}),500,{maxWait:1e3,leading:!0})()})),tE.on(XS.NEW_PRODUCER,(({peerId:e,producer:t})=>{const r=this.participants.joined.get(e);r?(r.producers.push(t),BS.info("ParticipantController::NEW_PRODUCER::producer_added_to_participant",{producer:{id:null==t?void 0:t.producerId,peerId:e,kind:null==t?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:null==t?void 0:t.screenShare}}}),"audio"===(null==t?void 0:t.kind)||null!=t&&t.screenShare||Qt(this,WP).has(e)?Qt(this,qP,zP).createConsumer({producingPeerId:e,producerId:t.producerId,screenShare:t.screenShare}):BS.info("ParticipantController::NEW_PRODUCER::not_consuming_producer",{producer:{id:null==t?void 0:t.producerId,peerId:e,kind:null==t?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:null==t?void 0:t.screenShare}}})):BS.warn("ParticipantController::NEW_PRODUCER::participant not found",{producer:{id:null==t?void 0:t.producerId,kind:null==t?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:null==t?void 0:t.screenShare}},dyteParticipant:{id:e}})})),tE.on(XS.PRODUCER_CLOSED,(({peerId:e,producerId:t})=>{const r=this.participants.joined.get(e);r?r.producers=r.producers.filter((e=>e.producerId!==t)):BS.warn("ParticipantController::NEW_PRODUCER::participant not found",{dyteParticipant:{id:e}})})),tE.on(XS.PRODUCER_TOGGLE,(({peerId:e,producerId:t,paused:r,kind:i})=>{const n=this.participants.joined.get(e);if(n){"audio"===i&&n.setAudioEnabled(!r);const e=n.producers.find((e=>e.producerId===t));e&&(e.pause=r)}})),tE.on(XS.ACTIVE_SPEAKER,(({peerId:e,volume:t})=>{this.participants.lastActiveSpeaker=e,this.participants.emit("activeSpeaker",{peerId:e,volume:t})})),tE.on(XS.ROOM_MESSAGE,(e=>tr(this,[e],(function*({payload:e,type:t,timestamp:r}){this.participants.emit("broadcastedMessage",{type:t,payload:e,timestamp:r})})))),tE.on(XS.MESSAGE,(e=>tr(this,[e],(function*({payload:e,type:t,timestamp:r}){"spotlight"!==t&&this.participants.emit("broadcastedMessage",{type:t,payload:e,timestamp:r})})))),tE.on(XS.LOW_CONSUMER_SCORE,(({peerId:e,score:t,kind:r})=>{const i=this.participants.joined.get(e);i&&(i.emit("poorConnection",{score:t,kind:r}),this.participants.emit("poorConnection",{participantId:e,score:t,kind:r}))})),tE.on(XS.CONSUMER_SCORE_UPDATE,(({score:e,kind:t,appData:r,peerId:i})=>{var n;const s="video"===t&&null!=(n=null==r?void 0:r.screenShare)&&n,o=this.participants.joined.get(i);o&&(o.emit("mediaScoreUpdate",{kind:t,isScreenshare:s,score:e,participantId:i}),this.participants.emit("mediaScoreUpdate",{kind:t,isScreenshare:s,score:e,participantId:i}))})),tE.on(XS.PEER_PINNED,(({peerId:e})=>{if(!e)return Qt(this,VP).isPinned&&Qt(this,VP).setIsPinned(!1),0!==this.participants.pinned.size&&this.updatePinnedParticipants(),void this.updateSelfVideoConstraints();if(e===Qt(this,VP).id)return 0!==this.participants.pinned.size&&this.updatePinnedParticipants(),Qt(this,VP).setIsPinned(!0),void this.updateSelfVideoConstraints();const t=this.participants.joined.get(e);Qt(this,VP).isPinned&&Qt(this,VP).setIsPinned(!1),this.updatePinnedParticipants(),t.setIsPinned(!0),this.participants.pinned.add(t),Qt(this,qP,zP)instanceof MR&&Qt(this,qP,zP).activatePeers([{peerId:t.id,producers:t.producers}]).catch((e=>{BS.error("unable to create consumers",{error:e})})),this.updateSelfVideoConstraints()})),tE.onAsync(XS.KICK_PEER,(e=>tr(this,[e],(function*({peerId:e}){const t=this.participants.joined.get(e);yield Qt(this,qP,zP).kick(e),yield Qt(this,$P).kick(e),t?t.emit("kicked"):this.participants.joined.emit("kicked",{id:e})}))))}processMedia(e){var t;const r=Qt(this,qP,zP).getConsumers(),{peerId:i,kind:n,appData:s,remotelyPaused:o,track:a,producerId:c}=null!=(t=r.get(e))?t:{};if(!i)return BS.warn("processMedia::Peer ID is undefined",{consumer:{id:e,kind:n,peerId:i,appData:{supportsRemoteControl:null==s?void 0:s.supportsRemoteControl,screenShare:null==s?void 0:s.screenShare},remotelyPaused:o,producerId:c}}),{};const d=s;return BS.info("ParticipantController::processMedia",{consumer:{id:e,peerId:i,kind:n,appData:d,remotelyPaused:o,producerId:c}}),Qt(this,BP).set(e,{type:n,peerId:i,appData:d,remotelyPaused:o,producerId:c}),{peerId:i,kind:n,appData:d,remotelyPaused:o,track:a,producerId:c}}processConsumerClosed(e){const{peerId:t,type:r,appData:i,remotelyPaused:n,producerId:s}=Qt(this,BP).get(e)||{},o=this.participants.joined.get(t);if(BS.info("ParticipantController::processConsumerClosed",{consumer:{id:e,peerId:t,appData:i,kind:r,remotelyPaused:n,producerId:s}}),Qt(this,BP).delete(e),o){if(i&&i.screenShare)return o.setScreenShareEnabled(!1),fi.consumerSharedMediaState(e,{screen:!1}),void(o.screenShareTracks={audio:void 0,video:void 0});"audio"===r?(o.setAudioEnabled(!1),fi.consumerSharedMediaState(e,{audio:!1}),o.audioTrack=void 0):"video"===r&&(o.setVideoEnabled(!1),fi.consumerSharedMediaState(e,{video:!1}),o.videoTrack=void 0)}}processConsumerResumed(e){const{peerId:t,kind:r,appData:i,track:n,remotelyPaused:s,producerId:o}=this.processMedia(e);if(!t)return;BS.info("ParticipantController::processConsumerResumed",{consumer:{id:e,peerId:t,kind:r,appData:i,remotelyPaused:s,producerId:o}});const a=this.participants.joined.get(t);if(a){if(i.screenShare)return"video"===r?a.screenShareTracks.video=n:"audio"===r&&(a.screenShareTracks.audio=n),a.setScreenShareEnabled(!0),void fi.consumerSharedMediaState(e,{screen:!0});"video"===r?(a.videoTrack=n,a.setVideoEnabled(!0),fi.consumerSharedMediaState(e,{video:!0})):"audio"===r&&(a.audioTrack=n,a.setAudioEnabled(a.audioEnabled),fi.consumerSharedMediaState(e,{audio:a.audioEnabled}))}}processConsumerPaused(e){BS.info(`ParticipantController::processConsumerPaused called for consumerId: ${e}`);const{peerId:t,kind:r,track:i,appData:n,remotelyPaused:s,producerId:o}=this.processMedia(e);if(!t)return;BS.info("ParticipantController::processConsumerPaused",{consumer:{id:e,peerId:t,kind:r,appData:n,remotelyPaused:s,producerId:o}});const a=this.participants.joined.get(t);a&&("video"===r?(a.videoTrack=i,a.setVideoEnabled(!1),fi.consumerSharedMediaState(e,{video:!1})):"audio"===r&&(a.audioTrack=i,a.setAudioEnabled(a.audioEnabled),fi.consumerSharedMediaState(e,{audio:a.audioEnabled})))}processNewConsumer(e){const{peerId:t,kind:r,remotelyPaused:i,track:n,appData:s,producerId:o}=this.processMedia(e);if(!t)return;BS.info("ParticipantController::processNewConsumer",{consumer:{id:e,peerId:t,kind:r,remotelyPaused:i,appData:s,producerId:o}});const a=this.participants.joined.get(t);if(a){if(s.screenShare)return"video"===r?a.screenShareTracks.video=n:"audio"===r&&(a.screenShareTracks.audio=n),(!i||Qt(this,VP).permissions.isRecorder||Ci.hasFeature(DS.SCREEENSHARE_ERR_HACK))&&a.setScreenShareEnabled(!0),s.supportsRemoteControl&&(a.supportsRemoteControl=!0),this.participants.broadcastMessage("screenshareConsumerCreated",{producerId:o,peerId:t,screenShare:!0,consumerId:e,consumerPeerId:Qt(this,VP).id}),void BS.info("ParticipantController::newScreenshareConsumer::screenshareConsumerCreated",{consumer:{id:e,peerId:t,kind:r,remotelyPaused:i,appData:s,producerId:o}});"video"===r?(a.videoTrack=n,i||a.setVideoEnabled(!0),fi.consumerSharedMediaState(e,{video:!i})):"audio"===r&&Qt(this,qP,zP)instanceof MR&&(a.audioTrack=n,i||a.setAudioEnabled(!0),fi.consumerSharedMediaState(e,{audio:!i}))}}static getStageStatusFromStageType(e){switch(e){case qT.UNSPECIFIED:return"OFF_STAGE";case qT.REQUESTED_STAGE:return"REQUESTED_TO_JOIN_STAGE";case qT.APPROVED_STAGE:return"ACCEPTED_TO_JOIN_STAGE";case qT.OFF_STAGE:return"OFF_STAGE";case qT.ON_STAGE:return"ON_STAGE";default:return"OFF_STAGE"}}static formatSocketServiceMessage(e){var t,r,i,n;if(!e)return;const s=XP.getStageStatusFromStageType(e.stageType);return{id:e.peerId,userId:e.userId,name:e.displayName,stageType:s,customParticipantId:e.customParticipantId,presetId:e.presetId,picture:e.displayPictureUrl,waitlisted:e.waitlisted,stageStatus:s,metadata:{preset_name:null==(t=e.flags)?void 0:t.presetName},recorderType:null==(r=e.flags)?void 0:r.recorderType,flags:{hiddenParticipant:null==(i=e.flags)?void 0:i.hiddenParticipant,recorder:!(null==(n=e.flags)||!n.recorderType)}}}},VP=new WeakMap,BP=new WeakMap,WP=new WeakMap,HP=new WeakMap,GP=new WeakMap,$P=new WeakMap,qP=new WeakSet,zP=function(){return _C()},JP);let ZP=XP;QP([VS.trace("ParticipantController.updatePageParticipants")],ZP.prototype,"updatePageParticipants",1),QP([VS.trace("ParticipantController.setupChatEvents")],ZP.prototype,"setupChatEvents",1),QP([VS.trace("ParticipantController.setupEvents")],ZP.prototype,"setupEvents",1),QP([VS.trace("ParticipantController.processMedia")],ZP.prototype,"processMedia",1),QP([VS.trace("ParticipantController.processConsumerClosed")],ZP.prototype,"processConsumerClosed",1),QP([VS.trace("ParticipantController.processConsumerResumed")],ZP.prototype,"processConsumerResumed",1),QP([VS.trace("ParticipantController.processConsumerPaused")],ZP.prototype,"processConsumerPaused",1),QP([VS.trace("ParticipantController.processNewConsumer")],ZP.prototype,"processNewConsumer",1);Object.defineProperty,Object.getOwnPropertyDescriptor;var eD,tD,rD,iD,nD,sD=(e=>(e[e.User=0]="User",e[e.Meeting=1]="Meeting",e))(sD||{});let oD=(nD=class extends HS{constructor(e,t,r,i){super(),Xt(this,eD),Kt(this,"selfActiveTab"),Kt(this,"broadcastTabChanges"),Xt(this,rD,void 0),Xt(this,iD,void 0),Kt(this,"viewType"),Kt(this,"meetingStartedTimestamp"),Kt(this,"meetingTitle"),Zt(this,rD,e),this.viewType=t,Zt(this,iD,r),this.meetingTitle=i,this.broadcastTabChanges=e.permissions.canSpotlight}get joined(){var e;return null==(e=Qt(this,eD,tD))?void 0:e.roomJoined}get roomName(){return this.meetingId}get meetingId(){var e;return null==(e=Qt(this,eD,tD))?void 0:e.roomName}get mediaConnected(){var e,t;return Qt(this,eD,tD)instanceof fC?null!=(t=null==(e=Qt(this,eD,tD))?void 0:e.mediaConnected)&&t:Qt(this,iD).socket.isConnected}get socketConnected(){return Qt(this,iD).socket.isConnected}setBroadcastTabChanges(e){if(!Qt(this,rD).permissions.canSpotlight)throw BS.error("DyteSpotlight::setSpotlighted::permission_denied"),new qS("User does not have permission to toggle spotlight");this.broadcastTabChanges=e,this.emit("broadcastTabChangesUpdate",this.broadcastTabChanges),this.broadcastTabChanges&&this.assertActiveTabToRoom()}setSelfActiveTab(e,t){var r;BS.info("DyteSpotlight::setActiveTab",{spotlight:{currentTab:{id:e.id,type:e.type}}}),this.selfActiveTab=e,0===t&&this.emit("selfTabUpdate",e),null!=(r=Qt(this,rD).permissions)&&r.canSpotlight&&this.broadcastTabChanges&&0===t&&this.assertActiveTabToRoom()}assertActiveTabToRoom(){Qt(this,eD,tD)instanceof fC&&this.selfActiveTab?Qt(this,eD,tD).assertSpotlightToRoom({userId:Qt(this,rD).userId,currentTab:this.selfActiveTab,peerId:void 0}):Qt(this,iD).broadcastMessage("spotlight",{userId:Qt(this,rD).userId,currentTab:this.selfActiveTab})}},eD=new WeakSet,tD=function(){return _C()},rD=new WeakMap,iD=new WeakMap,nD);oD=((e,t,r,i)=>{for(var n,s=t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(s)||s);return s})([KS((e=>{throw new qS(e.message,"0800")}))],oD);var aD=Object.defineProperty,cD=Object.getOwnPropertyDescriptor,dD=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?cD(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&aD(t,r,s),s};let lD=class extends HS{constructor(){super(),Kt(this,"transcripts"),this.transcripts=[]}static init(e){return tr(this,null,(function*(){const t=new lD;try{e&&(yield t.getActiveTranscript())}catch(e){BS.error("Error fetching active transcriptions ",e)}return t}))}static parseTranscript(e){try{if(!e)return;const[[t,r,i,n,s,o]]=function(e){let t="",r=[""];const i=[r];let n,s=0,o=0,a=!0;for(n of e)'"'===n?(a&&n===t&&(r[s]+=n),a=!a):","===n&&a?n=r[++s]="":"\n"===n&&a?("\r"===t&&(r[s]=r[s].slice(0,-1)),r=i[++o]=[n=""],s=0):r[s]+=n,t=n;return i}(e);return{id:u(),name:s,peerId:r,userId:i,customParticipantId:n,transcript:o,isPartialTranscript:!1,date:new Date(1e3*parseInt(t,10))}}catch(t){return void BS.error(`Failed to parse transcript: ${e}`,t)}}static parseTranscripts(e){return e?e.split("\n").map(lD.parseTranscript).filter(Boolean):[]}getActiveTranscript(){return tr(this,null,(function*(){try{const e=qw(),{transcript:t}=yield e.getActiveTranscript();this.transcripts=lD.parseTranscripts(t)}catch(e){}}))}onTranscript(e){return tr(this,null,(function*(){this.transcripts.push(e),this.emit("transcript",e)}))}};dD([VS.trace("DyteAi.getActiveTranscript")],lD.prototype,"getActiveTranscript",1),dD([VS.trace("DyteAi.onTranscript")],lD.prototype,"onTranscript",1),lD=dD([KS((e=>{throw new qS(e.message,"0000")}))],lD);var uD,pD,hD,mD,fD,gD=Object.defineProperty,vD=Object.getOwnPropertyDescriptor;const yD=(fD=class{constructor(e,t,r,i,n){Xt(this,hD),Kt(this,"meta"),Kt(this,"ai"),Xt(this,uD,void 0),Xt(this,pD,void 0),Kt(this,"aiSocketHandler"),this.meta=new oD(e,Sw.isV2AuthToken?e.config.viewType:e.permissions.viewType,t,n),this.ai=r,Zt(this,uD,e),Zt(this,pD,t),this.aiSocketHandler=i,e.config.viewType!==gi.Chat&&this.setupEvents()}static init(e,t,r,i){return tr(this,null,(function*(){const n=yield lD.init(e.permissions.transcriptionEnabled);return new yD(e,t,n,r,i)}))}get roomName(){return this.meta.roomName}conditionallySetActiveTab(e){var t;null!=e&&e.currentTab&&(null==(t=this.meta.selfActiveTab)?void 0:t.id)!==e.currentTab.id&&(this.meta.setSelfActiveTab(e.currentTab,sD.Meeting),this.meta.emit("activeTabUpdate",e.currentTab))}setupEvents(){tE.on(XS.ROOM_JOINED,(e=>{e.startedAt&&(this.meta.meetingStartedTimestamp=new Date(e.startedAt),this.meta.emit("meetingStartTimeUpdate",{meetingStartedTimestamp:this.meta.meetingStartedTimestamp}))})),tE.on(XS.ROOM_STATE,(({createdAt:e})=>{const t=this.meta.meetingStartedTimestamp;if(e&&!t){const t=new Date(1e3*e);this.meta.meetingStartedTimestamp=t,this.meta.emit("meetingStartTimeUpdate",{meetingStartedTimestamp:this.meta.meetingStartedTimestamp})}})),tE.on(XS.ROOM_NODE_CONNECTED,(()=>{this.meta.emit("connected")})),tE.on(XS.ROOM_NODE_DISCONNECTED,(()=>{this.meta.emit("disconnected")})),tE.on(XS.ICE_CONNECTED,(({transport:e})=>{this.meta.emit("iceConnected",{transport:e})})),tE.on(XS.ICE_DISCONNECTED,(({transport:e})=>{this.meta.emit("iceDisconnected",{transport:e})})),tE.on(XS.ICE_RECONNECTING,(({transport:e})=>{this.meta.emit("iceReconnecting",{transport:e})})),tE.on(XS.ICE_FAILED,(({transport:e})=>{this.meta.emit("iceFailed",{transport:e})})),tE.on(XS.PRODUCER_SCORE_UPDATE,(({score:e})=>{e<5&&this.meta.emit("poorConnection",{score:e})})),tE.on(XS.SOCKET_SERVICE_CONNECTED,(()=>{this.meta.emit("socketConnected")})),tE.on(XS.SOCKET_SERVICE_DISCONNECTED,(()=>{this.meta.emit("socketDisconnected")})),tE.on(XS.SOCKET_SERVICE_RECONNECTING,(()=>{this.meta.emit("socketReconnecting")})),tE.on(XS.SOCKET_SERVICE_RECONNECTION_ATTEMPT,(({attempt:e})=>{this.meta.emit("socketReconnectAttempt",{attempt:e})})),tE.on(XS.SOCKET_SERVICE_RECONNECT_FAILURE,(({attempt:e})=>{this.meta.emit("socketReconnectFailure",{attempt:e})})),tE.on(XS.SOCKET_SERVICE_RECONNECTED,(()=>{this.meta.emit("socketReconnected")})),tE.on(XS.SOCKET_SERVICE_FAILED,(()=>{this.meta.emit("socketFailure")})),tE.on(XS.ROOM_NODE_CONNECTION_ERROR,(e=>{const{message:t}=e;t.match(/room '([a-z0-9-]+)' not found/i)&&this.meta.emit("connectionError",{reason:"ROOM_NOT_FOUND"})})),Qt(this,uD).permissions.canSpotlight&&(BS.info("DyteMetaController::Asserting Spotlight"),this.meta.selfActiveTab&&(Qt(this,hD,mD)instanceof fC?Qt(this,hD,mD).assertSpotlightToRoom({userId:Qt(this,uD).userId,currentTab:this.meta.selfActiveTab,peerId:void 0}):Qt(this,pD).broadcastMessage("spotlight",{userId:Qt(this,uD).userId,currentTab:this.meta.selfActiveTab}))),tE.on(XS.PEER_JOINED,(e=>tr(this,null,(function*(){Qt(this,uD).permissions.canSpotlight&&this.meta.selfActiveTab&&(Qt(this,hD,mD)instanceof fC?Qt(this,hD,mD).assertSpotlightToPeer({userId:Qt(this,uD).userId,currentTab:this.meta.selfActiveTab,peerId:e.id}):Qt(this,pD).broadcastToPeers("spotlight",[e.id],{userId:Qt(this,uD).userId,currentTab:this.meta.selfActiveTab}))})))),tE.on(XS.ROOM_MESSAGE,(e=>{var t,r;let i;if("type"in e){if("spotlight"!==e.type)return;i=qt(qt({},e),e.payload)}else{if(!("roomMessageType"in e))return;if("spotlight"!==e.roomMessageType)return;i=e}BS.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:i.userId},currentTab:{id:null==(t=i.currentTab)?void 0:t.id,type:null==(r=i.currentTab)?void 0:r.type}}}),this.conditionallySetActiveTab(i)})),tE.on(XS.MESSAGE,(e=>{var t,r;let i;if("type"in e){if("spotlight"!==e.type)return;i=qt(qt({},e),e.payload)}else{if(!("roomMessageType"in e))return;if("spotlight"!==e.roomMessageType)return;i=e}BS.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:i.userId},currentTab:{id:null==(t=i.currentTab)?void 0:t.id,type:null==(r=i.currentTab)?void 0:r.type}}}),this.conditionallySetActiveTab(i)})),this.aiSocketHandler.on(Jw.transcript,(e=>{const{meetingId:t,transcript:r}=e,i=lD.parseTranscript(r);if(!i)return void BS.warn("Received empty transcript data");this.ai.onTranscript(i),this.meta.emit("transcript",i);const{peerId:n,name:s,transcript:o}=i;BS.debug(`${t} Received transcript for peer ${n} - ${s}: ${o}`)}))}},uD=new WeakMap,pD=new WeakMap,hD=new WeakSet,mD=function(){return _C()},fD);let _D=yD;((e,t,r,i)=>{for(var n,s=vD(t,r),o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(t,r,s)||s);s&&gD(t,r,s)})([VS.trace("MetaController.setupEvents")],_D.prototype,"setupEvents");var SD=Object.defineProperty,ED=Object.getOwnPropertyDescriptor,TD=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?ED(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&SD(t,r,s),s};const bD=16;var wD,kD,RD,CD,AD,ID,PD,DD,MD,OD;let ND=(OD=class extends HS{constructor({baseURL:e,createdAt:t,description:r,id:i,name:n,organizationId:s,picture:o,private:a,published:c,staggered:d,tags:l,type:u,updatedAt:p},h,m,f,g,v){super(),Xt(this,DD),Xt(this,wD,void 0),Xt(this,kD,void 0),Kt(this,"baseURL"),Kt(this,"createdAt"),Kt(this,"description"),Kt(this,"id"),Kt(this,"name"),Xt(this,RD,void 0),Xt(this,CD,void 0),Xt(this,AD,void 0),Kt(this,"organizationId"),Kt(this,"picture"),Kt(this,"private"),Kt(this,"published"),Kt(this,"staggered"),Kt(this,"tags"),Kt(this,"type"),Kt(this,"updatedAt"),Xt(this,ID,void 0),Kt(this,"config"),Xt(this,PD,void 0),Kt(this,"active"),Kt(this,"iframes"),Kt(this,"enabledBy"),this.baseURL=e,this.createdAt=new Date(t),this.description=r,this.id=i,this.name=n,Zt(this,RD,f),this.organizationId=s,this.picture=o,this.private=a,this.published=c,this.staggered=d,this.tags=l,this.type=u,this.updatedAt=new Date(p),this.active=!1,this.iframes=new Map,Zt(this,wD,h),Zt(this,kD,m),Zt(this,CD,g),Zt(this,AD,v),this.enabledBy=""}get roomJoined(){var e;return!0===(null==(e=Qt(this,DD,MD))?void 0:e.roomJoined)}sendIframeEvent(e){this.iframes.size&&this.iframes.forEach((t=>{const{iframe:r}=t;r&&(navigator.isReactNative?r.postMessage(JSON.stringify(e)):r.contentWindow.postMessage(e,"*"))}))}handleIframeMessage(e){return tr(this,null,(function*(){var t,r,i,n;let s;if("socket-service"===Qt(this,kD)){const r=e,{payload:i,uuid:n,type:s}=r;switch(s){case Yw.customPluginEventToRoom:Qt(this,wD).customPluginEventToRoom(this.id,i,n);break;case Yw.customPluginEventToPeers:Qt(this,wD).customPluginEventToPeers(this.id,i.peerIds,i,n);break;case Yw.enablePluginForRoom:Qt(this,wD).enablePluginForRoom(this.id,n);break;case Yw.enablePluginForPeers:Qt(this,wD).enablePluginForPeers(this.id,i.peerIds,n);break;case Yw.disablePluginForRoom:Qt(this,wD).disablePluginForRoom(this.id,n);break;case Yw.disablePluginForPeers:Qt(this,wD).disablePluginForPeers(this.id,i.peerIds,n);break;case Yw.storeInsertKeys:Qt(this,wD).storeInsertKeys(this.id,i.store,i.insertKeys,n);break;case Yw.storeGetKeys:Qt(this,wD).storeGetKeys(this.id,i.store,i.getKeys,n);break;case Yw.storeDeleteKeys:Qt(this,wD).storeDeleteKeys(this.id,i.store,i.deleteKeys,n);break;case Yw.storeDelete:Qt(this,wD).storeDelete(this.id,i.store,n);break;case bD:{const{messagePayload:e,peerIds:t}=i;if(!Qt(this,AD))return void this.sendIframeEvent({type:bD,uuid:r.uuid,payload:{error:"Chat is disabled for this room."}});try{yield Qt(this,AD).sendMessage(e,t),this.sendIframeEvent({type:bD,uuid:r.uuid,payload:{success:!0}})}catch(e){this.sendIframeEvent({type:bD,uuid:r.uuid,payload:{error:e}})}break}case 14:{let e;const{peerId:n}=i,s=zt(qt({},Qt(this,RD)),{isRecorder:null==(t=Qt(this,RD).permissions)?void 0:t.isRecorder,isHidden:Qt(this,RD).permissions.hiddenParticipant,stageStatus:Qt(this,RD).stageStatus});n?(e=Qt(this,CD).joined.get(i.peerId),Qt(this,RD).id===n&&(e=s)):e=s,this.sendIframeEvent({type:14,payload:{peer:e&&IS(e)},uuid:r.uuid});break}case 15:{const e=Qt(this,CD).joined.toArray().map((e=>IS(e)));this.sendIframeEvent({type:15,payload:{peers:e},uuid:r.uuid});break}case 19:this.sendIframeEvent({type:19,payload:{enabledBy:this.enabledBy},uuid:r.uuid});break;case 18:this.sendIframeEvent({type:18,payload:{displayTitle:Qt(this,DD,MD).meetingTitle},uuid:r.uuid});break;case 17:this.sendIframeEvent({type:17,payload:{roomName:Qt(this,DD,MD).roomName},uuid:r.uuid});break;case 20:this.emit(r.payload.eventName,r.payload.data)}return}const o=(e,t)=>{if(Qt(this,RD).userId===e)return Qt(this,RD).id;let r;return t.forEach((t=>{t.userId===e&&(r=t.id)})),r},a=e;switch(a.type){case"pluginEvent":case"storePluginData":case"getPluginData":case"enablePluginForAll":case"enablePluginForUser":case"disablePluginForUser":case"chatMessage":s=yield Qt(this,DD,MD).sendMessage(a),this.sendIframeEvent(s);break;case"getJoinedPeers":s=yield Qt(this,DD,MD).getRoomState(),this.sendIframeEvent({type:"websocket/get-joined-peers",payload:zt(qt({},a.payload),{peers:s.payload.roomState.peers})});break;case"getPeerInfo":s=yield Qt(this,DD,MD).sendMessage({type:a.type,payload:zt(qt({},a.payload),{peerId:null!=(i=null==(r=a.payload)?void 0:r.peerId)?i:Qt(this,RD).id})}),this.sendIframeEvent(s);break;case"getRoomState":{s=yield Qt(this,DD,MD).getRoomState();const{plugins:e,peers:t}=s.payload.roomState,{enabledBy:r}=e.find((e=>e.id===this.id)),i=o(r,t);this.sendIframeEvent({type:"websocket/get-room-state",payload:zt(qt({},a.payload),{roomName:s.payload.roomState.roomName,pluginInitiatorPeerId:i,pluginInitiatorUserId:r,peers:s.payload.roomState.peers,displayTitle:s.payload.roomState.displayTitle,roomUUID:s.payload.roomState.roomUUID,currentPeer:Qt(this,RD).id,isRecorder:null==(n=Qt(this,RD).permissions)?void 0:n.isRecorder})});break}case"getPluginInitiatorId":{s=yield Qt(this,DD,MD).getRoomState();const{plugins:e,peers:t}=s.payload.roomState,{enabledBy:r}=e.find((e=>e.id===this.id)),i=o(r,t);this.sendIframeEvent({type:"websocket/get-plugin-initiator-peer-id",payload:zt(qt({},a.payload),{pluginInitiatorPeerId:i})});break}case"getPluginInitiatorUserId":{s=yield Qt(this,DD,MD).getRoomState();const{plugins:e}=s.payload.roomState,{enabledBy:t}=e.find((e=>e.id===this.id));this.sendIframeEvent({type:"websocket/get-plugin-initiator-user-id",payload:zt(qt({},a.payload),{pluginInitiatorUserId:t})});break}case"pluginEventToParent":this.emit(a.payload.eventName,a.payload.data);break;case"toggleViewMode":this.emit("toggleViewMode",a.payload.data)}}))}sendData(e){"socket-service"!==Qt(this,kD)?this.sendIframeEvent({type:XS.PLUGIN_INTERNAL_DATA,payload:{pluginId:this.id,data:e}}):this.sendIframeEvent({type:24,uuid:"",payload:e})}removePluginView(e="default"){var t;const{iframe:r,listener:i}=null!=(t=this.iframes.get(e))?t:{};(r||i)&&(navigator.isReactNative?r.props.onMessage=void 0:window.removeEventListener("message",i),this.iframes.delete(e))}addPluginView(e,t="default"){var r;if(!Qt(this,PD))throw BS.error("DytePlugin::addPluginView::no_auth_token_set_for_plugin"),new qS("No auth token set for plugin.");if(!e)throw BS.error("DytePlugin::addPluginView::iframe_was_not_provided"),new qS("Iframe was not provided.");this.removePluginView(t);const i=e,n=new URL(this.baseURL),s={auth:Qt(this,PD),parent:navigator.isReactNative?this.baseURL:window.location.origin,backend:td.apiBase,pluginId:this.id,roomName:null!=(r=Qt(this,DD,MD).roomName)?r:"",displayTitle:Qt(this,DD,MD).meetingTitle};if(Object.keys(s).forEach((e=>{n.searchParams.set(e,s[e])})),i.src=n.href,i.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",i.title=t,navigator.isReactNative)i.props.onMessage=e=>{this.handleIframeMessage(JSON.parse(e.nativeEvent.data))},this.iframes.set(t,{iframe:i});else{const r=t=>tr(this,null,(function*(){t.source===e.contentWindow&&(yield this.handleIframeMessage(t.data))}));window.addEventListener("message",r),this.iframes.set(t,{iframe:i,listener:r})}}setActive(e){var t,r;this.active=e,e?this.emit("stateUpdate",{active:this.active,pluginId:this.id,bind:this.addPluginView.bind(this),views:null==(t=this.config)?void 0:t.views}):(this.active=!1,this.emit("stateUpdate",{active:this.active,pluginId:this.id,views:null==(r=this.config)?void 0:r.views}))}activateForSelf(){return tr(this,null,(function*(){const e=qw(),t=yield e.authorizePlugin(this.id);Zt(this,PD,t),Zt(this,ID,new Date);try{const t=yield e.getPluginConfig(this.baseURL);this.config=t}catch(e){BS.error("DytePlugin::activateForSelf",{error:e})}this.setActive(!0),this.emit("enabled")}))}deactivateForSelf(){Array.from(this.iframes.keys()).forEach((e=>{this.removePluginView(e)})),Zt(this,ID,void 0),this.iframes.clear(),this.setActive(!1),this.emit("closed")}enable(){return tr(this,null,(function*(){return this.activateForSelf()}))}disable(){return this.deactivateForSelf()}activate(){return tr(this,null,(function*(){var e,t;this.active||null!=(t=null==(e=Qt(this,RD).permissions)?void 0:e.plugins)&&t.canStart&&("socket-service"===Qt(this,kD)?Qt(this,wD).addPlugin(this.id,this.staggered):yield Qt(this,DD,MD).addRoomPlugin(this),Zt(this,ID,new Date),BS.info("plugin::activated",{plugin:{id:this.id,enabledBy:this.enabledBy,name:this.name}}))}))}deactivate(){return tr(this,null,(function*(){var e,t;this.activate&&null!=(t=null==(e=Qt(this,RD).permissions)?void 0:e.plugins)&&t.canClose&&("socket-service"===Qt(this,kD)?Qt(this,wD).removePlugin(this.id):yield Qt(this,DD,MD).removeRoomPlugin(this),BS.info("plugin::deactivated",{plugin:{id:this.id,name:this.name,duration:(new Date).getTime()-Qt(this,ID).getTime()}}),Zt(this,ID,void 0))}))}},wD=new WeakMap,kD=new WeakMap,RD=new WeakMap,CD=new WeakMap,AD=new WeakMap,ID=new WeakMap,PD=new WeakMap,DD=new WeakSet,MD=function(){return _C()},OD);TD([VS.trace("PluginController.activatePlugin")],ND.prototype,"activate",1),TD([VS.trace("PluginController.deactivatePlugin")],ND.prototype,"deactivate",1),ND=TD([KS((e=>{throw new qS(e.message,"0600")}))],ND);class xD extends aP{constructor(){super({onAddEvent:"pluginAdded",onDeleteEvent:"pluginDeleted"})}add(e,t=!0){return super.add(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}Object.defineProperty,Object.getOwnPropertyDescriptor;let LD=class{constructor(){Kt(this,"all"),Kt(this,"active"),this.all=new xD,this.active=new xD}};LD=((e,t,r,i)=>{for(var n,s=t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(s)||s);return s})([KS((e=>{throw new qS(e.message,"0600")}))],LD);var jD,UD,FD=Object.defineProperty,VD=Object.getOwnPropertyDescriptor,BD=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?VD(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&FD(t,r,s),s};const WD=(UD=class{constructor(e){Xt(this,jD,void 0),Zt(this,jD,e)}createChannel(e,t,r,i="public",n=!1){return tr(this,null,(function*(){const s={displayName:e,targetUserIds:t,displayPictureUrl:r,visibility:i,isDirectMessage:n};n&&(s.visibility="private");const o=yield Qt(this,jD).sendMessagePromise(Xw.createChatChannel,jT.toBinary(s)),a=WT.fromBinary(o.payload).chatChannels;return WD.formatChannel(a[0])}))}updateChannel(e,t){return tr(this,null,(function*(){const r=yield Qt(this,jD).sendMessagePromise(Xw.updateChatChannel,UT.toBinary({chatChannelId:e,targetUserIds:t.memberIds,displayName:t.displayName,displayPictureUrl:t.displayPictureUrl,visibility:t.visibility})),i=WT.fromBinary(r.payload).chatChannels;return WD.formatChannel(i[0])}))}static formatChannel(e){var t;const{latestMessageAndUnreadCount:r}=e,i=zt(qt({},e),{id:e.chatChannelId,memberIds:e.targetUserIds,unreadCount:null!=(t=null==r?void 0:r.unreadCount)?t:0});return null!=r&&r.message&&(i.latestMessage=gM.formatSocketServiceMessage(r.message)),delete i.chatChannelId,delete i.targetUserIds,delete i.latestMessageAndUnreadCount,i}getChannelMembers(e){return tr(this,null,(function*(){try{const t=yield Qt(this,jD).sendMessagePromise(Xw.getChannelMembers,FT.toBinary({chatChannelId:e}));return GT.fromBinary(t.payload).channelMembers.map((e=>{var t=e,{id:r}=t,i=Jt(t,["id"]);return zt(qt({},i),{userId:r})}))}catch(e){return[]}}))}on(e,t){let r,i;switch(e){case Xw.createChatChannel:case Xw.updateChatChannel:r=WT.fromBinary.bind(WT),i=WT.create()}r?Qt(this,jD).on(e,(({payload:e})=>{let n=i;try{n=r(e)}catch(e){BS.error("ChatChannelSocketHandler::on::binary_decode_error",{error:e})}return t(n)})):BS.warn(`ChatChannelSocketHandler::Event ${e} is not recognized`)}},jD=new WeakMap,UD);let HD=WD;BD([VS.trace("ChatChannelHandler.createChannel")],HD.prototype,"createChannel",1),BD([VS.trace("ChatChannelHandler.updateChannel")],HD.prototype,"updateChannel",1),BD([VS.trace("ChatChannelHandler.getChannelMembers")],HD.prototype,"getChannelMembers",1);var GD,$D=Object.defineProperty,qD=Object.getOwnPropertyDescriptor,zD=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?qD(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&$D(t,r,s),s},JD=(e=>(e[e.TEXT=0]="TEXT",e[e.IMAGE=1]="IMAGE",e[e.FILE=2]="FILE",e[e.CUSTOM=3]="CUSTOM",e))(JD||{});class KD{constructor(e){Xt(this,GD,void 0),Zt(this,GD,e)}getChatMessages(){return Qt(this,GD).sendMessagePromise(Kw.getMessages)}getChatMessagesPaginated(e,t,r,i=0,n=""){return tr(this,null,(function*(){const s={timeStamp:e,size:t,from:i,reversed:r,channelId:n},o=yield Qt(this,GD).sendMessagePromise(Kw.getPaginatedMessages,ST.toBinary(s));return o.payload?ET.fromBinary(o.payload):{messages:[],next:!1}}))}sendMessageToRoom(e,t){const r={payloadType:t,payload:e};Qt(this,GD).sendMessage(Kw.sendMessageToRoom,bT.toBinary(r))}sendMessageToPeers(e,t,r){const i={payloadType:t,peerIds:r,payload:e};Qt(this,GD).sendMessage(Kw.sendMessageToPeers,kT.toBinary(i))}sendMessageToChannel(e,t,r){const i={payloadType:t,channelId:r,payload:e};Qt(this,GD).sendMessage(Kw.sendMessageToChannel,CT.toBinary(i))}sendMessage(e,t,r,i){i&&this.sendMessageToChannel(e,t,i),r&&r.length>0?this.sendMessageToPeers(e,t,r):this.sendMessageToRoom(e,t)}editMessage(e,t,r,i,n){return tr(this,null,(function*(){const s={chatId:e,payloadType:r,payload:t};i&&(s.channelId=i),void 0!==n&&(s.pinned=n);const o=yield Qt(this,GD).sendMessagePromise(Kw.editMessage,AT.toBinary(s));return DT.fromBinary(o.payload).message}))}deleteMessage(e,t){return tr(this,null,(function*(){const r={chatId:e};t&&(r.channelId=t);const i=yield Qt(this,GD).sendMessagePromise(Kw.deleteMessage,MT.toBinary(r)),n=OT.fromBinary(i.payload);return qt({id:n.chatId},n.channelId?{channelId:n.channelId}:{})}))}searchMessages(e,t){return tr(this,null,(function*(){var r,i,n;const s={searchTerm:e,timeStamp:null!=(r=t.timestamp)?r:Date.now(),size:null!=(i=t.size)?i:75,from:0,reversed:null==(n=t.reversed)||n};t.channelId&&(s.channelId=t.channelId);try{const e=yield Qt(this,GD).sendMessagePromise(Kw.searchChannelMessages,NT.toBinary(s));return TT.fromBinary(e.payload).messages}catch(e){return[]}}))}getAllChannels(){return tr(this,null,(function*(){try{const e=yield Qt(this,GD).sendMessagePromise(Kw.getAllChatChannels);return WT.fromBinary(e.payload).chatChannels.map(HD.formatChannel)}catch(e){return[]}}))}markLastReadMessage(e,t){return tr(this,null,(function*(){const r=yield Qt(this,GD).sendMessagePromise(Kw.markChannelIndexAsRead,xT.toBinary({channelId:e,userId:t.userId,channelIndex:t.channelIndex}));return LT.fromBinary(r.payload).channelIndex}))}setPinState(e,t){return tr(this,null,(function*(){const r={chatId:e.id,pinned:t,channelId:e.channelId},i=yield Qt(this,GD).sendMessagePromise(Kw.pinMessage,IT.toBinary(r));return PT.fromBinary(i.payload)}))}on(e,t){let r,i;switch(e){case Kw.sendMessageToRoom:r=wT.fromBinary.bind(wT),i=wT.create();break;case Kw.sendMessageToPeers:r=RT.fromBinary.bind(RT),i=RT.create();break;case Kw.editMessage:r=DT.fromBinary.bind(DT),i=DT.create();break;case Kw.pinMessage:r=PT.fromBinary.bind(PT),i=PT.create();break;case Kw.deleteMessage:r=OT.fromBinary.bind(OT),i=OT.create()}r?Qt(this,GD).on(e,(({payload:e})=>{let n=i;try{n=r(e)}catch(e){BS.error("chatSocketHandler::on::binary_decode_error",{error:e})}return t(n)})):BS.warn(`ChatSocketHandler::Event ${e} is not recognized`)}}GD=new WeakMap,zD([VS.trace("SocketService.getChatMessages")],KD.prototype,"getChatMessages",1),zD([VS.trace("SocketService.getChatMessagesPaginated")],KD.prototype,"getChatMessagesPaginated",1),zD([VS.trace("SocketService.sendMessageToRoom")],KD.prototype,"sendMessageToRoom",1),zD([VS.trace("SocketService.sendMessageToPeers")],KD.prototype,"sendMessageToPeers",1),zD([VS.trace("SocketService.sendMessageToChannel")],KD.prototype,"sendMessageToChannel",1),zD([VS.trace("SocketService.sendMessage")],KD.prototype,"sendMessage",1),zD([VS.trace("SocketService.editMessage")],KD.prototype,"editMessage",1),zD([VS.trace("SocketService.deleteMessage")],KD.prototype,"deleteMessage",1),zD([VS.trace("SocketService.searchMessages")],KD.prototype,"searchMessages",1),zD([VS.trace("SocketService.getAllChannels")],KD.prototype,"getAllChannels",1),zD([VS.trace("SocketService.markLastReadMessage")],KD.prototype,"markLastReadMessage",1);var YD=Object.defineProperty,QD=Object.getOwnPropertyDescriptor,XD=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?QD(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&YD(t,r,s),s};const ZD=["text","image","file","custom","poll"];var eM,tM,rM,iM,nM,sM,oM,aM;let cM=(aM=class extends HS{constructor(e,t,r,i,n){super(),Xt(this,sM),Kt(this,"messages"),Kt(this,"channels",[]),Xt(this,eM,void 0),Xt(this,tM,void 0),Xt(this,rM,void 0),Xt(this,iM,void 0),Xt(this,nM,void 0),Zt(this,rM,e),Zt(this,iM,t),Zt(this,nM,r),Zt(this,eM,i),Zt(this,tM,n),this.messages=[]}get roomJoined(){var e;return!0===(null==(e=Qt(this,sM,oM))?void 0:e.roomJoined)}sendMessageInternal(e,t,r){return tr(this,arguments,(function*(e,t,r,i={}){switch(e.type){case"text":{const n=i.replyTo&&"text"===i.replyTo.type?function(e,t){return`<blockquote>${t.replace(/<blockquote>[.\s\S]*<\/blockquote>\n\n/m,"")}</blockquote>\n\n${e}`}(e.message,i.replyTo.message):e.message;yield this.sendTextMessageInternal(n,t,r);break}case"image":yield this.sendImageMessageInternal(e.image,t,r);break;case"file":yield this.sendFileMessageInternal(e.file,t,r);break;default:BS.error("sendMessage::message_type_not_supported",{dyteChat:{messageType:e.type}})}}))}sendTextMessageInternal(e,t,r){return tr(this,null,(function*(){var i,n,s,o,a,c;if(t&&t.length>0){if(null==(i=Qt(this,eM).permissions)||!i.chatPrivate.canSend||null==(n=Qt(this,eM).permissions)||!n.chatPrivate.text)throw BS.error("sendTextMessage::private_chat_permission_denied"),new qS("Could not send message to private chat.","0501")}else if(null==(o=null==(s=Qt(this,eM).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Qt(this,eM).permissions)?void 0:a.chatPublic)||!c.text)throw BS.error("sendTextMessage::public_chat_permission_denied"),new qS("Could not send message to public chat.","0501");if(!e)throw BS.error("sendTextMessage::message_can_not_be_empty"),new qS("Message can not be empty.","0502");if(r){if("socket-service"!==Qt(this,nM))throw new Error("Socket service required for channel support");return void Qt(this,rM).sendMessageToChannel(e,JD.TEXT,r)}if("socket-service"===Qt(this,nM)){let r=[];return t&&t.length>0&&(t.push(Qt(this,eM).id),r=Qt(this,tM).joined.toArray().filter((e=>t.includes(e.id))).map((e=>e.userId)),r.push(Qt(this,eM).userId)),void Qt(this,rM).sendMessage(e,JD.TEXT,t)}if(void 0!==t&&t.length>0)return void BS.error("sendTextMessage::private_chat_unsupported");const d={userId:Qt(this,eM).userId,displayName:Qt(this,eM).name,message:e,type:ZD.indexOf("text"),time:+new Date};if(!this.roomJoined)throw BS.error("DyteChat.sendTextMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new qS("Can`t sendTextMessage without joining room");yield Qt(this,sM,oM).sendChatMessage(d)}))}sendImageMessageInternal(e,t,r){return tr(this,null,(function*(){var i,n,s,o,a,c;if(t&&t.length>0){if(null==(i=Qt(this,eM).permissions)||!i.chatPrivate.canSend||null==(n=Qt(this,eM).permissions)||!n.chatPrivate.files)return void BS.error("sendImageMessage::private_chat_permission_denied")}else if(null==(o=null==(s=Qt(this,eM).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Qt(this,eM).permissions)?void 0:a.chatPublic)||!c.files)return void BS.error("sendImageMessage::permission_denied");if(e)if(["image/gif","image/jpeg","image/png"].includes(e.type))try{const i=qw(),{getLocation:n,putLocation:s}=yield i.getPresignedUrls(e.name,Qt(this,eM).config.viewType);if(yield i.uploadFile(e,s),r){if("socket-service"!==Qt(this,nM))throw new Error("Socket service required for channel support");return void Qt(this,rM).sendMessageToChannel(n,JD.IMAGE,r)}if("socket-service"===Qt(this,nM)){let e=[];return t&&t.length>0&&(t.push(Qt(this,eM).id),e=Qt(this,tM).joined.toArray().filter((e=>t.includes(e.id))).map((e=>e.userId)),e.push(Qt(this,eM).userId)),void Qt(this,rM).sendMessage(n,JD.IMAGE,t)}if(void 0!==t&&t.length>0)return void BS.error("sendImageMessage::private_chat_unsupported");const o={userId:Qt(this,eM).userId,displayName:Qt(this,eM).name,type:ZD.indexOf("image"),link:n,time:+new Date};if(!this.roomJoined)throw BS.error("DyteChat.sendImageMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new qS("Can`t sendImageMessage without joining room");yield Qt(this,sM,oM).sendChatMessage(o)}catch(e){throw new qS("Error sending image message.")}else BS.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:e.type}});else BS.error("sendImageMessage::required_argument_image_can_not_be_empty")}))}sendFileMessageInternal(e,t,r){return tr(this,null,(function*(){var i,n,s,o,a,c;if(t&&t.length>0){if(null==(i=Qt(this,eM).permissions)||!i.chatPrivate.canSend||null==(n=Qt(this,eM).permissions)||!n.chatPrivate.files)return void BS.error("sendFileMessage::private_chat_permission_denied")}else if(null==(o=null==(s=Qt(this,eM).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Qt(this,eM).permissions)?void 0:a.chatPublic)||!c.files)return void BS.error("sendFileMessage::permission_denied");if(e)try{const i=qw(),{getLocation:n,putLocation:s}=yield i.getPresignedUrls(e.name,Qt(this,eM).config.viewType);if(yield i.uploadFile(e,s),r){if("socket-service"!==Qt(this,nM))throw new Error("Socket service required for channel support");return void Qt(this,rM).sendMessageToChannel(JSON.stringify({link:n,name:e.name,size:"size"in e?e.size:0}),JD.FILE,r)}if("socket-service"===Qt(this,nM)){let r=[];t&&t.length>0&&(t.push(Qt(this,eM).id),r=Qt(this,tM).joined.toArray().filter((e=>t.includes(e.id))).map((e=>e.userId)),r.push(Qt(this,eM).userId));const i=JSON.stringify({link:n,name:e.name,size:"size"in e?e.size:0});return void Qt(this,rM).sendMessage(i,JD.FILE,t)}if(void 0!==t&&t.length>0)return void BS.error("sendFileMessage::private_chat_unsupported");const o={userId:Qt(this,eM).userId,displayName:Qt(this,eM).name,type:ZD.indexOf("file"),link:n,name:e.name,size:"size"in e?e.size:0,time:+new Date};if(!this.roomJoined)throw BS.error("DyteChat.sendFileMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new qS("Can`t sendFileMessage without joining room");yield Qt(this,sM,oM).sendChatMessage(o)}catch(e){throw new qS("Error sending file message.")}else BS.error("sendFileMessage::required_argument_file_can_not_be_empty")}))}sendTextMessage(e,t){return tr(this,null,(function*(){return this.sendTextMessageInternal(e,t)}))}sendCustomMessage(e,t){return tr(this,null,(function*(){var r,i,n,s,o,a,c,d,l,u,p,h,m,f,g;if(t&&t.length>0){if(null==(r=Qt(this,eM).permissions)||!r.chatPrivate.canSend||null==(i=Qt(this,eM).permissions)||!i.chatPrivate.files||null==(n=Qt(this,eM).permissions)||!n.chatPrivate.text)return void BS.error("sendCustomMessage::private_chat_permission_denied")}else if(null==(o=null==(s=Qt(this,eM).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Qt(this,eM).permissions)?void 0:a.chatPublic)||!c.files||null==(l=null==(d=Qt(this,eM).permissions)?void 0:d.chatPublic)||!l.text)return void BS.error("sendCustomMessage::permission_denied");const v=e=>tr(this,null,(function*(){try{if("string"==typeof e)return e;const t=qw(),{getLocation:r,putLocation:i}=yield t.getPresignedUrls(e.name,Qt(this,eM).config.viewType);return yield t.uploadFile(e,i),r}catch(e){throw new qS("Error sending image message.")}})),y=zt(qt({},e),{files:yield Promise.all(null==(p=null!=(u=e.files)?u:[])?void 0:p.map((e=>v(e)))),images:yield Promise.all(null==(m=null!=(h=e.images)?h:[])?void 0:m.map((e=>tr(this,null,(function*(){return v(e)}))))),videos:yield Promise.all(null==(g=null!=(f=e.videos)?f:[])?void 0:g.map((e=>tr(this,null,(function*(){return v(e)})))))});if("socket-service"===Qt(this,nM))return void Qt(this,rM).sendMessage(JSON.stringify(y),JD.CUSTOM,t);if(void 0!==t&&t.length>0)return void BS.error("sendCustomMessage::private_chat_unsupported");if(!this.roomJoined)throw BS.error("DyteChat.sendCustomMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new qS("Can`t sendCustomMessage without joining room");const _=zt(qt({userId:Qt(this,eM).userId,displayName:Qt(this,eM).name},y),{type:ZD.indexOf("custom"),time:+new Date});yield Qt(this,sM,oM).sendChatMessage(_)}))}sendImageMessage(e,t){return tr(this,null,(function*(){return this.sendImageMessageInternal(e,t)}))}sendFileMessage(e,t){return tr(this,null,(function*(){return this.sendFileMessageInternal(e,t)}))}sendMessage(e,t){return tr(this,null,(function*(){return this.sendMessageInternal(e,t)}))}editTextMessage(e,t,r){return tr(this,null,(function*(){var i,n,s,o,a,c;if("socket-service"===Qt(this,nM)){if("NONE"===(null==(n=null==(i=Qt(this,eM).permissions)?void 0:i.chatMessage)?void 0:n.canEdit))throw new qS("Not permitted to edit messages","0501");null!=(o=null==(s=Qt(this,eM).permissions)?void 0:s.chatPublic)&&o.canSend&&null!=(c=null==(a=Qt(this,eM).permissions)?void 0:a.chatPublic)&&c.text?t?Qt(this,rM).editMessage(e,t,JD.TEXT,r):BS.error("editTextMessage::message_can_not_be_empty"):BS.error("editTextMessage::permission_denied")}else BS.warn("editTextMessage::Coming soon!")}))}editImageMessage(e,t,r){return tr(this,null,(function*(){var i,n,s,o;if("socket-service"===Qt(this,nM))if(null!=(n=null==(i=Qt(this,eM).permissions)?void 0:i.chatPublic)&&n.canSend&&null!=(o=null==(s=Qt(this,eM).permissions)?void 0:s.chatPublic)&&o.files)if(t)if(["image/gif","image/jpeg","image/png"].includes(t.type))try{const i=qw(),{getLocation:n,putLocation:s}=yield i.getPresignedUrls(t.name,Qt(this,eM).config.viewType);yield i.uploadFile(t,s),Qt(this,rM).editMessage(e,n,JD.IMAGE,r)}catch(e){throw new qS("Error editing image message.")}else BS.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:t.type}});else BS.error("editImageMessage::required_argument_image_can_not_be_empty");else BS.error("editImageMessage::permission_denied");else BS.warn("editImageMessage::Coming soon!")}))}editFileMessage(e,t,r){return tr(this,null,(function*(){var i,n,s,o;if("socket-service"===Qt(this,nM))if(null!=(n=null==(i=Qt(this,eM).permissions)?void 0:i.chatPublic)&&n.canSend&&null!=(o=null==(s=Qt(this,eM).permissions)?void 0:s.chatPublic)&&o.files)if(t)try{const i=qw(),{getLocation:n,putLocation:s}=yield i.getPresignedUrls(t.name,Qt(this,eM).config.viewType);yield i.uploadFile(t,s),Qt(this,rM).editMessage(e,JSON.stringify({link:n,name:t.name,size:"size"in t?t.size:0}),JD.FILE,r)}catch(e){throw new qS("Error editing file message.")}else BS.error("sendFileMessage::required_argument_file_can_not_be_empty");else BS.error("sendFileMessage::permission_denied");else BS.warn("editFileMessage::Coming soon!")}))}editMessage(e,t,r){return tr(this,null,(function*(){if("socket-service"===Qt(this,nM))switch(t.type){case"text":this.editTextMessage(e,t.message,r);break;case"image":this.editImageMessage(e,t.image,r);break;case"file":this.editFileMessage(e,t.file,r);break;default:BS.error("editMessage::message_type_not_supported",{dyteChat:{messageType:t.type}})}else BS.warn("editMessage::Coming soon!")}))}deleteMessage(e,t){return tr(this,null,(function*(){var r,i;if("socket-service"===Qt(this,nM)){if("NONE"===(null==(i=null==(r=Qt(this,eM).permissions)?void 0:r.chatMessage)?void 0:i.canDelete))throw new qS("Not permitted to delete messages","0501");Qt(this,rM).deleteMessage(e,t)}else BS.warn("editMessage::Coming soon!")}))}getMessagesByUser(e){return this.messages.filter((t=>t.userId===e))}getMessagesByType(e){return this.messages.filter((t=>t.type===e))}pin(e){return tr(this,null,(function*(){if(!this.roomJoined)throw new qS("Can`t pin message without joining room");if(!Qt(this,eM).permissions.pinParticipant)throw new qS("You do not have permission to pin messages.");if("socket-service"===Qt(this,nM)){const t=this.messages.find((t=>t.id===e));if(t)return void Qt(this,rM).setPinState(t,!0);throw new qS(`No message found with id: ${e}`)}yield Qt(this,sM,oM).pinChatMessage({id:e})}))}unpin(e){return tr(this,null,(function*(){if(!this.roomJoined)throw new qS("Can`t unpin message without joining room");if(!Qt(this,eM).permissions.pinParticipant)throw new qS("You do not have permission to unpin messages.");if("socket-service"===Qt(this,nM)){const t=this.messages.find((t=>t.id===e));if(t)return void Qt(this,rM).setPinState(t,!1);throw new qS(`No message found with id: ${e}`)}yield Qt(this,sM,oM).unpinChatMessage({id:e})}))}getMessages(e,t,r,i=0,n=void 0){return tr(this,null,(function*(){const s=yield Qt(this,rM).getChatMessagesPaginated(e,t,r,i,n);return{messages:s.messages.map((e=>gM.formatSocketServiceMessage(e))),next:s.next}}))}createChannel(e,t){return tr(this,arguments,(function*(e,t,r={}){var i;const n=null==(i=Qt(this,eM).permissions)?void 0:i.chatChannel;if(n){if("NONE"===n.canCreate)throw new qS("Not permitted to create channels","0501");if("public"===r.visibility&&"PUBLIC"!==n.canCreate&&"ALL"!==n.canCreate)throw new qS("Not permitted to create public channels","0501");if("private"===r.visibility&&"PRIVATE"!==n.canCreate&&"ALL"!==n.canCreate)throw new qS("Not permitted to create private channels","0501")}if(!e||0===e.trim().length)throw new qS("channel name cannot be empty.","0510");const s=[...new Set([...t,Qt(this,eM).userId])];return yield Qt(this,iM).createChannel(e.trim(),s,r.displayPictureUrl,r.visibility,r.isDirectMessage)}))}updateChannel(e,t){var r,i,n,s,o;const a=this.channels.find((t=>t.id===e)),c=null==(r=Qt(this,eM).permissions)?void 0:r.chatChannel;if(c){if("NONE"===c.canUpdate)throw new qS("Not permitted to update channels","0501");if("public"===a.visibility&&"PUBLIC"!==c.canUpdate&&"ALL"!==c.canUpdate)throw new qS("Not permitted to update public channels","0501");if("private"===a.visibility&&"PRIVATE"!==c.canUpdate&&"ALL"!==c.canUpdate)throw new qS("Not permitted to update private channels","0501")}const d={memberIds:null!=(i=t.memberIds)?i:a.memberIds,displayName:null!=(n=t.displayName)?n:a.displayName,displayPictureUrl:null!=(s=t.displayPictureUrl)?s:a.displayPictureUrl,visibility:null!=(o=t.visibility)?o:a.visibility};return Qt(this,iM).updateChannel(e,d)}sendMessageToChannel(e,t){return tr(this,arguments,(function*(e,t,r={}){return this.sendMessageInternal(e,null,t,r)}))}getChannelMembers(e){return tr(this,null,(function*(){return Qt(this,iM).getChannelMembers(e)}))}searchMessages(e){return tr(this,arguments,(function*(e,t={}){if(!Ci.hasFeature(DS.FEAT_CHAT_SDK_SEARCH))throw new qS("searchMessages is temporarily disabled!");return(yield Qt(this,rM).searchMessages(e,t)).map(gM.formatSocketServiceMessage)}))}markLastReadMessage(e,t){return tr(this,null,(function*(){yield Qt(this,rM).markLastReadMessage(e,t);const r=this.channels.find((t=>t.id===e));if(r){const t=zt(qt({},r),{unreadCount:0});this.channels=this.channels.map((r=>r.id===e?t:r)),this.emit("channelMessageUpdate",t)}}))}get pinned(){return this.messages.filter((e=>e.pinned))}},eM=new WeakMap,tM=new WeakMap,rM=new WeakMap,iM=new WeakMap,nM=new WeakMap,sM=new WeakSet,oM=function(){return _C()},aM);XD([VS.trace("DyteChat.sendTextMessage")],cM.prototype,"sendTextMessage",1),XD([VS.trace("DyteChat.sendImageMessage")],cM.prototype,"sendImageMessage",1),XD([VS.trace("DyteChat.sendFileMessage")],cM.prototype,"sendFileMessage",1),XD([VS.trace("DyteChat.sendMessage")],cM.prototype,"sendMessage",1),XD([VS.trace("DyteChat.editTextMessage")],cM.prototype,"editTextMessage",1),XD([VS.trace("DyteChat.editImageMessage")],cM.prototype,"editImageMessage",1),XD([VS.trace("DyteChat.editFileMessage")],cM.prototype,"editFileMessage",1),XD([VS.trace("DyteChat.editMessage")],cM.prototype,"editMessage",1),XD([VS.trace("DyteChat.deleteMessage")],cM.prototype,"deleteMessage",1),XD([VS.trace("DyteChat.createChannel")],cM.prototype,"createChannel",1),XD([VS.trace("DyteChat.updateChannel")],cM.prototype,"updateChannel",1),XD([VS.trace("DyteChat.sendMessageToChannel")],cM.prototype,"sendMessageToChannel",1),XD([VS.trace("DyteChat.getChannelMembers")],cM.prototype,"getChannelMembers",1),XD([VS.trace("DyteChat.searchMessages")],cM.prototype,"searchMessages",1),XD([VS.trace("DyteChat.markLastReadMessage")],cM.prototype,"markLastReadMessage",1),cM=XD([KS((e=>{throw new qS(e.message,"0500")}))],cM);var dM,lM,uM,pM,hM=Object.defineProperty,mM=Object.getOwnPropertyDescriptor;const fM=(pM=class{constructor(e,t,r,i,n,s=!1){Xt(this,dM),Kt(this,"chat"),Kt(this,"chatSocketHandler"),Kt(this,"chatChannelSocketHandler"),Kt(this,"self"),Xt(this,uM,void 0),this.chatSocketHandler=e,this.chatChannelSocketHandler=t,Zt(this,uM,r),this.chat=new cM(e,t,r,i,n),this.self=i,this.setupEvents(s)}get roomJoined(){var e;return!0===(null==(e=Qt(this,dM,lM))?void 0:e.roomJoined)}static init(e,t,r,i,n,s=!1){return tr(this,null,(function*(){const o=ww(r.config.viewType,n)?"socket-service":"room-node";return BS.info(`Using socket server :: ${o} for chat`),new fM(e,t,o,r,i,s)}))}static formatMessage(e){return zt(qt({},e),{time:new Date(e.time),type:ZD[e.type]})}static formatSocketServiceMessage(e){const t=1e3*e.createdAt,r={displayName:e.displayName,id:e.chatId,time:t,timeMs:e.createdAtMs,type:e.payloadType,isEdited:e.isEdited,userId:e.userId,targetUserIds:e.targetUserIds,channelId:e.channelId,channelIndex:e.channelIndex,message:"",link:"",name:"",html:"",images:[],videos:[],files:[],size:0,pinned:e.pinned};switch(r.type){case JD.TEXT:r.message=e.payload;break;case JD.IMAGE:r.link=e.payload;break;case JD.FILE:{const{link:t,name:i,size:n}=JSON.parse(e.payload);r.link=t,r.name=i,r.size=n;break}case JD.CUSTOM:{const{html:t,images:i,message:n,videos:s,files:o}=JSON.parse(e.payload);r.message=n,r.html=t,r.images=i,r.videos=s,r.files=o;break}}return fM.formatMessage(r)}getChatMessages(){return tr(this,null,(function*(){if("LIVESTREAM"===this.self.config.viewType||"CHAT"===this.self.config.viewType||Ci.hasFeature(DS.FEAT_PAGINATED_CHAT))return;if("socket-service"===Qt(this,uM)){const e=yield this.chatSocketHandler.getChatMessages();if(null==e||!e.payload)return;const t=TT.fromBinary(e.payload).messages;return void(this.chat.messages=t.map((e=>fM.formatSocketServiceMessage(e))))}if(!this.roomJoined)return void BS.error("ChatController.getChatMessages.RoomNodeClientSocketUsed_WithoutRoomJoin");const{messages:e}=(yield Qt(this,dM,lM).getChatMessages()).payload;this.chat.messages=e.filter((e=>"poll"!==ZD[e.type])).map(fM.formatMessage)}))}getAllChannels(){return tr(this,null,(function*(){"CHAT"===this.self.config.viewType&&(this.chat.channels=yield this.chatSocketHandler.getAllChannels(),this.chat.emit("channelUpdate"))}))}setupEvents(e=!1){"socket-service"===Qt(this,uM)?tE.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>tr(this,null,(function*(){this.getChatMessages(),yield this.getAllChannels()})))):tE.onAsync(XS.ROOM_JOINED,(()=>tr(this,null,(function*(){const t=this.getChatMessages();e||(yield t)})))),this.chatSocketHandler.on(Kw.sendMessageToRoom,(e=>{const t=fM.formatSocketServiceMessage(e.message);if(t.channelId){const e=this.chat.channels.find((e=>e.id===t.channelId));e&&(e.latestMessage=t,e.unreadCount+=1,this.chat.emit("channelMessageUpdate",e))}else this.chat.messages=[...this.chat.messages,t];this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})})),this.chatSocketHandler.on(Kw.sendMessageToPeers,(e=>{const t=fM.formatSocketServiceMessage(e.message);this.chat.messages=[...this.chat.messages,t],this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})})),this.chatSocketHandler.on(Kw.editMessage,(e=>{const t=fM.formatSocketServiceMessage(e.message);if(t.channelId)return void this.chat.emit("chatUpdate",{action:"edit",message:t,messages:this.chat.messages});const r=this.chat.messages.findIndex((e=>e.id===t.id));-1!==r&&(this.chat.messages[r]=t,this.chat.emit("chatUpdate",{action:"edit",message:t,messages:this.chat.messages}))})),this.chatSocketHandler.on(Kw.deleteMessage,(e=>{if(e.channelId)return void this.chat.emit("chatUpdate",{action:"delete",message:{id:e.chatId,channelId:e.channelId},messages:this.chat.messages});const t=this.chat.messages.findIndex((t=>t.id===e.chatId));if(-1===t)return;const[r]=this.chat.messages.splice(t,1);this.chat.emit("chatUpdate",{action:"delete",message:r,messages:this.chat.messages})})),this.chatChannelSocketHandler.on(Xw.createChatChannel,(e=>{const[t]=e.chatChannels,r=HD.formatChannel(t);this.chat.channels.push(r),this.chat.emit("channelCreate",r)})),this.chatSocketHandler.on(Kw.pinMessage,(e=>{const t=this.chat.messages.findIndex((t=>t.id===e.chatId));if(-1===t)return;const r=this.chat.messages[t];r.pinned=e.pinned,this.chat.messages[t]=r,this.chat.emit("chatUpdate",{action:"edit",message:r,messages:this.chat.messages})})),this.chatChannelSocketHandler.on(Xw.updateChatChannel,(e=>{const[t]=e.chatChannels,r=HD.formatChannel(t);this.chat.channels=this.chat.channels.map((e=>e.id===r.id?r:e)),this.chat.emit("channelUpdate",r)})),tE.on(XS.NEW_CHAT_MESSAGE,(e=>{if("poll"===ZD[null==e?void 0:e.type])return;const t=fM.formatMessage(e);this.chat.messages=[...this.chat.messages,t],this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})})),tE.on(XS.PIN_CHAT_MESSAGE,(e=>tr(this,null,(function*(){const t=fM.formatMessage(e),r=this.chat.messages.findIndex((e=>e.id===t.id));this.chat.messages[r]=t,this.chat.emit("pinMessage",{message:t,messages:this.chat.messages})})))),tE.on(XS.UNPIN_CHAT_MESSAGE,(e=>tr(this,null,(function*(){const t=fM.formatMessage(e),r=this.chat.messages.findIndex((e=>e.id===t.id));this.chat.messages[r]=t,this.chat.emit("unpinMessage",{message:t,messages:this.chat.messages})}))))}},dM=new WeakSet,lM=function(){return _C()},uM=new WeakMap,pM);let gM=fM;((e,t,r,i)=>{for(var n,s=mM(t,r),o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(t,r,s)||s);s&&hM(t,r,s)})([VS.trace("ChatController.setupEvents")],gM.prototype,"setupEvents");var vM,yM,_M,SM,EM,TM,bM=Object.defineProperty,wM=Object.getOwnPropertyDescriptor,kM=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?wM(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&bM(t,r,s),s};const RM=(TM=class{constructor(e,t,r,i){Xt(this,SM),Kt(this,"plugins"),Xt(this,vM,void 0),Xt(this,yM,void 0),Xt(this,_M,void 0),Zt(this,vM,e),Zt(this,_M,t),Zt(this,yM,r),this.plugins=i,this.setupEvents()}get roomJoined(){var e;return!0===(null==(e=Qt(this,SM,EM))?void 0:e.roomJoined)}static init(e,t,r,i,n,s,o){return tr(this,null,(function*(){const a=Rw(n.config.viewType,o)?"socket-service":"room-node";BS.info(`Using socket server ${a} for plugin`);const c=new LD;return e.forEach((e=>{const r=new ND(e,t,a,n,s,i);c.all.add(r)})),!1===n.config.isV2&&n.config.setDisabledPlugins(c.all.toArray().map((e=>e.id))),new RM(t,r,a,c)}))}getRoomPlugins(){return tr(this,null,(function*(){if("socket-service"===Qt(this,yM)){const{plugins:e}=yield Qt(this,vM).getActivePlugins();return void(yield Promise.all(e.map((e=>this.enablePlugin({id:e.pluginId,enabledBy:e.enabledBy})))))}if(!this.roomJoined)return void BS.error("PluginController.getRoomPlugins.RoomNodeClientSocketUsed_WithoutRoomJoin");const{payload:e}=yield Qt(this,SM,EM).getRoomState();yield Promise.all(e.roomState.plugins.map((e=>this.enablePlugin(e))))}))}enablePlugin(e){return tr(this,arguments,(function*({id:e,enabledBy:t}){const r=this.plugins.all.get(e);r&&(yield r.activateForSelf(),r.enabledBy=t)}))}disablePlugin(e){return tr(this,arguments,(function*({id:e}){const t=this.plugins.all.get(e);t&&t.deactivateForSelf()}))}sendIframeEventOld(e,t){const{id:r}=t,i=this.plugins.all.get(r);i&&i.sendIframeEvent({type:e,payload:t})}sendIframeEvent(e,t,r,i){const n=this.plugins.all.get(t);t&&n.sendIframeEvent({type:e,uuid:r,payload:i})}broadcastIframeEventOld(e,t){this.plugins.active.forEach((r=>{this.sendIframeEventOld(e,zt(qt({},t),{id:r.id}))}))}broadcastIframeEvent(e,t){this.plugins.active.forEach((r=>{this.sendIframeEvent(e,r.id,"",t)}))}setupEvents(){if(this.plugins.all.on("stateUpdate",(({active:e,id:t})=>{e?this.plugins.active.add(this.plugins.all.get(t)):this.plugins.active.delete(t)})),tE.onAsync(XS.ROOM_JOINED,(()=>tr(this,null,(function*(){yield this.getRoomPlugins(),BS.debug("[ROOM_JOINED] resolved request to fetch plugins.")})))),"socket-service"===Qt(this,yM))return Qt(this,vM).on(Yw.addPlugin,(e=>tr(this,null,(function*(){var t;const r=e.pluginId;null!=(t=this.plugins.all.get(r))&&t.active||(yield this.enablePlugin({id:r,enabledBy:e.enabledBy}))})))),Qt(this,vM).on(Yw.removePlugin,(e=>tr(this,null,(function*(){var t;const r=e.pluginId;null!=(t=this.plugins.all.get(r))&&t.active&&(yield this.disablePlugin({id:r}))})))),[Yw.enablePluginForPeers,Yw.enablePluginForRoom].forEach((e=>{Qt(this,vM).on(e,((t,r)=>tr(this,null,(function*(){this.sendIframeEvent(e,t.pluginId,r,{enabledBy:t.enabledBy})}))))})),[Yw.disablePluginForPeers,Yw.disablePluginForRoom].forEach((e=>{Qt(this,vM).on(e,((t,r)=>tr(this,null,(function*(){this.sendIframeEvent(e,t.pluginId,r,{disabledBy:t.disabledBy})}))))})),[Yw.customPluginEventToPeers,Yw.customPluginEventToRoom].forEach((e=>{Qt(this,vM).on(e,((t,r)=>tr(this,null,(function*(){this.sendIframeEvent(e,t.pluginId,r,{data:JSON.parse((new TextDecoder).decode(t.pluginData))})}))))})),[Yw.storeInsertKeys,Yw.storeGetKeys,Yw.storeDeleteKeys].forEach((e=>{Qt(this,vM).on(e,((t,r)=>tr(this,null,(function*(){var i;const n=null==(i=t.storeItems)?void 0:i.map((e=>{var t;return{timestamp:e.timestamp,peerId:e.peerId,payload:JSON.parse(null!=(t=e.payload)&&t.length?(new TextDecoder).decode(e.payload):"{}"),key:e.storeKey}}));this.sendIframeEvent(e,t.pluginId,r,{storeName:t.storeName,storeItems:n})}))))})),Qt(this,vM).on(Yw.storeDelete,((e,t)=>tr(this,null,(function*(){this.sendIframeEvent(Yw.storeDelete,e.pluginId,t,{storeName:e.storeName})})))),Qt(this,_M).on(Kw.sendMessageToPeers,(e=>{const t=null==gM?void 0:gM.formatSocketServiceMessage(e.message);this.broadcastIframeEvent(bD,{message:t})})),Qt(this,_M).on(Kw.sendMessageToRoom,(e=>{const t=null==gM?void 0:gM.formatSocketServiceMessage(e.message);this.broadcastIframeEvent(bD,{message:t})})),tE.on(XS.PEER_JOINED,(e=>{this.broadcastIframeEvent(22,e)})),tE.on(XS.PEER_CLOSED,(e=>{this.broadcastIframeEvent(23,e)})),tE.on(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){this.broadcastIframeEvent(25,e)})))),tE.on(XS.SET_WEBINAR_STAGE_STATUS,(e=>{this.broadcastIframeEvent(25,e)})),void tE.on(XS.UPDATE_PEER_STAGE_STATUS,(e=>{this.broadcastIframeEvent(26,e)}));tE.on(XS.ENABLE_PLUGIN,(e=>tr(this,[e],(function*({id:e,enabledBy:t}){yield this.enablePlugin({id:e,enabledBy:t})})))),tE.on(XS.DISABLE_PLUGIN,(e=>tr(this,[e],(function*({id:e}){yield this.disablePlugin({id:e})})))),[XS.PLUGIN_DATA,XS.PLUGIN_EVENT].forEach((e=>{tE.on(e,(t=>{this.sendIframeEventOld(e,t)}))})),[XS.PEER_JOINED,XS.PEER_CLOSED,XS.NEW_CHAT_MESSAGE].forEach((e=>{tE.on(e,(t=>{this.broadcastIframeEventOld(e,t)}))}))}},vM=new WeakMap,yM=new WeakMap,_M=new WeakMap,SM=new WeakSet,EM=function(){return _C()},TM);let CM=RM;kM([VS.trace("PluginController.getRoomPlugins")],CM.prototype,"getRoomPlugins",1),kM([VS.trace("PluginController.enableForSelf")],CM.prototype,"enablePlugin",1),kM([VS.trace("PluginController.disableForSelf")],CM.prototype,"disablePlugin",1),kM([VS.trace("PluginController.setupEvents")],CM.prototype,"setupEvents",1);var AM,IM,PM,DM,MM,OM;Object.defineProperty,Object.getOwnPropertyDescriptor;let NM=(OM=class extends HS{constructor(e,t,r){super(),Xt(this,AM),Kt(this,"items"),Xt(this,PM,void 0),Xt(this,DM,void 0),Xt(this,MM,void 0),Zt(this,PM,e),Zt(this,DM,t),Zt(this,MM,r),this.items=[]}get roomJoined(){var e;return!0===(null==(e=Qt(this,AM,IM))?void 0:e.roomJoined)}create(e,t,r=!1,i=!1){return tr(this,null,(function*(){if("LIVESTREAM"!==Qt(this,PM).config.viewType&&!this.roomJoined)throw new qS("Can't create polls without joining room");if(!Qt(this,PM).permissions.polls.canCreate)return void BS.error("DytePolls::create::permission_denied");if(!e||!t)return void BS.error("DytePolls::question_and_options_can_not_be_empty",{dytePolls:{hasQuestion:!!e,optionsLength:null==t?void 0:t.length}});if(t.length<2)return void BS.error("DytePolls::there_must_be_at_least_two_options",{dytePolls:{hasQuestion:!!e,optionsLength:t.length}});if("socket-service"===Qt(this,MM))return void(yield Qt(this,DM).createPoll(e,t,r,i));const n={question:e,options:t,anonymous:r,hideVotes:i,createdBy:Qt(this,PM).name,createdByUserId:Qt(this,PM).userId};yield Qt(this,AM,IM).newPoll(n)}))}vote(e,t){return tr(this,null,(function*(){if(!Qt(this,PM).permissions.polls.canVote)return void BS.error("DytePolls::vote::permission_denied");if("socket-service"===Qt(this,MM))return void(yield Qt(this,DM).votePoll(e,t));const r={pollId:e,index:t};yield Qt(this,AM,IM).votePoll(r)}))}},AM=new WeakSet,IM=function(){return _C()},PM=new WeakMap,DM=new WeakMap,MM=new WeakMap,OM);NM=((e,t,r,i)=>{for(var n,s=t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(s)||s);return s})([KS((e=>{throw new qS(e.message,"0700")}))],NM);var xM,LM,jM,UM,FM,VM,BM=Object.defineProperty,WM=Object.getOwnPropertyDescriptor;const HM=(VM=class{constructor(e,t,r){Xt(this,UM),Kt(this,"polls"),Xt(this,xM,void 0),Xt(this,LM,void 0),Xt(this,jM,void 0),this.polls=new NM(e,t,r),Zt(this,xM,e),Zt(this,LM,t),Zt(this,jM,r),this.setupEvents()}static init(e,t,r){return tr(this,null,(function*(){const i=kw(e.config.viewType,r)?"socket-service":"room-node";return BS.info(`Using socket server ${i} for polls`),new HM(e,t,i)}))}canViewPolls(){return Qt(this,xM).permissions.polls.canView}setupEvents(){if(tE.on(XS.UPDATE_PERMISSIONS,(e=>{var t;null!=(t=e.polls)&&t.canView&&this.getPolls()})),"socket-service"===Qt(this,jM)){if(!this.canViewPolls())return;tE.on(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>{this.getPolls()})),Qt(this,LM).on(Qw.createPoll,(e=>{e.poll&&this.updatePoll(HM.formatSocketServicePoll(e.poll))})),Qt(this,LM).on(Qw.updatePoll,(e=>{e.poll&&this.updatePoll(HM.formatSocketServicePoll(e.poll))})),Qt(this,LM).on(Qw.votePoll,(e=>{e.poll&&this.updatePoll(HM.formatSocketServicePoll(e.poll))}))}else tE.onAsync(XS.ROOM_JOINED,(()=>tr(this,null,(function*(){this.canViewPolls()&&this.getPolls()}))));tE.on(XS.UPDATE_POLL,(e=>tr(this,[e],(function*({poll:e}){this.updatePoll(e)}))))}updatePoll(e){if(!this.canViewPolls())return;const t=this.polls.items.findIndex((t=>t.id===e.id));if(t>-1){const r=JSON.stringify(this.polls.items[t]);return this.polls.items[t]=e,void(r!==JSON.stringify(e)&&this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!1}))}this.polls.items=[...this.polls.items,e],this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!0})}getPolls(){return tr(this,null,(function*(){if("socket-service"!==Qt(this,jM)){if(Qt(this,UM,FM)instanceof fC){const{polls:e}=(yield Qt(this,UM,FM).getPolls()).payload;this.polls.items=Object.values(e)}}else{const e=yield Qt(this,LM).getPolls();if(null==e||!e.payload)return;const{polls:t}=pw.fromBinary(e.payload);this.polls.items=t.map((e=>HM.formatSocketServicePoll(e)))}}))}static formatSocketServicePoll(e){const t=e.options.map((e=>({count:e.count,text:e.text,votes:e.votes.map((e=>({id:e.userId,name:e.name})))})));return{anonymous:e.anonymous,createdBy:e.createdBy,createdByUserId:e.createdByUserId,hideVotes:e.hideVotes,id:e.pollId,options:t,question:e.question,voted:e.votes}}},xM=new WeakMap,LM=new WeakMap,jM=new WeakMap,UM=new WeakSet,FM=function(){return _C()},VM);let GM=HM;((e,t,r,i)=>{for(var n,s=WM(t,r),o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(t,r,s)||s);s&&BM(t,r,s)})([VS.trace("PollController.setupEvents")],GM.prototype,"setupEvents");class $M extends aP{constructor(){super({onAddEvent:"remoteRequestAdd",onDeleteEvent:"remoteRequestRemove"})}add(e,t=!0){return super.add(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}var qM,zM,JM,KM;const YM=class extends HS{constructor(e,t){super(),Xt(this,qM),Kt(this,"incomingRequests"),Kt(this,"outgoingRequests"),Kt(this,"active"),Xt(this,JM,void 0),Xt(this,KM,void 0),Zt(this,KM,t),Zt(this,JM,e),this.incomingRequests=new $M,this.outgoingRequests=new $M,this.active=null,this.mouseEvent=this.mouseEvent.bind(this),this.keyboardEvent=this.keyboardEvent.bind(this)}requestControl(e){return tr(this,null,(function*(){var t;if(!Qt(this,KM).joined.get(e))throw new qS("Invalid peer.");const r=null==(t=this.outgoingRequests)?void 0:t.toArray().find((t=>t.hostPeerId===e));if(r)return r.id;const i=u(),n=new iC({requestId:i,hostPeerId:e,remotePeerId:Qt(this,JM).id,state:ZR.PENDING});return this.outgoingRequests.add(n),yield Qt(this,qM,zM).requestRemoteControl(n),this.emit("remoteUpdate",{payload:{request:{id:n.id,hostPeerId:n.hostPeerId,remotePeerId:n.remotePeerId}},type:rC.REQUEST_SENT}),i}))}acceptControl(e){return tr(this,null,(function*(){var t;if((null==(t=this.active)?void 0:t.id)===e)return;const r=this.incomingRequests.get(e);if(!r)throw new qS("No request found.");r.state=ZR.ACCEPTED,this.endControl(),this.active=r,Qt(this,qM,zM).acceptRemoteControl(r),this.emit("remoteUpdate",{payload:{request:{id:this.active.id,hostPeerId:this.active.hostPeerId,remotePeerId:this.active.remotePeerId}},type:rC.INCOMING_REQUEST_ACCEPTED})}))}endControl(){return tr(this,null,(function*(){if(!this.active)return;const e=qt({},this.active);Qt(this,qM,zM).terminateRemoteControl(this.active.hostPeerId===Qt(this,JM).id?this.active.remotePeerId:this.active.hostPeerId,this.active),this.active=null,this.emit("remoteUpdate",{payload:{request:{id:e.id,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:e.hostPeerId===Qt(this,JM).id?rC.INCOMING_REQUEST_ENDED:rC.OUTGOING_REQUEST_ENDED})}))}keyboardEvent(e){return tr(this,null,(function*(){if(!this.active)return;const t=YM.getFormattedKeyboardEvent(e);if(t){const e={eventType:eC.KEYBOARD,keyboardEvent:t};Qt(this,qM,zM).sendEventRemoteControl(this.active.hostPeerId,this.active.id,e)}}))}mouseEvent(e,t){return tr(this,null,(function*(){if(!this.active)return;const r=YM.getFormattedRemoteMouseEvent(e,t);if(r){const e={eventType:eC.MOUSE,mouseEvent:r};Qt(this,qM,zM).sendEventRemoteControl(this.active.hostPeerId,this.active.id,e)}}))}static getFormattedRemoteMouseEvent(e,t){const r=t.getBoundingClientRect();return{type:e.type,position:{x:Math.floor(e.x-r.left),y:Math.floor(e.y-r.top)},boundingRect:{width:r.width,height:r.height}}}static getFormattedKeyboardEvent(e){return"keydown"===e.type?{type:e.type,key:e.key}:null}};let QM=YM;var XM,ZM;qM=new WeakSet,zM=function(){return _C()},JM=new WeakMap,KM=new WeakMap;const eO=class{constructor(e,t){Kt(this,"remote"),Kt(this,"hostPeetId"),Kt(this,"remotePeetId"),Kt(this,"remoteRequestTokens"),Kt(this,"activeRemoteToken"),Xt(this,XM,void 0),Xt(this,ZM,void 0),Zt(this,XM,e),Zt(this,ZM,t),this.hostPeetId=e.id,this.remote=new QM(e,t),this.setupEvents()}setupEvents(){tE.on(XS.MESSAGE,(e=>{var t;if(e.remoteRequestType===XR.REQUEST&&(this.remote.incomingRequests.add(new iC({requestId:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,state:ZR.PENDING})),this.remote.emit("remoteUpdate",{payload:{request:{id:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:rC.REQUEST_RECEIVED})),e.remoteRequestType===XR.ACCEPT){const t=this.remote.outgoingRequests.get(e.remoteRequestId);if(!t)throw new qS("There is no pending remote control request to accept.");this.remote.endControl(),t.state=ZR.ACCEPTED,this.remote.active=new iC({requestId:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,state:ZR.ACCEPTED}),this.remote.emit("remoteUpdate",{payload:{request:{id:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:rC.OUTGOING_REQUEST_ACCEPTED})}e.remoteRequestType===XR.END&&((null==(t=this.remote.active)?void 0:t.id)===e.remoteRequestId&&(this.remote.active=null),this.remote.emit("remoteUpdate",{payload:{request:{id:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:e.hostPeerId===Qt(this,XM).id?rC.INCOMING_REQUEST_ENDED:rC.OUTGOING_REQUEST_ENDED})),e.remoteRequestType===XR.EVENT&&this.remote.active&&this.remote.active.id===e.remoteRequestId&&window.DyteRobot&&(e.remoteEvent.eventType===eC.MOUSE?eO.executeMouseEvent(e.remoteEvent.mouseEvent):e.remoteEvent.eventType===eC.KEYBOARD&&eO.executeKeyboardEvent(e.remoteEvent.keyboardEvent))})),tE.on(XS.PEER_CLOSED,(({id:e})=>{var t,r,i,n,s,o,a,c;[null==(r=null==(t=this.remote)?void 0:t.active)?void 0:r.hostPeerId,null==(n=null==(i=this.remote)?void 0:i.active)?void 0:n.remotePeerId].includes(e)&&this.remote.endControl(),null==(o=null==(s=this.remote)?void 0:s.incomingRequests)||o.toArray().forEach((t=>{[t.hostPeerId,t.remotePeerId].includes(e)&&this.remote.incomingRequests.delete(t.id)})),null==(c=null==(a=this.remote)?void 0:a.outgoingRequests)||c.toArray().forEach((t=>{[t.hostPeerId,t.remotePeerId].includes(e)&&this.remote.outgoingRequests.delete(t.id)}))}))}static executeMouseEvent(e){const t=window.screen.width*e.position.x/e.boundingRect.width,r=window.screen.height*e.position.y/e.boundingRect.height,i={width:window.screen.width,height:window.screen.height};switch(e.type){case tC.LEFT_CLICK:window.DyteRobot.mouse.leftClick(t,r,i);break;case tC.RIGHT_CLICK:window.DyteRobot.mouse.rightClick(t,r,i);break;case tC.MOVE:window.DyteRobot.mouse.moveTo(t,r,i)}}static executeKeyboardEvent(e){"keydown"===e.type&&window.DyteRobot.keyboard.press(e.key)}};let tO=eO;XM=new WeakMap,ZM=new WeakMap;var rO,iO,nO,sO,oO,aO,cO,dO,lO,uO,pO,hO,mO,fO,gO,vO,yO,_O,SO,EO,TO,bO,wO,kO,RO,CO,AO,IO,PO,DO,MO,OO,NO=Object.defineProperty,xO=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},LO=(e,t,r)=>(xO(e,t,"read from private field"),r?r.call(e):t.get(e)),jO=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},UO=(e,t,r,i)=>(xO(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),FO=(e,t,r)=>(xO(e,t,"access private method"),r),VO={exports:{}},BO="object"==typeof Reflect?Reflect:null,WO=BO&&"function"==typeof BO.apply?BO.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};OO=BO&&"function"==typeof BO.ownKeys?BO.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var HO=Number.isNaN||function(e){return e!=e};function GO(){GO.init.call(this)}VO.exports=GO,VO.exports.once=function(e,t){return new Promise((function(r,i){function n(r){e.removeListener(t,s),i(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}eN(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&eN(e,"error",t,{once:!0})}(e,n)}))},GO.EventEmitter=GO,GO.prototype._events=void 0,GO.prototype._eventsCount=0,GO.prototype._maxListeners=void 0;var $O=10;function qO(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function zO(e){return void 0===e._maxListeners?GO.defaultMaxListeners:e._maxListeners}function JO(e,t,r,i){var n,s,o;if(qO(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),(n=zO(e))>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,function(e){console&&console.warn&&console.warn(e)}(a)}return e}function KO(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function YO(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=KO.bind(i);return n.listener=r,i.wrapFn=n,n}function QO(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):ZO(n,n.length)}function XO(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function ZO(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function eN(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){i.once&&e.removeEventListener(t,n),r(s)}))}}Object.defineProperty(GO,"defaultMaxListeners",{enumerable:!0,get:function(){return $O},set:function(e){if("number"!=typeof e||e<0||HO(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");$O=e}}),GO.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},GO.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||HO(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},GO.prototype.getMaxListeners=function(){return zO(this)},GO.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=n[e];if(void 0===a)return!1;if("function"==typeof a)WO(a,this,t);else{var c=a.length,d=ZO(a,c);for(r=0;r<c;++r)WO(d[r],this,t)}return!0},GO.prototype.addListener=function(e,t){return JO(this,e,t,!1)},GO.prototype.on=GO.prototype.addListener,GO.prototype.prependListener=function(e,t){return JO(this,e,t,!0)},GO.prototype.once=function(e,t){return qO(t),this.on(e,YO(this,e,t)),this},GO.prototype.prependOnceListener=function(e,t){return qO(t),this.prependListener(e,YO(this,e,t)),this},GO.prototype.removeListener=function(e,t){var r,i,n,s,o;if(qO(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},GO.prototype.off=GO.prototype.removeListener,GO.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},GO.prototype.listeners=function(e){return QO(this,e,!0)},GO.prototype.rawListeners=function(e){return QO(this,e,!1)},GO.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):XO.call(e,t)},GO.prototype.listenerCount=XO,GO.prototype.eventNames=function(){return this._eventsCount>0?OO(this._events):[]};var tN=VO.exports;const rN=new class extends me{constructor(){super("message.v1.SocketMessage",[{no:1,name:"event",kind:"scalar",T:13},{no:2,name:"id",kind:"scalar",opt:!0,T:9},{no:3,name:"payload",kind:"scalar",opt:!0,T:12},{no:4,name:"metadata",kind:"scalar",opt:!0,T:12}])}};class iN{static encode(e){return rN.toBinary(e)}static decode(e){return rN.fromBinary(new Uint8Array(e))}}class nN{constructor(e={}){((e,t,r)=>{((e,t,r)=>{t in e?NO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r)})(this,"opts"),jO(this,rO,void 0),this.opts={initialTimeout:e.initialTimeout||1e3,maxTimeout:e.maxTimeout||1e4,factor:e.factor||2},UO(this,rO,0)}wait(){return tr(this,null,(function*(){UO(this,rO,LO(this,rO)+1);const e=function(e,t){return Math.floor(Math.random()*(t-0+1)+0)}(0,Math.min(this.opts.maxTimeout,this.opts.initialTimeout*Gt(2,LO(this,rO))));yield new Promise((t=>{setTimeout(t,e)}))}))}getAttempts(){return LO(this,rO)}reset(){UO(this,rO,0)}}rO=new WeakMap;const sN={debug:0,info:1,warn:2,error:3};class oN{constructor(e){jO(this,iO,void 0),jO(this,nO,void 0),UO(this,iO,console),UO(this,nO,e)}debug(...e){sN[LO(this,nO)]>sN.debug||LO(this,iO).debug("[Sockrates]:",...e)}info(...e){sN[LO(this,nO)]>sN.info||LO(this,iO).info("[Sockrates]:",...e)}warn(...e){sN[LO(this,nO)]>sN.warn||LO(this,iO).warn("[Sockrates]:",...e)}error(...e){sN[LO(this,nO)]>sN.error||LO(this,iO).error("[Sockrates]:",...e)}}iO=new WeakMap,nO=new WeakMap;var aN=(e=>(e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED",e))(aN||{});class cN{constructor(e,t){var r,i,n,s,o,a,c,d,l,u;jO(this,fO),jO(this,vO),jO(this,_O),jO(this,EO),jO(this,bO),jO(this,kO),jO(this,CO),jO(this,IO),jO(this,DO),jO(this,sO,void 0),jO(this,oO,void 0),jO(this,aO,void 0),jO(this,cO,void 0),jO(this,dO,void 0),jO(this,lO,void 0),jO(this,uO,void 0),jO(this,pO,void 0),jO(this,hO,void 0),jO(this,mO,void 0),UO(this,oO,e),UO(this,dO,[]),UO(this,lO,new tN),UO(this,uO,!0),UO(this,pO,!1),UO(this,aO,null!=t?t:{}),null!=(r=LO(this,aO)).autoReconnect||(r.autoReconnect=!0),null!=(i=LO(this,aO)).retryConnectionInterval||(i.retryConnectionInterval=1e3),null!=(n=LO(this,aO)).pingTimeout||(n.pingTimeout=3e4),null!=(s=LO(this,aO)).connectionTimeout||(s.connectionTimeout=5e3),null!=(o=LO(this,aO)).debug||(o.debug=!0),null!=(a=LO(this,aO)).maxReconnectionAttempts||(a.maxReconnectionAttempts=10),null!=(c=LO(this,aO)).disconnectOnPingTimeout||(c.disconnectOnPingTimeout=!0),null!=(d=LO(this,aO)).queueOnDisconnect||(d.queueOnDisconnect=!1),null!=(l=LO(this,aO)).flushOnReconnect||(l.flushOnReconnect=!1),UO(this,cO,null!=(u=LO(this,aO).logger)?u:new oN(LO(this,aO).debug?"debug":"info")),UO(this,mO,new nN)}get readyState(){var e;return null==(e=LO(this,sO))?void 0:e.readyState}get url(){return LO(this,oO)}get config(){return LO(this,aO)}get sendQueue(){return LO(this,dO)}flush(){if(!LO(this,aO).queueOnDisconnect)return!1;const e=[];return LO(this,dO).forEach((t=>{this.send(t.event,t.id,t.payload,t.metadata)||e.push(t)})),UO(this,dO,e),LO(this,dO)}connect(e=!1){return tr(this,null,(function*(){if(e||![0,1].includes(this.readyState))return!1!==LO(this,uO)?new Promise(((e,t)=>{FO(this,IO,PO).call(this),FO(this,DO,MO).call(this);try{UO(this,sO,new WebSocket(FO(this,fO,gO).call(this,LO(this,oO)))),LO(this,sO).binaryType="arraybuffer",LO(this,cO).debug("Connecting to",LO(this,oO));const r=setTimeout((()=>{LO(this,cO).debug("Connection timeout. Closing socket"),UO(this,uO,!0),FO(this,DO,MO).call(this),LO(this,sO).close(3001,"Connection Timeout"),LO(this,aO).autoReconnect&&!LO(this,pO)&&(LO(this,lO).emit("reconnecting"),FO(this,bO,wO).call(this)),t(new Error("Connection timed out!"))}),LO(this,aO).connectionTimeout);LO(this,sO).onopen=()=>{LO(this,cO).debug(`Ready State: ${aN[LO(this,sO).readyState]}`),r&&clearTimeout(r),FO(this,CO,AO).call(this),LO(this,lO).emit("connected"),LO(this,aO).flushOnReconnect&&this.flush(),e()},LO(this,sO).onclose=e=>{try{r&&clearTimeout(r);const{code:i,reason:n}=e;if(t(n),LO(this,cO).debug("Socket closed. Close event:",e),LO(this,cO).debug("Connection closed code:",i),LO(this,cO).debug("Connection closed reason:",n),LO(this,pO)||LO(this,lO).emit("disconnected",{code:i,reason:n}),LO(this,uO)&&1e3!==i&&LO(this,aO).autoReconnect&&!LO(this,pO))return LO(this,lO).emit("reconnecting"),void FO(this,bO,wO).call(this)}catch(e){FO(this,vO,yO).call(this,e)}},LO(this,sO).onerror=e=>{FO(this,vO,yO).call(this,e)},LO(this,sO).onmessage=e=>FO(this,_O,SO).call(this,e)}catch(e){FO(this,vO,yO).call(this,e,t)}})):void 0;LO(this,cO).debug("Websocket was already connecting or connected.")}))}send(e,t,r,i){const n={event:e,id:t,payload:r,metadata:i};if(LO(this,aO).queueOnDisconnect&&(!LO(this,sO)||1!==LO(this,sO).readyState))return LO(this,cO).debug("Queuing message since socket is not connected!",n),LO(this,dO).push(n),!1;const s=iN.encode(n);return FO(this,kO,RO).call(this,s)}emit(e,t,r,i){return this.send(e,t,r,i)}sendRaw(e){return FO(this,kO,RO).call(this,e)}receive(e,t){return LO(this,lO).on(e.toString(),t)}on(e,t){"string"!=typeof e||"connected"!==e&&"disconnected"!==e&&"errored"!==e&&"reconnected"!==e&&"reconnecting"!==e&&"reconnectAttempt"!==e&&"reconnectFailure"!==e&&"failed"!==e?this.receive(e,t):LO(this,lO).on(e,t)}removeAllListeners(){LO(this,lO).removeAllListeners()}removeReceiver(e,t){this.removeListener(e,t)}removeListener(e,t){LO(this,lO).removeListener(e.toString(),t)}removeReceivers(e){this.removeListeners(e)}removeListeners(e){LO(this,lO).listeners(e.toString()).map((t=>this.removeListener(e,t)))}disconnect(){UO(this,uO,!1),FO(this,IO,PO).call(this),this.removeAllListeners(),LO(this,sO).close(1e3,"Sockrates disconnect method called.")}}sO=new WeakMap,oO=new WeakMap,aO=new WeakMap,cO=new WeakMap,dO=new WeakMap,lO=new WeakMap,uO=new WeakMap,pO=new WeakMap,hO=new WeakMap,mO=new WeakMap,fO=new WeakSet,gO=function(e){if(e.startsWith("ws://")||e.startsWith("wss://"))return e;if(e.startsWith("https://"))return`wss://${e.substring(8)}`;if(e.startsWith("http://"))return`ws://${e.substring(7)}`;throw new Error("Invalid URL. URL must start with http(s):// or ws(s)://.")},vO=new WeakSet,yO=function(e,t){LO(this,cO).error("Error:",e),LO(this,lO).emit("errored",{error:e}),null==t||t(e)},_O=new WeakSet,SO=function(e){if("2"===e.data)return LO(this,cO).debug("Received ping from server"),FO(this,CO,AO).call(this),void FO(this,kO,RO).call(this,"3");LO(this,cO).debug("Received data:",e.data);const t=iN.decode(e.data),{id:r,payload:i}=t;LO(this,lO).emit(t.event.toString(),{id:r,payload:i})},EO=new WeakSet,TO=function(){return 1===LO(this,sO).readyState},bO=new WeakSet,wO=function(e=!0){return tr(this,null,(function*(){if(e&&LO(this,pO))LO(this,cO).debug("Reconnect called when already in a reconnect loop. Ignoring.");else{if(LO(this,pO)||LO(this,mO).reset(),null!==LO(this,aO).maxReconnectionAttempts&&LO(this,mO).getAttempts()>=LO(this,aO).maxReconnectionAttempts)return LO(this,lO).emit("failed"),void UO(this,pO,!1);UO(this,pO,!0),FO(this,DO,MO).call(this),FO(this,IO,PO).call(this);try{if(yield LO(this,mO).wait(),!1===LO(this,uO))return;if(LO(this,cO).debug(`Reconnection attempt ${LO(this,mO).getAttempts()}`),LO(this,lO).emit("reconnectAttempt",{attempt:LO(this,mO).getAttempts()}),yield this.connect(),!FO(this,EO,TO).call(this))throw Error("Reconnect Failed");UO(this,pO,!1),LO(this,lO).emit("reconnected")}catch(e){LO(this,cO).debug("Failed to reconnect."),LO(this,lO).emit("reconnectFailure",{attempt:LO(this,mO).getAttempts()}),FO(this,bO,wO).call(this,!1)}}}))},kO=new WeakSet,RO=function(e){try{return LO(this,sO).send(e),!0}catch(e){return LO(this,cO).error(e.message),!1}},CO=new WeakSet,AO=function(){this.config.disconnectOnPingTimeout&&(LO(this,cO).debug("Resetting ping timeout"),FO(this,IO,PO).call(this),UO(this,hO,setTimeout((()=>{var e;LO(this,cO).debug("Disconnecting the socket due to ping timeout"),UO(this,uO,!0);const t="Ping timeout";null==(e=LO(this,sO))||e.close(3002,t),LO(this,lO).emit("disconnected",{code:3002,reason:t}),LO(this,aO).autoReconnect&&!LO(this,pO)&&(LO(this,cO).debug("Triggering reconnection due to ping timeout"),LO(this,lO).emit("reconnecting"),FO(this,bO,wO).call(this))}),LO(this,aO).pingTimeout)))},IO=new WeakSet,PO=function(){LO(this,hO)&&(clearTimeout(LO(this,hO)),UO(this,hO,void 0))},DO=new WeakSet,MO=function(){LO(this,sO)&&(LO(this,sO).onopen=void 0,LO(this,sO).onerror=void 0,LO(this,sO).onmessage=void 0,LO(this,sO).onclose=void 0)};var dN,lN,uN,pN,hN,mN,fN=Object.defineProperty,gN=Object.getOwnPropertyDescriptor,vN=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?gN(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&fN(t,r,s),s};const yN=(mN=class{constructor({peerId:e,roomName:t,authToken:r,capabilities:i}){var n;if(Xt(this,pN),Xt(this,dN,void 0),Xt(this,lN,void 0),Xt(this,uN,void 0),Kt(this,"roomName"),Kt(this,"peerId"),Kt(this,"authToken"),Kt(this,"capabilities"),!e||!t||!r)throw new qS("peerId, roomName, or authToken can not be empty");const{apiBase:s,baseURI:o}=td;let a=yN.getSocketEdgeDomain(s,o);"string"==typeof Tw("socket_server_base")&&(a=Tw("socket_server_base"));const c=`wss://${a}`;this.roomName=t,this.peerId=e,this.authToken=r,this.capabilities=i;const d=new URL(`${c}/ws`),l={roomID:t,peerID:e,authToken:r,useMediaV2:i.includes("HIVE"),ping:i.includes("PING"),capabilities:i.map((e=>JT[e])).join(" ")};Object.entries(l).forEach((([e,t])=>{d.searchParams.append(e,t.toString())})),Zt(this,dN,d.href),Zt(this,uN,e),Zt(this,lN,new cN(Qt(this,dN),{autoReconnect:!0,disconnectOnPingTimeout:null!=(n=i.includes("PING"))&&n,queueOnDisconnect:!0,flushOnReconnect:!1,logger:BS}))}static getSocketEdgeDomain(e,t){return sd({servicePrefix:"socket-edge",apiBase:e,baseURI:t})}get url(){return Qt(this,dN)}connect(){return tr(this,null,(function*(){this.onStateEvent("connected",(()=>{BS.info("SocketService::connect::Connected to socket-edge"),tE.emit(XS.SOCKET_SERVICE_CONNECTED)})),this.onStateEvent("disconnected",(({reason:e,code:t})=>{BS.info("SocketService::connect::Disconnected from socket-edge",{error:{code:t,reason:e}}),tE.emit(XS.SOCKET_SERVICE_DISCONNECTED),!(t<4e3||t>4002)&&(4e3===t?BS.error("SocketService::connect::Bad Request",{error:{code:t,reason:e}}):4001===t?BS.error("SocketService::connect::Unauthorized",{error:{code:t,reason:e}}):4002===t?BS.error("SocketService::connect::Internal Error",{error:{code:t,reason:e}}):BS.error("SocketService::connect::Unknown Error",{error:{code:t,reason:e}}))})),this.onStateEvent("reconnecting",(()=>{BS.info("SocketService::connect::Reconnecting to socket-edge"),tE.emit(XS.SOCKET_SERVICE_RECONNECTING)})),this.onStateEvent("reconnectAttempt",(({attempt:e})=>{BS.info("SocketService::connect::Attempting reconnect to socket-edge"),tE.emit(XS.SOCKET_SERVICE_RECONNECTION_ATTEMPT,{attempt:e})})),this.onStateEvent("reconnectFailure",(({attempt:e})=>{BS.info("SocketService::connect::Reconnect attempt failed"),tE.emit(XS.SOCKET_SERVICE_RECONNECT_FAILURE,{attempt:e})})),this.onStateEvent("reconnected",(()=>{BS.info("SocketService::connect::Reconnected to socket-edge"),tE.emit(XS.SOCKET_SERVICE_RECONNECTED)})),this.onStateEvent("failed",(()=>{BS.info("SocketService::connect::Socket-edge reconnects failed"),tE.emit(XS.SOCKET_SERVICE_FAILED)})),yield Qt(this,lN).connect()}))}disconnect(){return Qt(this,lN).disconnect()}get isConnected(){try{return 1===Qt(this,lN).readyState}catch(e){return!1}}sendMessage(e,t,r){const i={};return VS.injectContext(i),Qt(this,lN).send(e,null!=r?r:er(this,pN,hN).call(this),t,(new TextEncoder).encode(JSON.stringify(i)))}sendMessagePromise(e,t,r){const i=parseInt({}.SOCKET_SERVICE_MESSAGE_REQUEST_TIMEOUT,10)||2e4;return this.sendMessagePromiseWithTimeout({event:e,timeout:i,protobuf:t,messageId:r})}sendMessagePromiseWithTimeout({event:e,timeout:t,protobuf:r,messageId:i}){return new Promise(((n,s)=>{const o=(t,r)=>{Qt(this,lN).removeListener(e,t),Qt(this,lN).removeListener(65535,r),Qt(this,lN).removeListener(Zw.errorResponse,r)},a=null!=i?i:er(this,pN,hN).call(this),c={};VS.injectContext(c);const d=({id:e,payload:t})=>{if(a===e){let e;try{const r=jE.fromBinary(t);e=new Error(r.errorMessage)}catch(r){e=new Error("failed to parse error message",{cause:r});try{const r=oT.fromBinary(t);e=new Error(r.message)}catch(t){e=new Error("failed to parse error message",{cause:t})}}s(e),o(l,d)}},l=({id:e,payload:t})=>{a===e&&(n({id:e,payload:t}),o(l,d))};Qt(this,lN).on(e,l),Qt(this,lN).on(65535,d),Qt(this,lN).on(Zw.errorResponse,d),setTimeout((()=>{o(l,d),s(new Error("request timeout for callback"))}),t),Qt(this,lN).send(e,a,r,(new TextEncoder).encode(JSON.stringify(c)))}))}on(e,t){Qt(this,lN).on(e,t)}onStateEvent(e,t){Qt(this,lN).on(e,t)}flush(){return Qt(this,lN).flush()}},dN=new WeakMap,lN=new WeakMap,uN=new WeakMap,pN=new WeakSet,hN=function(){return`${Qt(this,uN)}-${(Math.random()+1).toString(36).substring(7)}`},mN);let _N=yN;var SN;vN([VS.trace("SocketService.connect")],_N.prototype,"connect",1),vN([VS.trace("SocketService.disconnect")],_N.prototype,"disconnect",1),vN([VS.trace("SocketService.sendMessagePromise")],_N.prototype,"sendMessagePromise",1),vN([VS.trace("SocketService.sendMessagePromiseWithTimeout")],_N.prototype,"sendMessagePromiseWithTimeout",1);class EN{constructor(e){Xt(this,SN,void 0),Zt(this,SN,e)}addPlugin(e,t){Qt(this,SN).sendMessage(Yw.addPlugin,Nb.toBinary({pluginId:e,staggered:t}))}removePlugin(e){Qt(this,SN).sendMessage(Yw.removePlugin,xb.toBinary({pluginId:e,staggered:!1}))}getActivePlugins(){return tr(this,null,(function*(){const{payload:e}=yield Qt(this,SN).sendMessagePromise(Yw.getPlugins);return e?Jb.fromBinary(e):{plugins:[]}}))}customPluginEventToRoom(e,t,r){const i={pluginId:e,pluginData:(new TextEncoder).encode(JSON.stringify(t))};Qt(this,SN).sendMessage(Yw.customPluginEventToRoom,Vb.toBinary(i),r)}customPluginEventToPeers(e,t,r,i){const n={pluginId:e,peerIds:t,pluginData:(new TextEncoder).encode(JSON.stringify(r))};Qt(this,SN).sendMessage(Yw.customPluginEventToPeers,Bb.toBinary(n),i)}enablePluginForRoom(e,t){Qt(this,SN).sendMessage(Yw.enablePluginForRoom,Lb.toBinary({pluginId:e}),t)}enablePluginForPeers(e,t,r){Qt(this,SN).sendMessage(Yw.enablePluginForPeers,Ub.toBinary({pluginId:e,peerIds:t}),r)}disablePluginForRoom(e,t){Qt(this,SN).sendMessage(Yw.disablePluginForRoom,jb.toBinary({pluginId:e}),t)}disablePluginForPeers(e,t,r){Qt(this,SN).sendMessage(Yw.disablePluginForPeers,Fb.toBinary({pluginId:e,peerIds:t}),r)}storeInsertKeys(e,t,r,i){const n={pluginId:e,storeName:t,insertKeys:r.map((e=>({storeKey:e.key,payload:(new TextEncoder).encode(JSON.stringify(e.payload))})))};Qt(this,SN).sendMessage(Yw.storeInsertKeys,Hb.toBinary(n),i)}storeGetKeys(e,t,r,i){const n={pluginId:e,storeName:t,getKeys:r.map((e=>({storeKey:e.key})))};Qt(this,SN).sendMessage(Yw.storeGetKeys,Gb.toBinary(n),i)}storeDeleteKeys(e,t,r,i){const n={pluginId:e,storeName:t,deleteKeys:r.map((e=>({storeKey:e.key})))};Qt(this,SN).sendMessage(Yw.storeDeleteKeys,$b.toBinary(n),i)}storeDelete(e,t,r){Qt(this,SN).sendMessage(Yw.storeDelete,qb.toBinary({pluginId:e,storeName:t}),r)}getPluginDataOld(e,t){BS.info("getPluginDataOld",{plugin:{id:e,storeName:t}})}storePluginDataOld(e,t,r){const i={pluginId:e,storeName:t,insertKeys:[{storeKey:r.key,payload:(new TextEncoder).encode(JSON.stringify(r))}]};Qt(this,SN).sendMessage(Yw.storeInsertKeys,Hb.toBinary(i))}on(e,t){let r;switch(e){case Yw.addPlugin:case Yw.enablePluginForPeers:case Yw.enablePluginForRoom:r=zb.fromBinary.bind(zb);break;case Yw.removePlugin:case Yw.disablePluginForPeers:case Yw.disablePluginForRoom:r=Kb.fromBinary.bind(Kb);break;case Yw.customPluginEventToPeers:case Yw.customPluginEventToRoom:r=Xb.fromBinary.bind(Xb);break;case Yw.storeInsertKeys:case Yw.storeGetKeys:case Yw.storeDeleteKeys:case Yw.storeDelete:r=Qb.fromBinary.bind(Qb)}Qt(this,SN).on(e,(({payload:e,id:i})=>{const n=r(e);return t(n,i)}))}}SN=new WeakMap;var TN,bN,wN,kN,RN=Object.defineProperty,CN=Object.getOwnPropertyDescriptor,AN=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?CN(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&RN(t,r,s),s};let IN=(kN=class extends HS{constructor(e){super(),Xt(this,bN),Xt(this,TN,void 0),Kt(this,"recordingPeerIds",[]),Kt(this,"recordings",[]),Zt(this,TN,e)}get recordingState(){return this.recordings.some((e=>"RECORDING"===e.state))?"RECORDING":this.recordings.some((e=>"PAUSED"===e.state))?"PAUSED":this.recordings.some((e=>"STARTING"===e.state))?"STARTING":this.recordings.some((e=>"STOPPING"===e.state))?"STOPPING":"IDLE"}updateRecordings(e){this.recordings=e,this.emit("recordingUpdate",this.recordingState)}start(e){return tr(this,null,(function*(){if(!Qt(this,TN).permissions.canRecord)throw BS.error("DyteRecording::start::permission_denied"),new qS("User does not have permission to start recording");if(!0!==(null==e?void 0:e.allowMultiple)&&("STARTING"===this.recordingState||"RECORDING"===this.recordingState||"STOPPING"===this.recordingState))throw BS.error("DyteRecording::start::recording_in_progress",{recording:{state:this.recordingState}}),new qS(`Cant start recording, recordingState irregular: ${this.recordingState}`);try{const t=qw(),{recording:r={}}=td.defaults,i=yield t.startRecording(r,null==e?void 0:e.allowMultiple);this.updateRecordings([...this.recordings,{id:i,state:"STARTING"}])}catch(e){throw BS.error("DyteRecording::stop::recording_failed_to_start",{error:e}),new qS("Error while starting recording")}}))}stop(e){return tr(this,null,(function*(){yield er(this,bN,wN).call(this,"stop",["RECORDING","PAUSED"],e)}))}pause(e){return tr(this,null,(function*(){yield er(this,bN,wN).call(this,"pause",["RECORDING"],e)}))}resume(e){return tr(this,null,(function*(){yield er(this,bN,wN).call(this,"resume",["PAUSED"],e)}))}},TN=new WeakMap,bN=new WeakSet,wN=function(e,t,r){return tr(this,null,(function*(){if(!Qt(this,TN).permissions.canRecord)throw BS.error("DyteRecording::stop::permission_denied"),new qS("User does not have permission to stop recording");let i=[];if(void 0!==r){const e=this.recordings.find((e=>e.id===r));if(void 0===e)throw new qS("Could not find the specified recording");if(t.includes(e.state))return void BS.error("DyteRecording::stop::recording_not_in_expected_state",{recording:{state:e.state}});i.push(e)}else i=this.recordings.filter((e=>t.includes(e.state)));i.forEach((t=>tr(this,null,(function*(){const r=t.state;"stop"===e&&(t.state="STOPPING",this.emit("recordingUpdate","STOPPING"));try{yield qw().updateRecording(t.id,e)}catch(e){throw BS.error("DyteRecording::stop::recording_failed_to_stop",{error:e}),t.state!==r&&(t.state=r,this.emit("recordingUpdate",r)),new qS("Error while stopping recording")}}))))}))},kN);AN([VS.trace("DyteRecording.start")],IN.prototype,"start",1),AN([VS.trace("DyteRecording.stop")],IN.prototype,"stop",1),AN([VS.trace("DyteRecording.stop")],IN.prototype,"pause",1),AN([VS.trace("DyteRecording.stop")],IN.prototype,"resume",1),IN=AN([KS((e=>{throw new qS(e.message,"1000")}))],IN);var PN=Object.defineProperty,DN=Object.getOwnPropertyDescriptor;class MN{constructor(e,t,r){Kt(this,"recording"),Kt(this,"room"),Kt(this,"shouldConnectToSocketService"),this.recording=new IN(e),this.room=t,this.shouldConnectToSocketService=r,this.setupEvents()}setupEvents(){tE.on(XS.ROOM_STATE,(e=>{0!==e.activeRecordings.length&&this.recording.updateRecordings(e.activeRecordings.map((e=>({id:e.recordingId,state:e.recordingStatus}))))})),this.room.on(Jw.recordingStarted,(e=>{let t=!1;const r=[...this.recording.recordings];r.forEach((r=>{r.id===e.recordingId&&(t=!0,r.state="RECORDING")})),!1===t&&r.push({id:e.recordingId,state:"RECORDING"}),this.recording.updateRecordings(r)})),this.room.on(Jw.recordingPaused,(e=>{const t=[...this.recording.recordings];t.forEach((t=>{t.id===e.recordingId&&(t.state="PAUSED")})),this.recording.updateRecordings(t)})),this.room.on(Jw.recordingStopped,(e=>{const t=[...this.recording.recordings.filter((t=>t.id!==e.recordingId))];this.recording.updateRecordings(t)})),this.shouldConnectToSocketService||this.setupLegacyEvents()}setupLegacyEvents(){tE.onAsync(XS.ROOM_JOINED,(e=>tr(this,null,(function*(){var t;BS.debug("[ROOM_JOINED] resolved request to fetch recordings.");const r=null==(t=e.peers)?void 0:t.filter((e=>{var t;return!(null==(t=e.flags)||!t.recorder)}));if(0!==r.length){r.forEach((e=>this.recording.recordingPeerIds.push(e.id)));const e=yield qw().getActiveRecording();this.recording.updateRecordings([{id:e.id,state:e.status}])}})))),tE.on(XS.PEER_JOINED,(e=>{var t;null!=(t=e.flags)&&t.recorder&&1===this.recording.recordings.length&&"STARTING"===this.recording.recordings[0].state&&(this.recording.recordingPeerIds.push(e.id),this.recording.updateRecordings([{id:this.recording.recordings[0].id,state:"RECORDING"}]))})),tE.on(XS.PEER_CLOSED,(e=>{this.recording.recordingPeerIds.includes(e.id)&&1===this.recording.recordings.length&&(this.recording.updateRecordings([]),this.recording.recordingPeerIds=this.recording.recordingPeerIds.filter((t=>t!==e.id)))})),tE.on(XS.LEAVE_MEDIA_ROOM,(()=>{this.recording.updateRecordings([]),this.recording.recordingPeerIds=[]}))}}((e,t,r,i)=>{for(var n,s=DN(t,r),o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(t,r,s)||s);s&&PN(t,r,s)})([VS.trace("RecordingController.setupEvents")],MN.prototype,"setupEvents");class ON{static hasFeature(e){var t;return null!=(t=Ci.hasFeature(e))&&t}static getFeatureValue(e){return Ci.getValue(e)}static getAllFeatures(){return Ci.getAllFlags()}}class NN{constructor(e,t,r){Kt(this,"logger"),Kt(this,"features"),Kt(this,"browserSpecs"),Kt(this,"callStats"),this.logger=e,this.features=t,this.browserSpecs=_S,this.callStats=r}static init(e){return new NN(BS,ON,e)}}class xN{constructor(e){Kt(this,"internals"),this.internals=e}static init(){return tr(this,null,(function*(){const e=NN.init(fi);return new xN(e)}))}}var LN,jN=Object.defineProperty,UN=Object.getOwnPropertyDescriptor,FN=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?UN(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&jN(t,r,s),s};class VN extends HS{constructor(e){super(),Xt(this,LN,void 0),Kt(this,"state","IDLE"),Kt(this,"playbackUrl"),Kt(this,"viewerCount"),Zt(this,LN,e),this.viewerCount=0}setLivestreamState(e){const t=this.state;this.state=e,t!==e&&this.emitCurrentLivestreamState()}emitCurrentLivestreamState(){this.emit("livestreamUpdate",this.state)}start(){return tr(this,null,(function*(){if(!Qt(this,LN).permissions.canLivestream)throw BS.error("DyteLivestream::start::permission_denied"),new qS("User does not have permission to start livestreaming");this.setLivestreamState("STARTING");try{const e=yield qw().startLivestreaming();this.playbackUrl=e}catch(e){throw BS.error("DyteRecording::stop::livestream_failed_to_start",{error:e}),this.setLivestreamState("IDLE"),new qS("Error while starting livestream")}}))}stop(){return tr(this,null,(function*(){if(!Qt(this,LN).permissions.canLivestream)throw BS.error("DyteLivestream::stop::permission_denied"),new qS("User does not have permission to stop livestreaming");if("LIVESTREAMING"!==this.state)throw BS.error("DyteLivestream::stop::inconsistent_state"),new qS("Livestream not started yet");try{this.setLivestreamState("STOPPING"),yield qw().stopLivestreaming()}catch(e){throw BS.error("DyteLivestream::stop::livestream_failed_to_stop",{error:e}),this.setLivestreamState("STOPPING"),new qS("Error while stopping livestream")}}))}}LN=new WeakMap,FN([VS.trace("livestream.start")],VN.prototype,"start",1),FN([VS.trace("livestream.stop")],VN.prototype,"stop",1);var BN,WN,HN=Object.defineProperty,GN=Object.getOwnPropertyDescriptor;class $N{constructor(e,t){Kt(this,"livestream"),Xt(this,BN,void 0),Xt(this,WN,void 0),this.livestream=new VN(e),Zt(this,WN,t),this.setupEvents()}fetchInitialLivestreamingState(){return tr(this,null,(function*(){const e=qw(),{status:t,playbackUrl:r}=yield e.getActiveLivestream();this.livestream.playbackUrl=r,"LIVE"===t&&this.livestream.setLivestreamState("LIVESTREAMING")}))}setupEvents(){Qt(this,WN).on(Jw.startedLivestream,(e=>{this.livestream.playbackUrl=e.playbackUrl,this.livestream.setLivestreamState("LIVESTREAMING")})),Qt(this,WN).on(Jw.stoppedLivestream,(()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0})),Qt(this,WN).on(Jw.erroredLivestream,(()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0})),Qt(this,WN).on(Jw.roomPeerCount,(e=>{this.livestream.viewerCount=e.count,this.livestream.emit("viewerCountUpdate",e.count)})),tE.on(XS.PEER_JOINED,(e=>tr(this,null,(function*(){var t;!0===(null==(t=e.flags)?void 0:t.hiddenParticipant)&&"LIVESTREAMER"===e.recorderType&&(Zt(this,BN,e.id),this.livestream.setLivestreamState("LIVESTREAMING"))})))),tE.on(XS.PEER_CLOSED,(e=>{e.id===Qt(this,BN)&&(Zt(this,BN,void 0),this.livestream.setLivestreamState("IDLE"))})),tE.onAsync(XS.ROOM_JOINED,(e=>tr(this,null,(function*(){var t,r;BS.debug("[ROOM_JOINED] resolved request to fetch livestream.");const i=null==(t=e.peers)?void 0:t.filter((e=>{var t;return!0===(null==(t=e.flags)?void 0:t.hiddenParticipant)&&"LIVESTREAMER"===e.recorderType}));i.length?(Zt(this,BN,i&&(null==(r=i[0])?void 0:r.id)),this.livestream.setLivestreamState("LIVESTREAMING")):(Zt(this,BN,void 0),this.livestream.setLivestreamState("IDLE"))})))),tE.onAsync(XS.LEAVE_MEDIA_ROOM,(()=>tr(this,null,(function*(){if(!this.livestream.playbackUrl){BS.info("Fetching livestreaming state on leave stage");try{yield this.fetchInitialLivestreamingState()}catch(e){}}})))),tE.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>tr(this,null,(function*(){try{yield this.fetchInitialLivestreamingState()}catch(e){}}))))}}BN=new WeakMap,WN=new WeakMap,((e,t,r,i)=>{for(var n,s=GN(t,r),o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(t,r,s)||s);s&&HN(t,r,s)})([VS.trace("LivestreamController.setupEvents")],$N.prototype,"setupEvents");const qN=CS(wa().permissions);var zN,JN,KN,YN,QN;const XN=class extends HS{constructor(e,t,r,i=!1){if(super(),Xt(this,zN,void 0),Xt(this,JN,void 0),Xt(this,KN,void 0),Xt(this,YN,void 0),Xt(this,QN,(e=>{e.chat&&(e.chat.private&&Jd.merge(Qt(this,zN).chat.private,e.chat.private),e.chat.public&&Jd.merge(Qt(this,zN).chat.public,e.chat.public),this.emit("chatUpdate")),e.polls&&(Jd.merge(Qt(this,zN).polls,e.polls),this.emit("pollsUpdate")),e.plugins&&(Jd.merge(Qt(this,zN).plugins,e.plugins),this.emit("pluginsUpdate"))})),!e)throw BS.error("DytePermissionsPreset::load_preset_permissions_failed"),new qS("Could not load preset permissions.");Zt(this,KN,r),Zt(this,JN,t),Zt(this,zN,e),i&&this.setupEvents()}setupEvents(){tE.onAsync(XS.SET_STAGE_STATUS,function(e){return tr(this,null,(function*(){Zt(this,YN,e),this.stageStatus=e}))}.bind(this)),tE.on(XS.UPDATE_PERMISSIONS,Qt(this,QN))}static fromResponse(e,t,r){return new XN(e,t,r,!0)}static default(e,t){return new XN(qN,e,t)}get mediaRoomType(){return Qt(this,KN)?"HIVE":"ROOM_NODE"}get stageEnabled(){var e;return(null==(e=Qt(this,zN))?void 0:e.stageEnabled)||Qt(this,JN)===gi.Webinar||Qt(this,JN)===gi.Livestream}get acceptStageRequests(){var e,t;return!!this.stageEnabled&&((null==(e=Qt(this,zN))?void 0:e.acceptStageRequests)||(null==(t=Qt(this,zN))?void 0:t.canAcceptProductionRequests))}get stageAccess(){var e,t,r;return(null==(e=Qt(this,zN))?void 0:e.stageAccess)===yi.NotAllowed?yi.NotAllowed:(null==(t=Qt(this,zN))?void 0:t.stageAccess)===yi.CanRequest?yi.CanRequest:(null==(r=Qt(this,zN))?void 0:r.stageAccess)===yi.Allowed||Qt(this,zN).media.audio.canProduce===yi.Allowed||Qt(this,zN).media.video.canProduce===yi.Allowed||Qt(this,zN).media.screenshare.canProduce===yi.Allowed?yi.Allowed:Qt(this,zN).media.audio.canProduce===yi.CanRequest||Qt(this,zN).media.video.canProduce===yi.CanRequest||Qt(this,zN).media.screenshare.canProduce===yi.CanRequest?yi.CanRequest:yi.NotAllowed}get acceptWaitingRequests(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.acceptWaitingRequests)?t:qN.acceptWaitingRequests}get requestProduceVideo(){var e,t,r;return(null==(r=null==(t=null==(e=Qt(this,zN))?void 0:e.media)?void 0:t.video)?void 0:r.canProduce)===yi.CanRequest}get requestProduceAudio(){var e,t,r;return(null==(r=null==(t=null==(e=Qt(this,zN))?void 0:e.media)?void 0:t.audio)?void 0:r.canProduce)===yi.CanRequest}get requestProduceScreenshare(){var e,t,r;return(null==(r=null==(t=null==(e=Qt(this,zN))?void 0:e.media)?void 0:t.screenshare)?void 0:r.canProduce)===yi.CanRequest}get canAllowParticipantAudio(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.disableParticipantAudio)?t:qN.disableParticipantAudio}get canAllowParticipantScreensharing(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.canAcceptProductionRequests)?t:qN.canAcceptProductionRequests}get canAllowParticipantVideo(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.disableParticipantVideo)?t:qN.disableParticipantVideo}get canDisableParticipantAudio(){return this.canAllowParticipantAudio}get canDisableParticipantVideo(){return this.canAllowParticipantVideo}get kickParticipant(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.kickParticipant)?t:qN.kickParticipant}get pinParticipant(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.pinParticipant)?t:qN.pinParticipant}get canRecord(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.canRecord)?t:qN.canRecord}get waitingRoomType(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.waitingRoomType)?t:qN.waitingRoomType}get waitingRoomBehaviour(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.waitingRoomType)?t:qN.waitingRoomType}get plugins(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.plugins)?t:qN.plugins}get polls(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.polls)?t:qN.polls}get produceVideo(){return this.canProduceVideo}get requestProduce(){return Qt(this,zN).media.audio.canProduce===yi.CanRequest||Qt(this,zN).media.video.canProduce===yi.CanRequest||Qt(this,zN).media.screenshare.canProduce===yi.CanRequest}get canProduceVideo(){var e;const t=null!=(e=Qt(this,zN).media.video.canProduce)?e:qN.media.video.canProduce;return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Qt(this,YN)&&"ON_STAGE"!==Qt(this,YN)||t!==yi.CanRequest?!this.stageEnabled||"OFF_STAGE"!==Qt(this,YN)&&"REQUESTED_TO_JOIN_STAGE"!==Qt(this,YN)||t!==yi.Allowed?t:yi.NotAllowed:yi.Allowed}get produceScreenshare(){return this.canProduceScreenshare}get canProduceScreenshare(){var e;const t=null!=(e=Qt(this,zN).media.screenshare.canProduce)?e:qN.media.screenshare.canProduce;return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Qt(this,YN)&&"ON_STAGE"!==Qt(this,YN)||t!==yi.CanRequest?!this.stageEnabled||"OFF_STAGE"!==Qt(this,YN)&&"REQUESTED_TO_JOIN_STAGE"!==Qt(this,YN)||t!==yi.Allowed?t:yi.NotAllowed:yi.Allowed}get produceAudio(){return this.canProduceAudio}get canProduceAudio(){var e;const t=null!=(e=Qt(this,zN).media.audio.canProduce)?e:qN.media.audio.canProduce;return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Qt(this,YN)&&"ON_STAGE"!==Qt(this,YN)||t!==yi.CanRequest?!this.stageEnabled||"OFF_STAGE"!==Qt(this,YN)&&"REQUESTED_TO_JOIN_STAGE"!==Qt(this,YN)||t!==yi.Allowed?t:yi.NotAllowed:yi.Allowed}get chatPublic(){var e,t,r;return null!=(r=null==(t=null==(e=Qt(this,zN))?void 0:e.chat)?void 0:t.public)?r:qN.chat.public}get chatPrivate(){var e,t,r;return null!=(r=null==(t=null==(e=Qt(this,zN))?void 0:e.chat)?void 0:t.private)?r:qN.chat.private}get chatChannel(){var e,t,r;return null!=(r=null==(t=null==(e=Qt(this,zN))?void 0:e.chat)?void 0:t.channel)?r:qN.chat.channel}get chatMessage(){var e,t,r;return null!=(r=null==(t=null==(e=Qt(this,zN))?void 0:e.chat)?void 0:t.message)?r:qN.chat.message}get connectedMeetings(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.connectedMeetings)?t:null==qN?void 0:qN.connectedMeetings}get hiddenParticipant(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.hiddenParticipant)?t:qN.hiddenParticipant}get showParticipantList(){var e;return null!=(e=Qt(this,zN).showParticipantList)?e:qN.showParticipantList}get canChangeParticipantRole(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.canChangeParticipantPermissions)?t:qN.canChangeParticipantPermissions}get canChangeParticipantPermissions(){var e,t;return null!=(t=null==(e=Qt(this,zN))?void 0:e.canChangeParticipantPermissions)?t:qN.canChangeParticipantPermissions}get canChangeTheme(){return!1}get canPresent(){return Qt(this,zN).media.audio.canProduce===yi.Allowed||Qt(this,zN).media.video.canProduce===yi.Allowed||Qt(this,zN).media.screenshare.canProduce===yi.Allowed}get acceptPresentRequests(){return this.acceptStageRequests}get canEditDisplayName(){var e;return null!=(e=Qt(this,zN).canEditDisplayName)&&e}get maxScreenShareCount(){return 1}get isRecorder(){return Qt(this,zN).isRecorder}get canSpotlight(){return Qt(this,zN).canSpotlight}get canLivestream(){return Qt(this,zN).canLivestream}get transcriptionEnabled(){return Qt(this,zN).transcriptionEnabled}get isV2(){return!0}};let ZN=XN;zN=new WeakMap,JN=new WeakMap,KN=new WeakMap,YN=new WeakMap,QN=new WeakMap;const ex=CS(wa());var tx,rx,ix;const nx=class{constructor(e){if(Xt(this,tx,void 0),Xt(this,rx,void 0),Xt(this,ix,void 0),!e)throw new qS("Could not load preset.");Zt(this,tx,e.config),Zt(this,rx,e.ui||CS(wa().ui)),Zt(this,ix,e.permissions.plugins.config)}static fromResponse(e){return new nx(e)}static default(){return new nx(ex)}get setupScreen(){return{isEnabled:!0}}get waitingRoom(){return{isEnabled:!0}}get controlBar(){return{isEnabled:!0,elements:{chat:!0,fullscreen:!0,invite:!1,layout:!1,participants:!0,plugins:!0,polls:!0,reactions:!1,screenshare:!0}}}get header(){return{isEnabled:!0,elements:{logo:Qt(this,rx).designTokens.logo,timer:!0,title:!0,participantCount:!0,changeLayout:!1}}}get pipMode(){return!0}get viewType(){return Qt(this,tx).viewType}get maxVideoStreams(){return Qt(this,tx).maxVideoStreams}get maxScreenShareCount(){return Qt(this,tx).maxScreenshareCount}get plugins(){return[]}get disabledPlugins(){return Object.keys(Qt(this,ix)).filter((e=>Qt(this,ix)[e].disabled))}get designTokens(){return Qt(this,rx).designTokens}get configDiff(){return Qt(this,rx).configDiff}get mediaConstraints(){var e,t,r,i,n,s,o,a,c,d,l,u,p,h,m,f,g,v,y,_,S,E,T,b;return{audio:{enableStereo:null!=(i=null==(r=null==(t=null==(e=Qt(this,tx))?void 0:e.media)?void 0:t.audio)?void 0:r.enableStereo)?i:MS.audio.enableStereo,enableHighBitrate:null!=(a=null==(o=null==(s=null==(n=Qt(this,tx))?void 0:n.media)?void 0:s.audio)?void 0:o.enableHighBitrate)?a:MS.audio.enableHighBitrate},video:{quality:null!=(u=null==(l=null==(d=null==(c=Qt(this,tx))?void 0:c.media)?void 0:d.video)?void 0:l.quality)?u:MS.video.quality,frameRate:null!=(f=null==(m=null==(h=null==(p=Qt(this,tx))?void 0:p.media)?void 0:h.video)?void 0:m.frameRate)?f:MS.video.frameRate},screenshare:{quality:null!=(_=null==(y=null==(v=null==(g=Qt(this,tx))?void 0:g.media)?void 0:v.screenshare)?void 0:y.quality)?_:MS.screenshare.quality,frameRate:null!=(b=null==(T=null==(E=null==(S=Qt(this,tx))?void 0:S.media)?void 0:E.screenshare)?void 0:T.frameRate)?b:MS.screenshare.frameRate}}}get isV2(){return!0}};let sx=nx;var ox,ax;tx=new WeakMap,rx=new WeakMap,ix=new WeakMap;class cx{constructor(e){Xt(this,ox,void 0),Zt(this,ox,e)}on(e,t){let r;r=e===Jw.roomPeerCount?tb.fromBinary.bind(tb):Zb.fromBinary.bind(Zb),Qt(this,ox).on(e,(({payload:e})=>{const i=r(e);return t(i)}))}}ox=new WeakMap;class dx{constructor(e){Xt(this,ax,void 0),Zt(this,ax,e)}getStageRequests(){return tr(this,null,(function*(){const{payload:e}=yield Qt(this,ax).sendMessagePromise(Jw.getStageRequests);return e?rw.fromBinary(e):{stageRequests:[]}}))}requestAccess(){Qt(this,ax).sendMessage(Jw.requestStageAccess)}cancelRequestAccess(){Qt(this,ax).sendMessage(Jw.cancelStageRequest)}grantAccess(e){return tr(this,null,(function*(){const t={userIds:e};Qt(this,ax).sendMessage(Jw.grantStageAccess,iw.toBinary(t))}))}denyAccess(e){return tr(this,null,(function*(){const t={userIds:e};Qt(this,ax).sendMessage(Jw.denyStageAccess,nw.toBinary(t))}))}joinStage(){return Qt(this,ax).sendMessage(Jw.joinStage)}leaveStage(e){const t={userIds:[e]};return Qt(this,ax).sendMessage(Jw.leaveStage,sw.toBinary(t))}kick(e){const t={userIds:e};return Qt(this,ax).sendMessagePromise(Jw.leaveStage,sw.toBinary(t))}on(e,t){let r;switch(e){case Jw.grantStageAccess:case Jw.denyStageAccess:r=void 0;break;case Jw.getStagePeers:r=ew.fromBinary.bind(ew);break;case Jw.getStageRequests:case Jw.requestStageAccess:case Jw.cancelStageRequest:r=rw.fromBinary.bind(rw);break;case Jw.peerStageStatusUpdate:r=XT.fromBinary.bind(XT)}Qt(this,ax).on(e,(({payload:e,id:i})=>{if(!e||!r)return t(void 0,i);const n=r(e);return t(n,i)}))}}ax=new WeakMap;var lx,ux,px,hx,mx,fx,gx,vx,yx,_x,Sx=Object.defineProperty,Ex=Object.getOwnPropertyDescriptor,Tx=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?Ex(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&Sx(t,r,s),s};class bx extends HS{constructor(e,t,r,i,n){super(),Xt(this,gx),Xt(this,yx),Xt(this,lx,void 0),Xt(this,ux,void 0),Xt(this,px,void 0),Xt(this,hx,void 0),Xt(this,mx,void 0),Xt(this,fx,void 0),Kt(this,"status"),Kt(this,"getSocketStageRequests",(()=>tr(this,null,(function*(){if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if(!Qt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::get_access_request::permission_denied"),new qS("You do not have permission to perform this action/");const{stageRequests:e}=yield Qt(this,lx).getStageRequests();Zt(this,fx,e)})))),Zt(this,lx,r),Zt(this,ux,e),Zt(this,px,t),Zt(this,mx,n),Zt(this,hx,i),Zt(this,fx,[]),this.setupEvents()}setupEvents(){Qt(this,ux).permissions.acceptStageRequests&&Qt(this,ux).permissions.stageEnabled&&this.getSocketStageRequests(),tE.onAsync(XS.GET_STAGE_REQUESTS,(e=>tr(this,null,(function*(){Zt(this,fx,e)})))),tE.onAsync(XS.UPDATE_STAGE_REQUESTS,(e=>tr(this,[e],(function*({request:e,add:t}){Zt(this,fx,t?[...Qt(this,fx),e]:Qt(this,fx).filter((t=>t.peerId!==e.peerId)))}))))}getAccessRequests(){if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if(!Qt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::get_access_request::permission_denied"),new qS("You do not have permission to perform this action/");return er(this,yx,_x).call(this)?{stageRequests:Qt(this,fx)}:{stageRequests:Qt(this,px).joined.toArray().filter((e=>e.stageStatus===OI.REQUESTED_TO_JOIN_STAGE)).map((e=>({displayName:e.name,userId:e.userId,peerId:e.id})))}}requestAccess(){return tr(this,null,(function*(){if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if("OFF_STAGE"!==this.status)throw new qS(`Unable to request access you are currently ${this.status}`);if(er(this,yx,_x).call(this)){if(Qt(this,ux).permissions.stageAccess===yi.Allowed)return void er(this,gx,vx).call(this,"ACCEPTED_TO_JOIN_STAGE");Qt(this,lx).requestAccess(),er(this,gx,vx).call(this,"REQUESTED_TO_JOIN_STAGE")}else{if(!Qt(this,ux).roomJoined)throw new qS("Can`t request to join stage without joining room");if(Qt(this,ux).permissions.stageAccess===yi.Allowed)return void er(this,gx,vx).call(this,"ACCEPTED_TO_JOIN_STAGE");if(Qt(this,ux).permissions.stageAccess===yi.NotAllowed)throw BS.error("DyteStage::requestGoToStage::permission_denied"),new qS("User does not have permission to go on stage");if("OFF_STAGE"!==this.status)return;try{er(this,gx,vx).call(this,"REQUESTED_TO_JOIN_STAGE"),yield Qt(this,mx).requestToJoinStage(sC.PRESENT)}catch(e){er(this,gx,vx).call(this,"OFF_STAGE")}}}))}cancelRequestAccess(){return tr(this,null,(function*(){if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if(er(this,yx,_x).call(this))Qt(this,lx).cancelRequestAccess();else{if(!Qt(this,ux).roomJoined)throw new qS("Can`t request to join stage without joining room");if(Qt(this,ux).stageStatus!==OI.REQUESTED_TO_JOIN_STAGE)return;yield Qt(this,mx).withdrawRequestToJoinStage()}er(this,gx,vx).call(this,"OFF_STAGE")}))}grantAccess(e){if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if(!Qt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::grant_access::permission_denied"),new qS("You do not have permission to perform this action/");if(er(this,yx,_x).call(this))return Qt(this,lx).grantAccess(e);if(!Qt(this,ux).roomJoined)throw new qS("Can`t rejectRequestToJoinStage for participant without joining room");return Qt(this,mx).grantStageAccess(e)}denyAccess(e){if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if(!Qt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::deny_access::permission_denied"),new qS("You do not have permission to perform this action/");if(er(this,yx,_x).call(this))return Qt(this,lx).denyAccess(e);if(!Qt(this,ux).roomJoined)throw new qS("Can`t rejectRequestToJoinStage for participant without joining room");return Qt(this,mx).denyStageAccess(e)}join(){return tr(this,null,(function*(){if("ON_STAGE"===this.status)throw new qS("You are already on stage.");if(Qt(this,ux).permissions.stageAccess!==yi.Allowed&&"ACCEPTED_TO_JOIN_STAGE"!==this.status)throw new qS(`Unable to join stage you are currently ${this.status}`);if(er(this,yx,_x).call(this))Qt(this,lx).joinStage(),Qt(this,hx)===gi.Livestream?yield tE.emitAsync(XS.JOIN_MEDIA_ROOM):(Qt(this,ux).emit("stageJoined"),er(this,gx,vx).call(this,"ON_STAGE"));else{if(!Qt(this,ux).roomJoined)throw new qS("Can`t join stage without joining room");yield Qt(this,mx).startPresenting(),Qt(this,ux).emit("stageJoined"),er(this,gx,vx).call(this,"ON_STAGE")}}))}leave(){return tr(this,null,(function*(){var e;if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if(er(this,yx,_x).call(this)){if("ON_STAGE"!==this.status&&"ACCEPTED_TO_JOIN_STAGE"!==this.status)throw new qS(`Unable to leave stage you are currently ${this.status}`);Qt(this,ux).setIsPinned(!1),er(this,gx,vx).call(this,"OFF_STAGE"),null!=(e=_C())&&e.roomJoined&&Qt(this,hx)===gi.Livestream&&(yield tE.emitAsync(XS.LEAVE_MEDIA_ROOM));try{yield Qt(this,ux).disableScreenShare(),yield Qt(this,ux).disableVideo(),yield Qt(this,ux).disableAudio(),Qt(this,ux).destructMediaHandler()}catch(e){BS.error("DyteStage.leaveStage.DisableMediaError",{error:e})}Qt(this,lx).leaveStage(Qt(this,ux).userId)}else{if(!Qt(this,ux).roomJoined)throw new qS("Can`t leave stage without joining room");yield Qt(this,ux).disableScreenShare(),yield Qt(this,ux).disableAudio(),yield Qt(this,ux).disableVideo(),yield Qt(this,mx).stopPresenting(),er(this,gx,vx).call(this,"OFF_STAGE")}}))}kick(e){return tr(this,null,(function*(){if(!Qt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new qS("Stage is disabled");if(!Qt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::kick::permission_denied"),new qS("You do not have permissions for kick");if(er(this,yx,_x).call(this))return Qt(this,lx).kick(e);if(!Qt(this,ux).roomJoined)throw new qS("Can`t kick participant without joining room");return Qt(this,mx).kickPeerFromStage(e)}))}}lx=new WeakMap,ux=new WeakMap,px=new WeakMap,hx=new WeakMap,mx=new WeakMap,fx=new WeakMap,gx=new WeakSet,vx=function(e){return tr(this,null,(function*(){this.status!==e&&(this.status=e,yield tE.emitAsync(XS.SET_STAGE_STATUS,e),this.emit("stageStatusUpdate",e))}))},yx=new WeakSet,_x=function(){return Qt(this,hx)===gi.Livestream||"HIVE"===Qt(this,ux).permissions.mediaRoomType},Tx([VS.trace("DyteStage.getStageRequests")],bx.prototype,"getAccessRequests",1),Tx([VS.trace("DyteStage.requestAccess")],bx.prototype,"requestAccess",1),Tx([VS.trace("DyteStage.cancelRequestAccess")],bx.prototype,"cancelRequestAccess",1),Tx([VS.trace("DyteStage.grantAccess")],bx.prototype,"grantAccess",1),Tx([VS.trace("DyteStage.denyAccess")],bx.prototype,"denyAccess",1),Tx([VS.trace("DyteStage.joinStage")],bx.prototype,"join",1),Tx([VS.trace("DyteStage.leaveStage")],bx.prototype,"leave",1);var wx,kx,Rx,Cx,Ax,Ix=Object.defineProperty,Px=Object.getOwnPropertyDescriptor;class Dx{constructor(e,t,r,i,n){Kt(this,"stage"),Xt(this,wx,void 0),Xt(this,kx,void 0),Xt(this,Rx,void 0),Xt(this,Cx,0),Xt(this,Ax,void 0),this.stage=new bx(t,r,e,i,n),Zt(this,Rx,e),Zt(this,Ax,i),Zt(this,wx,t),Zt(this,Ax,i),Zt(this,kx,r),this.setupEvents(),this.setupWebinarMigrationEvents()}setupEvents(){Qt(this,Rx).on(Jw.grantStageAccess,(()=>{Qt(this,wx).permissions.stageAccess!==yi.Allowed&&(this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE"))})),Qt(this,Rx).on(Jw.peerStageStatusUpdate,(e=>{if(void 0===e||e.peerId===Qt(this,wx).id)return;const t=Qt(this,kx).joined.get(e.peerId),r="ACTIVE_GRID"===Qt(this,kx).viewMode&&"HIVE"===Qt(this,wx).permissions.mediaRoomType;if(t||Qt(this,Ax)===gi.Livestream){switch(e.stageType){case 1:t.setStageStatus("ON_STAGE"),r&&tE.emit(XS.REFRESH_GRID);break;case 2:t.setStageStatus("ACCEPTED_TO_JOIN_STAGE");break;case 3:t.setStageStatus("REQUESTED_TO_JOIN_STAGE");break;default:t.setStageStatus("OFF_STAGE"),r&&tE.emit(XS.REFRESH_GRID)}this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests())}else BS.warn("err::peerStageStatusUpdate: participant not found")})),Qt(this,Rx).on(Jw.denyStageAccess,(()=>{Qt(this,wx).permissions.stageAccess!==yi.Allowed&&(this.stage.emit("stageRequestRejected"),this.setStageStatus("OFF_STAGE"),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})),Qt(this,Rx).on(Jw.getStagePeers,(e=>{Qt(this,Ax)!==gi.Livestream&&"HIVE"!==Qt(this,wx).permissions.mediaRoomType||"ON_STAGE"===this.stage.status&&!e.stagePeers.includes(Qt(this,wx).userId)&&this.stage.leave()})),Qt(this,Rx).on(Jw.getStageRequests,(e=>tr(this,null,(function*(){var t;if(Qt(this,wx).permissions.stageAccess!==yi.Allowed)return;const r=null!=(t=null==e?void 0:e.stageRequests)?t:[];yield tE.emitAsync(XS.GET_STAGE_REQUESTS,r),Qt(this,Cx)<r.length&&r.length>0&&this.stage.emit("newStageRequest",{count:r.length}),Zt(this,Cx,r.length),this.stage.emit("stageAccessRequestUpdate",r)})))),tE.on(XS.NEW_STAGE_REQUEST,(()=>{Qt(this,wx).permissions.stageAccess===yi.Allowed&&this.stage.emit("newStageRequest",{count:-1})})),tE.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(e=>tr(this,null,(function*(){var t;if(Qt(this,Ax)===gi.Livestream||"HIVE"===Qt(this,wx).permissions.mediaRoomType){switch(null==(t=e.peer)?void 0:t.stageType){case qT.OFF_STAGE:"ON_STAGE"===this.stage.status&&(yield this.stage.leave()),this.setStageStatus("OFF_STAGE");break;case qT.ON_STAGE:"LIVESTREAM"===Qt(this,wx).config.viewType&&(yield tE.emitAsync(XS.JOIN_MEDIA_ROOM)),"HIVE"===Qt(this,wx).permissions.mediaRoomType&&this.setStageStatus("ON_STAGE");break;case qT.APPROVED_STAGE:this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE");break;case qT.REQUESTED_STAGE:this.setStageStatus("REQUESTED_TO_JOIN_STAGE");break;default:this.setStageStatus("OFF_STAGE")}Qt(this,wx).emit("socketServiceRoomJoined")}})))),tE.onAsync(XS.ROOM_JOINED,(e=>tr(this,null,(function*(){e.stageStatus&&this.setStageStatus(e.stageStatus)})))),tE.on(XS.SELF_ROOM_JOINED,(()=>tr(this,null,(function*(){Qt(this,Ax)!==gi.Livestream?Qt(this,wx).permissions.stageEnabled&&Qt(this,wx).permissions.stageAccess===yi.Allowed&&"ON_STAGE"!==this.stage.status&&(yield this.stage.join()):this.setStageStatus("ON_STAGE")})))),tE.on(XS.REQUEST_TO_JOIN_STAGE_ACCEPTED,(()=>{this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE"),Qt(this,wx).emit("joinStageRequestAccepted")})),tE.on(XS.REQUEST_TO_JOIN_STAGE_REJECTED,(()=>{this.stage.emit("stageRequestRejected"),this.setStageStatus("OFF_STAGE"),Qt(this,wx).emit("joinStageRequestRejected")})),tE.on(XS.PEER_REJECTED_TO_JOIN_STAGE,(({id:e})=>{!e||e===Qt(this,wx).id||(tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.OFF_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})),tE.on(XS.PEER_ADDED_TO_STAGE,(({id:e})=>{!e||e===Qt(this,wx).id||(tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.ACCEPTED_TO_JOIN_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})),tE.on(XS.PEER_STARTED_PRESENTING,(({id:e})=>{!e||e===Qt(this,wx).id||tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.ON_STAGE})})),tE.on(XS.PEER_REMOVED_FROM_STAGE,(({id:e})=>{!e||e===Qt(this,wx).id||(tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.OFF_STAGE}),Qt(this,kx).pinned.delete(e))})),tE.on(XS.PEER_STOPPED_PRESENTING,(({id:e})=>{!e||e===Qt(this,wx).id||(tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.OFF_STAGE}),Qt(this,kx).pinned.delete(e))})),tE.on(XS.PEER_REQUESTED_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({id:e}){!e||e===Qt(this,wx).id||(yield tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.REQUESTED_TO_JOIN_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})))),tE.on(XS.STAGE_REQUESTS_UPDATED,(e=>tr(this,null,(function*(){yield tE.emitAsync(XS.UPDATE_STAGE_REQUESTS,e),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests())})))),tE.on(XS.PEER_WITHDRAWN_REQUEST_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({id:e}){!e||e===Qt(this,wx).id||(yield tE.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:OI.OFF_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})))),tE.on(XS.REMOVED_FROM_STAGE,(()=>tr(this,null,(function*(){this.setStageStatus("OFF_STAGE"),yield Qt(this,wx).disableScreenShare(),yield Qt(this,wx).disableVideo(),yield Qt(this,wx).disableAudio(),Qt(this,wx).destructMediaHandler(),Qt(this,wx).emit("removedFromStage")}))))}setupWebinarMigrationEvents(){tE.on(XS.SET_WEBINAR_STAGE_STATUS,(e=>tr(this,null,(function*(){this.stage.status!==e&&(this.stage.status=e,yield tE.emitAsync(XS.SET_STAGE_STATUS,e),this.stage.emit("stageStatusUpdate",e))})))),tE.onAsync(XS.REQUEST_TO_JOIN_STAGE,(()=>tr(this,null,(function*(){return this.stage.requestAccess()})))),tE.onAsync(XS.WITHDRAW_REQUEST_TO_JOIN_STAGE,(()=>tr(this,null,(function*(){return this.stage.cancelRequestAccess()})))),tE.onAsync(XS.LEAVE_STAGE,(()=>tr(this,null,(function*(){return this.stage.leave()})))),tE.onAsync(XS.JOIN_STAGE,(()=>tr(this,null,(function*(){return this.stage.join()})))),tE.onAsync(XS.ACCEPT_JOIN_STAGE_REQUEST,(e=>tr(this,[e],(function*({userId:e}){return this.stage.grantAccess([e])})))),tE.onAsync(XS.REMOVE_FROM_STAGE,(e=>tr(this,[e],(function*({userId:e}){this.stage.kick([e])})))),tE.onAsync(XS.REJECT_REQUEST_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({userId:e}){return this.stage.denyAccess([e])})))),tE.onAsync(XS.ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({data:e}){const t=e.map((({id:e})=>Qt(this,kx).joined.get(e).userId));this.stage.grantAccess(t)}))))}getCurrentStageRequests(){return Qt(this,kx).joined.toArray().filter((e=>"REQUESTED_TO_JOIN_STAGE"===e.stageStatus)).map((e=>({displayName:e.name,userId:e.userId,peerId:e.id})))}setStageStatus(e){return tr(this,null,(function*(){this.stage.status!==e&&(this.stage.status=e,yield tE.emitAsync(XS.SET_STAGE_STATUS,e),this.stage.emit("stageStatusUpdate",e))}))}}wx=new WeakMap,kx=new WeakMap,Rx=new WeakMap,Cx=new WeakMap,Ax=new WeakMap,((e,t,r,i)=>{for(var n,s=Px(t,r),o=e.length-1;o>=0;o--)(n=e[o])&&(s=n(t,r,s)||s);s&&Ix(t,r,s)})([VS.trace("DyteStage.setupEvents")],Dx.prototype,"setupEvents");var Mx,Ox=Object.defineProperty,Nx=Object.getOwnPropertyDescriptor,xx=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?Nx(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&Ox(t,r,s),s};class Lx{constructor(e){Xt(this,Mx,void 0),Zt(this,Mx,e)}getPolls(){return Qt(this,Mx).sendMessagePromise(Qw.getPolls)}createPoll(e,t,r=!1,i=!1){const n={anonymous:r,hideVotes:i,question:e,options:t};return Qt(this,Mx).sendMessage(Qw.createPoll,dw.toBinary(n))}votePoll(e,t){const r={index:t,pollId:e};return Qt(this,Mx).sendMessage(Qw.votePoll,lw.toBinary(r))}on(e,t){let r,i;switch(e){case Qw.updatePoll:case Qw.createPoll:case Qw.votePoll:r=uw.fromBinary.bind(uw),i=uw.create()}Qt(this,Mx).on(e,(({payload:e})=>{let n=i;try{n=r(e)}catch(e){BS.error("pollSocketHandler::on::binary_decode_error",{error:e})}return t(n)}))}}Mx=new WeakMap,xx([VS.trace("PollSocketHandler.getPolls")],Lx.prototype,"getPolls",1),xx([VS.trace("PollSocketHandler.createPoll")],Lx.prototype,"createPoll",1),xx([VS.trace("PollSocketHandler.votePoll")],Lx.prototype,"votePoll",1);const jx=new class{constructor(){Kt(this,"battery"),Kt(this,"init",(()=>tr(this,null,(function*(){try{"getBattery"in navigator&&(this.battery=yield navigator.getBattery(),this.battery.addEventListener("chargingchange",this.updateChargeInfo),this.battery.addEventListener("levelchange",this.updateLevelInfo),this.updateLevelInfo(),this.updateChargeInfo())}catch(e){BS.error("Error getting battery",e)}})))),Kt(this,"updateChargeInfo",(()=>{var e;BS.log("Battery charging? "+(null!=(e=this.battery)&&e.charging?"Yes":"No"))})),Kt(this,"updateLevelInfo",(()=>{this.battery?BS.log(`Battery level: ${100*this.battery.level}%`):BS.log("Battery level: Not known")})),Kt(this,"cleanup",(()=>{var e,t;"getBattery"in navigator&&(null==(e=this.battery)||e.removeEventListener("chargingchange",this.updateChargeInfo),null==(t=this.battery)||t.removeEventListener("levelchange",this.updateLevelInfo))}))}};var Ux,Fx,Vx,Bx,Wx,Hx,Gx,$x,qx,zx,Jx,Kx;class Yx extends WS{constructor(e){super(),Xt(this,Vx),Xt(this,Ux,void 0),Xt(this,Fx,void 0),Zt(this,Ux,e),Zt(this,Fx,!1)}get mediaPermission(){return Qt(this,Ux).mediaPermissions.audio}getTrackMetadata(e=!1){return tr(this,null,(function*(){if(!HA.track){if(!e)return null;const t=yield er(this,Vx,Bx).call(this);HA.setTrack(t)}return HA.getTrackMetadata()}))}startTrackAnalysis(e=!1){return tr(this,null,(function*(){if(Qt(this,Fx))return!0;Zt(this,Fx,!0);let t=yield HA.startTrackAnalysis();if(!t&&e){const e=yield er(this,Vx,Bx).call(this);HA.setTrack(e),t=yield HA.startTrackAnalysis()}return t||Zt(this,Fx,!1),t}))}stopTrackAnalysis(){return Qt(this,Fx)&&(Zt(this,Fx,!1),HA.stopTrackAnalysis()),!0}}Ux=new WeakMap,Fx=new WeakMap,Vx=new WeakSet,Bx=function(){return tr(this,null,(function*(){var e;try{const t=Qt(this,Ux).getCurrentDevices(),r=null==(e=null==t?void 0:t.audio)?void 0:e.deviceId;let i={audio:!0};r&&(i=OC.getAudioConstraints({audioDeviceId:r}));const n=yield OC.getAudioTrack(i);return Qt(this,Ux).mediaPermissions.audio="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:Qt(this,Ux).mediaPermissions.audio,kind:"audio"}),n}catch(e){const t=zC("audio",e.name,e.message);throw Qt(this,Ux).mediaPermissions.audio=t,tE.emit(XS.MEDIA_PERMISSION_ERROR,{message:t,constraints:e.constraints,kind:"audio"}),new qS("Failed to fetch audio track","1700")}}))};class Qx extends WS{constructor(){super(),Xt(this,Wx,void 0),Zt(this,Wx,!1)}getNetworkMetadata(){return tr(this,null,(function*(){return new Promise((e=>{fi.onSafeInitialization((()=>{fi.onPreCallTestResults((t=>{e(t.connectionInfo)})),fi.startPreCallTest()}))}))}))}startNetworkAnalysis(){return Zt(this,Wx,zR.collectSendTransportStats()&&zR.collectRecvTransportStats()),Qt(this,Wx)}stopNetworkAnalysis(){return Zt(this,Wx,!(zR.stopStatsCollection("send")&&zR.stopStatsCollection("receive"))),Qt(this,Wx)}}Wx=new WeakMap;class Xx extends WS{constructor(e){super(),Xt(this,Hx,void 0),Xt(this,Gx,void 0),Zt(this,Hx,e),Zt(this,Gx,{audio:!1,video:!1})}get mediaPermission(){return Qt(this,Hx).mediaPermissions.screenshare}getAudioTrackMetaData(){var e;return null!=(e=Qt(this,Hx).screenShareTracks)&&e.audio?GA.getTrackMetadata():null}getVideoTrackMetaData(){var e;return null!=(e=Qt(this,Hx).screenShareTracks)&&e.video?EI.getTrackMetadata():null}startAudioTrackAnalysis(){return tr(this,null,(function*(){if(Qt(this,Gx).audio)return!0;const e=yield GA.startTrackAnalysis();return Qt(this,Gx).audio=e,Qt(this,Gx).audio}))}startVideoTrackAnalysis(){return tr(this,null,(function*(){if(Qt(this,Gx).video)return!0;const e=yield EI.startTrackAnalysis();return Qt(this,Gx).video=e,Qt(this,Gx).video}))}stopAudioTrackAnalysis(){return Qt(this,Gx)&&(Qt(this,Gx).audio=!1,GA.stopTrackAnalysis()),!0}stopVideoTrackAnalysis(){return Qt(this,Gx)&&(Qt(this,Gx).video=!1,EI.stopTrackAnalysis()),!0}}Hx=new WeakMap,Gx=new WeakMap;class Zx extends WS{constructor(e){super(),Xt(this,Jx),Xt(this,$x,void 0),Xt(this,qx,void 0),Xt(this,zx,void 0),Kt(this,"preview"),Zt(this,$x,e),Zt(this,qx,!1),Zt(this,zx,!1)}get mediaPermission(){return Qt(this,$x).mediaPermissions.video}getTrackMetadata(){return Qt(this,$x).videoTrack?null:SI.getTrackMetadata()}startTrackAnalysis(){return tr(this,arguments,(function*({preview:e}={preview:!1}){return!!Qt(this,qx)||!!(yield SI.startTrackAnalysis())&&((e||this.preview)&&Zt(this,zx,!0),Zt(this,qx,!0),!0)}))}stopTrackAnalysis(){Qt(this,qx)&&(SI.stopTrackAnalysis(),Zt(this,qx,!1),Qt(this,zx)&&Zt(this,zx,!1))}startPreview(){return tr(this,null,(function*(){let{track:e}=SI;return e||(e=yield er(this,Jx,Kx).call(this)),this.preview||(SI.setTrack(e),this.preview=!0,SI.preview=!0),e}))}stopPreview(){Qt(this,qx)&&Qt(this,zx)&&this.stopTrackAnalysis(),this.preview=!1,SI.preview=!1,SI.cleanup()}cleanup(){Qt(this,qx)&&Qt(this,zx)&&this.stopTrackAnalysis(),this.preview=!1,SI.preview=!1}}$x=new WeakMap,qx=new WeakMap,zx=new WeakMap,Jx=new WeakSet,Kx=function(){return tr(this,null,(function*(){var e;try{const t=Qt(this,$x).getCurrentDevices(),r=null==(e=null==t?void 0:t.video)?void 0:e.deviceId;let i={video:{width:{ideal:1280},height:{ideal:720}}};r&&(i=OC.getVideoConstraints({videoDeviceId:r}));const n=yield OC.getVideoTrack(i);return Qt(this,$x).mediaPermissions.video="ACCEPTED",tE.emit(XS.MEDIA_PERMISSION_UPDATE,{message:Qt(this,$x).mediaPermissions.video,kind:"video"}),n}catch(e){const t=zC("video",e.name,e.message);throw Qt(this,$x).mediaPermissions.video=t,tE.emit(XS.MEDIA_PERMISSION_ERROR,{message:t,constraints:e.constraints,kind:"video"}),new qS("Failed to fetch video track","1700")}}))};class eL{constructor(e){Kt(this,"audio"),Kt(this,"video"),Kt(this,"screenshare"),Kt(this,"network"),this.audio=new Yx(e),this.video=new Zx(e),this.screenshare=new Xx(e),this.network=new Qx}}const tL=e=>{const{type:t,id:r,transport:i,timestamp:n,currentRoundTripTime:s,bytesSent:o,bytesReceived:a,kind:c,jitter:d,packetsLost:l,packetSendDelay:u}=e;switch(t){case"candidate-pair":return{type:t,id:r,transport:i,timestamp:n,rtt:s,bytesSent:o,bytesReceived:a};case"inbound-rtp":return{type:t,id:r,transport:i,timestamp:n,kind:c,jitter:d,packetsLost:l,bytesReceived:a};default:return{type:t,id:r,transport:i,timestamp:n,kind:c,packetSendDelay:u,bytesSent:o}}};class rL{constructor(e){Kt(this,"troubleshooter"),Kt(this,"self"),this.troubleshooter=new eL(e),this.self=e,this.setupEvents()}setupEvents(){tE.on(XS.AUDIO_TRACK_CHANGED,(()=>{var e;this.self.audioTrack&&null!=(e=this.self.audioTrack)&&e.enabled&&HA.setTrack(this.self.audioTrack)})),tE.on(XS.VIDEO_TRACK_CHANGED,(()=>{var e;this.self.videoTrack&&SI.setTrack(null==(e=this.self.videoTrack)?void 0:e.clone())})),tE.on(XS.SCREENSHARE_TRACK_CHANGED,(()=>{var e,t,r,i,n;null!=(e=this.self.screenShareTracks)&&e.audio&&this.self.screenShareTracks.audio.enabled?GA.setTrack(null==(t=this.self.screenShareTracks)?void 0:t.audio):GA.cleanup(),null!=(r=this.self.screenShareTracks)&&r.video?EI.setTrack(null==(n=null==(i=this.self.screenShareTracks)?void 0:i.video)?void 0:n.clone()):EI.cleanup()})),tE.on(XS.AUDIO_TRACK_ANALYSIS,(e=>{this.troubleshooter.audio.emit("audioTrackStats",e)})),tE.on(XS.AUDIO_TRACK_CLOSED,(()=>{this.troubleshooter.audio.emit("audioTrackUpdate",{status:"ended"})})),tE.on(XS.AUDIO_TRACK_CREATED,(()=>{this.troubleshooter.audio.emit("audioTrackUpdate",{status:"live"})})),tE.on(XS.SCREENSHARE_AUDIO_TRACK_ANALYSIS,(e=>{this.troubleshooter.screenshare.emit("audioTrackStats",e)})),tE.on(XS.SCREENSHARE_AUDIO_TRACK_CLOSED,(()=>{this.troubleshooter.screenshare.emit("audioTrackUpdate",{status:"ended"})})),tE.on(XS.SCREENSHARE_AUDIO_TRACK_CREATED,(()=>{this.troubleshooter.screenshare.emit("audioTrackUpdate",{status:"live"})})),tE.on(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS,(e=>{this.troubleshooter.screenshare.emit("videoTrackStats",e)})),tE.on(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR,(()=>{this.troubleshooter.screenshare.stopVideoTrackAnalysis(),EI.cleanup()})),tE.on(XS.SCREENSHARE_VIDEO_TRACK_CLOSED,(()=>{this.troubleshooter.screenshare.emit("videoTrackUpdate",{status:"ended"})})),tE.on(XS.SCREENSHARE_VIDEO_TRACK_CREATED,(()=>{this.troubleshooter.screenshare.emit("videoTrackUpdate",{status:"live"})})),tE.on(XS.VIDEO_TRACK_ANALYSIS,(e=>{this.troubleshooter.video.emit("videoTrackStats",e)})),tE.on(XS.VIDEO_TRACK_ANALYSIS_ERROR,(()=>{this.troubleshooter.video.stopTrackAnalysis(),this.troubleshooter.video.startTrackAnalysis(),this.troubleshooter.video.stopPreview()})),tE.on(XS.VIDEO_TRACK_CLOSED,(()=>{this.troubleshooter.video.cleanup(),this.troubleshooter.video.emit("videoTrackUpdate",{status:"ended"})})),tE.on(XS.VIDEO_TRACK_CREATED,(()=>{this.troubleshooter.video.emit("videoTrackUpdate",{status:"live"})})),tE.on(XS.CANDIDATE_PEER_UPDATE,(e=>{this.troubleshooter.network.emit("connectionDelayStats",tL(e))})),tE.on(XS.INBOUND_RTP_UPDATE,(e=>{this.troubleshooter.audio.emit("audioConsumptionStats",tL(e))})),tE.on(XS.OUTBOUND_RTP_UPDATE,(e=>{this.troubleshooter.audio.emit("audioProductionStats",tL(e))})),tE.on(XS.SEND_TRANSPORT_CLOSED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"send",status:"ended"})})),tE.on(XS.RECV_TRANSPORT_CLOSED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"receive",status:"ended"})})),tE.on(XS.SEND_TRANSPORT_CREATED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"send",status:"live"})})),tE.on(XS.RECV_TRANSPORT_CREATED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"receive",status:"live"})}))}}const iL=class{static handleConnectedRoomsDumpRaw({payload:e}){var t;const r=ub.fromBinary(e),i=r.meetings.map((e=>{var t;return{id:e.id,title:e.title,participants:null!=(t=e.participants)?t:[]}}));return{parentMeeting:{id:r.parentMeeting.id,title:r.parentMeeting.title,participants:null!=(t=r.parentMeeting.participants)?t:[]},meetings:i}}static handleTransferPeerRaw({payload:e}){const t=wb.fromBinary(e);return{authToken:t.authToken,meetingId:t.meetingId}}static handleMovedPeerRaw({payload:e}){const t=bb.fromBinary(e);return{meetingId:t.meetingId,customParticipantId:t.customParticipantId}}static handleConnectedRoomsUpdatedRaw({payload:e}){return fb.fromBinary(e).payloads.map((e=>({id:e.id,title:e.title})))}static handleConnectedRoomsDeletedRaw({payload:e}){return _b.fromBinary(e).payloads}static getConnectedRoomsDump(){return tr(this,null,(function*(){const e=yield iL.socketService.sendMessagePromise(Jw.getConnectedRoomsDump);return iL.handleConnectedRoomsDumpRaw(e)}))}static createConnectedRooms(e){return tr(this,null,(function*(){const{payload:t}=yield iL.socketService.sendMessagePromise(Jw.createConnectedRooms,hb.toBinary({payloads:e}));return fb.fromBinary(t).payloads.map((e=>({id:e.id,title:e.title})))}))}static updateConnectedRooms(e){return tr(this,null,(function*(){}))}static disableConnectedRooms(e){return tr(this,null,(function*(){const t=e.map((e=>({id:e}))),r=yield iL.socketService.sendMessagePromise(Jw.deleteConnectedRooms,yb.toBinary({payloads:t}));return iL.handleConnectedRoomsDeletedRaw(r)}))}static movePeersBetweenRooms(e){return tr(this,null,(function*(){try{const t=yield iL.socketService.sendMessagePromise(Jw.movePeers,Tb.toBinary({sourceMeetingId:e.sourceMeetingId,destinationMeetingId:e.destinationMeetingId,participants:e.participants}));return(new TextDecoder).decode(t.payload).includes("error")?{success:!1,error:"failed to move participants"}:{success:!0}}catch(e){return{success:!1,error:e}}}))}};let nL=iL;Kt(nL,"socketService"),Kt(nL,"currentMeetingId");const sL={codecs:[{kind:"audio",mimeType:"audio/opus",clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc",parameter:""}],parameters:{},preferredPayloadType:100},{kind:"video",mimeType:"video/VP8",clockRate:9e4,rtcpFeedback:[{type:"nack",parameter:""},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb",parameter:""},{type:"transport-cc",parameter:""}],parameters:{"x-google-start-bitrate":1e3},preferredPayloadType:101},{kind:"video",mimeType:"video/rtx",preferredPayloadType:102,clockRate:9e4,parameters:{apt:101},rtcpFeedback:[]},{kind:"video",mimeType:"video/VP9",clockRate:9e4,rtcpFeedback:[{type:"nack",parameter:""},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb",parameter:""},{type:"transport-cc",parameter:""}],parameters:{"profile-id":0,"x-google-start-bitrate":1e3},preferredPayloadType:103},{kind:"video",mimeType:"video/rtx",preferredPayloadType:104,clockRate:9e4,parameters:{apt:103},rtcpFeedback:[]},{kind:"video",mimeType:"video/H264",clockRate:9e4,parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f","x-google-start-bitrate":1e3},rtcpFeedback:[{type:"nack",parameter:""},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb",parameter:""},{type:"transport-cc",parameter:""}],preferredPayloadType:105},{kind:"video",mimeType:"video/rtx",preferredPayloadType:106,clockRate:9e4,parameters:{apt:105},rtcpFeedback:[]}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",preferredId:13,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",preferredId:13,preferredEncrypt:!1,direction:"sendrecv"}]};var oL;class aL{constructor(e){Xt(this,oL,void 0),Zt(this,oL,e)}on(e,t){let r,i;e===Jw.transcript?(r=sT.fromBinary.bind(sT),i=sT.create()):BS.debug("AISocketHandler switch case hit default, event not accounted for."),Qt(this,oL).on(e,(({payload:e})=>{let n=i;try{n=r(e)}catch(e){BS.error("chatSocketHandler::on::binary_decode_error",{error:e})}return t(n)}))}}oL=new WeakMap;var cL=Object.defineProperty,dL=Object.getOwnPropertyDescriptor,lL=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?dL(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&cL(t,r,s),s};const uL=class{constructor(e,t,r,i,n,s,o,a,c,d,l,u,p){Kt(this,"apiBase"),Kt(this,"chatController"),Kt(this,"metaController"),Kt(this,"participantController"),Kt(this,"pluginController"),Kt(this,"pollController"),Kt(this,"remoteController"),Kt(this,"selfController"),Kt(this,"recordingController"),Kt(this,"livestreamController"),Kt(this,"internalsController"),Kt(this,"stageController"),Kt(this,"troubleshooterController"),this.apiBase=e,this.metaController=t,this.selfController=r,this.pluginController=i,this.participantController=n,this.chatController=s,this.pollController=o,this.remoteController=a,this.recordingController=c,this.livestreamController=l,this.internalsController=d,this.stageController=u,this.troubleshooterController=p}static init(e,t){return tr(this,null,(function*(){var r,i,n,s,o,a,c,d,l,u,p,h,m,f,g,v,y;const{authToken:_}=e;let S="https://api.dyte.io";e.apiBase&&(S=e.apiBase),e.baseURI&&(S=`https://api.${e.baseURI}`);const E=qt({chat:!0,participant:!0,plugin:!0,poll:!0,self:!0,meta:!0,permissions:!0,theme:!0,tracing:!0,devTools:{logs:!1},internals:!0,stage:!0,pip:!0},null==e?void 0:e.modules);rd(zt(qt({},e),{modules:E,apiBase:S})),tE.reset(),yC(),LI.cleanup();const T=function(e){return $w=Sw.isV2AuthToken?new Vw(e):new Gw(e),$w}({authToken:_,baseURL:S,cachedUserDetails:e.cachedUserDetails});T.setHeader("dyte-tracing-id",t),T.setPeerId(t),T.setRoomName(e.roomName);const{roomName:b}=e,w=Sw.isV2AuthToken?Sw.meetingId:b,k=new ed,R=k.load({routerRtpCapabilities:sL});if(e.cachedUserDetails&&!Sw.isV2AuthToken)throw new qS("Can only use cached user details with v2 auth tokens");const C=T.getRoomNodeData({roomName:w,peerId:t}),A=Sw.isV2AuthToken?void 0:T.getUserPreset(b),I=yield T.getUserDetails(),P=Sw.isV2AuthToken?I.participant.organizationId:I.organizationId;VS.meetingMetadata.userId=Sw.isV2AuthToken?I.participant.id:I.id,VS.meetingMetadata.organizationId=P;const D=function(e){let t,r,i=0;if(!e)return i;for(t=0;t<e.length;t+=1)r=e.charCodeAt(t),i=(i<<5)-i+r,i|=0;return Math.abs(i)%100+1}(w),M=null!=(r=e.overrides)&&r.whitelabelled_flags_endpoint?sd({servicePrefix:"flags",apiBase:S,baseURI:e.baseURI}):"edge.api.flagsmith.com";yield Ci.identify(`${PS.PEER}_${t}`,JSON.parse(JSON.stringify(qt({entity:PS.PEER,clientId:P,isAnonUser:!P,sdkVersion:id,meetingHash:D,roomName:w},_S.getDeviceInfo()))),!1,5e3,M),function(){_S.isElectron()&&window.dyteElectronGetDisplayMediaSource&&(navigator.mediaDevices.getDisplayMedia=()=>tr(this,null,(function*(){const e=yield window.dyteElectronGetDisplayMediaSource({types:["window","screen"]});let t=[];if(e&&(t=Array.isArray(e)?e:[e]),null==t||!t.length)throw new Error("Couldn't find any media source for screen share.");let r=t.find((e=>{var t;return null==(t=e.id)?void 0:t.includes("screen")}));r=null!=r?r:t[0];const i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r.id}}};return yield navigator.mediaDevices.getUserMedia(i)})))}(),BS.info("flagsmith::allFlags",{flags:JSON.stringify(Ci.getAllFlags())},!0);const{roomNodeUrl:O,meetingTitle:N,useHiveMedia:x}=yield C;yield R,jx.init();let L=Sw.isV2AuthToken?sx.default():_P.default(),j=Sw.isV2AuthToken?ZN.default(L.viewType,x):cE.default(x),U=Sw.isV2AuthToken?I.preset.name:void 0;if(rd(zt(qt({},e),{modules:E,apiBase:S,organizationId:P,viewType:L.viewType})),E.permissions||E.theme){const e=yield A;e&&(U=e.presetName),E.theme&&(L=Sw.isV2AuthToken?sx.fromResponse(I.preset):_P.fromResponse(e.theme),Sw.isV2AuthToken||L.configFromPermissions(e.permissions)),E.permissions&&(j=Sw.isV2AuthToken?ZN.fromResponse(I.preset.permissions,L.viewType,x):cE.fromResponse(e.permissions,x))}const F=TI(L),V=Ci.hasFeature(DS.CUSTOM_PING_PONG),B=[];x&&B.push("HIVE"),V&&B.push("PING");const W=Rw(L.viewType,B),H=T.getPlugins(W),G=L.viewType!==gi.Chat;bw(zt(qt({},e),{roomName:w,peerId:t,meetingTitle:N,roomNodeUrl:O,device:k,useHiveMedia:x})),td.defaults.mediaConfiguration||(td.defaults.mediaConfiguration={}),td.defaults.mediaConfiguration.audio||(td.defaults.mediaConfiguration.audio={}),td.defaults.mediaConfiguration.audio.enableHighBitrate=null!=(n=td.defaults.mediaConfiguration.audio.enableHighBitrate)?n:null==(i=L.mediaConstraints.audio)?void 0:i.enableHighBitrate,td.defaults.mediaConfiguration.audio.enableStereo=null!=(o=td.defaults.mediaConfiguration.audio.enableHighBitrate)?o:null==(s=L.mediaConstraints.audio)?void 0:s.enableStereo;const $=yield uL.createSocketServiceAndRoomNodeClient(zt(qt({},e),{roomName:w,peerId:t,meetingTitle:N,roomNodeUrl:O,capabilities:B,shouldInitializeRoomNode:F,viewType:L.viewType,device:k})),q=_C();let z,J,K,Y,Q,X,Z,ee,te,re,ie,ne;const se=new KD($),oe=new HD($),ae=new Lx($),ce=new EN($),de=new cx($),le=new dx($),ue=new aL($);nL.socketService=$;const pe=LI.create($);null==(a=E.self)||a?([Q]=yield Promise.all([qI.init($,pe,I,j,L,U,!!e.cachedUserDetails),q instanceof fC?q.setupTransports():null]),T.setOrganizationId(Q.self.organizationId)):q instanceof fC&&(yield q.setupTransports());const he=Ci.hasFeature(DS.TROUBLESHOOTING);if(Q&&he&&(ne=new rL(Q.self)),null==(c=E.participant)||c){if(!Q)throw new qS("The participant module cannot be initialized without the `self` module");J=new ZP(Q.self,pe,B,E)}if(null==(d=E.chat)||d){if(!Q)throw new qS("The chat module cannot be initialized without the `self` module");z=yield gM.init(se,oe,Q.self,J.participants,B,!!e.cachedUserDetails)}if(G&&(null==(l=E.plugin)||l)){if(!Q)throw new qS("The plugin module cannot be initialized without the `self` module");if(!J)throw new qS("The plugin module cannot be initialized without the `participant` module");const e=yield H;K=yield CM.init(e,ce,se,null==z?void 0:z.chat,Q.self,J.participants,B)}if(G&&(null==(u=E.poll)||u)){if(!Q)throw new qS("The poll cannot be initialized without the `self` module");Y=yield GM.init(Q.self,ae,B)}if(null==(p=E.meta)||p){if(!Q)throw new qS("The meta module cannot be initialized without the `self` module");X=yield _D.init(Q.self,pe,ue,N)}if(null==(h=E.remoteControl)||h){if(!Q)throw new qS("The remote controller cannot be initialized without the `self` module");Z=new tO(Q.self,J.participants)}if(G&&(null==(m=E.recording)||m)){if(!Q)throw new qS("The recording controller cannot be initialized without the `self` module");ee=new MN(Q.self,pe,Cw(L.viewType,B))}if((null==(f=E.internals)||f)&&(re=yield xN.init()),L.viewType===gi.Livestream&&(null==(g=E.livestream)||g)){if(!Q)throw new qS("The livestream controller cannot be initialized without the `self` module");Ci.hasFeature(DS.LIVESTREAM)&&(te=new $N(Q.self,de))}if(G&&(null==(v=E.stage)||v)){if(!Q)throw new qS("The stage client cannot be initialized without the `self` module");ie=new Dx(le,Q.self,J.participants,X.meta.viewType,q)}if(Cw(L.viewType,B)||"socket-service"===(null==(y=e.overrides)?void 0:y.chat_socket_server))try{yield $.connect()}catch(e){BS.error("[Socket Service] Failed to connect to socket server:",{error:e})}return new uL(S,X,Q,K,J,z,Y,Z,ee,re,te,ie,ne)}))}static createSocketServiceAndRoomNodeClient(e){return tr(this,null,(function*(){const t=uL.createSocketService(e);return e.shouldInitializeRoomNode?e.capabilities.includes("HIVE")?(yield gC(zt(qt({},e),{roomName:e.roomName,peerId:e.peerId,socket:t})),t):(yield vC(zt(qt({},e),{roomName:e.roomName,peerId:e.peerId})),t):t}))}static createSocketService(e){const{peerId:t,roomName:r,authToken:i,capabilities:n}=e;return new _N({peerId:t,roomName:r,authToken:i,capabilities:n})}joinRoom(){return tr(this,null,(function*(){if(!this.selfController.self.roomJoined)return this.selfController.joinRoom()}))}leaveRoom(e="left"){return tr(this,null,(function*(){return jx.cleanup(),this.selfController.leaveRoom(e)}))}};let pL=uL;var hL;lL([VS.trace("Controller.joinRoom")],pL.prototype,"joinRoom",1),lL([VS.trace("Controller.leaveRoom")],pL.prototype,"leaveRoom",1),lL([VS.trace("Controller.init")],pL,"init",1),lL([VS.trace("Controller.createSocketServiceAndRoomNodeClient")],pL,"createSocketServiceAndRoomNodeClient",1),lL([VS.trace("Controller.createSocketService")],pL,"createSocketService",1);class mL extends HS{constructor(e){super(),Xt(this,hL,void 0),Kt(this,"meetings",[]),Kt(this,"parentMeeting",null),Zt(this,hL,e.self)}get supportsConnectedMeetings(){return""!==Qt(this,hL).id&&Sw.isV2AuthToken&&Ci.hasFeature(DS.CONNECTED_MEETINGS)}get isActive(){return 0!==this.meetings.length}get currentMeetingId(){return nL.currentMeetingId}validateConnectedMeetingsAction(){if(!this.supportsConnectedMeetings)throw new Error("You are not allowed to perform this action.\n\t\t\t\t\t\tPlease connect with Dyte team to move you to V2 APIs & to enable connected meetings.")}getConnectedMeetings(){return tr(this,null,(function*(){return this.validateConnectedMeetingsAction(),yield nL.getConnectedRoomsDump()}))}createMeetings(e){return tr(this,null,(function*(){return this.validateConnectedMeetingsAction(),(yield nL.createConnectedRooms(e)).map((e=>({id:e.id,title:e.title})))}))}updateMeetings(e){return tr(this,null,(function*(){this.validateConnectedMeetingsAction(),yield nL.updateConnectedRooms(e.map((e=>({meetingId:e.id,title:e.title}))))}))}deleteMeetings(e){return tr(this,null,(function*(){this.validateConnectedMeetingsAction();const t=this.meetings.map((t=>e.includes(t.id)&&0!==t.participants.length?this.moveParticipants(t.id,this.parentMeeting.id,t.participants.map((e=>e.id))):Promise.resolve()));return yield Promise.all(t),yield nL.disableConnectedRooms(e)}))}moveParticipants(e,t,r){return tr(this,null,(function*(){this.validateConnectedMeetingsAction();const i=new Map;[...this.parentMeeting.participants,...this.meetings.flatMap((e=>e.participants))].forEach((e=>i.set(e.id,e)));const n=yield nL.movePeersBetweenRooms({sourceMeetingId:e,destinationMeetingId:t,participants:r.map((e=>({id:e})))});return n.success&&(t===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.concat(r.map((e=>i.get(e))))),e===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.filter((e=>!r.includes(e.id)))),this.meetings=this.meetings.map((n=>{if(t===n.id){const e=n.participants.concat(r.map((e=>i.get(e))));return zt(qt({},n),{participants:e})}if(e===n.id){const e=n.participants.filter((e=>!r.includes(e.id)));return zt(qt({},n),{participants:e})}return n}))),n}))}}hL=new WeakMap;var fL,gL,vL,yL=Object.defineProperty,_L=Object.getOwnPropertyDescriptor,SL=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?_L(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&yL(t,r,s),s};const EL=(vL=class{constructor(e,t){Kt(this,"connectedMeetings"),Xt(this,fL,void 0),Xt(this,gL,void 0),Zt(this,fL,t),this.connectedMeetings=new mL(e),this.setCurrentMeeting(e)}static init(e,t){return EL.instance||(EL.instance=new EL(e,t)),EL.instance.connectedMeetings.supportsConnectedMeetings&&(EL.instance.setupEvents(),e.self.once("roomJoined",(()=>EL.instance.getConnectedMeetings()))),EL.instance}setCurrentMeeting(e){Zt(this,gL,e),nL.currentMeetingId=e.meta.roomName}getConnectedMeetings(){this.connectedMeetings.getConnectedMeetings()}setupEvents(){nL.socketService&&(nL.socketService.on(Jw.getConnectedRoomsDump,this.handleConnectedRoomsDump.bind(this)),nL.socketService.on(Jw.transferPeer,this.handleTransferPeer.bind(this)),nL.socketService.on(Jw.movedPeer,this.handleMovedPeer.bind(this)),nL.socketService.on(Jw.connectedRoomsUpdated,this.handleConnectedRoomsUpdated.bind(this)),nL.socketService.on(Jw.connectedRoomsDeleted,this.handleConnectedRoomsDeleted.bind(this)))}handleTransferPeer(e){const t=nL.handleTransferPeerRaw(e);return this.switchMeeting(t)}switchMeeting(e){return tr(this,arguments,(function*({authToken:e,meetingId:t}){if(!this.connectedMeetings.supportsConnectedMeetings)throw new Error("You are not allowed to perform this action.\n\t\t\t\t\t\t\t\tPlease connect with Dyte team to move you to V2 APIs & to enable connected meetings.");this.connectedMeetings.emit("changingMeeting",t);const r=Qt(this,gL).self.videoEnabled;yield Qt(this,gL).leave("connected-meeting"),nL.socketService=void 0;const i=yield ML.init({authToken:e,baseURI:Qt(this,fL).baseURI,defaults:zt(qt({},Qt(this,fL).defaults),{video:r,audio:!1}),modules:Qt(this,fL).modules});i.self.setName(Qt(this,gL).self.name);try{yield i.join()}catch(e){VS.addLogInCurrentSpan("error","ConnectedMeetingsController.joinRoom",{error:e})}return this.connectedMeetings.emit("meetingChanged",i),this.setCurrentMeeting(i),i}))}handleConnectedRoomsDump(e){const t=nL.handleConnectedRoomsDumpRaw(e);this.connectedMeetings.meetings=t.meetings.map((e=>({id:e.id,title:e.title,participants:e.participants||[]}))),this.connectedMeetings.parentMeeting={id:t.parentMeeting.id,title:t.parentMeeting.title,participants:t.parentMeeting.participants},this.emitStateUpdate()}handleMovedPeer(e){return nL.handleMovedPeerRaw(e)}handleConnectedRoomsUpdated(e){const t=nL.handleConnectedRoomsUpdatedRaw(e),r=new Map;this.connectedMeetings.meetings.forEach((e=>{r.set(e.id,e)})),t.forEach((e=>{r.has(e.id)?r.get(e.id).title=e.title:r.set(e.id,zt(qt({},e),{participants:[]}))})),this.connectedMeetings.meetings=Array.from(r.values()),this.emitStateUpdate()}handleConnectedRoomsDeleted(e){const t=nL.handleConnectedRoomsDeletedRaw(e).map((e=>e.id));this.connectedMeetings.meetings=this.connectedMeetings.meetings.filter((e=>!t.includes(e.id)))}emitStateUpdate(){this.connectedMeetings.emit("stateUpdate",{meetings:this.connectedMeetings.meetings,parentMeeting:this.connectedMeetings.parentMeeting})}},fL=new WeakMap,gL=new WeakMap,Kt(vL,"instance"),vL);let TL=EL;SL([VS.trace("ConnectedMeetingsController.getConnectedMeetings")],TL.prototype,"getConnectedMeetings",1),SL([VS.trace("ConnectedMeetingsController.setupEvents")],TL.prototype,"setupEvents",1),SL([VS.trace("ConnectedMeetingsController.switchMeeting")],TL.prototype,"switchMeeting",1);var bL,wL,kL,RL,CL,AL=Object.defineProperty,IL=Object.getOwnPropertyDescriptor,PL=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?IL(t,r):t,o=e.length-1;o>=0;o--)(n=e[o])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&AL(t,r,s),s};let DL=(CL=class{constructor(e){Xt(this,kL),Xt(this,bL,void 0),Xt(this,wL,void 0),Zt(this,bL,e)}static init(e){return tr(this,null,(function*(){var t,r,i,n,s,o;(function(e){Sw.overrides=e})(null!=(t=e.overrides)?t:{}),_S.init();const a=u();window.__zone_symbol__DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION=!0,VS.init(a,null==(i=null==(r=e.modules)?void 0:r.tracing)||i),BS.info("DyteClient::init::options",{dyteClientInitOptions:zt(qt({},e),{authToken:`${null==(n=e.authToken)?void 0:n.slice(0,10)}...${null==(s=e.authToken)?void 0:s.slice(-10)}`})}),!navigator.isReactNative&&"undefined"!=typeof window&&(window.addEventListener("error",(e=>{var t;(null==(t=e.filename)||!t.includes("localhost"))&&0!==e.lineno&&BS.error("window::error",{error:e.error},!0)})),window.addEventListener("unhandledrejection",(e=>{var t,r,i,n,s,o,a,c;BS.error("window::unhandledrejection",{error:null==e?void 0:e.reason,networkCall:{url:null==(r=null==(t=null==e?void 0:e.reason)?void 0:t.config)?void 0:r.url,baseURL:null==(n=null==(i=null==e?void 0:e.reason)?void 0:i.config)?void 0:n.baseURL,method:null==(o=null==(s=null==e?void 0:e.reason)?void 0:s.config)?void 0:o.method,status:null==(a=null==e?void 0:e.reason)?void 0:a.status,statusText:null==(c=null==e?void 0:e.reason)?void 0:c.statusText}},!0)})),window.addEventListener("offline",(()=>{BS.info("window::offline")})),window.addEventListener("online",(()=>{BS.info("window::online")}))),function(e,t){if(t)Sw.isV2AuthToken=!1;else try{const{meetingId:t}=JSON.parse(atob(e.split(".")[1]));if(!t)throw Error(`Received V1 auth token ${e}`);Sw.isV2AuthToken=!0,Sw.meetingId=t}catch(t){throw BS.error("constants::setIsV2AuthToken",{error:t,debuggingHint:`Unable to decode auth token: ${e}`},!0),new qS("Invalid auth token")}}(e.authToken,e.roomName),VS.meetingMetadata.roomName=Sw.isV2AuthToken?Sw.meetingId:e.roomName;const c=yield pL.init(zt(qt({},e),{cachedUserDetails:CS(e.cachedUserDetails)}),a),d=new DL(c);return er(o=d,kL,RL).call(o,e),d}))}joinRoom(){return tr(this,null,(function*(){return Qt(this,bL).joinRoom()}))}leaveRoom(e){return tr(this,null,(function*(){return Qt(this,bL).leaveRoom(e)}))}join(){return tr(this,null,(function*(){return Qt(this,bL).joinRoom()}))}leave(e){return tr(this,null,(function*(){return Qt(this,bL).leaveRoom(e)}))}get participants(){var e;return null==(e=Qt(this,bL).participantController)?void 0:e.participants}get self(){var e;return null==(e=Qt(this,bL).selfController)?void 0:e.self}get meta(){var e;return null==(e=Qt(this,bL).metaController)?void 0:e.meta}get ai(){var e;return null==(e=Qt(this,bL).metaController)?void 0:e.ai}get plugins(){var e;return null==(e=Qt(this,bL).pluginController)?void 0:e.plugins}get chat(){var e;return null==(e=Qt(this,bL).chatController)?void 0:e.chat}get polls(){var e;return null==(e=Qt(this,bL).pollController)?void 0:e.polls}get remote(){var e;return null==(e=Qt(this,bL).remoteController)?void 0:e.remote}get connectedMeetings(){var e;return null==(e=Qt(this,wL))?void 0:e.connectedMeetings}get recording(){var e;return null==(e=Qt(this,bL).recordingController)?void 0:e.recording}get livestream(){var e;return null==(e=Qt(this,bL).livestreamController)?void 0:e.livestream}get stage(){var e;return null==(e=Qt(this,bL).stageController)?void 0:e.stage}get troubleshoot(){var e;return null==(e=Qt(this,bL).troubleshooterController)?void 0:e.troubleshooter}get __internals__(){var e;return null==(e=Qt(this,bL).internalsController)?void 0:e.internals}},bL=new WeakMap,wL=new WeakMap,kL=new WeakSet,RL=function(e){Zt(this,wL,TL.init(this,e))},Kt(CL,"DyteSelfMedia",tI),CL);PL([KS((e=>{throw new qS(e.message,"0002")})),qA({methodName:"meeting.join",lockName:"DyteClient.join",timeout:3e3})],DL.prototype,"joinRoom",1),PL([KS((e=>{throw new qS(e.message,"0003")}))],DL.prototype,"leaveRoom",1),PL([KS((e=>{throw new qS(e.message,"0002")})),qA({methodName:"meeting.join",lockName:"DyteClient.join",timeout:3e3})],DL.prototype,"join",1),PL([KS((e=>{throw new qS(e.message,"0003")}))],DL.prototype,"leave",1),PL([KS((e=>{throw new qS(e.message,"0001")})),qA({methodName:"DyteClient.init",lockName:"DyteClient.init",timeout:3e3})],DL,"init",1),DL=PL([KS((e=>{throw new qS(e.message,"0000")}))],DL);const ML=DL},1726:(e,t,r)=>{e.exports=r(760)},9981:(e,t,r)=>{"use strict";var i=r(9395),n=r(6085),s=r(8887),o=r(1223),a=r(1838),c=r(5365),d=r(7337),l=r(1522),u=r(6694),p=r(1947);e.exports=function(e){return new Promise((function(t,r){var h,m=e.data,f=e.headers,g=e.responseType;function v(){e.cancelToken&&e.cancelToken.unsubscribe(h),e.signal&&e.signal.removeEventListener("abort",h)}i.isFormData(m)&&delete f["Content-Type"];var y=new XMLHttpRequest;if(e.auth){var _=e.auth.username||"",S=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";f.Authorization="Basic "+btoa(_+":"+S)}var E=a(e.baseURL,e.url);function T(){if(y){var i="getAllResponseHeaders"in y?c(y.getAllResponseHeaders()):null,s={data:g&&"text"!==g&&"json"!==g?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:i,config:e,request:y};n((function(e){t(e),v()}),(function(e){r(e),v()}),s),y=null}}if(y.open(e.method.toUpperCase(),o(E,e.params,e.paramsSerializer),!0),y.timeout=e.timeout,"onloadend"in y?y.onloadend=T:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(T)},y.onabort=function(){y&&(r(l("Request aborted",e,"ECONNABORTED",y)),y=null)},y.onerror=function(){r(l("Network Error",e,null,y)),y=null},y.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",i=e.transitional||u.transitional;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(l(t,e,i.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",y)),y=null},i.isStandardBrowserEnv()){var b=(e.withCredentials||d(E))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;b&&(f[e.xsrfHeaderName]=b)}"setRequestHeader"in y&&i.forEach(f,(function(e,t){void 0===m&&"content-type"===t.toLowerCase()?delete f[t]:y.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(y.withCredentials=!!e.withCredentials),g&&"json"!==g&&(y.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&y.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(h=function(e){y&&(r(!e||e&&e.type?new p("canceled"):e),y.abort(),y=null)},e.cancelToken&&e.cancelToken.subscribe(h),e.signal&&(e.signal.aborted?h():e.signal.addEventListener("abort",h))),m||(m=null),y.send(m)}))}},760:(e,t,r)=>{"use strict";var i=r(9395),n=r(1269),s=r(994),o=r(6654),a=function e(t){var r=new s(t),a=n(s.prototype.request,r);return i.extend(a,s.prototype,r),i.extend(a,r),a.create=function(r){return e(o(t,r))},a}(r(6694));a.Axios=s,a.Cancel=r(1947),a.CancelToken=r(4946),a.isCancel=r(8895),a.VERSION=r(6824).version,a.all=function(e){return Promise.all(e)},a.spread=r(7941),a.isAxiosError=r(442),e.exports=a,e.exports.default=a},1947:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4946:(e,t,r)=>{"use strict";var i=r(1947);function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,i=r._listeners.length;for(t=0;t<i;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,i=new Promise((function(e){r.subscribe(e),t=e})).then(e);return i.cancel=function(){r.unsubscribe(t)},i},e((function(e){r.reason||(r.reason=new i(e),t(r.reason))}))}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},n.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},n.source=function(){var e;return{token:new n((function(t){e=t})),cancel:e}},e.exports=n},8895:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},994:(e,t,r)=>{"use strict";var i=r(9395),n=r(1223),s=r(6976),o=r(2259),a=r(6654),c=r(8630),d=c.validators;function l(e){this.defaults=e,this.interceptors={request:new s,response:new s}}l.prototype.request=function(e,t){if("string"==typeof e?(t=t||{}).url=e:t=e||{},!t.url)throw new Error("Provided config url is not valid");(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&c.assertOptions(r,{silentJSONParsing:d.transitional(d.boolean),forcedJSONParsing:d.transitional(d.boolean),clarifyTimeoutError:d.transitional(d.boolean)},!1);var i=[],n=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(n=n&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));var s,l=[];if(this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)})),!n){var u=[o,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(l),s=Promise.resolve(t);u.length;)s=s.then(u.shift(),u.shift());return s}for(var p=t;i.length;){var h=i.shift(),m=i.shift();try{p=h(p)}catch(e){m(e);break}}try{s=o(p)}catch(e){return Promise.reject(e)}for(;l.length;)s=s.then(l.shift(),l.shift());return s},l.prototype.getUri=function(e){if(!e.url)throw new Error("Provided config url is not valid");return e=a(this.defaults,e),n(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,r){return this.request(a(r||{},{method:e,url:t,data:(r||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,r,i){return this.request(a(i||{},{method:e,url:t,data:r}))}})),e.exports=l},6976:(e,t,r)=>{"use strict";var i=r(9395);function n(){this.handlers=[]}n.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=n},1838:(e,t,r)=>{"use strict";var i=r(1810),n=r(6091);e.exports=function(e,t){return e&&!i(t)?n(e,t):t}},1522:(e,t,r)=>{"use strict";var i=r(2062);e.exports=function(e,t,r,n,s){var o=new Error(e);return i(o,t,r,n,s)}},2259:(e,t,r)=>{"use strict";var i=r(9395),n=r(5752),s=r(8895),o=r(6694),a=r(1947);function c(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return c(e),e.headers=e.headers||{},e.data=n.call(e,e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return c(e),t.data=n.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(c(e),t&&t.response&&(t.response.data=n.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},2062:e=>{"use strict";e.exports=function(e,t,r,i,n){return e.config=t,r&&(e.code=r),e.request=i,e.response=n,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},6654:(e,t,r)=>{"use strict";var i=r(9395);e.exports=function(e,t){t=t||{};var r={};function n(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function s(r){return i.isUndefined(t[r])?i.isUndefined(e[r])?void 0:n(void 0,e[r]):n(e[r],t[r])}function o(e){if(!i.isUndefined(t[e]))return n(void 0,t[e])}function a(r){return i.isUndefined(t[r])?i.isUndefined(e[r])?void 0:n(void 0,e[r]):n(void 0,t[r])}function c(r){return r in t?n(e[r],t[r]):r in e?n(void 0,e[r]):void 0}var d={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return i.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=d[e]||s,n=t(e);i.isUndefined(n)&&t!==c||(r[e]=n)})),r}},6085:(e,t,r)=>{"use strict";var i=r(1522);e.exports=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(i("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},5752:(e,t,r)=>{"use strict";var i=r(9395),n=r(6694);e.exports=function(e,t,r){var s=this||n;return i.forEach(r,(function(r){e=r.call(s,e,t)})),e}},6694:(e,t,r)=>{"use strict";var i=r(9395),n=r(9489),s=r(2062),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,d={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=r(9981)),c),transformRequest:[function(e,t){return n(t,"Accept"),n(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)||t&&"application/json"===t["Content-Type"]?(a(t,"application/json"),function(e,t,r){if(i.isString(e))try{return(0,JSON.parse)(e),i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||d.transitional,r=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,o=!r&&"json"===this.responseType;if(o||n&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw s(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function(e){d.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){d.headers[e]=i.merge(o)})),e.exports=d},6824:e=>{e.exports={version:"0.25.0"}},1269:e=>{"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];return e.apply(t,r)}}},1223:(e,t,r)=>{"use strict";var i=r(9395);function n(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(i.isURLSearchParams(t))s=t.toString();else{var o=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),o.push(n(t)+"="+n(e))})))})),s=o.join("&")}if(s){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},6091:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},8887:(e,t,r)=>{"use strict";var i=r(9395);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,r,n,s,o){var a=[];a.push(e+"="+encodeURIComponent(t)),i.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),i.isString(n)&&a.push("path="+n),i.isString(s)&&a.push("domain="+s),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1810:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},442:(e,t,r)=>{"use strict";var i=r(9395);e.exports=function(e){return i.isObject(e)&&!0===e.isAxiosError}},7337:(e,t,r)=>{"use strict";var i=r(9395);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var i=e;return t&&(r.setAttribute("href",i),i=r.href),r.setAttribute("href",i),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=i.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},9489:(e,t,r)=>{"use strict";var i=r(9395);e.exports=function(e,t){i.forEach(e,(function(r,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[i])}))}},5365:(e,t,r)=>{"use strict";var i=r(9395),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,s,o={};return e?(i.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=i.trim(e.substr(0,s)).toLowerCase(),r=i.trim(e.substr(s+1)),t){if(o[t]&&n.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o}},7941:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},8630:(e,t,r)=>{"use strict";var i=r(6824).version,n={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){n[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var s={};n.transitional=function(e,t,r){function n(e,t){return"[Axios v"+i+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,i,o){if(!1===e)throw new Error(n(i," has been removed"+(t?" in "+t:"")));return t&&!s[i]&&(s[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}},e.exports={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),n=i.length;n-- >0;){var s=i[n],o=t[s];if(o){var a=e[s],c=void 0===a||o(a,s,e);if(!0!==c)throw new TypeError("option "+s+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+s)}},validators:n}},9395:(e,t,r)=>{"use strict";var i=r(1269),n=Object.prototype.toString;function s(e){return Array.isArray(e)}function o(e){return void 0===e}function a(e){return"[object ArrayBuffer]"===n.call(e)}function c(e){return null!==e&&"object"==typeof e}function d(e){if("[object Object]"!==n.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===n.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}e.exports={isArray:s,isArrayBuffer:a,isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===n.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&a(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:c,isPlainObject:d,isUndefined:o,isDate:function(e){return"[object Date]"===n.call(e)},isFile:function(e){return"[object File]"===n.call(e)},isBlob:function(e){return"[object Blob]"===n.call(e)},isFunction:l,isStream:function(e){return c(e)&&l(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===n.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,i){d(t[i])&&d(r)?t[i]=e(t[i],r):d(r)?t[i]=e({},r):s(r)?t[i]=r.slice():t[i]=r}for(var i=0,n=arguments.length;i<n;i++)u(arguments[i],r);return t},extend:function(e,t,r){return u(t,(function(t,n){e[n]=r&&"function"==typeof t?i(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},4856:(e,t,r)=>{"use strict";r.d(t,{X:()=>s});var i=r(8168),n=r(5419);function s(e,t,r){return void 0===e||(0,n.g)(e)?t:(0,i.A)({},t,{ownerState:(0,i.A)({},t.ownerState,r)})}},4718:(e,t,r)=>{"use strict";function i(e,t=[]){if(void 0===e)return{};const r={};return Object.keys(e).filter((r=>r.match(/^on[A-Z]/)&&"function"==typeof e[r]&&!t.includes(r))).forEach((t=>{r[t]=e[t]})),r}r.d(t,{h:()=>i})},5419:(e,t,r)=>{"use strict";function i(e){return"string"==typeof e}r.d(t,{g:()=>i})},3551:(e,t,r)=>{"use strict";r.d(t,{p:()=>a});var i=r(8168),n=r(4164),s=r(4718);function o(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"==typeof e[t]))).forEach((r=>{t[r]=e[r]})),t}function a(e){const{getSlotProps:t,additionalProps:r,externalSlotProps:a,externalForwardedProps:c,className:d}=e;if(!t){const e=(0,n.A)(null==r?void 0:r.className,d,null==c?void 0:c.className,null==a?void 0:a.className),t=(0,i.A)({},null==r?void 0:r.style,null==c?void 0:c.style,null==a?void 0:a.style),s=(0,i.A)({},r,c,a);return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const l=(0,s.h)((0,i.A)({},c,a)),u=o(a),p=o(c),h=t(l),m=(0,n.A)(null==h?void 0:h.className,null==r?void 0:r.className,d,null==c?void 0:c.className,null==a?void 0:a.className),f=(0,i.A)({},null==h?void 0:h.style,null==r?void 0:r.style,null==c?void 0:c.style,null==a?void 0:a.style),g=(0,i.A)({},h,r,p,u);return m.length>0&&(g.className=m),Object.keys(f).length>0&&(g.style=f),{props:g,internalRef:h.ref}}},5489:(e,t,r)=>{"use strict";function i(e,t,r){return"function"==typeof e?e(t,r):e}r.d(t,{Y:()=>i})},3753:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M20 3h-1V2c0-.55-.45-1-1-1s-1 .45-1 1v1H7V2c0-.55-.45-1-1-1s-1 .45-1 1v1H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-1 18H5c-.55 0-1-.45-1-1V8h16v12c0 .55-.45 1-1 1"}),"CalendarTodayRounded")},7195:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"m4.51 15.48 2-1.59c.48-.38.76-.96.76-1.57v-2.6c3.02-.98 6.29-.99 9.32 0v2.61c0 .61.28 1.19.76 1.57l1.99 1.58c.8.63 1.94.57 2.66-.15l1.22-1.22c.8-.8.8-2.13-.05-2.88-6.41-5.66-16.07-5.66-22.48 0-.85.75-.85 2.08-.05 2.88l1.22 1.22c.71.72 1.85.78 2.65.15"}),"CallEndRounded")},1031:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79zm9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75zM7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1"}),"CallOutlined")},1832:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"m19.23 15.26-2.54-.29c-.61-.07-1.21.14-1.64.57l-1.84 1.84c-2.83-1.44-5.15-3.75-6.59-6.59l1.85-1.85c.43-.43.64-1.03.57-1.64l-.29-2.52c-.12-1.01-.97-1.77-1.99-1.77H5.03c-1.13 0-2.07.94-2 2.07.53 8.54 7.36 15.36 15.89 15.89 1.13.07 2.07-.87 2.07-2v-1.73c.01-1.01-.75-1.86-1.76-1.98"}),"CallRounded")},4115:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M21.29 4.12 16.7 8.71l1.59 1.59c.63.63.18 1.71-.71 1.71H13c-.55 0-1-.45-1-1v-4.6c0-.89 1.08-1.34 1.71-.71l1.59 1.59 4.59-4.59c.39-.39 1.02-.39 1.41 0 .38.4.38 1.03-.01 1.42M4.12 21.29l4.59-4.59 1.59 1.59c.63.63 1.71.18 1.71-.71V13c0-.55-.45-1-1-1h-4.6c-.89 0-1.34 1.08-.71 1.71l1.59 1.59-4.59 4.59c-.39.39-.39 1.02 0 1.41.4.38 1.03.38 1.42-.01"}),"CloseFullscreenRounded")},9696:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M18.3 5.71a.9959.9959 0 0 0-1.41 0L12 10.59 7.11 5.7a.9959.9959 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"}),"CloseRounded")},6398:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M8 18c.55 0 1-.45 1-1V7c0-.55-.45-1-1-1s-1 .45-1 1v10c0 .55.45 1 1 1m4 4c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1s-1 .45-1 1v18c0 .55.45 1 1 1m-8-8c.55 0 1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1v2c0 .55.45 1 1 1m12 4c.55 0 1-.45 1-1V7c0-.55-.45-1-1-1s-1 .45-1 1v10c0 .55.45 1 1 1m3-7v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1"}),"GraphicEqRounded")},6099:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M13.89 8.7 12 10.59 10.11 8.7a.9959.9959 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 8.7 13.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l1.89 1.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l1.89-1.89c.39-.39.39-1.02 0-1.41-.39-.38-1.03-.38-1.41 0M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"HighlightOffRounded")},6862:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M8.12 9.29 12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7a.9959.9959 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"}),"KeyboardArrowDownRounded")},5979:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"m19.23 15.26-2.54-.29c-.61-.07-1.21.14-1.64.57l-1.84 1.84c-2.83-1.44-5.15-3.75-6.59-6.59l1.85-1.85c.43-.43.64-1.03.57-1.64l-.29-2.52c-.12-1.01-.97-1.77-1.99-1.77H5.03c-1.13 0-2.07.94-2 2.07.53 8.54 7.36 15.36 15.89 15.89 1.13.07 2.07-.87 2.07-2v-1.73c.01-1.01-.75-1.86-1.76-1.98"}),"LocalPhoneRounded")},2250:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic")},2862:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92z"}),"MicNoneOutlined")},1809:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff")},1783:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M15 10.6V5c0-1.66-1.34-3-3-3-1.54 0-2.79 1.16-2.96 2.65zm3.08.4c-.41 0-.77.3-.83.71-.05.32-.12.64-.22.93l1.27 1.27c.3-.6.52-1.25.63-1.94.07-.51-.33-.97-.85-.97M3.71 3.56c-.39.39-.39 1.02 0 1.41L9 10.27v.43c0 1.19.6 2.32 1.63 2.91.75.43 1.41.44 2.02.31l1.66 1.66c-.71.33-1.5.52-2.31.52-2.54 0-4.88-1.77-5.25-4.39-.06-.41-.42-.71-.83-.71-.52 0-.92.46-.85.97.46 2.96 2.96 5.3 5.93 5.75V20c0 .55.45 1 1 1s1-.45 1-1v-2.28c.91-.13 1.77-.45 2.55-.9l3.49 3.49c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L5.12 3.56a.9959.9959 0 0 0-1.41 0"}),"MicOffRounded")},2561:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14"}),"MicRounded")},3748:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M14.91 6.71a.9959.9959 0 0 0-1.41 0L8.91 11.3c-.39.39-.39 1.02 0 1.41l4.59 4.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L11.03 12l3.88-3.88c.38-.39.38-1.03 0-1.41"}),"NavigateBeforeRounded")},5042:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M9.31 6.71c-.39.39-.39 1.02 0 1.41L13.19 12l-3.88 3.88c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l4.59-4.59c.39-.39.39-1.02 0-1.41L10.72 6.7c-.38-.38-1.02-.38-1.41.01"}),"NavigateNextRounded")},3754:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M21 8.59V4c0-.55-.45-1-1-1h-4.59c-.89 0-1.34 1.08-.71 1.71l1.59 1.59-10 10-1.59-1.59c-.62-.63-1.7-.19-1.7.7V20c0 .55.45 1 1 1h4.59c.89 0 1.34-1.08.71-1.71L7.71 17.7l10-10 1.59 1.59c.62.63 1.7.19 1.7-.7"}),"OpenInFullRounded")},5024:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M10 16c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1s-1 .45-1 1v6c0 .55.45 1 1 1m2-14C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m2-4c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1s-1 .45-1 1v6c0 .55.45 1 1 1"}),"PauseCircleOutlineRounded")},6707:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M23.09 16.2c-6.33-5.59-15.86-5.59-22.18 0-.84.74-.84 2.05-.05 2.84l1.2 1.2c.71.71 1.84.77 2.62.15l1.97-1.57c.47-.37.75-.94.75-1.55V14.7c2.98-.97 6.21-.98 9.2 0v2.58c0 .6.28 1.17.75 1.55l1.96 1.56c.79.62 1.91.56 2.62-.15l1.2-1.2c.8-.79.79-2.1-.04-2.84M6 9c.55 0 1-.45 1-1V6.43l4.24 4.24c.39.39 1.02.39 1.41 0l5.66-5.66c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0l-4.95 4.95L8.4 5H10c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1"}),"PhoneMissedRounded")},9521:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18c.62-.39.62-1.29 0-1.69L9.54 5.98C8.87 5.55 8 6.03 8 6.82"}),"PlayArrowRounded")},8104:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"m10.8 15.9 4.67-3.5c.27-.2.27-.6 0-.8L10.8 8.1c-.33-.25-.8-.01-.8.4v7c0 .41.47.65.8.4M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"PlayCircleOutlineRounded")},2717:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonChecked")},3572:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"ReplayOutlined")},8636:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2zM4 16V6h16v10.01zm9-6.87c-3.89.54-5.44 3.2-6 5.87 1.39-1.87 3.22-2.72 6-2.72v2.19l4-3.74L13 7z"}),"ScreenShareOutlined")},6526:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"m3.4 20.4 17.45-7.48c.81-.35.81-1.49 0-1.84L3.4 3.6c-.66-.29-1.39.2-1.39.91L2 9.12c0 .5.37.93.87.99L17 12 2.87 13.88c-.5.07-.87.5-.87 1l.01 4.61c0 .71.73 1.2 1.39.91"}),"SendRounded")},8947:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m4-4H8V8h8z"}),"StopCircleOutlined")},1756:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"m9.56 8-2-2-4.15-4.14L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.55-.18L19.73 21l1.41-1.41-8.86-8.86zM5 16V8h1.73l8 8zm10-8v2.61l6 6V6.5l-4 4V7c0-.55-.45-1-1-1h-5.61l2 2z"}),"VideocamOffOutlined")},6493:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M15 8v8H5V8zm1-2H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4V7c0-.55-.45-1-1-1"}),"VideocamOutlined")},7149:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)((0,s.jsx)("path",{d:"M3 10v4c0 .55.45 1 1 1h3l3.29 3.29c.63.63 1.71.18 1.71-.71V6.41c0-.89-1.08-1.34-1.71-.71L7 9H4c-.55 0-1 .45-1 1m13.5 2c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 4.45v.2c0 .38.25.71.6.85C17.18 6.53 19 9.06 19 12s-1.82 5.47-4.4 6.5c-.36.14-.6.47-.6.85v.2c0 .63.63 1.07 1.21.85C18.6 19.11 21 15.84 21 12s-2.4-7.11-5.79-8.4c-.58-.23-1.21.22-1.21.85"}),"VolumeUpRounded")},2480:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)([(0,s.jsx)("path",{d:"M4 19V8h16v3.29c.72.22 1.4.54 2 .97V8c0-1.11-.89-2-2-2h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h7.68c-.3-.62-.5-1.29-.6-2zm6-15h4v2h-4z"},"0"),(0,s.jsx)("path",{d:"M18 13c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m1.65 7.35L17.5 18.2V15h1v2.79l1.85 1.85z"},"1")],"WorkHistoryOutlined")},4285:(e,t,r)=>{"use strict";var i=r(4994);t.A=void 0;var n=i(r(2032)),s=r(4848);t.A=(0,n.default)([(0,s.jsx)("path",{d:"M18 11c1.49 0 2.87.47 4 1.26V8c0-1.11-.89-2-2-2h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h7.68c-.43-.91-.68-1.92-.68-3 0-3.87 3.13-7 7-7m-8-7h4v2h-4z"},"0"),(0,s.jsx)("path",{d:"M18 13c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m1.65 7.35L17.5 18.2V15h1v2.79l1.85 1.85z"},"1")],"WorkHistoryRounded")},2032:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.createSvgIcon}});var i=r(3743)},8393:(e,t,r)=>{"use strict";r.d(t,{A:()=>C});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(1848),d=r(3541),l=r(5003),u=r(4848);const p=(0,l.A)((0,u.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");var h=r(7553),m=r(7245);function f(e){return(0,m.Ay)("MuiAvatar",e)}(0,h.A)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var g=r(4871),v=r(5489),y=r(3551),_=r(4856);const S=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],E=["component","slots","slotProps"],T=["component"],b=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],w=(0,c.Ay)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],r.colorDefault&&t.colorDefault]}})((({theme:e})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(e.vars||e).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:(0,n.A)({color:(e.vars||e).palette.background.default},e.vars?{backgroundColor:e.vars.palette.Avatar.defaultBg}:(0,n.A)({backgroundColor:e.palette.grey[400]},e.applyStyles("dark",{backgroundColor:e.palette.grey[600]})))}]}))),k=(0,c.Ay)("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,t)=>t.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),R=(0,c.Ay)(p,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,t)=>t.fallback})({width:"75%",height:"75%"}),C=s.forwardRef((function(e,t){const r=(0,d.A)({props:e,name:"MuiAvatar"}),{alt:c,children:l,className:p,component:h="div",slots:m={},slotProps:C={},imgProps:A,sizes:I,src:P,srcSet:D,variant:M="circular"}=r,O=(0,i.A)(r,b);let N=null;const x=function({crossOrigin:e,referrerPolicy:t,src:r,srcSet:i}){const[n,o]=s.useState(!1);return s.useEffect((()=>{if(!r&&!i)return;o(!1);let n=!0;const s=new Image;return s.onload=()=>{n&&o("loaded")},s.onerror=()=>{n&&o("error")},s.crossOrigin=e,s.referrerPolicy=t,s.src=r,i&&(s.srcset=i),()=>{n=!1}}),[e,t,r,i]),n}((0,n.A)({},A,{src:P,srcSet:D})),L=P||D,j=L&&"error"!==x,U=(0,n.A)({},r,{colorDefault:!j,component:h,variant:M}),F=(e=>{const{classes:t,variant:r,colorDefault:i}=e,n={root:["root",r,i&&"colorDefault"],img:["img"],fallback:["fallback"]};return(0,a.A)(n,f,t)})(U),[V,B]=function(e,t){const{className:r,elementType:s,ownerState:o,externalForwardedProps:a,getSlotOwnerState:c,internalForwardedProps:d}=t,l=(0,i.A)(t,S),{component:u,slots:p={[e]:void 0},slotProps:h={[e]:void 0}}=a,m=(0,i.A)(a,E),f=p[e]||s,b=(0,v.Y)(h[e],o),w=(0,y.p)((0,n.A)({className:r},l,{externalForwardedProps:"root"===e?m:void 0,externalSlotProps:b})),{props:{component:k},internalRef:R}=w,C=(0,i.A)(w.props,T),A=(0,g.A)(R,null==b?void 0:b.ref,t.ref),I=c?c(C):{},P=(0,n.A)({},o,I),D="root"===e?k||u:k,M=(0,_.X)(f,(0,n.A)({},"root"===e&&!u&&!p[e]&&d,"root"!==e&&!p[e]&&d,C,D&&{as:D},{ref:A}),P);return Object.keys(I).forEach((e=>{delete M[e]})),[f,M]}("img",{className:F.img,elementType:k,externalForwardedProps:{slots:m,slotProps:{img:(0,n.A)({},A,C.img)}},additionalProps:{alt:c,src:P,srcSet:D,sizes:I},ownerState:U});return N=j?(0,u.jsx)(V,(0,n.A)({},B)):l||0===l?l:L&&c?c[0]:(0,u.jsx)(R,{ownerState:U,className:F.fallback}),(0,u.jsx)(w,(0,n.A)({as:h,ownerState:U,className:(0,o.A)(F.root,p),ref:t},O,{children:N}))}))},9067:(e,t,r)=>{"use strict";r.d(t,{A:()=>_});var i=r(8168),n=r(8587),s=r(6540),o=r(4164),a=r(4317),c=r(3571),d=r(9599),l=r(2858),u=r(4848);const p=["className","component"];var h=r(2067),m=r(3333),f=r(8312);const g=(0,r(7553).A)("MuiBox",["root"]),v=(0,m.A)(),y=function(e={}){const{themeId:t,defaultTheme:r,defaultClassName:h="MuiBox-root",generateClassName:m}=e,f=(0,a.Ay)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(c.A);return s.forwardRef((function(e,s){const a=(0,l.A)(r),c=(0,d.A)(e),{className:g,component:v="div"}=c,y=(0,n.A)(c,p);return(0,u.jsx)(f,(0,i.A)({as:v,ref:s,className:(0,o.A)(g,m?m(h):h),theme:t&&a[t]||a},y))}))}({themeId:f.A,defaultTheme:v,defaultClassName:g.root,generateClassName:h.A.generate}),_=y},6990:(e,t,r)=>{"use strict";r.d(t,{A:()=>R});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(6311),c=r(4111),d=r(4279),l=r(1848),u=r(3541),p=r(8941),h=r(8466),m=r(7553),f=r(7245);function g(e){return(0,f.Ay)("MuiButton",e)}const v=(0,m.A)("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),y=s.createContext({}),_=s.createContext(void 0);var S=r(4848);const E=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],T=e=>(0,n.A)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),b=(0,l.Ay)(p.A,{shouldForwardProp:e=>(0,l.ep)(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`${r.variant}${(0,h.A)(r.color)}`],t[`size${(0,h.A)(r.size)}`],t[`${r.variant}Size${(0,h.A)(r.size)}`],"inherit"===r.color&&t.colorInherit,r.disableElevation&&t.disableElevation,r.fullWidth&&t.fullWidth]}})((({theme:e,ownerState:t})=>{var r,i;const s="light"===e.palette.mode?e.palette.grey[300]:e.palette.grey[800],o="light"===e.palette.mode?e.palette.grey.A100:e.palette.grey[700];return(0,n.A)({},e.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),"&:hover":(0,n.A)({textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,d.X4)(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===t.variant&&"inherit"!==t.color&&{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,d.X4)(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===t.variant&&"inherit"!==t.color&&{border:`1px solid ${(e.vars||e).palette[t.color].main}`,backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,d.X4)(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===t.variant&&{backgroundColor:e.vars?e.vars.palette.Button.inheritContainedHoverBg:o,boxShadow:(e.vars||e).shadows[4],"@media (hover: none)":{boxShadow:(e.vars||e).shadows[2],backgroundColor:(e.vars||e).palette.grey[300]}},"contained"===t.variant&&"inherit"!==t.color&&{backgroundColor:(e.vars||e).palette[t.color].dark,"@media (hover: none)":{backgroundColor:(e.vars||e).palette[t.color].main}}),"&:active":(0,n.A)({},"contained"===t.variant&&{boxShadow:(e.vars||e).shadows[8]}),[`&.${v.focusVisible}`]:(0,n.A)({},"contained"===t.variant&&{boxShadow:(e.vars||e).shadows[6]}),[`&.${v.disabled}`]:(0,n.A)({color:(e.vars||e).palette.action.disabled},"outlined"===t.variant&&{border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"contained"===t.variant&&{color:(e.vars||e).palette.action.disabled,boxShadow:(e.vars||e).shadows[0],backgroundColor:(e.vars||e).palette.action.disabledBackground})},"text"===t.variant&&{padding:"6px 8px"},"text"===t.variant&&"inherit"!==t.color&&{color:(e.vars||e).palette[t.color].main},"outlined"===t.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===t.variant&&"inherit"!==t.color&&{color:(e.vars||e).palette[t.color].main,border:e.vars?`1px solid rgba(${e.vars.palette[t.color].mainChannel} / 0.5)`:`1px solid ${(0,d.X4)(e.palette[t.color].main,.5)}`},"contained"===t.variant&&{color:e.vars?e.vars.palette.text.primary:null==(r=(i=e.palette).getContrastText)?void 0:r.call(i,e.palette.grey[300]),backgroundColor:e.vars?e.vars.palette.Button.inheritContainedBg:s,boxShadow:(e.vars||e).shadows[2]},"contained"===t.variant&&"inherit"!==t.color&&{color:(e.vars||e).palette[t.color].contrastText,backgroundColor:(e.vars||e).palette[t.color].main},"inherit"===t.color&&{color:"inherit",borderColor:"currentColor"},"small"===t.size&&"text"===t.variant&&{padding:"4px 5px",fontSize:e.typography.pxToRem(13)},"large"===t.size&&"text"===t.variant&&{padding:"8px 11px",fontSize:e.typography.pxToRem(15)},"small"===t.size&&"outlined"===t.variant&&{padding:"3px 9px",fontSize:e.typography.pxToRem(13)},"large"===t.size&&"outlined"===t.variant&&{padding:"7px 21px",fontSize:e.typography.pxToRem(15)},"small"===t.size&&"contained"===t.variant&&{padding:"4px 10px",fontSize:e.typography.pxToRem(13)},"large"===t.size&&"contained"===t.variant&&{padding:"8px 22px",fontSize:e.typography.pxToRem(15)},t.fullWidth&&{width:"100%"})}),(({ownerState:e})=>e.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${v.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${v.disabled}`]:{boxShadow:"none"}})),w=(0,l.Ay)("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.startIcon,t[`iconSize${(0,h.A)(r.size)}`]]}})((({ownerState:e})=>(0,n.A)({display:"inherit",marginRight:8,marginLeft:-4},"small"===e.size&&{marginLeft:-2},T(e)))),k=(0,l.Ay)("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.endIcon,t[`iconSize${(0,h.A)(r.size)}`]]}})((({ownerState:e})=>(0,n.A)({display:"inherit",marginRight:-4,marginLeft:8},"small"===e.size&&{marginRight:-2},T(e)))),R=s.forwardRef((function(e,t){const r=s.useContext(y),d=s.useContext(_),l=(0,a.A)(r,e),p=(0,u.A)({props:l,name:"MuiButton"}),{children:m,color:f="primary",component:v="button",className:T,disabled:R=!1,disableElevation:C=!1,disableFocusRipple:A=!1,endIcon:I,focusVisibleClassName:P,fullWidth:D=!1,size:M="medium",startIcon:O,type:N,variant:x="text"}=p,L=(0,i.A)(p,E),j=(0,n.A)({},p,{color:f,component:v,disabled:R,disableElevation:C,disableFocusRipple:A,fullWidth:D,size:M,type:N,variant:x}),U=(e=>{const{color:t,disableElevation:r,fullWidth:i,size:s,variant:o,classes:a}=e,d={root:["root",o,`${o}${(0,h.A)(t)}`,`size${(0,h.A)(s)}`,`${o}Size${(0,h.A)(s)}`,"inherit"===t&&"colorInherit",r&&"disableElevation",i&&"fullWidth"],label:["label"],startIcon:["startIcon",`iconSize${(0,h.A)(s)}`],endIcon:["endIcon",`iconSize${(0,h.A)(s)}`]},l=(0,c.A)(d,g,a);return(0,n.A)({},a,l)})(j),F=O&&(0,S.jsx)(w,{className:U.startIcon,ownerState:j,children:O}),V=I&&(0,S.jsx)(k,{className:U.endIcon,ownerState:j,children:I}),B=d||"";return(0,S.jsxs)(b,(0,n.A)({ownerState:j,className:(0,o.A)(r.className,U.root,T,B),component:v,disabled:R,focusRipple:!A,focusVisibleClassName:(0,o.A)(U.focusVisible,P),ref:t,type:N},L,{classes:U,children:[F,m,V]}))}))},8941:(e,t,r)=>{"use strict";r.d(t,{A:()=>$});var i=r(8168),n=r(8587),s=r(6540),o=r(4164),a=r(4111),c=r(1848),d=r(3541),l=r(6852),u=r(3034),p=r(8851);function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}const m=s.createContext(null);function f(e,t){var r=Object.create(null);return e&&s.Children.map(e,(function(e){return e})).forEach((function(e){r[e.key]=function(e){return t&&(0,s.isValidElement)(e)?t(e):e}(e)})),r}function g(e,t,r){return null!=r[t]?r[t]:e.props[t]}function v(e,t,r){var i=f(e.children),n=function(e,t){function r(r){return r in t?t[r]:e[r]}e=e||{},t=t||{};var i,n=Object.create(null),s=[];for(var o in e)o in t?s.length&&(n[o]=s,s=[]):s.push(o);var a={};for(var c in t){if(n[c])for(i=0;i<n[c].length;i++){var d=n[c][i];a[n[c][i]]=r(d)}a[c]=r(c)}for(i=0;i<s.length;i++)a[s[i]]=r(s[i]);return a}(t,i);return Object.keys(n).forEach((function(o){var a=n[o];if((0,s.isValidElement)(a)){var c=o in t,d=o in i,l=t[o],u=(0,s.isValidElement)(l)&&!l.props.in;!d||c&&!u?d||!c||u?d&&c&&(0,s.isValidElement)(l)&&(n[o]=(0,s.cloneElement)(a,{onExited:r.bind(null,a),in:l.props.in,exit:g(a,"exit",e),enter:g(a,"enter",e)})):n[o]=(0,s.cloneElement)(a,{in:!1}):n[o]=(0,s.cloneElement)(a,{onExited:r.bind(null,a),in:!0,exit:g(a,"exit",e),enter:g(a,"enter",e)})}})),n}var y=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},_=function(e){var t,r;function o(t,r){var i,n=(i=e.call(this,t,r)||this).handleExited.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i));return i.state={contextValue:{isMounting:!0},handleExited:n,firstRender:!0},i}r=e,(t=o).prototype=Object.create(r.prototype),t.prototype.constructor=t,h(t,r);var a=o.prototype;return a.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},a.componentWillUnmount=function(){this.mounted=!1},o.getDerivedStateFromProps=function(e,t){var r,i,n=t.children,o=t.handleExited;return{children:t.firstRender?(r=e,i=o,f(r.children,(function(e){return(0,s.cloneElement)(e,{onExited:i.bind(null,e),in:!0,appear:g(e,"appear",r),enter:g(e,"enter",r),exit:g(e,"exit",r)})}))):v(e,n,o),firstRender:!1}},a.handleExited=function(e,t){var r=f(this.props.children);e.key in r||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var r=(0,i.A)({},t.children);return delete r[e.key],{children:r}})))},a.render=function(){var e=this.props,t=e.component,r=e.childFactory,i=(0,n.A)(e,["component","childFactory"]),o=this.state.contextValue,a=y(this.state.children).map(r);return delete i.appear,delete i.enter,delete i.exit,null===t?s.createElement(m.Provider,{value:o},a):s.createElement(m.Provider,{value:o},s.createElement(t,i,a))},o}(s.Component);_.propTypes={},_.defaultProps={component:"div",childFactory:function(e){return e}};const S=_;r(1287);var E=r(3451);function T(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,E.J)(t)}r(4300),r(4146);var b=function(){var e=T.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},w=r(2640),k=r(4848);var R=r(7553);const C=(0,R.A)("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),A=["center","classes","className"];let I,P,D,M,O=e=>e;const N=b(I||(I=O`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),x=b(P||(P=O`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),L=b(D||(D=O`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),j=(0,c.Ay)("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),U=(0,c.Ay)((function(e){const{className:t,classes:r,pulsate:i=!1,rippleX:n,rippleY:a,rippleSize:c,in:d,onExited:l,timeout:u}=e,[p,h]=s.useState(!1),m=(0,o.A)(t,r.ripple,r.rippleVisible,i&&r.ripplePulsate),f={width:c,height:c,top:-c/2+a,left:-c/2+n},g=(0,o.A)(r.child,p&&r.childLeaving,i&&r.childPulsate);return d||p||h(!0),s.useEffect((()=>{if(!d&&null!=l){const e=setTimeout(l,u);return()=>{clearTimeout(e)}}}),[l,d,u]),(0,k.jsx)("span",{className:m,style:f,children:(0,k.jsx)("span",{className:g})})}),{name:"MuiTouchRipple",slot:"Ripple"})(M||(M=O`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),C.rippleVisible,N,550,(({theme:e})=>e.transitions.easing.easeInOut),C.ripplePulsate,(({theme:e})=>e.transitions.duration.shorter),C.child,C.childLeaving,x,550,(({theme:e})=>e.transitions.easing.easeInOut),C.childPulsate,L,(({theme:e})=>e.transitions.easing.easeInOut)),F=s.forwardRef((function(e,t){const r=(0,d.A)({props:e,name:"MuiTouchRipple"}),{center:a=!1,classes:c={},className:l}=r,u=(0,n.A)(r,A),[p,h]=s.useState([]),m=s.useRef(0),f=s.useRef(null);s.useEffect((()=>{f.current&&(f.current(),f.current=null)}),[p]);const g=s.useRef(!1),v=(0,w.A)(),y=s.useRef(null),_=s.useRef(null),E=s.useCallback((e=>{const{pulsate:t,rippleX:r,rippleY:i,rippleSize:n,cb:s}=e;h((e=>[...e,(0,k.jsx)(U,{classes:{ripple:(0,o.A)(c.ripple,C.ripple),rippleVisible:(0,o.A)(c.rippleVisible,C.rippleVisible),ripplePulsate:(0,o.A)(c.ripplePulsate,C.ripplePulsate),child:(0,o.A)(c.child,C.child),childLeaving:(0,o.A)(c.childLeaving,C.childLeaving),childPulsate:(0,o.A)(c.childPulsate,C.childPulsate)},timeout:550,pulsate:t,rippleX:r,rippleY:i,rippleSize:n},m.current)])),m.current+=1,f.current=s}),[c]),T=s.useCallback(((e={},t={},r=(()=>{}))=>{const{pulsate:i=!1,center:n=a||t.pulsate,fakeElement:s=!1}=t;if("mousedown"===(null==e?void 0:e.type)&&g.current)return void(g.current=!1);"touchstart"===(null==e?void 0:e.type)&&(g.current=!0);const o=s?null:_.current,c=o?o.getBoundingClientRect():{width:0,height:0,left:0,top:0};let d,l,u;if(n||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)d=Math.round(c.width/2),l=Math.round(c.height/2);else{const{clientX:t,clientY:r}=e.touches&&e.touches.length>0?e.touches[0]:e;d=Math.round(t-c.left),l=Math.round(r-c.top)}if(n)u=Math.sqrt((2*c.width**2+c.height**2)/3),u%2==0&&(u+=1);else{const e=2*Math.max(Math.abs((o?o.clientWidth:0)-d),d)+2,t=2*Math.max(Math.abs((o?o.clientHeight:0)-l),l)+2;u=Math.sqrt(e**2+t**2)}null!=e&&e.touches?null===y.current&&(y.current=()=>{E({pulsate:i,rippleX:d,rippleY:l,rippleSize:u,cb:r})},v.start(80,(()=>{y.current&&(y.current(),y.current=null)}))):E({pulsate:i,rippleX:d,rippleY:l,rippleSize:u,cb:r})}),[a,E,v]),b=s.useCallback((()=>{T({},{pulsate:!0})}),[T]),R=s.useCallback(((e,t)=>{if(v.clear(),"touchend"===(null==e?void 0:e.type)&&y.current)return y.current(),y.current=null,void v.start(0,(()=>{R(e,t)}));y.current=null,h((e=>e.length>0?e.slice(1):e)),f.current=t}),[v]);return s.useImperativeHandle(t,(()=>({pulsate:b,start:T,stop:R})),[b,T,R]),(0,k.jsx)(j,(0,i.A)({className:(0,o.A)(C.root,c.root,l),ref:_},u,{children:(0,k.jsx)(S,{component:null,exit:!0,children:p})}))}));var V=r(7245);function B(e){return(0,V.Ay)("MuiButtonBase",e)}const W=(0,R.A)("MuiButtonBase",["root","disabled","focusVisible"]),H=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],G=(0,c.Ay)("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${W.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),$=s.forwardRef((function(e,t){const r=(0,d.A)({props:e,name:"MuiButtonBase"}),{action:c,centerRipple:h=!1,children:m,className:f,component:g="button",disabled:v=!1,disableRipple:y=!1,disableTouchRipple:_=!1,focusRipple:S=!1,LinkComponent:E="a",onBlur:T,onClick:b,onContextMenu:w,onDragLeave:R,onFocus:C,onFocusVisible:A,onKeyDown:I,onKeyUp:P,onMouseDown:D,onMouseLeave:M,onMouseUp:O,onTouchEnd:N,onTouchMove:x,onTouchStart:L,tabIndex:j=0,TouchRippleProps:U,touchRippleRef:V,type:W}=r,$=(0,n.A)(r,H),q=s.useRef(null),z=s.useRef(null),J=(0,l.A)(z,V),{isFocusVisibleRef:K,onFocus:Y,onBlur:Q,ref:X}=(0,p.A)(),[Z,ee]=s.useState(!1);v&&Z&&ee(!1),s.useImperativeHandle(c,(()=>({focusVisible:()=>{ee(!0),q.current.focus()}})),[]);const[te,re]=s.useState(!1);s.useEffect((()=>{re(!0)}),[]);const ie=te&&!y&&!v;function ne(e,t,r=_){return(0,u.A)((i=>(t&&t(i),!r&&z.current&&z.current[e](i),!0)))}s.useEffect((()=>{Z&&S&&!y&&te&&z.current.pulsate()}),[y,S,Z,te]);const se=ne("start",D),oe=ne("stop",w),ae=ne("stop",R),ce=ne("stop",O),de=ne("stop",(e=>{Z&&e.preventDefault(),M&&M(e)})),le=ne("start",L),ue=ne("stop",N),pe=ne("stop",x),he=ne("stop",(e=>{Q(e),!1===K.current&&ee(!1),T&&T(e)}),!1),me=(0,u.A)((e=>{q.current||(q.current=e.currentTarget),Y(e),!0===K.current&&(ee(!0),A&&A(e)),C&&C(e)})),fe=()=>{const e=q.current;return g&&"button"!==g&&!("A"===e.tagName&&e.href)},ge=s.useRef(!1),ve=(0,u.A)((e=>{S&&!ge.current&&Z&&z.current&&" "===e.key&&(ge.current=!0,z.current.stop(e,(()=>{z.current.start(e)}))),e.target===e.currentTarget&&fe()&&" "===e.key&&e.preventDefault(),I&&I(e),e.target===e.currentTarget&&fe()&&"Enter"===e.key&&!v&&(e.preventDefault(),b&&b(e))})),ye=(0,u.A)((e=>{S&&" "===e.key&&z.current&&Z&&!e.defaultPrevented&&(ge.current=!1,z.current.stop(e,(()=>{z.current.pulsate(e)}))),P&&P(e),b&&e.target===e.currentTarget&&fe()&&" "===e.key&&!e.defaultPrevented&&b(e)}));let _e=g;"button"===_e&&($.href||$.to)&&(_e=E);const Se={};"button"===_e?(Se.type=void 0===W?"button":W,Se.disabled=v):($.href||$.to||(Se.role="button"),v&&(Se["aria-disabled"]=v));const Ee=(0,l.A)(t,X,q),Te=(0,i.A)({},r,{centerRipple:h,component:g,disabled:v,disableRipple:y,disableTouchRipple:_,focusRipple:S,tabIndex:j,focusVisible:Z}),be=(e=>{const{disabled:t,focusVisible:r,focusVisibleClassName:i,classes:n}=e,s={root:["root",t&&"disabled",r&&"focusVisible"]},o=(0,a.A)(s,B,n);return r&&i&&(o.root+=` ${i}`),o})(Te);return(0,k.jsxs)(G,(0,i.A)({as:_e,className:(0,o.A)(be.root,f),ownerState:Te,onBlur:he,onClick:b,onContextMenu:oe,onFocus:me,onKeyDown:ve,onKeyUp:ye,onMouseDown:se,onMouseLeave:de,onMouseUp:ce,onDragLeave:ae,onTouchEnd:ue,onTouchMove:pe,onTouchStart:le,ref:Ee,tabIndex:v?-1:j,type:W},Se,$,{children:[m,ie?(0,k.jsx)(F,(0,i.A)({ref:J,center:h},U)):null]}))}))},356:(e,t,r)=>{"use strict";r.d(t,{A:()=>_});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(4279),d=r(1848),l=r(3541),u=r(7553),p=r(7245);function h(e){return(0,p.Ay)("MuiDivider",e)}(0,u.A)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);var m=r(4848);const f=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],g=(0,d.Ay)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.absolute&&t.absolute,t[r.variant],r.light&&t.light,"vertical"===r.orientation&&t.vertical,r.flexItem&&t.flexItem,r.children&&t.withChildren,r.children&&"vertical"===r.orientation&&t.withChildrenVertical,"right"===r.textAlign&&"vertical"!==r.orientation&&t.textAlignRight,"left"===r.textAlign&&"vertical"!==r.orientation&&t.textAlignLeft]}})((({theme:e,ownerState:t})=>(0,n.A)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(e.vars||e).palette.divider,borderBottomWidth:"thin"},t.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},t.light&&{borderColor:e.vars?`rgba(${e.vars.palette.dividerChannel} / 0.08)`:(0,c.X4)(e.palette.divider,.08)},"inset"===t.variant&&{marginLeft:72},"middle"===t.variant&&"horizontal"===t.orientation&&{marginLeft:e.spacing(2),marginRight:e.spacing(2)},"middle"===t.variant&&"vertical"===t.orientation&&{marginTop:e.spacing(1),marginBottom:e.spacing(1)},"vertical"===t.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},t.flexItem&&{alignSelf:"stretch",height:"auto"})),(({ownerState:e})=>(0,n.A)({},e.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{content:'""',alignSelf:"center"}})),(({theme:e,ownerState:t})=>(0,n.A)({},t.children&&"vertical"!==t.orientation&&{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(e.vars||e).palette.divider}`}})),(({theme:e,ownerState:t})=>(0,n.A)({},t.children&&"vertical"===t.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(e.vars||e).palette.divider}`}})),(({ownerState:e})=>(0,n.A)({},"right"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}}))),v=(0,d.Ay)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.wrapper,"vertical"===r.orientation&&t.wrapperVertical]}})((({theme:e,ownerState:t})=>(0,n.A)({display:"inline-block",paddingLeft:`calc(${e.spacing(1)} * 1.2)`,paddingRight:`calc(${e.spacing(1)} * 1.2)`},"vertical"===t.orientation&&{paddingTop:`calc(${e.spacing(1)} * 1.2)`,paddingBottom:`calc(${e.spacing(1)} * 1.2)`}))),y=s.forwardRef((function(e,t){const r=(0,l.A)({props:e,name:"MuiDivider"}),{absolute:s=!1,children:c,className:d,component:u=(c?"div":"hr"),flexItem:p=!1,light:y=!1,orientation:_="horizontal",role:S=("hr"!==u?"separator":void 0),textAlign:E="center",variant:T="fullWidth"}=r,b=(0,i.A)(r,f),w=(0,n.A)({},r,{absolute:s,component:u,flexItem:p,light:y,orientation:_,role:S,textAlign:E,variant:T}),k=(e=>{const{absolute:t,children:r,classes:i,flexItem:n,light:s,orientation:o,textAlign:c,variant:d}=e,l={root:["root",t&&"absolute",d,s&&"light","vertical"===o&&"vertical",n&&"flexItem",r&&"withChildren",r&&"vertical"===o&&"withChildrenVertical","right"===c&&"vertical"!==o&&"textAlignRight","left"===c&&"vertical"!==o&&"textAlignLeft"],wrapper:["wrapper","vertical"===o&&"wrapperVertical"]};return(0,a.A)(l,h,i)})(w);return(0,m.jsx)(g,(0,n.A)({as:u,className:(0,o.A)(k.root,d),role:S,ref:t,ownerState:w},b,{children:c?(0,m.jsx)(v,{className:k.wrapper,ownerState:w,children:c}):null}))}));y.muiSkipListHighlight=!0;const _=y},8239:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>k});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(9452),c=r(9599),d=r(4111),l=r(1848),u=r(3541),p=r(4675);const h=s.createContext();var m=r(7553),f=r(7245);function g(e){return(0,f.Ay)("MuiGrid",e)}const v=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],y=(0,m.A)("MuiGrid",["root","container","item","zeroMinWidth",...[0,1,2,3,4,5,6,7,8,9,10].map((e=>`spacing-xs-${e}`)),...["column-reverse","column","row-reverse","row"].map((e=>`direction-xs-${e}`)),...["nowrap","wrap-reverse","wrap"].map((e=>`wrap-xs-${e}`)),...v.map((e=>`grid-xs-${e}`)),...v.map((e=>`grid-sm-${e}`)),...v.map((e=>`grid-md-${e}`)),...v.map((e=>`grid-lg-${e}`)),...v.map((e=>`grid-xl-${e}`))]);var _=r(4848);const S=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function E(e){const t=parseFloat(e);return`${t}${String(e).replace(String(t),"")||"px"}`}function T({breakpoints:e,values:t}){let r="";Object.keys(t).forEach((e=>{""===r&&0!==t[e]&&(r=e)}));const i=Object.keys(e).sort(((t,r)=>e[t]-e[r]));return i.slice(0,i.indexOf(r))}const b=(0,l.Ay)("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e,{container:i,direction:n,item:s,spacing:o,wrap:a,zeroMinWidth:c,breakpoints:d}=r;let l=[];i&&(l=function(e,t,r={}){if(!e||e<=0)return[];if("string"==typeof e&&!Number.isNaN(Number(e))||"number"==typeof e)return[r[`spacing-xs-${String(e)}`]];const i=[];return t.forEach((t=>{const n=e[t];Number(n)>0&&i.push(r[`spacing-${t}-${String(n)}`])})),i}(o,d,t));const u=[];return d.forEach((e=>{const i=r[e];i&&u.push(t[`grid-${e}-${String(i)}`])})),[t.root,i&&t.container,s&&t.item,c&&t.zeroMinWidth,...l,"row"!==n&&t[`direction-xs-${String(n)}`],"wrap"!==a&&t[`wrap-xs-${String(a)}`],...u]}})((({ownerState:e})=>(0,n.A)({boxSizing:"border-box"},e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},e.item&&{margin:0},e.zeroMinWidth&&{minWidth:0},"wrap"!==e.wrap&&{flexWrap:e.wrap})),(function({theme:e,ownerState:t}){const r=(0,a.kW)({values:t.direction,breakpoints:e.breakpoints.values});return(0,a.NI)({theme:e},r,(e=>{const t={flexDirection:e};return 0===e.indexOf("column")&&(t[`& > .${y.item}`]={maxWidth:"none"}),t}))}),(function({theme:e,ownerState:t}){const{container:r,rowSpacing:i}=t;let n={};if(r&&0!==i){const t=(0,a.kW)({values:i,breakpoints:e.breakpoints.values});let r;"object"==typeof t&&(r=T({breakpoints:e.breakpoints.values,values:t})),n=(0,a.NI)({theme:e},t,((t,i)=>{var n;const s=e.spacing(t);return"0px"!==s?{marginTop:`-${E(s)}`,[`& > .${y.item}`]:{paddingTop:E(s)}}:null!=(n=r)&&n.includes(i)?{}:{marginTop:0,[`& > .${y.item}`]:{paddingTop:0}}}))}return n}),(function({theme:e,ownerState:t}){const{container:r,columnSpacing:i}=t;let n={};if(r&&0!==i){const t=(0,a.kW)({values:i,breakpoints:e.breakpoints.values});let r;"object"==typeof t&&(r=T({breakpoints:e.breakpoints.values,values:t})),n=(0,a.NI)({theme:e},t,((t,i)=>{var n;const s=e.spacing(t);return"0px"!==s?{width:`calc(100% + ${E(s)})`,marginLeft:`-${E(s)}`,[`& > .${y.item}`]:{paddingLeft:E(s)}}:null!=(n=r)&&n.includes(i)?{}:{width:"100%",marginLeft:0,[`& > .${y.item}`]:{paddingLeft:0}}}))}return n}),(function({theme:e,ownerState:t}){let r;return e.breakpoints.keys.reduce(((i,s)=>{let o={};if(t[s]&&(r=t[s]),!r)return i;if(!0===r)o={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if("auto"===r)o={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const c=(0,a.kW)({values:t.columns,breakpoints:e.breakpoints.values}),d="object"==typeof c?c[s]:c;if(null==d)return i;const l=Math.round(r/d*1e8)/1e6+"%";let u={};if(t.container&&t.item&&0!==t.columnSpacing){const r=e.spacing(t.columnSpacing);if("0px"!==r){const e=`calc(${l} + ${E(r)})`;u={flexBasis:e,maxWidth:e}}}o=(0,n.A)({flexBasis:l,flexGrow:0,maxWidth:l},u)}return 0===e.breakpoints.values[s]?Object.assign(i,o):i[e.breakpoints.up(s)]=o,i}),{})})),w=s.forwardRef((function(e,t){const r=(0,u.A)({props:e,name:"MuiGrid"}),{breakpoints:a}=(0,p.A)(),l=(0,c.A)(r),{className:m,columns:f,columnSpacing:v,component:y="div",container:E=!1,direction:T="row",item:w=!1,rowSpacing:k,spacing:R=0,wrap:C="wrap",zeroMinWidth:A=!1}=l,I=(0,i.A)(l,S),P=k||R,D=v||R,M=s.useContext(h),O=E?f||12:M,N={},x=(0,n.A)({},I);a.keys.forEach((e=>{null!=I[e]&&(N[e]=I[e],delete x[e])}));const L=(0,n.A)({},l,{columns:O,container:E,direction:T,item:w,rowSpacing:P,columnSpacing:D,wrap:C,zeroMinWidth:A,spacing:R},N,{breakpoints:a.keys}),j=(e=>{const{classes:t,container:r,direction:i,item:n,spacing:s,wrap:o,zeroMinWidth:a,breakpoints:c}=e;let l=[];r&&(l=function(e,t){if(!e||e<=0)return[];if("string"==typeof e&&!Number.isNaN(Number(e))||"number"==typeof e)return[`spacing-xs-${String(e)}`];const r=[];return t.forEach((t=>{const i=e[t];if(Number(i)>0){const e=`spacing-${t}-${String(i)}`;r.push(e)}})),r}(s,c));const u=[];c.forEach((t=>{const r=e[t];r&&u.push(`grid-${t}-${String(r)}`)}));const p={root:["root",r&&"container",n&&"item",a&&"zeroMinWidth",...l,"row"!==i&&`direction-xs-${String(i)}`,"wrap"!==o&&`wrap-xs-${String(o)}`,...u]};return(0,d.A)(p,g,t)})(L);return(0,_.jsx)(h.Provider,{value:O,children:(0,_.jsx)(b,(0,n.A)({ownerState:L,className:(0,o.A)(j.root,m),as:y,ref:t},x))})})),k=w},1641:(e,t,r)=>{"use strict";r.d(t,{A:()=>S});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(4279),d=r(1848),l=r(3541),u=r(8941),p=r(8466),h=r(7553),m=r(7245);function f(e){return(0,m.Ay)("MuiIconButton",e)}const g=(0,h.A)("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]);var v=r(4848);const y=["edge","children","className","color","disabled","disableFocusRipple","size"],_=(0,d.Ay)(u.A,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,"default"!==r.color&&t[`color${(0,p.A)(r.color)}`],r.edge&&t[`edge${(0,p.A)(r.edge)}`],t[`size${(0,p.A)(r.size)}`]]}})((({theme:e,ownerState:t})=>(0,n.A)({textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(e.vars||e).palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest})},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,c.X4)(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"start"===t.edge&&{marginLeft:"small"===t.size?-3:-12},"end"===t.edge&&{marginRight:"small"===t.size?-3:-12})),(({theme:e,ownerState:t})=>{var r;const i=null==(r=(e.vars||e).palette)?void 0:r[t.color];return(0,n.A)({},"inherit"===t.color&&{color:"inherit"},"inherit"!==t.color&&"default"!==t.color&&(0,n.A)({color:null==i?void 0:i.main},!t.disableRipple&&{"&:hover":(0,n.A)({},i&&{backgroundColor:e.vars?`rgba(${i.mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,c.X4)(i.main,e.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),"small"===t.size&&{padding:5,fontSize:e.typography.pxToRem(18)},"large"===t.size&&{padding:12,fontSize:e.typography.pxToRem(28)},{[`&.${g.disabled}`]:{backgroundColor:"transparent",color:(e.vars||e).palette.action.disabled}})})),S=s.forwardRef((function(e,t){const r=(0,l.A)({props:e,name:"MuiIconButton"}),{edge:s=!1,children:c,className:d,color:u="default",disabled:h=!1,disableFocusRipple:m=!1,size:g="medium"}=r,S=(0,i.A)(r,y),E=(0,n.A)({},r,{edge:s,color:u,disabled:h,disableFocusRipple:m,size:g}),T=(e=>{const{classes:t,disabled:r,color:i,edge:n,size:s}=e,o={root:["root",r&&"disabled","default"!==i&&`color${(0,p.A)(i)}`,n&&`edge${(0,p.A)(n)}`,`size${(0,p.A)(s)}`]};return(0,a.A)(o,f,t)})(E);return(0,v.jsx)(_,(0,n.A)({className:(0,o.A)(T.root,d),centerRipple:!0,focusRipple:!m,disabled:h,ref:t,ownerState:E},S,{children:c}))}))},538:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(4279),d=r(1848);const l=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};var u=r(3541),p=r(7553),h=r(7245);function m(e){return(0,h.Ay)("MuiPaper",e)}(0,p.A)("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);var f=r(4848);const g=["className","component","elevation","square","variant"],v=(0,d.Ay)("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],!r.square&&t.rounded,"elevation"===r.variant&&t[`elevation${r.elevation}`]]}})((({theme:e,ownerState:t})=>{var r;return(0,n.A)({backgroundColor:(e.vars||e).palette.background.paper,color:(e.vars||e).palette.text.primary,transition:e.transitions.create("box-shadow")},!t.square&&{borderRadius:e.shape.borderRadius},"outlined"===t.variant&&{border:`1px solid ${(e.vars||e).palette.divider}`},"elevation"===t.variant&&(0,n.A)({boxShadow:(e.vars||e).shadows[t.elevation]},!e.vars&&"dark"===e.palette.mode&&{backgroundImage:`linear-gradient(${(0,c.X4)("#fff",l(t.elevation))}, ${(0,c.X4)("#fff",l(t.elevation))})`},e.vars&&{backgroundImage:null==(r=e.vars.overlays)?void 0:r[t.elevation]}))})),y=s.forwardRef((function(e,t){const r=(0,u.A)({props:e,name:"MuiPaper"}),{className:s,component:c="div",elevation:d=1,square:l=!1,variant:p="elevation"}=r,h=(0,i.A)(r,g),y=(0,n.A)({},r,{component:c,elevation:d,square:l,variant:p}),_=(e=>{const{square:t,elevation:r,variant:i,classes:n}=e,s={root:["root",i,!t&&"rounded","elevation"===i&&`elevation${r}`]};return(0,a.A)(s,m,n)})(y);return(0,f.jsx)(v,(0,n.A)({as:c,ownerState:y,className:(0,o.A)(_.root,s),ref:t},h))}))},7254:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(3541),d=r(1848),l=r(4848);var u=r(7553),p=r(7245);function h(e){return(0,p.Ay)("MuiScopedCssBaseline",e)}(0,u.A)("MuiScopedCssBaseline",["root"]);const m=["className","component","enableColorScheme"],f=(0,d.Ay)("div",{name:"MuiScopedCssBaseline",slot:"Root",overridesResolver:(e,t)=>t.root})((({theme:e,ownerState:t})=>{const r={};return t.enableColorScheme&&e.colorSchemes&&Object.entries(e.colorSchemes).forEach((([t,i])=>{var n;r[`&${e.getColorSchemeSelector(t).replace(/\s*&/,"")}`]={colorScheme:null==(n=i.palette)?void 0:n.mode}})),(0,n.A)({},((e,t)=>(0,n.A)({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%"},t&&!e.vars&&{colorScheme:e.palette.mode}))(e,t.enableColorScheme),(e=>(0,n.A)({color:(e.vars||e).palette.text.primary},e.typography.body1,{backgroundColor:(e.vars||e).palette.background.default,"@media print":{backgroundColor:(e.vars||e).palette.common.white}}))(e),{"& *, & *::before, & *::after":{boxSizing:"inherit"},"& strong, & b":{fontWeight:e.typography.fontWeightBold}},r)})),g=s.forwardRef((function(e,t){const r=(0,c.A)({props:e,name:"MuiScopedCssBaseline"}),{className:s,component:d="div"}=r,u=(0,i.A)(r,m),p=(0,n.A)({},r,{component:d}),g=(e=>{const{classes:t}=e;return(0,a.A)({root:["root"]},h,t)})(p);return(0,l.jsx)(f,(0,n.A)({as:d,className:(0,o.A)(g.root,s),ref:t,ownerState:p},u))}))},1015:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>re});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(4871),d=r(4856),l=r(3551),u=r(5489);const p=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function h(e){var t;const{elementType:r,externalSlotProps:s,ownerState:o,skipResolvingSlotProps:a=!1}=e,h=(0,i.A)(e,p),m=a?{}:(0,u.Y)(s,o),{props:f,internalRef:g}=(0,l.p)((0,n.A)({},h,{externalSlotProps:m})),v=(0,c.A)(g,null==m?void 0:m.ref,null==(t=e.additionalProps)?void 0:t.ref);return(0,d.X)(r,(0,n.A)({},f,{ref:v}),o)}var m=r(5419),f=r(6249),g=r(3833),v=r(6937),y=r(7749),_=r(173),S=r(6111);const E={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:-1,overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};var T=r(4718);function b(e,t){return e-t}function w(e,t){var r;const{index:i}=null!=(r=e.reduce(((e,r,i)=>{const n=Math.abs(t-r);return null===e||n<e.distance||n===e.distance?{distance:n,index:i}:e}),null))?r:{};return i}function k(e,t){if(void 0!==t.current&&e.changedTouches){const r=e;for(let e=0;e<r.changedTouches.length;e+=1){const i=r.changedTouches[e];if(i.identifier===t.current)return{x:i.clientX,y:i.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function R(e,t,r){return 100*(e-t)/(r-t)}function C({values:e,newValue:t,index:r}){const i=e.slice();return i[r]=t,i.sort(b)}function A({sliderRef:e,activeIndex:t,setActive:r}){var i,n;const s=(0,f.A)(e.current);var o;null!=(i=e.current)&&i.contains(s.activeElement)&&Number(null==s||null==(n=s.activeElement)?void 0:n.getAttribute("data-index"))===t||null==(o=e.current)||o.querySelector(`[type="range"][data-index="${t}"]`).focus(),r&&r(t)}function I(e,t){return"number"==typeof e&&"number"==typeof t?e===t:"object"==typeof e&&"object"==typeof t&&function(e,t,r=((e,t)=>e===t)){return e.length===t.length&&e.every(((e,i)=>r(e,t[i])))}(e,t)}const P={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},D=e=>e;let M;function O(){return void 0===M&&(M="undefined"==typeof CSS||"function"!=typeof CSS.supports||CSS.supports("touch-action","none")),M}function N(e){const{"aria-labelledby":t,defaultValue:r,disabled:i=!1,disableSwap:o=!1,isRtl:a=!1,marks:d=!1,max:l=100,min:u=0,name:p,onChange:h,onChangeCommitted:m,orientation:M="horizontal",rootRef:N,scale:x=D,step:L=1,shiftStep:j=10,tabIndex:U,value:F}=e,V=s.useRef(),[B,W]=s.useState(-1),[H,G]=s.useState(-1),[$,q]=s.useState(!1),z=s.useRef(0),[J,K]=(0,g.A)({controlled:F,default:null!=r?r:u,name:"Slider"}),Y=h&&((e,t,r)=>{const i=e.nativeEvent||e,n=new i.constructor(i.type,i);Object.defineProperty(n,"target",{writable:!0,value:{value:t,name:p}}),h(n,t,r)}),Q=Array.isArray(J);let X=Q?J.slice().sort(b):[J];X=X.map((e=>null==e?u:(0,v.A)(e,u,l)));const Z=!0===d&&null!==L?[...Array(Math.floor((l-u)/L)+1)].map(((e,t)=>({value:u+L*t}))):d||[],ee=Z.map((e=>e.value)),{isFocusVisibleRef:te,onBlur:re,onFocus:ie,ref:ne}=(0,y.A)(),[se,oe]=s.useState(-1),ae=s.useRef(),ce=(0,c.A)(ne,ae),de=(0,c.A)(N,ce),le=e=>t=>{var r;const i=Number(t.currentTarget.getAttribute("data-index"));ie(t),!0===te.current&&oe(i),G(i),null==e||null==(r=e.onFocus)||r.call(e,t)},ue=e=>t=>{var r;re(t),!1===te.current&&oe(-1),G(-1),null==e||null==(r=e.onBlur)||r.call(e,t)},pe=(e,t)=>{const r=Number(e.currentTarget.getAttribute("data-index")),i=X[r],n=ee.indexOf(i);let s=t;if(Z&&null==L){const e=ee[ee.length-1];s=s>e?e:s<ee[0]?ee[0]:s<i?ee[n-1]:ee[n+1]}if(s=(0,v.A)(s,u,l),Q){o&&(s=(0,v.A)(s,X[r-1]||-1/0,X[r+1]||1/0));const e=s;s=C({values:X,newValue:s,index:r});let t=r;o||(t=s.indexOf(e)),A({sliderRef:ae,activeIndex:t})}K(s),oe(r),Y&&!I(s,J)&&Y(e,s,r),m&&m(e,s)},he=e=>t=>{var r;if(null!==L){const e=Number(t.currentTarget.getAttribute("data-index")),r=X[e];let i=null;("ArrowLeft"===t.key||"ArrowDown"===t.key)&&t.shiftKey||"PageDown"===t.key?i=Math.max(r-j,u):(("ArrowRight"===t.key||"ArrowUp"===t.key)&&t.shiftKey||"PageUp"===t.key)&&(i=Math.min(r+j,l)),null!==i&&(pe(t,i),t.preventDefault())}null==e||null==(r=e.onKeyDown)||r.call(e,t)};(0,_.A)((()=>{var e;i&&ae.current.contains(document.activeElement)&&(null==(e=document.activeElement)||e.blur())}),[i]),i&&-1!==B&&W(-1),i&&-1!==se&&oe(-1);const me=s.useRef();let fe=M;a&&"horizontal"===M&&(fe+="-reverse");const ge=({finger:e,move:t=!1})=>{const{current:r}=ae,{width:i,height:n,bottom:s,left:a}=r.getBoundingClientRect();let c,d;if(c=0===fe.indexOf("vertical")?(s-e.y)/n:(e.x-a)/i,-1!==fe.indexOf("-reverse")&&(c=1-c),d=function(e,t,r){return(r-t)*e+t}(c,u,l),L)d=function(e,t,r){const i=Math.round((e-r)/t)*t+r;return Number(i.toFixed(function(e){if(Math.abs(e)<1){const t=e.toExponential().split("e-"),r=t[0].split(".")[1];return(r?r.length:0)+parseInt(t[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}(t)))}(d,L,u);else{const e=w(ee,d);d=ee[e]}d=(0,v.A)(d,u,l);let p=0;if(Q){p=t?me.current:w(X,d),o&&(d=(0,v.A)(d,X[p-1]||-1/0,X[p+1]||1/0));const e=d;d=C({values:X,newValue:d,index:p}),o&&t||(p=d.indexOf(e),me.current=p)}return{newValue:d,activeIndex:p}},ve=(0,S.A)((e=>{const t=k(e,V);if(!t)return;if(z.current+=1,"mousemove"===e.type&&0===e.buttons)return void ye(e);const{newValue:r,activeIndex:i}=ge({finger:t,move:!0});A({sliderRef:ae,activeIndex:i,setActive:W}),K(r),!$&&z.current>2&&q(!0),Y&&!I(r,J)&&Y(e,r,i)})),ye=(0,S.A)((e=>{const t=k(e,V);if(q(!1),!t)return;const{newValue:r}=ge({finger:t,move:!0});W(-1),"touchend"===e.type&&G(-1),m&&m(e,r),V.current=void 0,Se()})),_e=(0,S.A)((e=>{if(i)return;O()||e.preventDefault();const t=e.changedTouches[0];null!=t&&(V.current=t.identifier);const r=k(e,V);if(!1!==r){const{newValue:t,activeIndex:i}=ge({finger:r});A({sliderRef:ae,activeIndex:i,setActive:W}),K(t),Y&&!I(t,J)&&Y(e,t,i)}z.current=0;const n=(0,f.A)(ae.current);n.addEventListener("touchmove",ve,{passive:!0}),n.addEventListener("touchend",ye,{passive:!0})})),Se=s.useCallback((()=>{const e=(0,f.A)(ae.current);e.removeEventListener("mousemove",ve),e.removeEventListener("mouseup",ye),e.removeEventListener("touchmove",ve),e.removeEventListener("touchend",ye)}),[ye,ve]);s.useEffect((()=>{const{current:e}=ae;return e.addEventListener("touchstart",_e,{passive:O()}),()=>{e.removeEventListener("touchstart",_e),Se()}}),[Se,_e]),s.useEffect((()=>{i&&Se()}),[i,Se]);const Ee=R(Q?X[0]:u,u,l),Te=R(X[X.length-1],u,l)-Ee,be=e=>t=>{var r;null==(r=e.onMouseLeave)||r.call(e,t),G(-1)};return{active:B,axis:fe,axisProps:P,dragging:$,focusedThumbIndex:se,getHiddenInputProps:(r={})=>{var s;const o=(0,T.h)(r),c={onChange:(d=o||{},e=>{var t;null==(t=d.onChange)||t.call(d,e),pe(e,e.target.valueAsNumber)}),onFocus:le(o||{}),onBlur:ue(o||{}),onKeyDown:he(o||{})};var d;const h=(0,n.A)({},o,c);return(0,n.A)({tabIndex:U,"aria-labelledby":t,"aria-orientation":M,"aria-valuemax":x(l),"aria-valuemin":x(u),name:p,type:"range",min:e.min,max:e.max,step:null===e.step&&e.marks?"any":null!=(s=e.step)?s:void 0,disabled:i},r,h,{style:(0,n.A)({},E,{direction:a?"rtl":"ltr",width:"100%",height:"100%"})})},getRootProps:(e={})=>{const t=(0,T.h)(e),r={onMouseDown:(s=t||{},e=>{var t;if(null==(t=s.onMouseDown)||t.call(s,e),i)return;if(e.defaultPrevented)return;if(0!==e.button)return;e.preventDefault();const r=k(e,V);if(!1!==r){const{newValue:t,activeIndex:i}=ge({finger:r});A({sliderRef:ae,activeIndex:i,setActive:W}),K(t),Y&&!I(t,J)&&Y(e,t,i)}z.current=0;const n=(0,f.A)(ae.current);n.addEventListener("mousemove",ve,{passive:!0}),n.addEventListener("mouseup",ye)})};var s;const o=(0,n.A)({},t,r);return(0,n.A)({},e,{ref:de},o)},getThumbProps:(e={})=>{const t=(0,T.h)(e),r={onMouseOver:(i=t||{},e=>{var t;null==(t=i.onMouseOver)||t.call(i,e);const r=Number(e.currentTarget.getAttribute("data-index"));G(r)}),onMouseLeave:be(t||{})};var i;return(0,n.A)({},e,t,r)},marks:Z,open:H,range:Q,rootRef:de,trackLeap:Te,trackOffset:Ee,values:X,getThumbStyle:e=>({pointerEvents:-1!==B&&B!==e?"none":void 0})}}var x=r(4279),L=r(3541),j=r(1848),U=r(4675);var F=r(8466),V=r(7553),B=r(7245);function W(e){return(0,B.Ay)("MuiSlider",e)}const H=(0,V.A)("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]);var G=r(4848);const $=["aria-label","aria-valuetext","aria-labelledby","component","components","componentsProps","color","classes","className","disableSwap","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","orientation","shiftStep","size","step","scale","slotProps","slots","tabIndex","track","value","valueLabelDisplay","valueLabelFormat"];function q(e){return e}const z=(0,j.Ay)("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${(0,F.A)(r.color)}`],"medium"!==r.size&&t[`size${(0,F.A)(r.size)}`],r.marked&&t.marked,"vertical"===r.orientation&&t.vertical,"inverted"===r.track&&t.trackInverted,!1===r.track&&t.trackFalse]}})((({theme:e,ownerState:t})=>(0,n.A)({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:(e.vars||e).palette[t.color].main,WebkitTapHighlightColor:"transparent"},"horizontal"===t.orientation&&(0,n.A)({height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}},"small"===t.size&&{height:2},t.marked&&{marginBottom:20}),"vertical"===t.orientation&&(0,n.A)({height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}},"small"===t.size&&{width:2},t.marked&&{marginRight:44}),{"@media print":{colorAdjust:"exact"},[`&.${H.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${H.dragging}`]:{[`& .${H.thumb}, & .${H.track}`]:{transition:"none"}}}))),J=(0,j.Ay)("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})((({ownerState:e})=>(0,n.A)({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38},"horizontal"===e.orientation&&{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"},"vertical"===e.orientation&&{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"},"inverted"===e.track&&{opacity:1}))),K=(0,j.Ay)("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})((({theme:e,ownerState:t})=>{const r="light"===e.palette.mode?(0,x.a)(e.palette[t.color].main,.62):(0,x.e$)(e.palette[t.color].main,.5);return(0,n.A)({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest})},"small"===t.size&&{border:"none"},"horizontal"===t.orientation&&{height:"inherit",top:"50%",transform:"translateY(-50%)"},"vertical"===t.orientation&&{width:"inherit",left:"50%",transform:"translateX(-50%)"},!1===t.track&&{display:"none"},"inverted"===t.track&&{backgroundColor:e.vars?e.vars.palette.Slider[`${t.color}Track`]:r,borderColor:e.vars?e.vars.palette.Slider[`${t.color}Track`]:r})})),Y=(0,j.Ay)("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.thumb,t[`thumbColor${(0,F.A)(r.color)}`],"medium"!==r.size&&t[`thumbSize${(0,F.A)(r.size)}`]]}})((({theme:e,ownerState:t})=>(0,n.A)({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest})},"small"===t.size&&{width:12,height:12},"horizontal"===t.orientation&&{top:"50%",transform:"translate(-50%, -50%)"},"vertical"===t.orientation&&{left:"50%",transform:"translate(-50%, 50%)"},{"&::before":(0,n.A)({position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"small"===t.size&&{boxShadow:"none"}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&:hover, &.${H.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.16)`:(0,x.X4)(e.palette[t.color].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${H.active}`]:{boxShadow:`0px 0px 0px 14px ${e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.16)`:(0,x.X4)(e.palette[t.color].main,.16)}`},[`&.${H.disabled}`]:{"&:hover":{boxShadow:"none"}}}))),Q=(0,j.Ay)((function(e){const{children:t,className:r,value:i}=e,n=(e=>{const{open:t}=e;return{offset:(0,o.A)(t&&H.valueLabelOpen),circle:H.valueLabelCircle,label:H.valueLabelLabel}})(e);return t?s.cloneElement(t,{className:(0,o.A)(t.props.className)},(0,G.jsxs)(s.Fragment,{children:[t.props.children,(0,G.jsx)("span",{className:(0,o.A)(n.offset,r),"aria-hidden":!0,children:(0,G.jsx)("span",{className:n.circle,children:(0,G.jsx)("span",{className:n.label,children:i})})})]})):null}),{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})((({theme:e,ownerState:t})=>(0,n.A)({[`&.${H.valueLabelOpen}`]:{transform:("vertical"===t.orientation?"translateY(-50%)":"translateY(-100%)")+" scale(1)"},zIndex:1,whiteSpace:"nowrap"},e.typography.body2,{fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),transform:("vertical"===t.orientation?"translateY(-50%)":"translateY(-100%)")+" scale(0)",position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem"},"horizontal"===t.orientation&&{top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"}},"vertical"===t.orientation&&{right:"small"===t.size?"20px":"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"}},"small"===t.size&&{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}))),X=(0,j.Ay)("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>(0,j._n)(e)&&"markActive"!==e,overridesResolver:(e,t)=>{const{markActive:r}=e;return[t.mark,r&&t.markActive]}})((({theme:e,ownerState:t,markActive:r})=>(0,n.A)({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},"horizontal"===t.orientation&&{top:"50%",transform:"translate(-1px, -50%)"},"vertical"===t.orientation&&{left:"50%",transform:"translate(-50%, 1px)"},r&&{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}))),Z=(0,j.Ay)("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>(0,j._n)(e)&&"markLabelActive"!==e,overridesResolver:(e,t)=>t.markLabel})((({theme:e,ownerState:t,markLabelActive:r})=>(0,n.A)({},e.typography.body2,{color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap"},"horizontal"===t.orientation&&{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}},"vertical"===t.orientation&&{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}},r&&{color:(e.vars||e).palette.text.primary}))),ee=({children:e})=>e,te=s.forwardRef((function(e,t){var r,c,d,l,u,p,f,g,v,y,_,S,E,T,b,w,k,C,A,I,P,D,M,O;const x=(0,L.A)({props:e,name:"MuiSlider"}),j="rtl"===(0,U.A)().direction,{"aria-label":V,"aria-valuetext":B,"aria-labelledby":H,component:te="span",components:re={},componentsProps:ie={},color:ne="primary",classes:se,className:oe,disableSwap:ae=!1,disabled:ce=!1,getAriaLabel:de,getAriaValueText:le,marks:ue=!1,max:pe=100,min:he=0,orientation:me="horizontal",shiftStep:fe=10,size:ge="medium",step:ve=1,scale:ye=q,slotProps:_e,slots:Se,track:Ee="normal",valueLabelDisplay:Te="off",valueLabelFormat:be=q}=x,we=(0,i.A)(x,$),ke=(0,n.A)({},x,{isRtl:j,max:pe,min:he,classes:se,disabled:ce,disableSwap:ae,orientation:me,marks:ue,color:ne,size:ge,step:ve,shiftStep:fe,scale:ye,track:Ee,valueLabelDisplay:Te,valueLabelFormat:be}),{axisProps:Re,getRootProps:Ce,getHiddenInputProps:Ae,getThumbProps:Ie,open:Pe,active:De,axis:Me,focusedThumbIndex:Oe,range:Ne,dragging:xe,marks:Le,values:je,trackOffset:Ue,trackLeap:Fe,getThumbStyle:Ve}=N((0,n.A)({},ke,{rootRef:t}));ke.marked=Le.length>0&&Le.some((e=>e.label)),ke.dragging=xe,ke.focusedThumbIndex=Oe;const Be=(e=>{const{disabled:t,dragging:r,marked:i,orientation:n,track:s,classes:o,color:c,size:d}=e,l={root:["root",t&&"disabled",r&&"dragging",i&&"marked","vertical"===n&&"vertical","inverted"===s&&"trackInverted",!1===s&&"trackFalse",c&&`color${(0,F.A)(c)}`,d&&`size${(0,F.A)(d)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",d&&`thumbSize${(0,F.A)(d)}`,c&&`thumbColor${(0,F.A)(c)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return(0,a.A)(l,W,o)})(ke),We=null!=(r=null!=(c=null==Se?void 0:Se.root)?c:re.Root)?r:z,He=null!=(d=null!=(l=null==Se?void 0:Se.rail)?l:re.Rail)?d:J,Ge=null!=(u=null!=(p=null==Se?void 0:Se.track)?p:re.Track)?u:K,$e=null!=(f=null!=(g=null==Se?void 0:Se.thumb)?g:re.Thumb)?f:Y,qe=null!=(v=null!=(y=null==Se?void 0:Se.valueLabel)?y:re.ValueLabel)?v:Q,ze=null!=(_=null!=(S=null==Se?void 0:Se.mark)?S:re.Mark)?_:X,Je=null!=(E=null!=(T=null==Se?void 0:Se.markLabel)?T:re.MarkLabel)?E:Z,Ke=null!=(b=null!=(w=null==Se?void 0:Se.input)?w:re.Input)?b:"input",Ye=null!=(k=null==_e?void 0:_e.root)?k:ie.root,Qe=null!=(C=null==_e?void 0:_e.rail)?C:ie.rail,Xe=null!=(A=null==_e?void 0:_e.track)?A:ie.track,Ze=null!=(I=null==_e?void 0:_e.thumb)?I:ie.thumb,et=null!=(P=null==_e?void 0:_e.valueLabel)?P:ie.valueLabel,tt=null!=(D=null==_e?void 0:_e.mark)?D:ie.mark,rt=null!=(M=null==_e?void 0:_e.markLabel)?M:ie.markLabel,it=null!=(O=null==_e?void 0:_e.input)?O:ie.input,nt=h({elementType:We,getSlotProps:Ce,externalSlotProps:Ye,externalForwardedProps:we,additionalProps:(0,n.A)({},(pt=We,(!pt||!(0,m.g)(pt))&&{as:te})),ownerState:(0,n.A)({},ke,null==Ye?void 0:Ye.ownerState),className:[Be.root,oe]}),st=h({elementType:He,externalSlotProps:Qe,ownerState:ke,className:Be.rail}),ot=h({elementType:Ge,externalSlotProps:Xe,additionalProps:{style:(0,n.A)({},Re[Me].offset(Ue),Re[Me].leap(Fe))},ownerState:(0,n.A)({},ke,null==Xe?void 0:Xe.ownerState),className:Be.track}),at=h({elementType:$e,getSlotProps:Ie,externalSlotProps:Ze,ownerState:(0,n.A)({},ke,null==Ze?void 0:Ze.ownerState),className:Be.thumb}),ct=h({elementType:qe,externalSlotProps:et,ownerState:(0,n.A)({},ke,null==et?void 0:et.ownerState),className:Be.valueLabel}),dt=h({elementType:ze,externalSlotProps:tt,ownerState:ke,className:Be.mark}),lt=h({elementType:Je,externalSlotProps:rt,ownerState:ke,className:Be.markLabel}),ut=h({elementType:Ke,getSlotProps:Ae,externalSlotProps:it,ownerState:ke});var pt;return(0,G.jsxs)(We,(0,n.A)({},nt,{children:[(0,G.jsx)(He,(0,n.A)({},st)),(0,G.jsx)(Ge,(0,n.A)({},ot)),Le.filter((e=>e.value>=he&&e.value<=pe)).map(((e,t)=>{const r=R(e.value,he,pe),i=Re[Me].offset(r);let a;return a=!1===Ee?-1!==je.indexOf(e.value):"normal"===Ee&&(Ne?e.value>=je[0]&&e.value<=je[je.length-1]:e.value<=je[0])||"inverted"===Ee&&(Ne?e.value<=je[0]||e.value>=je[je.length-1]:e.value>=je[0]),(0,G.jsxs)(s.Fragment,{children:[(0,G.jsx)(ze,(0,n.A)({"data-index":t},dt,!(0,m.g)(ze)&&{markActive:a},{style:(0,n.A)({},i,dt.style),className:(0,o.A)(dt.className,a&&Be.markActive)})),null!=e.label?(0,G.jsx)(Je,(0,n.A)({"aria-hidden":!0,"data-index":t},lt,!(0,m.g)(Je)&&{markLabelActive:a},{style:(0,n.A)({},i,lt.style),className:(0,o.A)(Be.markLabel,lt.className,a&&Be.markLabelActive),children:e.label})):null]},t)})),je.map(((e,t)=>{const r=R(e,he,pe),i=Re[Me].offset(r),s="off"===Te?ee:qe;return(0,G.jsx)(s,(0,n.A)({},!(0,m.g)(s)&&{valueLabelFormat:be,valueLabelDisplay:Te,value:"function"==typeof be?be(ye(e),t):be,index:t,open:Pe===t||De===t||"on"===Te,disabled:ce},ct,{children:(0,G.jsx)($e,(0,n.A)({"data-index":t},at,{className:(0,o.A)(Be.thumb,at.className,De===t&&Be.active,Oe===t&&Be.focusVisible),style:(0,n.A)({},i,Ve(t),at.style),children:(0,G.jsx)(Ke,(0,n.A)({"data-index":t,"aria-label":de?de(t):V,"aria-valuenow":ye(e),"aria-labelledby":H,"aria-valuetext":le?le(ye(e),t):B,value:je[t]},ut))}))}),t)}))]}))})),re=te},2222:(e,t,r)=>{"use strict";r.d(t,{A:()=>R});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(4521),c=r(4111),d=r(7245);const l=(0,r(5329).Ay)();var u=r(6606),p=r(9599),h=r(6970),m=r(9452),f=r(8248),g=r(4848);const v=["component","direction","spacing","divider","children","className","useFlexGap"],y=(0,h.A)(),_=l("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function S(e){return(0,u.A)({props:e,name:"MuiStack",defaultTheme:y})}function E(e,t){const r=s.Children.toArray(e).filter(Boolean);return r.reduce(((e,i,n)=>(e.push(i),n<r.length-1&&e.push(s.cloneElement(t,{key:`separator-${n}`})),e)),[])}const T=({ownerState:e,theme:t})=>{let r=(0,n.A)({display:"flex",flexDirection:"column"},(0,m.NI)({theme:t},(0,m.kW)({values:e.direction,breakpoints:t.breakpoints.values}),(e=>({flexDirection:e}))));if(e.spacing){const i=(0,f.LX)(t),n=Object.keys(t.breakpoints.values).reduce(((t,r)=>(("object"==typeof e.spacing&&null!=e.spacing[r]||"object"==typeof e.direction&&null!=e.direction[r])&&(t[r]=!0),t)),{}),s=(0,m.kW)({values:e.direction,base:n}),o=(0,m.kW)({values:e.spacing,base:n});"object"==typeof s&&Object.keys(s).forEach(((e,t,r)=>{if(!s[e]){const i=t>0?s[r[t-1]]:"column";s[e]=i}}));const c=(t,r)=>{return e.useFlexGap?{gap:(0,f._W)(i,t)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${n=r?s[r]:e.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[n]}`]:(0,f._W)(i,t)}};var n};r=(0,a.A)(r,(0,m.NI)({theme:t},o,c))}return r=(0,m.iZ)(t.breakpoints,r),r};var b=r(1848),w=r(3541);const k=function(e={}){const{createStyledComponent:t=_,useThemeProps:r=S,componentName:a="MuiStack"}=e,l=t(T),u=s.forwardRef((function(e,t){const s=r(e),u=(0,p.A)(s),{component:h="div",direction:m="column",spacing:f=0,divider:y,children:_,className:S,useFlexGap:T=!1}=u,b=(0,i.A)(u,v),w={direction:m,spacing:f,useFlexGap:T},k=(0,c.A)({root:["root"]},(e=>(0,d.Ay)(a,e)),{});return(0,g.jsx)(l,(0,n.A)({as:h,ownerState:w,ref:t,className:(0,o.A)(k.root,S)},b,{children:y?E(_,y):_}))}));return u}({createStyledComponent:(0,b.Ay)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>(0,w.A)({props:e,name:"MuiStack"})}),R=k},4073:(e,t,r)=>{"use strict";r.d(t,{A:()=>S});var i=r(8587),n=r(8168),s=r(6540),o=r(4164),a=r(9599),c=r(4111),d=r(1848),l=r(3541),u=r(8466),p=r(7553),h=r(7245);function m(e){return(0,h.Ay)("MuiTypography",e)}(0,p.A)("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);var f=r(4848);const g=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],v=(0,d.Ay)("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.variant&&t[r.variant],"inherit"!==r.align&&t[`align${(0,u.A)(r.align)}`],r.noWrap&&t.noWrap,r.gutterBottom&&t.gutterBottom,r.paragraph&&t.paragraph]}})((({theme:e,ownerState:t})=>(0,n.A)({margin:0},"inherit"===t.variant&&{font:"inherit"},"inherit"!==t.variant&&e.typography[t.variant],"inherit"!==t.align&&{textAlign:t.align},t.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},t.gutterBottom&&{marginBottom:"0.35em"},t.paragraph&&{marginBottom:16}))),y={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},_={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},S=s.forwardRef((function(e,t){const r=(0,l.A)({props:e,name:"MuiTypography"}),s=(e=>_[e]||e)(r.color),d=(0,a.A)((0,n.A)({},r,{color:s})),{align:p="inherit",className:h,component:S,gutterBottom:E=!1,noWrap:T=!1,paragraph:b=!1,variant:w="body1",variantMapping:k=y}=d,R=(0,i.A)(d,g),C=(0,n.A)({},d,{align:p,color:s,className:h,component:S,gutterBottom:E,noWrap:T,paragraph:b,variant:w,variantMapping:k}),A=S||(b?"p":k[w]||y[w])||"span",I=(e=>{const{align:t,gutterBottom:r,noWrap:i,paragraph:n,variant:s,classes:o}=e,a={root:["root",s,"inherit"!==e.align&&`align${(0,u.A)(t)}`,r&&"gutterBottom",i&&"noWrap",n&&"paragraph"]};return(0,c.A)(a,m,o)})(C);return(0,f.jsx)(v,(0,n.A)({as:A,ref:t,ownerState:C,className:(0,o.A)(I.root,h)},R))}))},5878:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"}},5793:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var i=r(8168),n=r(8587),s=r(6540);const o=s.createContext(null);function a(){return s.useContext(o)}const c="function"==typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__";var d=r(4848);const l=function(e){const{children:t,theme:r}=e,n=a(),l=s.useMemo((()=>{const e=null===n?r:function(e,t){return"function"==typeof t?t(e):(0,i.A)({},e,t)}(n,r);return null!=e&&(e[c]=null!==n),e}),[r,n]);return(0,d.jsx)(o.Provider,{value:l,children:t})};var u=r(5684),p=r(3951);const h={};function m(e,t,r,n=!1){return s.useMemo((()=>{const s=e&&t[e]||t;if("function"==typeof r){const o=r(s),a=e?(0,i.A)({},t,{[e]:o}):o;return n?()=>a:a}return e?(0,i.A)({},t,{[e]:r}):(0,i.A)({},t,r)}),[e,t,r,n])}const f=function(e){const{children:t,theme:r,themeId:i}=e,n=(0,p.A)(h),s=a()||h,o=m(i,n,r),c=m(i,s,r,!0);return(0,d.jsx)(l,{theme:c,children:(0,d.jsx)(u.T.Provider,{value:o,children:t})})};var g=r(8312);const v=["theme"];function y(e){let{theme:t}=e,r=(0,n.A)(e,v);const s=t[g.A];return(0,d.jsx)(f,(0,i.A)({},r,{themeId:s?g.A:void 0,theme:s||t}))}},3333:(e,t,r)=>{"use strict";r.d(t,{A:()=>j});var i=r(8168),n=r(8587),s=r(5697),o=r(4521),a=r(6970),c=r(4188),d=r(3571),l=r(4279);const u={black:"#000",white:"#fff"};var p=r(5878);const h={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},m={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},f={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},g={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},v={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},y={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},_=["mode","contrastThreshold","tonalOffset"],S={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:u.white,default:u.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},E={text:{primary:u.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:u.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function T(e,t,r,i){const n=i.light||i,s=i.dark||1.5*i;e[t]||(e.hasOwnProperty(r)?e[t]=e[r]:"light"===t?e.light=(0,l.a)(e.main,n):"dark"===t&&(e.dark=(0,l.e$)(e.main,s)))}const b=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"],w={textTransform:"uppercase"},k='"Roboto", "Helvetica", "Arial", sans-serif';function R(e,t){const r="function"==typeof t?t(e):t,{fontFamily:s=k,fontSize:a=14,fontWeightLight:c=300,fontWeightRegular:d=400,fontWeightMedium:l=500,fontWeightBold:u=700,htmlFontSize:p=16,allVariants:h,pxToRem:m}=r,f=(0,n.A)(r,b),g=a/14,v=m||(e=>e/p*g+"rem"),y=(e,t,r,n,o)=>{return(0,i.A)({fontFamily:s,fontWeight:e,fontSize:v(t),lineHeight:r},s===k?{letterSpacing:(a=n/t,Math.round(1e5*a)/1e5+"em")}:{},o,h);var a},_={h1:y(c,96,1.167,-1.5),h2:y(c,60,1.2,-.5),h3:y(d,48,1.167,0),h4:y(d,34,1.235,.25),h5:y(d,24,1.334,0),h6:y(l,20,1.6,.15),subtitle1:y(d,16,1.75,.15),subtitle2:y(l,14,1.57,.1),body1:y(d,16,1.5,.15),body2:y(d,14,1.43,.15),button:y(l,14,1.75,.4,w),caption:y(d,12,1.66,.4),overline:y(d,12,2.66,1,w),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return(0,o.A)((0,i.A)({htmlFontSize:p,pxToRem:v,fontFamily:s,fontSize:a,fontWeightLight:c,fontWeightRegular:d,fontWeightMedium:l,fontWeightBold:u},_),f,{clone:!1})}function C(...e){return[`${e[0]}px ${e[1]}px ${e[2]}px ${e[3]}px rgba(0,0,0,0.2)`,`${e[4]}px ${e[5]}px ${e[6]}px ${e[7]}px rgba(0,0,0,0.14)`,`${e[8]}px ${e[9]}px ${e[10]}px ${e[11]}px rgba(0,0,0,0.12)`].join(",")}const A=["none",C(0,2,1,-1,0,1,1,0,0,1,3,0),C(0,3,1,-2,0,2,2,0,0,1,5,0),C(0,3,3,-2,0,3,4,0,0,1,8,0),C(0,2,4,-1,0,4,5,0,0,1,10,0),C(0,3,5,-1,0,5,8,0,0,1,14,0),C(0,3,5,-1,0,6,10,0,0,1,18,0),C(0,4,5,-2,0,7,10,1,0,2,16,1),C(0,5,5,-3,0,8,10,1,0,3,14,2),C(0,5,6,-3,0,9,12,1,0,3,16,2),C(0,6,6,-3,0,10,14,1,0,4,18,3),C(0,6,7,-4,0,11,15,1,0,4,20,3),C(0,7,8,-4,0,12,17,2,0,5,22,4),C(0,7,8,-4,0,13,19,2,0,5,24,4),C(0,7,9,-4,0,14,21,2,0,5,26,4),C(0,8,9,-5,0,15,22,2,0,6,28,5),C(0,8,10,-5,0,16,24,2,0,6,30,5),C(0,8,11,-5,0,17,26,2,0,6,32,5),C(0,9,11,-5,0,18,28,2,0,7,34,6),C(0,9,12,-6,0,19,29,2,0,7,36,6),C(0,10,13,-6,0,20,31,3,0,8,38,7),C(0,10,13,-6,0,21,33,3,0,8,40,7),C(0,10,14,-6,0,22,35,3,0,8,42,7),C(0,11,14,-7,0,23,36,3,0,9,44,8),C(0,11,15,-7,0,24,38,3,0,9,46,8)],I=["duration","easing","delay"],P={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},D={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function M(e){return`${Math.round(e)}ms`}function O(e){if(!e)return 0;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}function N(e){const t=(0,i.A)({},P,e.easing),r=(0,i.A)({},D,e.duration);return(0,i.A)({getAutoHeightDuration:O,create:(e=["all"],i={})=>{const{duration:s=r.standard,easing:o=t.easeInOut,delay:a=0}=i;return(0,n.A)(i,I),(Array.isArray(e)?e:[e]).map((e=>`${e} ${"string"==typeof s?s:M(s)} ${o} ${"string"==typeof a?a:M(a)}`)).join(",")}},e,{easing:t,duration:r})}const x={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},L=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];const j=function(e={},...t){const{mixins:r={},palette:b={},transitions:w={},typography:k={}}=e,C=(0,n.A)(e,L);if(e.vars)throw new Error((0,s.A)(18));const I=function(e){const{mode:t="light",contrastThreshold:r=3,tonalOffset:a=.2}=e,c=(0,n.A)(e,_),d=e.primary||function(e="light"){return"dark"===e?{main:g[200],light:g[50],dark:g[400]}:{main:g[700],light:g[400],dark:g[800]}}(t),b=e.secondary||function(e="light"){return"dark"===e?{main:h[200],light:h[50],dark:h[400]}:{main:h[500],light:h[300],dark:h[700]}}(t),w=e.error||function(e="light"){return"dark"===e?{main:m[500],light:m[300],dark:m[700]}:{main:m[700],light:m[400],dark:m[800]}}(t),k=e.info||function(e="light"){return"dark"===e?{main:v[400],light:v[300],dark:v[700]}:{main:v[700],light:v[500],dark:v[900]}}(t),R=e.success||function(e="light"){return"dark"===e?{main:y[400],light:y[300],dark:y[700]}:{main:y[800],light:y[500],dark:y[900]}}(t),C=e.warning||function(e="light"){return"dark"===e?{main:f[400],light:f[300],dark:f[700]}:{main:"#ed6c02",light:f[500],dark:f[900]}}(t);function A(e){return(0,l.eM)(e,E.text.primary)>=r?E.text.primary:S.text.primary}const I=({color:e,name:t,mainShade:r=500,lightShade:n=300,darkShade:o=700})=>{if(!(e=(0,i.A)({},e)).main&&e[r]&&(e.main=e[r]),!e.hasOwnProperty("main"))throw new Error((0,s.A)(11,t?` (${t})`:"",r));if("string"!=typeof e.main)throw new Error((0,s.A)(12,t?` (${t})`:"",JSON.stringify(e.main)));return T(e,"light",n,a),T(e,"dark",o,a),e.contrastText||(e.contrastText=A(e.main)),e},P={dark:E,light:S};return(0,o.A)((0,i.A)({common:(0,i.A)({},u),mode:t,primary:I({color:d,name:"primary"}),secondary:I({color:b,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:I({color:w,name:"error"}),warning:I({color:C,name:"warning"}),info:I({color:k,name:"info"}),success:I({color:R,name:"success"}),grey:p.A,contrastThreshold:r,getContrastText:A,augmentColor:I,tonalOffset:a},P[t]),c)}(b),P=(0,a.A)(e);let D=(0,o.A)(P,{mixins:(M=P.breakpoints,O=r,(0,i.A)({toolbar:{minHeight:56,[M.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[M.up("sm")]:{minHeight:64}}},O)),palette:I,shadows:A.slice(),typography:R(I,k),transitions:N(w),zIndex:(0,i.A)({},x)});var M,O;return D=(0,o.A)(D,C),D=t.reduce(((e,t)=>(0,o.A)(e,t)),D),D.unstable_sxConfig=(0,i.A)({},c.A,null==C?void 0:C.unstable_sxConfig),D.unstable_sx=function(e){return(0,d.A)({sx:e,theme:this})},D}},2765:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i=(0,r(3333).A)()},8312:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i="$$material"},1406:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(8168),n=r(5697);function s(e){return String(parseFloat(e)).length===String(e).length}function o(e){return parseFloat(e)}function a({lineHeight:e,pixels:t,htmlFontSize:r}){return t/(e*r)}function c(e,t={}){const{breakpoints:r=["sm","md","lg"],disableAlign:c=!1,factor:d=2,variants:l=["h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","caption","button","overline"]}=t,u=(0,i.A)({},e);u.typography=(0,i.A)({},u.typography);const p=u.typography,h=(f=p.htmlFontSize,(e,t)=>{const r=String(e).match(/[\d.\-+]*\s*(.*)/)[1]||"";if(r===t)return e;let i=o(e);"px"!==r&&("em"===r||"rem"===r)&&(i=o(e)*o(f));let n=i;if("px"!==t)if("em"===t)n=i/o(f);else{if("rem"!==t)return e;n=i/o(f)}return parseFloat(n.toFixed(5))+t}),m=r.map((e=>u.breakpoints.values[e]));var f;return l.forEach((e=>{const t=p[e],r=parseFloat(h(t.fontSize,"rem"));if(r<=1)return;const o=r,l=1+(o-1)/d;let{lineHeight:u}=t;if(!s(u)&&!c)throw new Error((0,n.A)(6));s(u)||(u=parseFloat(h(u,"rem"))/parseFloat(r));let f=null;c||(f=e=>function({size:e,grid:t}){const r=e-e%t,i=r+t;return e-r<i-e?r:i}({size:e,grid:a({pixels:4,lineHeight:u,htmlFontSize:p.htmlFontSize})})),p[e]=(0,i.A)({},t,function({cssProperty:e,min:t,max:r,unit:i="rem",breakpoints:n=[600,900,1200],transform:s=null}){const o={[e]:`${t}${i}`},a=(r-t)/n[n.length-1];return n.forEach((r=>{let n=t+a*r;null!==s&&(n=s(n)),o[`@media (min-width:${r}px)`]={[e]:`${Math.round(1e4*n)/1e4}${i}`}})),o}({cssProperty:"fontSize",min:l,max:o,unit:"rem",breakpoints:m,transform:f}))})),u}},1848:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>c,_n:()=>a,ep:()=>o});var i=r(5329),n=r(2765),s=r(8312);const o=e=>(0,i.MC)(e)&&"classes"!==e,a=i.MC,c=(0,i.Ay)({themeId:s.A,defaultTheme:n.A,rootShouldForwardProp:o})},4675:(e,t,r)=>{"use strict";r.d(t,{A:()=>o}),r(6540);var i=r(2858),n=r(2765),s=r(8312);function o(){const e=(0,i.A)(n.A);return e[s.A]||e}},3541:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i=r(6606),n=r(2765),s=r(8312);function o({props:e,name:t}){return(0,i.A)({props:e,name:t,defaultTheme:n.A,themeId:s.A})}},8466:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i=r(8659).A},5003:(e,t,r)=>{"use strict";r.d(t,{A:()=>_});var i=r(8168),n=r(6540),s=r(8587),o=r(4164),a=r(4111),c=r(8466),d=r(3541),l=r(1848),u=r(7553),p=r(7245);function h(e){return(0,p.Ay)("MuiSvgIcon",e)}(0,u.A)("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var m=r(4848);const f=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],g=(0,l.Ay)("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,"inherit"!==r.color&&t[`color${(0,c.A)(r.color)}`],t[`fontSize${(0,c.A)(r.fontSize)}`]]}})((({theme:e,ownerState:t})=>{var r,i,n,s,o,a,c,d,l,u,p,h,m;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:t.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(r=e.transitions)||null==(i=r.create)?void 0:i.call(r,"fill",{duration:null==(n=e.transitions)||null==(n=n.duration)?void 0:n.shorter}),fontSize:{inherit:"inherit",small:(null==(s=e.typography)||null==(o=s.pxToRem)?void 0:o.call(s,20))||"1.25rem",medium:(null==(a=e.typography)||null==(c=a.pxToRem)?void 0:c.call(a,24))||"1.5rem",large:(null==(d=e.typography)||null==(l=d.pxToRem)?void 0:l.call(d,35))||"2.1875rem"}[t.fontSize],color:null!=(u=null==(p=(e.vars||e).palette)||null==(p=p[t.color])?void 0:p.main)?u:{action:null==(h=(e.vars||e).palette)||null==(h=h.action)?void 0:h.active,disabled:null==(m=(e.vars||e).palette)||null==(m=m.action)?void 0:m.disabled,inherit:void 0}[t.color]}})),v=n.forwardRef((function(e,t){const r=(0,d.A)({props:e,name:"MuiSvgIcon"}),{children:l,className:u,color:p="inherit",component:v="svg",fontSize:y="medium",htmlColor:_,inheritViewBox:S=!1,titleAccess:E,viewBox:T="0 0 24 24"}=r,b=(0,s.A)(r,f),w=n.isValidElement(l)&&"svg"===l.type,k=(0,i.A)({},r,{color:p,component:v,fontSize:y,instanceFontSize:e.fontSize,inheritViewBox:S,viewBox:T,hasSvgAsChild:w}),R={};S||(R.viewBox=T);const C=(e=>{const{color:t,fontSize:r,classes:i}=e,n={root:["root","inherit"!==t&&`color${(0,c.A)(t)}`,`fontSize${(0,c.A)(r)}`]};return(0,a.A)(n,h,i)})(k);return(0,m.jsxs)(g,(0,i.A)({as:v,className:(0,o.A)(C.root,u),focusable:"false",color:_,"aria-hidden":!E||void 0,role:E?"img":void 0,ref:t},R,b,w&&l.props,{ownerState:k,children:[w?l.props.children:l,E?(0,m.jsx)("title",{children:E}):null]}))}));v.muiName="SvgIcon";const y=v;function _(e,t){function r(r,n){return(0,m.jsx)(y,(0,i.A)({"data-testid":`${t}Icon`,ref:n},r,{children:e}))}return r.muiName=y.muiName,n.memo(n.forwardRef(r))}},3743:(e,t,r)=>{"use strict";r.r(t),r.d(t,{capitalize:()=>n.A,createChainedFunction:()=>s,createSvgIcon:()=>o.A,debounce:()=>a,deprecatedPropType:()=>c,isMuiElement:()=>u,ownerDocument:()=>h,ownerWindow:()=>m,requirePropFactory:()=>f,setRef:()=>g,unstable_ClassNameGenerator:()=>R,unstable_useEnhancedEffect:()=>v,unstable_useId:()=>S,unsupportedProp:()=>E,useControlled:()=>T,useEventCallback:()=>b.A,useForkRef:()=>w.A,useIsFocusVisible:()=>k.A});var i=r(2067),n=r(8466);const s=function(...e){return e.reduce(((e,t)=>null==t?e:function(...r){e.apply(this,r),t.apply(this,r)}),(()=>{}))};var o=r(5003);const a=function(e,t=166){let r;function i(...i){clearTimeout(r),r=setTimeout((()=>{e.apply(this,i)}),t)}return i.clear=()=>{clearTimeout(r)},i},c=function(e,t){return()=>null};var d=r(6540),l=r.t(d,2);const u=function(e,t){var r,i;return d.isValidElement(e)&&-1!==t.indexOf(null!=(r=e.type.muiName)?r:null==(i=e.type)||null==(i=i._payload)||null==(i=i.value)?void 0:i.muiName)};var p=r(6249);const h=p.A,m=function(e){return(0,p.A)(e).defaultView||window};r(8168);const f=function(e,t){return()=>null},g=r(3721).A,v=r(173).A;let y=0;const _=l["useId".toString()],S=function(e){if(void 0!==_){const t=_();return null!=e?e:t}return function(e){const[t,r]=d.useState(e),i=e||t;return d.useEffect((()=>{null==t&&(y+=1,r(`mui-${y}`))}),[t]),i}(e)},E=function(e,t,r,i,n){return null},T=r(3833).A;var b=r(3034),w=r(6852),k=r(8851);const R={configure:e=>{i.A.configure(e)}}},3034:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i=r(6111).A},6852:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i=r(4871).A},8851:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i=r(7749).A},4317:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>y,q_:()=>_});var i=r(8168),n=r(6540),s=r(6289),o=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,a=(0,s.A)((function(e){return o.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),c=r(5684),d=function(e,t,r){var i=e.key+"-"+t.name;!1===r&&void 0===e.registered[i]&&(e.registered[i]=t.styles)},l=r(3451),u=r(1287),p=a,h=function(e){return"theme"!==e},m=function(e){return"string"==typeof e&&e.charCodeAt(0)>96?p:h},f=function(e,t,r){var i;if(t){var n=t.shouldForwardProp;i=e.__emotion_forwardProp&&n?function(t){return e.__emotion_forwardProp(t)&&n(t)}:n}return"function"!=typeof i&&r&&(i=e.__emotion_forwardProp),i},g=function(e){var t=e.cache,r=e.serialized,i=e.isStringTag;return d(t,r,i),(0,u.s)((function(){return function(e,t,r){d(e,t,r);var i=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var n=t;do{e.insert(t===n?"."+i:"",n,e.sheet,!0),n=n.next}while(void 0!==n)}}(t,r,i)})),null},v=function e(t,r){var s,o,a=t.__emotion_real===t,d=a&&t.__emotion_base||t;void 0!==r&&(s=r.label,o=r.target);var u=f(t,r,a),p=u||m(d),h=!p("as");return function(){var v=arguments,y=a&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==s&&y.push("label:"+s+";"),null==v[0]||void 0===v[0].raw)y.push.apply(y,v);else{y.push(v[0][0]);for(var _=v.length,S=1;S<_;S++)y.push(v[S],v[0][S])}var E=(0,c.w)((function(e,t,r){var i,s,a,f,v=h&&e.as||d,_="",S=[],E=e;if(null==e.theme){for(var T in E={},e)E[T]=e[T];E.theme=n.useContext(c.T)}"string"==typeof e.className?(i=t.registered,s=S,a=e.className,f="",a.split(" ").forEach((function(e){void 0!==i[e]?s.push(i[e]+";"):f+=e+" "})),_=f):null!=e.className&&(_=e.className+" ");var b=(0,l.J)(y.concat(S),t.registered,E);_+=t.key+"-"+b.name,void 0!==o&&(_+=" "+o);var w=h&&void 0===u?m(v):p,k={};for(var R in e)h&&"as"===R||w(R)&&(k[R]=e[R]);return k.className=_,k.ref=r,n.createElement(n.Fragment,null,n.createElement(g,{cache:t,serialized:b,isStringTag:"string"==typeof v}),n.createElement(v,k))}));return E.displayName=void 0!==s?s:"Styled("+("string"==typeof d?d:d.displayName||d.name||"Component")+")",E.defaultProps=t.defaultProps,E.__emotion_real=E,E.__emotion_base=d,E.__emotion_styles=y,E.__emotion_forwardProp=u,Object.defineProperty(E,"toString",{value:function(){return"."+o}}),E.withComponent=function(t,n){return e(t,(0,i.A)({},r,n,{shouldForwardProp:f(E,n,!0)})).apply(void 0,y)},E}}.bind();function y(e,t){return v(e,t)}["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){v[e]=v(e)}));const _=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},9452:(e,t,r)=>{"use strict";r.d(t,{EU:()=>a,NI:()=>o,iZ:()=>d,kW:()=>l,vf:()=>c,zu:()=>n});var i=r(4521);const n={xs:0,sm:600,md:900,lg:1200,xl:1536},s={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${n[e]}px)`};function o(e,t,r){const i=e.theme||{};if(Array.isArray(t)){const e=i.breakpoints||s;return t.reduce(((i,n,s)=>(i[e.up(e.keys[s])]=r(t[s]),i)),{})}if("object"==typeof t){const e=i.breakpoints||s;return Object.keys(t).reduce(((i,s)=>{if(-1!==Object.keys(e.values||n).indexOf(s))i[e.up(s)]=r(t[s],s);else{const e=s;i[e]=t[e]}return i}),{})}return r(t)}function a(e={}){var t;return(null==(t=e.keys)?void 0:t.reduce(((t,r)=>(t[e.up(r)]={},t)),{}))||{}}function c(e,t){return e.reduce(((e,t)=>{const r=e[t];return(!r||0===Object.keys(r).length)&&delete e[t],e}),t)}function d(e,...t){const r=a(e),n=[r,...t].reduce(((e,t)=>(0,i.A)(e,t)),{});return c(Object.keys(r),n)}function l({values:e,breakpoints:t,base:r}){const i=r||function(e,t){if("object"!=typeof e)return{};const r={},i=Object.keys(t);return Array.isArray(e)?i.forEach(((t,i)=>{i<e.length&&(r[t]=!0)})):i.forEach((t=>{null!=e[t]&&(r[t]=!0)})),r}(e,t),n=Object.keys(i);if(0===n.length)return e;let s;return n.reduce(((t,r,i)=>(Array.isArray(e)?(t[r]=null!=e[i]?e[i]:e[s],s=i):"object"==typeof e?(t[r]=null!=e[r]?e[r]:e[s],s=r):t[r]=e,t)),{})}},4279:(e,t,r)=>{"use strict";r.d(t,{X4:()=>l,a:()=>p,e$:()=>u,eM:()=>d});var i=r(5697),n=r(6937);function s(e,t=0,r=1){return(0,n.A)(e,t,r)}function o(e){if(e.type)return e;if("#"===e.charAt(0))return o(function(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let r=e.match(t);return r&&1===r[0].length&&(r=r.map((e=>e+e))),r?`rgb${4===r.length?"a":""}(${r.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}(e));const t=e.indexOf("("),r=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(r))throw new Error((0,i.A)(9,e));let n,s=e.substring(t+1,e.length-1);if("color"===r){if(s=s.split(" "),n=s.shift(),4===s.length&&"/"===s[3].charAt(0)&&(s[3]=s[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(n))throw new Error((0,i.A)(10,n))}else s=s.split(",");return s=s.map((e=>parseFloat(e))),{type:r,values:s,colorSpace:n}}function a(e){const{type:t,colorSpace:r}=e;let{values:i}=e;return-1!==t.indexOf("rgb")?i=i.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(i[1]=`${i[1]}%`,i[2]=`${i[2]}%`),i=-1!==t.indexOf("color")?`${r} ${i.join(" ")}`:`${i.join(", ")}`,`${t}(${i})`}function c(e){let t="hsl"===(e=o(e)).type||"hsla"===e.type?o(function(e){e=o(e);const{values:t}=e,r=t[0],i=t[1]/100,n=t[2]/100,s=i*Math.min(n,1-n),c=(e,t=(e+r/30)%12)=>n-s*Math.max(Math.min(t-3,9-t,1),-1);let d="rgb";const l=[Math.round(255*c(0)),Math.round(255*c(8)),Math.round(255*c(4))];return"hsla"===e.type&&(d+="a",l.push(t[3])),a({type:d,values:l})}(e)).values:e.values;return t=t.map((t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function d(e,t){const r=c(e),i=c(t);return(Math.max(r,i)+.05)/(Math.min(r,i)+.05)}function l(e,t){return e=o(e),t=s(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,a(e)}function u(e,t){if(e=o(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(let r=0;r<3;r+=1)e.values[r]*=1-t;return a(e)}function p(e,t){if(e=o(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(let r=0;r<3;r+=1)e.values[r]+=(255-e.values[r])*t;else if(-1!==e.type.indexOf("color"))for(let r=0;r<3;r+=1)e.values[r]+=(1-e.values[r])*t;return a(e)}},5329:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>y,MC:()=>p});var i=r(8168),n=r(8587),s=r(4317),o=r(4521),a=r(6970),c=r(3571);const d=["ownerState"],l=["variants"],u=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function p(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const h=(0,a.A)(),m=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function f({defaultTheme:e,theme:t,themeId:r}){return i=t,0===Object.keys(i).length?e:t[r]||t;var i}function g(e){return e?(t,r)=>r[e]:null}function v(e,t){let{ownerState:r}=t,s=(0,n.A)(t,d);const o="function"==typeof e?e((0,i.A)({ownerState:r},s)):e;if(Array.isArray(o))return o.flatMap((e=>v(e,(0,i.A)({ownerState:r},s))));if(o&&"object"==typeof o&&Array.isArray(o.variants)){const{variants:e=[]}=o;let t=(0,n.A)(o,l);return e.forEach((e=>{let n=!0;"function"==typeof e.props?n=e.props((0,i.A)({ownerState:r},s)):Object.keys(e.props).forEach((t=>{(null==r?void 0:r[t])!==e.props[t]&&s[t]!==e.props[t]&&(n=!1)})),n&&(Array.isArray(t)||(t=[t]),t.push("function"==typeof e.style?e.style((0,i.A)({ownerState:r},s)):e.style))})),t}return o}function y(e={}){const{themeId:t,defaultTheme:r=h,rootShouldForwardProp:a=p,slotShouldForwardProp:d=p}=e,l=e=>(0,c.A)((0,i.A)({},e,{theme:f((0,i.A)({},e,{defaultTheme:r,themeId:t}))}));return l.__mui_systemSx=!0,(e,c={})=>{(0,s.q_)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:h,slot:y,skipVariantsResolver:_,skipSx:S,overridesResolver:E=g(m(y))}=c,T=(0,n.A)(c,u),b=void 0!==_?_:y&&"Root"!==y&&"root"!==y||!1,w=S||!1;let k=p;"Root"===y||"root"===y?k=a:y?k=d:function(e){return"string"==typeof e&&e.charCodeAt(0)>96}(e)&&(k=void 0);const R=(0,s.Ay)(e,(0,i.A)({shouldForwardProp:k,label:void 0},T)),C=e=>"function"==typeof e&&e.__emotion_real!==e||(0,o.Q)(e)?n=>v(e,(0,i.A)({},n,{theme:f({theme:n.theme,defaultTheme:r,themeId:t})})):e,A=(n,...s)=>{let o=C(n);const a=s?s.map(C):[];h&&E&&a.push((e=>{const n=f((0,i.A)({},e,{defaultTheme:r,themeId:t}));if(!n.components||!n.components[h]||!n.components[h].styleOverrides)return null;const s=n.components[h].styleOverrides,o={};return Object.entries(s).forEach((([t,r])=>{o[t]=v(r,(0,i.A)({},e,{theme:n}))})),E(e,o)})),h&&!b&&a.push((e=>{var n;const s=f((0,i.A)({},e,{defaultTheme:r,themeId:t}));return v({variants:null==s||null==(n=s.components)||null==(n=n[h])?void 0:n.variants},(0,i.A)({},e,{theme:s}))})),w||a.push(l);const c=a.length-s.length;if(Array.isArray(n)&&c>0){const e=new Array(c).fill("");o=[...n,...e],o.raw=[...n.raw,...e]}const d=R(o,...a);return e.muiName&&(d.muiName=e.muiName),d};return R.withConfig&&(A.withConfig=R.withConfig),A}}},6970:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(8168),n=r(8587),s=r(4521);const o=["values","unit","step"],a={borderRadius:4};var c=r(8248),d=r(3571),l=r(4188);function u(e,t){const r=this;return r.vars&&"function"==typeof r.getColorSchemeSelector?{[r.getColorSchemeSelector(e).replace(/(\[[^\]]+\])/,"*:where($1)")]:t}:r.palette.mode===e?t:{}}const p=["breakpoints","palette","spacing","shape"],h=function(e={},...t){const{breakpoints:r={},palette:h={},spacing:m,shape:f={}}=e,g=(0,n.A)(e,p),v=function(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:r="px",step:s=5}=e,a=(0,n.A)(e,o),c=(e=>{const t=Object.keys(e).map((t=>({key:t,val:e[t]})))||[];return t.sort(((e,t)=>e.val-t.val)),t.reduce(((e,t)=>(0,i.A)({},e,{[t.key]:t.val})),{})})(t),d=Object.keys(c);function l(e){return`@media (min-width:${"number"==typeof t[e]?t[e]:e}${r})`}function u(e){return`@media (max-width:${("number"==typeof t[e]?t[e]:e)-s/100}${r})`}function p(e,i){const n=d.indexOf(i);return`@media (min-width:${"number"==typeof t[e]?t[e]:e}${r}) and (max-width:${(-1!==n&&"number"==typeof t[d[n]]?t[d[n]]:i)-s/100}${r})`}return(0,i.A)({keys:d,values:c,up:l,down:u,between:p,only:function(e){return d.indexOf(e)+1<d.length?p(e,d[d.indexOf(e)+1]):l(e)},not:function(e){const t=d.indexOf(e);return 0===t?l(d[1]):t===d.length-1?u(d[t]):p(e,d[d.indexOf(e)+1]).replace("@media","@media not all and")},unit:r},a)}(r),y=function(e=8){if(e.mui)return e;const t=(0,c.LX)({spacing:e}),r=(...e)=>(0===e.length?[1]:e).map((e=>{const r=t(e);return"number"==typeof r?`${r}px`:r})).join(" ");return r.mui=!0,r}(m);let _=(0,s.A)({breakpoints:v,direction:"ltr",components:{},palette:(0,i.A)({mode:"light"},h),spacing:y,shape:(0,i.A)({},a,f)},g);return _.applyStyles=u,_=t.reduce(((e,t)=>(0,s.A)(e,t)),_),_.unstable_sxConfig=(0,i.A)({},l.A,null==g?void 0:g.unstable_sxConfig),_.unstable_sx=function(e){return(0,d.A)({sx:e,theme:this})},_}},4620:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(4521);const n=function(e,t){return t?(0,i.A)(e,t,{clone:!1}):e}},8248:(e,t,r)=>{"use strict";r.d(t,{LX:()=>m,MA:()=>h,_W:()=>f,Lc:()=>v,Ms:()=>y});var i=r(9452),n=r(6481),s=r(4620);const o={m:"margin",p:"padding"},a={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},c={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},d=function(e){const t={};return e=>(void 0===t[e]&&(t[e]=(e=>{if(e.length>2){if(!c[e])return[e];e=c[e]}const[t,r]=e.split(""),i=o[t],n=a[r]||"";return Array.isArray(n)?n.map((e=>i+e)):[i+n]})(e)),t[e])}(),l=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],u=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],p=[...l,...u];function h(e,t,r,i){var s;const o=null!=(s=(0,n.Yn)(e,t,!1))?s:r;return"number"==typeof o?e=>"string"==typeof e?e:o*e:Array.isArray(o)?e=>"string"==typeof e?e:o[e]:"function"==typeof o?o:()=>{}}function m(e){return h(e,"spacing",8)}function f(e,t){if("string"==typeof t||null==t)return t;const r=e(Math.abs(t));return t>=0?r:"number"==typeof r?-r:`-${r}`}function g(e,t){const r=m(e.theme);return Object.keys(e).map((n=>function(e,t,r,n){if(-1===t.indexOf(r))return null;const s=function(e,t){return r=>e.reduce(((e,i)=>(e[i]=f(t,r),e)),{})}(d(r),n),o=e[r];return(0,i.NI)(e,o,s)}(e,t,n,r))).reduce(s.A,{})}function v(e){return g(e,l)}function y(e){return g(e,u)}function _(e){return g(e,p)}v.propTypes={},v.filterProps=l,y.propTypes={},y.filterProps=u,_.propTypes={},_.filterProps=p},6481:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>a,BO:()=>o,Yn:()=>s});var i=r(8659),n=r(9452);function s(e,t,r=!0){if(!t||"string"!=typeof t)return null;if(e&&e.vars&&r){const r=`vars.${t}`.split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),e);if(null!=r)return r}return t.split(".").reduce(((e,t)=>e&&null!=e[t]?e[t]:null),e)}function o(e,t,r,i=r){let n;return n="function"==typeof e?e(r):Array.isArray(e)?e[r]||i:s(e,r)||i,t&&(n=t(n,i,e)),n}const a=function(e){const{prop:t,cssProperty:r=e.prop,themeKey:a,transform:c}=e,d=e=>{if(null==e[t])return null;const d=e[t],l=s(e.theme,a)||{};return(0,n.NI)(e,d,(e=>{let n=o(l,c,e);return e===n&&"string"==typeof e&&(n=o(l,c,`${t}${"default"===e?"":(0,i.A)(e)}`,e)),!1===r?n:{[r]:n}}))};return d.propTypes={},d.filterProps=[t],d}},4188:(e,t,r)=>{"use strict";r.d(t,{A:()=>N});var i=r(8248),n=r(6481),s=r(4620);const o=function(...e){const t=e.reduce(((e,t)=>(t.filterProps.forEach((r=>{e[r]=t})),e)),{}),r=e=>Object.keys(e).reduce(((r,i)=>t[i]?(0,s.A)(r,t[i](e)):r),{});return r.propTypes={},r.filterProps=e.reduce(((e,t)=>e.concat(t.filterProps)),[]),r};var a=r(9452);function c(e){return"number"!=typeof e?e:`${e}px solid`}function d(e,t){return(0,n.Ay)({prop:e,themeKey:"borders",transform:t})}const l=d("border",c),u=d("borderTop",c),p=d("borderRight",c),h=d("borderBottom",c),m=d("borderLeft",c),f=d("borderColor"),g=d("borderTopColor"),v=d("borderRightColor"),y=d("borderBottomColor"),_=d("borderLeftColor"),S=d("outline",c),E=d("outlineColor"),T=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=(0,i.MA)(e.theme,"shape.borderRadius",4,"borderRadius"),r=e=>({borderRadius:(0,i._W)(t,e)});return(0,a.NI)(e,e.borderRadius,r)}return null};T.propTypes={},T.filterProps=["borderRadius"],o(l,u,p,h,m,f,g,v,y,_,T,S,E);const b=e=>{if(void 0!==e.gap&&null!==e.gap){const t=(0,i.MA)(e.theme,"spacing",8,"gap"),r=e=>({gap:(0,i._W)(t,e)});return(0,a.NI)(e,e.gap,r)}return null};b.propTypes={},b.filterProps=["gap"];const w=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=(0,i.MA)(e.theme,"spacing",8,"columnGap"),r=e=>({columnGap:(0,i._W)(t,e)});return(0,a.NI)(e,e.columnGap,r)}return null};w.propTypes={},w.filterProps=["columnGap"];const k=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=(0,i.MA)(e.theme,"spacing",8,"rowGap"),r=e=>({rowGap:(0,i._W)(t,e)});return(0,a.NI)(e,e.rowGap,r)}return null};function R(e,t){return"grey"===t?t:e}function C(e){return e<=1&&0!==e?100*e+"%":e}k.propTypes={},k.filterProps=["rowGap"],o(b,w,k,(0,n.Ay)({prop:"gridColumn"}),(0,n.Ay)({prop:"gridRow"}),(0,n.Ay)({prop:"gridAutoFlow"}),(0,n.Ay)({prop:"gridAutoColumns"}),(0,n.Ay)({prop:"gridAutoRows"}),(0,n.Ay)({prop:"gridTemplateColumns"}),(0,n.Ay)({prop:"gridTemplateRows"}),(0,n.Ay)({prop:"gridTemplateAreas"}),(0,n.Ay)({prop:"gridArea"})),o((0,n.Ay)({prop:"color",themeKey:"palette",transform:R}),(0,n.Ay)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:R}),(0,n.Ay)({prop:"backgroundColor",themeKey:"palette",transform:R}));const A=(0,n.Ay)({prop:"width",transform:C}),I=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var r,i;const n=(null==(r=e.theme)||null==(r=r.breakpoints)||null==(r=r.values)?void 0:r[t])||a.zu[t];return n?"px"!==(null==(i=e.theme)||null==(i=i.breakpoints)?void 0:i.unit)?{maxWidth:`${n}${e.theme.breakpoints.unit}`}:{maxWidth:n}:{maxWidth:C(t)}};return(0,a.NI)(e,e.maxWidth,t)}return null};I.filterProps=["maxWidth"];const P=(0,n.Ay)({prop:"minWidth",transform:C}),D=(0,n.Ay)({prop:"height",transform:C}),M=(0,n.Ay)({prop:"maxHeight",transform:C}),O=(0,n.Ay)({prop:"minHeight",transform:C}),N=((0,n.Ay)({prop:"size",cssProperty:"width",transform:C}),(0,n.Ay)({prop:"size",cssProperty:"height",transform:C}),o(A,I,P,D,M,O,(0,n.Ay)({prop:"boxSizing"})),{border:{themeKey:"borders",transform:c},borderTop:{themeKey:"borders",transform:c},borderRight:{themeKey:"borders",transform:c},borderBottom:{themeKey:"borders",transform:c},borderLeft:{themeKey:"borders",transform:c},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:c},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:T},color:{themeKey:"palette",transform:R},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:R},backgroundColor:{themeKey:"palette",transform:R},p:{style:i.Ms},pt:{style:i.Ms},pr:{style:i.Ms},pb:{style:i.Ms},pl:{style:i.Ms},px:{style:i.Ms},py:{style:i.Ms},padding:{style:i.Ms},paddingTop:{style:i.Ms},paddingRight:{style:i.Ms},paddingBottom:{style:i.Ms},paddingLeft:{style:i.Ms},paddingX:{style:i.Ms},paddingY:{style:i.Ms},paddingInline:{style:i.Ms},paddingInlineStart:{style:i.Ms},paddingInlineEnd:{style:i.Ms},paddingBlock:{style:i.Ms},paddingBlockStart:{style:i.Ms},paddingBlockEnd:{style:i.Ms},m:{style:i.Lc},mt:{style:i.Lc},mr:{style:i.Lc},mb:{style:i.Lc},ml:{style:i.Lc},mx:{style:i.Lc},my:{style:i.Lc},margin:{style:i.Lc},marginTop:{style:i.Lc},marginRight:{style:i.Lc},marginBottom:{style:i.Lc},marginLeft:{style:i.Lc},marginX:{style:i.Lc},marginY:{style:i.Lc},marginInline:{style:i.Lc},marginInlineStart:{style:i.Lc},marginInlineEnd:{style:i.Lc},marginBlock:{style:i.Lc},marginBlockStart:{style:i.Lc},marginBlockEnd:{style:i.Lc},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:b},rowGap:{style:k},columnGap:{style:w},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:C},maxWidth:{style:I},minWidth:{transform:C},height:{transform:C},maxHeight:{transform:C},minHeight:{transform:C},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}})},9599:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(8168),n=r(8587),s=r(4521),o=r(4188);const a=["sx"],c=e=>{var t,r;const i={systemProps:{},otherProps:{}},n=null!=(t=null==e||null==(r=e.theme)?void 0:r.unstable_sxConfig)?t:o.A;return Object.keys(e).forEach((t=>{n[t]?i.systemProps[t]=e[t]:i.otherProps[t]=e[t]})),i};function d(e){const{sx:t}=e,r=(0,n.A)(e,a),{systemProps:o,otherProps:d}=c(r);let l;return l=Array.isArray(t)?[o,...t]:"function"==typeof t?(...e)=>{const r=t(...e);return(0,s.Q)(r)?(0,i.A)({},o,r):o}:(0,i.A)({},o,t),(0,i.A)({},d,{sx:l})}},3571:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(8659),n=r(4620),s=r(6481),o=r(9452),a=r(4188);const c=function(){function e(e,t,r,n){const a={[e]:t,theme:r},c=n[e];if(!c)return{[e]:t};const{cssProperty:d=e,themeKey:l,transform:u,style:p}=c;if(null==t)return null;if("typography"===l&&"inherit"===t)return{[e]:t};const h=(0,s.Yn)(r,l)||{};return p?p(a):(0,o.NI)(a,t,(t=>{let r=(0,s.BO)(h,u,t);return t===r&&"string"==typeof t&&(r=(0,s.BO)(h,u,`${e}${"default"===t?"":(0,i.A)(t)}`,t)),!1===d?r:{[d]:r}}))}return function t(r){var i;const{sx:s,theme:c={}}=r||{};if(!s)return null;const d=null!=(i=c.unstable_sxConfig)?i:a.A;function l(r){let i=r;if("function"==typeof r)i=r(c);else if("object"!=typeof r)return r;if(!i)return null;const s=(0,o.EU)(c.breakpoints),a=Object.keys(s);let l=s;return Object.keys(i).forEach((r=>{const s="function"==typeof(a=i[r])?a(c):a;var a;if(null!=s)if("object"==typeof s)if(d[r])l=(0,n.A)(l,e(r,s,c,d));else{const e=(0,o.NI)({theme:c},s,(e=>({[r]:e})));!function(...e){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]),r=new Set(t);return e.every((e=>r.size===Object.keys(e).length))}(e,s)?l=(0,n.A)(l,e):l[r]=t({sx:s,theme:c})}else l=(0,n.A)(l,e(r,s,c,d))})),(0,o.vf)(a,l)}return Array.isArray(s)?s.map(l):l(s)}}();c.filterProps=["sx"];const d=c},2858:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i=r(6970),n=r(3951);const s=(0,i.A)(),o=function(e=s){return(0,n.A)(e)}},6606:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(6311),n=r(2858);function s({props:e,name:t,defaultTheme:r,themeId:s}){let o=(0,n.A)(r);s&&(o=o[s]||o);const a=function(e){const{theme:t,name:r,props:n}=e;return t&&t.components&&t.components[r]&&t.components[r].defaultProps?(0,i.A)(t.components[r].defaultProps,n):n}({theme:o,name:t,props:e});return a}},3951:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(6540),n=r(5684);const s=function(e=null){const t=i.useContext(n.T);return t&&(r=t,0!==Object.keys(r).length)?t:e;var r}},2067:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const i=e=>e,n=(()=>{let e=i;return{configure(t){e=t},generate:t=>e(t),reset(){e=i}}})()},8659:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(5697);function n(e){if("string"!=typeof e)throw new Error((0,i.A)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},6937:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const i=function(e,t=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER){return Math.max(t,Math.min(e,r))}},4111:(e,t,r)=>{"use strict";function i(e,t,r=void 0){const i={};return Object.keys(e).forEach((n=>{i[n]=e[n].reduce(((e,i)=>{if(i){const n=t(i);""!==n&&e.push(n),r&&r[i]&&e.push(r[i])}return e}),[]).join(" ")})),i}r.d(t,{A:()=>i})},4521:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,Q:()=>n});var i=r(8168);function n(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}function s(e){if(!n(e))return e;const t={};return Object.keys(e).forEach((r=>{t[r]=s(e[r])})),t}function o(e,t,r={clone:!0}){const a=r.clone?(0,i.A)({},e):e;return n(e)&&n(t)&&Object.keys(t).forEach((i=>{"__proto__"!==i&&(n(t[i])&&i in e&&n(e[i])?a[i]=o(e[i],t[i],r):r.clone?a[i]=n(t[i])?s(t[i]):t[i]:a[i]=t[i])})),a}},5697:(e,t,r)=>{"use strict";function i(e){let t="https://mui.com/production-error/?code="+e;for(let e=1;e<arguments.length;e+=1)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}r.d(t,{A:()=>i})},7245:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>s});var i=r(2067);const n={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function s(e,t,r="Mui"){const s=n[t];return s?`${r}-${s}`:`${i.A.generate(e)}-${t}`}},7553:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(7245);function n(e,t,r="Mui"){const n={};return t.forEach((t=>{n[t]=(0,i.Ay)(e,t,r)})),n}},6249:(e,t,r)=>{"use strict";function i(e){return e&&e.ownerDocument||document}r.d(t,{A:()=>i})},6311:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(8168);function n(e,t){const r=(0,i.A)({},t);return Object.keys(e).forEach((s=>{if(s.toString().match(/^(components|slots)$/))r[s]=(0,i.A)({},e[s],r[s]);else if(s.toString().match(/^(componentsProps|slotProps)$/)){const o=e[s]||{},a=t[s];r[s]={},a&&Object.keys(a)?o&&Object.keys(o)?(r[s]=(0,i.A)({},a),Object.keys(o).forEach((e=>{r[s][e]=n(o[e],a[e])}))):r[s]=a:r[s]=o}else void 0===r[s]&&(r[s]=e[s])})),r}},3721:(e,t,r)=>{"use strict";function i(e,t){"function"==typeof e?e(t):e&&(e.current=t)}r.d(t,{A:()=>i})},3833:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(6540);function n({controlled:e,default:t,name:r,state:n="value"}){const{current:s}=i.useRef(void 0!==e),[o,a]=i.useState(t);return[s?e:o,i.useCallback((e=>{s||a(e)}),[])]}},173:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(6540);const n="undefined"!=typeof window?i.useLayoutEffect:i.useEffect},6111:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(6540),n=r(173);const s=function(e){const t=i.useRef(e);return(0,n.A)((()=>{t.current=e})),i.useRef(((...e)=>(0,t.current)(...e))).current}},4871:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(6540),n=r(3721);function s(...e){return i.useMemo((()=>e.every((e=>null==e))?null:t=>{e.forEach((e=>{(0,n.A)(e,t)}))}),e)}},7749:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i=r(6540),n=r(2640);let s=!0,o=!1;const a=new n.E,c={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function d(e){e.metaKey||e.altKey||e.ctrlKey||(s=!0)}function l(){s=!1}function u(){"hidden"===this.visibilityState&&o&&(s=!0)}function p(){const e=i.useCallback((e=>{var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",d,!0),t.addEventListener("mousedown",l,!0),t.addEventListener("pointerdown",l,!0),t.addEventListener("touchstart",l,!0),t.addEventListener("visibilitychange",u,!0))}),[]),t=i.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!function(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch(e){}return s||function(e){const{type:t,tagName:r}=e;return!("INPUT"!==r||!c[t]||e.readOnly)||"TEXTAREA"===r&&!e.readOnly||!!e.isContentEditable}(t)}(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(o=!0,a.start(100,(()=>{o=!1})),t.current=!1,!0)},ref:e}}},2640:(e,t,r)=>{"use strict";r.d(t,{E:()=>o,A:()=>a});var i=r(6540);const n={},s=[];class o{constructor(){this.currentId=0,this.clear=()=>{0!==this.currentId&&(clearTimeout(this.currentId),this.currentId=0)},this.disposeEffect=()=>this.clear}static create(){return new o}start(e,t){this.clear(),this.currentId=setTimeout((()=>{this.currentId=0,t()}),e)}}function a(){const e=function(e,t){const r=i.useRef(n);return r.current===n&&(r.current=e(void 0)),r}(o.create).current;var t;return t=e.disposeEffect,i.useEffect(t,s),e}},6880:function(e){e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i=r(18),n=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,i){void 0===i&&(i=!1);var n=e.getVersionPrecision(t),s=e.getVersionPrecision(r),o=Math.max(n,s),a=0,c=e.map([t,r],(function(t){var r=o-e.getVersionPrecision(t),i=t+new Array(r+1).join(".0");return e.map(i.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(i&&(a=o-Math.min(n,s)),o-=1;o>=a;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===a)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}},e.map=function(e,t){var r,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)i.push(t(e[r]));return i},e.find=function(e,t){var r,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,i=e.length;r<i;r+=1){var n=e[r];if(t(n,r))return n}},e.assign=function(e){for(var t,r,i=e,n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var a=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))};for(t=0,r=s.length;t<r;t+=1)a();return e},e.getBrowserAlias=function(e){return i.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return i.BROWSER_MAP[e]||""},e}();t.default=n,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(91))&&i.__esModule?i:{default:i},s=r(18);function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&o(t.prototype,null),r&&o(t,r),e}();t.default=a,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i=c(r(92)),n=c(r(93)),s=c(r(94)),o=c(r(95)),a=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},i=0,n={},s=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(n[t]=o,s+=1):"object"==typeof o&&(r[t]=o,i+=1)})),i>0){var o=Object.keys(r),c=a.default.find(o,(function(e){return t.isOS(e)}));if(c){var d=this.satisfies(r[c]);if(void 0!==d)return d}var l=a.default.find(o,(function(e){return t.isPlatform(e)}));if(l){var u=this.satisfies(r[l]);if(void 0!==u)return u}}if(s>0){var p=Object.keys(n),h=a.default.find(p,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(n[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),i=e.toLowerCase(),n=a.default.getBrowserTypeByAlias(i);return t&&n&&(i=n.toLowerCase()),i===r},t.compareVersion=function(e){var t=[0],r=e,i=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(i=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(i=!0,r=e.substr(1)),t.indexOf(a.default.compareVersions(n,r,i))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=n.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=n.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(t),i={name:s.OS_MAP.MacOS,version:t};return r&&(i.versionName=r),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=n.default.getAndroidVersionName(t),i={name:s.OS_MAP.Android,version:t};return r&&(i.versionName=r),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},s=r(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})},8389:function(e,t){!function(e){"use strict";var t,r=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,i=536870912,n=1073741824,s=new WeakMap,o=function(e,t){return function(s){var o=t.get(s),a=void 0===o?s.size:o<n?o+1:0;if(!s.has(a))return e(s,a);if(s.size<i){for(;s.has(a);)a=Math.floor(Math.random()*n);return e(s,a)}if(s.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;s.has(a);)a=Math.floor(Math.random()*r);return e(s,a)}}((t=s,function(e,r){return t.set(e,r),r}),s),a=function(e){return function(t){var r=e(t);return t.add(r),r}}(o);e.addUniqueNumber=a,e.generateUniqueNumber=o}(t)},6982:(e,t,r)=>{"use strict";var i=r(4976);t.A=function(e){return o.apply(this,arguments)};var n=i(r(5230)),s=i(r(6891));function o(){return(o=(0,s.default)(n.default.mark((function e(t){var r,i;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.createElement("video"),i=new Promise((function(e,t){r.addEventListener("loadedmetadata",(function(){r.duration===1/0?(r.currentTime=Number.MAX_SAFE_INTEGER,r.ontimeupdate=function(){r.ontimeupdate=null,e(r.duration),r.currentTime=0}):e(r.duration)})),r.onerror=function(e){return t(e.target.error)}})),r.src="string"==typeof t||t instanceof String?t:window.URL.createObjectURL(t),e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},6891:e=>{function t(e,t,r,i,n,s,o){try{var a=e[s](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(i,n)}e.exports=function(e){return function(){var r=this,i=arguments;return new Promise((function(n,s){var o=e.apply(r,i);function a(e){t(o,n,s,a,c,"next",e)}function c(e){t(o,n,s,a,c,"throw",e)}a(void 0)}))}}},4976:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},5230:(e,t,r)=>{e.exports=r(479)},479:e=>{var t=function(e){"use strict";var t,r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,i){var s=t&&t.prototype instanceof v?t:v,o=Object.create(s.prototype),a=new P(i||[]);return n(o,"_invoke",{value:R(e,r,a)}),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p="suspendedStart",h="suspendedYield",m="executing",f="completed",g={};function v(){}function y(){}function _(){}var S={};d(S,o,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(D([])));T&&T!==r&&i.call(T,o)&&(S=T);var b=_.prototype=v.prototype=Object.create(S);function w(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(n,s,o,a){var c=u(e[n],e,s);if("throw"!==c.type){var d=c.arg,l=d.value;return l&&"object"==typeof l&&i.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,o,a)}),(function(e){r("throw",e,o,a)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return r("throw",e,o,a)}))}a(c.arg)}var s;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){r(e,i,t,n)}))}return s=s?s.then(n,n):n()}})}function R(e,t,r){var i=p;return function(n,s){if(i===m)throw new Error("Generator is already running");if(i===f){if("throw"===n)throw s;return M()}for(r.method=n,r.arg=s;;){var o=r.delegate;if(o){var a=C(o,r);if(a){if(a===g)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=m;var c=u(e,t,r);if("normal"===c.type){if(i=r.done?f:h,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=f,r.method="throw",r.arg=c.arg)}}}function C(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var s=u(n,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,g;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function D(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function r(){for(;++n<e.length;)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:M}}function M(){return{value:t,done:!0}}return y.prototype=_,n(b,"constructor",{value:_,configurable:!0}),n(_,"constructor",{value:y,configurable:!0}),y.displayName=d(_,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(k.prototype),d(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,i,n,s){void 0===s&&(s=Promise);var o=new k(l(t,r,i,n),s);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(b),d(b,c,"Generator"),d(b,o,(function(){return this})),d(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=D,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(i,n){return a.type="throw",a.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),d=i.call(o,"finallyLoc");if(c&&d){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;I(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:D(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},4146:(e,t,r)=>{"use strict";var i=r(3404),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function c(e){return i.isMemo(e)?o:a[e.$$typeof]||n}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[i.Memo]=o;var d=Object.defineProperty,l=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,m=Object.prototype;e.exports=function e(t,r,i){if("string"!=typeof r){if(m){var n=h(r);n&&n!==m&&e(t,n,i)}var o=l(r);u&&(o=o.concat(u(r)));for(var a=c(t),f=c(r),g=0;g<o.length;++g){var v=o[g];if(!(s[v]||i&&i[v]||f&&f[v]||a&&a[v])){var y=p(r,v);try{d(t,v,y)}catch(e){}}}}return t}},3072:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,i=r?Symbol.for("react.element"):60103,n=r?Symbol.for("react.portal"):60106,s=r?Symbol.for("react.fragment"):60107,o=r?Symbol.for("react.strict_mode"):60108,a=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,d=r?Symbol.for("react.context"):60110,l=r?Symbol.for("react.async_mode"):60111,u=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,h=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,f=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,v=r?Symbol.for("react.block"):60121,y=r?Symbol.for("react.fundamental"):60117,_=r?Symbol.for("react.responder"):60118,S=r?Symbol.for("react.scope"):60119;function E(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case l:case u:case s:case a:case o:case h:return e;default:switch(e=e&&e.$$typeof){case d:case p:case g:case f:case c:return e;default:return t}}case n:return t}}}function T(e){return E(e)===u}t.AsyncMode=l,t.ConcurrentMode=u,t.ContextConsumer=d,t.ContextProvider=c,t.Element=i,t.ForwardRef=p,t.Fragment=s,t.Lazy=g,t.Memo=f,t.Portal=n,t.Profiler=a,t.StrictMode=o,t.Suspense=h,t.isAsyncMode=function(e){return T(e)||E(e)===l},t.isConcurrentMode=T,t.isContextConsumer=function(e){return E(e)===d},t.isContextProvider=function(e){return E(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return E(e)===p},t.isFragment=function(e){return E(e)===s},t.isLazy=function(e){return E(e)===g},t.isMemo=function(e){return E(e)===f},t.isPortal=function(e){return E(e)===n},t.isProfiler=function(e){return E(e)===a},t.isStrictMode=function(e){return E(e)===o},t.isSuspense=function(e){return E(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===u||e===a||e===o||e===h||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===f||e.$$typeof===c||e.$$typeof===d||e.$$typeof===p||e.$$typeof===y||e.$$typeof===_||e.$$typeof===S||e.$$typeof===v)},t.typeOf=E},3404:(e,t,r)=>{"use strict";e.exports=r(3072)},2598:(e,t,r)=>{"use strict";r.d(t,{r:()=>c});var i,n=r(6540),s={exports:{}},o={};s.exports=function(){if(i)return o;i=1;var e=n,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,i){var n,o={},d=null,l=null;for(n in void 0!==i&&(d=""+i),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(l=r.ref),r)s.call(r,n)&&!c.hasOwnProperty(n)&&(o[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===o[n]&&(o[n]=r[n]);return{$$typeof:t,type:e,key:d,ref:l,props:o,_owner:a.current}}return o.Fragment=r,o.jsx=d,o.jsxs=d,o}();var a=s.exports;const c=({mediaRecorder:e,width:t="100%",height:r="100%",barWidth:i=2,gap:s=1,backgroundColor:o="transparent",barColor:c="rgb(160, 198, 255)",fftSize:d=1024,maxDecibels:l=-10,minDecibels:u=-90,smoothingTimeConstant:p=.4})=>{const[h]=(0,n.useState)((()=>new AudioContext)),[m,f]=(0,n.useState)(),g=(0,n.useRef)(null);(0,n.useEffect)((()=>{if(!e.stream)return;const t=h.createAnalyser();f(t),t.fftSize=d,t.minDecibels=u,t.maxDecibels=l,t.smoothingTimeConstant=p,h.createMediaStreamSource(e.stream).connect(t)}),[e.stream]),(0,n.useEffect)((()=>{m&&"recording"===e.state&&v()}),[m,e.state]);const v=(0,n.useCallback)((()=>{if(!m)return;const t=new Uint8Array(null==m?void 0:m.frequencyBinCount);"recording"===e.state?(null==m||m.getByteFrequencyData(t),y(t),requestAnimationFrame(v)):"paused"===e.state?y(t):"inactive"===e.state&&"closed"!==h.state&&h.close()}),[m,h.state]),y=e=>{if(!g.current)return;const t=((e,t,r,i)=>{let n=t/(r+i),s=Math.floor(e.length/n);n>e.length&&(n=e.length,s=1);const o=[];for(let t=0;t<n;t++){let r=0;for(let i=0;i<s&&t*s+i<e.length;i++)r+=e[t*s+i];o.push(r/s)}return o})(e,g.current.width,i,s);((e,t,r,i,n,s)=>{const o=t.height/2,a=t.getContext("2d");a&&(a.clearRect(0,0,t.width,t.height),"transparent"!==n&&(a.fillStyle=n,a.fillRect(0,0,t.width,t.height)),e.forEach(((e,t)=>{a.fillStyle=s;const n=t*(r+i),c=o-e/2,d=r,l=e||1;a.beginPath(),a.roundRect?(a.roundRect(n,c,d,l,50),a.fill()):a.fillRect(n,c,d,l)})))})(t,g.current,i,s,o,c)};return a.jsx("canvas",{ref:g,width:t,height:r,style:{aspectRatio:"unset"}})},d=(e,t,r,i,n,s,o,a=0,c=1)=>{const d=t.height/2,l=t.getContext("2d");if(!l)return;l.clearRect(0,0,t.width,t.height),"transparent"!==n&&(l.fillStyle=n,l.fillRect(0,0,t.width,t.height));const u=(a||0)/c;e.forEach(((t,n)=>{const a=n/e.length,c=u>a;l.fillStyle=c&&o?o:s;const p=n*(r+i),h=d+t.min,m=r,f=d+t.max-h;l.beginPath(),l.roundRect?(l.roundRect(p,h,m,f,50),l.fill()):l.fillRect(p,h,m,f)}))};(0,n.forwardRef)((({blob:e,width:t,height:r,barWidth:i=2,gap:s=1,currentTime:o,style:c,backgroundColor:l="transparent",barColor:u="rgb(184, 184, 184)",barPlayedColor:p="rgb(160, 198, 255)"},h)=>{const m=(0,n.useRef)(null),[f,g]=(0,n.useState)([]),[v,y]=(0,n.useState)(0);return(0,n.useImperativeHandle)(h,(()=>m.current),[]),(0,n.useEffect)((()=>{(async()=>{if(!m.current)return;if(!e){const e=Array.from({length:100},(()=>({max:0,min:0})));return void d(e,m.current,i,s,l,u,p)}const n=await e.arrayBuffer();await(new AudioContext).decodeAudioData(n,(e=>{if(!m.current)return;y(e.duration);const n=((e,t,r,i,n)=>{const s=e.getChannelData(0),o=r/(i+n),a=Math.floor(s.length/o),c=t/2;let d=[],l=0;for(let t=0;t<o;t++){const r=[];let i=0;const n=[];let o=0;for(let c=0;c<a&&t*a+c<e.length;c++){const e=s[t*a+c];e<=0&&(r.push(e),i++),e>0&&(n.push(e),o++)}const c=r.reduce(((e,t)=>e+t),0)/i,u={max:n.reduce(((e,t)=>e+t),0)/o,min:c};u.max>l&&(l=u.max),Math.abs(u.min)>l&&(l=Math.abs(u.min)),d.push(u)}if(.8*c>l*c){const e=.8*c/l;d=d.map((t=>({max:t.max*e,min:t.min*e})))}return d})(e,r,t,i,s);g(n),d(n,m.current,i,s,l,u,p)}))})()}),[e,m.current]),(0,n.useEffect)((()=>{m.current&&d(f,m.current,i,s,l,u,p,o,v)}),[o,v]),a.jsx("canvas",{ref:m,width:t,height:r,style:{...c}})})).displayName="AudioVisualizer"},1020:(e,t,r)=>{"use strict";var i=r(6540),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var i,s={},d=null,l=null;for(i in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,i)&&!c.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:n,type:e,key:d,ref:l,props:s,_owner:a.current}}t.Fragment=s,t.jsx=d,t.jsxs=d},4848:(e,t,r)=>{"use strict";e.exports=r(1020)},5602:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},7363:(e,t,r)=>{var i=r(5020),n=r(3804);t.M9=n,t.qg=i.parse,t.Sl=i.parseParams,i.parseFmtpConfig,i.parsePayloads,i.parseRemoteCandidates,i.parseImageAttributes,t.hy=i.parseSimulcastStreamList},5020:(e,t,r)=>{var i=function(e){return String(Number(e))===e?Number(e):e},n=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=i(e[1]);else for(var s=0;s<r.length;s+=1)null!=e[s+1]&&(t[r[s]]=i(e[s+1]))}(r.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=r(5602),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),i=r[r.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var c=s[t][a];if(c.reg.test(o))return n(c,i,o)}})),t.media=r,t};var a=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=i(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(i),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},3804:(e,t,r)=>{var i=r(5602),n=/%[sdv%]/g,s=function(e){var t=1,r=arguments,i=r.length;return e.replace(n,(function(e){if(t>=i)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}}))},o=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var o=t.names[n];t.name?i.push(r[t.name][o]):i.push(r[t.names[n]])}else i.push(r[t.name]);return s.apply(null,i)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||a,n=t.innerOrder||c,s=[];return r.forEach((function(t){i[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(o(t,r,e))}))}))})),e.media.forEach((function(e){s.push(o("m",i.m[0],e)),n.forEach((function(t){i[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(o(t,r,e))}))}))}))})),s.join("\r\n")+"\r\n"}},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},8168:(e,t,r)=>{"use strict";function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},i.apply(this,arguments)}r.d(t,{A:()=>i})},8587:(e,t,r)=>{"use strict";function i(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}r.d(t,{A:()=>i})},4164:(e,t,r)=>{"use strict";function i(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=i(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}r.d(t,{A:()=>n});const n=function(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=i(e))&&(n&&(n+=" "),n+=t);return n}},8971:(e,t,r)=>{"use strict";r.d(t,{C:()=>a});var i=r(6540);(e=>{try{if(typeof window>"u")return;var t=document.createElement("style");t.appendChild(document.createTextNode(".audio-recorder{background-color:#ebebeb;box-shadow:0 2px 5px #bebebe;border-radius:20px;box-sizing:border-box;color:#000;width:40px;display:flex;align-items:center;transition:all .2s ease-in;-webkit-tap-highlight-color:transparent}.audio-recorder-mic{box-sizing:content-box;cursor:pointer;height:16px;color:#000;padding:12px}.audio-recorder .audio-recorder-mic{border-radius:20px}.audio-recorder.recording .audio-recorder-mic{border-radius:0}.audio-recorder-timer,.audio-recorder-status{color:#000;margin-left:10px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;font-size:14px;font-weight:400;line-height:1}.audio-recorder-status{margin-left:15px;display:flex;align-items:baseline;flex-grow:1;animation-name:fading-ar-status;animation-duration:2s;animation-iteration-count:infinite}.audio-recorder-status-dot{background-color:#d00;border-radius:50%;height:10px;width:9px;margin-right:5px}.audio-recorder-options{box-sizing:content-box;height:16px;cursor:pointer;padding:12px 6px 12px 12px}.audio-recorder-options~.audio-recorder-options{padding:12px 12px 12px 6px;border-radius:0 5px 5px 0}.recording{border-radius:12px;width:300px;transition:all .2s ease-out}.display-none{display:none}.audio-recorder-visualizer{margin-left:15px;flex-grow:1;align-self:center;display:flex;align-items:center}@keyframes fading-ar-status{0%{opacity:1}50%{opacity:0}to{opacity:1}}")),document.head.appendChild(t)}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var n,s={exports:{}},o={};s.exports=function(){if(n)return o;n=1;var e=i,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,i){var n,o={},d=null,l=null;for(n in void 0!==i&&(d=""+i),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(l=r.ref),r)s.call(r,n)&&!c.hasOwnProperty(n)&&(o[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===o[n]&&(o[n]=r[n]);return{$$typeof:t,type:e,key:d,ref:l,props:o,_owner:a.current}}return o.Fragment=r,o.jsx=d,o.jsxs=d,o}(),s.exports;const a=(e,t,r)=>{const[n,s]=(0,i.useState)(!1),[o,a]=(0,i.useState)(!1),[c,d]=(0,i.useState)(0),[l,u]=(0,i.useState)(),[p,h]=(0,i.useState)(),[m,f]=(0,i.useState)(),g=(0,i.useCallback)((()=>{const e=setInterval((()=>{d((e=>e+1))}),1e3);h(e)}),[d,h]),v=(0,i.useCallback)((()=>{null!=p&&clearInterval(p),h(void 0)}),[p,h]);return{startRecording:(0,i.useCallback)((()=>{null==p&&navigator.mediaDevices.getUserMedia({audio:e??!0}).then((e=>{s(!0);const t=new MediaRecorder(e,r);u(t),t.start(),g(),t.addEventListener("dataavailable",(e=>{f(e.data),t.stream.getTracks().forEach((e=>e.stop())),u(void 0)}))})).catch((e=>{console.log(e.name,e.message,e.cause),null==t||t(e)}))}),[p,s,u,g,f,t,r]),stopRecording:(0,i.useCallback)((()=>{null==l||l.stop(),v(),d(0),s(!1),a(!1)}),[l,d,s,a,v]),togglePauseResume:(0,i.useCallback)((()=>{o?(a(!1),null==l||l.resume(),g()):(a(!0),v(),null==l||l.pause())}),[l,a,g,v]),recordingBlob:m,isRecording:n,isPaused:o,recordingTime:c,mediaRecorder:l}};i.lazy((async()=>{const{LiveAudioVisualizer:e}=await r.e(198).then(r.bind(r,198));return{default:e}}))}}]);