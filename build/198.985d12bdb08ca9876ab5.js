"use strict";(self.webpackChunkpb_connect=self.webpackChunkpb_connect||[]).push([[198],{198:(e,t,r)=>{r.d(t,{LiveAudioVisualizer:()=>c});var n,a=r(6540),o={exports:{}},i={};o.exports=function(){if(n)return i;n=1;var e=a,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,r,n){var a,i={},l=null,u=null;for(a in void 0!==n&&(l=""+n),void 0!==r.key&&(l=""+r.key),void 0!==r.ref&&(u=r.ref),r)o.call(r,a)&&!c.hasOwnProperty(a)&&(i[a]=r[a]);if(e&&e.defaultProps)for(a in r=e.defaultProps)void 0===i[a]&&(i[a]=r[a]);return{$$typeof:t,type:e,key:l,ref:u,props:i,_owner:s.current}}return i.Fragment=r,i.jsx=l,i.jsxs=l,i}();var s=o.exports;const c=({mediaRecorder:e,width:t="100%",height:r="100%",barWidth:n=2,gap:o=1,backgroundColor:i="transparent",barColor:c="rgb(160, 198, 255)",fftSize:l=1024,maxDecibels:u=-10,minDecibels:f=-90,smoothingTimeConstant:h=.4})=>{const[d]=(0,a.useState)((()=>new AudioContext)),[m,g]=(0,a.useState)(),p=(0,a.useRef)(null);(0,a.useEffect)((()=>{if(!e.stream)return;const t=d.createAnalyser();g(t),t.fftSize=l,t.minDecibels=f,t.maxDecibels=u,t.smoothingTimeConstant=h,d.createMediaStreamSource(e.stream).connect(t)}),[e.stream]),(0,a.useEffect)((()=>{m&&"recording"===e.state&&b()}),[m,e.state]);const b=(0,a.useCallback)((()=>{if(!m)return;const t=new Uint8Array(null==m?void 0:m.frequencyBinCount);"recording"===e.state?(null==m||m.getByteFrequencyData(t),y(t),requestAnimationFrame(b)):"paused"===e.state?y(t):"inactive"===e.state&&"closed"!==d.state&&d.close()}),[m,d.state]),y=e=>{if(!p.current)return;const t=((e,t,r,n)=>{let a=t/(r+n),o=Math.floor(e.length/a);a>e.length&&(a=e.length,o=1);const i=[];for(let t=0;t<a;t++){let r=0;for(let n=0;n<o&&t*o+n<e.length;n++)r+=e[t*o+n];i.push(r/o)}return i})(e,p.current.width,n,o);((e,t,r,n,a,o)=>{const i=t.height/2,s=t.getContext("2d");s&&(s.clearRect(0,0,t.width,t.height),"transparent"!==a&&(s.fillStyle=a,s.fillRect(0,0,t.width,t.height)),e.forEach(((e,t)=>{s.fillStyle=o;const a=t*(r+n),c=i-e/2,l=r,u=e||1;s.beginPath(),s.roundRect?(s.roundRect(a,c,l,u,50),s.fill()):s.fillRect(a,c,l,u)})))})(t,p.current,n,o,i,c)};return s.jsx("canvas",{ref:p,width:t,height:r,style:{aspectRatio:"unset"}})},l=(e,t,r,n,a,o,i,s=0,c=1)=>{const l=t.height/2,u=t.getContext("2d");if(!u)return;u.clearRect(0,0,t.width,t.height),"transparent"!==a&&(u.fillStyle=a,u.fillRect(0,0,t.width,t.height));const f=(s||0)/c;e.forEach(((t,a)=>{const s=a/e.length,c=f>s;u.fillStyle=c&&i?i:o;const h=a*(r+n),d=l+t.min,m=r,g=l+t.max-d;u.beginPath(),u.roundRect?(u.roundRect(h,d,m,g,50),u.fill()):u.fillRect(h,d,m,g)}))};(0,a.forwardRef)((({blob:e,width:t,height:r,barWidth:n=2,gap:o=1,currentTime:i,style:c,backgroundColor:u="transparent",barColor:f="rgb(184, 184, 184)",barPlayedColor:h="rgb(160, 198, 255)"},d)=>{const m=(0,a.useRef)(null),[g,p]=(0,a.useState)([]),[b,y]=(0,a.useState)(0);return(0,a.useImperativeHandle)(d,(()=>m.current),[]),(0,a.useEffect)((()=>{(async()=>{if(!m.current)return;if(!e){const e=Array.from({length:100},(()=>({max:0,min:0})));return void l(e,m.current,n,o,u,f,h)}const a=await e.arrayBuffer();await(new AudioContext).decodeAudioData(a,(e=>{if(!m.current)return;y(e.duration);const a=((e,t,r,n,a)=>{const o=e.getChannelData(0),i=r/(n+a),s=Math.floor(o.length/i),c=t/2;let l=[],u=0;for(let t=0;t<i;t++){const r=[];let n=0;const a=[];let i=0;for(let c=0;c<s&&t*s+c<e.length;c++){const e=o[t*s+c];e<=0&&(r.push(e),n++),e>0&&(a.push(e),i++)}const c=r.reduce(((e,t)=>e+t),0)/n,f={max:a.reduce(((e,t)=>e+t),0)/i,min:c};f.max>u&&(u=f.max),Math.abs(f.min)>u&&(u=Math.abs(f.min)),l.push(f)}if(.8*c>u*c){const e=.8*c/u;l=l.map((t=>({max:t.max*e,min:t.min*e})))}return l})(e,r,t,n,o);p(a),l(a,m.current,n,o,u,f,h)}))})()}),[e,m.current]),(0,a.useEffect)((()=>{m.current&&l(g,m.current,n,o,u,f,h,i,b)}),[i,b]),s.jsx("canvas",{ref:m,width:t,height:r,style:{...c}})})).displayName="AudioVisualizer"}}]);