/*! For license information please see 528.fa661633105a782e26fd.js.LICENSE.txt */
(self.webpackChunkpb_connect=self.webpackChunkpb_connect||[]).push([[528],{1589:(e,t,r)=>{"use strict";r.d(t,{fG:()=>T,wl:()=>_,xg:()=>S,zf:()=>E});var n=r(6540),i=r(3085),s=Object.defineProperty,o=(e,t,r)=>(((e,t,r)=>{t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r),a={exports:{}},c={};Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,!function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()||Object.assign;var d=n,l=60103;if(c.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var u=Symbol.for;l=u("react.element"),c.Fragment=u("react.fragment")}var h=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p=Object.prototype.hasOwnProperty,m={key:!0,ref:!0,__self:!0,__source:!0};function f(e,t,r){var n,i={},s=null,o=null;for(n in void 0!==r&&(s=""+r),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(o=t.ref),t)p.call(t,n)&&!m.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:l,type:e,key:s,ref:o,props:i,_owner:h.current}}c.jsx=f,c.jsxs=f,a.exports=c;const g=a.exports.jsx;class v{constructor(e){var t,r,n,i,s,a,c,d,l,u,h,p,m,f,g,v,y,_;o(this,"meeting"),o(this,"l"),o(this,"onUpdate",(()=>{this.l.forEach((e=>{e()}))})),this.meeting=e,this.l=new Set,null==(t=this.meeting.self)||t.addListener("*",this.onUpdate),null==(r=this.meeting.meta)||r.addListener("*",this.onUpdate),null==(n=this.meeting.participants)||n.addListener("*",this.onUpdate),null==(s=null==(i=this.meeting.participants)?void 0:i.joined)||s.addListener("*",this.onUpdate),null==(c=null==(a=this.meeting.participants)?void 0:a.active)||c.addListener("*",this.onUpdate),null==(l=null==(d=this.meeting.participants)?void 0:d.waitlisted)||l.addListener("*",this.onUpdate),null==(u=this.meeting.stage)||u.addListener("*",this.onUpdate),null==(h=this.meeting.livestream)||h.addListener("*",this.onUpdate),null==(p=this.meeting.chat)||p.addListener("*",this.onUpdate),null==(m=this.meeting.plugins)||m.all.addListener("*",this.onUpdate),null==(f=this.meeting.recording)||f.addListener("*",this.onUpdate),null==(g=this.meeting.connectedMeetings)||g.addListener("*",this.onUpdate),null==(v=this.meeting.spotlight)||v.addListener("*",this.onUpdate),null==(y=this.meeting.remote)||y.addListener("*",this.onUpdate),null==(_=this.meeting.polls)||_.addListener("*",this.onUpdate)}clean(){var e,t,r,n,i,s,o,a,c,d,l,u,h,p,m,f,g,v;null==(e=this.meeting.self)||e.removeListener("*",this.onUpdate),null==(t=this.meeting.meta)||t.removeListener("*",this.onUpdate),null==(r=this.meeting.participants)||r.removeListener("*",this.onUpdate),null==(i=null==(n=this.meeting.participants)?void 0:n.joined)||i.removeListener("*",this.onUpdate),null==(o=null==(s=this.meeting.participants)?void 0:s.active)||o.removeListener("*",this.onUpdate),null==(c=null==(a=this.meeting.participants)?void 0:a.waitlisted)||c.removeListener("*",this.onUpdate),null==(d=this.meeting.stage)||d.removeListener("*",this.onUpdate),null==(l=this.meeting.livestream)||l.removeListener("*",this.onUpdate),null==(u=this.meeting.chat)||u.removeListener("*",this.onUpdate),null==(h=this.meeting.plugins)||h.all.removeListener("*",this.onUpdate),null==(p=this.meeting.recording)||p.removeListener("*",this.onUpdate),null==(m=this.meeting.connectedMeetings)||m.removeListener("*",this.onUpdate),null==(f=this.meeting.spotlight)||f.removeListener("*",this.onUpdate),null==(g=this.meeting.remote)||g.removeListener("*",this.onUpdate),null==(v=this.meeting.polls)||v.removeListener("*",this.onUpdate)}addListener(e){this.l.add(e)}removeListener(e){this.l.delete(e)}}const y=(0,n.createContext)({meeting:void 0,updates:void 0});function _({value:e,children:t,fallback:r}){const[i,s]=(0,n.useState)(),o=(0,n.useRef)();return(0,n.useEffect)((()=>(e&&s(new v(e)),()=>{var e;null==(e=o.current)||e.clean()})),[e]),g(y.Provider,{value:{meeting:e,updates:i},children:e?t:r})}const S=()=>{const{meeting:e}=(0,n.useContext)(y);if(!e)throw new Error("useDyteMeeting must be used within the DyteProvider");return{meeting:e}},T=e=>{const t=(0,n.useRef)(!1),[r,s]=(0,n.useState)(),o=null==e?void 0:e.resetOnLeave;return[r,async e=>{if(!t.current)return t.current=!0,i.A.init(e).then((e=>(s(e),o&&e.self.on("roomLeft",(()=>s(void 0))),e.connectedMeetings.on("meetingChanged",(e=>{s(e)})),e))).finally((()=>{t.current=!1}))}]},E=e=>{const{meeting:t,updates:r}=(0,n.useContext)(y);if(!t)throw new Error("useDyteSelector must be used within the DyteProvider");const i=(0,n.useRef)(e(t)),[,s]=(0,n.useReducer)((e=>e+1),0);return(0,n.useEffect)((()=>{const n=t&&e(t),o=()=>{const r=t&&e(t);var n,o;((n=i.current)!==(o=r)||Array.isArray(n)&&Array.isArray(o)&&n.length!==o.length)&&(i.current=r,s())};return n&&"object"==typeof n&&"addListener"in n?(n.addListener("*",s),()=>{n.removeListener("*",s)}):(null==r||r.addListener(o),()=>{null==r||r.removeListener(o)})}),[t,r]),i.current}},3085:(e,t,r)=>{"use strict";r.d(t,{A:()=>OL});var n={};r.r(n),r.d(n,{Decoder:()=>Et,Encoder:()=>St,PacketType:()=>_t,protocol:()=>yt});const i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&i.test(e)};var o,a=new Uint8Array(16);function c(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(a)}for(var d=[],l=0;l<256;++l)d.push((l+256).toString(16).substr(1));const u=function(e,t,r){var n=(e=e||{}).random||(e.rng||c)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!s(r))throw TypeError("Stringified UUID is invalid");return r}(n)};var h=r(1726),p=r.n(h),m=r(6880),f=r.n(m),g=r(7363);const v=Symbol.for("protobuf-ts/message-type");function y(e){let t=!1;const r=[];for(let n=0;n<e.length;n++){let i=e.charAt(n);"_"==i?t=!0:/\d/.test(i)?(r.push(i),t=!0):t?(r.push(i.toUpperCase()),t=!1):0==n?r.push(i.toLowerCase()):r.push(i)}return r.join("")}var _,S,T;function E(e){var t,r,n,i;return e.localName=null!==(t=e.localName)&&void 0!==t?t:y(e.name),e.jsonName=null!==(r=e.jsonName)&&void 0!==r?r:y(e.name),e.repeat=null!==(n=e.repeat)&&void 0!==n?n:T.NO,e.opt=null!==(i=e.opt)&&void 0!==i?i:!e.repeat&&!e.oneof&&"message"==e.kind,e}function b(e){if("object"!=typeof e||null===e||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return void 0!==e[e.oneofKind]&&2==Object.keys(e).length;case"undefined":return 1==Object.keys(e).length;default:return!1}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(_||(_={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(S||(S={})),function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"}(T||(T={}));class w{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}prepare(){if(this.data)return;const e=[],t=[],r=[];for(let n of this.fields)if(n.oneof)r.includes(n.oneof)||(r.push(n.oneof),e.push(n.oneof),t.push(n.oneof));else switch(t.push(n.localName),n.kind){case"scalar":case"enum":n.opt&&!n.repeat||e.push(n.localName);break;case"message":n.repeat&&e.push(n.localName);break;case"map":e.push(n.localName)}this.data={req:e,known:t,oneofs:Object.values(r)}}is(e,t,r=!1){if(t<0)return!0;if(null==e||"object"!=typeof e)return!1;this.prepare();let n=Object.keys(e),i=this.data;if(n.length<i.req.length||i.req.some((e=>!n.includes(e))))return!1;if(!r&&n.some((e=>!i.known.includes(e))))return!1;if(t<1)return!0;for(const n of i.oneofs){const i=e[n];if(!b(i))return!1;if(void 0===i.oneofKind)continue;const s=this.fields.find((e=>e.localName===i.oneofKind));if(!s)return!1;if(!this.field(i[i.oneofKind],s,r,t))return!1}for(const n of this.fields)if(void 0===n.oneof&&!this.field(e[n.localName],n,r,t))return!1;return!0}field(e,t,r,n){let i=t.repeat;switch(t.kind){case"scalar":return void 0===e?t.opt:i?this.scalars(e,t.T,n,t.L):this.scalar(e,t.T,t.L);case"enum":return void 0===e?t.opt:i?this.scalars(e,_.INT32,n):this.scalar(e,_.INT32);case"message":return void 0===e||(i?this.messages(e,t.T(),r,n):this.message(e,t.T(),r,n));case"map":if("object"!=typeof e||null===e)return!1;if(n<2)return!0;if(!this.mapKeys(e,t.K,n))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,n,t.V.L);case"enum":return this.scalars(Object.values(e),_.INT32,n);case"message":return this.messages(Object.values(e),t.V.T(),r,n)}}return!0}message(e,t,r,n){return r?t.isAssignable(e,n):t.is(e,n)}messages(e,t,r,n){if(!Array.isArray(e))return!1;if(n<2)return!0;if(r){for(let r=0;r<e.length&&r<n;r++)if(!t.isAssignable(e[r],n-1))return!1}else for(let r=0;r<e.length&&r<n;r++)if(!t.is(e[r],n-1))return!1;return!0}scalar(e,t,r){let n=typeof e;switch(t){case _.UINT64:case _.FIXED64:case _.INT64:case _.SFIXED64:case _.SINT64:switch(r){case S.BIGINT:return"bigint"==n;case S.NUMBER:return"number"==n&&!isNaN(e);default:return"string"==n}case _.BOOL:return"boolean"==n;case _.STRING:return"string"==n;case _.BYTES:return e instanceof Uint8Array;case _.DOUBLE:case _.FLOAT:return"number"==n&&!isNaN(e);default:return"number"==n&&Number.isInteger(e)}}scalars(e,t,r,n){if(!Array.isArray(e))return!1;if(r<2)return!0;if(Array.isArray(e))for(let i=0;i<e.length&&i<r;i++)if(!this.scalar(e[i],t,n))return!1;return!0}mapKeys(e,t,r){let n=Object.keys(e);switch(t){case _.INT32:case _.FIXED32:case _.SFIXED32:case _.SINT32:case _.UINT32:return this.scalars(n.slice(0,r).map((e=>parseInt(e))),t,r);case _.BOOL:return this.scalars(n.slice(0,r).map((e=>"true"==e||"false"!=e&&e)),t,r);default:return this.scalars(n,t,r,S.STRING)}}}function k(e){let t=typeof e;if("object"==t){if(Array.isArray(e))return"array";if(null===e)return"null"}return t}function R(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}let C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),I=[];for(let e=0;e<C.length;e++)I[C[e].charCodeAt(0)]=e;function A(){let e=0,t=0;for(let r=0;r<28;r+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<r,0==(128&n))return this.assertBounds(),[e,t]}let r=this.buf[this.pos++];if(e|=(15&r)<<28,t=(112&r)>>4,0==(128&r))return this.assertBounds(),[e,t];for(let r=3;r<=31;r+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<r,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function P(e,t,r){for(let n=0;n<28;n+=7){const i=e>>>n,s=!(i>>>7==0&&0==t),o=255&(s?128|i:i);if(r.push(o),!s)return}const n=e>>>28&15|(7&t)<<4,i=!(t>>3==0);if(r.push(255&(i?128|n:n)),i){for(let e=3;e<31;e+=7){const n=t>>>e,i=!(n>>>7==0),s=255&(i?128|n:n);if(r.push(s),!i)return}r.push(t>>>31&1)}}I["-".charCodeAt(0)]=C.indexOf("+"),I["_".charCodeAt(0)]=C.indexOf("/");const D=4294967296;function O(e){let t="-"==e[0];t&&(e=e.slice(1));const r=1e6;let n=0,i=0;function s(t,s){const o=Number(e.slice(t,s));i*=r,n=n*r+o,n>=D&&(i+=n/D|0,n%=D)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),[t,n,i]}function M(e,t){if(t>>>0<=2097151)return""+(D*t+(e>>>0));let r=(e>>>24|t<<8)>>>0&16777215,n=t>>16&65535,i=(16777215&e)+6777216*r+6710656*n,s=r+8147497*n,o=2*n,a=1e7;function c(e,t){let r=e?String(e):"";return t?"0000000".slice(r.length)+r:r}return i>=a&&(s+=Math.floor(i/a),i%=a),s>=a&&(o+=Math.floor(s/a),s%=a),c(o,0)+c(s,o)+c(i,1)}function N(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let r=0;r<9;r++)t.push(127&e|128),e>>=7;t.push(1)}}function x(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;0!=(128&e)&&t<10;t++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}let L;function U(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}!function(){const e=new DataView(new ArrayBuffer(8)),t=void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64;L=t?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}();const j=/^-?[0-9]+$/,F=4294967296,V=2147483648;class B{constructor(e,t){this.lo=0|e,this.hi=0|t}isZero(){return 0==this.lo&&0==this.hi}toNumber(){let e=this.hi*F+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class H extends B{static from(e){if(L)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=L.C(e);case"number":if(0===e)return this.ZERO;e=L.C(e);case"bigint":if(!e)return this.ZERO;if(e<L.UMIN)throw new Error("signed value for ulong");if(e>L.UMAX)throw new Error("ulong too large");return L.V.setBigUint64(0,e,!0),new H(L.V.getInt32(0,!0),L.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!j.test(e))throw new Error("string is no integer");let[t,r,n]=O(e);if(t)throw new Error("signed value for ulong");return new H(r,n);case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new H(e,e/F)}throw new Error("unknown value "+typeof e)}toString(){return L?this.toBigInt().toString():M(this.lo,this.hi)}toBigInt(){return U(L),L.V.setInt32(0,this.lo,!0),L.V.setInt32(4,this.hi,!0),L.V.getBigUint64(0,!0)}}H.ZERO=new H(0,0);class W extends B{static from(e){if(L)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=L.C(e);case"number":if(0===e)return this.ZERO;e=L.C(e);case"bigint":if(!e)return this.ZERO;if(e<L.MIN)throw new Error("signed long too small");if(e>L.MAX)throw new Error("signed long too large");return L.V.setBigInt64(0,e,!0),new W(L.V.getInt32(0,!0),L.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!j.test(e))throw new Error("string is no integer");let[t,r,n]=O(e);if(t){if(n>V||n==V&&0!=r)throw new Error("signed long too small")}else if(n>=V)throw new Error("signed long too large");let i=new W(r,n);return t?i.negate():i;case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new W(e,e/F):new W(-e,-e/F).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return 0!=(this.hi&V)}negate(){let e=~this.hi,t=this.lo;return t?t=1+~t:e+=1,new W(t,e)}toString(){if(L)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+M(e.lo,e.hi)}return M(this.lo,this.hi)}toBigInt(){return U(L),L.V.setInt32(0,this.lo,!0),L.V.setInt32(4,this.hi,!0),L.V.getBigInt64(0,!0)}}function G(e,t){if(!e)throw new Error(t)}function q(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function $(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function z(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}function J(e,t){switch(t){case S.BIGINT:return e.toBigInt();case S.NUMBER:return e.toNumber();default:return e.toString()}}W.ZERO=new W(0,0);class K{constructor(e){this.info=e}prepare(){var e;if(void 0===this.fMap){this.fMap={};const t=null!==(e=this.info.fields)&&void 0!==e?e:[];for(const e of t)this.fMap[e.name]=e,this.fMap[e.jsonName]=e,this.fMap[e.localName]=e}}assert(e,t,r){if(!e){let e=k(r);throw"number"!=e&&"boolean"!=e||(e=r.toString()),new Error(`Cannot parse JSON ${e} for ${this.info.typeName}#${t}`)}}read(e,t,r){this.prepare();const n=[];for(const[i,s]of Object.entries(e)){const e=this.fMap[i];if(!e){if(!r.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${i}`);continue}const o=e.localName;let a;if(e.oneof){if(null===s&&("enum"!==e.kind||"google.protobuf.NullValue"!==e.T()[0]))continue;if(n.includes(e.oneof))throw new Error(`Multiple members of the oneof group "${e.oneof}" of ${this.info.typeName} are present in JSON.`);n.push(e.oneof),a=t[e.oneof]={oneofKind:o}}else a=t;if("map"==e.kind){if(null===s)continue;this.assert(R(s),e.name,s);const t=a[o];for(const[n,i]of Object.entries(s)){let s;switch(this.assert(null!==i,e.name+" map value",null),e.V.kind){case"message":s=e.V.T().internalJsonRead(i,r);break;case"enum":if(s=this.enum(e.V.T(),i,e.name,r.ignoreUnknownFields),!1===s)continue;break;case"scalar":s=this.scalar(i,e.V.T,e.V.L,e.name)}this.assert(void 0!==s,e.name+" map value",i);let o=n;e.K==_.BOOL&&(o="true"==o||"false"!=o&&o),o=this.scalar(o,e.K,S.STRING,e.name).toString(),t[o]=s}}else if(e.repeat){if(null===s)continue;this.assert(Array.isArray(s),e.name,s);const t=a[o];for(const n of s){let i;switch(this.assert(null!==n,e.name,null),e.kind){case"message":i=e.T().internalJsonRead(n,r);break;case"enum":if(i=this.enum(e.T(),n,e.name,r.ignoreUnknownFields),!1===i)continue;break;case"scalar":i=this.scalar(n,e.T,e.L,e.name)}this.assert(void 0!==i,e.name,s),t.push(i)}}else switch(e.kind){case"message":if(null===s&&"google.protobuf.Value"!=e.T().typeName){this.assert(void 0===e.oneof,e.name+" (oneof member)",null);continue}a[o]=e.T().internalJsonRead(s,r,a[o]);break;case"enum":let t=this.enum(e.T(),s,e.name,r.ignoreUnknownFields);if(!1===t)continue;a[o]=t;break;case"scalar":a[o]=this.scalar(s,e.T,e.L,e.name)}}}enum(e,t,r,n){if("google.protobuf.NullValue"==e[0]&&G(null===t||"NULL_VALUE"===t,`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} only accepts null.`),null===t)return 0;switch(typeof t){case"number":return G(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${r}, enum can only be integral number, got ${t}.`),t;case"string":let i=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(i=t.substring(e[2].length));let s=e[1][i];return(void 0!==s||!n)&&(G("number"==typeof s,`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} has no value for "${t}".`),s)}G(!1,`Unable to parse field ${this.info.typeName}#${r}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,r,n){let i;try{switch(t){case _.DOUBLE:case _.FLOAT:if(null===e)return 0;if("NaN"===e)return Number.NaN;if("Infinity"===e)return Number.POSITIVE_INFINITY;if("-Infinity"===e)return Number.NEGATIVE_INFINITY;if(""===e){i="empty string";break}if("string"==typeof e&&e.trim().length!==e.length){i="extra whitespace";break}if("string"!=typeof e&&"number"!=typeof e)break;let n=Number(e);if(Number.isNaN(n)){i="not a number";break}if(!Number.isFinite(n)){i="too large or small";break}return t==_.FLOAT&&z(n),n;case _.INT32:case _.FIXED32:case _.SFIXED32:case _.SINT32:case _.UINT32:if(null===e)return 0;let s;if("number"==typeof e?s=e:""===e?i="empty string":"string"==typeof e&&(e.trim().length!==e.length?i="extra whitespace":s=Number(e)),void 0===s)break;return t==_.UINT32?$(s):q(s),s;case _.INT64:case _.SFIXED64:case _.SINT64:if(null===e)return J(W.ZERO,r);if("number"!=typeof e&&"string"!=typeof e)break;return J(W.from(e),r);case _.FIXED64:case _.UINT64:if(null===e)return J(H.ZERO,r);if("number"!=typeof e&&"string"!=typeof e)break;return J(H.from(e),r);case _.BOOL:if(null===e)return!1;if("boolean"!=typeof e)break;return e;case _.STRING:if(null===e)return"";if("string"!=typeof e){i="extra whitespace";break}try{encodeURIComponent(e)}catch(i){i="invalid UTF8";break}return e;case _.BYTES:if(null===e||""===e)return new Uint8Array(0);if("string"!=typeof e)break;return function(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let r,n=new Uint8Array(t),i=0,s=0,o=0;for(let t=0;t<e.length;t++){if(r=I[e.charCodeAt(t)],void 0===r)switch(e[t]){case"=":s=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=r,s=1;break;case 1:n[i++]=o<<2|(48&r)>>4,o=r,s=2;break;case 2:n[i++]=(15&o)<<4|(60&r)>>2,o=r,s=3;break;case 3:n[i++]=(3&o)<<6|r,s=0}}if(1==s)throw Error("invalid base64 string.");return n.subarray(0,i)}(e)}}catch(e){i=e.message}this.assert(!1,n+(i?" - "+i:""),e)}}class Q{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}write(e,t){const r={},n=e;for(const e of this.fields){if(!e.oneof){let i=this.field(e,n[e.localName],t);void 0!==i&&(r[t.useProtoFieldName?e.name:e.jsonName]=i);continue}const i=n[e.oneof];if(i.oneofKind!==e.localName)continue;const s="scalar"==e.kind||"enum"==e.kind?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let o=this.field(e,i[e.localName],s);G(void 0!==o),r[t.useProtoFieldName?e.name:e.jsonName]=o}return r}field(e,t,r){let n;if("map"==e.kind){G("object"==typeof t&&null!==t);const i={};switch(e.V.kind){case"scalar":for(const[r,n]of Object.entries(t)){const t=this.scalar(e.V.T,n,e.name,!1,!0);G(void 0!==t),i[r.toString()]=t}break;case"message":const n=e.V.T();for(const[s,o]of Object.entries(t)){const t=this.message(n,o,e.name,r);G(void 0!==t),i[s.toString()]=t}break;case"enum":const s=e.V.T();for(const[n,o]of Object.entries(t)){G(void 0===o||"number"==typeof o);const t=this.enum(s,o,e.name,!1,!0,r.enumAsInteger);G(void 0!==t),i[n.toString()]=t}}(r.emitDefaultValues||Object.keys(i).length>0)&&(n=i)}else if(e.repeat){G(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let r=0;r<t.length;r++){const n=this.scalar(e.T,t[r],e.name,e.opt,!0);G(void 0!==n),i.push(n)}break;case"enum":const n=e.T();for(let s=0;s<t.length;s++){G(void 0===t[s]||"number"==typeof t[s]);const o=this.enum(n,t[s],e.name,e.opt,!0,r.enumAsInteger);G(void 0!==o),i.push(o)}break;case"message":const s=e.T();for(let n=0;n<t.length;n++){const o=this.message(s,t[n],e.name,r);G(void 0!==o),i.push(o)}}(r.emitDefaultValues||i.length>0||r.emitDefaultValues)&&(n=i)}else switch(e.kind){case"scalar":n=this.scalar(e.T,t,e.name,e.opt,r.emitDefaultValues);break;case"enum":n=this.enum(e.T(),t,e.name,e.opt,r.emitDefaultValues,r.enumAsInteger);break;case"message":n=this.message(e.T(),t,e.name,r)}return n}enum(e,t,r,n,i,s){if("google.protobuf.NullValue"==e[0])return i||n?null:void 0;if(void 0!==t){if(0!==t||i||n)return G("number"==typeof t),G(Number.isInteger(t)),s||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}else G(n)}message(e,t,r,n){return void 0===t?n.emitDefaultValues?null:void 0:e.internalJsonWrite(t,n)}scalar(e,t,r,n,i){if(void 0===t)return void G(n);const s=i||n;switch(e){case _.INT32:case _.SFIXED32:case _.SINT32:return 0===t?s?0:void 0:(q(t),t);case _.FIXED32:case _.UINT32:return 0===t?s?0:void 0:($(t),t);case _.FLOAT:z(t);case _.DOUBLE:return 0===t?s?0:void 0:(G("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case _.STRING:return""===t?s?"":void 0:(G("string"==typeof t),t);case _.BOOL:return!1===t?!s&&void 0:(G("boolean"==typeof t),t);case _.UINT64:case _.FIXED64:G("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let e=H.from(t);if(e.isZero()&&!s)return;return e.toString();case _.INT64:case _.SFIXED64:case _.SINT64:G("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let r=W.from(t);if(r.isZero()&&!s)return;return r.toString();case _.BYTES:return G(t instanceof Uint8Array),t.byteLength?function(e){let t,r="",n=0,i=0;for(let s=0;s<e.length;s++)switch(t=e[s],n){case 0:r+=C[t>>2],i=(3&t)<<4,n=1;break;case 1:r+=C[i|t>>4],i=(15&t)<<2,n=2;break;case 2:r+=C[i|t>>6],r+=C[63&t],n=0}return n&&(r+=C[i],r+="=",1==n&&(r+="=")),r}(t):s?"":void 0}}}var Y,X;function Z(e,t=S.STRING){switch(e){case _.BOOL:return!1;case _.UINT64:case _.FIXED64:return J(H.ZERO,t);case _.INT64:case _.SFIXED64:case _.SINT64:return J(W.ZERO,t);case _.DOUBLE:case _.FLOAT:return 0;case _.BYTES:return new Uint8Array(0);case _.STRING:return"";default:return 0}}!function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(r,n,i,s,o)=>{(t(n)?n[e.symbol]:n[e.symbol]=[]).push({no:i,wireType:s,data:o})},e.onWrite=(t,r,n)=>{for(let{no:t,wireType:i,data:s}of e.list(r))n.tag(t,i).raw(s)},e.list=(r,n)=>{if(t(r)){let t=r[e.symbol];return n?t.filter((e=>e.no==n)):t}return[]},e.last=(t,r)=>e.list(t,r).slice(-1)[0];const t=t=>t&&Array.isArray(t[e.symbol])}(Y||(Y={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(X||(X={}));class ee{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=null!==(e=this.info.fields)&&void 0!==e?e:[];this.fieldNoToField=new Map(t.map((e=>[e.no,e])))}}read(e,t,r,n){this.prepare();const i=void 0===n?e.len:e.pos+n;for(;e.pos<i;){const[n,i]=e.tag(),s=this.fieldNoToField.get(n);if(!s){let s=r.readUnknownField;if("throw"==s)throw new Error(`Unknown field ${n} (wire type ${i}) for ${this.info.typeName}`);let o=e.skip(i);!1!==s&&(!0===s?Y.onRead:s)(this.info.typeName,t,n,i,o);continue}let o=t,a=s.repeat,c=s.localName;switch(s.oneof&&(o=o[s.oneof],o.oneofKind!==c&&(o=t[s.oneof]={oneofKind:c})),s.kind){case"scalar":case"enum":let t="enum"==s.kind?_.INT32:s.T,n="scalar"==s.kind?s.L:void 0;if(a){let r=o[c];if(i==X.LengthDelimited&&t!=_.STRING&&t!=_.BYTES){let i=e.uint32()+e.pos;for(;e.pos<i;)r.push(this.scalar(e,t,n))}else r.push(this.scalar(e,t,n))}else o[c]=this.scalar(e,t,n);break;case"message":if(a){let t=o[c],n=s.T().internalBinaryRead(e,e.uint32(),r);t.push(n)}else o[c]=s.T().internalBinaryRead(e,e.uint32(),r,o[c]);break;case"map":let[d,l]=this.mapEntry(s,e,r);o[c][d]=l}}}mapEntry(e,t,r){let n,i,s=t.uint32(),o=t.pos+s;for(;t.pos<o;){let[s,o]=t.tag();switch(s){case 1:n=e.K==_.BOOL?t.bool().toString():this.scalar(t,e.K,S.STRING);break;case 2:switch(e.V.kind){case"scalar":i=this.scalar(t,e.V.T,e.V.L);break;case"enum":i=t.int32();break;case"message":i=e.V.T().internalBinaryRead(t,t.uint32(),r)}break;default:throw new Error(`Unknown field ${s} (wire type ${o}) in map entry for ${this.info.typeName}#${e.name}`)}}if(void 0===n){let t=Z(e.K);n=e.K==_.BOOL?t.toString():t}if(void 0===i)switch(e.V.kind){case"scalar":i=Z(e.V.T,e.V.L);break;case"enum":i=0;break;case"message":i=e.V.T().create()}return[n,i]}scalar(e,t,r){switch(t){case _.INT32:return e.int32();case _.STRING:return e.string();case _.BOOL:return e.bool();case _.DOUBLE:return e.double();case _.FLOAT:return e.float();case _.INT64:return J(e.int64(),r);case _.UINT64:return J(e.uint64(),r);case _.FIXED64:return J(e.fixed64(),r);case _.FIXED32:return e.fixed32();case _.BYTES:return e.bytes();case _.UINT32:return e.uint32();case _.SFIXED32:return e.sfixed32();case _.SFIXED64:return J(e.sfixed64(),r);case _.SINT32:return e.sint32();case _.SINT64:return J(e.sint64(),r)}}}class te{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort(((e,t)=>e.no-t.no))}}write(e,t,r){this.prepare();for(const n of this.fields){let i,s,o=n.repeat,a=n.localName;if(n.oneof){const t=e[n.oneof];if(t.oneofKind!==a)continue;i=t[a],s=!0}else i=e[a],s=!1;switch(n.kind){case"scalar":case"enum":let e="enum"==n.kind?_.INT32:n.T;if(o)if(G(Array.isArray(i)),o==T.PACKED)this.packed(t,e,n.no,i);else for(const r of i)this.scalar(t,e,n.no,r,!0);else void 0===i?G(n.opt):this.scalar(t,e,n.no,i,s||n.opt);break;case"message":if(o){G(Array.isArray(i));for(const e of i)this.message(t,r,n.T(),n.no,e)}else this.message(t,r,n.T(),n.no,i);break;case"map":G("object"==typeof i&&null!==i);for(const[e,s]of Object.entries(i))this.mapEntry(t,r,n,e,s)}}let n=r.writeUnknownFields;!1!==n&&(!0===n?Y.onWrite:n)(this.info.typeName,e,t)}mapEntry(e,t,r,n,i){e.tag(r.no,X.LengthDelimited),e.fork();let s=n;switch(r.K){case _.INT32:case _.FIXED32:case _.UINT32:case _.SFIXED32:case _.SINT32:s=Number.parseInt(n);break;case _.BOOL:G("true"==n||"false"==n),s="true"==n}switch(this.scalar(e,r.K,1,s,!0),r.V.kind){case"scalar":this.scalar(e,r.V.T,2,i,!0);break;case"enum":this.scalar(e,_.INT32,2,i,!0);break;case"message":this.message(e,t,r.V.T(),2,i)}e.join()}message(e,t,r,n,i){void 0!==i&&(r.internalBinaryWrite(i,e.tag(n,X.LengthDelimited).fork(),t),e.join())}scalar(e,t,r,n,i){let[s,o,a]=this.scalarInfo(t,n);a&&!i||(e.tag(r,s),e[o](n))}packed(e,t,r,n){if(!n.length)return;G(t!==_.BYTES&&t!==_.STRING),e.tag(r,X.LengthDelimited),e.fork();let[,i]=this.scalarInfo(t);for(let t=0;t<n.length;t++)e[i](n[t]);e.join()}scalarInfo(e,t){let r,n=X.Varint,i=void 0===t,s=0===t;switch(e){case _.INT32:r="int32";break;case _.STRING:s=i||!t.length,n=X.LengthDelimited,r="string";break;case _.BOOL:s=!1===t,r="bool";break;case _.UINT32:r="uint32";break;case _.DOUBLE:n=X.Bit64,r="double";break;case _.FLOAT:n=X.Bit32,r="float";break;case _.INT64:s=i||W.from(t).isZero(),r="int64";break;case _.UINT64:s=i||H.from(t).isZero(),r="uint64";break;case _.FIXED64:s=i||H.from(t).isZero(),n=X.Bit64,r="fixed64";break;case _.BYTES:s=i||!t.byteLength,n=X.LengthDelimited,r="bytes";break;case _.FIXED32:n=X.Bit32,r="fixed32";break;case _.SFIXED32:n=X.Bit32,r="sfixed32";break;case _.SFIXED64:s=i||W.from(t).isZero(),n=X.Bit64,r="sfixed64";break;case _.SINT32:r="sint32";break;case _.SINT64:s=i||W.from(t).isZero(),r="sint64"}return[n,r,i||s]}}function re(e,t,r){let n,i,s=r;for(let r of e.fields){let e=r.localName;if(r.oneof){const o=s[r.oneof];if(null==(null==o?void 0:o.oneofKind))continue;if(n=o[e],i=t[r.oneof],i.oneofKind=o.oneofKind,null==n){delete i[e];continue}}else if(n=s[e],i=t,null==n)continue;switch(r.repeat&&(i[e].length=n.length),r.kind){case"scalar":case"enum":if(r.repeat)for(let t=0;t<n.length;t++)i[e][t]=n[t];else i[e]=n;break;case"message":let t=r.T();if(r.repeat)for(let r=0;r<n.length;r++)i[e][r]=t.create(n[r]);else void 0===i[e]?i[e]=t.create(n):t.mergePartial(i[e],n);break;case"map":switch(r.V.kind){case"scalar":case"enum":Object.assign(i[e],n);break;case"message":let t=r.V.T();for(let r of Object.keys(n))i[e][r]=t.create(n[r])}}}}const ne={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},ie={ignoreUnknownFields:!1},se=Object.values;function oe(e,t,r){if(t===r)return!0;if(e!==_.BYTES)return!1;let n=t,i=r;if(n.length!==i.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!=i[e])return!1;return!0}function ae(e,t,r){if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!oe(e,t[n],r[n]))return!1;return!0}function ce(e,t,r){if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e.equals(t[n],r[n]))return!1;return!0}const de={writeUnknownFields:!0,writerFactory:()=>new le};class le{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),r=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],r),r+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for($(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return q(e),N(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){z(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){$(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){q(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return q(e),N(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=W.from(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=H.from(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}int64(e){let t=W.from(e);return P(t.lo,t.hi,this.buf),this}sint64(e){let t=W.from(e),r=t.hi>>31;return P(t.lo<<1^r,(t.hi<<1|t.lo>>>31)^r,this.buf),this}uint64(e){let t=H.from(e);return P(t.lo,t.hi,this.buf),this}}const ue={readUnknownField:!0,readerFactory:e=>new he(e)};class he{constructor(e,t){this.varint64=A,this.uint32=x,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,r=7&e;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e){let t=this.pos;switch(e){case X.Varint:for(;128&this.buf[this.pos++];);break;case X.Bit64:this.pos+=4;case X.Bit32:this.pos+=4;break;case X.LengthDelimited:let t=this.uint32();this.pos+=t;break;case X.StartGroup:let r;for(;(r=this.tag()[1])!==X.EndGroup;)this.skip(r);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return new W(...this.varint64())}uint64(){return new H(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(1&e);return e=(e>>>1|(1&t)<<31)^r,t=t>>>1^r,new W(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new H(this.sfixed32(),this.sfixed32())}sfixed64(){return new W(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}const pe=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class me{constructor(e,t,r){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(E),this.options=null!=r?r:{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},pe),{[v]:{value:this}})),this.refTypeCheck=new w(this),this.refJsonReader=new K(this),this.refJsonWriter=new Q(this),this.refBinReader=new ee(this),this.refBinWriter=new te(this)}create(e){let t=function(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},v,{value:e});for(let r of e.fields){let e=r.localName;if(!r.opt)if(r.oneof)t[r.oneof]={oneofKind:void 0};else if(r.repeat)t[e]=[];else switch(r.kind){case"scalar":t[e]=Z(r.T,r.L);break;case"enum":t[e]=0;break;case"map":t[e]={}}}return t}(this);return void 0!==e&&re(this,t,e),t}clone(e){let t=this.create();return re(this,t,e),t}equals(e,t){return function(e,t,r){if(t===r)return!0;if(!t||!r)return!1;for(let n of e.fields){let e=n.localName,i=n.oneof?t[n.oneof][e]:t[e],s=n.oneof?r[n.oneof][e]:r[e];switch(n.kind){case"enum":case"scalar":let e="enum"==n.kind?_.INT32:n.T;if(!(n.repeat?ae(e,i,s):oe(e,i,s)))return!1;break;case"map":if(!("message"==n.V.kind?ce(n.V.T(),se(i),se(s)):ae("enum"==n.V.kind?_.INT32:n.V.T,se(i),se(s))))return!1;break;case"message":let t=n.T();if(!(n.repeat?ce(t,i,s):t.equals(i,s)))return!1}}return!0}(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){re(this,e,t)}fromBinary(e,t){let r=function(e){return e?Object.assign(Object.assign({},ue),e):ue}(t);return this.internalBinaryRead(r.readerFactory(e),e.byteLength,r)}fromJson(e,t){return this.internalJsonRead(e,function(e){return e?Object.assign(Object.assign({},ie),e):ie}(t))}fromJsonString(e,t){let r=JSON.parse(e);return this.fromJson(r,t)}toJson(e,t){return this.internalJsonWrite(e,function(e){return e?Object.assign(Object.assign({},ne),e):ne}(t))}toJsonString(e,t){var r;let n=this.toJson(e,t);return JSON.stringify(n,null,null!==(r=null==t?void 0:t.prettySpaces)&&void 0!==r?r:0)}toBinary(e,t){let r=function(e){return e?Object.assign(Object.assign({},de),e):de}(t);return this.internalBinaryWrite(e,r.writerFactory(),r).finish()}internalJsonRead(e,t,r){if(null!==e&&"object"==typeof e&&!Array.isArray(e)){let n=null!=r?r:this.create();return this.refJsonReader.read(e,n,t),n}throw new Error(`Unable to parse message ${this.typeName} from JSON ${k(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,r){return this.refBinWriter.write(e,t,r),t}internalBinaryRead(e,t,r,n){let i=null!=n?n:this.create();return this.refBinReader.read(e,i,r,t),i}}const fe=Object.create(null);fe.open="0",fe.close="1",fe.ping="2",fe.pong="3",fe.message="4",fe.upgrade="5",fe.noop="6";const ge=Object.create(null);Object.keys(fe).forEach((e=>{ge[fe[e]]=e}));const ve={type:"error",data:"parser error"},ye="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),_e="function"==typeof ArrayBuffer,Se=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)},Te=({type:e,data:t},r,n)=>{return ye&&t instanceof Blob?r?n(t):Se(t,n):_e&&(t instanceof ArrayBuffer||(i=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer))?r?n(t):Se(new Blob([t]),n):n(fe[e]+(t||""));var i},Ee="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)Ee["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const be="function"==typeof ArrayBuffer,we=(e,t)=>{if(be){const r=(e=>{let t,r,n,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const d=new ArrayBuffer(o),l=new Uint8Array(d);for(t=0;t<a;t+=4)r=Ee[e.charCodeAt(t)],n=Ee[e.charCodeAt(t+1)],i=Ee[e.charCodeAt(t+2)],s=Ee[e.charCodeAt(t+3)],l[c++]=r<<2|n>>4,l[c++]=(15&n)<<4|i>>2,l[c++]=(3&i)<<6|63&s;return d})(e);return ke(r,t)}return{base64:!0,data:e}},ke=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,Re=(e,t)=>{if("string"!=typeof e)return{type:"message",data:ke(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:we(e.substring(1),t)}:ge[r]?e.length>1?{type:ge[r],data:e.substring(1)}:{type:ge[r]}:ve},Ce=String.fromCharCode(30);function Ie(e){if(e)return function(e){for(var t in Ie.prototype)e[t]=Ie.prototype[t];return e}(e)}Ie.prototype.on=Ie.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Ie.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},Ie.prototype.off=Ie.prototype.removeListener=Ie.prototype.removeAllListeners=Ie.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},Ie.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},Ie.prototype.emitReserved=Ie.prototype.emit,Ie.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Ie.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ae="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Pe(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const De=Ae.setTimeout,Oe=Ae.clearTimeout;function Me(e,t){t.useNativeTimers?(e.setTimeoutFn=De.bind(Ae),e.clearTimeoutFn=Oe.bind(Ae)):(e.setTimeoutFn=Ae.setTimeout.bind(Ae),e.clearTimeoutFn=Ae.clearTimeout.bind(Ae))}class Ne extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class xe extends Ie{constructor(e){super(),this.writable=!1,Me(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new Ne(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Re(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const Le="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ue=64,je={};let Fe,Ve=0,Be=0;function He(e){let t="";do{t=Le[e%Ue]+t,e=Math.floor(e/Ue)}while(e>0);return t}function We(){const e=He(+new Date);return e!==Fe?(Ve=0,Fe=e):e+"."+He(Ve++)}for(;Be<Ue;Be++)je[Le[Be]]=Be;function Ge(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}let qe=!1;try{qe="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const $e=qe;function ze(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||$e))return new XMLHttpRequest}catch(e){}if(!t)try{return new(Ae[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function Je(){}const Ke=null!=new ze({xdomain:!1}).responseType;class Qe extends Ie{constructor(e,t){super(),Me(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=Pe(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new ze(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Qe.requestsCount++,Qe.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Je,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Qe.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function Ye(){for(let e in Qe.requests)Qe.requests.hasOwnProperty(e)&&Qe.requests[e].abort()}Qe.requestsCount=0,Qe.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Ye):"function"==typeof addEventListener&&addEventListener("onpagehide"in Ae?"pagehide":"unload",Ye,!1));const Xe="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Ze=Ae.WebSocket||Ae.MozWebSocket,et="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),tt={websocket:class extends xe{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=et?{}:Pe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=et?new Ze(e,t,r):t?new Ze(e,t):new Ze(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Te(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&Xe((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=We()),this.supportsBinary||(e.b64=1);const n=Ge(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!Ze}},polling:class extends xe{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=Ke&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(Ce),n=[];for(let e=0;e<r.length;e++){const i=Re(r[e],t);if(n.push(i),"error"===i.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let i=0;e.forEach(((e,s)=>{Te(e,!1,(e=>{n[s]=e,++i===r&&t(n.join(Ce))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=We()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=Ge(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Qe(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},rt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,nt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function it(e){const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let i=rt.exec(e||""),s={},o=14;for(;o--;)s[nt[o]]=i[o]||"";return-1!=r&&-1!=n&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,s.path),s.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,s.query),s}class st extends Ie{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=it(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=it(t.host).host),Me(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new tt[e](r)}open(){let e;if(this.opts.rememberUpgrade&&st.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;st.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;st.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){r||(r=!0,d(),t.close(),t=null)}const s=e=>{const r=new Error("probe error: "+e);r.transport=t.name,i(),this.emitReserved("upgradeError",r)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){t&&e.name!==t.name&&i()}const d=()=>{t.removeListener("open",n),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",st.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){st.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}st.protocol=4,st.protocol;const ot="function"==typeof ArrayBuffer,at=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,ct=Object.prototype.toString,dt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ct.call(Blob),lt="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ct.call(File);function ut(e){return ot&&(e instanceof ArrayBuffer||at(e))||dt&&e instanceof Blob||lt&&e instanceof File}function ht(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(ht(e[t]))return!0;return!1}if(ut(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return ht(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&ht(e[t]))return!0;return!1}function pt(e){const t=[],r=e.data,n=e;return n.data=mt(r,t),n.attachments=t.length,{packet:n,buffers:t}}function mt(e,t){if(!e)return e;if(ut(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=mt(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=mt(e[n],t));return r}return e}function ft(e,t){return e.data=gt(e.data,t),delete e.attachments,e}function gt(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=gt(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=gt(e[r],t));return e}const vt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],yt=5;var _t;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(_t||(_t={}));class St{constructor(e){this.replacer=e}encode(e){return e.type!==_t.EVENT&&e.type!==_t.ACK||!ht(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===_t.EVENT?_t.BINARY_EVENT:_t.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==_t.BINARY_EVENT&&e.type!==_t.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=pt(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function Tt(e){return"[object Object]"===Object.prototype.toString.call(e)}class Et extends Ie{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===_t.BINARY_EVENT;r||t.type===_t.BINARY_ACK?(t.type=r?_t.EVENT:_t.ACK,this.reconstructor=new bt(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!ut(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===_t[r.type])throw new Error("unknown packet type "+r.type);if(r.type===_t.BINARY_EVENT||r.type===_t.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(n,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!Et.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case _t.CONNECT:return Tt(t);case _t.DISCONNECT:return void 0===t;case _t.CONNECT_ERROR:return"string"==typeof t||Tt(t);case _t.EVENT:case _t.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===vt.indexOf(t[0]));case _t.ACK:case _t.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class bt{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ft(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function wt(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const kt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Rt extends Ie{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[wt(e,"open",this.onopen.bind(this)),wt(e,"packet",this.onpacket.bind(this)),wt(e,"error",this.onerror.bind(this)),wt(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(kt.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:_t.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),r.id=e}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),n);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...e])}}emitWithAck(e,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((n,i)=>{t.push(((e,t)=>r?e?i(e):n(t):n(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...n)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:_t.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case _t.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _t.EVENT:case _t.BINARY_EVENT:this.onevent(e);break;case _t.ACK:case _t.BINARY_ACK:this.onack(e);break;case _t.DISCONNECT:this.ondisconnect();break;case _t.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:_t.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_t.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Ct(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ct.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Ct.prototype.reset=function(){this.attempts=0},Ct.prototype.setMin=function(e){this.ms=e},Ct.prototype.setMax=function(e){this.max=e},Ct.prototype.setJitter=function(e){this.jitter=e};class It extends Ie{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Me(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Ct({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||n;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new st(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=wt(t,"open",(function(){r.onopen(),e&&e()})),i=wt(t,"error",(t=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",t),e?e(t):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&n();const r=this.setTimeoutFn((()=>{n(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(wt(e,"ping",this.onping.bind(this)),wt(e,"data",this.ondata.bind(this)),wt(e,"error",this.onerror.bind(this)),wt(e,"close",this.onclose.bind(this)),wt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){Xe((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Rt(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const At={};function Pt(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=it(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+t,n.href=n.protocol+"://"+i+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,i=r.id,s=r.path,o=At[i]&&s in At[i].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new It(n,t):(At[i]||(At[i]=new It(n,t)),a=At[i]),r.query&&!t.query&&(t.query=r.queryKey),a.socket(r.path,t)}Object.assign(Pt,{Manager:It,Socket:Rt,io:Pt,connect:Pt});var Dt=r(8389);const Ot=((e,t)=>{let r=null;return()=>{if(null!==r)return r;const e=new Blob(['(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'],{type:"application/javascript; charset=utf-8"}),t=URL.createObjectURL(e);return r=(e=>{const t=new Map([[0,()=>{}]]),r=new Map([[0,()=>{}]]),n=new Map,i=new Worker(e);return i.addEventListener("message",(({data:e})=>{if(void 0!==(i=e).method&&"call"===i.method){const{params:{timerId:i,timerType:s}}=e;if("interval"===s){const e=t.get(i);if("number"==typeof e){const t=n.get(e);if(void 0===t||t.timerId!==i||t.timerType!==s)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e()}}else if("timeout"===s){const e=r.get(i);if("number"==typeof e){const t=n.get(e);if(void 0===t||t.timerId!==i||t.timerType!==s)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e(),r.delete(i)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(e)){const{error:{message:t}}=e;throw new Error(t)}{const{id:i}=e,s=n.get(i);if(void 0===s)throw new Error("The timer is in an undefined state.");const{timerId:o,timerType:a}=s;n.delete(i),"interval"===a?t.delete(o):r.delete(o)}}var i})),{clearInterval:e=>{const r=(0,Dt.generateUniqueNumber)(n);n.set(r,{timerId:e,timerType:"interval"}),t.set(e,r),i.postMessage({id:r,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=(0,Dt.generateUniqueNumber)(n);n.set(t,{timerId:e,timerType:"timeout"}),r.set(e,t),i.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,r=0)=>{const n=(0,Dt.generateUniqueNumber)(t);return t.set(n,(()=>{e(),"function"==typeof t.get(n)&&i.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:n,timerType:"interval"}})})),i.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:n,timerType:"interval"}}),n},setTimeout:(e,t=0)=>{const n=(0,Dt.generateUniqueNumber)(r);return r.set(n,e),i.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:n,timerType:"timeout"}}),n}}})(t),setTimeout((()=>URL.revokeObjectURL(t))),r}})(),Mt=e=>Ot().clearInterval(e),Nt=(e,t)=>Ot().setInterval(e,t);e=r.hmd(e);var xt,Lt=Object.defineProperty,Ut=Object.defineProperties,jt=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertySymbols,Vt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty,Ht=Object.prototype.propertyIsEnumerable,Wt=Reflect.get,Gt=Math.pow,qt=(e,t,r)=>t in e?Lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$t=(e,t)=>{for(var r in t||(t={}))Bt.call(t,r)&&qt(e,r,t[r]);if(Ft)for(var r of Ft(t))Ht.call(t,r)&&qt(e,r,t[r]);return e},zt=(e,t)=>Ut(e,jt(t)),Jt=(e,t)=>{var r={};for(var n in e)Bt.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&Ft)for(var n of Ft(e))t.indexOf(n)<0&&Ht.call(e,n)&&(r[n]=e[n]);return r},Kt=(e,t,r)=>(qt(e,"symbol"!=typeof t?t+"":t,r),r),Qt=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},Yt=(e,t,r)=>(Qt(e,t,"read from private field"),r?r.call(e):t.get(e)),Xt=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Zt=(e,t,r,n)=>(Qt(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),er=(e,t,r)=>(Qt(e,t,"access private method"),r),tr=(e,t,r)=>new Promise(((n,i)=>{var s=e=>{try{a(r.next(e))}catch(e){i(e)}},o=e=>{try{a(r.throw(e))}catch(e){i(e)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,o);a((r=r.apply(e,t)).next())})),rr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},nr={},ir={get exports(){return nr},set exports(e){nr=e}},sr="object"==typeof Reflect?Reflect:null,or=sr&&"function"==typeof sr.apply?sr.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};xt=sr&&"function"==typeof sr.ownKeys?sr.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var ar=Number.isNaN||function(e){return e!=e};function cr(){cr.init.call(this)}ir.exports=cr,nr.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}yr(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&yr(e,"error",t,{once:!0})}(e,i)}))},cr.EventEmitter=cr,cr.prototype._events=void 0,cr.prototype._eventsCount=0,cr.prototype._maxListeners=void 0;var dr=10;function lr(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function ur(e){return void 0===e._maxListeners?cr.defaultMaxListeners:e._maxListeners}function hr(e,t,r,n){var i,s,o;if(lr(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=ur(e))>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,function(e){console&&console.warn&&console.warn(e)}(a)}return e}function pr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mr(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=pr.bind(n);return i.listener=r,n.wrapFn=i,i}function fr(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):vr(i,i.length)}function gr(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function vr(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function yr(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){n.once&&e.removeEventListener(t,i),r(s)}))}}Object.defineProperty(cr,"defaultMaxListeners",{enumerable:!0,get:function(){return dr},set:function(e){if("number"!=typeof e||e<0||ar(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");dr=e}}),cr.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},cr.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||ar(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},cr.prototype.getMaxListeners=function(){return ur(this)},cr.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)or(a,this,t);else{var c=a.length,d=vr(a,c);for(r=0;r<c;++r)or(d[r],this,t)}return!0},cr.prototype.addListener=function(e,t){return hr(this,e,t,!1)},cr.prototype.on=cr.prototype.addListener,cr.prototype.prependListener=function(e,t){return hr(this,e,t,!0)},cr.prototype.once=function(e,t){return lr(t),this.on(e,mr(this,e,t)),this},cr.prototype.prependOnceListener=function(e,t){return lr(t),this.prependListener(e,mr(this,e,t)),this},cr.prototype.removeListener=function(e,t){var r,n,i,s,o;if(lr(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},cr.prototype.off=cr.prototype.removeListener,cr.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},cr.prototype.listeners=function(e){return fr(this,e,!0)},cr.prototype.rawListeners=function(e){return fr(this,e,!1)},cr.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):gr.call(e,t)},cr.prototype.listenerCount=gr,cr.prototype.eventNames=function(){return this._eventsCount>0?xt(this._events):[]};var _r,Sr,Tr={},Er={get exports(){return Tr},set exports(e){Tr=e}};var br=function(e){function t(e){let n,i,s,o=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];n=s.call(r,t),e.splice(o,1),o--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=function(){if(Sr)return _r;Sr=1;var e=1e3,t=60*e,r=60*t,n=24*r;function i(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}return _r=function(s,o){o=o||{};var a=typeof s;if("string"===a&&s.length>0)return function(i){if(!((i=String(i)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(s){var o=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*n;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*t;case"seconds":case"second":case"secs":case"sec":case"s":return o*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(s);if("number"===a&&isFinite(s))return o.long?function(s){var o=Math.abs(s);return o>=n?i(s,o,n,"day"):o>=r?i(s,o,r,"hour"):o>=t?i(s,o,t,"minute"):o>=e?i(s,o,e,"second"):s+" ms"}(s):function(i){var s=Math.abs(i);return s>=n?Math.round(i/n)+"d":s>=r?Math.round(i/r)+"h":s>=t?Math.round(i/t)+"m":s>=e?Math.round(i/e)+"s":i+"ms"}(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))}}(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=br(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(Er,Tr);const wr="mediasoup-client",kr=new class{constructor(e){e?(this._debug=Tr(`${wr}:${e}`),this._warn=Tr(`${wr}:WARN:${e}`),this._error=Tr(`${wr}:ERROR:${e}`)):(this._debug=Tr(wr),this._warn=Tr(`${wr}:WARN`),this._error=Tr(`${wr}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}("EnhancedEventEmitter");let Rr=class extends nr.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){const r=super.listenerCount(e);try{return super.emit(e,...t)}catch(t){return kr.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,t),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}};var Cr,Ir,Ar;(Ir=Cr||(Cr={}))[Ir.MAJOR_EVENT=0]="MAJOR_EVENT",Ir[Ir.MINOR_EVENT=1]="MINOR_EVENT",function(e){e.PRECALL_TEST_BEGIN="precall_begin",e.PRECALL_TEST_COMPLETE="precall_end",e.CALL_JOIN_BEGIN="call_join",e.NET_QUALITY_TEST_BEGIN="net_quality_test_begin",e.NET_QUALITY_TEST_END="net_quality_test_end",e.WEBSOCKET_CONNECTED="websocket_connected",e.TRANSPORT_CONNECTED="transport_connected",e.AUDIO_ON="audio_on",e.AUDIO_OFF="audio_off",e.VIDEO_ON="video_on",e.VIDEO_OFF="video_off",e.PARTICIPANT_ROLE="participant_role",e.PING_STAT="ping_stat",e.DISCONNECT="disconnect",e.RECONNECT_ATTEMPT="reconnect_attempt",e.SCREENSHARE_START_REQUESTED="screenshare_start_requested",e.SCREENSHARE_STARTED="screenshare_started",e.SCREENSHARE_STOPPED="screenshare_stopped",e.TAB_CHANGE="tab_change",e.BROWSER_BACKGROUNDED="browser_backgrounded",e.BROWSER_FOREGROUNDED="browser_foregrounded",e.DOMINANT_SPEAKER="dominant_speaker",e.AUDIO_DEVICES_UPDATES="audio_devices_updates",e.VIDEO_DEVICES_UPDATES="video_devices_updates",e.SPEAKER_DEVICES_UPDATES="speaker_devices_updates",e.SELECTED_MICROHPONE_UPDATE="selected_microphone_update",e.SELECTED_CAMERA_UPDATE="selected_camera_update",e.SELECTED_SPEAKER_UPDATE="selected_speaker_update",e.MEDIA_PERMISSION="camera_permission",e.LEGACY_SWITCH="legacy_switch",e.AUDIO_PLAY_FAILED="audio_play_failed",e.VIDEO_PLAY_FAILED="video_play_failed",e.AUDIO_TRACK_MUTED="audio_track_muted",e.VIDEO_TRACK_MUTED="video_track_muted",e.IVS_PLAYER_REBUFFERING="ivs_player_rebuffering",e.IVS_PLAYER_AUDIO_BLOCKED="ivs_player_audio_blocked",e.IVS_PLAYER_PLAYBACK_BLOCKED="ivs_player_playback_blocked",e.IVS_PLAYER_ERROR="ivs_player_error",e.IVS_PLAYER_RECOVERABLE_ERROR="ivs_player_recoverable_error",e.IVS_PLAYER_WORKER_ERROR="ivs_player_worker_error",e.IVS_PLAYER_NETWORK_UNAVAILABLE="ivs_player_network_unavailable",e.LIVESTREAM_LATENCY="livestream_latency",e.IVS_PLAYER_ANALYTICS_EVENT="ivs_player_analytics_event",e.IVS_PLAYER_PLAYBACK_RATE_CHANGED="ivs_player_playback_rate_changed",e.IVS_PLAYER_QUALITY_CHANGED="ivs_player_quality_changed",e.IVS_PLAYER_INITIALIZED="ivs_player_initialized"}(Ar||(Ar={}));const Pr=new Map([[Ar.PRECALL_TEST_BEGIN,Cr.MINOR_EVENT],[Ar.PRECALL_TEST_COMPLETE,Cr.MINOR_EVENT],[Ar.CALL_JOIN_BEGIN,Cr.MAJOR_EVENT],[Ar.NET_QUALITY_TEST_BEGIN,Cr.MINOR_EVENT],[Ar.NET_QUALITY_TEST_END,Cr.MINOR_EVENT],[Ar.WEBSOCKET_CONNECTED,Cr.MINOR_EVENT],[Ar.TRANSPORT_CONNECTED,Cr.MAJOR_EVENT],[Ar.AUDIO_ON,Cr.MINOR_EVENT],[Ar.AUDIO_OFF,Cr.MINOR_EVENT],[Ar.VIDEO_ON,Cr.MINOR_EVENT],[Ar.VIDEO_OFF,Cr.MINOR_EVENT],[Ar.PARTICIPANT_ROLE,Cr.MINOR_EVENT],[Ar.PING_STAT,Cr.MAJOR_EVENT],[Ar.DISCONNECT,Cr.MAJOR_EVENT],[Ar.RECONNECT_ATTEMPT,Cr.MAJOR_EVENT],[Ar.SCREENSHARE_START_REQUESTED,Cr.MINOR_EVENT],[Ar.SCREENSHARE_STARTED,Cr.MINOR_EVENT],[Ar.SCREENSHARE_STOPPED,Cr.MINOR_EVENT],[Ar.TAB_CHANGE,Cr.MINOR_EVENT],[Ar.BROWSER_BACKGROUNDED,Cr.MINOR_EVENT],[Ar.BROWSER_FOREGROUNDED,Cr.MINOR_EVENT],[Ar.DOMINANT_SPEAKER,Cr.MINOR_EVENT],[Ar.AUDIO_DEVICES_UPDATES,Cr.MINOR_EVENT],[Ar.VIDEO_DEVICES_UPDATES,Cr.MINOR_EVENT],[Ar.SPEAKER_DEVICES_UPDATES,Cr.MINOR_EVENT],[Ar.SELECTED_MICROHPONE_UPDATE,Cr.MINOR_EVENT],[Ar.SELECTED_CAMERA_UPDATE,Cr.MINOR_EVENT],[Ar.SELECTED_SPEAKER_UPDATE,Cr.MINOR_EVENT],[Ar.MEDIA_PERMISSION,Cr.MINOR_EVENT],[Ar.LEGACY_SWITCH,Cr.MINOR_EVENT],[Ar.AUDIO_PLAY_FAILED,Cr.MINOR_EVENT],[Ar.VIDEO_PLAY_FAILED,Cr.MINOR_EVENT],[Ar.AUDIO_TRACK_MUTED,Cr.MINOR_EVENT],[Ar.VIDEO_TRACK_MUTED,Cr.MINOR_EVENT],[Ar.IVS_PLAYER_REBUFFERING,Cr.MAJOR_EVENT],[Ar.IVS_PLAYER_AUDIO_BLOCKED,Cr.MAJOR_EVENT],[Ar.IVS_PLAYER_PLAYBACK_BLOCKED,Cr.MAJOR_EVENT],[Ar.IVS_PLAYER_ERROR,Cr.MAJOR_EVENT],[Ar.IVS_PLAYER_RECOVERABLE_ERROR,Cr.MAJOR_EVENT],[Ar.IVS_PLAYER_WORKER_ERROR,Cr.MAJOR_EVENT],[Ar.IVS_PLAYER_NETWORK_UNAVAILABLE,Cr.MAJOR_EVENT],[Ar.LIVESTREAM_LATENCY,Cr.MAJOR_EVENT],[Ar.IVS_PLAYER_ANALYTICS_EVENT,Cr.MINOR_EVENT],[Ar.IVS_PLAYER_PLAYBACK_RATE_CHANGED,Cr.MINOR_EVENT],[Ar.IVS_PLAYER_QUALITY_CHANGED,Cr.MINOR_EVENT],[Ar.IVS_PLAYER_INITIALIZED,Cr.MINOR_EVENT]]);class Dr{constructor(){Kt(this,"events"),this.events=[]}add(e){this.events.push(e)}flush(){return{entries:this.events.splice(0,25)}}}class Or extends nr{constructor({logger:e,peerId:t,apiHostnames:r}){super(),Kt(this,"logger"),Kt(this,"peerId"),Kt(this,"eventStore"),Kt(this,"apiEndpoint"),this.logger=e,this.peerId=t,this.apiEndpoint=`https://${r.daCollector}/api/v1/message`,this.eventStore=new Dr}sendEventsChunkToServer(e){return tr(this,null,(function*(){var t;const r={payload:e,peerId:this.peerId};try{return yield fetch(this.apiEndpoint,{method:"POST",body:JSON.stringify(r)}),!0}catch(r){return this.logger.error("callStats::sendEventsChunkToServer::catch",{error:r}),null==(t=e.entries)||t.forEach((e=>{this.eventStore.add(e)})),!1}}))}callEvent(e){e.timestamp=new Date,this.eventStore.add(e),this.emit(e.event,e.metaData),Pr.get(e.event)===Cr.MAJOR_EVENT&&this.flush()}flush(){return tr(this,null,(function*(){var e;const t=this.eventStore.flush();return!(null==(e=null==t?void 0:t.entries)||!e.length||(yield this.sendEventsChunkToServer(t),0))}))}}var Mr;!function(e){e.CHROMIUM="chromum",e.FIREFOX="firefox",e.SAFARI="safari"}(Mr||(Mr={}));const Nr="prod";var xr,Lr;!function(e){e.AUDIO="AUDIO",e.VIDEO="VIDEO",e.SPEAKER="SPEAKER"}(xr||(xr={})),function(e){e[e.INIT=0]="INIT",e[e.ACCEPTED=1]="ACCEPTED",e[e.DENIED=2]="DENIED",e[e.SYS_DENIED=3]="SYS_DENIED",e[e.FAILED=4]="FAILED",e[e.NOTFOUND=5]="NOTFOUND",e[e.NOT_APPLICABLE=6]="NOT_APPLICABLE"}(Lr||(Lr={}));const Ur=.02,jr=.03;function Fr({stat:e,weight:t,rangeMin:r,rangeMax:n,rangeRankingDirection:i}){return null==e?t:r===n?"UP"===i?e<=r?t:0:e>=n?t:0:"UP"===i?(1-Math.max(Math.min(n,Math.abs(e))-r,0)/(n-r))*t:"DOWN"===i?Math.max(Math.min(n,Math.abs(e))-r,0)/(n-r)*t:t}function Vr({isLowQualityVideo:e,isVideoStuck:t,isVideoLagging:r,jitterQuality:n,packetsLostQuality:i}){const s=(e?.85:1)*(r?.7:1)*(t?.5:1)*.8+n*i*.2;return Math.round(100*(s+Number.EPSILON))/100}function Br({packetsLost:e,packetsSent:t}){return t>0?100*e/t:0}function Hr({packetsLost:e,packetsSent:t,jitter:r}){return Fr({stat:Br({packetsLost:e,packetsSent:t}),weight:.7,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"})+Fr({stat:r,weight:.3,rangeMin:Ur,rangeMax:jr,rangeRankingDirection:"UP"})}function Wr({frameWidth:e,framesPerSecond:t,packetsLost:r,packetsSent:n,jitter:i,isScreenShare:s,framesEncoded:o}){const a=Fr({stat:Br({packetsLost:r,packetsSent:n}),weight:1,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"}),c=Fr({stat:i,weight:1,rangeMin:Ur,rangeMax:jr,rangeRankingDirection:"UP"}),d=function({frameWidth:e,isScreenShare:t}){return e<(t?720:240)}({frameWidth:e,isScreenShare:s}),l=function({framesPerSecond:e,isScreenShare:t}){return e<(t?3:8)}({framesPerSecond:t,isScreenShare:s}),u=function({framesEncoded:e}){return 0===e}({framesEncoded:o,isScreenShare:s});return Vr({isLowQualityVideo:d,isVideoLagging:l,isVideoStuck:u,jitterQuality:c,packetsLostQuality:a})}function Gr({packetsLost:e,packetsReceived:t}){return t+e>0?100*e/(t+e):0}function qr({concealmentEvents:e,packetsLost:t,packetsReceived:r,jitter:n}){return Fr({stat:e,weight:.2,rangeMin:0,rangeMax:3,rangeRankingDirection:"UP"})+Fr({stat:Gr({packetsLost:t,packetsReceived:r}),weight:.5,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"})+Fr({stat:n,weight:.3,rangeMin:Ur,rangeMax:jr,rangeRankingDirection:"UP"})}function $r({frameWidth:e,framesPerSecond:t,packetsLost:r,packetsReceived:n,jitter:i,isScreenShare:s,framesDecoded:o}){const a=Fr({stat:Gr({packetsLost:r,packetsReceived:n}),weight:1,rangeMin:0,rangeMax:10,rangeRankingDirection:"UP"}),c=Fr({stat:i,weight:1,rangeMin:Ur,rangeMax:jr,rangeRankingDirection:"UP"}),d=function({frameWidth:e,isScreenShare:t}){return e<(t?720:240)}({frameWidth:e,isScreenShare:s}),l=function({framesPerSecond:e,isScreenShare:t}){return e<(t?3:8)}({framesPerSecond:t,isScreenShare:s}),u=function({framesDecoded:e}){return 0===e}({framesDecoded:o,isScreenShare:s});return Vr({isLowQualityVideo:d,isVideoLagging:l,isVideoStuck:u,jitterQuality:c,packetsLostQuality:a})}class zr{constructor(e){Kt(this,"pc1"),Kt(this,"pc2"),Kt(this,"constrainVideoBitrateKbps"),Kt(this,"constrainOfferToRemoveVideoFec",!1),Kt(this,"iceCandidateFilter");const t=new RTCPeerConnection(e),r=new RTCPeerConnection(e);this.pc1=t,this.pc2=r,this.iceCandidateFilter=zr.noFilter,this.pc1.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc2)),this.pc2.addEventListener("icecandidate",this.onIceCandidate.bind(this,this.pc1))}static parseCandidate(e){const t=e.indexOf("candidate:")+10,r=e.substr(t).split(" ");return{type:r[7],protocol:r[2],address:r[4]}}static isNotHostCandidate(e){return"host"!==e.type}static isHost(e){return"host"===e.type}static isRelay(e){return"relay"===e.type}static isReflexive(e){return"srflx"===e.type}static noFilter(e){return!0}onIceCandidate(e,t){if(t.candidate){const r=zr.parseCandidate(t.candidate.candidate);this.iceCandidateFilter(r)&&e.addIceCandidate(t.candidate)}}setIceCandidateFilter(e){this.iceCandidateFilter=e}constrainVideoBitrate(e){this.constrainVideoBitrateKbps=e}disableVideoFec(){this.constrainOfferToRemoveVideoFec=!0}gotOffer(e){this.constrainOfferToRemoveVideoFec&&(e.sdp=e.sdp.replace(/(m=video 1 [^\r]+)(116 117)(\r\n)/g,"$1\r\n"),e.sdp=e.sdp.replace(/a=rtpmap:116 red\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=rtpmap:117 ulpfec\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=rtpmap:98 rtx\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=fmtp:98 apt=116\r\n/g,"")),this.pc1.setLocalDescription(e),this.pc2.setRemoteDescription(e),this.pc2.createAnswer().then(this.gotAnswer.bind(this),this.reportFatal.bind(this))}gotAnswer(e){this.constrainVideoBitrateKbps&&(e.sdp=e.sdp.replace(/a=mid:video\r\n/g,`a=mid:video\r\nb=AS:${this.constrainVideoBitrateKbps}\r\n`)),this.pc2.setLocalDescription(e),this.pc1.setRemoteDescription(e)}establishConnection(){this.pc1.createOffer().then(this.gotOffer.bind(this),this.reportFatal.bind(this))}reportFatal(e){console.error("Error:",e)}getRoundTripTime(){return tr(this,null,(function*(){const[e,t]=yield Promise.all([this.pc1.getStats(),this.pc2.getStats()]);let r,n;if(e.forEach((e=>{"candidate-pair"===e.type&&!0===e.nominated&&e.bytesSent>0&&(r=e)})),t.forEach((e=>{"candidate-pair"===e.type&&!0===e.nominated&&e.bytesReceived>0&&(n=e)})),r&&n)try{if(r.currentRoundTripTime&&n.currentRoundTripTime)return{rtt:r.currentRoundTripTime,backendRTT:n.currentRoundTripTime};const e=(n.lastPacketReceivedTimestamp-r.lastPacketSentTimestamp)/1e3;return{rtt:e,backendRTT:e}}catch(e){return}}))}close(){this.pc1.close(),this.pc2.close()}}class Jr extends nr{constructor(e){super(),Kt(this,"call"),Kt(this,"timeOut"),this.call=new zr(e)}start(e=1e4){this.call.establishConnection(),this.timeOut=setTimeout(this.testFailed.bind(this),e)}testComplete(e){clearTimeout(this.timeOut),this.call.close(),this.emit("done",e)}testFailed(e){this.call.close(),this.emit("failed",e)}}class Kr extends Jr{constructor(e){super(e),Kt(this,"senderChannel"),Kt(this,"recieveChannel"),Kt(this,"startTime"),Kt(this,"lastBitrateMeasureTime"),Kt(this,"sentPayloadBytes",0),Kt(this,"recievedPayloadBytes",0),Kt(this,"lastReceivedPayloadBytes",0),Kt(this,"stopSending",!1),Kt(this,"testProgress",0),Kt(this,"samplePacket",""),Kt(this,"finalBitrateSum",0),Kt(this,"bitRateSampels",0),Kt(this,"maxNumberOfPacketsToSend",0),Kt(this,"bytesToKeepBuffered",0),Kt(this,"testDurationSeconds",5),this.call.setIceCandidateFilter(zr.isNotHostCandidate),this.senderChannel=this.call.pc1.createDataChannel(null);for(let e=0;e<262144;e+=1)this.samplePacket+="h";this.maxNumberOfPacketsToSend=1,this.bytesToKeepBuffered=1024*this.maxNumberOfPacketsToSend,this.testDurationSeconds=4,this.senderChannel.addEventListener("open",this.sendingStep.bind(this)),this.call.pc2.addEventListener("datachannel",this.onRecieverChannel.bind(this))}sendingStep(){const e=new Date;this.startTime||(this.startTime=e,this.lastBitrateMeasureTime=e);for(let e=0;e!==this.maxNumberOfPacketsToSend&&!(this.senderChannel.bufferedAmount>=this.bytesToKeepBuffered);e+=1){this.sentPayloadBytes+=this.samplePacket.length;try{this.senderChannel.send(this.samplePacket)}catch(e){}}const t=e.getTime()-this.startTime.getTime();t>=1e3*this.testDurationSeconds?(this.stopSending=!0,this.testProgress=100):(this.testProgress=t/(10*this.testDurationSeconds),setTimeout(this.sendingStep.bind(this),1))}onMessageRecieved(e){this.recievedPayloadBytes+=e.data.length;const t=new Date,r=t.getTime()-this.lastBitrateMeasureTime.getTime();if(r>=1e3){const e=8*(this.recievedPayloadBytes-this.lastReceivedPayloadBytes)/(r/1e3);this.finalBitrateSum+=e,this.bitRateSampels+=1,this.lastReceivedPayloadBytes=this.recievedPayloadBytes,this.lastBitrateMeasureTime=t}if(this.stopSending&&this.sentPayloadBytes===this.recievedPayloadBytes){const e=this.finalBitrateSum/this.bitRateSampels;this.testComplete({throughput:Math.round(.001*e)})}}testComplete(e){this.call.getRoundTripTime().then((({rtt:t,backendRTT:r})=>super.testComplete({RTT:t,backendRTT:r,throughput:e.throughput})))}onRecieverChannel(e){this.recieveChannel=e.channel,this.recieveChannel.addEventListener("message",this.onMessageRecieved.bind(this))}}class Qr extends Jr{constructor(e,t=zr.noFilter){super(e),Kt(this,"ch1"),Kt(this,"ch2"),this.call.setIceCandidateFilter(t);const r=this.call.pc1.createDataChannel(null);this.ch1=r,r.addEventListener("open",(()=>{r.send("hello")})),r.addEventListener("message",this.onCh1Recieve.bind(this)),this.call.pc2.addEventListener("datachannel",this.dataChannelHandler.bind(this))}onCh1Recieve(e){"world"!==e.data?this.hangup("Invalid data transmitted."):this.testComplete({connectivity:!0})}onCh2Recieve(e){if("hello"!==e.data)this.hangup("Invalid data transmitted.");else try{this.ch2.send("world")}catch(e){}}dataChannelHandler(e){const t=e.channel;this.ch2=t,t.addEventListener("message",this.onCh2Recieve.bind(this))}hangup(e){this.testFailed(e)}}class Yr extends Qr{constructor(e){super(e,zr.isHost)}}class Xr extends Qr{constructor(e){super(e,zr.isRelay)}}class Zr extends Qr{constructor(e){super(e,zr.isReflexive)}}const en=new class{constructor(){Kt(this,"ipInformation",null)}getIPDetails(e){return tr(this,arguments,(function*({peerId:e,apiHostnames:t}){var r;if(!this.ipInformation){try{const e=`https://${t.location}`,n=yield(yield fetch(e)).json();if((null==(r=n.loc)?void 0:r.length)>5)return this.ipInformation=n,n;throw Error("Insufficient data")}catch(e){}const n=yield fetch(`https://${t.locationLegacy}/?token=3c493932b0624c&peerId=${e}`,{method:"POST"});this.ipInformation=yield n.json()}return this.ipInformation}))}},tn=[{urls:"turn:turn.dyte.in:443?transport=tcp",username:"dyte",credential:"dytein",credentialType:"password"},{urls:"turn:turn.dyte.in:3478?transport=udp",username:"dyte",credential:"dytein",credentialType:"password"}];function rn(e){const[t,r]=e.split(",");return{coords:{latitude:Number(t),longitude:Number(r)}}}class nn{constructor(){Kt(this,"transport"),Kt(this,"candidatePair"),Kt(this,"outboundVideoRtp",new Map),Kt(this,"inboundVideoRtp",new Map),Kt(this,"outboundAudioRtp",new Map),Kt(this,"inboundAudioRtp",new Map),Kt(this,"remoteInboundRtp",new Map),Kt(this,"producerStreamMap",new Map),Kt(this,"consumerStreamMap",new Map),Kt(this,"staleProducerStreamMap",!1),Kt(this,"staleConsumerStreamMap",!1)}}class sn extends Rr{constructor(){super(),Kt(this,"observer"),Kt(this,"outboundProducerMap",new Map),Kt(this,"inboundConsumerMap",new Map),Kt(this,"consumerPeerIdMap",new Map),Kt(this,"pausedConsumerMap",new Map),Kt(this,"pausedProducerMap",new Map),Kt(this,"overallProducingTransportsStatsMap",{}),Kt(this,"overallConsumingTransportsStatsMap",{}),Kt(this,"overallConsumersStatsMap",{}),Kt(this,"overallProducersStatsMap",{}),Kt(this,"videoProducerToStatsMap",new Map),Kt(this,"audioProducerToStatsMap",new Map),Kt(this,"videoConsumerToStatsMap",new Map),Kt(this,"audioConsumerToStatsMap",new Map),Kt(this,"consumerIdsWithFreezedVideo",new Set),Kt(this,"consumerIdsWithFreezedAudio",new Set),Kt(this,"producerIdsWithFreezedVideo",new Set),Kt(this,"producerIdsWithFreezedAudio",new Set),Kt(this,"freezedProducingTransportIds",new Set),Kt(this,"freezedConsumingTransportIds",new Set),Kt(this,"screenShareProducers",new Set),Kt(this,"screenShareConsumers",new Set),Kt(this,"ipDetails"),Kt(this,"callStatsInstance"),this.observer=new Rr}registerProducer(e){return tr(this,null,(function*(){yield this.generateProducerStreamMap(e),e.observer.on("close",this.deregisterProducer.bind(this,e)),e.observer.on("pause",this.pauseProducer.bind(this,e.id)),e.observer.on("resume",this.resumeProducer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareProducers.add(e.id)}))}pauseProducer(e){this.pausedProducerMap.set(e,{lastReportCalculated:!1})}resumeProducer(e){this.pausedProducerMap.delete(e)}processInboundConsumerVideoStats(e,t,r){var n,i;const s=(null==(i=null==(n=null==this?void 0:this.callStatsInstance)?void 0:n.consumerSharedMediaStatesMap)?void 0:i.get(e))||{};t.totalVideoPacketsReceived===r.packetsReceived?(this.consumerIdsWithFreezedVideo.add(e),this.callStatsInstance&&s.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoFreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_video_status","pause",e))):(t.totalVideoPacketsReceived=r.packetsReceived,this.consumerIdsWithFreezedVideo.has(e)&&(this.consumerIdsWithFreezedVideo.delete(e),this.callStatsInstance&&s.video&&(this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoDefreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_video_status","resume",e))))}processInboundConsumerAudioStats(e,t,r){var n,i;const s=(null==(i=null==(n=null==this?void 0:this.callStatsInstance)?void 0:n.consumerSharedMediaStatesMap)?void 0:i.get(e))||{};t.totalAudioPacketsReceived===r.packetsReceived?(this.consumerIdsWithFreezedAudio.add(e),this.callStatsInstance&&s.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioFreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","pause",e))):(t.totalAudioPacketsReceived=r.packetsReceived,this.consumerIdsWithFreezedAudio.has(e)&&(this.consumerIdsWithFreezedAudio.delete(e),this.callStatsInstance&&s.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioDefreezed",{consumerId:e}),this.callStatsInstance.eventHandler.emit("consumer_audio_status","resume",e))))}processOutboundProducerVideoStats(e,t,r){var n;const i=(null==(n=null==this?void 0:this.callStatsInstance)?void 0:n.currentUserMediaStates)||{};t.totalVideoPacketsSent===r.packetsSent?(this.producerIdsWithFreezedVideo.add(e),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoFreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_video_status","pause",e))):(t.totalVideoPacketsSent=r.packetsSent,this.producerIdsWithFreezedVideo.has(e)&&(this.producerIdsWithFreezedVideo.delete(e),this.callStatsInstance&&i.video&&(this.callStatsInstance.logger.debug("callStats::measurements::producerVideoDefreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_video_status","resume",e))))}processOutboundProducerAudioStats(e,t,r){var n;const i=(null==(n=null==this?void 0:this.callStatsInstance)?void 0:n.currentUserMediaStates)||{};t.totalAudioPacketsSent===r.packetsSent?(this.producerIdsWithFreezedAudio.add(e),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioFreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_audio_status","pause",e))):(t.totalAudioPacketsSent=r.packetsSent,this.producerIdsWithFreezedAudio.has(e)&&(this.producerIdsWithFreezedAudio.delete(e),this.callStatsInstance&&i.audio&&(this.callStatsInstance.logger.debug("callStats::measurements::producerAudioDefreezed",{producerId:e}),this.callStatsInstance.eventHandler.emit("producer_audio_status","resume",e))))}processProducingTransportStats(e,t,r){var n;const i=(null==(n=null==this?void 0:this.callStatsInstance)?void 0:n.currentUserMediaStates)||{},{audio:s,video:o,screen:a}=i,c=s||o||a;t.totalPacketsSent===r.packetsSent?(this.freezedProducingTransportIds.add(e),this.callStatsInstance&&c&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportFreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("producing_transport_status","pause",e))):(t.totalPacketsSent=r.packetsSent,this.freezedProducingTransportIds.has(e)&&(this.freezedProducingTransportIds.delete(e),this.callStatsInstance&&c&&(this.callStatsInstance.logger.debug("callStats::measurements::producingTransportDefreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("producing_transport_status","resume",e))))}processConsumingTransportStats(e,t,r){var n,i;const s=!!Array.from((null==(i=null==(n=null==this?void 0:this.callStatsInstance)?void 0:n.consumerSharedMediaStatesMap)?void 0:i.values())||[]).reduce(((e,t)=>e||t.audio||t.video||t.screen),!1);t.totalPacketsReceived===r.packetsSent?(this.freezedConsumingTransportIds.add(e),this.callStatsInstance&&s&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportFreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","pause",e))):(t.totalPacketsReceived=r.packetsSent,this.freezedConsumingTransportIds.has(e)&&(this.freezedConsumingTransportIds.delete(e),this.callStatsInstance&&s&&(this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportDefreezed",{transportId:e}),this.callStatsInstance.eventHandler.emit("consuming_transport_status","resume",e))))}registerConsumer(e){return tr(this,null,(function*(){yield this.generateConsumerStreamMap(e),this.consumerPeerIdMap.set(e.id,{producerId:e.producerId,peerId:e.appData.peerId,appData:e.appData}),e.observer.on("close",this.deregisterConsumer.bind(this,e)),e.observer.on("pause",this.pauseConsumer.bind(this,e.id)),e.observer.on("resume",this.resumeConsumer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareConsumers.add(e.id)}))}pauseConsumer(e){this.pausedConsumerMap.set(e,{lastReportCalculated:!1})}resumeConsumer(e){this.pausedConsumerMap.delete(e)}generateProducerStreamMap(e,t=!1){return tr(this,null,(function*(){const r=yield e.getStats(),n=t?this.getProducerStatsFromReport(this.parseRTCReport(r,["outbound-rtp","remote-inbound-rtp"],!1,e.id))[0]:void 0;for(const t of r.values())"outbound-rtp"===t.type&&this.outboundProducerMap.set(t.id,e.id);return n}))}generateConsumerStreamMap(e,t=!1){return tr(this,null,(function*(){const r=yield e.getStats(),n=t?this.getConsumerStatsFromReport(this.parseRTCReport(r,["inbound-rtp"],!1,e.id))[0]:void 0;for(const t of r.values())"inbound-rtp"===t.type&&this.inboundConsumerMap.set(t.id,e.id);return n}))}deregisterProducer(e){this.outboundProducerMap.forEach(((t,r)=>{t===e.id&&this.outboundProducerMap.delete(r)})),this.pausedProducerMap.delete(e.id),this.screenShareProducers.delete(e.id)}deregisterConsumer(e){this.inboundConsumerMap.forEach(((t,r)=>{t===e.id&&this.inboundConsumerMap.delete(r)})),this.consumerPeerIdMap.delete(e.id),this.pausedConsumerMap.delete(e.id),this.screenShareConsumers.delete(e.id)}getIceCandidateStats(e){var t;return{id:e.id,type:e.candidateType||e.type,address:e.address,port:e.port,url:e.url,protocol:null!=(t=e.relayProtocol)?t:e.protocol,networkType:e.networkType,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort}}getWorkingSimulcastVideoStats(e){return e.find((e=>{const t=e.framesEncoded>0,r=e.packetsSent>0,n=e.frameWidth&&e.frameHeight;return t&&r&&!!n}))||e[e.length-1]}parseRTCReport(e,t=[],r=!1,n=void 0,i=void 0){var s,o,a,c,d,l,u;const h=e,p=new nn,m=t.length?new Set(t):void 0,f=[],g=[],v=[],y=new Map,_=new Map;for(const e of h.values()){if(m){if(0===m.size)break;if(!m.has(e.type))continue;r&&m.delete(e.type)}switch(e.type){case"local-candidate":f.push(this.getIceCandidateStats(e));break;case"remote-candidate":g.push(this.getIceCandidateStats(e));break;case"candidate-pair":{const{nominated:t}=e,{selected:r}=e,n=e,i={nominated:null!=t?t:r,currentRoundTripTime:n.currentRoundTripTime,totalRoundTripTime:n.totalRoundTripTime,bytesReceived:n.bytesReceived,bytesSent:n.bytesSent,availableOutgoingBitrate:n.availableOutgoingBitrate,lastPacketReceivedTimestamp:n.lastPacketReceivedTimestamp,lastPacketSentTimestamp:n.lastPacketSentTimestamp,localCandidateId:n.localCandidateId,remoteCandidateId:n.remoteCandidateId,bytesDiscardedOnSend:n.bytesDiscardedOnSend,packetsSent:n.packetsSent,packetsReceived:n.packetsReceived,packetsDiscardedOnSend:n.packetsDiscardedOnSend};v.push(i),(!0===e.nominated||!0===e.selected)&&(p.candidatePair=i);break}case"transport":{const t=e;i&&(i.producing&&(this.overallProducingTransportsStatsMap[i.id]||(this.overallProducingTransportsStatsMap[i.id]={totalPacketsSent:0})),i.consuming&&(this.overallConsumingTransportsStatsMap[i.id]||(this.overallConsumingTransportsStatsMap[i.id]={totalPacketsReceived:0})));const r={bytesReceived:t.bytesReceived,bytesSent:t.bytesSent,packetsSent:t.packetsSent,packetsReceived:t.packetsReceived,dtlsCipher:t.dtlsCipher,dtlsState:t.dtlsState,iceRole:t.iceRole};if(p.transport=r,i){if(i.producing){const e=this.overallProducingTransportsStatsMap[i.id];this.processProducingTransportStats(i.id,e,r)}if(i.consuming){const e=this.overallConsumingTransportsStatsMap[i.id];this.processConsumingTransportStats(i.id,e,r)}}break}case"remote-inbound-rtp":{const t=e,r={jitter:t.jitter,fractionLost:t.fractionLost,roundTripTime:t.roundTripTime,roundTripTimeMeasurements:t.roundTripTimeMeasurements,totalRoundTripTime:t.totalRoundTripTime,packetsLost:t.packetsLost};p.remoteInboundRtp.set(t.localId,r);break}case"outbound-rtp":{const t=e,r=n||this.outboundProducerMap.get(e.id),i=this.pausedProducerMap.get(r);if(i){if(!0===i.lastReportCalculated)break;this.pausedProducerMap.set(r,{lastReportCalculated:!0})}this.overallProducersStatsMap[r]||(this.overallProducersStatsMap[r]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const o=this.overallProducersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.outboundProducerMap.has(e.id)){p.staleProducerStreamMap=!0;break}const n=this.callStatsInstance.producers.get(r);if("ended"===(null==(s=null==n?void 0:n.track)?void 0:s.readyState))break;p.producerStreamMap.has(r)||p.producerStreamMap.set(r,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const i={bytesSent:t.bytesSent,packetsSent:t.packetsSent,nackCount:t.nackCount,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const n=t,s=$t({frameHeight:n.frameHeight,frameWidth:n.frameWidth,framesEncoded:n.framesEncoded,framesDropped:n.framesDropped,framesPerSecond:n.framesPerSecond,framesSent:n.framesSent,keyFramesEncoded:n.keyFramesEncoded,firCount:n.firCount,encoderImplementation:n.encoderImplementation,hugeFramesSent:n.hugeFramesSent,pliCount:n.pliCount,qpSum:n.qpSum,qualityLimitationDurations:n.qualityLimitationDurations,qualityLimitationReason:n.qualityLimitationReason,qualityLimitationResolutionChanges:n.qualityLimitationResolutionChanges,totalEncodeTime:n.targetBitrate,totalPacketSendDelay:n.totalPacketSendDelay,retransmittedBytesSent:n.retransmittedBytesSent,retransmittedPacketsSent:n.retransmittedPacketsSent},i);this.videoProducerToStatsMap.set(r,s),p.outboundVideoRtp.set(e.id,s),p.producerStreamMap.get(r).outboundVideoRtpId.push(e.id),this.processOutboundProducerVideoStats(r,o,s)}else if("audio"===t.mediaType||"audio"===t.kind){const n=t,s=$t({retransmittedBytesSent:n.retransmittedBytesSent,retransmittedPacketsSent:n.retransmittedPacketsSent},i);this.audioProducerToStatsMap.set(r,s),p.outboundAudioRtp.set(e.id,s),p.producerStreamMap.get(r).outboundAudioRtpId.push(e.id),this.processOutboundProducerAudioStats(r,o,s)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}case"inbound-rtp":{const t=e,r=n||this.inboundConsumerMap.get(e.id),i=this.pausedConsumerMap.get(r);if(i){if(!0===i.lastReportCalculated)break;this.pausedConsumerMap.set(r,{lastReportCalculated:!0})}if(1234===t.ssrc)break;this.overallConsumersStatsMap[r]||(this.overallConsumersStatsMap[r]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const s=this.overallConsumersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.inboundConsumerMap.has(e.id)){p.staleConsumerStreamMap=!0;break}p.consumerStreamMap.has(r)||p.consumerStreamMap.set(r,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const n={bytesReceived:t.bytesReceived,packetsReceived:t.packetsReceived,packetsLost:t.packetsLost,jitter:t.jitter,nackCount:t.nackCount,jitterBufferDelay:t.jitterBufferDelay,jitterBufferEmittedCount:t.jitterBufferEmittedCount,lastPacketReceivedTimestamp:t.lastPacketReceivedTimestamp,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const i=t,d=$t({frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesDecoded:i.framesDecoded,framesDropped:i.framesDropped,framesPerSecond:i.framesPerSecond,framesReceived:i.framesReceived,keyFramesDecoded:i.keyFramesDecoded,firCount:i.firCount,decoderImplementation:i.decoderImplementation,pliCount:i.pliCount,totalProcessingDelay:i.totalProcessingDelay},n);d.score=$r({frameWidth:d.frameWidth||0,framesDecoded:(d.framesDecoded||0)-((null==(o=this.videoConsumerToStatsMap.get(r))?void 0:o.framesDecoded)||0),framesPerSecond:d.framesPerSecond||0,packetsLost:(d.packetsLost||0)-((null==(a=this.videoConsumerToStatsMap.get(r))?void 0:a.packetsLost)||0),packetsReceived:(d.packetsReceived||0)-((null==(c=this.videoConsumerToStatsMap.get(r))?void 0:c.packetsReceived)||0),jitter:d.jitter||0,isScreenShare:this.screenShareConsumers.has(r)}),_.set(r,d.score),this.videoConsumerToStatsMap.set(r,d),p.inboundVideoRtp.set(e.id,d),p.consumerStreamMap.get(r).inboundVideoRtpId.push(e.id),this.processInboundConsumerVideoStats(r,s,d)}else if("audio"===t.mediaType||"audio"===t.kind){const i=t,o=$t({audioLevel:i.audioLevel,concealedSampels:i.concealedSampels,concealmentEvents:i.concealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration,totalSamplesReceived:i.totalSamplesReceived},n);o.score=qr({concealmentEvents:(o.concealmentEvents||0)-((null==(d=this.audioConsumerToStatsMap.get(r))?void 0:d.concealmentEvents)||0),packetsLost:(o.packetsLost||0)-((null==(l=this.audioConsumerToStatsMap.get(r))?void 0:l.packetsLost)||0),packetsReceived:(o.packetsReceived||0)-((null==(u=this.audioConsumerToStatsMap.get(r))?void 0:u.packetsReceived)||0),jitter:o.jitter||0}),_.set(r,o.score),this.audioConsumerToStatsMap.set(r,o),p.inboundAudioRtp.set(e.id,o),p.consumerStreamMap.get(r).inboundAudioRtpId.push(e.id),this.processInboundConsumerAudioStats(r,s,o)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}}}if(p.producerStreamMap.forEach(((e,t)=>{var r,n,i,s,o,a,c,d,l,u,h;if(e.outboundVideoRtpId.length>0){const c=[];e.outboundVideoRtpId.forEach((e=>{c.push(p.outboundVideoRtp.get(e))}));const d=this.getWorkingSimulcastVideoStats(c);d.score=Wr({frameWidth:d.frameWidth||0,framesPerSecond:d.framesPerSecond||0,jitter:(null==(r=d.remoteData)?void 0:r.jitter)||0,isScreenShare:this.screenShareProducers.has(t),packetsSent:(d.packetsSent||0)-((null==(n=this.videoProducerToStatsMap.get(t))?void 0:n.packetsSent)||0),packetsLost:((null==(i=d.remoteData)?void 0:i.packetsLost)||0)-((null==(o=null==(s=this.videoProducerToStatsMap.get(t))?void 0:s.remoteData)?void 0:o.packetsLost)||0),framesEncoded:(d.framesEncoded||0)-((null==(a=this.videoProducerToStatsMap.get(t))?void 0:a.framesEncoded)||0)}),y.set(t,d.score)}else if(e.outboundAudioRtpId.length>0){const r=p.outboundAudioRtp.get(e.outboundAudioRtpId[0]);r.score=Hr({packetsSent:(r.packetsSent||0)-((null==(c=this.audioProducerToStatsMap.get(t))?void 0:c.packetsSent)||0),packetsLost:((null==(d=r.remoteData)?void 0:d.packetsLost)||0)-((null==(u=null==(l=this.audioProducerToStatsMap.get(t))?void 0:l.remoteData)?void 0:u.packetsLost)||0),jitter:(null==(h=r.remoteData)?void 0:h.jitter)||0}),y.set(t,r.score)}})),v.forEach((e=>{const t=f.find((t=>t.id===e.localCandidateId?(e.localCandidateId=t.id,t):null)),r=g.find((t=>t.id===e.remoteCandidateId?(e.remoteCandidateId=t.id,t):null));t&&(e.localCandidateType=t.type,e.localCandidateAddress=t.address,e.localCandidatePort=t.port,e.localCandidateProtocol=t.protocol,e.localCandidateUrl=t.url,e.localCandidateNetworkType=t.networkType,e.localCandidateRelatedAddress=t.relatedAddress,e.localCandidateRelatedPort=t.relatedPort),r&&(e.remoteCandidateType=r.type,e.remoteCandidateAddress=r.address,e.remoteCandidatePort=r.port,e.remoteCandidateProtocol=r.protocol,e.remoteCandidateUrl=r.url)})),p.candidatePair&&(p.transport?(p.transport.totalRoundTripTime=p.candidatePair.totalRoundTripTime,p.transport.availableOutgoingBitrate=p.candidatePair.availableOutgoingBitrate,p.transport.roundTripTime=p.candidatePair.currentRoundTripTime):p.transport={bytesReceived:p.candidatePair.bytesReceived,bytesSent:p.candidatePair.bytesSent,totalRoundTripTime:p.candidatePair.totalRoundTripTime,availableOutgoingBitrate:p.candidatePair.availableOutgoingBitrate,roundTripTime:p.candidatePair.currentRoundTripTime}),p.transport&&(p.transport.candidatePairs=v),p.transport&&!p.transport.roundTripTime){let e=0,t=0;p.remoteInboundRtp.forEach(((r,n)=>{r.roundTripTime&&r.roundTripTime>e&&(e=r.roundTripTime,t=r.totalRoundTripTime)})),p.transport.roundTripTime=e,p.transport.totalRoundTripTime=t}return _.size>0&&this.observer.safeEmit("consumer_score",_),y.size>0&&this.observer.safeEmit("producer_score",y),p}getProducersReport(e){return tr(this,null,(function*(){const t=e.map((e=>this.generateProducerStreamMap(e,!0)));return t.length>0?Promise.all(t):void 0}))}getConsumersReport(e){return tr(this,null,(function*(){const t=e.map((e=>this.generateConsumerStreamMap(e,!0)));return t.length>0?Promise.all(t):void 0}))}getTransportReport(e){return tr(this,null,(function*(){return e.getStats()}))}getProcessedStats(e,t,r){return tr(this,null,(function*(){const n=yield this.getTransportReport(e),i={producing:r,consuming:t,id:e.id},s=n,o=this.parseRTCReport(s,["transport","candidate-pair","inbound-rtp","outbound-rtp","remote-inbound-rtp","local-candidate","remote-candidate"],!1,void 0,i);if(o)return{transportReport:{stats:o.transport,transportId:e.id,consuming:t,producing:r},producerReport:o.staleProducerStreamMap?void 0:this.getProducerStatsFromReport(o),consumerReport:o.staleConsumerStreamMap?void 0:this.getConsumerStatsFromReport(o)}}))}getProducerStatsFromReport(e){const t=[];try{e.producerStreamMap.forEach(((r,n)=>{var i,s;t.push({producerId:n,videoStats:r.outboundVideoRtpId.map((t=>e.outboundVideoRtp.get(t))),audioStats:r.outboundAudioRtpId.map((t=>e.outboundAudioRtp.get(t))),appData:(null==(s=null==(i=this.callStatsInstance.producers)?void 0:i.get(n))?void 0:s.appData)||null})}))}catch(e){this.callStatsInstance.logger.error("callStats::measurements::getProducerStatsFromReport",{error:{reason:e.reason,message:e.message}})}return t}getConsumerStatsFromReport(e){const t=[];try{e.consumerStreamMap.forEach(((r,n)=>{const{peerId:i,producerId:s,appData:o}=this.consumerPeerIdMap.get(n);t.push({consumerId:n,peerId:i,producerId:s,appData:o,videoStats:r.inboundVideoRtpId.map((t=>e.inboundVideoRtp.get(t))),audioStats:r.inboundAudioRtpId.map((t=>e.inboundAudioRtp.get(t)))})}))}catch(t){console.error("getConsumersReport: ",t,e)}return t}getUserLocation(){return tr(this,null,(function*(){return new Promise(((e,t)=>{try{navigator.geolocation?navigator.geolocation.getCurrentPosition((t=>{e(t)})):t()}catch(e){t(e)}}))}))}getConnectivity(e){return tr(this,null,(function*(){try{const t={iceServers:e||tn},r=new Promise(((e,r)=>{try{const r=new Yr(t);r.addListener("done",e),r.addListener("failed",(()=>{e({connectivity:!1})})),r.start(2e3)}catch(e){r(e)}})),n=new Promise(((e,r)=>{try{const r=new Xr(t);r.addListener("done",e),r.addListener("failed",(()=>{e({connectivity:!1})})),r.start(2e3)}catch(e){r(e)}})),i=new Promise(((e,r)=>{try{const r=new Zr(t);r.addListener("done",e),r.addListener("failed",(()=>{e({connectivity:!1})})),r.start(2e3)}catch(e){r(e)}})),[s,o,a]=yield Promise.all([r,n,i]);return{host:null==s?void 0:s.connectivity,relay:null==o?void 0:o.connectivity,reflexive:null==a?void 0:a.connectivity}}catch(e){return{host:!1,relay:!1,reflexive:!1}}}))}getThroughput(e){return tr(this,null,(function*(){try{const t=yield new Promise(((t,r)=>{try{const n=new Kr({iceServers:e||tn});n.addListener("done",t),n.addListener("failed",r),n.start(1e4)}catch(e){r(e)}}));return{throughput:t.throughput,fractionalLoss:0,RTT:t.RTT,jitter:0,backendRTT:t.backendRTT}}catch(e){return}}))}getIPDetails(){return tr(this,null,(function*(){var e,t;try{return this.ipDetails||(this.ipDetails=yield en.getIPDetails({peerId:null==(e=this.callStatsInstance)?void 0:e.peerId,apiHostnames:null==(t=this.callStatsInstance)?void 0:t.apiHostnames})),this.ipDetails}catch(e){return}}))}getNetworkQuality(e){return tr(this,null,(function*(){const[t,r]=yield Promise.all([this.getConnectivity(e),this.getThroughput(e)]);return{connectivity:t,throughput:null==r?void 0:r.throughput,fractionalLoss:null==r?void 0:r.fractionalLoss,RTT:null==r?void 0:r.RTT,jitter:null==r?void 0:r.jitter,backendRTT:null==r?void 0:r.backendRTT}}))}getNetworkInfo(e,t=!1){return tr(this,null,(function*(){var r,n;if(t){const e=yield this.getIPDetails();return{ipDetails:e,effectiveNetworkType:null==(r=navigator.connection)?void 0:r.effectiveType,location:e.loc?rn(e.loc):void 0}}const[i,s,o]=yield Promise.all([this.getConnectivity(e),this.getThroughput(e),this.getIPDetails()]);return{ipDetails:o,effectiveNetworkType:null==(n=navigator.connection)?void 0:n.effectiveType,location:o.loc?rn(o.loc):void 0,turnConnectivity:!!i&&(i.host||i.relay||i.reflexive),connectivity:i,throughput:null==s?void 0:s.throughput,fractionalLoss:null==s?void 0:s.fractionalLoss,RTT:null==s?void 0:s.RTT,jitter:null==s?void 0:s.jitter,backendRTT:null==s?void 0:s.backendRTT}}))}}class on extends sn{}class an extends sn{constructor(){super(...arguments),Kt(this,"producerMap",new Map),Kt(this,"consumerMap",new Map)}registerProducer(e){return tr(this,null,(function*(){this.producerMap.set(e.id,e),yield this.generateProducerStreamMap(e),e.observer.on("close",this.deregisterProducer.bind(this,e)),e.observer.on("pause",this.pauseProducer.bind(this,e.id)),e.observer.on("resume",this.resumeProducer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareProducers.add(e.id)}))}registerConsumer(e){return tr(this,null,(function*(){this.consumerMap.set(e.id,e),yield this.generateConsumerStreamMap(e),this.consumerPeerIdMap.set(e.id,{producerId:e.producerId,peerId:e.appData.peerId,appData:e.appData}),e.observer.on("close",this.deregisterConsumer.bind(this,e)),e.observer.on("pause",this.pauseConsumer.bind(this,e.id)),e.observer.on("resume",this.resumeConsumer.bind(this,e.id)),!0===e.appData.screenShare&&this.screenShareConsumers.add(e.id)}))}generateConsumerStreamMap(e,t=!1){return tr(this,null,(function*(){const r=yield e.getStats(),n=this.parseRTCReport(r,["inbound-rtp"],!1,e.id),i=[...n.consumerStreamMap.values()][0],s=t?this.getConsumerStatsFromParsedConsumerStats(n,i,e.id):void 0;for(const t of r.values())"inbound-rtp"===t.type&&this.inboundConsumerMap.set(t.id,e.id);return s}))}deregisterProducer(e){this.producerMap.delete(e.id),this.outboundProducerMap.forEach(((t,r)=>{t===e.id&&this.outboundProducerMap.delete(r)})),this.pausedProducerMap.delete(e.id),this.screenShareProducers.delete(e.id)}deregisterConsumer(e){this.consumerMap.delete(e.id),this.inboundConsumerMap.forEach(((t,r)=>{t===e.id&&this.inboundConsumerMap.delete(r)})),this.consumerPeerIdMap.delete(e.id),this.pausedConsumerMap.delete(e.id),this.screenShareConsumers.delete(e.id)}getIceCandidateStats(e){var t;return{id:e.id,type:e.candidateType||e.type,address:e.address,port:e.port,url:e.url,protocol:null!=(t=e.relayProtocol)?t:e.protocol,networkType:e.networkType,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort}}parseRTCReport(e,t=[],r=!1,n=void 0,i=void 0){var s,o,a,c,d,l,u;const h=e,p=new nn,m=t.length?new Set(t):void 0,f=[],g=[],v=[],y=new Map,_=new Map;for(const e of h.values()){if(m){if(0===m.size)break;if(!m.has(e.type))continue;r&&m.delete(e.type)}switch(e.type){case"local-candidate":f.push(this.getIceCandidateStats(e));break;case"remote-candidate":g.push(this.getIceCandidateStats(e));break;case"candidate-pair":{const{nominated:t}=e,{selected:r}=e,n=e,i={nominated:null!=t?t:r,currentRoundTripTime:n.currentRoundTripTime,totalRoundTripTime:n.totalRoundTripTime,bytesReceived:n.bytesReceived,bytesSent:n.bytesSent,availableOutgoingBitrate:n.availableOutgoingBitrate,lastPacketReceivedTimestamp:n.lastPacketReceivedTimestamp,lastPacketSentTimestamp:n.lastPacketSentTimestamp,localCandidateId:n.localCandidateId,remoteCandidateId:n.remoteCandidateId,bytesDiscardedOnSend:n.bytesDiscardedOnSend,packetsSent:n.packetsSent,packetsReceived:n.packetsReceived,packetsDiscardedOnSend:n.packetsDiscardedOnSend};v.push(i),(!0===e.nominated||!0===e.selected)&&(p.candidatePair=i);break}case"transport":{const t=e;i&&(i.producing&&(this.overallProducingTransportsStatsMap[i.id]||(this.overallProducingTransportsStatsMap[i.id]={totalPacketsSent:0})),i.consuming&&(this.overallConsumingTransportsStatsMap[i.id]||(this.overallConsumingTransportsStatsMap[i.id]={totalPacketsReceived:0})));const r={bytesReceived:t.bytesReceived,bytesSent:t.bytesSent,packetsSent:t.packetsSent,packetsReceived:t.packetsReceived,dtlsCipher:t.dtlsCipher,dtlsState:t.dtlsState,iceRole:t.iceRole};if(p.transport=r,i){if(i.producing){const e=this.overallProducingTransportsStatsMap[i.id];this.processProducingTransportStats(i.id,e,r)}if(i.consuming){const e=this.overallConsumingTransportsStatsMap[i.id];this.processConsumingTransportStats(i.id,e,r)}}break}case"remote-inbound-rtp":{const t=e,r={jitter:t.jitter,fractionLost:t.fractionLost,roundTripTime:t.roundTripTime,roundTripTimeMeasurements:t.roundTripTimeMeasurements,totalRoundTripTime:t.totalRoundTripTime,packetsLost:t.packetsLost};p.remoteInboundRtp.set(t.localId,r);break}case"outbound-rtp":{const t=e,r=n||this.outboundProducerMap.get(e.id),i=this.pausedProducerMap.get(r);if(i){if(!0===i.lastReportCalculated)break;this.pausedProducerMap.set(r,{lastReportCalculated:!0})}this.overallProducersStatsMap[r]||(this.overallProducersStatsMap[r]={totalVideoPacketsSent:0,totalAudioPacketsSent:0});const o=this.overallProducersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.outboundProducerMap.has(e.id)){p.staleProducerStreamMap=!0;break}const n=this.callStatsInstance.producers.get(r);if("ended"===(null==(s=null==n?void 0:n.track)?void 0:s.readyState))break;p.producerStreamMap.has(r)||p.producerStreamMap.set(r,{outboundVideoRtpId:[],outboundAudioRtpId:[]});const i={bytesSent:t.bytesSent,packetsSent:t.packetsSent,nackCount:t.nackCount,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const n=t,s=$t({frameHeight:n.frameHeight,frameWidth:n.frameWidth,framesEncoded:n.framesEncoded,framesDropped:n.framesDropped?n.framesDropped:n.droppedFrames,framesPerSecond:n.framesPerSecond?n.framesPerSecond:n.framerateMean,framesSent:n.framesSent,keyFramesEncoded:n.keyFramesEncoded,firCount:n.firCount,encoderImplementation:n.encoderImplementation,hugeFramesSent:n.hugeFramesSent,pliCount:n.pliCount,qpSum:n.qpSum,qualityLimitationReason:n.qualityLimitationReason,qualityLimitationDurations:n.qualityLimitationDurations,qualityLimitationResolutionChanges:n.qualityLimitationResolutionChanges,totalEncodeTime:n.totalEncodeTime,totalPacketSendDelay:n.totalEncodeTime,retransmittedBytesSent:n.retransmittedBytesSent,retransmittedPacketsSent:n.retransmittedPacketsSent},i);this.videoProducerToStatsMap.set(e.id,s),p.outboundVideoRtp.set(e.id,s),p.producerStreamMap.get(r).outboundVideoRtpId.push(e.id),this.processOutboundProducerVideoStats(r,o,s)}else if("audio"===t.mediaType||"audio"===t.kind){const n=t,s=$t({retransmittedBytesSent:n.retransmittedBytesSent,retransmittedPacketsSent:n.retransmittedPacketsSent},i);this.audioProducerToStatsMap.set(e.id,s),p.outboundAudioRtp.set(e.id,s),p.producerStreamMap.get(r).outboundAudioRtpId.push(e.id),this.processOutboundProducerAudioStats(r,o,s)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Outbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}case"inbound-rtp":{const t=e,r=n||this.inboundConsumerMap.get(e.id),i=this.pausedConsumerMap.get(r);if(i){if(!0===i.lastReportCalculated)break;this.pausedConsumerMap.set(r,{lastReportCalculated:!0})}if(1234===t.ssrc)break;this.overallConsumersStatsMap[r]||(this.overallConsumersStatsMap[r]={totalVideoPacketsReceived:0,totalAudioPacketsReceived:0});const s=this.overallConsumersStatsMap[r];if(["video","audio"].includes(t.mediaType)||["video","audio"].includes(t.kind)){if(!this.inboundConsumerMap.has(e.id)){p.staleConsumerStreamMap=!0;break}p.consumerStreamMap.has(r)||p.consumerStreamMap.set(r,{inboundVideoRtpId:[],inboundAudioRtpId:[]});const n={bytesReceived:t.bytesReceived,packetsReceived:t.packetsReceived,packetsLost:t.packetsLost,jitter:t.jitter,nackCount:t.nackCount,jitterBufferDelay:t.jitterBufferDelay,jitterBufferEmittedCount:t.jitterBufferEmittedCount,lastPacketReceivedTimestamp:t.lastPacketReceivedTimestamp,ssrc:t.ssrc,mid:t.mid};if("video"===t.mediaType||"video"===t.kind){if("unknown"===t.decoderImplementation)break;const i=t,d=$t({frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesDecoded:i.framesDecoded,framesDropped:i.framesDropped?i.framesDropped:i.droppedFrames,framesPerSecond:i.framesPerSecond?i.framesPerSecond:i.framerateMean,framesReceived:i.framesReceived,keyFramesDecoded:i.keyFramesDecoded,firCount:i.firCount,decoderImplementation:i.decoderImplementation,pliCount:i.pliCount,totalProcessingDelay:i.totalProcessingDelay},n);d.score=$r({frameWidth:d.frameWidth||0,framesDecoded:(d.framesDecoded||0)-((null==(o=this.videoConsumerToStatsMap.get(r))?void 0:o.framesDecoded)||0),framesPerSecond:d.framesPerSecond||0,packetsLost:(d.packetsLost||0)-((null==(a=this.videoConsumerToStatsMap.get(r))?void 0:a.packetsLost)||0),packetsReceived:(d.packetsReceived||0)-((null==(c=this.videoConsumerToStatsMap.get(r))?void 0:c.packetsReceived)||0),jitter:d.jitter||0,isScreenShare:this.screenShareConsumers.has(r)}),_.set(r,d.score),this.videoConsumerToStatsMap.set(r,d),p.inboundVideoRtp.set(e.id,d),p.consumerStreamMap.get(r).inboundVideoRtpId.push(e.id),this.processInboundConsumerVideoStats(r,s,d)}else if("audio"===t.mediaType||"audio"===t.kind){const i=t,o=$t({audioLevel:i.audioLevel,concealedSampels:i.concealedSampels,concealmentEvents:i.concealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration,totalSamplesReceived:i.totalSamplesReceived},n);o.score=qr({concealmentEvents:(o.concealmentEvents||0)-((null==(d=this.audioConsumerToStatsMap.get(r))?void 0:d.concealmentEvents)||0),packetsLost:(o.packetsLost||0)-((null==(l=this.audioConsumerToStatsMap.get(r))?void 0:l.packetsLost)||0),packetsReceived:(o.packetsReceived||0)-((null==(u=this.audioConsumerToStatsMap.get(r))?void 0:u.packetsReceived)||0),jitter:o.jitter||0}),_.set(r,o.score),this.audioConsumerToStatsMap.set(r,o),p.inboundAudioRtp.set(e.id,o),p.consumerStreamMap.get(r).inboundAudioRtpId.push(e.id),this.processInboundConsumerAudioStats(r,s,o)}}else this.callStatsInstance.logger.error(`Callstats: Unknown Inbound-rtp. mediatype: ${t.mediaType} kind: ${t.kind}`);break}}}if(p.producerStreamMap.forEach(((e,t)=>{var r,n,i,s,o,a,c,d,l,u,h;if(e.outboundVideoRtpId.length>0){const c=[];e.outboundVideoRtpId.forEach((e=>{c.push(p.outboundVideoRtp.get(e))}));const d=this.getWorkingSimulcastVideoStats(c);d.score=Wr({frameWidth:d.frameWidth||0,framesPerSecond:d.framesPerSecond||0,jitter:(null==(r=d.remoteData)?void 0:r.jitter)||0,isScreenShare:this.screenShareProducers.has(t),packetsSent:(d.packetsSent||0)-((null==(n=this.videoProducerToStatsMap.get(t))?void 0:n.packetsSent)||0),packetsLost:((null==(i=d.remoteData)?void 0:i.packetsLost)||0)-((null==(o=null==(s=this.videoProducerToStatsMap.get(t))?void 0:s.remoteData)?void 0:o.packetsLost)||0),framesEncoded:(d.framesEncoded||0)-((null==(a=this.videoProducerToStatsMap.get(t))?void 0:a.framesEncoded)||0)}),y.set(t,d.score)}else if(e.outboundAudioRtpId.length>0){const r=p.outboundAudioRtp.get(e.outboundAudioRtpId[0]);r.score=Hr({packetsSent:(r.packetsSent||0)-((null==(c=this.audioProducerToStatsMap.get(t))?void 0:c.packetsSent)||0),packetsLost:((null==(d=r.remoteData)?void 0:d.packetsLost)||0)-((null==(u=null==(l=this.audioProducerToStatsMap.get(t))?void 0:l.remoteData)?void 0:u.packetsLost)||0),jitter:(null==(h=r.remoteData)?void 0:h.jitter)||0}),y.set(t,r.score)}})),v.forEach((e=>{const t=f.find((t=>t.id===e.localCandidateId?(e.localCandidateId=t.id,t):null)),r=g.find((t=>t.id===e.remoteCandidateId?(e.remoteCandidateId=t.id,t):null));t&&(e.localCandidateType=t.type,e.localCandidateAddress=t.address,e.localCandidatePort=t.port,e.localCandidateProtocol=t.protocol,e.localCandidateUrl=t.url,e.localCandidateNetworkType=t.networkType,e.localCandidateRelatedAddress=t.relatedAddress,e.localCandidateRelatedPort=t.relatedPort),r&&(e.remoteCandidateType=r.type,e.remoteCandidateAddress=r.address,e.remoteCandidatePort=r.port,e.remoteCandidateProtocol=r.protocol,e.remoteCandidateUrl=r.url)})),p.candidatePair&&(p.transport?(p.transport.bytesReceived=p.candidatePair.bytesReceived,p.transport.bytesSent=p.candidatePair.bytesSent,p.transport.totalRoundTripTime=p.candidatePair.totalRoundTripTime,p.transport.availableOutgoingBitrate=p.candidatePair.availableOutgoingBitrate,p.transport.roundTripTime=p.candidatePair.currentRoundTripTime):p.transport={bytesReceived:p.candidatePair.bytesReceived,bytesSent:p.candidatePair.bytesSent,totalRoundTripTime:p.candidatePair.totalRoundTripTime,availableOutgoingBitrate:p.candidatePair.availableOutgoingBitrate,roundTripTime:p.candidatePair.currentRoundTripTime}),p.transport&&(p.transport.candidatePairs=v),p.transport&&!p.transport.roundTripTime){let e=0,t=0;p.remoteInboundRtp.forEach(((r,n)=>{r.roundTripTime&&r.roundTripTime>e&&(e=r.roundTripTime,t=r.totalRoundTripTime)})),p.transport.roundTripTime=e,p.transport.totalRoundTripTime=t}return _.size>0&&this.observer.safeEmit("consumer_score",_),y.size>0&&this.observer.safeEmit("producer_score",y),p}getProducerStatsFromReport(e){const t=[];try{e.producerStreamMap.forEach(((r,n)=>{const i=this.producerMap.get(n),s=i.track.getSettings(),o=r.outboundVideoRtpId.map((t=>{const r=e.outboundVideoRtp.get(t);return r.frameHeight||(r.frameHeight=s.height,r.frameWidth=s.width,r.framesPerSecond=s.frameRate),r})),a={producerId:n,appData:i.appData,videoStats:o,audioStats:r.outboundAudioRtpId.map((t=>e.outboundAudioRtp.get(t)))};t.push(a)}))}catch(t){console.error("getProducersReport: ",t,e)}return t}getConsumerStatsFromParsedConsumerStats(e,t,r){let n;try{const{peerId:i,producerId:s,appData:o}=this.consumerPeerIdMap.get(r),a=null==t?void 0:t.inboundVideoRtpId.map((t=>{const n=this.consumerMap.get(r).track.getSettings(),i=e.inboundVideoRtp.get(t);return i.frameHeight||(i.frameHeight=n.height,i.frameWidth=n.width,i.framesPerSecond=n.frameRate),i}));n={consumerId:r,peerId:i,producerId:s,appData:o,videoStats:a,audioStats:null==t?void 0:t.inboundAudioRtpId.map((t=>e.inboundAudioRtp.get(t)))}}catch(t){console.error("getConsumerStatsFromParsedConsumerStats: ",t,e)}return n}getConsumerStatsFromReport(e){const t=[];try{e.consumerStreamMap.forEach(((r,n)=>{t.push(this.getConsumerStatsFromParsedConsumerStats(e,r,n))}))}catch(t){console.error("getConsumerStatsFromReport: ",t,e)}return t}}class cn extends an{}function dn(e,t,r,n){if(null!=e&&e.logger&&e.logger.error("Callstats::handleError",{error:n}),!("function"==typeof r&&n instanceof t))throw n;r.call(null,n,e)}function ln(e,t,r){const n=e.value;return e.value=function(...e){try{const i=n.apply(this,e);return i&&i instanceof Promise?i.catch((e=>{dn(this,t,r,e)})):i}catch(e){dn(this,t,r,e)}return null},e}const un=(e,t)=>(r,n,i)=>{const s=i.value;return i.value=function(...r){try{const n=s.apply(this,r);return n&&n instanceof Promise?n.catch((r=>{dn(this,e,t,r)})):n}catch(r){dn(this,e,t,r)}return null},i};var hn=globalThis&&globalThis.__decorate||function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const pn=console;let mn=class extends Rr{constructor(e="https://api.testingv3.dyte.in",t="Blink",r=Nr,n,i,s,o){switch(super(),Kt(this,"observer"),Kt(this,"eventHandler"),Kt(this,"measurements"),Kt(this,"producingTransport"),Kt(this,"consumingTransport"),Kt(this,"producers",new Map),Kt(this,"consumers",new Map),Kt(this,"iceServers"),Kt(this,"connectionInfoPromise"),Kt(this,"pingStatsTimeout"),Kt(this,"logger"),Kt(this,"env"),Kt(this,"apiHostnames"),Kt(this,"peerId"),Kt(this,"consumerSharedMediaStatesMap",new Map),Kt(this,"currentUserMediaStates",{}),this.env=r,this.apiHostnames=o,this.logger=i,this.peerId=s,this.eventHandler=new Or({logger:i,peerId:s,apiHostnames:o}),this.logger.debug("callStats::engineName: ",{engineName:t}),t){case"Blink":this.measurements=new on;break;case"Gecko":this.measurements=new an;break;case"WebKit":this.measurements=new cn;break;default:throw Error(`Unknown engineName! ${t}`)}this.measurements.callStatsInstance=this,this.registerProducer=this.registerProducer.bind(this),this.registerConsumer=this.registerConsumer.bind(this),this.observer=new Rr,this.measurements.observer.on("consumer_score",(e=>{i.debug(`callStats::consumer_score ${[...e.entries()]}`),this.eventHandler.emit("consumer_score",e)})),this.measurements.observer.on("producer_score",(e=>{i.debug(`callStats::producer_score ${[...e.entries()]}`),this.eventHandler.emit("producer_score",e)}))}registerIceServers(e){this.iceServers=e}registerConsumer(e){var t;this.consumerSharedMediaStatesMap.has(e.id)||this.consumerSharedMediaStatesMap.set(e.id,{}),this.consumers.set(e.id,e),this.measurements.registerConsumer(e),this.logger.debug("callStats::registerConsumer",{consumerId:e.id,consumerkind:e.kind,isScreenShare:!(null==(t=e.appData)||!t.screenShare)}),e.observer.on("close",this.deRegisterConsumer.bind(this,e))}registerProducer(e){var t;this.producers.set(e.id,e),this.measurements.registerProducer(e),this.logger.debug("callStats::registerProducer",{producerId:e.id,producerKind:e.kind,isScreenShare:!(null==(t=e.appData)||!t.screenShare)}),e.observer.on("close",this.deRegisterProducer.bind(this,e))}sendConsumerSharedMediaStateEvent(e,t){this.consumerSharedMediaStatesMap.has(e)||this.consumerSharedMediaStatesMap.set(e,{});const r=this.consumerSharedMediaStatesMap.get(e);this.consumerSharedMediaStatesMap.set(e,Object.assign(r,t))}registerProducingTransport(e){var t;this.producingTransport=e,e.observer.on("close",this.disconnectProducingTransport.bind(this,e)),e.observer.on("disconnect",this.disconnectProducingTransport.bind(this,e)),Array.from((null==(t=e._producers)?void 0:t.values())||[]).forEach((e=>{this.registerProducer(e)})),e.observer.on("newproducer",this.registerProducer)}registerConsumingTransport(e){var t;this.consumingTransport=e,e.observer.on("close",this.disconnectConsumingTransport.bind(this,e)),e.observer.on("disconnect",this.disconnectConsumingTransport.bind(this,e)),Array.from((null==(t=e._consumers)?void 0:t.values())||[]).forEach((e=>{this.registerConsumer(e)})),e.observer.on("newconsumer",this.registerConsumer)}deRegisterConsumer(e){this.consumers.delete(e.id)}deRegisterProducer(e){var t;this.producers.delete(e.id),this.logger.debug("callStats::deRegisterProducer",{producerId:e.id,producerKind:e.kind,isScreenShare:!(null==(t=e.appData)||!t.screenShare)})}disconnectConsumingTransport(){this.consumingTransport=void 0}disconnectProducingTransport(){this.producingTransport=void 0}callEvent(e){this.eventHandler.callEvent(e)}sendPreCallTestBeginEvent(e=!1){this.connectionInfoPromise=this.measurements.getNetworkInfo(this.iceServers,e),this.eventHandler.callEvent({event:Ar.PRECALL_TEST_BEGIN,timestamp:new Date}),this.connectionInfoPromise&&this.connectionInfoPromise.then((e=>{this.eventHandler.callEvent({event:Ar.PRECALL_TEST_COMPLETE,metaData:{connectionInfo:e},timestamp:new Date})}))}sendScreenShareToggleEvent(e,t){this.currentUserMediaStates.screen=e,this.eventHandler.callEvent({event:e?Ar.SCREENSHARE_STARTED:Ar.SCREENSHARE_STOPPED,metaData:{ssrc:t},timestamp:new Date})}sendScreenShareRequestedEvent(){this.eventHandler.callEvent({event:Ar.SCREENSHARE_START_REQUESTED,timestamp:new Date})}sendActiveSpeakerEvent(e){this.eventHandler.callEvent({event:Ar.DOMINANT_SPEAKER,metaData:{peerId:e},timestamp:new Date})}devices(e,t){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ar.AUDIO_DEVICES_UPDATES||e===xr.VIDEO&&Ar.VIDEO_DEVICES_UPDATES||e===xr.SPEAKER&&Ar.SPEAKER_DEVICES_UPDATES,metaData:{deviceList:t},timestamp:new Date})}selectedDevice(e,t){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ar.SELECTED_MICROHPONE_UPDATE||e===xr.VIDEO&&Ar.SELECTED_CAMERA_UPDATE||e===xr.SPEAKER&&Ar.SELECTED_SPEAKER_UPDATE,metaData:{device:t},timestamp:new Date})}mediaPermission(e,t){this.eventHandler.callEvent({event:Ar.MEDIA_PERMISSION,metaData:{deviceType:e,permission:t},timestamp:new Date})}mediaPlaybackFailed(e){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ar.AUDIO_PLAY_FAILED||e===xr.VIDEO&&Ar.VIDEO_PLAY_FAILED,metaData:{deviceType:e},timestamp:new Date})}mediaTrackMuted(e){this.eventHandler.callEvent({event:e===xr.AUDIO&&Ar.AUDIO_TRACK_MUTED||e===xr.VIDEO&&Ar.VIDEO_TRACK_MUTED,metaData:{deviceType:e},timestamp:new Date})}tabChanged(e){this.eventHandler.callEvent({event:Ar.TAB_CHANGE,metaData:{isMeetingsTabActive:e},timestamp:new Date})}browserBackgrounded(){this.eventHandler.callEvent({event:Ar.BROWSER_BACKGROUNDED,timestamp:new Date})}browserForegrounded(){this.eventHandler.callEvent({event:Ar.BROWSER_FOREGROUNDED,timestamp:new Date})}legacySwitch(e){this.eventHandler.callEvent({event:Ar.LEGACY_SWITCH,metadata:{on:e},timestamp:new Date})}getPreCallTestResults(){return tr(this,null,(function*(){return this.connectionInfoPromise}))}sendCallJoinBeginEvent(e){(e=zt($t({},e),{meetingEnv:this.env})).deviceInfo=zt($t({},e.deviceInfo),{userAgent:navigator.userAgent,cpus:navigator.hardwareConcurrency,memory:navigator.deviceMemory}),this.eventHandler.callEvent({event:Ar.CALL_JOIN_BEGIN,metaData:{peerMetaData:e},timestamp:new Date})}sendNetworkQualityTestBeginEvent(e){this.eventHandler.callEvent({event:Ar.NET_QUALITY_TEST_BEGIN,timestamp:new Date}),new Promise(((t,r)=>tr(this,null,(function*(){const n=[];try{for(const t of e)try{if(t.iceServers&&t.iceServers.length>0){const e=yield this.measurements.getNetworkQuality(t.iceServers);n.push(zt($t({},t),{networkResults:e}))}}catch(e){console.warn("Error handling ",e)}t({regionData:n})}catch(e){console.warn("Error in callstats, ",e),r(e)}})))).then((e=>{this.eventHandler.callEvent({event:Ar.NET_QUALITY_TEST_END,timestamp:new Date,metaData:e})}))}sendWebSocketConnectedEvent(){this.eventHandler.callEvent({event:Ar.WEBSOCKET_CONNECTED,timestamp:new Date})}sendTransportConnectedEvent(){this.eventHandler.callEvent({event:Ar.TRANSPORT_CONNECTED,timestamp:new Date})}sendAudioToggleEvent(e){let t;this.currentUserMediaStates.audio=e,t=e?Ar.AUDIO_ON:Ar.AUDIO_OFF,this.eventHandler.callEvent({event:t,timestamp:new Date})}sendVideoToggleEvent(e){let t;this.currentUserMediaStates.video=e,t=e?Ar.VIDEO_ON:Ar.VIDEO_OFF,this.eventHandler.callEvent({event:t,timestamp:new Date})}sendParticipantRoleToggleEvent(e){this.eventHandler.callEvent({event:Ar.PARTICIPANT_ROLE,timestamp:new Date,metaData:e})}startPingStats(e=7e3){this.sendPingStatsEvent(!1),this.pingStatsTimeout=setInterval(this.sendPingStatsEvent.bind(this),e)}stopPingStats(){clearInterval(this.pingStatsTimeout)}sendPingStatsEvent(e=!0){return tr(this,null,(function*(){let t,r;if(this.producingTransport&&(t=yield this.measurements.getProcessedStats(this.producingTransport,!1,!0),!t||null==t||!t.producerReport)){this.logger.debug("callStats::sendPingStatsEvent::staleProducingTransport",{disclaimer:"Stale producer? Regenerating Stream Maps!"});const e=yield this.measurements.getProducersReport([...this.producers.values()]);t&&e?t.producerReport=e:(t=yield this.measurements.getProcessedStats(this.producingTransport,!1,!0),(!t||null==t||!t.producerReport)&&this.logger.debug("callStats::sendPingStatsEvent::noProducingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}if(this.consumingTransport&&(r=yield this.measurements.getProcessedStats(this.consumingTransport,!0,!1),!r||!r.consumerReport)){this.logger.debug("callStats::sendPingStatsEvent::staleConsumingTransport",{disclaimer:"Stale consumer? Regenerating Stream Maps!"});const e=yield this.measurements.getConsumersReport([...this.consumers.values()]);r&&e?r.consumerReport=e:(r=yield this.measurements.getProcessedStats(this.consumingTransport,!0,!1),(!r||!r.consumerReport)&&this.logger.debug("callStats::sendPingStatsEvent::noConsumingTransportReport",{disclaimer:"Stream maps invalid despite regenerating!"}))}const n={producingTransportStats:t?null==t?void 0:t.transportReport:void 0,consumingTransportStats:r?null==r?void 0:r.transportReport:void 0,producerStats:[].concat((null==t?void 0:t.producerReport)||[]).concat((null==r?void 0:r.producerReport)||[]),consumerStats:[].concat((null==r?void 0:r.consumerReport)||[]).concat((null==t?void 0:t.consumerReport)||[])};e&&0===n.producerStats.length&&0===n.consumerStats.length?yield this.eventHandler.flush():this.eventHandler.callEvent({event:Ar.PING_STAT,metaData:n,timestamp:new Date})}))}sendIVSPlayerRebufferEvent(){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_REBUFFERING,timestamp:new Date})}sendIVSPlayerAudioBlockEvent(){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_AUDIO_BLOCKED,timestamp:new Date})}sendIVSPlayerPlaybackBlockedEvent(){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_PLAYBACK_BLOCKED,timestamp:new Date})}sendIVSPlayerNetworkUnavailableEvent(){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_NETWORK_UNAVAILABLE,timestamp:new Date})}sendIVSPlayerInitializedEvent(){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_INITIALIZED,timestamp:new Date})}sendIVSPlayerWorkerErrorEvent(){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_WORKER_ERROR,timestamp:new Date})}sendIVSPlayerErrorEvent(e){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_ERROR,timestamp:new Date,metaData:e})}sendIVSPlayerRecoverableErrorEvent(e){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_RECOVERABLE_ERROR,timestamp:new Date,metaData:e})}sendIVSPlayerAnalyticsEvent(e){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_ANALYTICS_EVENT,timestamp:new Date,metaData:e})}sendIVSPlayerPlaybackRateChangedEvent(e){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_PLAYBACK_RATE_CHANGED,timestamp:new Date,metaData:{updatedPlaybackRate:e}})}sendIVSPlayerQualityChanged(e){this.eventHandler.callEvent({event:Ar.IVS_PLAYER_QUALITY_CHANGED,timestamp:new Date,metaData:e})}sendPlayerLiveLatency(e){this.eventHandler.callEvent({event:Ar.LIVESTREAM_LATENCY,timestamp:new Date,metaData:{latency:e}})}sendDisconnectEvent(){this.eventHandler.callEvent({event:Ar.DISCONNECT,timestamp:new Date})}sendReconnectEvent(){this.eventHandler.callEvent({event:Ar.RECONNECT_ATTEMPT,timestamp:new Date})}};hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"registerIceServers",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"registerConsumer",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"registerProducer",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendConsumerSharedMediaStateEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"registerProducingTransport",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"registerConsumingTransport",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"deRegisterConsumer",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"deRegisterProducer",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"disconnectConsumingTransport",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"disconnectProducingTransport",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendPreCallTestBeginEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendScreenShareToggleEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendScreenShareRequestedEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendActiveSpeakerEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"devices",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"selectedDevice",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"mediaPermission",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"mediaPlaybackFailed",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"mediaTrackMuted",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"tabChanged",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"browserBackgrounded",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"browserForegrounded",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"legacySwitch",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"getPreCallTestResults",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendCallJoinBeginEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendNetworkQualityTestBeginEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendWebSocketConnectedEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendTransportConnectedEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendAudioToggleEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendVideoToggleEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendParticipantRoleToggleEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"startPingStats",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"stopPingStats",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendPingStatsEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerRebufferEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerAudioBlockEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerPlaybackBlockedEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerNetworkUnavailableEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerInitializedEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerWorkerErrorEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerErrorEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerRecoverableErrorEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerAnalyticsEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerPlaybackRateChangedEvent",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendIVSPlayerQualityChanged",null),hn([un(TypeError,((e,t)=>pn.error(t,e)))],mn.prototype,"sendPlayerLiveLatency",null),mn=hn([((e,t)=>(r,n,i)=>{if(i)return ln(i,e,t);for(const n of Reflect.ownKeys(r.prototype).filter((e=>"constructor"!==e))){const i=Object.getOwnPropertyDescriptor(r.prototype,n);i.value instanceof Function&&Object.defineProperty(r.prototype,n,ln(i,e,t))}})(TypeError,((e,t)=>pn.error(t,e)))],mn);const fn=mn,gn=new class extends nr{constructor(){super(...arguments),Kt(this,"stats"),Kt(this,"roomURL"),Kt(this,"peerId"),Kt(this,"backend"),Kt(this,"iceServers"),Kt(this,"initialized",!1),Kt(this,"stalled",!1),Kt(this,"ipInformation"),Kt(this,"logger")}initialize(e){return tr(this,arguments,(function*({peerId:e,engineName:t,env:r=Nr,iceServers:n,apiBase:i="https://api.cluster.dyte.in",flags:s,logger:o=console,apiHostnames:a,skipConnectivityChecks:c=!1}){var d,l,u;try{this.peerId=e,this.logger=o,this.ipInformation=yield en.getIPDetails({peerId:e,apiHostnames:a}),this.backend=new fn(i,t,r,s,o,e,a),this.iceServers=n,null==(d=this.backend)||d.registerIceServers(this.iceServers),this.initialized=!0,null==(u=null==(l=this.backend)?void 0:l.eventHandler)||u.emit("initialized",this.ipInformation),this.emit("initialized",this.ipInformation),this.startPreCallTest(c)}catch(e){this.logger.error("callStats::CallStatsIntegration: ",{error:e}),this.stallCallStats()}}))}setRoomName(e){this.roomURL=e}configureSendTransport(e){var t;null==(t=this.backend)||t.registerProducingTransport(e)}configureRecvTransport(e){var t;null==(t=this.backend)||t.registerConsumingTransport(e)}candidateRegionalNetworkQualityTest(e){return tr(this,null,(function*(){var t;try{null==(t=this.backend)||t.sendNetworkQualityTestBeginEvent(e)}catch(e){this.logger.error("callStats::sendNetworkQualityTestBeginEvent",{error:{reason:e.reason}})}}))}roomJoined(e){return tr(this,null,(function*(){var t,r;null==(t=this.backend)||t.sendCallJoinBeginEvent(e),this.backend,null==(r=this.backend)||r.startPingStats()}))}audioOff(){var e;null==(e=this.backend)||e.sendAudioToggleEvent(!1)}audioOn(){var e;null==(e=this.backend)||e.sendAudioToggleEvent(!0)}videoOff(){var e;null==(e=this.backend)||e.sendVideoToggleEvent(!1)}videoOn(){var e;null==(e=this.backend)||e.sendVideoToggleEvent(!0)}callEnded(){var e,t;null==(e=this.backend)||e.stopPingStats(),null==(t=this.backend)||t.sendDisconnectEvent()}screenShareStart(e){var t;null==(t=this.backend)||t.sendScreenShareToggleEvent(!0,e)}consumerSharedMediaState(e,t){var r;null==(r=this.backend)||r.sendConsumerSharedMediaStateEvent(e,t)}screenShareStop(e){var t;null==(t=this.backend)||t.sendScreenShareToggleEvent(!1,e)}screenShareRequested(){var e;null==(e=this.backend)||e.sendScreenShareRequestedEvent()}activeSpeaker(e){var t;e===this.peerId&&(null==(t=this.backend)||t.sendActiveSpeakerEvent(e))}devices(e,t){var r;null==(r=this.backend)||r.devices(e,t)}selectedDevice(e,t){var r;null==(r=this.backend)||r.selectedDevice(e,t)}mediaPermission(e,t){var r;null==(r=this.backend)||r.mediaPermission(e,t)}mediaPlaybackFailed(e){var t;null==(t=this.backend)||t.mediaPlaybackFailed(e)}mediaTrackMuted(e){var t;null==(t=this.backend)||t.mediaTrackMuted(e)}tabChanged(e=!1){var t;null==(t=this.backend)||t.tabChanged(e)}browserBackgrounded(){var e;null==(e=this.backend)||e.browserBackgrounded()}browserForegrounded(){var e;null==(e=this.backend)||e.browserForegrounded()}legacySwitch(e){var t;null==(t=this.backend)||t.legacySwitch(e)}startPreCallTest(e=!1){return tr(this,null,(function*(){var t;null==(t=this.backend)||t.sendPreCallTestBeginEvent(e)}))}onPreCallTestResults(e){var t;return null==(t=this.backend)||t.eventHandler.once("precall_end",e),e}onReceivingConsumerAudioStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("consumer_audio_status",e)}onReceivingConsumerVideoStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("consumer_video_status",e)}onReceivingProducerAudioStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("producer_audio_status",e)}onReceivingProducerVideoStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("producer_video_status",e)}onReceivingProducingTransportStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("producing_transport_status",e)}onReceivingConsumingTransportStatus(e){var t;null==(t=this.backend)||t.eventHandler.on("consuming_transport_status",e)}onProducerScore(e){var t;null==(t=this.backend)||t.eventHandler.on("producer_score",e)}onConsumerScore(e){var t;null==(t=this.backend)||t.eventHandler.on("consumer_score",e)}onSafeInitialization(e){if(this.initialized)e(this.ipInformation,!1);else if(!this.stalled){const t=t=>{e(t,!0)};return this.once("initialized",t),t}return()=>{}}removeInitializationListener(e){this.removeListener("initialized",e)}stallCallStats(){this.stalled=!0,this.removeAllListeners("initialized")}ivsPlayerEvent(e,t){var r,n,i,s,o,a,c,d,l,u,h;switch(e){case"PlayerRebuffering":null==(r=this.backend)||r.sendIVSPlayerRebufferEvent();break;case"PlayerAudioBlocked":null==(n=this.backend)||n.sendIVSPlayerAudioBlockEvent();break;case"PlayerPlaybackBlocked":null==(i=this.backend)||i.sendIVSPlayerPlaybackBlockedEvent();break;case"PlayerNetworkUnavailable":null==(s=this.backend)||s.sendIVSPlayerNetworkUnavailableEvent();break;case"PlayerInitialized":null==(o=this.backend)||o.sendIVSPlayerInitializedEvent();break;case"PlayerWorkerError":null==(a=this.backend)||a.sendIVSPlayerWorkerErrorEvent();break;case"PlayerError":null==(c=this.backend)||c.sendIVSPlayerErrorEvent(t);break;case"PlayerRecoverableError":null==(d=this.backend)||d.sendIVSPlayerRecoverableErrorEvent(t);break;case"PlayerAnalyticsEvent":null==(l=this.backend)||l.sendIVSPlayerAnalyticsEvent(t);break;case"PlayerPlaybackRateChanged":null==(u=this.backend)||u.sendIVSPlayerPlaybackRateChangedEvent(t);break;case"PlayerQualityChanged":null==(h=this.backend)||h.sendIVSPlayerQualityChanged(t)}}livestreamLatency(e){var t;null==(t=this.backend)||t.sendPlayerLiveLatency(e)}};var vn,yn,_n,Sn,Tn,En,bn,wn,kn;gn.setMaxListeners(30),Array.prototype.at||Object.assign(Array.prototype,{at:function(e){const{length:t}=this,r=e>=0?e:t+e;return r<0||r>=t?void 0:this[r]}}),String.prototype.at||Object.assign(String.prototype,{at:function(e){const{length:t}=this,r=e>=0?e:t+e;return r<0||r>=t?void 0:this[r]}}),function(e){e.GroupCall="GROUP_CALL",e.Webinar="WEBINAR",e.AudioRoom="AUDIO_ROOM",e.Livestream="LIVESTREAM",e.Chat="CHAT"}(vn||(vn={})),function(e){e.Skip="SKIP",e.OnPrivilegedUserEntry="ON_PRIVILEGED_USER_ENTRY",e.SkipOnAccept="SKIP_ON_ACCEPT"}(yn||(yn={})),function(e){e.Allowed="ALLOWED",e.NotAllowed="NOT_ALLOWED",e.CanRequest="CAN_REQUEST"}(_n||(_n={})),function(e){e.Allowed="ALLOWED",e.NotAllowed="NOT_ALLOWED"}(Sn||(Sn={})),function(e){e.FULL_ACCESS="FULL_ACCESS",e.VIEW_ONLY="VIEW_ONLY"}(Tn||(Tn={})),function(e){e.skip="SKIP",e.onAccept="ON_ACCEPT",e.skipOnPrivilegedUserEntry="SKIP_ON_PRIVILEGED_USER_ENTRY",e.skipOnAccept="SKIP_ON_ACCEPT"}(En||(En={})),function(e){e.none="NONE",e.recorder="RECORDER",e.livestreamer="LIVESTREAMER"}(bn||(bn={})),function(e){e.groupCall="GROUP_CALL",e.webinar="WEBINAR",e.audioRoom="AUDIO_ROOM",e.livestream="LIVESTREAM",e.chat="CHAT"}(wn||(wn={})),function(e){e.SKIP="skip",e.SKIP_ON_PRIVILEGED_USER_ENTRY="skipOnPrivilegedUserEntry",e.ON_ACCEPT="skipOnAccept",e.SKIP_ON_ACCEPT="skipOnAccept"}(kn||(kn={})),wn.groupCall,En.skipOnAccept,bn.none;let Rn="hXgU8Wc8pwuGNq9ms5q9Hh";var Cn;"undefined"!=typeof process&&null!=(Cn=null==process?void 0:process.env)&&Cn.FLAGSMITH_ENVIRONMENT_KEY&&(Rn=process.env.FLAGSMITH_ENVIRONMENT_KEY);const In=new class{constructor(e=Rn){Kt(this,"flags",{}),Kt(this,"environmentKey",null),this.environmentKey=e,this.identify=this.identify.bind(this),this.getValue=this.getValue.bind(this),this.hasFeature=this.hasFeature.bind(this),this.getAllFlags=this.getAllFlags.bind(this)}identify(e){return tr(this,arguments,(function*(e,t={},r=!1,n=5e3,i="edge.api.flagsmith.com"){const s=JSON.parse(JSON.stringify(t)),o=Object.entries(s).map((e=>({trait_key:e[0],trait_value:e[1]})));try{const t="_"+(Math.random()+1).toString(36).substring(2),s=yield p().post(`https://${i}/api/v1/identities/`,{identifier:e+(r?t:""),traits:o},{headers:{"Content-Type":"application/json","X-Environment-Key":this.environmentKey},timeout:n});this.flags=function(e=[]){const t={};return e.forEach((e=>{t[e.feature.name]={enabled:e.enabled,value:e.feature_state_value}})),t}(s.data.flags||[])}catch(e){}return this.flags}))}getValue(e){return this.flags&&this.flags[e]&&this.flags[e].value}hasFeature(e){return this.flags&&this.flags[e]&&this.flags[e].enabled}getAllFlags(){return this.flags}},An=[-2,-1,0,1,2],Pn=[0,1,2,3,4],Dn=(e,t,r)=>{let n,i,s;if(0==t)n=i=s=r;else{const o=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<.16666666666666666?e+6*(t-e)*r:r<.5?t:r<.6666666666666666?e+(t-e)*(.6666666666666666-r)*6:e),a=r<.5?r*(1+t):r+t-r*t,c=2*r-a;n=o(c,a,e+1/3),i=o(c,a,e),s=o(c,a,e-1/3)}return[Math.round(255*n),Math.round(255*i),Math.round(255*s)]},On=(e,t,r)=>{const n=e=>e.toString(16).padStart(2,"0");return`#${n(e)}${n(t)}${n(r)}`},Mn=(e,t=An,r=.4)=>{const n=[],[i,s,o]=function(e){let t="0",r="0",n="0";return 4==(e=e.trim()).length?(t="0x"+e[1]+e[1],r="0x"+e[2]+e[2],n="0x"+e[3]+e[3]):e.length>6&&(t="0x"+e[1]+e[2],r="0x"+e[3]+e[4],n="0x"+e[5]+e[6]),[+t,+r,+n]}(e),[a,c,d]=((e,t,r)=>{e/=255,t/=255,r/=255;const n=Math.max(e,t,r),i=Math.min(e,t,r);let s,o;const a=(n+i)/2;if(n==i)s=o=0;else{const c=n-i;switch(o=a>.5?c/(2-n-i):c/(n+i),n){case e:s=(t-r)/c+(t<r?6:0);break;case t:s=(r-e)/c+2;break;case r:s=(e-t)/c+4}s/=6}return[s,o,a]})(i,s,o),l=Math.round(100*d);l>70?r=.8:l>60?r=.9:l<10?r=.075:l<42&&(r=.3);const u=t.findIndex((e=>0===e));if(-1===u)throw new Error("Invalid reducer provided, it must contain atleast one zero");const h=(100-l)/(5-u),p=l/(u+1);for(const e of t){let t;t=e<0?l+e*p*r:e>0?l+e*h*r:l;const[i,s,o]=Dn(a,c,t/100);n.push(On(i,s,o))}return n};function Nn(e,t){return e===t||e!=e&&t!=t}function xn(e,t){for(var r=e.length;r--;)if(Nn(e[r][0],t))return r;return-1}var Ln=Array.prototype.splice;function Un(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Un.prototype.clear=function(){this.__data__=[],this.size=0},Un.prototype.delete=function(e){var t=this.__data__,r=xn(t,e);return!(r<0||(r==t.length-1?t.pop():Ln.call(t,r,1),--this.size,0))},Un.prototype.get=function(e){var t=this.__data__,r=xn(t,e);return r<0?void 0:t[r][1]},Un.prototype.has=function(e){return xn(this.__data__,e)>-1},Un.prototype.set=function(e,t){var r=this.__data__,n=xn(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};const jn="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;var Fn="object"==typeof self&&self&&self.Object===Object&&self;const Vn=jn||Fn||Function("return this")(),Bn=Vn.Symbol;var Hn=Object.prototype,Wn=Hn.hasOwnProperty,Gn=Hn.toString,qn=Bn?Bn.toStringTag:void 0,$n=Object.prototype.toString,zn="[object Null]",Jn="[object Undefined]",Kn=Bn?Bn.toStringTag:void 0;function Qn(e){return null==e?void 0===e?Jn:zn:Kn&&Kn in Object(e)?function(e){var t=Wn.call(e,qn),r=e[qn];try{e[qn]=void 0;var n=!0}catch(e){}var i=Gn.call(e);return n&&(t?e[qn]=r:delete e[qn]),i}(e):function(e){return $n.call(e)}(e)}function Yn(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Xn="[object AsyncFunction]",Zn="[object Function]",ei="[object GeneratorFunction]",ti="[object Proxy]";function ri(e){if(!Yn(e))return!1;var t=Qn(e);return t==Zn||t==ei||t==Xn||t==ti}const ni=Vn["__core-js_shared__"];var ii=function(){var e=/[^.]+$/.exec(ni&&ni.keys&&ni.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),si=Function.prototype.toString;function oi(e){if(null!=e){try{return si.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var ai=/^\[object .+?Constructor\]$/,ci=Function.prototype,di=Object.prototype,li=ci.toString,ui=di.hasOwnProperty,hi=RegExp("^"+li.call(ui).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function pi(e){return!(!Yn(e)||function(e){return!!ii&&ii in e}(e))&&(ri(e)?hi:ai).test(oi(e))}function mi(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return pi(r)?r:void 0}const fi=mi(Vn,"Map"),gi=mi(Object,"create");var vi=Object.prototype.hasOwnProperty,yi=Object.prototype.hasOwnProperty;function _i(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Si(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function Ti(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ei(e){var t=this.__data__=new Un(e);this.size=t.size}function bi(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}_i.prototype.clear=function(){this.__data__=gi?gi(null):{},this.size=0},_i.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},_i.prototype.get=function(e){var t=this.__data__;if(gi){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return vi.call(t,e)?t[e]:void 0},_i.prototype.has=function(e){var t=this.__data__;return gi?void 0!==t[e]:yi.call(t,e)},_i.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=gi&&void 0===t?"__lodash_hash_undefined__":t,this},Ti.prototype.clear=function(){this.size=0,this.__data__={hash:new _i,map:new(fi||Un),string:new _i}},Ti.prototype.delete=function(e){var t=Si(this,e).delete(e);return this.size-=t?1:0,t},Ti.prototype.get=function(e){return Si(this,e).get(e)},Ti.prototype.has=function(e){return Si(this,e).has(e)},Ti.prototype.set=function(e,t){var r=Si(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Ei.prototype.clear=function(){this.__data__=new Un,this.size=0},Ei.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Ei.prototype.get=function(e){return this.__data__.get(e)},Ei.prototype.has=function(e){return this.__data__.has(e)},Ei.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Un){var n=r.__data__;if(!fi||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ti(n)}return r.set(e,t),this.size=r.size,this};var wi=function(){try{var e=mi(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const ki=wi;function Ri(e,t,r){"__proto__"==t&&ki?ki(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Ci=Object.prototype.hasOwnProperty;function Ii(e,t,r){var n=e[t];(!Ci.call(e,t)||!Nn(n,r)||void 0===r&&!(t in e))&&Ri(e,t,r)}function Ai(e,t,r,n){var i=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=n?n(r[a],e[a],a,r,e):void 0;void 0===c&&(c=e[a]),i?Ri(r,a,c):Ii(r,a,c)}return r}function Pi(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Di(e){return null!=e&&"object"==typeof e}function Oi(e){return Di(e)&&"[object Arguments]"==Qn(e)}var Mi=Object.prototype,Ni=Mi.hasOwnProperty,xi=Mi.propertyIsEnumerable,Li=Oi(function(){return arguments}())?Oi:function(e){return Di(e)&&Ni.call(e,"callee")&&!xi.call(e,"callee")};const Ui=Li,ji=Array.isArray;function Fi(){return!1}var Vi="object"==typeof exports&&exports&&!exports.nodeType&&exports,Bi=Vi&&e&&!e.nodeType&&e,Hi=Bi&&Bi.exports===Vi?Vn.Buffer:void 0;const Wi=(Hi?Hi.isBuffer:void 0)||Fi;var Gi=9007199254740991,qi=/^(?:0|[1-9]\d*)$/;function $i(e,t){var r=typeof e;return!!(t=null==t?Gi:t)&&("number"==r||"symbol"!=r&&qi.test(e))&&e>-1&&e%1==0&&e<t}var zi=9007199254740991;function Ji(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=zi}var Ki={};function Qi(e){return function(t){return e(t)}}Ki["[object Float32Array]"]=Ki["[object Float64Array]"]=Ki["[object Int8Array]"]=Ki["[object Int16Array]"]=Ki["[object Int32Array]"]=Ki["[object Uint8Array]"]=Ki["[object Uint8ClampedArray]"]=Ki["[object Uint16Array]"]=Ki["[object Uint32Array]"]=!0,Ki["[object Arguments]"]=Ki["[object Array]"]=Ki["[object ArrayBuffer]"]=Ki["[object Boolean]"]=Ki["[object DataView]"]=Ki["[object Date]"]=Ki["[object Error]"]=Ki["[object Function]"]=Ki["[object Map]"]=Ki["[object Number]"]=Ki["[object Object]"]=Ki["[object RegExp]"]=Ki["[object Set]"]=Ki["[object String]"]=Ki["[object WeakMap]"]=!1;var Yi="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xi=Yi&&e&&!e.nodeType&&e,Zi=Xi&&Xi.exports===Yi&&jn.process;const es=function(){try{return Xi&&Xi.require&&Xi.require("util").types||Zi&&Zi.binding&&Zi.binding("util")}catch(e){}}();var ts=es&&es.isTypedArray,rs=ts?Qi(ts):function(e){return Di(e)&&Ji(e.length)&&!!Ki[Qn(e)]};const ns=rs;var is=Object.prototype.hasOwnProperty;function ss(e,t){var r=ji(e),n=!r&&Ui(e),i=!r&&!n&&Wi(e),s=!r&&!n&&!i&&ns(e),o=r||n||i||s,a=o?Pi(e.length,String):[],c=a.length;for(var d in e)(t||is.call(e,d))&&(!o||!("length"==d||i&&("offset"==d||"parent"==d)||s&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||$i(d,c)))&&a.push(d);return a}var os=Object.prototype;function as(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||os)}function cs(e,t){return function(r){return e(t(r))}}const ds=cs(Object.keys,Object);var ls=Object.prototype.hasOwnProperty;function us(e){if(!as(e))return ds(e);var t=[];for(var r in Object(e))ls.call(e,r)&&"constructor"!=r&&t.push(r);return t}function hs(e){return null!=e&&Ji(e.length)&&!ri(e)}function ps(e){return hs(e)?ss(e):us(e)}function ms(e,t){return e&&Ai(t,ps(t),e)}var fs=Object.prototype.hasOwnProperty;function gs(e){return hs(e)?ss(e,!0):function(e){if(!Yn(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=as(e),r=[];for(var n in e)"constructor"==n&&(t||!fs.call(e,n))||r.push(n);return r}(e)}var vs="object"==typeof exports&&exports&&!exports.nodeType&&exports,ys=vs&&e&&!e.nodeType&&e,_s=ys&&ys.exports===vs?Vn.Buffer:void 0,Ss=_s?_s.allocUnsafe:void 0;function Ts(e,t){if(t)return e.slice();var r=e.length,n=Ss?Ss(r):new e.constructor(r);return e.copy(n),n}function Es(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}function bs(e,t){for(var r=-1,n=null==e?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}function ws(){return[]}var ks=Object.prototype.propertyIsEnumerable,Rs=Object.getOwnPropertySymbols,Cs=Rs?function(e){return null==e?[]:(e=Object(e),bs(Rs(e),(function(t){return ks.call(e,t)})))}:ws;const Is=Cs;function As(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}const Ps=cs(Object.getPrototypeOf,Object);var Ds=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)As(t,Is(e)),e=Ps(e);return t}:ws;const Os=Ds;function Ms(e,t,r){var n=t(e);return ji(e)?n:As(n,r(e))}function Ns(e){return Ms(e,ps,Is)}function xs(e){return Ms(e,gs,Os)}const Ls=mi(Vn,"DataView"),Us=mi(Vn,"Promise"),js=mi(Vn,"Set"),Fs=mi(Vn,"WeakMap");var Vs="[object Map]",Bs="[object Promise]",Hs="[object Set]",Ws="[object WeakMap]",Gs="[object DataView]",qs=oi(Ls),$s=oi(fi),zs=oi(Us),Js=oi(js),Ks=oi(Fs),Qs=Qn;(Ls&&Qs(new Ls(new ArrayBuffer(1)))!=Gs||fi&&Qs(new fi)!=Vs||Us&&Qs(Us.resolve())!=Bs||js&&Qs(new js)!=Hs||Fs&&Qs(new Fs)!=Ws)&&(Qs=function(e){var t=Qn(e),r="[object Object]"==t?e.constructor:void 0,n=r?oi(r):"";if(n)switch(n){case qs:return Gs;case $s:return Vs;case zs:return Bs;case Js:return Hs;case Ks:return Ws}return t});const Ys=Qs;var Xs=Object.prototype.hasOwnProperty;const Zs=Vn.Uint8Array;function eo(e){var t=new e.constructor(e.byteLength);return new Zs(t).set(new Zs(e)),t}var to=/\w*$/,ro=Bn?Bn.prototype:void 0,no=ro?ro.valueOf:void 0;function io(e,t){var r=t?eo(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var so="[object Boolean]",oo="[object Date]",ao="[object Map]",co="[object Number]",lo="[object RegExp]",uo="[object Set]",ho="[object String]",po="[object Symbol]",mo="[object ArrayBuffer]",fo="[object DataView]",go="[object Float32Array]",vo="[object Float64Array]",yo="[object Int8Array]",_o="[object Int16Array]",So="[object Int32Array]",To="[object Uint8Array]",Eo="[object Uint8ClampedArray]",bo="[object Uint16Array]",wo="[object Uint32Array]";var ko=Object.create,Ro=function(){function e(){}return function(t){if(!Yn(t))return{};if(ko)return ko(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();const Co=Ro;function Io(e){return"function"!=typeof e.constructor||as(e)?{}:Co(Ps(e))}var Ao=es&&es.isMap,Po=Ao?Qi(Ao):function(e){return Di(e)&&"[object Map]"==Ys(e)};const Do=Po;var Oo=es&&es.isSet,Mo=Oo?Qi(Oo):function(e){return Di(e)&&"[object Set]"==Ys(e)};const No=Mo;var xo=1,Lo=2,Uo=4,jo="[object Arguments]",Fo="[object Function]",Vo="[object GeneratorFunction]",Bo="[object Object]",Ho={};function Wo(e,t,r,n,i,s){var o,a=t&xo,c=t&Lo,d=t&Uo;if(r&&(o=i?r(e,n,i,s):r(e)),void 0!==o)return o;if(!Yn(e))return e;var l=ji(e);if(l){if(o=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Xs.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!a)return Es(e,o)}else{var u=Ys(e),h=u==Fo||u==Vo;if(Wi(e))return Ts(e,a);if(u==Bo||u==jo||h&&!i){if(o=c||h?{}:Io(e),!a)return c?function(e,t){return Ai(e,Os(e),t)}(e,function(e,t){return e&&Ai(t,gs(t),e)}(o,e)):function(e,t){return Ai(e,Is(e),t)}(e,ms(o,e))}else{if(!Ho[u])return i?e:{};o=function(e,t,r){var n=e.constructor;switch(t){case mo:return eo(e);case so:case oo:return new n(+e);case fo:return function(e,t){var r=t?eo(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case go:case vo:case yo:case _o:case So:case To:case Eo:case bo:case wo:return io(e,r);case ao:return new n;case co:case ho:return new n(e);case lo:return function(e){var t=new e.constructor(e.source,to.exec(e));return t.lastIndex=e.lastIndex,t}(e);case uo:return new n;case po:return function(e){return no?Object(no.call(e)):{}}(e)}}(e,u,a)}}s||(s=new Ei);var p=s.get(e);if(p)return p;s.set(e,o),No(e)?e.forEach((function(n){o.add(Wo(n,t,r,n,e,s))})):Do(e)&&e.forEach((function(n,i){o.set(i,Wo(n,t,r,i,e,s))}));var m=l?void 0:(d?c?xs:Ns:c?gs:ps)(e);return bi(m||e,(function(n,i){m&&(n=e[i=n]),Ii(o,i,Wo(n,t,r,i,e,s))})),o}Ho[jo]=Ho["[object Array]"]=Ho["[object ArrayBuffer]"]=Ho["[object DataView]"]=Ho["[object Boolean]"]=Ho["[object Date]"]=Ho["[object Float32Array]"]=Ho["[object Float64Array]"]=Ho["[object Int8Array]"]=Ho["[object Int16Array]"]=Ho["[object Int32Array]"]=Ho["[object Map]"]=Ho["[object Number]"]=Ho[Bo]=Ho["[object RegExp]"]=Ho["[object Set]"]=Ho["[object String]"]=Ho["[object Symbol]"]=Ho["[object Uint8Array]"]=Ho["[object Uint8ClampedArray]"]=Ho["[object Uint16Array]"]=Ho["[object Uint32Array]"]=!0,Ho["[object Error]"]=Ho[Fo]=Ho["[object WeakMap]"]=!1;var Go=1,qo=4;function $o(e){return Wo(e,Go|qo)}var zo="[object Symbol]";function Jo(e){return"symbol"==typeof e||Di(e)&&Qn(e)==zo}var Ko=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qo=/^\w*$/;function Yo(e,t){if(ji(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Jo(e))||Qo.test(e)||!Ko.test(e)||null!=t&&e in Object(t)}function Xo(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(Xo.Cache||Ti),r}Xo.Cache=Ti;var Zo,ea,ta=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ra=/\\(\\)?/g,na=(Zo=Xo((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ta,(function(e,r,n,i){t.push(n?i.replace(ra,"$1"):r||e)})),t}),(function(e){return 500===ea.size&&ea.clear(),e})),ea=Zo.cache,Zo);const ia=na;function sa(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var oa=1/0,aa=Bn?Bn.prototype:void 0,ca=aa?aa.toString:void 0;function da(e){if("string"==typeof e)return e;if(ji(e))return sa(e,da)+"";if(Jo(e))return ca?ca.call(e):"";var t=e+"";return"0"==t&&1/e==-oa?"-0":t}function la(e){return null==e?"":da(e)}function ua(e,t){return ji(e)?e:Yo(e,t)?[e]:ia(la(e))}var ha=1/0;function pa(e){if("string"==typeof e||Jo(e))return e;var t=e+"";return"0"==t&&1/e==-ha?"-0":t}function ma(e,t){for(var r=0,n=(t=ua(t,e)).length;null!=e&&r<n;)e=e[pa(t[r++])];return r&&r==n?e:void 0}function fa(e,t,r){var n=null==e?void 0:ma(e,t);return void 0===n?r:n}var ga=Object.prototype.hasOwnProperty;function va(e,t){return null!=e&&ga.call(e,t)}function ya(e,t,r){for(var n=-1,i=(t=ua(t,e)).length,s=!1;++n<i;){var o=pa(t[n]);if(!(s=null!=e&&r(e,o)))break;e=e[o]}return s||++n!=i?s:!!(i=null==e?0:e.length)&&Ji(i)&&$i(o,i)&&(ji(e)||Ui(e))}function _a(e,t,r,n){if(!Yn(e))return e;for(var i=-1,s=(t=ua(t,e)).length,o=s-1,a=e;null!=a&&++i<s;){var c=pa(t[i]),d=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var l=a[c];void 0===(d=n?n(l,c,a):void 0)&&(d=Yn(l)?l:$i(t[i+1])?[]:{})}Ii(a,c,d),a=a[c]}return e}const Sa={border_radius:"rounded",border_width:"thin",spacing_base:4,theme:"dark",colors:{brand:(e=>{const[t,r,n,i,s]=Mn("#2160FD",An);return{300:t,400:r,500:n,600:i,700:s}})(),background:(e=>{const[t,r,n,i,s]=Mn(e,Pn);return{1e3:t,900:r,800:n,700:i,600:s}})("#141414"),danger:"#FF2D2D",text:"#EEEEEE",text_on_brand:"#EEEEEE",success:"#62A504",video_bg:"#191919",warning:"#FFCD07"}};function Ta(){return $o(Sa)}const Ea={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:yn.Skip,plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:_n.Allowed,can_consume:Sn.Allowed},audio:{can_produce:_n.Allowed},screenshare:{can_produce:_n.Allowed,can_consume:Sn.Allowed}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1},channel:{can_create:"ALL",can_delete:"ALL",can_update:"ALL",can_read_all:!1},message:{can_delete:"ALL",can_edit:"ALL",delete_cutoff_time_seconds:0,edit_cutoff_time_seconds:0}},hidden_participant:!1,is_recorder:!1,recorder_type:bn.none,show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{oldTheme:{setup_screen:{is_enabled:!1},alone_here:{is_enabled:!1},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!1,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,colors:{primary:"#2160FD",secondary:"#1A1A1A",text:"#EEEEEE",background:"#1A1A1A",textPrimary:"#EEEEEE",videoBackground:"#1A1A1A"},dimensions:{mode:"fillParent"},grid:{multi:{maxVideoCount:6,videoFit:"cover"},single:{maxVideoCount:6,videoFit:"cover"},defaultView:"MULTI"},controls:{pip_toggle:!1},plugins:[]},design_tokens:Ta(),config_diff:{}},config:{view_type:vn.GroupCall,media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"hybrid"};bn.none,En.skip;const ba={permissions:{can_accept_production_requests:!1,can_edit_display_name:!0,accept_waiting_requests:!1,disable_participant_audio:!1,disable_participant_screensharing:!1,disable_participant_video:!1,can_spotlight:!1,kick_participant:!1,pin_participant:!1,can_record:!1,can_livestream:!1,waiting_room_type:yn.Skip,plugins:{can_close:!0,can_start:!0,can_edit_config:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},media:{video:{can_produce:_n.Allowed},audio:{can_produce:_n.Allowed},screenshare:{can_produce:_n.Allowed}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},hidden_participant:!1,is_recorder:!1,recorder_type:bn.none,show_participant_list:!0,transcription_enabled:!1,can_change_participant_permissions:!1,connected_meetings:{can_alter_connected_meetings:!1,can_switch_connected_meetings:!1,can_switch_to_parent_meeting:!1},stage_enabled:!1,stage_access:void 0,accept_stage_requests:!1},ui:{design_tokens:Ta(),config_diff:{}},config:{view_type:vn.GroupCall,media:{audio:{enable_stereo:!1,enable_high_bitrate:!1},video:{quality:"vga",frame_rate:24},screenshare:{quality:"hd",frame_rate:5}},max_video_streams:{mobile:6,desktop:6},max_screenshare_count:1},version:"2.0.0"};function wa(){return $o(ba)}const ka="mediasoup-client";let Ra=class{constructor(e){e?(this._debug=Tr(`${ka}:${e}`),this._warn=Tr(`${ka}:WARN:${e}`),this._error=Tr(`${ka}:ERROR:${e}`)):(this._debug=Tr(ka),this._warn=Tr(`${ka}:WARN`),this._error=Tr(`${ka}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};const Ca=new Ra("EnhancedEventEmitter");let Ia=class extends nr.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){const r=super.listenerCount(e);try{return super.emit(e,...t)}catch(t){return Ca.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,t),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}},Aa=class e extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,e):this.stack=new Error(t).stack}},Pa=class e extends Error{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,e):this.stack=new Error(t).stack}};function Da(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))}function Oa(){return Math.round(1e7*Math.random())}var Ma={};function Na(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)xa(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)Ua(t)}function xa(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,(!e.parameters||"object"!=typeof e.parameters)&&(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)La(t)}function La(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");(!e.parameter||"string"!=typeof e.parameter)&&(e.parameter="")}function Ua(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function ja(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)Fa(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)Va(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)Ba(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),function(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");(!e.reducedSize||"boolean"!=typeof e.reducedSize)&&(e.reducedSize=!0)}(e.rtcp)}function Fa(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,(!e.parameters||"object"!=typeof e.parameters)&&(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)La(t)}function Va(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),(!e.parameters||"object"!=typeof e.parameters)&&(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function Ba(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if((!e.dtx||"boolean"!=typeof e.dtx)&&(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function Ha(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")}function Wa(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}return r}function Ga(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.remoteParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r}function qa(e,t){const r=[];if(t){for(let n=0;n<e.length;++n)if(Ja(e[n],t)){r.push(e[n]),za(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),za(e[1])&&r.push(e[1]);return r}function $a(e,t){return t.codecs.some((t=>t.kind===e))}function za(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function Ja(e,t,{strict:r=!1,modify:n=!1}={}){const i=e.mimeType.toLowerCase();if(i!==t.mimeType.toLowerCase()||e.clockRate!==t.clockRate||e.channels!==t.channels)return!1;switch(i){case"video/h264":if(r){if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0)||!Ma.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=Ma.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}n&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r&&(e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}return!0}function Ka(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function Qa(e,t){const r=[];for(const n of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===n.type&&(e.parameter===n.parameter||!e.parameter&&!n.parameter)));e&&r.push(e)}return r}!function(e){const t=Tr("h264-profile-level-id");t.log=console.info.bind(console),e.ProfileConstrainedBaseline=1,e.ProfileBaseline=2,e.ProfileMain=3,e.ProfileConstrainedHigh=4,e.ProfileHigh=5;e.Level1_b=0,e.Level1=10,e.Level1_1=11,e.Level1_2=12,e.Level1_3=13,e.Level2=20,e.Level2_1=21,e.Level2_2=22,e.Level3=30,e.Level3_1=31,e.Level3_2=32,e.Level4=40,e.Level4_1=41,e.Level4_2=42,e.Level5=50,e.Level5_1=51,e.Level5_2=52;class r{constructor(e,t){this.profile=e,this.level=t}}e.ProfileLevelId=r;const n=new r(1,31);class i{constructor(e){this._mask=~a("x",e),this._maskedValue=a("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class s{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const o=[new s(66,new i("x1xx0000"),1),new s(77,new i("1xxx0000"),1),new s(88,new i("11xx0000"),1),new s(66,new i("x0xx0000"),2),new s(88,new i("10xx0000"),2),new s(77,new i("0x0x0000"),3),new s(100,new i("00000000"),5),new s(100,new i("00001100"),4)];function a(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function c(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}e.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const n=parseInt(e,16);if(0===n)return null;const i=255&n,s=n>>8&255,a=n>>16&255;let c;switch(i){case 11:c=16&s?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:c=i;break;default:return t("parseProfileLevelId() | unrecognized level_idc:%s",i),null}for(const e of o)if(a===e.profile_idc&&e.profile_iop.isMatch(s))return new r(e.profile,c);return t("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},e.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return t("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let r;switch(e.profile){case 1:r="42e0";break;case 2:r="4200";break;case 3:r="4d00";break;case 4:r="640c";break;case 5:r="6400";break;default:return t("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let n=e.level.toString(16);return 1===n.length&&(n=`0${n}`),`${r}${n}`},e.parseSdpProfileLevelId=function(t={}){const r=t["profile-level-id"];return r?e.parseProfileLevelId(r):n},e.isSameProfile=function(t={},r={}){const n=e.parseSdpProfileLevelId(t),i=e.parseSdpProfileLevelId(r);return Boolean(n&&i&&n.profile===i.profile)},e.generateProfileLevelIdForAnswer=function(n={},i={}){if(!n["profile-level-id"]&&!i["profile-level-id"])return t("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const s=e.parseSdpProfileLevelId(n),o=e.parseSdpProfileLevelId(i);if(!s)throw new TypeError("invalid local_profile_level_id");if(!o)throw new TypeError("invalid remote_profile_level_id");if(s.profile!==o.profile)throw new TypeError("H264 Profile mismatch");const a=c(n)&&c(i),d=s.level,l=function(e,t){return function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(e,t)?e:t}(d,o.level),u=a?d:l;return t("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",s.profile,u),e.profileLevelIdToString(new r(s.profile,u))}}(Ma);var Ya={},Xa={},Za=rr&&rr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.Logger=void 0;const ec=Za(Tr),tc="awaitqueue";Xa.Logger=class{constructor(e){e?(this._debug=(0,ec.default)(`${tc}:${e}`),this._warn=(0,ec.default)(`${tc}:WARN:${e}`),this._error=(0,ec.default)(`${tc}:ERROR:${e}`)):(this._debug=(0,ec.default)(tc),this._warn=(0,ec.default)(`${tc}:WARN`),this._error=(0,ec.default)(`${tc}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}},Object.defineProperty(Ya,"__esModule",{value:!0});var rc=Ya.AwaitQueue=Ya.AwaitQueueRemovedTaskError=Ya.AwaitQueueStoppedError=void 0;const nc=new Xa.Logger;class ic extends Error{constructor(e){super(null!=e?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,ic)}}Ya.AwaitQueueStoppedError=ic;class sc extends Error{constructor(e){super(null!=e?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,sc)}}let oc;Ya.AwaitQueueRemovedTaskError=sc,rc=Ya.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}push(e,t){return tr(this,null,(function*(){if(t=null!=t?t:e.name,nc.debug(`push() [name:${t}]`),"function"!=typeof e)throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,n)=>{const i={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{if(i.completed)return;i.completed=!0,this.pendingTasks.delete(i.id),nc.debug(`resolving task [name:${i.name}]`),r(e);const[t]=this.pendingTasks.values();t&&!t.executedAt&&this.execute(t)},reject:e=>{if(!i.completed&&(i.completed=!0,this.pendingTasks.delete(i.id),nc.debug(`rejecting task [name:${i.name}]: %s`,String(e)),n(e),!this.stopping)){const[e]=this.pendingTasks.values();e&&!e.executedAt&&this.execute(e)}}};this.pendingTasks.set(i.id,i),1===this.pendingTasks.size&&this.execute(i)}))}))}stop(){nc.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())nc.debug(`stop() | stopping task [name:${e.name}]`);this.stopping=!1}remove(e){nc.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];t?t.reject(new sc):nc.debug(`stop() | no task with given idx [taskIdx:${e}]`)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map((r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0})))}execute(e){return tr(this,null,(function*(){if(nc.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=yield e.task();e.resolve(t)}catch(t){e.reject(t)}}))}};var ac="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:rr):e=>(oc||(oc=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)));const cc=new Ra("Producer");let dc=class extends Ia{constructor({id:e,localId:t,rtpSender:r,track:n,rtpParameters:i,stopTracks:s,disableTrackOnPause:o,zeroRtpOnPause:a,appData:c}){super(),this._closed=!1,this._observer=new Ia,cc.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=n,this._kind=n.kind,this._rtpParameters=i,this._paused=!!o&&!n.enabled,this._maxSpatialLayer=void 0,this._stopTracks=s,this._disableTrackOnPause=o,this._zeroRtpOnPause=a,this._appData=c||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(cc.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(cc.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");return new Promise(((e,t)=>{this.safeEmit("@getstats",e,t)}))}))}pause(){cc.debug("pause()"),this._closed?cc.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@pause",e,t)})).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){cc.debug("resume()"),this._closed?cc.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@resume",e,t)})).catch((()=>{})),this._observer.safeEmit("resume"))}replaceTrack(e){return tr(this,arguments,(function*({track:e}){if(cc.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new Pa("closed")}if(e&&"ended"===e.readyState)throw new Pa("track ended");e!==this._track?(yield new Promise(((t,r)=>{this.safeEmit("@replacetrack",e,t,r)})),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()):cc.debug("replaceTrack() | same track, ignored")}))}setMaxSpatialLayer(e){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");if("video"!==this._kind)throw new Aa("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(yield new Promise(((t,r)=>{this.safeEmit("@setmaxspatiallayer",e,t,r)})).catch((()=>{})),this._maxSpatialLayer=e)}))}setRtpEncodingParameters(e){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");if("object"!=typeof e)throw new TypeError("invalid params");yield new Promise(((t,r)=>{this.safeEmit("@setrtpencodingparameters",e,t,r)}))}))}onTrackEnded(){cc.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}};const lc=new Ra("Consumer");let uc=class extends Ia{constructor({id:e,localId:t,producerId:r,rtpReceiver:n,track:i,rtpParameters:s,appData:o}){super(),this._closed=!1,this._observer=new Ia,lc.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=n,this._track=i,this._rtpParameters=s,this._paused=!i.enabled,this._appData=o||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(lc.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(lc.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");return new Promise(((e,t)=>{this.safeEmit("@getstats",e,t)}))}))}pause(){lc.debug("pause()"),this._closed?lc.error("pause() | Consumer closed"):this._paused?lc.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){lc.debug("resume()"),this._closed?lc.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):lc.debug("resume() | Consumer is already resumed")}onTrackEnded(){lc.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}};const hc=new Ra("DataProducer");class pc extends Ia{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:n}){super(),this._closed=!1,this._observer=new Ia,hc.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=n||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(hc.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(hc.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(hc.debug("send()"),this._closed)throw new Pa("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(hc.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?hc.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):hc.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(hc.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||hc.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}const mc=new Ra("DataConsumer");class fc extends Ia{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:n,appData:i}){super(),this._closed=!1,this._observer=new Ia,mc.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=n,this._appData=i||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(mc.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(mc.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(mc.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?mc.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):mc.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(mc.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}const gc=new Ra("Transport");class vc{constructor(e){this.consumerOptions=e,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}let yc=class extends Ia{constructor({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:u,extendedRtpCapabilities:h,canProduceByKind:p}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new rc,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new Ia,gc.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=h,this._canProduceByKind=p,this._maxSctpMessageSize=s?s.maxMessageSize:null,delete(c=Da(c,{})).iceServers,delete c.iceTransportPolicy,delete c.bundlePolicy,delete c.rtcpMuxPolicy,delete c.sdpSemantics,this._handler=u(),this._handler.run({direction:e,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:h}),this._appData=l||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}get producers(){return this._producers}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){gc.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Pa("closed");return this._handler.getTransportStats()}))}restartIce(e){return tr(this,arguments,(function*({iceParameters:e}){if(gc.debug("restartIce()"),this._closed)throw new Pa("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.restartIce(e)}))),"transport.restartIce()")}))}updateIceServers(){return tr(this,arguments,(function*({iceServers:e}={}){if(gc.debug("updateIceServers()"),this._closed)throw new Pa("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.updateIceServers(e)}))),"transport.updateIceServers()")}))}produce(){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:n,stopTracks:i=!0,disableTrackOnPause:s=!0,zeroRtpOnPause:o=!1,appData:a={}}={}){if(gc.debug("produce() [track:%o]",e),this._closed)throw new Pa("closed");if(!e)throw new TypeError("missing track");if("send"!==this._direction)throw new Aa("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new Aa(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new Pa("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(a&&"object"!=typeof a)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((()=>tr(this,null,(function*(){let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?c=void 0:t&&(c=t.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:d,rtpParameters:l,rtpSender:u}=yield this._handler.send({track:e,encodings:c,codecOptions:r,codec:n});try{ja(l);const{id:t}=yield new Promise(((t,r)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:l,appData:a},t,r)})),r=new dc({id:t,localId:d,rtpSender:u,track:e,rtpParameters:l,stopTracks:i,disableTrackOnPause:s,zeroRtpOnPause:o,appData:a});return this._producers.set(r.id,r),this.handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(e){throw this._handler.stopSending(d).catch((()=>{})),e}}))),"transport.produce()").catch((t=>{if(i)try{e.stop()}catch(e){}throw t}))}))}consume(e){return tr(this,arguments,(function*({id:e,producerId:t,kind:r,rtpParameters:n,streamId:i,appData:s={}}){if(gc.debug("consume()"),n=Da(n,void 0),this._closed)throw new Pa("closed");if("recv"!==this._direction)throw new Aa("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");if(!function(e,t){if(ja(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some((e=>e.remotePayloadType===r.payloadType))}(n,this._extendedRtpCapabilities))throw new Aa("cannot consume this Producer");const o=new vc({id:e,producerId:t,kind:r,rtpParameters:n,streamId:i,appData:s});return this._pendingConsumerTasks.push(o),ac((()=>{if(this._closed)throw new Pa("closed");!1===this._consumerCreationInProgress&&this.createPendingConsumers()})),o.promise}))}produceData(){return tr(this,arguments,(function*({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:n="",protocol:i="",appData:s={}}={}){if(gc.debug("produceData()"),this._closed)throw new Pa("closed");if("send"!==this._direction)throw new Aa("not a sending Transport");if(!this._maxSctpMessageSize)throw new Aa("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push((()=>tr(this,null,(function*(){const{dataChannel:o,sctpStreamParameters:a}=yield this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i});Ha(a);const{id:c}=yield new Promise(((e,t)=>{this.safeEmit("producedata",{sctpStreamParameters:a,label:n,protocol:i,appData:s},e,t)})),d=new pc({id:c,dataChannel:o,sctpStreamParameters:a,appData:s});return this._dataProducers.set(d.id,d),this.handleDataProducer(d),this._observer.safeEmit("newdataproducer",d),d}))),"transport.produceData()")}))}consumeData(e){return tr(this,arguments,(function*({id:e,dataProducerId:t,sctpStreamParameters:r,label:n="",protocol:i="",appData:s={}}){if(gc.debug("consumeData()"),r=Da(r,void 0),this._closed)throw new Pa("closed");if("recv"!==this._direction)throw new Aa("not a receiving Transport");if(!this._maxSctpMessageSize)throw new Aa("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return Ha(r),this._awaitQueue.push((()=>tr(this,null,(function*(){const{dataChannel:o}=yield this._handler.receiveDataChannel({sctpStreamParameters:r,label:n,protocol:i}),a=new fc({id:e,dataProducerId:t,dataChannel:o,sctpStreamParameters:r,appData:s});return this._dataConsumers.set(a.id,a),this.handleDataConsumer(a),this._observer.safeEmit("newdataconsumer",a),a}))),"transport.consumeData()")}))}createPendingConsumers(){return tr(this,null,(function*(){this._consumerCreationInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingConsumerTasks.length)return void gc.debug("createPendingConsumers() | there is no Consumer to be created");const e=[...this._pendingConsumerTasks];let t;this._pendingConsumerTasks=[];const r=[];for(const t of e){const{id:e,kind:n,rtpParameters:i,streamId:s}=t.consumerOptions;r.push({trackId:e,kind:n,rtpParameters:i,streamId:s})}try{const n=yield this._handler.receive(r);for(let r=0;r<n.length;r++){const i=e[r],s=n[r],{id:o,producerId:a,kind:c,rtpParameters:d,appData:l}=i.consumerOptions,{localId:u,rtpReceiver:h,track:p}=s,m=new uc({id:o,localId:u,producerId:a,rtpReceiver:h,track:p,rtpParameters:d,appData:l});this._consumers.set(m.id,m),this.handleConsumer(m),!this._probatorConsumerCreated&&!t&&"video"===c&&(t=m),this._observer.safeEmit("newconsumer",m),i.resolve(m)}}catch(t){for(const r of e)r.reject(t)}if(t)try{const e=function(e){ja(e=Da(e,{}));const t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t}(t.rtpParameters);yield this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:e}]),gc.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){gc.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",e)}}))),"transport.createPendingConsumers()").then((()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()})).catch((()=>{}))}))}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingPauseConsumers.size)return void gc.debug("pausePendingConsumers() | there is no Consumer to be paused");const e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const t=e.map((e=>e.localId));yield this._handler.pauseReceiving(t)}catch(e){gc.error("pausePendingConsumers() | failed to pause Consumers:",e)}}))),"transport.pausePendingConsumers").then((()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()})).catch((()=>{}))}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingResumeConsumers.size)return void gc.debug("resumePendingConsumers() | there is no Consumer to be resumed");const e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const t=e.map((e=>e.localId));yield this._handler.resumeReceiving(t)}catch(e){gc.error("resumePendingConsumers() | failed to resume Consumers:",e)}}))),"transport.resumePendingConsumers").then((()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()})).catch((()=>{}))}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push((()=>tr(this,null,(function*(){if(0===this._pendingCloseConsumers.size)return void gc.debug("closePendingConsumers() | there is no Consumer to be closed");const e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{yield this._handler.stopReceiving(e.map((e=>e.localId)))}catch(e){gc.error("closePendingConsumers() | failed to close Consumers:",e)}}))),"transport.closePendingConsumers").then((()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()})).catch((()=>{}))}handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new Pa("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(gc.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}handleProducer(e){e.on("@close",(()=>{this._producers.delete(e.id),!this._closed&&this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.stopSending(e.localId)}))),"producer @close event").catch((e=>gc.warn("producer.close() failed:%o",e)))})),e.on("@pause",((t,r)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.pauseSending(e.localId)}))),"producer @pause event").then(t).catch(r)})),e.on("@resume",((t,r)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.resumeSending(e.localId)}))),"producer @resume event").then(t).catch(r)})),e.on("@replacetrack",((t,r,n)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.replaceTrack(e.localId,t)}))),"producer @replacetrack event").then(r).catch(n)})),e.on("@setmaxspatiallayer",((t,r,n)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.setMaxSpatialLayer(e.localId,t)}))),"producer @setmaxspatiallayer event").then(r).catch(n)})),e.on("@setrtpencodingparameters",((t,r,n)=>{this._awaitQueue.push((()=>tr(this,null,(function*(){return this._handler.setRtpEncodingParameters(e.localId,t)}))),"producer @setrtpencodingparameters event").then(r).catch(n)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new Pa("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),!this._closed&&(this._pendingCloseConsumers.set(e.id,e),!1===this._consumerCloseInProgress&&this.closePendingConsumers())})),e.on("@pause",(()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),ac((()=>{this._closed||!1===this._consumerPauseInProgress&&this.pausePendingConsumers()}))})),e.on("@resume",(()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),ac((()=>{this._closed||!1===this._consumerResumeInProgress&&this.resumePendingConsumers()}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new Pa("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}};const _c=new Ra("Device");class Sc{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new Ia,_c.debug("constructor()"),r){if(_c.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)_c.debug("constructor() | handler given: %s",e);else{if(e=function(){var e,t,r,n;if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void _c.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):"undefined"!=typeof RTCRtpTransceiver?(_c.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(_c.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if("object"==typeof navigator&&"string"==typeof navigator.userAgent){let i=navigator.userAgent;i=null==i?void 0:i.replace("motorola edge","motorola x");const s=f().getParser(i),o=s.getEngine();if(s.satisfies({chrome:">=111",chromium:">=111","microsoft edge":">=111"}))return"Chrome111";if(s.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(s.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(s.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(s.satisfies({firefox:">=111"}))return"Firefox111";if(s.satisfies({firefox:">=60"}))return"Firefox60";if(s.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if("iOS"===(null===(t=null===(e=s.parsedResult)||void 0===e?void 0:e.os)||void 0===t?void 0:t.name)&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(s.satisfies({"microsoft edge":">=11"})&&s.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(o.name&&"blink"===o.name.toLowerCase()){const e=i.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(e){const t=Number(e[1]);return t>=111?"Chrome111":t>=74?"Chrome74":"Chrome70"}return"Chrome111"}return"iOS"===(null===(n=null===(r=s.parsedResult)||void 0===r?void 0:r.os)||void 0===n?void 0:n.name)&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")||o.name&&"webkit"===o.name.toLowerCase()&&o.version&&parseFloat(o.version)>605?"Safari12":void _c.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",s.getBrowserName(),s.getBrowserVersion())}_c.warn("this._detectDevice() | unknown device")}(),!e)throw new Aa("device not supported");_c.debug("constructor() | detected handler: %s",e)}this.switchDevice(e)}const n=this._handlerFactory();this._handlerName=n.name,n.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new Pa("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new Pa("not loaded");return this._sctpCapabilities}get observer(){return this._observer}load(e){return tr(this,arguments,(function*({routerRtpCapabilities:e}){let t;_c.debug("load() [routerRtpCapabilities:%o]",e),e=Da(e,void 0);try{if(this._loaded)throw new Pa("already loaded");Na(e),t=this._handlerFactory();const r=yield t.getNativeRtpCapabilities();_c.debug("load() | got native RTP capabilities:%o",r),Na(r),this._extendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const n of t.codecs||[]){if(za(n))continue;const t=(e.codecs||[]).find((e=>Ja(e,n,{strict:!0,modify:!0})));if(!t)continue;const i={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:n.parameters,rtcpFeedback:Qa(t,n)};r.codecs.push(i)}for(const n of r.codecs){const r=e.codecs.find((e=>za(e)&&e.parameters.apt===n.localPayloadType)),i=t.codecs.find((e=>za(e)&&e.parameters.apt===n.remotePayloadType));r&&i&&(n.localRtxPayloadType=r.preferredPayloadType,n.remoteRtxPayloadType=i.preferredPayloadType)}for(const n of t.headerExtensions){const t=e.headerExtensions.find((e=>Ka(e,n)));if(!t)continue;const i={kind:n.kind,uri:n.uri,sendId:t.preferredId,recvId:n.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(n.direction){case"sendrecv":i.direction="sendrecv";break;case"recvonly":i.direction="sendonly";break;case"sendonly":i.direction="recvonly";break;case"inactive":i.direction="inactive"}r.headerExtensions.push(i)}return r}(r,e),_c.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=$a("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=$a("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const n={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(n)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t}(this._extendedRtpCapabilities),Na(this._recvRtpCapabilities),_c.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=yield t.getNativeSctpCapabilities(),_c.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");!function(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}(e.numStreams)}(this._sctpCapabilities),_c.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}))}canProduce(e){if(!this._loaded)throw new Pa("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d}){return _c.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d}){return _c.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,appData:d})}createTransport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l}){if(!this._loaded)throw new Pa("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(n))throw new TypeError("missing iceCandidates");if("object"!=typeof i)throw new TypeError("missing dtlsParameters");if(s&&"object"!=typeof s)throw new TypeError("wrong sctpParameters");if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");const u=new yc({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:s,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",u),u}}function Tc({sdpObject:e}){const t=new Map,r=[];let n=!1,i=!1;for(const s of e.media){const e=s.type;switch(e){case"audio":if(n)continue;n=!0;break;case"video":if(i)continue;i=!0;break;default:continue}for(const r of s.rtp){const n={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(n.preferredPayloadType,n)}for(const e of s.fmtp||[]){const r=g.Sl(e.config),n=t.get(e.payload);n&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),n.parameters=r)}for(const r of s.rtcpFb||[]){const n={type:r.type,parameter:r.subtype};if(n.parameter||delete n.parameter,"*"!==r.payload){const e=t.get(r.payload);if(!e)continue;e.rtcpFeedback.push(n)}else for(const r of t.values())r.kind===e&&!/.+\/rtx$/i.test(r.mimeType)&&r.rtcpFeedback.push(n)}for(const t of s.ext||[]){if(t["encrypt-uri"])continue;const n={kind:e,uri:t.uri,preferredId:t.value};r.push(n)}}return{codecs:Array.from(t.values()),headerExtensions:r}}function Ec({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let n;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}}function bc({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""}function wc({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e||!(t.rtp||[]).find((e=>e.payload===r.payloadType)))continue;t.fmtp=t.fmtp||[];let n=t.fmtp.find((e=>e.payload===r.payloadType));n||(n={payload:r.payloadType,config:""},t.fmtp.push(n));const i=g.Sl(n.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(i.stereo=e?1:0);break}}n.config="";for(const e of Object.keys(i))n.config&&(n.config+=";"),n.config+=`${e}=${i[e]}`}}function kc({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const n of e.ssrcGroups||[]){if("FID"!==n.semantics)continue;let[e,i]=n.ssrcs.split(/\s+/);e=Number(e),i=Number(i),t.has(e)&&(t.delete(e),t.delete(i),r.set(e,i))}for(const e of t)r.set(e,null);const n=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),n.push(r)}return n}function Rc({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new Error("a=ssrc line with msid information not found");const[n,i]=r.value.split(" "),s=r.id;let o;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===s&&(o=Number(t[1]),!0)}));const a=e.ssrcs.find((e=>"cname"===e.attribute));if(!a)throw new Error("a=ssrc line with cname information not found");const c=a.value,d=[],l=[];for(let e=0;e<t;++e)d.push(s+e),o&&l.push(o+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let t=0;t<d.length;++t){const r=d[t];e.ssrcs.push({id:r,attribute:"cname",value:c}),e.ssrcs.push({id:r,attribute:"msid",value:`${n} ${i}`})}for(let t=0;t<l.length;++t){const r=d[t],s=l[t];e.ssrcs.push({id:s,attribute:"cname",value:c}),e.ssrcs.push({id:s,attribute:"msid",value:`${n} ${i}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${s}`})}}let Cc=class extends Ia{constructor(){super()}};class Ic{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:n=!1}){if(this._mediaObject={},this._planB=n,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}muxSimulcastStreams(e){if(this._mediaObject.simulcast&&this._mediaObject.simulcast.list1){const t={};e.forEach((e=>{e.rid&&(t[e.rid]=e)}));const r=this._mediaObject.simulcast.list1,n=g.hy(r);n.forEach((e=>{e.forEach((e=>{var r;e.paused=!(null!==(r=t[e.scid])&&void 0!==r&&r.active)}))})),this._mediaObject.simulcast.list1=n.map((e=>e.map((e=>`${e.paused?"~":""}${e.scid}`)).join(","))).join(";")}}}class Ac extends Ic{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:s=!1,offerMediaObject:o,offerRtpParameters:a,answerRtpParameters:c,codecOptions:d,extmapAllowMixed:l=!1,forceGoogConference:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:s}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of c.codecs){const t={payload:e.payloadType,codec:Dc(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=Da(e.parameters,{});if(d){const{opusStereo:t,opusFec:n,opusDtx:i,opusMaxPlaybackRate:s,opusMaxAverageBitrate:o,opusPtime:c,videoGoogleStartBitrate:l,videoGoogleMaxBitrate:u,videoGoogleMinBitrate:h}=d,p=a.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(p.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==n&&(p.parameters.useinbandfec=n?1:0,r.useinbandfec=n?1:0),void 0!==i&&(p.parameters.usedtx=i?1:0,r.usedtx=i?1:0),void 0!==s&&(r.maxplaybackrate=s),void 0!==o&&(r.maxaveragebitrate=o),void 0!==c&&(p.parameters.ptime=c,r.ptime=c);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==l&&(r["x-google-start-bitrate"]=l),void 0!==u&&(r["x-google-max-bitrate"]=u),void 0!==h&&(r["x-google-min-bitrate"]=h)}}const n={payload:e.payloadType,config:""};for(const e of Object.keys(r))n.config&&(n.config+=";"),n.config+=`${e}=${r[e]}`;n.config&&this._mediaObject.fmtp.push(n);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions)(o.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id});if(l&&"extmap-allow-mixed"===o.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",(this._planB||u)&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof o.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var t;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const r={};for(const t of e)t.rid&&(r[t.rid]=t);const n=this._mediaObject.simulcast.list1,i=g.hy(n);for(const e of i)for(const n of e)n.paused=!(null!==(t=r[n.scid])&&void 0!==t&&t.active);this._mediaObject.simulcast.list1=i.map((e=>e.map((e=>`${e.paused?"~":""}${e.scid}`)).join(","))).join(";")}}class Pc extends Ic{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:s=!1,mid:o,kind:a,offerRtpParameters:c,streamId:d,trackId:l,oldDataChannelSpec:u=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:s}),this._mediaObject.mid=String(o),this._mediaObject.type=a,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),a){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${d||"-"} ${l}`);for(const e of c.codecs){const t={payload:e.payloadType,codec:Dc(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(const t of Object.keys(e.parameters))r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=c.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of c.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=c.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${d||"-"} ${l}`}),r&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${d||"-"} ${l}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":u?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const n=e.encodings[0],i=n.ssrc,s=n.rtx&&n.rtx.ssrc?n.rtx.ssrc:void 0,o=this._mediaObject.payloads.split(" ");for(const t of e.codecs){if(o.includes(String(t.payloadType)))continue;const e={payload:t.payloadType,codec:Dc(t),rate:t.clockRate};t.channels>1&&(e.encoding=t.channels),this._mediaObject.rtp.push(e);const r={payload:t.payloadType,config:""};for(const e of Object.keys(t.parameters))r.config&&(r.config+=";"),r.config+=`${e}=${t.parameters[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const e of t.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:e.type,subtype:e.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter((e=>!this._mediaObject.payloads.includes(e.payloadType))).map((e=>e.payloadType)).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t||"-"} ${r}`}),s&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${s}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==n)),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${n}`)))}}function Dc(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}const Oc=new Ra("RemoteSdp");class Mc{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:s=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=n,this._plainRtpParameters=i,this._planB=s,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}i&&(this._sdpObject.origin.address=i.ip,this._sdpObject.origin.ipVer=i.ipVersion)}updateIceParameters(e){Oc.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){Oc.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:n,codecOptions:i,extmapAllowMixed:s=!1,forceGoogConference:o=!1}){const a=new Ac({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:n,codecOptions:i,extmapAllowMixed:s,forceGoogConference:o});t?this._replaceMediaSection(a,t):this._midToIndex.has(a.mid)?this._replaceMediaSection(a):this._addMediaSection(a)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i}){const s=this._midToIndex.get(e);let o;if(void 0!==s&&(o=this._mediaSections[s]),o)o.planBReceive({offerRtpParameters:r,streamId:n,trackId:i}),this._replaceMediaSection(o);else{o=new Pc({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i});const s=this._mediaSections.find((e=>e.closed));s?this._replaceMediaSection(o,s.mid):this._addMediaSection(o)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const t=this._findMediaSection(e);return e===this._firstMid?(Oc.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){const r=this._midToIndex.get(e);if(void 0===r)throw new Error(`no media section found with mid '${e}'`);const n=this._mediaSections[r];if(void 0===n)throw new Error(`no media section found with idx '${r}'`);n.muxSimulcastStreams(t),this._replaceMediaSection(n)}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._findMediaSection(e);r.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const t=new Ac({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new Pc({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,g.M9(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_findMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}const Nc=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function xc(e){const t=Nc.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}const Lc=new Ra("Chrome70"),Uc={OS:1024,MIS:1024};class jc extends Cc{static createFactory(){return()=>new jc}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(Lc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Lc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Tc({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Lc.debug("getNativeSctpCapabilities()"),{numStreams:Uc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Lc.debug("run()"),this._direction=e,this._remoteSdp=new Mc({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Wa("audio",d),video:Wa("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection($t({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(Lc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){return tr(this,null,(function*(){Lc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Lc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Lc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Lc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:n}){var i;this.assertSendDirection(),Lc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=qa(s.codecs,n);const o=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=qa(o.codecs,n);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d,l=yield this._pc.createOffer(),u=g.qg(l.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:u})),t&&t.length>1&&(Lc.debug("send() | enabling legacy simulcast"),u=g.qg(l.sdp),d=u.media[a.idx],Rc({offerMediaObject:d,numStreams:t.length}),l={type:"offer",sdp:g.M9(u)});let h=!1;const p=xc((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&p.spatialLayers>1&&"video/vp9"===s.codecs[0].mimeType.toLowerCase()&&(Lc.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,u=g.qg(l.sdp),d=u.media[a.idx],Rc({offerMediaObject:d,numStreams:p.spatialLayers}),l={type:"offer",sdp:g.M9(u)}),Lc.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),yield this._pc.setLocalDescription(l),t){Lc.debug("send() | applying given encodings");const e=c.sender.getParameters();for(let r=0;r<(e.encodings||[]).length;++r){const n=e.encodings[r],i=t[r];if(!i)break;e.encodings[r]=Object.assign(n,i)}yield c.sender.setParameters(e)}const m=c.mid;if(s.mid=m,u=g.qg(this._pc.localDescription.sdp),d=u.media[a.idx],s.rtcp.cname=bc({offerMediaObject:d}),s.encodings=kc({offerMediaObject:d}),t)for(let e=0;e<s.encodings.length;++e)t[e]&&Object.assign(s.encodings[e],t[e]);if(h&&(s.encodings=[s.encodings[0]]),s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};return Lc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),yield this._pc.setRemoteDescription(f),this._mapMidTransceiver.set(m,c),{localId:m,rtpParameters:s,rtpSender:c.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Lc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Lc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){}))}resumeSending(e){return tr(this,null,(function*(){}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Lc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Lc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Lc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Lc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Lc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Lc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:i};Lc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(n,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Uc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Lc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};Lc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],n=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:i,streamId:s}=t;Lc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=i.mid||String(this._mapMidTransceiver.size);n.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),yield this._pc.setRemoteDescription(i);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,i=n.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===i))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Lc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,i=n.get(e),s=this._pc.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(i,s),r.push({localId:i,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Lc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Lc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){}))}resumeReceiving(e){return tr(this,null,(function*(){}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var n;this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:a,protocol:r};Lc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Lc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}Lc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Ec({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}const Fc=new Ra("Chrome74"),Vc={OS:1024,MIS:1024};let Bc=class e extends Cc{static createFactory(){return()=>new e}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(Fc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Fc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Tc({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Fc.debug("getNativeSctpCapabilities()"),{numStreams:Vc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Fc.debug("run()"),this._direction=e,this._remoteSdp=new Mc({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Wa("audio",d),video:Wa("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection($t({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(Fc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}updateIceServers(e){return tr(this,null,(function*(){Fc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Fc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Fc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Fc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:n}){var i,s;this.assertSendDirection(),Fc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach(((e,t)=>{e.rid=`r${t}`}));const o=Da(this._sendingRtpParametersByKind[e.kind],{});o.codecs=qa(o.codecs,n);const a=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});a.codecs=qa(a.codecs,n);const c=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let l,u=yield this._pc.createOffer(),h=g.qg(u.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:h}));let p=!1;const m=xc((t||[{}])[0].scalabilityMode);t&&1===t.length&&m.spatialLayers>1&&"video/vp9"===o.codecs[0].mimeType.toLowerCase()&&(Fc.debug("send() | enabling legacy simulcast for VP9 SVC"),p=!0,h=g.qg(u.sdp),l=h.media[c.idx],Rc({offerMediaObject:l,numStreams:m.spatialLayers}),u={type:"offer",sdp:g.M9(h)}),Fc.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),yield this._pc.setLocalDescription(u);const f=d.mid;if(o.mid=f,h=g.qg(this._pc.localDescription.sdp),l=h.media[c.idx],o.rtcp.cname=bc({offerMediaObject:l}),t)if(1===t.length){let e=kc({offerMediaObject:l});Object.assign(e[0],t[0]),p&&(e=[e[0]]),o.encodings=e}else o.encodings=t;else o.encodings=kc({offerMediaObject:l});if(o.encodings.length>1&&("video/vp8"===o.codecs[0].mimeType.toLowerCase()||"video/h264"===o.codecs[0].mimeType.toLowerCase()))for(const e of o.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${m.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:l,reuseMid:c.reuseMid,offerRtpParameters:o,answerRtpParameters:a,codecOptions:r,extmapAllowMixed:!0,forceGoogConference:null!==(s=null==r?void 0:r.forceGoogConference)&&void 0!==s&&s});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return Fc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),yield this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(f,d),{localId:f,rtpParameters:o,rtpSender:d.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Fc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Fc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=yield this._pc.createOffer();Fc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Fc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Fc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Fc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Fc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Fc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};Fc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(n,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Vc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Fc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};Fc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],n=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:i,streamId:s}=t;Fc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=i.mid||String(this._mapMidTransceiver.size);n.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),yield this._pc.setRemoteDescription(i);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,i=n.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===i))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Fc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,i=n.get(e),s=this._pc.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(i,s),r.push({localId:i,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Fc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Fc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Fc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Fc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Fc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Fc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var n;this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:r};Fc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Fc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}Fc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Ec({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}};const Hc=new Ra("Chrome111"),Wc={OS:1024,MIS:1024};class Gc extends Cc{static createFactory(){return()=>new Gc}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(Hc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Hc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Tc({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Hc.debug("getNativeSctpCapabilities()"),{numStreams:Wc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Hc.debug("run()"),this._direction=e,this._remoteSdp=new Mc({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Wa("audio",d),video:Wa("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection($t({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(Hc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}updateIceServers(e){return tr(this,null,(function*(){Hc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Hc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Hc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Hc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Hc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Hc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:n}){var i;if(this.assertSendDirection(),Hc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){t.forEach(((e,t)=>{e.rid=`r${t}`}));let e=1,r=1;for(const e of t){const t=e.scalabilityMode?xc(e.scalabilityMode).temporalLayers:3;t>r&&(r=t)}for(const n of t)n.rid="r"+e++,n.scalabilityMode=`L1T${r}`}const s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=qa(s.codecs,n);const o=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=qa(o.codecs,n);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),d=yield this._pc.createOffer();let l=g.qg(d.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:l})),Hc.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),yield this._pc.setLocalDescription(d);const u=c.mid;s.mid=u,l=g.qg(this._pc.localDescription.sdp);const h=l.media[a.idx];if(s.rtcp.cname=bc({offerMediaObject:h}),t)if(1===t.length){const e=kc({offerMediaObject:h});Object.assign(e[0],t[0]),s.encodings=e}else s.encodings=t;else s.encodings=kc({offerMediaObject:h});this._remoteSdp.send({offerMediaObject:h,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});const p={type:"answer",sdp:this._remoteSdp.getSdp()};return Hc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),yield this._pc.setRemoteDescription(p),this._mapMidTransceiver.set(u,c),{localId:u,rtpParameters:s,rtpSender:c.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Hc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Hc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Hc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Hc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Hc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Hc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Hc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=yield this._pc.createOffer();Hc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Hc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Hc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Hc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Hc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Hc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Hc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Hc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Hc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Hc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};Hc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(n,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Wc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Hc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};Hc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],n=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:i,streamId:s}=t;Hc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=i.mid||String(this._mapMidTransceiver.size);n.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Hc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),yield this._pc.setRemoteDescription(i);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,i=n.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===i))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Hc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,i=n.get(e),s=this._pc.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(i,s),r.push({localId:i,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Hc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Hc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Hc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Hc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Hc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Hc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Hc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Hc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Hc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var n;this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:r};Hc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Hc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}Hc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Ec({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}function qc(e){const t=Da(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const e of t.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return t}const $c=new Ra("Edge11");class zc extends Cc{static createFactory(){return()=>new zc}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){$c.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){return $c.debug("getNativeRtpCapabilities()"),function(){const e=Da(RTCRtpReceiver.getCapabilities(),{});for(const t of e.codecs){if(t.channels=t.numChannels,delete t.numChannels,t.mimeType=t.mimeType||`${t.kind}/${t.name}`,t.parameters){const e=t.parameters;e.apt&&(e.apt=Number(e.apt)),e["packetization-mode"]&&(e["packetization-mode"]=Number(e["packetization-mode"]))}for(const e of t.rtcpFeedback||[])e.parameter||(e.parameter="")}return e}()}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return $c.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){$c.debug("run()"),this._sendingRtpParametersByKind={audio:Wa("audio",d),video:Wa("video",d)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname=`CNAME-${Oa()}`,this.setIceGatherer({iceServers:s,iceTransportPolicy:o}),this.setIceTransport(),this.setDtlsTransport()}updateIceServers(e){return tr(this,null,(function*(){throw new Aa("not supported")}))}restartIce(e){return tr(this,null,(function*(){if($c.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){$c.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}))}getTransportStats(){return tr(this,null,(function*(){return this._iceTransport.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:n}){$c.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"})),$c.debug("send() | calling new RTCRtpSender()");const i=new RTCRtpSender(e,this._dtlsTransport),s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=qa(s.codecs,n);const o=s.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType)));t||(t=[{}]);for(const e of t)e.ssrc=Oa(),o&&(e.rtx={ssrc:Oa()});s.encodings=t,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const a=qc(s);$c.debug("send() | calling rtpSender.send() [params:%o]",a),yield i.send(a);const c=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(c,i),{localId:c,rtpParameters:s,rtpSender:i}}))}stopSending(e){return tr(this,null,(function*(){$c.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{$c.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw $c.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}))}pauseSending(e){return tr(this,null,(function*(){}))}resumeSending(e){return tr(this,null,(function*(){}))}replaceTrack(e,t){return tr(this,null,(function*(){t?$c.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):$c.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){$c.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.setParameters(n)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){$c.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.setParameters(n)}))}getSenderStats(e){return tr(this,null,(function*(){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}))}sendDataChannel(e){return tr(this,null,(function*(){throw new Aa("not implemented")}))}receive(e){return tr(this,null,(function*(){const t=[];for(const t of e){const{trackId:e,kind:r}=t;$c.debug("receive() [trackId:%s, kind:%s]",e,r)}this._transportReady||(yield this.setupTransport({localDtlsRole:"server"}));for(const r of e){const{trackId:e,kind:n,rtpParameters:i}=r;$c.debug("receive() | calling new RTCRtpReceiver()");const s=new RTCRtpReceiver(this._dtlsTransport,n);s.addEventListener("error",(e=>{$c.error('rtpReceiver "error" event [event:%o]',e)}));const o=qc(i);$c.debug("receive() | calling rtpReceiver.receive() [params:%o]",o),yield s.receive(o);const a=e;this._rtpReceivers.set(a,s),t.push({localId:a,track:s.track,rtpReceiver:s})}return t}))}stopReceiving(e){return tr(this,null,(function*(){for(const t of e){$c.debug("stopReceiving() [localId:%s]",t);const e=this._rtpReceivers.get(t);if(!e)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(t);try{$c.debug("stopReceiving() | calling rtpReceiver.stop()"),e.stop()}catch(e){$c.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}}))}pauseReceiving(e){return tr(this,null,(function*(){}))}resumeReceiving(e){return tr(this,null,(function*(){}))}getReceiverStats(e){return tr(this,null,(function*(){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}))}receiveDataChannel(e){return tr(this,null,(function*(){throw new Aa("not implemented")}))}setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",(e=>{$c.error('iceGatherer "error" event [event:%o]',e)}));try{r.gather()}catch(e){$c.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{$c.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{$c.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{$c.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{$c.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e}){$c.debug("setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,yield new Promise(((e,r)=>{this.safeEmit("@connect",{dtlsParameters:t},e,r)})),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}))}}const Jc=new Ra("Firefox60"),Kc={OS:16,MIS:2048};let Qc=class e extends Cc{static createFactory(t=!1){return()=>new e(t)}constructor(e=!1){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1,this.supportsSendEncoding=!1,this.supportsSendEncoding=e}get name(){return"Firefox60"}close(){if(Jc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Jc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const n=e.addTransceiver(r,{direction:"sendrecv"}),i=n.sender.getParameters(),s=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];i.encodings=s,yield n.sender.setParameters(i);const o=yield e.createOffer();try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}return Tc({sdpObject:g.qg(o.sdp)})}catch(n){try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}throw n}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Jc.debug("getNativeSctpCapabilities()"),{numStreams:Kc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Jc.debug("run()"),this._direction=e,this._remoteSdp=new Mc({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Wa("audio",d),video:Wa("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},this._pc=new RTCPeerConnection($t({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(Jc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){return tr(this,null,(function*(){throw new Aa("not supported")}))}restartIce(e){return tr(this,null,(function*(){if(Jc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Jc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Jc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),Jc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=Da(t,[])).length>1&&(t.forEach(((e,t)=>{e.rid=`r${t}`})),t.reverse());const i=Da(this._sendingRtpParametersByKind[e.kind],{});i.codecs=qa(i.codecs,n);const s=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=qa(s.codecs,n);const o=this.supportsSendEncoding&&void 0!==t?{sendEncodings:t}:{},a=this._pc.addTransceiver(e,$t({direction:"sendonly",streams:[this._sendStream]},o));if(!this.supportsSendEncoding&&t){const e=a.sender.getParameters();e.encodings=t,yield a.sender.setParameters(e)}const c=yield this._pc.createOffer();let d=g.qg(c.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:d}));const l=xc((t||[{}])[0].scalabilityMode);Jc.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),yield this._pc.setLocalDescription(c);const u=a.mid;i.mid=u,d=g.qg(this._pc.localDescription.sdp);const h=d.media[d.media.length-1];if(i.rtcp.cname=bc({offerMediaObject:h}),t)if(1===t.length){const e=kc({offerMediaObject:h});Object.assign(e[0],t[0]),i.encodings=e}else i.encodings=t.reverse();else i.encodings=kc({offerMediaObject:h});if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${l.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:h,offerRtpParameters:i,answerRtpParameters:s,codecOptions:r,extmapAllowMixed:!0});const p={type:"answer",sdp:this._remoteSdp.getSdp()};return Jc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),yield this._pc.setRemoteDescription(p),this._mapMidTransceiver.set(u,a),{localId:u,rtpParameters:i,rtpSender:a.sender}}))}stopSending(e){return tr(this,null,(function*(){Jc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=yield this._pc.createOffer();Jc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Jc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=yield this._pc.createOffer();Jc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Jc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Jc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const n=r.sender.getParameters();t=n.encodings.length-1-t,n.encodings.forEach(((e,r)=>{e.active=r>=t})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Jc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Jc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Jc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};Jc.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(n,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Kc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:t})),Jc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};Jc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=[],r=new Map;for(const t of e){const{trackId:e,kind:n,rtpParameters:i,streamId:s}=t;Jc.debug("receive() [trackId:%s, kind:%s]",e,n);const o=i.mid||String(this._mapMidTransceiver.size);r.set(e,o),this._remoteSdp.receive({mid:o,kind:n,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),yield this._pc.setRemoteDescription(n);let i=yield this._pc.createAnswer();const s=g.qg(i.sdp);for(const t of e){const{trackId:e,rtpParameters:n}=t,o=r.get(e);wc({offerRtpParameters:n,answerMediaObject:s.media.find((e=>String(e.mid)===o))}),i={type:"answer",sdp:g.M9(s)}}this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:s})),Jc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),yield this._pc.setLocalDescription(i);for(const n of e){const{trackId:e}=n,i=r.get(e),s=this._pc.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(i,s),t.push({localId:i,track:s.receiver.track,rtpReceiver:s.receiver})}return t}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Jc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Jc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Jc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Jc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Jc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Jc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:s,maxRetransmits:o}=e,a={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:s,maxRetransmits:o,protocol:r};Jc.debug("receiveDataChannel() [options:%o]",a);const c=this._pc.createDataChannel(t,a);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Jc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:"client",localSdpObject:e})}Jc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Ec({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}};const Yc=new Ra("Safari12"),Xc={OS:1024,MIS:1024};let Zc=class e extends Cc{static createFactory(){return()=>new e}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(Yc.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return tr(this,null,(function*(){Yc.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=yield e.createOffer();try{e.close()}catch(e){}return Tc({sdpObject:g.qg(t.sdp)})}catch(t){try{e.close()}catch(e){}throw t}}))}getNativeSctpCapabilities(){return tr(this,null,(function*(){return Yc.debug("getNativeSctpCapabilities()"),{numStreams:Xc}}))}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:d}){Yc.debug("run()"),this._direction=e,this._remoteSdp=new Mc({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._sendingRtpParametersByKind={audio:Wa("audio",d),video:Wa("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ga("audio",d),video:Ga("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection($t({iceServers:s||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},a),c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(Yc.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){return tr(this,null,(function*(){Yc.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(e){return tr(this,null,(function*(){if(Yc.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=yield this._pc.createOffer({iceRestart:!0});Yc.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};Yc.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};Yc.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();Yc.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t)}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,codec:n}){var i;this.assertSendDirection(),Yc.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=Da(this._sendingRtpParametersByKind[e.kind],{});s.codecs=qa(s.codecs,n);const o=Da(this._sendingRemoteRtpParametersByKind[e.kind],{});o.codecs=qa(o.codecs,n);const a=this._remoteSdp.getNextMediaSectionIdx(),c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let d,l=yield this._pc.createOffer(),u=g.qg(l.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(i=this._forcedLocalDtlsRole)&&void 0!==i?i:"client",localSdpObject:u}));const h=xc((t||[{}])[0].scalabilityMode);t&&t.length>1&&(Yc.debug("send() | enabling legacy simulcast"),u=g.qg(l.sdp),d=u.media[a.idx],Rc({offerMediaObject:d,numStreams:t.length}),l={type:"offer",sdp:g.M9(u)}),Yc.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),yield this._pc.setLocalDescription(l);const p=c.mid;if(s.mid=p,u=g.qg(this._pc.localDescription.sdp),d=u.media[a.idx],s.rtcp.cname=bc({offerMediaObject:d}),s.encodings=kc({offerMediaObject:d}),t)for(let e=0;e<s.encodings.length;++e)t[e]&&Object.assign(s.encodings[e],t[e]);if(s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const e of s.encodings)e.scalabilityMode?e.scalabilityMode=`L1T${h.temporalLayers}`:e.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,reuseMid:a.reuseMid,offerRtpParameters:s,answerRtpParameters:o,codecOptions:r});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return Yc.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),yield this._pc.setRemoteDescription(m),this._mapMidTransceiver.set(p,c),{localId:p,rtpParameters:s,rtpSender:c.sender}}))}stopSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Yc.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}const r=yield this._pc.createOffer();Yc.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Yc.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}))}pauseSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Yc.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=yield this._pc.createOffer();Yc.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Yc.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}resumeSending(e){return tr(this,null,(function*(){this.assertSendDirection(),Yc.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=yield this._pc.createOffer();Yc.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),yield this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};Yc.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n)}))}replaceTrack(e,t){return tr(this,null,(function*(){this.assertSendDirection(),t?Yc.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):Yc.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Yc.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Yc.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Yc.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this.assertSendDirection(),Yc.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const i=yield this._pc.createOffer();Yc.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",i),yield this._pc.setLocalDescription(i);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Yc.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),yield this._pc.setRemoteDescription(s)}))}getSenderStats(e){return tr(this,null,(function*(){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}))}sendDataChannel(e){return tr(this,arguments,(function*({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){var s;this.assertSendDirection();const o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};Yc.debug("sendDataChannel() [options:%o]",o);const a=this._pc.createDataChannel(n,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Xc.MIS,!this._hasDataChannelMediaSection){const e=yield this._pc.createOffer(),t=g.qg(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(s=this._forcedLocalDtlsRole)&&void 0!==s?s:"client",localSdpObject:t})),Yc.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),yield this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};Yc.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),yield this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits}}}))}receive(e){return tr(this,null,(function*(){var t;this.assertRecvDirection();const r=[],n=new Map;for(const t of e){const{trackId:e,kind:r,rtpParameters:i,streamId:s}=t;Yc.debug("receive() [trackId:%s, kind:%s]",e,r);const o=i.mid||String(this._mapMidTransceiver.size);n.set(e,o),this._remoteSdp.receive({mid:o,kind:r,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:e})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Yc.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),yield this._pc.setRemoteDescription(i);let s=yield this._pc.createAnswer();const o=g.qg(s.sdp);for(const t of e){const{trackId:e,rtpParameters:r}=t,i=n.get(e);wc({offerRtpParameters:r,answerMediaObject:o.media.find((e=>String(e.mid)===i))})}s={type:"answer",sdp:g.M9(o)},this._transportReady||(yield this.setupTransport({localDtlsRole:null!==(t=this._forcedLocalDtlsRole)&&void 0!==t?t:"client",localSdpObject:o})),Yc.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),yield this._pc.setLocalDescription(s);for(const t of e){const{trackId:e}=t,i=n.get(e),s=this._pc.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(i,s),r.push({localId:i,track:s.receiver.track,rtpReceiver:s.receiver})}return r}))}stopReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Yc.debug("stopReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Yc.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Yc.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r);for(const t of e)this._mapMidTransceiver.delete(t)}))}pauseReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Yc.debug("pauseReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Yc.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Yc.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}resumeReceiving(e){return tr(this,null,(function*(){this.assertRecvDirection();for(const t of e){Yc.debug("resumeReceiving() [localId:%s]",t);const e=this._mapMidTransceiver.get(t);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(t)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};Yc.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),yield this._pc.setRemoteDescription(t);const r=yield this._pc.createAnswer();Yc.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),yield this._pc.setLocalDescription(r)}))}getReceiverStats(e){return tr(this,null,(function*(){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}receiveDataChannel(e){return tr(this,arguments,(function*({sctpStreamParameters:e,label:t,protocol:r}){var n;this.assertRecvDirection();const{streamId:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a}=e,c={negotiated:!0,id:i,ordered:s,maxPacketLifeTime:o,maxRetransmits:a,protocol:r};Yc.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};Yc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),yield this._pc.setRemoteDescription(e);const t=yield this._pc.createAnswer();if(!this._transportReady){const e=g.qg(t.sdp);yield this.setupTransport({localDtlsRole:null!==(n=this._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:e})}Yc.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),yield this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}))}setupTransport(e){return tr(this,arguments,(function*({localDtlsRole:e,localSdpObject:t}){t||(t=g.qg(this._pc.localDescription.sdp));const r=Ec({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),yield new Promise(((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)})),this._transportReady=!0}))}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},ed=class extends Sc{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){super({handlerName:e,handlerFactory:t,Handler:r})}switchDevice(e){switch(e){case"Chrome111":this._handlerFactory=Gc.createFactory();break;case"Chrome74":this._handlerFactory=Bc.createFactory();break;case"Chrome70":this._handlerFactory=jc.createFactory();break;case"Firefox111":this._handlerFactory=Qc.createFactory(!0);break;case"Firefox60":this._handlerFactory=Qc.createFactory(!1);break;case"Safari12":this._handlerFactory=Zc.createFactory();break;case"Edge11":this._handlerFactory=zc.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}};const td={roomName:void 0,authToken:void 0,peerId:void 0,apiBase:void 0,baseURI:void 0,defaults:{audio:!0,video:!0},modules:void 0,organizationId:void 0,overrides:{},viewType:void 0,env:void 0};function rd(e){var t;null!=td.roomName||(td.roomName=null==e?void 0:e.roomName),null!=td.authToken||(td.authToken=null==e?void 0:e.authToken),null!=td.peerId||(td.peerId=null==e?void 0:e.peerId),null!=td.apiBase||(td.apiBase=null==e?void 0:e.apiBase),null!=td.baseURI||(td.baseURI=null==e?void 0:e.baseURI),null!=td.modules||(td.modules=null==e?void 0:e.modules),null!=td.organizationId||(td.organizationId=null==e?void 0:e.organizationId),td.defaults=$t($t({},td.defaults),null!=(t=null==e?void 0:e.defaults)?t:{}),null!=td.env||(td.env=Nr),td.apiBase&&(td.apiBase.includes("api.cluster.dyte")||td.apiBase.includes("api.dyte")?td.env=Nr:td.apiBase.includes("api.preprod.dyte")?td.env="preprod":td.apiBase.includes("api.devel.dyte")&&(td.env="devel"))}const nd="1.30.0",id="web-core";function sd({servicePrefix:e,apiBase:t,baseURI:r}){return r?`${e}.${r}`:null!=t&&t.includes("api.preprod.dyte")?`${e}.preprod.dyte.io`:null!=t&&t.includes("api.devel.dyte")?`${e}.devel.dyte.io`:`${e}.dyte.io`}var od=NaN;function ad(e){return"number"==typeof e?e:Jo(e)?od:+e}function cd(e,t){return function(r,n){var i;if(void 0===r&&void 0===n)return t;if(void 0!==r&&(i=r),void 0!==n){if(void 0===i)return n;"string"==typeof r||"string"==typeof n?(r=da(r),n=da(n)):(r=ad(r),n=ad(n)),i=e(r,n)}return i}}var dd=cd((function(e,t){return e+t}),0);const ld=dd;var ud=/\s/;function hd(e){for(var t=e.length;t--&&ud.test(e.charAt(t)););return t}var pd=/^\s+/;function md(e){return e&&e.slice(0,hd(e)+1).replace(pd,"")}var fd=NaN,gd=/^[-+]0x[0-9a-f]+$/i,vd=/^0b[01]+$/i,yd=/^0o[0-7]+$/i,_d=parseInt;function Sd(e){if("number"==typeof e)return e;if(Jo(e))return fd;if(Yn(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Yn(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=md(e);var r=vd.test(e);return r||yd.test(e)?_d(e.slice(2),r?2:8):gd.test(e)?fd:+e}var Td=1/0,Ed=17976931348623157e292;function bd(e){return e?(e=Sd(e))===Td||e===-Td?(e<0?-1:1)*Ed:e==e?e:0:0===e?e:0}function wd(e){var t=bd(e),r=t%1;return t==t?r?t-r:t:0}function kd(e){return e}const Rd=Fs&&new Fs;var Cd=Rd?function(e,t){return Rd.set(e,t),e}:kd;const Id=Cd;function Ad(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Co(e.prototype),n=e.apply(r,t);return Yn(n)?n:r}}var Pd=1;function Dd(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var Od=Math.max;function Md(e,t,r,n){for(var i=-1,s=e.length,o=r.length,a=-1,c=t.length,d=Od(s-o,0),l=Array(c+d),u=!n;++a<c;)l[a]=t[a];for(;++i<o;)(u||i<s)&&(l[r[i]]=e[i]);for(;d--;)l[a++]=e[i++];return l}var Nd=Math.max;function xd(e,t,r,n){for(var i=-1,s=e.length,o=-1,a=r.length,c=-1,d=t.length,l=Nd(s-a,0),u=Array(l+d),h=!n;++i<l;)u[i]=e[i];for(var p=i;++c<d;)u[p+c]=t[c];for(;++o<a;)(h||i<s)&&(u[p+r[o]]=e[i++]);return u}function Ld(){}var Ud=4294967295;function jd(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ud,this.__views__=[]}function Fd(){}jd.prototype=Co(Ld.prototype),jd.prototype.constructor=jd;var Vd=Rd?function(e){return Rd.get(e)}:Fd;const Bd=Vd,Hd={};var Wd=Object.prototype.hasOwnProperty;function Gd(e){for(var t=e.name+"",r=Hd[t],n=Wd.call(Hd,t)?r.length:0;n--;){var i=r[n],s=i.func;if(null==s||s==e)return i.name}return t}function qd(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function $d(e){if(e instanceof jd)return e.clone();var t=new qd(e.__wrapped__,e.__chain__);return t.__actions__=Es(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}qd.prototype=Co(Ld.prototype),qd.prototype.constructor=qd;var zd=Object.prototype.hasOwnProperty;function Jd(e){if(Di(e)&&!ji(e)&&!(e instanceof jd)){if(e instanceof qd)return e;if(zd.call(e,"__wrapped__"))return $d(e)}return new qd(e)}function Kd(e){var t=Gd(e),r=Jd[t];if("function"!=typeof r||!(t in jd.prototype))return!1;if(e===r)return!0;var n=Bd(r);return!!n&&e===n[0]}Jd.prototype=Ld.prototype,Jd.prototype.constructor=Jd;var Qd=Date.now;function Yd(e){var t=0,r=0;return function(){var n=Qd(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}const Xd=Yd(Id);var Zd=/\{\n\/\* \[wrapped with (.+)\] \*/,el=/,? & /,tl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;function rl(e){return function(){return e}}var nl=ki?function(e,t){return ki(e,"toString",{configurable:!0,enumerable:!1,value:rl(t),writable:!0})}:kd;const il=Yd(nl);function sl(e,t,r,n){for(var i=e.length,s=r+(n?1:-1);n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}function ol(e){return e!=e}function al(e,t,r){return t==t?function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):sl(e,ol,r)}function cl(e,t){return!(null==e||!e.length)&&al(e,t,0)>-1}var dl=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];function ll(e,t,r){var n=t+"";return il(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(tl,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return bi(dl,(function(r){var n="_."+r[0];t&r[1]&&!cl(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(Zd);return t?t[1].split(el):[]}(n),r)))}var ul=1,hl=2,pl=4,ml=8,fl=32,gl=64;function vl(e,t,r,n,i,s,o,a,c,d){var l=t&ml;t|=l?fl:gl,(t&=~(l?gl:fl))&pl||(t&=~(ul|hl));var u=[e,t,i,l?s:void 0,l?o:void 0,l?void 0:s,l?void 0:o,a,c,d],h=r.apply(void 0,u);return Kd(e)&&Xd(h,u),h.placeholder=n,ll(h,e,t)}function yl(e){return e.placeholder}var _l=Math.min,Sl="__lodash_placeholder__";function Tl(e,t){for(var r=-1,n=e.length,i=0,s=[];++r<n;){var o=e[r];(o===t||o===Sl)&&(e[r]=Sl,s[i++]=r)}return s}var El=1,bl=2,wl=8,kl=16,Rl=128,Cl=512;function Il(e,t,r,n,i,s,o,a,c,d){var l=t&Rl,u=t&El,h=t&bl,p=t&(wl|kl),m=t&Cl,f=h?void 0:Ad(e);return function g(){for(var v=arguments.length,y=Array(v),_=v;_--;)y[_]=arguments[_];if(p)var S=yl(g),T=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(y,S);if(n&&(y=Md(y,n,i,p)),s&&(y=xd(y,s,o,p)),v-=T,p&&v<d){var E=Tl(y,S);return vl(e,t,Il,g.placeholder,r,y,E,a,c,d-v)}var b=u?r:this,w=h?b[e]:e;return v=y.length,a?y=function(e,t){for(var r=e.length,n=_l(t.length,r),i=Es(e);n--;){var s=t[n];e[n]=$i(s,r)?i[s]:void 0}return e}(y,a):m&&v>1&&y.reverse(),l&&c<v&&(y.length=c),this&&this!==Vn&&this instanceof g&&(w=f||Ad(w)),w.apply(b,y)}}var Al=1,Pl="__lodash_placeholder__",Dl=1,Ol=2,Ml=4,Nl=8,xl=128,Ll=256,Ul=Math.min,jl="Expected a function",Fl=1,Vl=2,Bl=8,Hl=16,Wl=32,Gl=64,ql=Math.max;function $l(e,t,r,n,i,s,o,a){var c=t&Vl;if(!c&&"function"!=typeof e)throw new TypeError(jl);var d=n?n.length:0;if(d||(t&=~(Wl|Gl),n=i=void 0),o=void 0===o?o:ql(wd(o),0),a=void 0===a?a:wd(a),d-=i?i.length:0,t&Gl){var l=n,u=i;n=i=void 0}var h=c?void 0:Bd(e),p=[e,t,r,n,i,l,u,s,o,a];if(h&&function(e,t){var r=e[1],n=t[1],i=r|n,s=i<(Dl|Ol|xl),o=n==xl&&r==Nl||n==xl&&r==Ll&&e[7].length<=t[8]||n==(xl|Ll)&&t[7].length<=t[8]&&r==Nl;if(!s&&!o)return e;n&Dl&&(e[2]=t[2],i|=r&Dl?0:Ml);var a=t[3];if(a){var c=e[3];e[3]=c?Md(c,a,t[4]):a,e[4]=c?Tl(e[3],Pl):t[4]}(a=t[5])&&(c=e[5],e[5]=c?xd(c,a,t[6]):a,e[6]=c?Tl(e[5],Pl):t[6]),(a=t[7])&&(e[7]=a),n&xl&&(e[8]=null==e[8]?t[8]:Ul(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(p,h),e=p[0],t=p[1],r=p[2],n=p[3],i=p[4],!(a=p[9]=void 0===p[9]?c?0:e.length:ql(p[9]-d,0))&&t&(Bl|Hl)&&(t&=~(Bl|Hl)),t&&t!=Fl)m=t==Bl||t==Hl?function(e,t,r){var n=Ad(e);return function i(){for(var s=arguments.length,o=Array(s),a=s,c=yl(i);a--;)o[a]=arguments[a];var d=s<3&&o[0]!==c&&o[s-1]!==c?[]:Tl(o,c);return(s-=d.length)<r?vl(e,t,Il,i.placeholder,void 0,o,d,void 0,void 0,r-s):Dd(this&&this!==Vn&&this instanceof i?n:e,this,o)}}(e,t,a):t!=Wl&&t!=(Fl|Wl)||i.length?Il.apply(void 0,p):function(e,t,r,n){var i=t&Al,s=Ad(e);return function t(){for(var o=-1,a=arguments.length,c=-1,d=n.length,l=Array(d+a),u=this&&this!==Vn&&this instanceof t?s:e;++c<d;)l[c]=n[c];for(;a--;)l[c++]=arguments[++o];return Dd(u,i?r:this,l)}}(e,t,r,n);else var m=function(e,t,r){var n=t&Pd,i=Ad(e);return function t(){return(this&&this!==Vn&&this instanceof t?i:e).apply(n?r:this,arguments)}}(e,t,r);return ll((h?Id:Xd)(m,p),e,t)}function zl(e,t,r){return t=r?void 0:t,$l(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}var Jl=Math.max;function Kl(e,t,r){return t=Jl(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,s=Jl(n.length-t,0),o=Array(s);++i<s;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(o),Dd(e,this,a)}}function Ql(e,t){return il(Kl(e,t,kd),e+"")}function Yl(e,t,r){if(!Yn(r))return!1;var n=typeof t;return!!("number"==n?hs(r)&&$i(t,r.length):"string"==n&&t in r)&&Nn(r[t],e)}function Xl(e){return Ql((function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,o&&Yl(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var a=r[n];a&&e(t,a,n,s)}return t}))}var Zl=Object.prototype.hasOwnProperty,eu=Xl((function(e,t){if(as(t)||hs(t))Ai(t,ps(t),e);else for(var r in t)Zl.call(t,r)&&Ii(e,r,t[r])}));const tu=eu;var ru=Xl((function(e,t){Ai(t,gs(t),e)}));const nu=ru;var iu=Xl((function(e,t,r,n){Ai(t,gs(t),e,n)}));const su=iu;var ou=Xl((function(e,t,r,n){Ai(t,ps(t),e,n)}));const au=ou;function cu(e,t){for(var r=-1,n=t.length,i=Array(n),s=null==e;++r<n;)i[r]=s?void 0:fa(e,t[r]);return i}var du=Bn?Bn.isConcatSpreadable:void 0;function lu(e){return ji(e)||Ui(e)||!!(du&&e&&e[du])}function uu(e,t,r,n,i){var s=-1,o=e.length;for(r||(r=lu),i||(i=[]);++s<o;){var a=e[s];t>0&&r(a)?t>1?uu(a,t-1,r,n,i):As(i,a):n||(i[i.length]=a)}return i}function hu(e){return null!=e&&e.length?uu(e,1):[]}function pu(e){return il(Kl(e,void 0,hu),e+"")}const mu=pu(cu);var fu="[object Object]",gu=Function.prototype,vu=Object.prototype,yu=gu.toString,_u=vu.hasOwnProperty,Su=yu.call(Object);function Tu(e){if(!Di(e)||Qn(e)!=fu)return!1;var t=Ps(e);if(null===t)return!0;var r=_u.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&yu.call(r)==Su}function Eu(e){if(!Di(e))return!1;var t=Qn(e);return"[object Error]"==t||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Tu(e)}var bu=Ql((function(e,t){try{return Dd(e,void 0,t)}catch(e){return Eu(e)?e:new Error(e)}}));const wu=bu;function ku(e,t){var r;if("function"!=typeof t)throw new TypeError("Expected a function");return e=wd(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}var Ru=Ql((function(e,t,r){var n=1;if(r.length){var i=Tl(r,yl(Ru));n|=32}return $l(e,n,t,r,i)}));Ru.placeholder={};const Cu=Ru;var Iu=pu((function(e,t){return bi(t,(function(t){t=pa(t),Ri(e,t,Cu(e[t],e))})),e}));const Au=Iu;var Pu=Ql((function(e,t,r){var n=3;if(r.length){var i=Tl(r,yl(Pu));n|=32}return $l(t,n,e,r,i)}));Pu.placeholder={};const Du=Pu;function Ou(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function Mu(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:Ou(e,t,r)}var Nu=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function xu(e){return Nu.test(e)}var Lu="\\ud800-\\udfff",Uu="["+Lu+"]",ju="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Fu="\\ud83c[\\udffb-\\udfff]",Vu="[^"+Lu+"]",Bu="(?:\\ud83c[\\udde6-\\uddff]){2}",Hu="[\\ud800-\\udbff][\\udc00-\\udfff]",Wu="(?:"+ju+"|"+Fu+")?",Gu="[\\ufe0e\\ufe0f]?",qu=Gu+Wu+"(?:\\u200d(?:"+[Vu,Bu,Hu].join("|")+")"+Gu+Wu+")*",$u="(?:"+[Vu+ju+"?",ju,Bu,Hu,Uu].join("|")+")",zu=RegExp(Fu+"(?="+Fu+")|"+$u+qu,"g");function Ju(e){return xu(e)?function(e){return e.match(zu)||[]}(e):function(e){return e.split("")}(e)}function Ku(e){return function(t){var r=xu(t=la(t))?Ju(t):void 0,n=r?r[0]:t.charAt(0),i=r?Mu(r,1).join(""):t.slice(1);return n[e]()+i}}const Qu=Ku("toUpperCase");function Yu(e){return Qu(la(e).toLowerCase())}function Xu(e,t,r,n){var i=-1,s=null==e?0:e.length;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function Zu(e){return function(t){return null==e?void 0:e[t]}}const eh=Zu({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});var th=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,rh=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");function nh(e){return(e=la(e))&&e.replace(th,eh).replace(rh,"")}var ih=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sh=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oh="\\ud800-\\udfff",ah="\\u2700-\\u27bf",ch="a-z\\xdf-\\xf6\\xf8-\\xff",dh="A-Z\\xc0-\\xd6\\xd8-\\xde",lh="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",uh="["+lh+"]",hh="\\d+",ph="["+ah+"]",mh="["+ch+"]",fh="[^"+oh+lh+hh+ah+ch+dh+"]",gh="(?:\\ud83c[\\udde6-\\uddff]){2}",vh="[\\ud800-\\udbff][\\udc00-\\udfff]",yh="["+dh+"]",_h="(?:"+mh+"|"+fh+")",Sh="(?:"+yh+"|"+fh+")",Th="(?:['’](?:d|ll|m|re|s|t|ve))?",Eh="(?:['’](?:D|LL|M|RE|S|T|VE))?",bh="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",wh="[\\ufe0e\\ufe0f]?",kh=wh+bh+"(?:\\u200d(?:"+["[^"+oh+"]",gh,vh].join("|")+")"+wh+bh+")*",Rh="(?:"+[ph,gh,vh].join("|")+")"+kh,Ch=RegExp([yh+"?"+mh+"+"+Th+"(?="+[uh,yh,"$"].join("|")+")",Sh+"+"+Eh+"(?="+[uh,yh+_h,"$"].join("|")+")",yh+"?"+_h+"+"+Th,yh+"+"+Eh,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",hh,Rh].join("|"),"g");function Ih(e,t,r){return e=la(e),void 0===(t=r?void 0:t)?function(e){return sh.test(e)}(e)?function(e){return e.match(Ch)||[]}(e):function(e){return e.match(ih)||[]}(e):e.match(t)||[]}var Ah=RegExp("['’]","g");function Ph(e){return function(t){return Xu(Ih(nh(t).replace(Ah,"")),e,"")}}var Dh=Ph((function(e,t,r){return t=t.toLowerCase(),e+(r?Yu(t):t)}));const Oh=Dh;var Mh=Vn.isFinite,Nh=Math.min;function xh(e){var t=Math[e];return function(e,r){if(e=Sd(e),(r=null==r?0:Nh(wd(r),292))&&Mh(e)){var n=(la(e)+"e").split("e");return+((n=(la(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}const Lh=xh("ceil");function Uh(e){var t=Jd(e);return t.__chain__=!0,t}var jh=Math.ceil,Fh=Math.max;function Vh(e,t,r){return e==e&&(void 0!==r&&(e=e<=r?e:r),void 0!==t&&(e=e>=t?e:t)),e}function Bh(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Ti;++t<r;)this.add(e[t])}function Hh(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Wh(e,t){return e.has(t)}Bh.prototype.add=Bh.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Bh.prototype.has=function(e){return this.__data__.has(e)};var Gh=1,qh=2;function $h(e,t,r,n,i,s){var o=r&Gh,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var d=s.get(e),l=s.get(t);if(d&&l)return d==t&&l==e;var u=-1,h=!0,p=r&qh?new Bh:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var m=e[u],f=t[u];if(n)var g=o?n(f,m,u,t,e,s):n(m,f,u,e,t,s);if(void 0!==g){if(g)continue;h=!1;break}if(p){if(!Hh(t,(function(e,t){if(!Wh(p,t)&&(m===e||i(m,e,r,n,s)))return p.push(t)}))){h=!1;break}}else if(m!==f&&!i(m,f,r,n,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function zh(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function Jh(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var Kh=1,Qh=2,Yh="[object Boolean]",Xh="[object Date]",Zh="[object Error]",ep="[object Map]",tp="[object Number]",rp="[object RegExp]",np="[object Set]",ip="[object String]",sp="[object Symbol]",op="[object ArrayBuffer]",ap="[object DataView]",cp=Bn?Bn.prototype:void 0,dp=cp?cp.valueOf:void 0,lp=1,up=Object.prototype.hasOwnProperty,hp=1,pp="[object Arguments]",mp="[object Array]",fp="[object Object]",gp=Object.prototype.hasOwnProperty;function vp(e,t,r,n,i){return e===t||(null==e||null==t||!Di(e)&&!Di(t)?e!=e&&t!=t:function(e,t,r,n,i,s){var o=ji(e),a=ji(t),c=o?mp:Ys(e),d=a?mp:Ys(t),l=(c=c==pp?fp:c)==fp,u=(d=d==pp?fp:d)==fp,h=c==d;if(h&&Wi(e)){if(!Wi(t))return!1;o=!0,l=!1}if(h&&!l)return s||(s=new Ei),o||ns(e)?$h(e,t,r,n,i,s):function(e,t,r,n,i,s,o){switch(r){case ap:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case op:return!(e.byteLength!=t.byteLength||!s(new Zs(e),new Zs(t)));case Yh:case Xh:case tp:return Nn(+e,+t);case Zh:return e.name==t.name&&e.message==t.message;case rp:case ip:return e==t+"";case ep:var a=zh;case np:var c=n&Kh;if(a||(a=Jh),e.size!=t.size&&!c)return!1;var d=o.get(e);if(d)return d==t;n|=Qh,o.set(e,t);var l=$h(a(e),a(t),n,i,s,o);return o.delete(e),l;case sp:if(dp)return dp.call(e)==dp.call(t)}return!1}(e,t,c,r,n,i,s);if(!(r&hp)){var p=l&&gp.call(e,"__wrapped__"),m=u&&gp.call(t,"__wrapped__");if(p||m){var f=p?e.value():e,g=m?t.value():t;return s||(s=new Ei),i(f,g,r,n,s)}}return!!h&&(s||(s=new Ei),function(e,t,r,n,i,s){var o=r&lp,a=Ns(e),c=a.length;if(c!=Ns(t).length&&!o)return!1;for(var d=c;d--;){var l=a[d];if(!(o?l in t:up.call(t,l)))return!1}var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var p=!0;s.set(e,t),s.set(t,e);for(var m=o;++d<c;){var f=e[l=a[d]],g=t[l];if(n)var v=o?n(g,f,l,t,e,s):n(f,g,l,e,t,s);if(!(void 0===v?f===g||i(f,g,r,n,s):v)){p=!1;break}m||(m="constructor"==l)}if(p&&!m){var y=e.constructor,_=t.constructor;y!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _)&&(p=!1)}return s.delete(e),s.delete(t),p}(e,t,r,n,i,s))}(e,t,r,n,vp,i))}var yp=1,_p=2;function Sp(e,t,r,n){var i=r.length,s=i,o=!n;if(null==e)return!s;for(e=Object(e);i--;){var a=r[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){var c=(a=r[i])[0],d=e[c],l=a[1];if(o&&a[2]){if(void 0===d&&!(c in e))return!1}else{var u=new Ei;if(n)var h=n(d,l,c,e,t,u);if(!(void 0===h?vp(l,d,yp|_p,n,u):h))return!1}}return!0}function Tp(e){return e==e&&!Yn(e)}function Ep(e){for(var t=ps(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Tp(i)]}return t}function bp(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}function wp(e){var t=Ep(e);return 1==t.length&&t[0][2]?bp(t[0][0],t[0][1]):function(r){return r===e||Sp(r,e,t)}}function kp(e,t){return null!=e&&t in Object(e)}function Rp(e,t){return null!=e&&ya(e,t,kp)}var Cp=1,Ip=2;function Ap(e,t){return Yo(e)&&Tp(t)?bp(pa(e),t):function(r){var n=fa(r,e);return void 0===n&&n===t?Rp(r,e):vp(t,n,Cp|Ip)}}function Pp(e){return function(t){return null==t?void 0:t[e]}}function Dp(e){return Yo(e)?Pp(pa(e)):function(e){return function(t){return ma(t,e)}}(e)}function Op(e){return"function"==typeof e?e:null==e?kd:"object"==typeof e?ji(e)?Ap(e[0],e[1]):wp(e):Dp(e)}function Mp(e,t,r){var n=r.length;if(null==e)return!n;for(e=Object(e);n--;){var i=r[n],s=t[i],o=e[i];if(void 0===o&&!(i in e)||!s(o))return!1}return!0}function Np(e,t,r,n){for(var i=-1,s=null==e?0:e.length;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function xp(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===r(s[c],c,s))break}return t}}const Lp=xp();function Up(e,t){return e&&Lp(e,t,ps)}function jp(e,t){return function(r,n){if(null==r)return r;if(!hs(r))return e(r,n);for(var i=r.length,s=t?i:-1,o=Object(r);(t?s--:++s<i)&&!1!==n(o[s],s,o););return r}}const Fp=jp(Up);function Vp(e,t,r,n){return Fp(e,(function(e,i,s){t(n,e,r(e),s)})),n}function Bp(e,t){return function(r,n){var i=ji(r)?Np:Vp,s=t?t():{};return i(r,e,Op(n),s)}}var Hp=Object.prototype.hasOwnProperty,Wp=Bp((function(e,t,r){Hp.call(e,r)?++e[r]:Ri(e,r,1)}));const Gp=Wp;function qp(e,t,r){var n=$l(e,8,void 0,void 0,void 0,void 0,void 0,t=r?void 0:t);return n.placeholder=qp.placeholder,n}function $p(e,t,r){var n=$l(e,16,void 0,void 0,void 0,void 0,void 0,t=r?void 0:t);return n.placeholder=$p.placeholder,n}qp.placeholder={},$p.placeholder={};const zp=function(){return Vn.Date.now()};var Jp=Math.max,Kp=Math.min;function Qp(e,t,r){var n,i,s,o,a,c,d=0,l=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var r=n,s=i;return n=i=void 0,d=t,o=e.apply(s,r)}function m(e){var r=e-c;return void 0===c||r>=t||r<0||u&&e-d>=s}function f(){var e=zp();if(m(e))return g(e);a=setTimeout(f,function(e){var r=t-(e-c);return u?Kp(r,s-(e-d)):r}(e))}function g(e){return a=void 0,h&&n?p(e):(n=i=void 0,o)}function v(){var e=zp(),r=m(e);if(n=arguments,i=this,c=e,r){if(void 0===a)return function(e){return d=e,a=setTimeout(f,t),l?p(e):o}(c);if(u)return clearTimeout(a),a=setTimeout(f,t),p(c)}return void 0===a&&(a=setTimeout(f,t)),o}return t=Sd(t)||0,Yn(r)&&(l=!!r.leading,s=(u="maxWait"in r)?Jp(Sd(r.maxWait)||0,t):s,h="trailing"in r?!!r.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),d=0,n=c=i=a=void 0},v.flush=function(){return void 0===a?o:g(zp())},v}var Yp=Object.prototype,Xp=Yp.hasOwnProperty,Zp=Ql((function(e,t){e=Object(e);var r=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&Yl(t[0],t[1],i)&&(n=1);++r<n;)for(var s=t[r],o=gs(s),a=-1,c=o.length;++a<c;){var d=o[a],l=e[d];(void 0===l||Nn(l,Yp[d])&&!Xp.call(e,d))&&(e[d]=s[d])}return e}));const em=Zp;function tm(e,t,r){(void 0!==r&&!Nn(e[t],r)||void 0===r&&!(t in e))&&Ri(e,t,r)}function rm(e){return Di(e)&&hs(e)}function nm(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function im(e){return Ai(e,gs(e))}function sm(e,t,r,n,i){e!==t&&Lp(t,(function(s,o){if(i||(i=new Ei),Yn(s))!function(e,t,r,n,i,s,o){var a=nm(e,r),c=nm(t,r),d=o.get(c);if(d)tm(e,r,d);else{var l=s?s(a,c,r+"",e,t,o):void 0,u=void 0===l;if(u){var h=ji(c),p=!h&&Wi(c),m=!h&&!p&&ns(c);l=c,h||p||m?ji(a)?l=a:rm(a)?l=Es(a):p?(u=!1,l=Ts(c,!0)):m?(u=!1,l=io(c,!0)):l=[]:Tu(c)||Ui(c)?(l=a,Ui(a)?l=im(a):(!Yn(a)||ri(a))&&(l=Io(c))):u=!1}u&&(o.set(c,l),i(l,c,n,s,o),o.delete(c)),tm(e,r,l)}}(e,t,o,r,sm,n,i);else{var a=n?n(nm(e,o),s,o+"",e,t,i):void 0;void 0===a&&(a=s),tm(e,o,a)}}),gs)}function om(e,t,r,n,i,s){return Yn(e)&&Yn(t)&&(s.set(t,e),sm(e,t,void 0,om,s),s.delete(t)),e}var am=Xl((function(e,t,r,n){sm(e,t,r,n)}));const cm=am;var dm=Ql((function(e){return e.push(void 0,om),Dd(cm,void 0,e)}));const lm=dm;function um(e,t,r){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,r)}),t)}var hm=Ql((function(e,t){return um(e,1,t)}));const pm=hm;var mm=Ql((function(e,t,r){return um(e,Sd(t)||0,r)}));const fm=mm;function gm(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}var vm=200;function ym(e,t,r,n){var i=-1,s=cl,o=!0,a=e.length,c=[],d=t.length;if(!a)return c;r&&(t=sa(t,Qi(r))),n?(s=gm,o=!1):t.length>=vm&&(s=Wh,o=!1,t=new Bh(t));e:for(;++i<a;){var l=e[i],u=null==r?l:r(l);if(l=n||0!==l?l:0,o&&u==u){for(var h=d;h--;)if(t[h]===u)continue e;c.push(l)}else s(t,u,n)||c.push(l)}return c}var _m=Ql((function(e,t){return rm(e)?ym(e,uu(t,1,rm,!0)):[]}));const Sm=_m;function Tm(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Em=Ql((function(e,t){var r=Tm(t);return rm(r)&&(r=void 0),rm(e)?ym(e,uu(t,1,rm,!0),Op(r)):[]}));const bm=Em;var wm=Ql((function(e,t){var r=Tm(t);return rm(r)&&(r=void 0),rm(e)?ym(e,uu(t,1,rm,!0),void 0,r):[]}));const km=wm;var Rm=cd((function(e,t){return e/t}),1);const Cm=Rm;function Im(e,t,r,n){for(var i=e.length,s=n?i:-1;(n?s--:++s<i)&&t(e[s],s,e););return r?Ou(e,n?0:s,n?s+1:i):Ou(e,n?s+1:0,n?i:s)}function Am(e){return"function"==typeof e?e:kd}function Pm(e,t){return(ji(e)?bi:Fp)(e,Am(t))}function Dm(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}const Om=xp(!0);function Mm(e,t){return e&&Om(e,t,ps)}const Nm=jp(Mm,!0);function xm(e,t){return(ji(e)?Dm:Nm)(e,Am(t))}function Lm(e){return function(t){var r=Ys(t);return"[object Map]"==r?zh(t):"[object Set]"==r?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):function(e,t){return sa(t,(function(t){return[t,e[t]]}))}(t,e(t))}}const Um=Lm(ps),jm=Lm(gs),Fm=Zu({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});var Vm=/[&<>"']/g,Bm=RegExp(Vm.source);function Hm(e){return(e=la(e))&&Bm.test(e)?e.replace(Vm,Fm):e}var Wm=/[\\^$.*+?()[\]{}|]/g,Gm=RegExp(Wm.source);function qm(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function $m(e,t){var r=!0;return Fp(e,(function(e,n,i){return r=!!t(e,n,i)})),r}function zm(e){return e?Vh(wd(e),0,4294967295):0}function Jm(e,t){var r=[];return Fp(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function Km(e){return function(t,r,n){var i=Object(t);if(!hs(t)){var s=Op(r);t=ps(t),r=function(e){return s(i[e],e,i)}}var o=e(t,r,n);return o>-1?i[s?t[o]:o]:void 0}}var Qm=Math.max;function Ym(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:wd(r);return i<0&&(i=Qm(n+i,0)),sl(e,Op(t),i)}const Xm=Km(Ym);function Zm(e,t,r){var n;return r(e,(function(e,r,i){if(t(e,r,i))return n=r,!1})),n}var ef=Math.max,tf=Math.min;function rf(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=n-1;return void 0!==r&&(i=wd(r),i=r<0?ef(n+i,0):tf(i,n-1)),sl(e,Op(t),i,!0)}const nf=Km(rf);function sf(e){return e&&e.length?e[0]:void 0}function of(e,t){var r=-1,n=hs(e)?Array(e.length):[];return Fp(e,(function(e,i,s){n[++r]=t(e,i,s)})),n}function af(e,t){return(ji(e)?sa:of)(e,Op(t))}const cf=xh("floor");function df(e){return pu((function(t){var r=t.length,n=r,i=qd.prototype.thru;for(e&&t.reverse();n--;){var s=t[n];if("function"!=typeof s)throw new TypeError("Expected a function");if(i&&!o&&"wrapper"==Gd(s))var o=new qd([],!0)}for(n=o?n:r;++n<r;){var a=Gd(s=t[n]),c="wrapper"==a?Bd(s):void 0;o=c&&Kd(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?o[Gd(c[0])].apply(o,c[3]):1==s.length&&Kd(s)?o[a]():o.thru(s)}return function(){var e=arguments,n=e[0];if(o&&1==e.length&&ji(n))return o.plant(n).value();for(var i=0,s=r?t[i].apply(this,e):n;++i<r;)s=t[i].call(this,s);return s}}))}const lf=df(),uf=df(!0);function hf(e,t){return bs(t,(function(t){return ri(e[t])}))}var pf=Object.prototype.hasOwnProperty,mf=Bp((function(e,t,r){pf.call(e,r)?e[r].push(t):Ri(e,r,[t])}));const ff=mf;function gf(e,t){return e>t}function vf(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=Sd(t),r=Sd(r)),e(t,r)}}const yf=vf(gf);var _f=vf((function(e,t){return e>=t}));const Sf=_f;var Tf=Math.max,Ef=Math.min,bf="[object String]";function wf(e){return"string"==typeof e||!ji(e)&&Di(e)&&Qn(e)==bf}function kf(e,t){return sa(t,(function(t){return e[t]}))}function Rf(e){return null==e?[]:kf(e,ps(e))}var Cf=Math.max,If=Math.max,Af=Math.min;function Pf(e,t,r){for(var n=r?gm:cl,i=e[0].length,s=e.length,o=s,a=Array(s),c=1/0,d=[];o--;){var l=e[o];o&&t&&(l=sa(l,Qi(t))),c=Af(l.length,c),a[o]=!r&&(t||i>=120&&l.length>=120)?new Bh(o&&l):void 0}l=e[0];var u=-1,h=a[0];e:for(;++u<i&&d.length<c;){var p=l[u],m=t?t(p):p;if(p=r||0!==p?p:0,!(h?Wh(h,m):n(d,m,r))){for(o=s;--o;){var f=a[o];if(!(f?Wh(f,m):n(e[o],m,r)))continue e}h&&h.push(m),d.push(p)}}return d}function Df(e){return rm(e)?e:[]}var Of=Ql((function(e){var t=sa(e,Df);return t.length&&t[0]===e[0]?Pf(t):[]}));const Mf=Of;var Nf=Ql((function(e){var t=Tm(e),r=sa(e,Df);return t===Tm(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?Pf(r,Op(t)):[]}));const xf=Nf;var Lf=Ql((function(e){var t=Tm(e),r=sa(e,Df);return(t="function"==typeof t?t:void 0)&&r.pop(),r.length&&r[0]===e[0]?Pf(r,void 0,t):[]}));const Uf=Lf;function jf(e,t){return function(r,n){return function(e,t,r,n){return Up(e,(function(e,i,s){t(n,r(e),i,s)})),n}(r,e,t(n),{})}}var Ff=Object.prototype.toString,Vf=jf((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ff.call(t)),e[t]=r}),rl(kd));const Bf=Vf;var Hf=Object.prototype,Wf=Hf.hasOwnProperty,Gf=Hf.toString,qf=jf((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Gf.call(t)),Wf.call(e,t)?e[t].push(r):e[t]=[r]}),Op);const $f=qf;function zf(e,t){return t.length<2?e:ma(e,Ou(t,0,-1))}function Jf(e,t,r){var n=null==(e=zf(e,t=ua(t,e)))?e:e[pa(Tm(t))];return null==n?void 0:Dd(n,e,r)}const Kf=Ql(Jf);var Qf=Ql((function(e,t,r){var n=-1,i="function"==typeof t,s=hs(e)?Array(e.length):[];return Fp(e,(function(e){s[++n]=i?Dd(t,e,r):Jf(e,t,r)})),s}));const Yf=Qf;var Xf=es&&es.isArrayBuffer,Zf=Xf?Qi(Xf):function(e){return Di(e)&&"[object ArrayBuffer]"==Qn(e)};const eg=Zf;var tg=es&&es.isDate,rg=tg?Qi(tg):function(e){return Di(e)&&"[object Date]"==Qn(e)};const ng=rg;var ig=Object.prototype.hasOwnProperty;function sg(e){if(null==e)return!0;if(hs(e)&&(ji(e)||"string"==typeof e||"function"==typeof e.splice||Wi(e)||ns(e)||Ui(e)))return!e.length;var t=Ys(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(as(e))return!us(e).length;for(var r in e)if(ig.call(e,r))return!1;return!0}function og(e,t){return vp(e,t)}var ag=Vn.isFinite;function cg(e){return"number"==typeof e&&e==wd(e)}function dg(e){return"number"==typeof e||Di(e)&&"[object Number]"==Qn(e)}const lg=ni?ri:Fi;var ug=es&&es.isRegExp,hg=ug?Qi(ug):function(e){return Di(e)&&"[object RegExp]"==Qn(e)};const pg=hg;var mg=9007199254740991,fg=Array.prototype.join,gg=Ph((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}));const vg=gg;var yg=Bp((function(e,t,r){Ri(e,r,t)}));const _g=yg;var Sg=Math.max,Tg=Math.min,Eg=Ph((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}));const bg=Eg,wg=Ku("toLowerCase");function kg(e,t){return e<t}const Rg=vf(kg);var Cg=vf((function(e,t){return e<=t}));const Ig=Cg;function Ag(e,t,r){for(var n=-1,i=e.length;++n<i;){var s=e[n],o=t(s);if(null!=o&&(void 0===a?o==o&&!Jo(o):r(o,a)))var a=o,c=s}return c}function Pg(e,t){for(var r,n=-1,i=e.length;++n<i;){var s=t(e[n]);void 0!==s&&(r=void 0===r?s:r+s)}return r}function Dg(e,t){var r=null==e?0:e.length;return r?Pg(e,t)/r:NaN}var Og=Xl((function(e,t,r){sm(e,t,r)}));const Mg=Og;var Ng=Ql((function(e,t){return function(r){return Jf(r,e,t)}}));const xg=Ng;var Lg=Ql((function(e,t){return function(r){return Jf(e,r,t)}}));const Ug=Lg;function jg(e,t,r){var n=ps(t),i=hf(t,n),s=!(Yn(r)&&"chain"in r&&!r.chain),o=ri(e);return bi(i,(function(r){var n=t[r];e[r]=n,o&&(e.prototype[r]=function(){var t=this.__chain__;if(s||t){var r=e(this.__wrapped__);return(r.__actions__=Es(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,As([this.value()],arguments))})})),e}var Fg=cd((function(e,t){return e*t}),1);const Vg=Fg;function Bg(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}var Hg=Bn?Bn.iterator:void 0;function Wg(e){if(!e)return[];if(hs(e))return wf(e)?Ju(e):Es(e);if(Hg&&e[Hg])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Hg]());var t=Ys(e);return("[object Map]"==t?zh:"[object Set]"==t?Jh:Rf)(e)}function Gg(e,t){var r=e.length;if(r)return $i(t+=t<0?r:0,r)?e[t]:void 0}function qg(e,t){return null==(e=zf(e,t=ua(t,e)))||delete e[pa(Tm(t))]}function $g(e){return Tu(e)?void 0:e}var zg=pu((function(e,t){var r={};if(null==e)return r;var n=!1;t=sa(t,(function(t){return t=ua(t,e),n||(n=t.length>1),t})),Ai(e,xs(e),r),n&&(r=Wo(r,7,$g));for(var i=t.length;i--;)qg(r,t[i]);return r}));const Jg=zg;function Kg(e,t,r){for(var n=-1,i=t.length,s={};++n<i;){var o=t[n],a=ma(e,o);r(a,o)&&_a(s,ua(o,e),a)}return s}function Qg(e,t){if(null==e)return{};var r=sa(xs(e),(function(e){return[e]}));return t=Op(t),Kg(e,r,(function(e,r){return t(e,r[0])}))}function Yg(e,t){if(e!==t){var r=void 0!==e,n=null===e,i=e==e,s=Jo(e),o=void 0!==t,a=null===t,c=t==t,d=Jo(t);if(!a&&!d&&!s&&e>t||s&&o&&c&&!a&&!d||n&&o&&c||!r&&c||!i)return 1;if(!n&&!s&&!d&&e<t||d&&r&&i&&!n&&!s||a&&r&&i||!o&&i||!c)return-1}return 0}function Xg(e,t,r){t=t.length?sa(t,(function(e){return ji(e)?function(t){return ma(t,1===e.length?e[0]:e)}:e})):[kd];var n=-1;return t=sa(t,Qi(Op)),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(of(e,(function(e,r,i){return{criteria:sa(t,(function(t){return t(e)})),index:++n,value:e}})),(function(e,t){return function(e,t,r){for(var n=-1,i=e.criteria,s=t.criteria,o=i.length,a=r.length;++n<o;){var c=Yg(i[n],s[n]);if(c)return n>=a?c:c*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}))}function Zg(e){return pu((function(t){return t=sa(t,Qi(Op)),Ql((function(r){var n=this;return e(t,(function(e){return Dd(e,n,r)}))}))}))}const ev=Zg(sa),tv=Ql;var rv=Math.min,nv=tv((function(e,t){var r=(t=1==t.length&&ji(t[0])?sa(t[0],Qi(Op)):sa(uu(t,1),Qi(Op))).length;return Ql((function(n){for(var i=-1,s=rv(n.length,r);++i<s;)n[i]=t[i].call(this,n[i]);return Dd(e,this,n)}))}));const iv=nv,sv=Zg(qm),ov=Zg(Hh);var av=9007199254740991,cv=Math.floor;function dv(e,t){var r="";if(!e||t<1||t>av)return r;do{t%2&&(r+=e),(t=cv(t/2))&&(e+=e)}while(t);return r}const lv=Pp("length");var uv="\\ud800-\\udfff",hv="["+uv+"]",pv="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",mv="\\ud83c[\\udffb-\\udfff]",fv="[^"+uv+"]",gv="(?:\\ud83c[\\udde6-\\uddff]){2}",vv="[\\ud800-\\udbff][\\udc00-\\udfff]",yv="(?:"+pv+"|"+mv+")?",_v="[\\ufe0e\\ufe0f]?",Sv=_v+yv+"(?:\\u200d(?:"+[fv,gv,vv].join("|")+")"+_v+yv+")*",Tv="(?:"+[fv+pv+"?",pv,gv,vv,hv].join("|")+")",Ev=RegExp(mv+"(?="+mv+")|"+Tv+Sv,"g");function bv(e){return xu(e)?function(e){for(var t=Ev.lastIndex=0;Ev.test(e);)++t;return t}(e):lv(e)}var wv=Math.ceil;function kv(e,t){var r=(t=void 0===t?" ":da(t)).length;if(r<2)return r?dv(t,e):t;var n=dv(t,wv(e/bv(t)));return xu(t)?Mu(Ju(n),0,e).join(""):n.slice(0,e)}var Rv=Math.ceil,Cv=Math.floor,Iv=/^\s+/,Av=Vn.parseInt,Pv=Ql((function(e,t){return $l(e,32,void 0,t,Tl(t,yl(Pv)))}));Pv.placeholder={};const Dv=Pv;var Ov=Ql((function(e,t){return $l(e,64,void 0,t,Tl(t,yl(Ov)))}));Ov.placeholder={};const Mv=Ov;var Nv=Bp((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]}));const xv=Nv;var Lv=pu((function(e,t){return null==e?{}:function(e,t){return Kg(e,t,(function(t,r){return Rp(e,r)}))}(e,t)}));const Uv=Lv;function jv(e,t,r,n){for(var i=r-1,s=e.length;++i<s;)if(n(e[i],t))return i;return-1}var Fv=Array.prototype.splice;function Vv(e,t,r,n){var i=n?jv:al,s=-1,o=t.length,a=e;for(e===t&&(t=Es(t)),r&&(a=sa(e,Qi(r)));++s<o;)for(var c=0,d=t[s],l=r?r(d):d;(c=i(a,l,c,n))>-1;)a!==e&&Fv.call(a,c,1),Fv.call(e,c,1);return e}function Bv(e,t){return e&&e.length&&t&&t.length?Vv(e,t):e}const Hv=Ql(Bv);var Wv=Array.prototype.splice;function Gv(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==s){var s=i;$i(i)?Wv.call(e,i,1):qg(e,i)}}return e}var qv=pu((function(e,t){var r=null==e?0:e.length,n=cu(e,t);return Gv(e,sa(t,(function(e){return $i(e,r)?+e:e})).sort(Yg)),n}));const $v=qv;var zv=Math.floor,Jv=Math.random;function Kv(e,t){return e+zv(Jv()*(t-e+1))}var Qv=parseFloat,Yv=Math.min,Xv=Math.random,Zv=Math.ceil,ey=Math.max;function ty(e){return function(t,r,n){return n&&"number"!=typeof n&&Yl(t,r,n)&&(r=n=void 0),t=bd(t),void 0===r?(r=t,t=0):r=bd(r),function(e,t,r,n){for(var i=-1,s=ey(Zv((t-e)/(r||1)),0),o=Array(s);s--;)o[n?s:++i]=e,e+=r;return o}(t,r,n=void 0===n?t<r?1:-1:bd(n),e)}}const ry=ty(),ny=ty(!0);var iy=pu((function(e,t){return $l(e,256,void 0,void 0,void 0,t)}));const sy=iy;function oy(e,t,r,n,i){return i(e,(function(e,i,s){r=n?(n=!1,e):t(r,e,i,s)})),r}function ay(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}var cy=Array.prototype.reverse;function dy(e){return null==e?e:cy.call(e)}const ly=xh("round");function uy(e){var t=e.length;return t?e[Kv(0,t-1)]:void 0}function hy(e){return uy(Rf(e))}function py(e,t){var r=-1,n=e.length,i=n-1;for(t=void 0===t?n:t;++r<t;){var s=Kv(r,i),o=e[s];e[s]=e[r],e[r]=o}return e.length=t,e}function my(e,t){return py(Es(e),Vh(t,0,e.length))}function fy(e,t){var r=Rf(e);return py(r,Vh(t,0,r.length))}function gy(e){return py(Es(e))}function vy(e){return py(Rf(e))}var yy=Ph((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}));const _y=yy;function Sy(e,t){var r;return Fp(e,(function(e,n,i){return!(r=t(e,n,i))})),!!r}var Ty=Ql((function(e,t){if(null==e)return[];var r=t.length;return r>1&&Yl(e,t[0],t[1])?t=[]:r>2&&Yl(t[0],t[1],t[2])&&(t=[t[0]]),Xg(e,uu(t,1),[])}));const Ey=Ty;var by=4294967294,wy=Math.floor,ky=Math.min;function Ry(e,t,r,n){var i=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=r(t))!=t,a=null===t,c=Jo(t),d=void 0===t;i<s;){var l=wy((i+s)/2),u=r(e[l]),h=void 0!==u,p=null===u,m=u==u,f=Jo(u);if(o)var g=n||m;else g=d?m&&(n||h):a?m&&h&&(n||!p):c?m&&h&&!p&&(n||!f):!p&&!f&&(n?u<=t:u<t);g?i=l+1:s=l}return ky(s,by)}function Cy(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;n<i;){var s=n+i>>>1,o=e[s];null!==o&&!Jo(o)&&(r?o<=t:o<t)?n=s+1:i=s}return i}return Ry(e,t,kd,r)}function Iy(e,t){for(var r=-1,n=e.length,i=0,s=[];++r<n;){var o=e[r],a=t?t(o):o;if(!r||!Nn(a,c)){var c=a;s[i++]=0===o?0:o}}return s}var Ay=Math.max,Py=Ph((function(e,t,r){return e+(r?" ":"")+Qu(t)}));const Dy=Py;var Oy=cd((function(e,t){return e-t}),0);const My=Oy;var Ny=Object.prototype,xy=Ny.hasOwnProperty;function Ly(e,t,r,n){return void 0===e||Nn(e,Ny[r])&&!xy.call(n,r)?t:e}var Uy={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function jy(e){return"\\"+Uy[e]}const Fy=/<%=([\s\S]+?)%>/g,Vy={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Fy,variable:"",imports:{_:{escape:Hm}}};var By=/\b__p \+= '';/g,Hy=/\b(__p \+=) '' \+/g,Wy=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Gy=/[()=,{}\[\]\/\s]/,qy=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,$y=/($^)/,zy=/['\n\r\u2028\u2029\\]/g,Jy=Object.prototype.hasOwnProperty;function Ky(e,t){return t(e)}var Qy=4294967295,Yy=Math.min;function Xy(e,t){var r=e;return r instanceof jd&&(r=r.value()),Xu(t,(function(e,t){return t.func.apply(t.thisArg,As([e],t.args))}),r)}function Zy(){return Xy(this.__wrapped__,this.__actions__)}var e_=9007199254740991;function t_(e,t){for(var r=e.length;r--&&al(t,e[r],0)>-1;);return r}function r_(e,t){for(var r=-1,n=e.length;++r<n&&al(t,e[r],0)>-1;);return r}var n_=/^\s+/,i_=/\w*$/;const s_=Zu({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var o_=/&(?:amp|lt|gt|quot|#39);/g,a_=RegExp(o_.source),c_=js&&1/Jh(new js([,-0]))[1]==1/0?function(e){return new js(e)}:Fd;const d_=c_;var l_=200;function u_(e,t,r){var n=-1,i=cl,s=e.length,o=!0,a=[],c=a;if(r)o=!1,i=gm;else if(s>=l_){var d=t?null:d_(e);if(d)return Jh(d);o=!1,i=Wh,c=new Bh}else c=t?[]:a;e:for(;++n<s;){var l=e[n],u=t?t(l):l;if(l=r||0!==l?l:0,o&&u==u){for(var h=c.length;h--;)if(c[h]===u)continue e;t&&c.push(u),a.push(l)}else i(c,u,r)||(c!==a&&c.push(u),a.push(l))}return a}var h_=Ql((function(e){return u_(uu(e,1,rm,!0))}));const p_=h_;var m_=Ql((function(e){var t=Tm(e);return rm(t)&&(t=void 0),u_(uu(e,1,rm,!0),Op(t))}));const f_=m_;var g_=Ql((function(e){var t=Tm(e);return t="function"==typeof t?t:void 0,u_(uu(e,1,rm,!0),void 0,t)}));const v_=g_;var y_=0,__=Math.max;function S_(e){if(!e||!e.length)return[];var t=0;return e=bs(e,(function(e){if(rm(e))return t=__(e.length,t),!0})),Pi(t,(function(t){return sa(e,Pp(t))}))}function T_(e,t){if(!e||!e.length)return[];var r=S_(e);return null==t?r:sa(r,(function(e){return Dd(t,void 0,e)}))}function E_(e,t,r,n){return _a(e,t,r(ma(e,t)),n)}var b_=Ph((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}));const w_=b_;var k_=Ql((function(e,t){return rm(e)?ym(e,t):[]}));const R_=k_;var C_=pu((function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,i=function(t){return cu(t,e)};return!(t>1||this.__actions__.length)&&n instanceof jd&&$i(r)?((n=n.slice(r,+r+(t?1:0))).__actions__.push({func:Ky,args:[i],thisArg:void 0}),new qd(n,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(i)}));const I_=C_;function A_(e,t,r){var n=e.length;if(n<2)return n?u_(e[0]):[];for(var i=-1,s=Array(n);++i<n;)for(var o=e[i],a=-1;++a<n;)a!=i&&(s[i]=ym(s[i]||o,e[a],t,r));return u_(uu(s,1),t,r)}var P_=Ql((function(e){return A_(bs(e,rm))}));const D_=P_;var O_=Ql((function(e){var t=Tm(e);return rm(t)&&(t=void 0),A_(bs(e,rm),Op(t))}));const M_=O_;var N_=Ql((function(e){var t=Tm(e);return t="function"==typeof t?t:void 0,A_(bs(e,rm),void 0,t)}));const x_=N_,L_=Ql(S_);function U_(e,t,r){for(var n=-1,i=e.length,s=t.length,o={};++n<i;){var a=n<s?t[n]:void 0;r(o,e[n],a)}return o}var j_=Ql((function(e){var t=e.length,r=t>1?e[t-1]:void 0;return r="function"==typeof r?(e.pop(),r):void 0,T_(e,r)}));const F_={chunk:function(e,t,r){t=(r?Yl(e,t,r):void 0===t)?1:Fh(wd(t),0);var n=null==e?0:e.length;if(!n||t<1)return[];for(var i=0,s=0,o=Array(jh(n/t));i<n;)o[s++]=Ou(e,i,i+=t);return o},compact:function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var s=e[t];s&&(i[n++]=s)}return i},concat:function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return As(ji(r)?Es(r):[r],uu(t,1))},difference:Sm,differenceBy:bm,differenceWith:km,drop:function(e,t,r){var n=null==e?0:e.length;return n?Ou(e,(t=r||void 0===t?1:wd(t))<0?0:t,n):[]},dropRight:function(e,t,r){var n=null==e?0:e.length;return n?Ou(e,0,(t=n-(t=r||void 0===t?1:wd(t)))<0?0:t):[]},dropRightWhile:function(e,t){return e&&e.length?Im(e,Op(t),!0,!0):[]},dropWhile:function(e,t){return e&&e.length?Im(e,Op(t),!0):[]},fill:function(e,t,r,n){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&Yl(e,t,r)&&(r=0,n=i),function(e,t,r,n){var i=e.length;for((r=wd(r))<0&&(r=-r>i?0:i+r),(n=void 0===n||n>i?i:wd(n))<0&&(n+=i),n=r>n?0:zm(n);r<n;)e[r++]=t;return e}(e,t,r,n)):[]},findIndex:Ym,findLastIndex:rf,first:sf,flatten:hu,flattenDeep:function(e){return null!=e&&e.length?uu(e,1/0):[]},flattenDepth:function(e,t){return null!=e&&e.length?uu(e,t=void 0===t?1:wd(t)):[]},fromPairs:function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},head:sf,indexOf:function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:wd(r);return i<0&&(i=If(n+i,0)),al(e,t,i)},initial:function(e){return null!=e&&e.length?Ou(e,0,-1):[]},intersection:Mf,intersectionBy:xf,intersectionWith:Uf,join:function(e,t){return null==e?"":fg.call(e,t)},last:Tm,lastIndexOf:function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=n;return void 0!==r&&(i=(i=wd(r))<0?Sg(n+i,0):Tg(i,n-1)),t==t?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(e,t,i):sl(e,ol,i,!0)},nth:function(e,t){return e&&e.length?Gg(e,wd(t)):void 0},pull:Hv,pullAll:Bv,pullAllBy:function(e,t,r){return e&&e.length&&t&&t.length?Vv(e,t,Op(r)):e},pullAllWith:function(e,t,r){return e&&e.length&&t&&t.length?Vv(e,t,void 0,r):e},pullAt:$v,remove:function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],s=e.length;for(t=Op(t);++n<s;){var o=e[n];t(o,n,e)&&(r.push(o),i.push(n))}return Gv(e,i),r},reverse:dy,slice:function(e,t,r){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&Yl(e,t,r)?(t=0,r=n):(t=null==t?0:wd(t),r=void 0===r?n:wd(r)),Ou(e,t,r)):[]},sortedIndex:function(e,t){return Cy(e,t)},sortedIndexBy:function(e,t,r){return Ry(e,t,Op(r))},sortedIndexOf:function(e,t){var r=null==e?0:e.length;if(r){var n=Cy(e,t);if(n<r&&Nn(e[n],t))return n}return-1},sortedLastIndex:function(e,t){return Cy(e,t,!0)},sortedLastIndexBy:function(e,t,r){return Ry(e,t,Op(r),!0)},sortedLastIndexOf:function(e,t){if(null!=e&&e.length){var r=Cy(e,t,!0)-1;if(Nn(e[r],t))return r}return-1},sortedUniq:function(e){return e&&e.length?Iy(e):[]},sortedUniqBy:function(e,t){return e&&e.length?Iy(e,Op(t)):[]},tail:function(e){var t=null==e?0:e.length;return t?Ou(e,1,t):[]},take:function(e,t,r){return e&&e.length?Ou(e,0,(t=r||void 0===t?1:wd(t))<0?0:t):[]},takeRight:function(e,t,r){var n=null==e?0:e.length;return n?Ou(e,(t=n-(t=r||void 0===t?1:wd(t)))<0?0:t,n):[]},takeRightWhile:function(e,t){return e&&e.length?Im(e,Op(t),!1,!0):[]},takeWhile:function(e,t){return e&&e.length?Im(e,Op(t)):[]},union:p_,unionBy:f_,unionWith:v_,uniq:function(e){return e&&e.length?u_(e):[]},uniqBy:function(e,t){return e&&e.length?u_(e,Op(t)):[]},uniqWith:function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?u_(e,void 0,t):[]},unzip:S_,unzipWith:T_,without:R_,xor:D_,xorBy:M_,xorWith:x_,zip:L_,zipObject:function(e,t){return U_(e||[],t||[],Ii)},zipObjectDeep:function(e,t){return U_(e||[],t||[],_a)},zipWith:j_},V_={countBy:Gp,each:Pm,eachRight:xm,every:function(e,t,r){var n=ji(e)?qm:$m;return r&&Yl(e,t,r)&&(t=void 0),n(e,Op(t))},filter:function(e,t){return(ji(e)?bs:Jm)(e,Op(t))},find:Xm,findLast:nf,flatMap:function(e,t){return uu(af(e,t),1)},flatMapDeep:function(e,t){return uu(af(e,t),1/0)},flatMapDepth:function(e,t,r){return r=void 0===r?1:wd(r),uu(af(e,t),r)},forEach:Pm,forEachRight:xm,groupBy:ff,includes:function(e,t,r,n){e=hs(e)?e:Rf(e),r=r&&!n?wd(r):0;var i=e.length;return r<0&&(r=Cf(i+r,0)),wf(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&al(e,t,r)>-1},invokeMap:Yf,keyBy:_g,map:af,orderBy:function(e,t,r,n){return null==e?[]:(ji(t)||(t=null==t?[]:[t]),ji(r=n?void 0:r)||(r=null==r?[]:[r]),Xg(e,t,r))},partition:xv,reduce:function(e,t,r){var n=ji(e)?Xu:oy,i=arguments.length<3;return n(e,Op(t),r,i,Fp)},reduceRight:function(e,t,r){var n=ji(e)?ay:oy,i=arguments.length<3;return n(e,Op(t),r,i,Nm)},reject:function(e,t){return(ji(e)?bs:Jm)(e,Bg(Op(t)))},sample:function(e){return(ji(e)?uy:hy)(e)},sampleSize:function(e,t,r){return t=(r?Yl(e,t,r):void 0===t)?1:wd(t),(ji(e)?my:fy)(e,t)},shuffle:function(e){return(ji(e)?gy:vy)(e)},size:function(e){if(null==e)return 0;if(hs(e))return wf(e)?bv(e):e.length;var t=Ys(e);return"[object Map]"==t||"[object Set]"==t?e.size:us(e).length},some:function(e,t,r){var n=ji(e)?Hh:Sy;return r&&Yl(e,t,r)&&(t=void 0),n(e,Op(t))},sortBy:Ey},B_=zp,H_={after:function(e,t){if("function"!=typeof t)throw new TypeError("Expected a function");return e=wd(e),function(){if(--e<1)return t.apply(this,arguments)}},ary:zl,before:ku,bind:Cu,bindKey:Du,curry:qp,curryRight:$p,debounce:Qp,defer:pm,delay:fm,flip:function(e){return $l(e,512)},memoize:Xo,negate:Bg,once:function(e){return ku(2,e)},overArgs:iv,partial:Dv,partialRight:Mv,rearg:sy,rest:function(e,t){if("function"!=typeof e)throw new TypeError("Expected a function");return Ql(e,t=void 0===t?t:wd(t))},spread:function(e,t){if("function"!=typeof e)throw new TypeError("Expected a function");return t=null==t?0:Ay(wd(t),0),Ql((function(r){var n=r[t],i=Mu(r,0,t);return n&&As(i,n),Dd(e,this,i)}))},throttle:function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Yn(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),Qp(e,t,{leading:n,maxWait:t,trailing:i})},unary:function(e){return zl(e,1)},wrap:function(e,t){return Dv(Am(t),e)}},W_={castArray:function(){if(!arguments.length)return[];var e=arguments[0];return ji(e)?e:[e]},clone:function(e){return Wo(e,4)},cloneDeep:$o,cloneDeepWith:function(e,t){return Wo(e,5,t="function"==typeof t?t:void 0)},cloneWith:function(e,t){return Wo(e,4,t="function"==typeof t?t:void 0)},conformsTo:function(e,t){return null==t||Mp(e,t,ps(t))},eq:Nn,gt:yf,gte:Sf,isArguments:Ui,isArray:ji,isArrayBuffer:eg,isArrayLike:hs,isArrayLikeObject:rm,isBoolean:function(e){return!0===e||!1===e||Di(e)&&"[object Boolean]"==Qn(e)},isBuffer:Wi,isDate:ng,isElement:function(e){return Di(e)&&1===e.nodeType&&!Tu(e)},isEmpty:sg,isEqual:og,isEqualWith:function(e,t,r){var n=(r="function"==typeof r?r:void 0)?r(e,t):void 0;return void 0===n?vp(e,t,void 0,r):!!n},isError:Eu,isFinite:function(e){return"number"==typeof e&&ag(e)},isFunction:ri,isInteger:cg,isLength:Ji,isMap:Do,isMatch:function(e,t){return e===t||Sp(e,t,Ep(t))},isMatchWith:function(e,t,r){return r="function"==typeof r?r:void 0,Sp(e,t,Ep(t),r)},isNaN:function(e){return dg(e)&&e!=+e},isNative:function(e){if(lg(e))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return pi(e)},isNil:function(e){return null==e},isNull:function(e){return null===e},isNumber:dg,isObject:Yn,isObjectLike:Di,isPlainObject:Tu,isRegExp:pg,isSafeInteger:function(e){return cg(e)&&e>=-mg&&e<=mg},isSet:No,isString:wf,isSymbol:Jo,isTypedArray:ns,isUndefined:function(e){return void 0===e},isWeakMap:function(e){return Di(e)&&"[object WeakMap]"==Ys(e)},isWeakSet:function(e){return Di(e)&&"[object WeakSet]"==Qn(e)},lt:Rg,lte:Ig,toArray:Wg,toFinite:bd,toInteger:wd,toLength:zm,toNumber:Sd,toPlainObject:im,toSafeInteger:function(e){return e?Vh(wd(e),-e_,e_):0===e?e:0},toString:la},G_={add:ld,ceil:Lh,divide:Cm,floor:cf,max:function(e){return e&&e.length?Ag(e,kd,gf):void 0},maxBy:function(e,t){return e&&e.length?Ag(e,Op(t),gf):void 0},mean:function(e){return Dg(e,kd)},meanBy:function(e,t){return Dg(e,Op(t))},min:function(e){return e&&e.length?Ag(e,kd,kg):void 0},minBy:function(e,t){return e&&e.length?Ag(e,Op(t),kg):void 0},multiply:Vg,round:ly,subtract:My,sum:function(e){return e&&e.length?Pg(e,kd):0},sumBy:function(e,t){return e&&e.length?Pg(e,Op(t)):0}},q_={assign:tu,assignIn:nu,assignInWith:su,assignWith:au,at:mu,create:function(e,t){var r=Co(e);return null==t?r:ms(r,t)},defaults:em,defaultsDeep:lm,entries:Um,entriesIn:jm,extend:nu,extendWith:su,findKey:function(e,t){return Zm(e,Op(t),Up)},findLastKey:function(e,t){return Zm(e,Op(t),Mm)},forIn:function(e,t){return null==e?e:Lp(e,Am(t),gs)},forInRight:function(e,t){return null==e?e:Om(e,Am(t),gs)},forOwn:function(e,t){return e&&Up(e,Am(t))},forOwnRight:function(e,t){return e&&Mm(e,Am(t))},functions:function(e){return null==e?[]:hf(e,ps(e))},functionsIn:function(e){return null==e?[]:hf(e,gs(e))},get:fa,has:function(e,t){return null!=e&&ya(e,t,va)},hasIn:Rp,invert:Bf,invertBy:$f,invoke:Kf,keys:ps,keysIn:gs,mapKeys:function(e,t){var r={};return t=Op(t),Up(e,(function(e,n,i){Ri(r,t(e,n,i),e)})),r},mapValues:function(e,t){var r={};return t=Op(t),Up(e,(function(e,n,i){Ri(r,n,t(e,n,i))})),r},merge:Mg,mergeWith:cm,omit:Jg,omitBy:function(e,t){return Qg(e,Bg(Op(t)))},pick:Uv,pickBy:Qg,result:function(e,t,r){var n=-1,i=(t=ua(t,e)).length;for(i||(i=1,e=void 0);++n<i;){var s=null==e?void 0:e[pa(t[n])];void 0===s&&(n=i,s=r),e=ri(s)?s.call(e):s}return e},set:function(e,t,r){return null==e?e:_a(e,t,r)},setWith:function(e,t,r,n){return n="function"==typeof n?n:void 0,null==e?e:_a(e,t,r,n)},toPairs:Um,toPairsIn:jm,transform:function(e,t,r){var n=ji(e),i=n||Wi(e)||ns(e);if(t=Op(t),null==r){var s=e&&e.constructor;r=i?n?new s:[]:Yn(e)&&ri(s)?Co(Ps(e)):{}}return(i?bi:Up)(e,(function(e,n,i){return t(r,e,n,i)})),r},unset:function(e,t){return null==e||qg(e,t)},update:function(e,t,r){return null==e?e:E_(e,t,Am(r))},updateWith:function(e,t,r,n){return n="function"==typeof n?n:void 0,null==e?e:E_(e,t,Am(r),n)},values:Rf,valuesIn:function(e){return null==e?[]:kf(e,gs(e))}},$_={at:I_,chain:Uh,commit:function(){return new qd(this.value(),this.__chain__)},lodash:Jd,next:function(){void 0===this.__values__&&(this.__values__=Wg(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},plant:function(e){for(var t,r=this;r instanceof Ld;){var n=$d(r);n.__index__=0,n.__values__=void 0,t?i.__wrapped__=n:t=n;var i=n;r=r.__wrapped__}return i.__wrapped__=e,t},reverse:function(){var e=this.__wrapped__;if(e instanceof jd){var t=e;return this.__actions__.length&&(t=new jd(this)),(t=t.reverse()).__actions__.push({func:Ky,args:[dy],thisArg:void 0}),new qd(t,this.__chain__)}return this.thru(dy)},tap:function(e,t){return t(e),e},thru:Ky,toIterator:function(){return this},toJSON:Zy,value:Zy,valueOf:Zy,wrapperChain:function(){return Uh(this)}},z_={camelCase:Oh,capitalize:Yu,deburr:nh,endsWith:function(e,t,r){e=la(e),t=da(t);var n=e.length,i=r=void 0===r?n:Vh(wd(r),0,n);return(r-=t.length)>=0&&e.slice(r,i)==t},escape:Hm,escapeRegExp:function(e){return(e=la(e))&&Gm.test(e)?e.replace(Wm,"\\$&"):e},kebabCase:vg,lowerCase:bg,lowerFirst:wg,pad:function(e,t,r){e=la(e);var n=(t=wd(t))?bv(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return kv(Cv(i),r)+e+kv(Rv(i),r)},padEnd:function(e,t,r){e=la(e);var n=(t=wd(t))?bv(e):0;return t&&n<t?e+kv(t-n,r):e},padStart:function(e,t,r){e=la(e);var n=(t=wd(t))?bv(e):0;return t&&n<t?kv(t-n,r)+e:e},parseInt:function(e,t,r){return r||null==t?t=0:t&&(t=+t),Av(la(e).replace(Iv,""),t||0)},repeat:function(e,t,r){return t=(r?Yl(e,t,r):void 0===t)?1:wd(t),dv(la(e),t)},replace:function(){var e=arguments,t=la(e[0]);return e.length<3?t:t.replace(e[1],e[2])},snakeCase:_y,split:function(e,t,r){return r&&"number"!=typeof r&&Yl(e,t,r)&&(t=r=void 0),(r=void 0===r?4294967295:r>>>0)?(e=la(e))&&("string"==typeof t||null!=t&&!pg(t))&&!(t=da(t))&&xu(e)?Mu(Ju(e),0,r):e.split(t,r):[]},startCase:Dy,startsWith:function(e,t,r){return e=la(e),r=null==r?0:Vh(wd(r),0,e.length),t=da(t),e.slice(r,r+t.length)==t},template:function(e,t,r){var n=Vy.imports._.templateSettings||Vy;r&&Yl(e,t,r)&&(t=void 0),e=la(e),t=su({},t,n,Ly);var i,s,o=su({},t.imports,n.imports,Ly),a=ps(o),c=kf(o,a),d=0,l=t.interpolate||$y,u="__p += '",h=RegExp((t.escape||$y).source+"|"+l.source+"|"+(l===Fy?qy:$y).source+"|"+(t.evaluate||$y).source+"|$","g"),p=Jy.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/\s/g," ")+"\n":"";e.replace(h,(function(t,r,n,o,a,c){return n||(n=o),u+=e.slice(d,c).replace(zy,jy),r&&(i=!0,u+="' +\n__e("+r+") +\n'"),a&&(s=!0,u+="';\n"+a+";\n__p += '"),n&&(u+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),d=c+t.length,t})),u+="';\n";var m=Jy.call(t,"variable")&&t.variable;if(m){if(Gy.test(m))throw new Error("Invalid `variable` option passed into `_.template`")}else u="with (obj) {\n"+u+"\n}\n";u=(s?u.replace(By,""):u).replace(Hy,"$1").replace(Wy,"$1;"),u="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}";var f=wu((function(){return Function(a,p+"return "+u).apply(void 0,c)}));if(f.source=u,Eu(f))throw f;return f},templateSettings:Vy,toLower:function(e){return la(e).toLowerCase()},toUpper:function(e){return la(e).toUpperCase()},trim:function(e,t,r){if((e=la(e))&&(r||void 0===t))return md(e);if(!e||!(t=da(t)))return e;var n=Ju(e),i=Ju(t);return Mu(n,r_(n,i),t_(n,i)+1).join("")},trimEnd:function(e,t,r){if((e=la(e))&&(r||void 0===t))return e.slice(0,hd(e)+1);if(!e||!(t=da(t)))return e;var n=Ju(e);return Mu(n,0,t_(n,Ju(t))+1).join("")},trimStart:function(e,t,r){if((e=la(e))&&(r||void 0===t))return e.replace(n_,"");if(!e||!(t=da(t)))return e;var n=Ju(e);return Mu(n,r_(n,Ju(t))).join("")},truncate:function(e,t){var r=30,n="...";if(Yn(t)){var i="separator"in t?t.separator:i;r="length"in t?wd(t.length):r,n="omission"in t?da(t.omission):n}var s=(e=la(e)).length;if(xu(e)){var o=Ju(e);s=o.length}if(r>=s)return e;var a=r-bv(n);if(a<1)return n;var c=o?Mu(o,0,a).join(""):e.slice(0,a);if(void 0===i)return c+n;if(o&&(a+=c.length-a),pg(i)){if(e.slice(a).search(i)){var d,l=c;for(i.global||(i=RegExp(i.source,la(i_.exec(i))+"g")),i.lastIndex=0;d=i.exec(l);)var u=d.index;c=c.slice(0,void 0===u?a:u)}}else if(e.indexOf(da(i),a)!=a){var h=c.lastIndexOf(i);h>-1&&(c=c.slice(0,h))}return c+n},unescape:function(e){return(e=la(e))&&a_.test(e)?e.replace(o_,s_):e},upperCase:w_,upperFirst:Qu,words:Ih},J_={attempt:wu,bindAll:Au,cond:function(e){var t=null==e?0:e.length,r=Op;return e=t?sa(e,(function(e){if("function"!=typeof e[1])throw new TypeError("Expected a function");return[r(e[0]),e[1]]})):[],Ql((function(r){for(var n=-1;++n<t;){var i=e[n];if(Dd(i[0],this,r))return Dd(i[1],this,r)}}))},conforms:function(e){return function(e){var t=ps(e);return function(r){return Mp(r,e,t)}}(Wo(e,1))},constant:rl,defaultTo:function(e,t){return null==e||e!=e?t:e},flow:lf,flowRight:uf,identity:kd,iteratee:function(e){return Op("function"==typeof e?e:Wo(e,1))},matches:function(e){return wp(Wo(e,1))},matchesProperty:function(e,t){return Ap(e,Wo(t,1))},method:xg,methodOf:Ug,mixin:jg,noop:Fd,nthArg:function(e){return e=wd(e),Ql((function(t){return Gg(t,e)}))},over:ev,overEvery:sv,overSome:ov,property:Dp,propertyOf:function(e){return function(t){return null==e?void 0:ma(e,t)}},range:ry,rangeRight:ny,stubArray:ws,stubFalse:Fi,stubObject:function(){return{}},stubString:function(){return""},stubTrue:function(){return!0},times:function(e,t){if((e=wd(e))<1||e>9007199254740991)return[];var r=Qy,n=Yy(e,Qy);t=Am(t),e-=Qy;for(var i=Pi(n,t);++r<e;)t(r);return i},toPath:function(e){return ji(e)?sa(e,pa):Jo(e)?[e]:Es(ia(la(e)))},uniqueId:function(e){var t=++y_;return la(e)+t}};var K_=Math.max,Q_=Math.min,Y_=Math.min,X_=4294967295,Z_=Array.prototype,eS=Object.prototype.hasOwnProperty,tS=Bn?Bn.iterator:void 0,rS=Math.max,nS=Math.min,iS=function(e){return function(t,r,n){if(null==n){var i=Yn(r),s=i&&ps(r),o=s&&s.length&&hf(r,s);(o?o.length:i)||(n=r,r=t,t=this)}return e(t,r,n)}}(jg);Jd.after=H_.after,Jd.ary=H_.ary,Jd.assign=q_.assign,Jd.assignIn=q_.assignIn,Jd.assignInWith=q_.assignInWith,Jd.assignWith=q_.assignWith,Jd.at=q_.at,Jd.before=H_.before,Jd.bind=H_.bind,Jd.bindAll=J_.bindAll,Jd.bindKey=H_.bindKey,Jd.castArray=W_.castArray,Jd.chain=$_.chain,Jd.chunk=F_.chunk,Jd.compact=F_.compact,Jd.concat=F_.concat,Jd.cond=J_.cond,Jd.conforms=J_.conforms,Jd.constant=J_.constant,Jd.countBy=V_.countBy,Jd.create=q_.create,Jd.curry=H_.curry,Jd.curryRight=H_.curryRight,Jd.debounce=H_.debounce,Jd.defaults=q_.defaults,Jd.defaultsDeep=q_.defaultsDeep,Jd.defer=H_.defer,Jd.delay=H_.delay,Jd.difference=F_.difference,Jd.differenceBy=F_.differenceBy,Jd.differenceWith=F_.differenceWith,Jd.drop=F_.drop,Jd.dropRight=F_.dropRight,Jd.dropRightWhile=F_.dropRightWhile,Jd.dropWhile=F_.dropWhile,Jd.fill=F_.fill,Jd.filter=V_.filter,Jd.flatMap=V_.flatMap,Jd.flatMapDeep=V_.flatMapDeep,Jd.flatMapDepth=V_.flatMapDepth,Jd.flatten=F_.flatten,Jd.flattenDeep=F_.flattenDeep,Jd.flattenDepth=F_.flattenDepth,Jd.flip=H_.flip,Jd.flow=J_.flow,Jd.flowRight=J_.flowRight,Jd.fromPairs=F_.fromPairs,Jd.functions=q_.functions,Jd.functionsIn=q_.functionsIn,Jd.groupBy=V_.groupBy,Jd.initial=F_.initial,Jd.intersection=F_.intersection,Jd.intersectionBy=F_.intersectionBy,Jd.intersectionWith=F_.intersectionWith,Jd.invert=q_.invert,Jd.invertBy=q_.invertBy,Jd.invokeMap=V_.invokeMap,Jd.iteratee=J_.iteratee,Jd.keyBy=V_.keyBy,Jd.keys=ps,Jd.keysIn=q_.keysIn,Jd.map=V_.map,Jd.mapKeys=q_.mapKeys,Jd.mapValues=q_.mapValues,Jd.matches=J_.matches,Jd.matchesProperty=J_.matchesProperty,Jd.memoize=H_.memoize,Jd.merge=q_.merge,Jd.mergeWith=q_.mergeWith,Jd.method=J_.method,Jd.methodOf=J_.methodOf,Jd.mixin=iS,Jd.negate=Bg,Jd.nthArg=J_.nthArg,Jd.omit=q_.omit,Jd.omitBy=q_.omitBy,Jd.once=H_.once,Jd.orderBy=V_.orderBy,Jd.over=J_.over,Jd.overArgs=H_.overArgs,Jd.overEvery=J_.overEvery,Jd.overSome=J_.overSome,Jd.partial=H_.partial,Jd.partialRight=H_.partialRight,Jd.partition=V_.partition,Jd.pick=q_.pick,Jd.pickBy=q_.pickBy,Jd.property=J_.property,Jd.propertyOf=J_.propertyOf,Jd.pull=F_.pull,Jd.pullAll=F_.pullAll,Jd.pullAllBy=F_.pullAllBy,Jd.pullAllWith=F_.pullAllWith,Jd.pullAt=F_.pullAt,Jd.range=J_.range,Jd.rangeRight=J_.rangeRight,Jd.rearg=H_.rearg,Jd.reject=V_.reject,Jd.remove=F_.remove,Jd.rest=H_.rest,Jd.reverse=F_.reverse,Jd.sampleSize=V_.sampleSize,Jd.set=q_.set,Jd.setWith=q_.setWith,Jd.shuffle=V_.shuffle,Jd.slice=F_.slice,Jd.sortBy=V_.sortBy,Jd.sortedUniq=F_.sortedUniq,Jd.sortedUniqBy=F_.sortedUniqBy,Jd.split=z_.split,Jd.spread=H_.spread,Jd.tail=F_.tail,Jd.take=F_.take,Jd.takeRight=F_.takeRight,Jd.takeRightWhile=F_.takeRightWhile,Jd.takeWhile=F_.takeWhile,Jd.tap=$_.tap,Jd.throttle=H_.throttle,Jd.thru=Ky,Jd.toArray=W_.toArray,Jd.toPairs=q_.toPairs,Jd.toPairsIn=q_.toPairsIn,Jd.toPath=J_.toPath,Jd.toPlainObject=W_.toPlainObject,Jd.transform=q_.transform,Jd.unary=H_.unary,Jd.union=F_.union,Jd.unionBy=F_.unionBy,Jd.unionWith=F_.unionWith,Jd.uniq=F_.uniq,Jd.uniqBy=F_.uniqBy,Jd.uniqWith=F_.uniqWith,Jd.unset=q_.unset,Jd.unzip=F_.unzip,Jd.unzipWith=F_.unzipWith,Jd.update=q_.update,Jd.updateWith=q_.updateWith,Jd.values=q_.values,Jd.valuesIn=q_.valuesIn,Jd.without=F_.without,Jd.words=z_.words,Jd.wrap=H_.wrap,Jd.xor=F_.xor,Jd.xorBy=F_.xorBy,Jd.xorWith=F_.xorWith,Jd.zip=F_.zip,Jd.zipObject=F_.zipObject,Jd.zipObjectDeep=F_.zipObjectDeep,Jd.zipWith=F_.zipWith,Jd.entries=q_.toPairs,Jd.entriesIn=q_.toPairsIn,Jd.extend=q_.assignIn,Jd.extendWith=q_.assignInWith,iS(Jd,Jd),Jd.add=G_.add,Jd.attempt=J_.attempt,Jd.camelCase=z_.camelCase,Jd.capitalize=z_.capitalize,Jd.ceil=G_.ceil,Jd.clamp=function(e,t,r){return void 0===r&&(r=t,t=void 0),void 0!==r&&(r=(r=Sd(r))==r?r:0),void 0!==t&&(t=(t=Sd(t))==t?t:0),Vh(Sd(e),t,r)},Jd.clone=W_.clone,Jd.cloneDeep=W_.cloneDeep,Jd.cloneDeepWith=W_.cloneDeepWith,Jd.cloneWith=W_.cloneWith,Jd.conformsTo=W_.conformsTo,Jd.deburr=z_.deburr,Jd.defaultTo=J_.defaultTo,Jd.divide=G_.divide,Jd.endsWith=z_.endsWith,Jd.eq=W_.eq,Jd.escape=z_.escape,Jd.escapeRegExp=z_.escapeRegExp,Jd.every=V_.every,Jd.find=V_.find,Jd.findIndex=F_.findIndex,Jd.findKey=q_.findKey,Jd.findLast=V_.findLast,Jd.findLastIndex=F_.findLastIndex,Jd.findLastKey=q_.findLastKey,Jd.floor=G_.floor,Jd.forEach=V_.forEach,Jd.forEachRight=V_.forEachRight,Jd.forIn=q_.forIn,Jd.forInRight=q_.forInRight,Jd.forOwn=q_.forOwn,Jd.forOwnRight=q_.forOwnRight,Jd.get=q_.get,Jd.gt=W_.gt,Jd.gte=W_.gte,Jd.has=q_.has,Jd.hasIn=q_.hasIn,Jd.head=F_.head,Jd.identity=kd,Jd.includes=V_.includes,Jd.indexOf=F_.indexOf,Jd.inRange=function(e,t,r){return t=bd(t),void 0===r?(r=t,t=0):r=bd(r),function(e,t,r){return e>=Ef(t,r)&&e<Tf(t,r)}(e=Sd(e),t,r)},Jd.invoke=q_.invoke,Jd.isArguments=W_.isArguments,Jd.isArray=ji,Jd.isArrayBuffer=W_.isArrayBuffer,Jd.isArrayLike=W_.isArrayLike,Jd.isArrayLikeObject=W_.isArrayLikeObject,Jd.isBoolean=W_.isBoolean,Jd.isBuffer=W_.isBuffer,Jd.isDate=W_.isDate,Jd.isElement=W_.isElement,Jd.isEmpty=W_.isEmpty,Jd.isEqual=W_.isEqual,Jd.isEqualWith=W_.isEqualWith,Jd.isError=W_.isError,Jd.isFinite=W_.isFinite,Jd.isFunction=W_.isFunction,Jd.isInteger=W_.isInteger,Jd.isLength=W_.isLength,Jd.isMap=W_.isMap,Jd.isMatch=W_.isMatch,Jd.isMatchWith=W_.isMatchWith,Jd.isNaN=W_.isNaN,Jd.isNative=W_.isNative,Jd.isNil=W_.isNil,Jd.isNull=W_.isNull,Jd.isNumber=W_.isNumber,Jd.isObject=Yn,Jd.isObjectLike=W_.isObjectLike,Jd.isPlainObject=W_.isPlainObject,Jd.isRegExp=W_.isRegExp,Jd.isSafeInteger=W_.isSafeInteger,Jd.isSet=W_.isSet,Jd.isString=W_.isString,Jd.isSymbol=W_.isSymbol,Jd.isTypedArray=W_.isTypedArray,Jd.isUndefined=W_.isUndefined,Jd.isWeakMap=W_.isWeakMap,Jd.isWeakSet=W_.isWeakSet,Jd.join=F_.join,Jd.kebabCase=z_.kebabCase,Jd.last=Tm,Jd.lastIndexOf=F_.lastIndexOf,Jd.lowerCase=z_.lowerCase,Jd.lowerFirst=z_.lowerFirst,Jd.lt=W_.lt,Jd.lte=W_.lte,Jd.max=G_.max,Jd.maxBy=G_.maxBy,Jd.mean=G_.mean,Jd.meanBy=G_.meanBy,Jd.min=G_.min,Jd.minBy=G_.minBy,Jd.stubArray=J_.stubArray,Jd.stubFalse=J_.stubFalse,Jd.stubObject=J_.stubObject,Jd.stubString=J_.stubString,Jd.stubTrue=J_.stubTrue,Jd.multiply=G_.multiply,Jd.nth=F_.nth,Jd.noop=J_.noop,Jd.now=B_,Jd.pad=z_.pad,Jd.padEnd=z_.padEnd,Jd.padStart=z_.padStart,Jd.parseInt=z_.parseInt,Jd.random=function(e,t,r){if(r&&"boolean"!=typeof r&&Yl(e,t,r)&&(t=r=void 0),void 0===r&&("boolean"==typeof t?(r=t,t=void 0):"boolean"==typeof e&&(r=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=bd(e),void 0===t?(t=e,e=0):t=bd(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var i=Xv();return Yv(e+i*(t-e+Qv("1e-"+((i+"").length-1))),t)}return Kv(e,t)},Jd.reduce=V_.reduce,Jd.reduceRight=V_.reduceRight,Jd.repeat=z_.repeat,Jd.replace=z_.replace,Jd.result=q_.result,Jd.round=G_.round,Jd.sample=V_.sample,Jd.size=V_.size,Jd.snakeCase=z_.snakeCase,Jd.some=V_.some,Jd.sortedIndex=F_.sortedIndex,Jd.sortedIndexBy=F_.sortedIndexBy,Jd.sortedIndexOf=F_.sortedIndexOf,Jd.sortedLastIndex=F_.sortedLastIndex,Jd.sortedLastIndexBy=F_.sortedLastIndexBy,Jd.sortedLastIndexOf=F_.sortedLastIndexOf,Jd.startCase=z_.startCase,Jd.startsWith=z_.startsWith,Jd.subtract=G_.subtract,Jd.sum=G_.sum,Jd.sumBy=G_.sumBy,Jd.template=z_.template,Jd.times=J_.times,Jd.toFinite=W_.toFinite,Jd.toInteger=wd,Jd.toLength=W_.toLength,Jd.toLower=z_.toLower,Jd.toNumber=W_.toNumber,Jd.toSafeInteger=W_.toSafeInteger,Jd.toString=W_.toString,Jd.toUpper=z_.toUpper,Jd.trim=z_.trim,Jd.trimEnd=z_.trimEnd,Jd.trimStart=z_.trimStart,Jd.truncate=z_.truncate,Jd.unescape=z_.unescape,Jd.uniqueId=J_.uniqueId,Jd.upperCase=z_.upperCase,Jd.upperFirst=z_.upperFirst,Jd.each=V_.forEach,Jd.eachRight=V_.forEachRight,Jd.first=F_.head,iS(Jd,function(){var e={};return Up(Jd,(function(t,r){eS.call(Jd.prototype,r)||(e[r]=t)})),e}(),{chain:!1}),Jd.VERSION="4.17.21",(Jd.templateSettings=z_.templateSettings).imports._=Jd,bi(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Jd[e].placeholder=Jd})),bi(["drop","take"],(function(e,t){jd.prototype[e]=function(r){r=void 0===r?1:rS(wd(r),0);var n=this.__filtered__&&!t?new jd(this):this.clone();return n.__filtered__?n.__takeCount__=nS(r,n.__takeCount__):n.__views__.push({size:nS(r,X_),type:e+(n.__dir__<0?"Right":"")}),n},jd.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),bi(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;jd.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Op(e),type:r}),t.__filtered__=t.__filtered__||n,t}})),bi(["head","last"],(function(e,t){var r="take"+(t?"Right":"");jd.prototype[e]=function(){return this[r](1).value()[0]}})),bi(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");jd.prototype[e]=function(){return this.__filtered__?new jd(this):this[r](1)}})),jd.prototype.compact=function(){return this.filter(kd)},jd.prototype.find=function(e){return this.filter(e).head()},jd.prototype.findLast=function(e){return this.reverse().find(e)},jd.prototype.invokeMap=Ql((function(e,t){return"function"==typeof e?new jd(this):this.map((function(r){return Jf(r,e,t)}))})),jd.prototype.reject=function(e){return this.filter(Bg(Op(e)))},jd.prototype.slice=function(e,t){e=wd(e);var r=this;return r.__filtered__&&(e>0||t<0)?new jd(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),void 0!==t&&(r=(t=wd(t))<0?r.dropRight(-t):r.take(t-e)),r)},jd.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},jd.prototype.toArray=function(){return this.take(X_)},Up(jd.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),i=Jd[n?"take"+("last"==t?"Right":""):t],s=n||/^find/.test(t);i&&(Jd.prototype[t]=function(){var t=this.__wrapped__,o=n?[1]:arguments,a=t instanceof jd,c=o[0],d=a||ji(t),l=function(e){var t=i.apply(Jd,As([e],o));return n&&u?t[0]:t};d&&r&&"function"==typeof c&&1!=c.length&&(a=d=!1);var u=this.__chain__,h=!!this.__actions__.length,p=s&&!u,m=a&&!h;if(!s&&d){t=m?t:new jd(this);var f=e.apply(t,o);return f.__actions__.push({func:Ky,args:[l],thisArg:void 0}),new qd(f,u)}return p&&m?e.apply(this,o):(f=this.thru(l),p?n?f.value()[0]:f.value():f)})})),bi(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Z_[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Jd.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply(ji(i)?i:[],e)}return this[r]((function(r){return t.apply(ji(r)?r:[],e)}))}})),Up(jd.prototype,(function(e,t){var r=Jd[t];if(r){var n=r.name+"";eS.call(Hd,n)||(Hd[n]=[]),Hd[n].push({name:t,func:r})}})),Hd[Il(void 0,2).name]=[{name:"wrapper",func:void 0}],jd.prototype.clone=function(){var e=new jd(this.__wrapped__);return e.__actions__=Es(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Es(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Es(this.__views__),e},jd.prototype.reverse=function(){if(this.__filtered__){var e=new jd(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},jd.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=ji(e),n=t<0,i=r?e.length:0,s=function(e,t,r){for(var n=-1,i=r.length;++n<i;){var s=r[n],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=Q_(t,e+o);break;case"takeRight":e=K_(e,t-o)}}return{start:e,end:t}}(0,i,this.__views__),o=s.start,a=s.end,c=a-o,d=n?a:o-1,l=this.__iteratees__,u=l.length,h=0,p=Y_(c,this.__takeCount__);if(!r||!n&&i==c&&p==c)return Xy(e,this.__actions__);var m=[];e:for(;c--&&h<p;){for(var f=-1,g=e[d+=t];++f<u;){var v=l[f],y=v.iteratee,_=v.type,S=y(g);if(2==_)g=S;else if(!S){if(1==_)continue e;break e}}m[h++]=g}return m},Jd.prototype.at=$_.at,Jd.prototype.chain=$_.wrapperChain,Jd.prototype.commit=$_.commit,Jd.prototype.next=$_.next,Jd.prototype.plant=$_.plant,Jd.prototype.reverse=$_.reverse,Jd.prototype.toJSON=Jd.prototype.valueOf=Jd.prototype.value=$_.value,Jd.prototype.first=Jd.prototype.head,tS&&(Jd.prototype[tS]=$_.toIterator);const sS="chrome",oS="opera",aS="firefox",cS="iexplorer",dS="safari",lS="nwjs",uS="electron",hS="react-native",pS="unknown",mS={Chrome:sS,Chromium:sS,Opera:oS,Firefox:aS,"Internet Explorer":cS,Safari:dS};function fS(){const{userAgent:e}=navigator;if(e.match(/Electron/)){const t=e.match(/Electron\/([\d.]+)/)[1];return{name:uS,version:t}}return null}function gS(){const{userAgent:e}=navigator;if(e.match(/JitsiMeetNW/)){const t=e.match(/JitsiMeetNW\/([\d.]+)/)[1];return{name:lS,version:t}}}function vS(){const e=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i);let t;if(e||"ReactNative"===navigator.product)return e&&e.length>2&&(e[1],t=e[2]),t||(t="unknown"),{name:hS,version:t}}class yS{constructor(){Kt(this,"_bowser"),Kt(this,"_name"),Kt(this,"_version"),Kt(this,"getDeviceInfo",(()=>({isMobile:this.isMobile(),browserName:this._bowser.getBrowserName(),osName:this._bowser.getOSName(),browserVersion:this._bowser.getBrowserVersion(),osVersionName:this._bowser.getOSVersion(),engineName:this._bowser.getEngineName()})))}init(e){let t,r;if(this._bowser=f().getParser(navigator.userAgent),void 0===e){const e=function(e){let t;const r=[vS,fS,gS];for(let e=0;e<r.length;e+=1)if(t=r[e](),t)return t;const n=e.getBrowserName();return n in mS?{name:mS[n],version:e.getBrowserVersion()}:(t=function(){const{userAgent:e}=navigator,t={name:pS,version:void 0};if(e.match(/Chrome/)&&!e.match(/Edge/))if(e.match(/Edg(A?)/)){const r=e.match(/Chrome\/([\d.]+)/)[1];Number.parseInt(r,10)>72&&(t.name=sS,t.version=r)}else t.name=sS,t.version=e.match(/Chrome\/([\d.]+)/)[1];return t}(),t||{name:pS,version:void 0})}(this._bowser);t=e.name,r=e.version}else e.name in mS?(t=mS[e.name],r=e.version):(t=pS,r=void 0);this._name=t,this._version=r}getName(){return this._name}isChrome(){return this._name===sS}isOpera(){return this._name===oS}isFirefox(){return this._name===aS}isIExplorer(){return this._name===cS}isSafari(){return this._name===dS}isNWJS(){return this._name===lS}isElectron(){return this._name===uS}isReactNative(){return this._name===hS||!0===navigator.isReactNative}getVersion(){return this._version}isMobile(){return"mobile"===this._bowser.getPlatformType()}_checkCondition(e){if(this._version)return this._bowser.satisfies(e)}isVersionGreaterThan(e){return this._checkCondition({[this._name]:`>${e}`})}isVersionLessThan(e){return this._checkCondition({[this._name]:`<${e}`})}isVersionEqualTo(e){return this._checkCondition({[this._name]:`~${e}`})}}const _S=new class extends yS{doesVideoMuteByStreamRemove(){return this.isChromiumBased()||this.isWebKitBased()}supportsP2P(){return!this.usesUnifiedPlan()}isChromiumBased(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()}isWebKitBased(){return this._bowser.isEngine("webkit")&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&void 0!==window.RTCRtpTransceiver&&Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection")>-1}isSupported(){return this.isChromiumBased()&&this._getChromiumBasedVersion()>=72||this.isFirefox()||this.isReactNative()||this.isWebKitBased()}isUserInteractionRequiredForUnmute(){return this.isFirefox()&&this.isVersionLessThan("68")}supportsVideoMuteOnConnInterrupted(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsBandwidthStatistics(){return!this.isFirefox()&&!this.isWebKitBased()}supportsCodecPreferences(){return this.usesUnifiedPlan()&&void 0!==window.RTCRtpTransceiver&&Object.keys(window.RTCRtpTransceiver.prototype).indexOf("setCodecPreferences")>-1&&Object.keys(RTCRtpSender.prototype).indexOf("getCapabilities")>-1&&!this.isWebKitBased()}supportsDeviceChangeEvent(){return navigator.mediaDevices&&void 0!==navigator.mediaDevices.ondevicechange&&void 0!==navigator.mediaDevices.addEventListener}supportsLocalCandidateRttStatistics(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}supportsPerformanceObserver(){return void 0!==window.PerformanceObserver&&PerformanceObserver.supportedEntryTypes.indexOf("longtask")>-1}supportsReceiverStats(){return void 0!==window.RTCRtpReceiver&&Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources")>-1}supportsRTTStatistics(){return!this.isFirefox()}usesPlanB(){return!this.usesUnifiedPlan()}usesSdpMungingForSimulcast(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}usesUnifiedPlan(){return!(!this.isFirefox()&&!this.isWebKitBased())}usesNewGumFlow(){return!!(this.isChromiumBased()||this.isFirefox()||this.isWebKitBased())}usesAdapter(){return this.usesNewGumFlow()}usesRidsForSimulcast(){return!1}supportsGetDisplayMedia(){return void 0!==navigator.getDisplayMedia||void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getDisplayMedia}supportsInsertableStreams(){if(void 0===window.RTCRtpSender||!window.RTCRtpSender.prototype.createEncodedStreams&&!window.RTCRtpSender.prototype.createEncodedVideoStreams)return!1;const e=new ReadableStream;try{return window.postMessage(e,"*",[e]),!0}catch(e){return!1}}supportsAudioRed(){return Boolean(window.RTCRtpSender&&window.RTCRtpSender.getCapabilities&&window.RTCRtpSender.getCapabilities("audio").codecs.some((e=>"audio/red"===e.mimeType))&&window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("audio").codecs.some((e=>"audio/red"===e.mimeType)))}supportsSdpSemantics(){return this.isChromiumBased()}_getChromiumBasedVersion(){if(this.isChromiumBased()){if(this.isNWJS())return Number.parseInt(process.versions.chromium,10);const e=navigator.userAgent;if(e.match(/Chrome/))return Number.parseInt(e.match(/Chrome\/([\d.]+)/)[1],10)}return-1}isIOSMobile(){return this.isMobile&&"iOS"===this._bowser.getOSName()}},SS={gross:{width:{ideal:192},height:{ideal:144}},qvga:{width:{ideal:384},height:{ideal:288}},pvga:{width:{ideal:480},height:{ideal:360}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}},hd_cropped:{width:{ideal:900},height:{ideal:720}},fhd:{width:{ideal:1920},height:{ideal:1080}}},TS={},ES=[{active:!1,adaptivePtime:!1,networkPriority:"low",priority:"low"},{active:!1,adaptivePtime:!1,networkPriority:"low",priority:"low"},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:25e5}],bS=[{active:!1,priority:"low"},{active:!1,priority:"low"},{active:!0,priority:"low"}],wS={320:[{rid:"q",maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"}],640:[{rid:"q",scaleResolutionDownBy:2,maxBitrate:25e4,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:7e5,maxFramerate:30,scalabilityMode:"L1T1"}],1280:[{rid:"q",scaleResolutionDownBy:2,maxBitrate:5e5,maxFramerate:24,scalabilityMode:"L1T1"},{rid:"h",maxBitrate:13e5,maxFramerate:30,scalabilityMode:"L1T1"}]},kS=[{scalabilityMode:"L3T3_KEY"}];var RS=(e=>(e.WEBCAM="webcam",e.MIC="mic",e.SCREENSHARE_VIDEO="screenshare_video",e.SCREENSHARE_AUDIO="screenshare_audio",e))(RS||{});function CS(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>CS(e)));const t={};return Object.keys(e).forEach((r=>{const n=s(r)?r:function(e){return e.replace(/([-_]\w)/g,(e=>e[1].toUpperCase()))}(r);t[n]=CS(e[r])})),t}function IS(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>IS(e)));const t={};return Object.keys(e).forEach((r=>{const n=s(r)?r:function(e){return e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))}(r);t[n]=e[r]})),t}function AS(e,t={}){return null==e?{}:(Object.getOwnPropertyNames(e).forEach((r=>{if("function"!=typeof e[r]){if("object"==typeof e[r])return void AS(e[r],t[r]={});t[r]=e[r]}})),t)}var PS=(e=>(e.PARTICIPANT="PARTICIPANT",e.PEER="PEER",e.CLIENT="CLIENT",e))(PS||{});const DS={INTERNAL_CALL_STATS:"internal_call_stats",SIMULCAST:"simulcast",CHAT_SOCKET_SERVER:"chat_socket_server",POLL_SOCKET_SERVER:"poll_socket_server",PLUGIN_SOCKET_SERVER:"plugin_socket_server",NR_OTEL_WEB:"nr_otel_web",CONNECTED_MEETINGS:"connected_meetings",ICE_RESTART_ON_FAILED_STATE:"ice_restart_on_failed_state",ICE_RESTART_ON_DISCONNECTED_STATE:"ice_restart_on_disconnected_state",ENABLE_ICE_STATE_LOGGING:"enable_ice_state_logging",REMOVE_OPERATIONAL_MIC:"web_core_remove_operational_mic",SUPPRESS_PEER_MUTE_UNMUTE_EMITS:"web_core_suppress_peer_mute_unmute_emits",SKIP_OTEL_TRACES:"skip_otel_traces",NEW_LOCAL_MEDIA_HANDLER:"new_local_media_handler",CALLSTATS_INGESTION_LAYER:"callstats_ingestion_layer",USE_USERIDS_IN_CHAT:"use_userids_in_chat",CUSTOM_PING_PONG:"custom_ping_pong",ENABLE_HIVE_SIMULCAST:"enable_hive_simulcast",ENABLE_HIVE_TRANSPORT_RECONNECTION_ON_ICE_FAILED:"enable_hive_transport_reconnection_on_ice_failed",ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY:"enable_hive_fail_recovery",ENABLE_HIVE_INFINITE_RETRIES:"enable_hive_infinite_retries",BYPASS_LOG_EXCLUSION_LIST:"bypass_log_exclusion_list",LOG_LEVEL:"log_level",V1_PLUGINS:"v1_plugins",SCREENSHARE_DTX:"screenshare_dtx",SCREENSHARE_PRIORITY:"screenshare_priority",SCREENSHARE_MIN_BITRATE:"screenshare_minbitrate",SCREENSHARE_MAX_DIMENSIONS:"screenshare_maxdimensions",SCREENSHARE_SIMULCAST:"screenshare_simulcast",DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE:"disable_webcam_layers_on_screenshare",SCREENSHARE_FORCE_GOOG_CONFERENCE:"screenshare_force_goog_conference",LIVESTREAM:"feat_livestream",FETCH_RETRY:"fetch_retry",DEVICE_REMOVE_EXP:"device_remove_exp",DISABLE_WEBCAM_SIMULCAST:"webcore_disable_webcam_simulcast",OVERRIDE_WEBCAM_SIMULCAST:"override_webcam_simulcast",SOCKET_POLLING:"socket_polling",NS_NETWORK_SCORE:"ns_network_score",FEAT_PAGINATED_CHAT:"feat_paginated_chat",VAL_MIN_FRAMERATE:"val_min_framerate",EXTENSION_HACK:"extension_hack",VAL_MAX_FRAMERATE_EXT:"val_max_framerate_ext",VAL_MIN_FRAMERATE_EXT:"val_min_framerate_ext",SCREEENSHARE_ERR_HACK:"screenshare_err_hack",TROUBLESHOOTING:"feat_troubleshooting",VIDEO_CONSTRAINTS:"video_constraints",SCREENSHARE_CONSTRAINTS:"screenshare_constraints",FEAT_CHAT_SDK:"feat_chat_sdk",FEAT_CHAT_SDK_SEARCH:"chat_search",OBS_QUALITY:"obs_quality",ALLOW_SAFARI_MEDIA_MIDDLEWARES:"allow_safari_media_middlewares",DYNAMIC_VIDEO_QUALITY:"dynamic_video_quality",EXP_RESHARE:"exp_reshare",LEAVE_STAGE_ON_END:"leave_stage_on_end",SKIP_SETTING_IN_USE_DEVICE:"skip_setting_in_use_device",PRECALL_BANDWIDTH_TEST:"precall_bandwidth_test"},OS=CS($o(Ea).config.media);var MS;class NS{constructor(e){Xt(this,MS,void 0),Kt(this,"getScreenShareConstraints",(()=>{var e,t,r,n,i,s,o,a,c,d;const{displaySurface:l}=null!=(e=td.defaults.screenShare)?e:{},u=null==(t=Yt(this,MS))?void 0:t.screenshare,h=null!=(n=null==(r=null==u?void 0:u.width)?void 0:r.max)?n:1920,p=null!=(s=null==(i=null==u?void 0:u.height)?void 0:i.max)?s:1080,m=null!=(a=null==(o=null==u?void 0:u.frameRate)?void 0:o.max)?a:5;let f=null!=(d=null==(c=null==u?void 0:u.frameRate)?void 0:c.ideal)?d:5;In.getValue(DS.VAL_MIN_FRAMERATE)&&(f=parseInt(In.getValue(DS.VAL_MIN_FRAMERATE),10));let g={width:{max:h},height:{max:p},frameRate:{ideal:f,max:m}};if(In.hasFeature(DS.SCREENSHARE_CONSTRAINTS)){const e=In.getValue(DS.SCREENSHARE_CONSTRAINTS);g=JSON.parse(e)}return void 0!==l&&["monitor","browser","window"].includes(l)&&(g=zt($t({},g),{displaySurface:l})),{audio:!0,video:g}})),Kt(this,"getAudioConstraints",(e=>{var t,r,n,i,s,o,a,c;const d={},l=null==(t=Yt(this,MS))?void 0:t.audio,u=null!=l&&l.enableStereo?2:1;return _S.isFirefox()||_S.isWebKitBased()?(d.audio={deviceId:e,autoGainControl:null==(r=null==l?void 0:l.autoGainControl)||r,echoCancellation:null==(n=null==l?void 0:l.echoCancellation)||n,noiseSuppression:null==(i=null==l?void 0:l.noiseSupression)||i,channelCount:u},d):(d.audio={},d.audio.optional=[e?{sourceId:e}:{sourceId:"default"},{channelCount:u},{echoCancellation:null==(s=null==l?void 0:l.echoCancellation)||s},{googEchoCancellation:null==(o=null==l?void 0:l.echoCancellation)||o},{googAutoGainControl:null==(a=null==l?void 0:l.autoGainControl)||a},{googNoiseSuppression:null==(c=null==l?void 0:l.noiseSupression)||c},{googHighpassFilter:!0}],d)})),Kt(this,"getVideoConstraints",(e=>{var t,r,n;const i={},s=null==(t=Yt(this,MS))?void 0:t.video;let o=SS.vga;if("string"==typeof s?o=SS[s]:void 0!==s&&(o.height.ideal=s.height.ideal,o.width.ideal=s.width.ideal),o.frameRate={ideal:null!=(n=null==(r=o.frameRate)?void 0:r.ideal)?n:24},_S.isChromiumBased()&&(o.frameRate.max=30),In.hasFeature(DS.VIDEO_CONSTRAINTS)){const e=In.getValue(DS.VIDEO_CONSTRAINTS);o=JSON.parse(e)}return i.video=o,e?i.video.deviceId={exact:e}:i.video.facingMode="user",i})),Zt(this,MS,e)}getUpdatedVideoConstraints(e){return e}}function xS(e){const t={};return"number"==typeof(null==e?void 0:e.code)&&(t.code=e.code),"string"==typeof(null==e?void 0:e.code)&&(t.code=e.code.substring(0,100)),"string"==typeof(null==e?void 0:e.name)&&(t.name=e.name.substring(0,500)),"string"==typeof(null==e?void 0:e.message)&&(t.message=e.message.substring(0,500)),"string"==typeof(null==e?void 0:e.reason)&&(t.reason=e.reason.substring(0,500)),"string"==typeof(null==e?void 0:e.stack)&&(t.stack=e.stack.substring(0,500)),t}function LS(){var e,t,r,n;const i="undefined"!=typeof navigator&&!navigator.isReactNative&&(null==(e=window.location.host)?void 0:e.includes("devel"))&&(null==(t=window.location.host)?void 0:t.includes("dyte.io")),s=!(null==(n=null==(r=td.modules)?void 0:r.devTools)||!n.logs);return i||s}function US(e,t,r={}){return Object.getOwnPropertyNames(e).forEach((n=>{var i;if([null,void 0,NaN].includes(e[n])||t&&((null==(i=t.match(/\./g))?void 0:i.length)||0)>=10)return;const s=t?`${t}.${n}`:n;"object"==typeof e[n]?US(e[n],s,r):["number","string","boolean"].includes(typeof e[n])&&(r[s]=e[n])})),r}function jS(e,t={},r=""){const n={};try{const n=JSON.stringify(t),i=US(JSON.parse(n),r),s=JSON.stringify(i);if(s.length>5e3){const r=`Log named: "${e}" is trying to log an flattened object of size ${s.length} chars that is beyond permitted limit of 5000 chars. Please optimize.`;throw LS()&&console.error(r,{log:t,flattened:s}),new Error(r)}return JSON.parse(s)}catch(e){const t=xS(e);n[`${r}.error.message`]=t.message||"",n[`${r}.error.stack`]=t.stack||"",n[`${r}.error.reason`]=t.reason||"",n[`${r}.error.source`]="safelyFlattenObjForOpenTelemetry"}return n}MS=new WeakMap;const FS=class{static get logsEndpoint(){return`https://${sd({servicePrefix:"api-silos",apiBase:td.apiBase,baseURI:td.baseURI})}/otel/logs`}static init(e,t){navigator.isReactNative||(FS.tracingEnabled=t,FS.meetingMetadata.peerId=e,FS.meetingMetadata.sdkVersion=nd,FS.meetingMetadata.deviceInfo=_S.getDeviceInfo(),FS.meetingMetadata.visitedUrl=!navigator.isReactNative&&"undefined"!=typeof window&&window.location.href,document.addEventListener("visibilitychange",FS.processCachedLogs),FS.logsProcessorTimer=setInterval(FS.processCachedLogs,FS.logsProcessingInterval),t&&(FS.initialized=!0))}static trace(e){return(t,r,n)=>{const i=n.value;return n.value=function(...t){if(!FS.initialized||navigator.isReactNative||!FS.tracingEnabled||In.hasFeature(DS.SKIP_OTEL_TRACES))return i.apply(this,t);FS.addLogInCurrentSpan("info",e);const r=performance.now(),n=i.apply(this,t);return Promise.resolve(n).then((()=>{const t=performance.now();FS.addLogInCurrentSpan("info",`${e}_timing`,{execTime:t-r})})).catch((()=>{const t=performance.now();FS.addLogInCurrentSpan("info",`${e}_timing`,{execTime:t-r})})),n},n}}static injectContext(e){var t;const r=u().replace(/-/g,"").substring(0,16),n=null==(t=FS.meetingMetadata.peerId)?void 0:t.replace(/-/g,"");e.TRACEPARENT=`00-${n}-${r}-01`}static addLogInCurrentSpan(e,t,r={},n=!1){if(null!=r&&r.error&&Object.assign(r,{error:xS(r.error)}),LS()&&(sg(r)?console[e]("DyteInternalLogs:: ",e,t):console[e]("DyteInternalLogs:: ",e,t,r)),function(e){if(In.hasFeature(DS.LOG_LEVEL)){let t=In.getValue(DS.LOG_LEVEL)||"all";if(t=t.toLowerCase().trim(),"off"===t)return!1;if("all"!==t){const r=["debug","log","info","warn","error"];if(r.indexOf(e)<r.indexOf(t))return!1}}return!0}(e))try{const i=jS(t,r,"metadata"),s=new Date,o=zt($t({message:t,level:e},i),{loggedAt:s.toISOString(),loggedAtTzOffset:s.getTimezoneOffset()});n?FS.sendOtelLogsToNewRelic([o]):FS.logsCache.push(o)}catch(e){FS.addLogInCurrentSpan("error","opentelemetry::addLogInCurrentSpan_failed",{error:xS(e)})}}static sendOtelLogsToNewRelic(e){p().post(FS.logsEndpoint,{meetingMetadata:jS("sendOtelLogsToNewRelic",FS.meetingMetadata,"meetingMetadata"),serviceName:id,logs:e}).catch((t=>{FS.addLogInCurrentSpan("error","opentelemetry::sendOtelLogToNewRelic_failed",{error:xS(t)}),FS.logsCache.push(...e)}))}static processCachedLogs(){const e=FS.logsCache.splice(0,25);null!=e&&e.length&&FS.sendOtelLogsToNewRelic(e)}static destruct(){clearInterval(FS.logsProcessorTimer),FS.processCachedLogs(),!navigator.isReactNative&&document.removeEventListener("visibilitychange",FS.processCachedLogs)}};let VS=FS;Kt(VS,"logsCache",[]),Kt(VS,"logsProcessorTimer"),Kt(VS,"tracingEnabled",!0),Kt(VS,"initialized",!1),Kt(VS,"logsProcessingInterval",7e3),Kt(VS,"logExclusionList",["message","websocket/message","roomMessage","websocket/room-message","websocket/room-legacy-mode","chatMessage","websocket/new-chat-message","websocket/no-active-speaker","websocket/selected-peers","websocket/active-speaker","ping","websocket/new-consumer","websocket/producer-score","websocket/consumer-score","websocket/plugin-event","websocket/plugin-data","websocket/plugin-internal-data"]),Kt(VS,"meetingMetadata",{});class BS{static info(e,t,r){VS.addLogInCurrentSpan("info",e,t,r)}static error(e,t,r){VS.addLogInCurrentSpan("error",e,t,r)}static debug(e,t,r){VS.addLogInCurrentSpan("debug",e,t,r)}static log(e,t,r){VS.addLogInCurrentSpan("log",e,t,r)}static warn(e,t,r){VS.addLogInCurrentSpan("warn",e,t,r)}}class HS extends nr.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(e,...t){return super.emit("*",e,...t),super.emit(e,...t)}on(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.on(e,t)}addListener(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.addListener(e,t)}off(e,t){return super.off(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}listeners(e){return super.listeners(e)}listenerCount(e){return super.listenerCount(e)}}class WS extends nr.EventEmitter{constructor(){super(),super.setMaxListeners(25)}emit(e,...t){return super.emit("*",e,...t),super.emit(e,...t)}on(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.on(e,t)}addListener(e,t){try{const t=this.listenerCount(e);t>25&&t%25==0&&BS.warn("DyteEventEmitter::maxListenersExceeded",{eventListener:{eventName:e.toString(),listenerCount:this.listenerCount(e)}})}catch(e){}return super.addListener(e,t)}off(e,t){return super.off(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}listeners(e){return super.listeners(e)}listenerCount(e){return super.listenerCount(e)}}const GS={"00":"DyteClient","01":"Controller","02":"RoomNodeClient","03":"HiveNodeClient","04":"SocketService","05":"Chat","06":"Plugin","07":"Polls","08":"Meta","09":"Preset",10:"Recording",11:"Self",12:"Participant",13:"Spotlight",14:"Remote Request",15:"Webinar",16:"LocalMediaHandler"},qS={"0000":"Internal exception.","0001":"Failed to initialize.","0002":"Failed to join room.","0003":"Failed to leave room.","0100":"Internal exception","0200":"Internal exception.","0300":"Internal exception","0400":"Internal exception","0500":"Internal exception","0501":"Permission denied.","0502":"Invalid message body.","0510":"Invalid channel name.","0600":"Internal exception","0700":"Internal exception","0800":"Internal exception","0900":"Internal exception",1e3:"Internal exception",1100:"Internal exception",1200:"Internal exception",1300:"Internal exception",1400:"Internal exception",1500:"Internal exception",1600:"Internal exception",1601:"Failed to get audio track",1602:"Failed to get video track",1603:"Incorrect device",1604:"Failed to change device",1700:"Internal exception"};Object.keys(qS).forEach((e=>{qS[e]=`{${GS[e.slice(0,2)]}} ${qS[e]}`}));class $S extends Error{constructor(e,t,r=!1){super(e),Kt(this,"code"),this.code=t,this.name="DyteError",this.message=`[ERR${this.code}]: ${qS[this.code]}\n${this.message}`;try{let e=r;t&&t.endsWith("00")&&(e=!0),e&&BS.error("DyteError",{error:{message:this.message,name:this.name,code:t}})}catch(e){}}}function zS(e,t,r,n){if(!("function"==typeof r&&n instanceof t))throw n;r.call(null,n,e)}function JS(e,t,r){if(!e.value){const n=e.get,i=e.set;return n&&(e.get=function(){try{return n.apply(this)}catch(e){zS(this,t,r,e)}}),i&&(e.set=function(e){try{return i.apply(this,[e])}catch(e){zS(this,t,r,e)}}),e}const n=e.value;return e.value=function(...e){try{const i=n.apply(this,e);return i&&i instanceof Promise?i.catch((e=>{zS(this,t,r,e)})):i}catch(e){zS(this,t,r,e)}},e}const KS=e=>function(e,t){return(r,n,i)=>{if(i)return JS(i,e,t);for(const n of Reflect.ownKeys(r.prototype).filter((e=>"constructor"!==e))){const i=Object.getOwnPropertyDescriptor(r.prototype,n);(i.value instanceof Function||i.get instanceof Function||i.set instanceof Function)&&Object.defineProperty(r.prototype,n,JS(i,e,t))}}}(Error,e);var QS,YS,XS=(e=>(e.NEW_PRODUCER="NEW_PRODUCER",e.PRODUCER_TRACK_ENDED="PRODUCER_TRACK_ENDED",e.ROOM_NODE_CONNECTED="ROOM_NODE_CONNECTED",e.ROOM_NODE_DISCONNECTED="ROOM_NODE_DISCONNECTED",e.ROOM_NODE_CONNECTION_ERROR="ROOM_NODE_CONNECTION_ERROR",e.SOCKET_SERVICE_CONNECTED="SOCKET_SERVICE_CONNECTED",e.SOCKET_SERVICE_DISCONNECTED="SOCKET_SERVICE_DISCONNECTED",e.SOCKET_SERVICE_RECONNECTING="SOCKET_SERVICE_RECONNECTING",e.SOCKET_SERVICE_RECONNECTION_ATTEMPT="SOCKET_SERVICE_RECONNECTION_ATTEMPT",e.SOCKET_SERVICE_RECONNECT_FAILURE="SOCKET_SERVICE_RECONNECT_FAILURE",e.SOCKET_SERVICE_RECONNECTED="SOCKET_SERVICE_RECONNECTED",e.SOCKET_SERVICE_FAILED="SOCKET_SERVICE_FAILED",e.ROOM_JOINED="ROOM_JOINED",e.SOCKET_SERVICE_ROOM_JOINED="SOCKET_SERVICE_ROOM_JOINED",e.SELF_ROOM_JOINED="SELF_ROOM_JOINED",e.PRODUCER_SCORE_UPDATE="PRODUCER_SCORE_UPDATE",e.CONSUMER_SCORE_UPDATE="CONSUMER_SCORE_UPDATE",e.PRODUCER_STATUS_UPDATE="PRODUCER_STATUS_UPDATE",e.CONSUMER_STATUS_UPDATE="CONSUMER_STATUS_UPDATE",e.LOW_PRODUCER_SCORE="LOW_PRODUCER_SCORE",e.LOW_CONSUMER_SCORE="LOW_CONSUMER_SCORE",e.MEDIA_PERMISSION_ERROR="MEDIA_PERMISSION_ERROR",e.MEDIA_PERMISSION_UPDATE="MEDIA_PERMISSION_UPDATE",e.WAITLISTED="WAIT_LISTED",e.WAITLIST_ACCEPTED="websocket/waitlist-accepted",e.WAITLIST_REJECTED="websocket/waitlist-rejected",e.WAITLIST_PEER_ADDED="websocket/waitlist-peer-added",e.WAITLIST_PEER_REMOVED="websocket/waitlist-peer-closed",e.MESSAGE="websocket/message",e.ROOM_MESSAGE="websocket/room-message",e.DISABLE_AUDIO="websocket/disable-audio",e.DISABLE_VIDEO="websocket/disable-video",e.PEER_JOINED="websocket/peer-joined",e.PEER_CLOSED="websocket/peer-closed",e.PEER_MUTED="websocket/peer-muted",e.PEER_UNMUTED="websocket/peer-unmuted",e.PEER_PINNED="websocket/pin-peer",e.PEER_UNPINNED="websocker/unpin-peer",e.MUTE_ALL="websocket/mute-all",e.MUTE_ALL_VIDEO="websocket/mute-all-video",e.CONSUMER_CLOSED="websocket/consumer-closed",e.CONSUMER_PAUSED="websocket/consumer-paused",e.CONSUMER_RESUMED="websocket/consumer-resumed",e.PRODUCER_CLOSED="websocket/producer-closed",e.NEW_CONSUMER="websocket/new-consumer",e.CONNECTED_MEETING_STATE="websocket/connectedMeetingState",e.MOVE_TO_CONNECTED_MEETING="websocket/transferMeeting",e.GET_CHAT_MESSAGES="websocket/get-chat-messages",e.NEW_CHAT_MESSAGE="websocket/new-chat-message",e.PIN_CHAT_MESSAGE="websocket/pin-chat-message",e.UNPIN_CHAT_MESSAGE="websocket/unpin-chat-message",e.GET_POLLS="websocket/get-polls",e.UPDATE_POLL="websocket/update-poll",e.SELECTED_PEERS="websocket/selected-peers",e.GET_PAGE="websocket/get-page",e.ACTIVE_SPEAKER="websocket/active-speaker",e.NO_ACTIVE_SPEAKER="websocket/no-active-speaker",e.PRODUCER_SCORE="websocket/producer-score",e.CONSUMER_SCORE="websocket/consumer-score",e.ENABLE_PLUGIN="websocket/enable-plugin",e.DISABLE_PLUGIN="websocket/disable-plugin",e.PLUGIN_EVENT="websocket/plugin-event",e.PLUGIN_DATA="websocket/plugin-data",e.PLUGIN_INTERNAL_DATA="websocket/plugin-internal-data",e.KICKED="websocket/kicked",e.ICE_CONNECTED="ICE_CONNECTED",e.ICE_DISCONNECTED="ICE_DISCONNECTED",e.ICE_FAILED="ICE_FAILED",e.ICE_RECONNECTING="ICE_RECONNECTING",e.AUDIO_TRACK_ANALYSIS="AUDIO_TRACK_ANALYSIS",e.AUDIO_TRACK_CLOSED="AUDIO_TRACK_CLOSED",e.AUDIO_TRACK_CHANGED="AUDIO_TRACK_CHANGED",e.AUDIO_TRACK_CREATED="AUDIO_TRACK_CREATED",e.VIDEO_TRACK_ANALYSIS="VIDEO_TRACK_ANALYSIS",e.VIDEO_TRACK_ANALYSIS_ERROR="VIDEO_TRACK_ANALYSIS_ERROR",e.VIDEO_TRACK_CLOSED="VIDEO_TRACK_CLOSED",e.VIDEO_TRACK_CHANGED="VIDEO_TRACK_CHANGED",e.VIDEO_TRACK_CREATED="VIDEO_TRACK_CREATED",e.SCREENSHARE_AUDIO_TRACK_ANALYSIS="SCREENSHARE_AUDIO_TRACK_ANALYSIS",e.SCREENSHARE_AUDIO_TRACK_CLOSED="SCREENSHARE_AUDIO_TRACK_CLOSED",e.SCREENSHARE_AUDIO_TRACK_CREATED="SCREENSHARE_AUDIO_TRACK_CREATED",e.SCREENSHARE_VIDEO_TRACK_ANALYSIS="SCREENSHARE_VIDEO_TRACK_ANALYSIS",e.SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR="SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR",e.SCREENSHARE_VIDEO_TRACK_CLOSED="SCREENSHARE_VIDEO_TRACK_CLOSED",e.SCREENSHARE_VIDEO_TRACK_CREATED="SCREENSHARE_VIDEO_TRACK_CREATED",e.SCREENSHARE_TRACK_CHANGED="SCREENSHARE_TRACK_CHANGED",e.CANDIDATE_PEER_UPDATE="CANDIDATE_PEER_UPDATE",e.INBOUND_RTP_UPDATE="INBOUND_RTP_UPDATE",e.OUTBOUND_RTP_UPDATE="OUTBOUND_RTP_UPDATE",e.SEND_TRANSPORT_CLOSED="SEND_TRANSPORT_CLOSED",e.RECV_TRANSPORT_CLOSED="RECV_TRANSPORT_CLOSED",e.SEND_TRANSPORT_CREATED="SEND_TRANSPORT_CREATED",e.RECV_TRANSPORT_CREATED="RECV_TRANSPORT_CREATED",e.PRODUCER_TOGGLE="hive/producer-toggle",e.CONSUMER_TOGGLE="hive/consumer-toggle",e.SELECTED_PEERS_DIFF="hive/selected-peers-diff",e.REFRESH_GRID="hive/refresh-grid",e.RESET_PRODUCER_STATE="hive/reset-producer-state",e.HIVE_TRANSPORT_STATE_CHANGED="hive/transport-state-changed",e.HIVE_ROOM_REJOINING="hive/room-rejoining",e.HIVE_ROOM_REJOIN_FAILED="hive/room-rejoining-failed",e.HIVE_ROOM_REJOINED="hive/room-rejoined",e.HIVE_TRANPSORT_RECONNECTING="hive/transport-reconnecting",e.ROOM_STATE="sockethub/room-state",e.PEER_DISPLAY_NAME_CHANGED="hive/display-name-changed",e.ASSERT_SPOTLIGHTER="websocket/assert-spotlighter",e.GET_STAGE_REQUESTS="GET_STAGE_REQUESTS",e.UPDATE_STAGE_REQUESTS="UPDATE_STAGE_REQUESTS",e.PEER_REQUESTED_TO_JOIN_STAGE="websocket/request-to-join-stage-peer-added",e.PEER_WITHDRAWN_REQUEST_TO_JOIN_STAGE="websocket/request-to-join-stage-peer-withdrawn",e.PEER_REJECTED_TO_JOIN_STAGE="websocket/peer-rejected-to-join-stage",e.PEER_ADDED_TO_STAGE="websocket/peer-added-to-stage",e.PEER_REMOVED_FROM_STAGE="websocket/peer-removed-from-stage",e.PEER_STARTED_PRESENTING="websocket/peer-started-presenting",e.PEER_STOPPED_PRESENTING="websocket/peer-stopped-presenting",e.STAGE_REQUESTS_UPDATED="STAGE_REQUESTS_UPDATED",e.KICK_PEER="KICK_PEER",e.REQUEST_TO_JOIN_STAGE_ACCEPTED="websocket/request-to-join-stage-accepted",e.REQUEST_TO_JOIN_STAGE_REJECTED="websocket/request-to-join-stage-rejected",e.STARTED_PRESENTING="websocket/started-presenting",e.STOPPED_PRESENTING="websocket/stopped-presenting",e.REMOVED_FROM_STAGE="websocket/removed-from-stage",e.JOIN_MEDIA_ROOM="JOIN_MEDIA_ROOM",e.LEAVE_MEDIA_ROOM="LEAVE_MEDIA_ROOM",e.UPDATE_PEER_STAGE_STATUS="UPDATE_PEER_STAGE_STATUS",e.GET_WEBINAR_STAGE_STATUS="GET_WEBINAR_STAGE_STATUS",e.REQUEST_TO_JOIN_STAGE="REQUEST_TO_JOIN_STAGE",e.WITHDRAW_REQUEST_TO_JOIN_STAGE="WITHDRAW_REQUEST_TO_JOIN_STAGE",e.LEAVE_STAGE="LEAVE_STAGE",e.JOIN_STAGE="JOIN_STAGE",e.SET_WEBINAR_STAGE_STATUS="SET_WEBINAR_STAGE_STATUS",e.SET_STAGE_STATUS="SET_STAGE_STATUS",e.NEW_STAGE_REQUEST="NEW_STAGE_REQUEST",e.ACCEPT_JOIN_STAGE_REQUEST="ACCEPT_JOIN_STAGE_REQUEST",e.REMOVE_FROM_STAGE="REMOVE_FROM_STAGE",e.REJECT_REQUEST_TO_JOIN_STAGE="REJECT_REQUEST_TO_JOIN_STAGE",e.ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE="ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE",e.PIP_HANGUP="PIP_HANGUP",e.SOCKET_PEERS="SOCKET_PEERS",e.UPDATE_PERMISSIONS="UPDATE_PERMISSIONS",e))(XS||{});const ZS=class extends nr.EventEmitter{constructor(){super(),Xt(this,QS,void 0),Xt(this,YS,void 0),Kt(this,"asyncPromiseTimeout"),Zt(this,QS,new Map),Zt(this,YS,new Map),this.asyncPromiseTimeout=8e3}emitAsync(e,...t){return tr(this,null,(function*(){Yt(this,QS).set(e,[]);const r=Yt(this,YS).get(e).map((()=>new Promise((t=>{Yt(this,QS).get(e).push(t)}))));((e,t,r)=>Wt(Vt(e),"emit",t))(ZS.prototype,this).call(this,e,...t),yield Promise.race([Promise.all(r),new Promise(((t,r)=>setTimeout((()=>r(new Error(`emitAsync failed to resolve for event ${e}.`))),this.asyncPromiseTimeout)))]),Yt(this,QS).delete(e)}))}onAsync(e,t){const r=Yt(this,QS),n=(...n)=>tr(this,null,(function*(){var i;try{yield t(...n)}catch(e){BS.error("[onAsync]",{error:e})}const s=null==(i=r.get(e))?void 0:i.shift();null==s||s()}));return Yt(this,YS).get(e)||Yt(this,YS).set(e,[]),Yt(this,YS).get(e).push(n),super.on(e,n)}reset(){Zt(this,QS,new Map),Zt(this,YS,new Map),super.removeAllListeners()}};let eT=ZS;QS=new WeakMap,YS=new WeakMap;const tT=new eT;var rT=(e=>(e.allowed="ALLOWED",e.notAllowed="NOT_ALLOWED",e.canRequest="CAN_REQUEST",e))(rT||{});const nT=CS({view_type:vn.GroupCall,accept_waiting_requests:!1,request_produce:!1,can_allow_participant_audio:!0,can_allow_participant_screensharing:!1,can_allow_participant_video:!0,request_kick_participant:!1,kick_participant:!0,pin_participant:!0,can_record:!1,waiting_room_type:"SKIP",plugins:{can_close:!0,can_start:!0,can_edit_acl:!1,config:{}},polls:{can_create:!0,can_vote:!0,can_view:!0},produce:{video:{allow:!0,quality:OS.video.quality,frame_rate:OS.video.frameRate},audio:!0,screenshare:{allow:!0,quality:OS.screenshare.quality,frame_rate:OS.screenshare.frameRate}},chat:{public:{can_send:!0,text:!0,files:!0},private:{can_send:!1,can_receive:!1,text:!1,files:!1}},reactions:!1,hidden_participant:!1,show_participant_list:!0,can_change_participant_role:!0,can_change_theme:!1,can_present:!1,accept_present_requests:!1,can_edit_display_name:!1,max_screenshare_count:1,is_recorder:!1,can_spotlight:!1});var iT,sT,oT;const aT=class extends WS{constructor(e,t,r=!1){if(super(),Xt(this,iT,void 0),Xt(this,sT,void 0),Xt(this,oT,void 0),!e)throw BS.error("DytePermissionsPresetV1::load_preset_permissions_failed"),new $S("Could not load preset permissions.");Zt(this,sT,t),Zt(this,iT,e),r&&this.setupEvents()}setupEvents(){tT.onAsync(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){Zt(this,oT,e)}))))}static fromResponse(e,t){return new aT(e,t,!0)}static default(e){return new aT(nT,e)}get mediaRoomType(){return Yt(this,sT)?"HIVE":"ROOM_NODE"}get viewType(){return Yt(this,iT).viewType}get stageEnabled(){return this.viewType===vn.Webinar||this.viewType===vn.Livestream}get stageAccess(){return Yt(this,iT).requestProduce?"CAN_REQUEST":Yt(this,iT).produce.video.allow||Yt(this,iT).produce.audio||Yt(this,iT).produce.screenshare.allow?"ALLOWED":"NOT_ALLOWED"}get acceptWaitingRequests(){return Yt(this,iT).acceptWaitingRequests}get requestProduce(){return Yt(this,iT).requestProduce}get requestProduceAudio(){return this.requestProduce}get requestProduceScreenshare(){return this.requestProduce}get canAllowParticipantAudio(){return Yt(this,iT).canAllowParticipantAudio}get canAllowParticipantScreensharing(){return Yt(this,iT).canAllowParticipantScreensharing}get canAllowParticipantVideo(){return Yt(this,iT).canAllowParticipantVideo}get canDisableParticipantAudio(){return this.canAllowParticipantAudio}get canDisableParticipantVideo(){return this.canAllowParticipantVideo}get kickParticipant(){return Yt(this,iT).kickParticipant}get pinParticipant(){return Yt(this,iT).pinParticipant}get canRecord(){return Yt(this,iT).canRecord}get waitingRoomType(){return Yt(this,iT).waitingRoomType}get waitingRoomBehaviour(){return"SKIP"===Yt(this,iT).waitingRoomType?"SKIP":"SKIP_ON_PRIVILEGED_USER_ENTRY"===Yt(this,iT).waitingRoomType?"ON_PRIVILEGED_USER_ENTRY":"ON_ACCEPT"===Yt(this,iT).waitingRoomType?"SKIP_ON_ACCEPT":"SKIP"}get plugins(){return Yt(this,iT).plugins}get polls(){return zt($t({},Yt(this,iT).polls),{canViewResults:Yt(this,iT).polls.canView})}get produceVideo(){return zt($t({},Yt(this,iT).produce.video),{allow:this.canProduceVideo})}get canProduceVideo(){const e=this.requestProduce?"CAN_REQUEST":Yt(this,iT).produce.video.allow?"ALLOWED":"NOT_ALLOWED";return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Yt(this,oT)&&"ON_STAGE"!==Yt(this,oT)||"CAN_REQUEST"!==e?!this.stageEnabled||"OFF_STAGE"!==Yt(this,oT)&&"REQUESTED_TO_JOIN_STAGE"!==Yt(this,oT)||"ALLOWED"!==e?e:"NOT_ALLOWED":"ALLOWED"}get produceScreenshare(){return zt($t({},Yt(this,iT).produce.screenshare),{allow:this.canProduceScreenshare})}get canProduceScreenshare(){const e=this.requestProduce?"CAN_REQUEST":Yt(this,iT).produce.screenshare?"ALLOWED":"NOT_ALLOWED";return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Yt(this,oT)&&"ON_STAGE"!==Yt(this,oT)||"CAN_REQUEST"!==e?!this.stageEnabled||"OFF_STAGE"!==Yt(this,oT)&&"REQUESTED_TO_JOIN_STAGE"!==Yt(this,oT)||"ALLOWED"!==e?e:"NOT_ALLOWED":"ALLOWED"}get produceAudio(){return this.canProduceAudio}get canProduceAudio(){const e=this.requestProduce?"CAN_REQUEST":Yt(this,iT).produce.audio?"ALLOWED":"NOT_ALLOWED";return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Yt(this,oT)&&"ON_STAGE"!==Yt(this,oT)||"CAN_REQUEST"!==e?!this.stageEnabled||"OFF_STAGE"!==Yt(this,oT)&&"REQUESTED_TO_JOIN_STAGE"!==Yt(this,oT)||"ALLOWED"!==e?e:"NOT_ALLOWED":"ALLOWED"}get chatPublic(){return Yt(this,iT).chat.public}get transcriptionEnabled(){return!1}get chatPrivate(){return Yt(this,iT).chat.private}get chatChannel(){return{canCreate:"NONE",canDelete:"NONE",canUpdate:"NONE",canReadAll:!1}}get chatMessage(){return{canDelete:"NONE",canEdit:"NONE",deleteCutoffTimeSeconds:0,editCutoffTimeSeconds:0}}get connectedMeetings(){return{canAlterConnectedMeetings:!1,canSwitchConnectedMeetings:!1,canSwitchToParentMeeting:!1}}get reactions(){return Yt(this,iT).reactions}get hiddenParticipant(){return Yt(this,iT).hiddenParticipant}get showParticipantList(){return Yt(this,iT).showParticipantList}get canChangeParticipantRole(){return Yt(this,iT).canChangeParticipantRole}get canChangeTheme(){return Yt(this,iT).canChangeTheme}get canPresent(){return Yt(this,iT).canPresent}get acceptPresentRequests(){return Yt(this,iT).acceptPresentRequests}get acceptStageRequests(){return Yt(this,iT).acceptPresentRequests}get canEditDisplayName(){return Yt(this,iT).canEditDisplayName}get maxScreenShareCount(){return Yt(this,iT).maxScreenshareCount}get isRecorder(){return Yt(this,iT).isRecorder}get canLivestream(){return!1}get canSpotlight(){return Yt(this,iT).canSpotlight}get isV2(){return!1}};let cT=aT;var dT,lT;iT=new WeakMap,sT=new WeakMap,oT=new WeakMap,function(e){e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER"}(dT||(dT={})),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"}(lT||(lT={})),new class extends me{constructor(){super("media.Codec",[])}},new class extends me{constructor(){super("media.Fingerprint",[{no:1,name:"algorithm",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:9}])}};const uT=new class extends me{constructor(){super("media.SessionDescription",[{no:1,name:"target",kind:"enum",T:()=>["media.Target",dT]},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"sdp",kind:"scalar",T:9}])}},hT=new class extends me{constructor(){super("media.CreateTransportRequest",[{no:1,name:"consuming",kind:"scalar",T:8},{no:2,name:"force_tcp",kind:"scalar",opt:!0,T:8},{no:3,name:"description",kind:"message",T:()=>uT}])}},pT=new class extends me{constructor(){super("media.CreateTransportResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uT},{no:3,name:"transcription_enabled",kind:"scalar",opt:!0,T:8}])}},mT=new class extends me{constructor(){super("media.RenegotiateRequest",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uT}])}};new class extends me{constructor(){super("media.RenegotiateResponse",[{no:1,name:"transport_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uT}])}};const fT=new class extends me{constructor(){super("media.NestedScore",[{no:1,name:"encoding_idx",kind:"scalar",T:5},{no:2,name:"rid",kind:"scalar",T:9},{no:3,name:"score",kind:"scalar",T:5},{no:4,name:"ssrc",kind:"scalar",T:3,L:0}])}},gT=new class extends me{constructor(){super("media.ProducerTrack",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9},{no:3,name:"stream_id",kind:"scalar",T:9}])}};new class extends me{constructor(){super("media.ProducerEntry",[{no:1,name:"producing_transport_id",kind:"scalar",T:9},{no:2,name:"producer_id",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.ConsumerEntry",[{no:1,name:"consuming_transport_id",kind:"scalar",T:9},{no:2,name:"consumer_id",kind:"scalar",T:9}])}};const vT=new class extends me{constructor(){super("media.ProducerState",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"kind",kind:"enum",T:()=>["media.ProducerKind",lT]},{no:3,name:"pause",kind:"scalar",T:8},{no:4,name:"screen_share",kind:"scalar",T:8},{no:5,name:"app_data",kind:"scalar",opt:!0,T:9}])}},yT=new class extends me{constructor(){super("media.ConsumerState",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vT},{no:3,name:"producer_track",kind:"message",T:()=>gT}])}},_T=new class extends me{constructor(){super("media.ProducerIdToConsumerMap",[{no:1,name:"map",kind:"map",K:9,V:{kind:"message",T:()=>yT}}])}},ST=new class extends me{constructor(){super("media.edge.GeoLocation",[{no:1,name:"latitude",kind:"scalar",T:2},{no:2,name:"longitude",kind:"scalar",T:2},{no:3,name:"region",kind:"scalar",opt:!0,T:9}])}},TT=new class extends me{constructor(){super("media.edge.PeerJoinRequest",[{no:1,name:"display_name",kind:"scalar",opt:!0,T:9},{no:2,name:"prejoined",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:5,name:"preset",kind:"scalar",opt:!0,T:12},{no:6,name:"user_id",kind:"scalar",opt:!0,T:9},{no:7,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:8,name:"location",kind:"message",T:()=>ST}])}},ET=new class extends me{constructor(){super("media.edge.PeerJoinCompleteRequest",[])}},bT=new class extends me{constructor(){super("media.edge.PeerLeaveRequest",[{no:1,name:"close_room",kind:"scalar",T:8}])}};new class extends me{constructor(){super("media.edge.ConsumeMultipleProducerRequest",[{no:1,name:"producer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8}])}};const wT=new class extends me{constructor(){super("media.edge.ConsumePeerRequest",[{no:1,name:"producing_peer_id",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",opt:!0,T:8},{no:3,name:"producer_id",kind:"scalar",opt:!0,T:9}])}},kT=new class extends me{constructor(){super("media.edge.ProducerCreateRequest",[{no:1,name:"kind",kind:"scalar",T:9},{no:2,name:"paused",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8},{no:4,name:"description",kind:"message",T:()=>uT},{no:5,name:"msid",kind:"scalar",T:9},{no:6,name:"app_data",kind:"scalar",opt:!0,T:9}])}};new class extends me{constructor(){super("media.edge.SelectedPeersRequest",[])}};const RT=new class extends me{constructor(){super("media.edge.GlobalPeerPinningRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},CT=new class extends me{constructor(){super("media.edge.ProducerToggleRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}},IT=new class extends me{constructor(){super("media.edge.ConsumerToggleRequest",[{no:1,name:"consumer_id",kind:"scalar",T:9},{no:2,name:"pause",kind:"scalar",T:8}])}},AT=new class extends me{constructor(){super("media.edge.ProducerCloseRequest",[{no:1,name:"producer_id",kind:"scalar",T:9},{no:2,name:"description",kind:"message",T:()=>uT}])}},PT=new class extends me{constructor(){super("media.edge.ConsumerCloseRequest",[{no:1,name:"consumer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"description",kind:"message",T:()=>uT}])}},DT=new class extends me{constructor(){super("media.edge.KickPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},OT=new class extends me{constructor(){super("media.edge.KickAllPeersRequest",[])}},MT=new class extends me{constructor(){super("media.edge.PeerDisplayNameEditRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}},NT=new class extends me{constructor(){super("media.edge.HostMediaControlForPeerRequest",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"audio",kind:"scalar",T:8},{no:3,name:"video",kind:"scalar",T:8},{no:4,name:"scree_share",kind:"scalar",T:8}])}},xT=new class extends me{constructor(){super("media.edge.HostMediaControlForAllPeerRequest",[{no:1,name:"audio",kind:"scalar",T:8},{no:2,name:"video",kind:"scalar",T:8},{no:3,name:"screen_share",kind:"scalar",T:8}])}},LT=new class extends me{constructor(){super("media.edge.GetRoomStateResponse",[{no:1,name:"display_title",kind:"scalar",T:9},{no:2,name:"locked_mode",kind:"scalar",T:8},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"room_name",kind:"scalar",T:9},{no:5,name:"current_peer_id",kind:"scalar",T:9},{no:6,name:"is_recording",kind:"scalar",opt:!0,T:8},{no:7,name:"recorder_participant_id",kind:"scalar",opt:!0,T:9},{no:8,name:"pinned_peer_ids",kind:"scalar",repeat:2,T:9}])}},UT=new class extends me{constructor(){super("media.edge.ErrorResponse",[{no:1,name:"error_message",kind:"scalar",T:9},{no:2,name:"event_id",kind:"scalar",T:5}])}};new class extends me{constructor(){super("media.edge.EmptyResponse",[])}};const jT=new class extends me{constructor(){super("media.edge.RoomParticipants",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"producer_states",kind:"message",repeat:1,T:()=>vT},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"user_id",kind:"scalar",opt:!0,T:9}])}},FT=new class extends me{constructor(){super("media.edge.SelectedPeersResponse",[{no:1,name:"audio_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"compulsory_peers",kind:"scalar",repeat:2,T:9}])}},VT=new class extends me{constructor(){super("media.edge.SelectedPeersDiffEntry",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"priority",kind:"scalar",T:5}])}},BT=new class extends me{constructor(){super("media.edge.SelectedPeersDiffResponse",[{no:1,name:"entries",kind:"message",repeat:1,T:()=>VT}])}};new class extends me{constructor(){super("media.edge.PeerJoinResponse",[])}};const HT=new class extends me{constructor(){super("media.edge.PeerJoinCompleteResponse",[{no:1,name:"room_state",kind:"message",T:()=>LT},{no:2,name:"participants",kind:"message",repeat:1,T:()=>jT},{no:3,name:"selected_peers",kind:"message",T:()=>FT},{no:4,name:"max_preferred_streams",kind:"scalar",T:5}])}},WT=new class extends me{constructor(){super("media.edge.PeerLeaveResponse",[{no:1,name:"closed",kind:"scalar",T:8}])}};new class extends me{constructor(){super("media.edge.ConsumeMultipleProducerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>_T}])}};const GT=new class extends me{constructor(){super("media.edge.ConsumePeerResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"consumer_ids_map",kind:"message",T:()=>_T}])}},qT=new class extends me{constructor(){super("media.edge.ProducerCreateResponse",[{no:1,name:"status",kind:"scalar",T:8},{no:2,name:"producer_id",kind:"scalar",T:9},{no:4,name:"description",kind:"message",T:()=>uT}])}};new class extends me{constructor(){super("media.edge.ProducerScoreResponse",[{no:1,name:"responseid",kind:"scalar",T:9},{no:2,name:"score",kind:"message",T:()=>fT}])}},new class extends me{constructor(){super("media.edge.ActiveSpeakerResponse",[{no:1,name:"responsepeer_id",kind:"scalar",T:9},{no:2,name:"volume",kind:"scalar",T:5}])}},new class extends me{constructor(){super("media.edge.NoActiveSpeakerResponse",[])}},new class extends me{constructor(){super("media.edge.ProducerToggleResponse",[])}},new class extends me{constructor(){super("media.edge.ConsumerToggleResponse",[])}};const $T=new class extends me{constructor(){super("media.edge.ProducerClosingResponse",[{no:1,name:"description",kind:"message",T:()=>uT}])}};new class extends me{constructor(){super("media.edge.ConsumerClosingResponse",[])}},new class extends me{constructor(){super("media.edge.GlobalPeerPinningResponse",[])}};const zT=new class extends me{constructor(){super("media.edge.KickPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},JT=new class extends me{constructor(){super("media.edge.KickAllPeersResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},KT=new class extends me{constructor(){super("media.edge.HostMediaControlForPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},QT=new class extends me{constructor(){super("media.edge.HostMediaControlForAllPeerResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},YT=new class extends me{constructor(){super("media.edge.PeerDisplayNameEditResponse",[{no:1,name:"status",kind:"scalar",T:9}])}},XT=new class extends me{constructor(){super("media.edge.PeerJoinBroadcastResponse",[{no:1,name:"participant",kind:"message",T:()=>jT}])}};new class extends me{constructor(){super("media.edge.PeerProducingTransportCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"transport_details",kind:"message",T:()=>pT}])}};const ZT=new class extends me{constructor(){super("media.edge.PeerProducerCreateBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vT}])}},eE=new class extends me{constructor(){super("media.edge.PeerProducerToggleBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vT}])}},tE=new class extends me{constructor(){super("media.edge.PeerProducerCloseBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"producer_state",kind:"message",T:()=>vT}])}},rE=new class extends me{constructor(){super("media.edge.PeerLeaveBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},nE=new class extends me{constructor(){super("media.edge.GlobalPeerPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}};new class extends me{constructor(){super("media.edge.GlobalPeerUnPinningBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.edge.RecordingStartedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.edge.RecordingStoppedBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9}])}};const iE=new class extends me{constructor(){super("media.edge.PeerDisplayNameEditBroadcastResponse",[{no:1,name:"participant_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9}])}};new class extends me{constructor(){super("media.edge.PeerPingRequestBroadcastResponse",[{no:1,name:"password",kind:"scalar",T:9}])}},new class extends me{constructor(){super("media.edge.MediaRoomTerminationBroadcastResponse",[{no:1,name:"reason",kind:"scalar",T:9}])}};const sE=new class extends me{constructor(){super("socket.ai.MeetingTranscript",[{no:1,name:"meeting_id",kind:"scalar",T:9},{no:2,name:"transcript",kind:"scalar",T:9}])}};new class extends me{constructor(){super("socket.api.BaseSocketHubMessage",[{no:1,name:"event",kind:"scalar",T:5},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9},{no:4,name:"room_id",kind:"scalar",T:9},{no:5,name:"user_id",kind:"scalar",T:9},{no:6,name:"payload",kind:"scalar",T:12},{no:7,name:"error",kind:"scalar",opt:!0,T:8},{no:8,name:"sid",kind:"scalar",opt:!0,T:9}])}};const oE=new class extends me{constructor(){super("socket.api.ErrorMessage",[{no:1,name:"code",kind:"scalar",opt:!0,T:5},{no:2,name:"message",kind:"scalar",T:9}])}},aE=new class extends me{constructor(){super("socket.preset.PollsPermissionUpdate",[{no:1,name:"can_create",kind:"scalar",opt:!0,T:8},{no:2,name:"can_vote",kind:"scalar",opt:!0,T:8},{no:3,name:"can_view",kind:"scalar",opt:!0,T:8}])}},cE=new class extends me{constructor(){super("socket.preset.PluginsPermissionsUpdate",[{no:1,name:"can_close",kind:"scalar",opt:!0,T:8},{no:2,name:"can_start",kind:"scalar",opt:!0,T:8}])}},dE=new class extends me{constructor(){super("socket.preset.PublicChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"text",kind:"scalar",opt:!0,T:8},{no:3,name:"files",kind:"scalar",opt:!0,T:8}])}},lE=new class extends me{constructor(){super("socket.preset.PrivateChatPermission",[{no:1,name:"can_send",kind:"scalar",opt:!0,T:8},{no:2,name:"can_receive",kind:"scalar",opt:!0,T:8},{no:3,name:"text",kind:"scalar",opt:!0,T:8},{no:4,name:"files",kind:"scalar",opt:!0,T:8}])}},uE=new class extends me{constructor(){super("socket.preset.ChatPermissionUpdate",[{no:1,name:"public",kind:"message",T:()=>dE},{no:2,name:"private",kind:"message",T:()=>lE}])}},hE=new class extends me{constructor(){super("socket.preset.PresetUpdates",[{no:1,name:"polls",kind:"message",T:()=>aE},{no:2,name:"plugins",kind:"message",T:()=>cE},{no:3,name:"chat",kind:"message",T:()=>uE}])}},pE=new class extends me{constructor(){super("socket.preset.ReadPeersPresetRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},mE=new class extends me{constructor(){super("socket.preset.PeerPreset",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"preset",kind:"scalar",T:12}])}},fE=new class extends me{constructor(){super("socket.preset.ReadPeersPresetResponse",[{no:1,name:"peer_presets",kind:"message",repeat:1,T:()=>mE}])}},gE=new class extends me{constructor(){super("socket.preset.UpdatePeerPreset",[{no:1,name:"user_ids",kind:"scalar",T:9},{no:2,name:"patch",kind:"message",T:()=>hE}])}},vE=new class extends me{constructor(){super("socket.preset.UpdatePeersPresetRequest",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>gE}])}},yE=new class extends me{constructor(){super("socket.preset.UpdatePeersPresetResponse",[{no:1,name:"update_peers_presets",kind:"message",repeat:1,T:()=>gE}])}},_E=new class extends me{constructor(){super("socket.chat.ChatMessage",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"user_id",kind:"scalar",T:9},{no:4,name:"display_name",kind:"scalar",T:9},{no:5,name:"pinned",kind:"scalar",T:8},{no:6,name:"is_edited",kind:"scalar",T:8},{no:7,name:"payload_type",kind:"scalar",T:5},{no:8,name:"payload",kind:"scalar",T:9},{no:10,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:11,name:"created_at",kind:"scalar",T:4,L:2},{no:12,name:"created_at_ms",kind:"scalar",opt:!0,T:4,L:2},{no:13,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:14,name:"channel_index",kind:"scalar",opt:!0,T:9}])}},SE=new class extends me{constructor(){super("socket.chat.GetPaginatedChatMessageRoomRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},TE=new class extends me{constructor(){super("socket.chat.GetPaginatedChatMessageRoomResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>_E},{no:2,name:"next",kind:"scalar",T:8}])}},EE=new class extends me{constructor(){super("socket.chat.GetChatMessagesResponse",[{no:1,name:"messages",kind:"message",repeat:1,T:()=>_E}])}},bE=new class extends me{constructor(){super("socket.chat.SendChatMessageToRoomRequest",[{no:1,name:"payload_type",kind:"scalar",T:5},{no:2,name:"payload",kind:"scalar",T:9}])}},wE=new class extends me{constructor(){super("socket.chat.SendChatMessageToRoomResponse",[{no:1,name:"message",kind:"message",T:()=>_E}])}},kE=new class extends me{constructor(){super("socket.chat.SendChatMessageToPeersRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}},RE=new class extends me{constructor(){super("socket.chat.SendChatMessageToPeersResponse",[{no:1,name:"message",kind:"message",T:()=>_E}])}},CE=new class extends me{constructor(){super("socket.chat.SendChatMessageToChannelRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",T:5},{no:3,name:"payload",kind:"scalar",T:9}])}};new class extends me{constructor(){super("socket.chat.SendChatMessageToChannelResponse",[{no:1,name:"message",kind:"message",T:()=>_E}])}};const IE=new class extends me{constructor(){super("socket.chat.EditChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"payload_type",kind:"scalar",opt:!0,T:5},{no:3,name:"payload",kind:"scalar",opt:!0,T:9},{no:4,name:"pinned",kind:"scalar",opt:!0,T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},AE=new class extends me{constructor(){super("socket.chat.PinChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},PE=new class extends me{constructor(){super("socket.chat.PinChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"pinned",kind:"scalar",T:8},{no:3,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},DE=new class extends me{constructor(){super("socket.chat.EditChatMessageResponse",[{no:1,name:"message",kind:"message",T:()=>_E}])}},OE=new class extends me{constructor(){super("socket.chat.DeleteChatMessageRequest",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},ME=new class extends me{constructor(){super("socket.chat.DeleteChatMessageResponse",[{no:1,name:"chat_id",kind:"scalar",T:9},{no:2,name:"channel_id",kind:"scalar",opt:!0,T:9}])}},NE=new class extends me{constructor(){super("socket.chat.SearchChatMessagesRequest",[{no:1,name:"time_stamp",kind:"scalar",T:4,L:2},{no:2,name:"size",kind:"scalar",T:5},{no:3,name:"from",kind:"scalar",T:5},{no:4,name:"reversed",kind:"scalar",T:8},{no:5,name:"channel_id",kind:"scalar",opt:!0,T:9},{no:6,name:"search_term",kind:"scalar",T:9}])}},xE=new class extends me{constructor(){super("socket.chat.MarkChannelIndexAsReadRequest",[{no:1,name:"channel_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"channel_index",kind:"scalar",T:9}])}},LE=new class extends me{constructor(){super("socket.chat.MarkChannelIndexAsReadResponse",[{no:1,name:"channel_index",kind:"scalar",T:9}])}},UE=new class extends me{constructor(){super("socket.chat.CreateChatChannelRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8}])}},jE=new class extends me{constructor(){super("socket.chat.UpdateChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"target_user_ids",kind:"scalar",repeat:2,T:9},{no:4,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:5,name:"visibility",kind:"scalar",opt:!0,T:9},{no:6,name:"is_direct_message",kind:"scalar",opt:!0,T:8}])}};new class extends me{constructor(){super("socket.chat.CreateChatChannelResponse",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}};const FE=new class extends me{constructor(){super("socket.chat.GetChatChannelRequest",[{no:1,name:"chat_channel_id",kind:"scalar",T:9}])}},VE=new class extends me{constructor(){super("socket.chat.LatestMessageAndUnreadCount",[{no:1,name:"message",kind:"message",T:()=>_E},{no:2,name:"unread_count",kind:"scalar",T:4,L:2}])}},BE=new class extends me{constructor(){super("socket.chat.ChatChannel",[{no:1,name:"chat_channel_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",T:9},{no:3,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:4,name:"visibility",kind:"scalar",T:9},{no:5,name:"is_direct_message",kind:"scalar",T:8},{no:6,name:"latest_message_and_unread_count",kind:"message",T:()=>VE},{no:7,name:"target_user_ids",kind:"scalar",repeat:2,T:9}])}},HE=new class extends me{constructor(){super("socket.chat.GetChatChannelResponse",[{no:1,name:"chat_channels",kind:"message",repeat:1,T:()=>BE}])}},WE=new class extends me{constructor(){super("socket.chat.ChannelMember",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}},GE=new class extends me{constructor(){super("socket.chat.GetChatChannelMembersResponse",[{no:1,name:"channel_members",kind:"message",repeat:1,T:()=>WE}])}};var qE,$E,zE,JE;!function(e){e[e.BROWSER=0]="BROWSER",e[e.TRACK=1]="TRACK",e[e.COMPOSITE=2]="COMPOSITE"}(qE||(qE={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ON_STAGE=1]="ON_STAGE",e[e.APPROVED_STAGE=2]="APPROVED_STAGE",e[e.REQUESTED_STAGE=3]="REQUESTED_STAGE",e[e.OFF_STAGE=4]="OFF_STAGE"}($E||($E={})),function(e){e[e.NONE=0]="NONE",e[e.RECORDER=1]="RECORDER",e[e.LIVESTREAMER=2]="LIVESTREAMER"}(zE||(zE={})),function(e){e[e.HIVE=0]="HIVE",e[e.CHAT=1]="CHAT",e[e.PING=2]="PING"}(JE||(JE={}));const KE=new class extends me{constructor(){super("socket.room.PeerFlags",[{no:1,name:"preset_name",kind:"scalar",T:9},{no:2,name:"recorder_type",kind:"scalar",T:9},{no:3,name:"hidden_participant",kind:"scalar",T:8}])}},QE=new class extends me{constructor(){super("socket.room.Peer",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9},{no:4,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",$E,"STAGE_TYPE_"]},{no:5,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:6,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:7,name:"display_picture_url",kind:"scalar",opt:!0,T:9},{no:8,name:"waitlisted",kind:"scalar",T:8},{no:9,name:"flags",kind:"message",T:()=>KE}])}},YE=new class extends me{constructor(){super("socket.room.PeerInfoResponse",[{no:1,name:"peer",kind:"message",T:()=>QE}])}},XE=new class extends me{constructor(){super("socket.room.PeerStatusUpdate",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"stage_type",kind:"enum",opt:!0,T:()=>["socket.room.StageType",$E,"STAGE_TYPE_"]}])}},ZE=new class extends me{constructor(){super("socket.room.RoomPeersInfoRequest",[{no:1,name:"seach_query",kind:"scalar",T:9},{no:2,name:"limit",kind:"scalar",T:5},{no:3,name:"offset",kind:"scalar",T:5}])}},eb=new class extends me{constructor(){super("socket.room.RoomPeersInfoResponse",[{no:1,name:"peers",kind:"message",repeat:1,T:()=>QE}])}},tb=new class extends me{constructor(){super("socket.room.RoomPeerCountResponse",[{no:1,name:"count",kind:"scalar",T:4,L:2}])}},rb=new class extends me{constructor(){super("socket.room.Room",[{no:1,name:"room_id",kind:"scalar",T:9},{no:2,name:"title",kind:"scalar",T:9},{no:4,name:"created_at",kind:"scalar",T:4,L:2},{no:5,name:"active_recordings",kind:"message",repeat:1,T:()=>nb}])}},nb=new class extends me{constructor(){super("socket.room.ActiveRecording",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",qE]},{no:3,name:"recording_status",kind:"scalar",T:9}])}},ib=new class extends me{constructor(){super("socket.room.RoomInfoResponse",[{no:1,name:"room",kind:"message",T:()=>rb}])}},sb=new class extends me{constructor(){super("socket.room.GetPeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9}])}};new class extends me{constructor(){super("socket.room.UpdatePeerInfoRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9}])}};const ob=new class extends me{constructor(){super("socket.room.JoinRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>QE},{no:3,name:"room_uuid",kind:"scalar",T:9},{no:4,name:"organization_id",kind:"scalar",opt:!0,T:9},{no:5,name:"use_hive",kind:"scalar",opt:!0,T:8},{no:6,name:"preset",kind:"scalar",opt:!0,T:12},{no:7,name:"capabilities",kind:"enum",repeat:1,T:()=>["socket.room.Capabilities",JE,"CAPABILITIES_"]},{no:8,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}},ab=new class extends me{constructor(){super("socket.room.LeaveRoomRequest",[{no:1,name:"peer",kind:"message",T:()=>QE},{no:2,name:"timestamp",kind:"scalar",opt:!0,T:4,L:2}])}};new class extends me{constructor(){super("socket.room.UpdateRoomInfoRequest",[{no:1,name:"room",kind:"message",T:()=>rb}])}},new class extends me{constructor(){super("socket.room.GetConnectedRoomsDumpRequest",[])}};const cb=new class extends me{constructor(){super("socket.room.ServiceError",[{no:1,name:"message",kind:"scalar",opt:!0,T:9},{no:2,name:"code",kind:"scalar",opt:!0,T:9}])}},db=new class extends me{constructor(){super("socket.room.ConnectedMeetingPeer",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"display_name",kind:"scalar",opt:!0,T:9},{no:3,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:4,name:"preset_id",kind:"scalar",opt:!0,T:9},{no:5,name:"display_picture_url",kind:"scalar",opt:!0,T:9}])}},lb=new class extends me{constructor(){super("socket.room.ConnectedMeetingDump",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>db}])}},ub=new class extends me{constructor(){super("socket.room.GetConnectedRoomsDumpResponse",[{no:1,name:"parent_meeting",kind:"message",T:()=>lb},{no:2,name:"meetings",kind:"message",repeat:1,T:()=>lb}])}},hb=new class extends me{constructor(){super("socket.room.CreateRoomRequestPayload",[{no:1,name:"title",kind:"scalar",opt:!0,T:9}])}},pb=new class extends me{constructor(){super("socket.room.CreateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>hb}])}},mb=new class extends me{constructor(){super("socket.room.CreateRoomResponsePayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>cb}])}},fb=new class extends me{constructor(){super("socket.room.CreateConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>mb}])}},gb=new class extends me{constructor(){super("socket.room.UpdateRoomRequestPayload",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"title",kind:"scalar",opt:!0,T:9}])}};new class extends me{constructor(){super("socket.room.UpdateConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>gb}])}};const vb=new class extends me{constructor(){super("socket.room.DisableRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9}])}},yb=new class extends me{constructor(){super("socket.room.DisableConnectedRoomsRequest",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>vb}])}},_b=new class extends me{constructor(){super("socket.room.DisableConnectedRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>Sb}])}},Sb=new class extends me{constructor(){super("socket.room.DisableConnectedRoomPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9},{no:2,name:"status",kind:"scalar",opt:!0,T:9},{no:3,name:"title",kind:"scalar",opt:!0,T:9},{no:4,name:"error",kind:"message",T:()=>cb}])}},Tb=new class extends me{constructor(){super("socket.room.MovePeerPayload",[{no:1,name:"id",kind:"scalar",opt:!0,T:9}])}},Eb=new class extends me{constructor(){super("socket.room.MovePeersBetweenRoomsRequest",[{no:1,name:"source_meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"destination_meeting_id",kind:"scalar",opt:!0,T:9},{no:3,name:"participants",kind:"message",repeat:1,T:()=>Tb}])}},bb=new class extends me{constructor(){super("socket.room.MovedPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"custom_participant_id",kind:"scalar",opt:!0,T:9},{no:3,name:"error",kind:"message",T:()=>cb}])}};new class extends me{constructor(){super("socket.room.MovePeersBetweenRoomsResponse",[{no:1,name:"payloads",kind:"message",repeat:1,T:()=>bb}])}};const wb=new class extends me{constructor(){super("socket.room.TransferPeer",[{no:1,name:"meeting_id",kind:"scalar",opt:!0,T:9},{no:2,name:"auth_token",kind:"scalar",opt:!0,T:9}])}},kb=new class extends me{constructor(){super("socket.room.GetAllAddedParticipantsResponse",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>Rb}])}},Rb=new class extends me{constructor(){super("socket.room.AddedParticipant",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",opt:!0,T:9},{no:3,name:"picture",kind:"scalar",opt:!0,T:9},{no:4,name:"custom_participant_id",kind:"scalar",T:9}])}},Cb=new class extends me{constructor(){super("socket.room.RemoveParticipantsRequest",[{no:1,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Ib=new class extends me{constructor(){super("socket.room.BroadcastMessage",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"timestamp",kind:"scalar",T:4,L:2},{no:4,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Ab=new class extends me{constructor(){super("socket.room.AcceptWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},Pb=new class extends me{constructor(){super("socket.room.DenyWaitingRoomRequests",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},Db=new class extends me{constructor(){super("socket.room.WaitingRoomRequest",[{no:1,name:"peer_id",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"display_name",kind:"scalar",T:9}])}},Ob=new class extends me{constructor(){super("socket.room.GetWaitingRoomRequests",[{no:1,name:"requests",kind:"message",repeat:1,T:()=>Db}])}},Mb=new class extends me{constructor(){super("socket.room.GetRoomStageStateResponse",[{no:1,name:"on_stage_peers",kind:"scalar",repeat:2,T:9},{no:2,name:"approved_stage_peers",kind:"scalar",repeat:2,T:9},{no:3,name:"requested_stage_peers",kind:"scalar",repeat:2,T:9}])}},Nb=new class extends me{constructor(){super("socket.plugin.AddPluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}},xb=new class extends me{constructor(){super("socket.plugin.RemovePluginRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"staggered",kind:"scalar",T:8}])}},Lb=new class extends me{constructor(){super("socket.plugin.EnablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}},Ub=new class extends me{constructor(){super("socket.plugin.DisablePluginForRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9}])}},jb=new class extends me{constructor(){super("socket.plugin.EnablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Fb=new class extends me{constructor(){super("socket.plugin.DisablePluginForPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9}])}},Vb=new class extends me{constructor(){super("socket.plugin.PluginEventToRoomRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}},Bb=new class extends me{constructor(){super("socket.plugin.PluginEventToPeersRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"peer_ids",kind:"scalar",repeat:2,T:9},{no:3,name:"plugin_data",kind:"scalar",T:12}])}},Hb=new class extends me{constructor(){super("socket.plugin.StoreKeys",[{no:1,name:"store_key",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",opt:!0,T:12}])}},Wb=new class extends me{constructor(){super("socket.plugin.PluginStoreInsertKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"insert_keys",kind:"message",repeat:1,T:()=>Hb}])}},Gb=new class extends me{constructor(){super("socket.plugin.PluginStoreGetKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"get_keys",kind:"message",repeat:1,T:()=>Hb}])}},qb=new class extends me{constructor(){super("socket.plugin.PluginStoreDeleteKeysRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"delete_keys",kind:"message",repeat:1,T:()=>Hb}])}},$b=new class extends me{constructor(){super("socket.plugin.PluginStoreDeleteRequest",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9}])}},zb=new class extends me{constructor(){super("socket.plugin.EnablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"enabled_by",kind:"scalar",T:9}])}},Jb=new class extends me{constructor(){super("socket.plugin.EnablePluginsResponse",[{no:1,name:"plugins",kind:"message",repeat:1,T:()=>zb}])}},Kb=new class extends me{constructor(){super("socket.plugin.DisablePluginResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"disabled_by",kind:"scalar",T:9}])}},Qb=new class extends me{constructor(){super("socket.plugin.PluginStoreItem",[{no:1,name:"timestamp",kind:"scalar",T:9},{no:2,name:"peer_id",kind:"scalar",T:9},{no:3,name:"store_key",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}])}},Yb=new class extends me{constructor(){super("socket.plugin.PluginStoreResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"store_name",kind:"scalar",T:9},{no:3,name:"store_items",kind:"message",repeat:1,T:()=>Qb}])}},Xb=new class extends me{constructor(){super("socket.plugin.PluginEventResponse",[{no:1,name:"plugin_id",kind:"scalar",T:9},{no:2,name:"plugin_data",kind:"scalar",T:12}])}},Zb=new class extends me{constructor(){super("socket.livestreaming.LiveStreamingEvent",[{no:1,name:"livestream_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"meeting_id",kind:"scalar",T:9},{no:5,name:"playback_url",kind:"scalar",T:9},{no:6,name:"org_id",kind:"scalar",T:9},{no:7,name:"room_name",kind:"scalar",T:9},{no:8,name:"room_uuid",kind:"scalar",T:9},{no:9,name:"status",kind:"scalar",T:9}])}},ew=new class extends me{constructor(){super("socket.livestreaming.GetStagePeersResponse",[{no:1,name:"stage_peers",kind:"scalar",repeat:2,T:9}])}},tw=new class extends me{constructor(){super("socket.livestreaming.StageRequest",[{no:1,name:"display_name",kind:"scalar",T:9},{no:2,name:"user_id",kind:"scalar",T:9},{no:3,name:"peer_id",kind:"scalar",T:9}])}},rw=new class extends me{constructor(){super("socket.livestreaming.GetStageRequestsResponse",[{no:1,name:"stage_requests",kind:"message",repeat:1,T:()=>tw}])}},nw=new class extends me{constructor(){super("socket.livestreaming.GrantStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},iw=new class extends me{constructor(){super("socket.livestreaming.DenyStageAccessRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},sw=new class extends me{constructor(){super("socket.livestreaming.LeaveStageRequest",[{no:1,name:"user_ids",kind:"scalar",repeat:2,T:9}])}},ow=new class extends me{constructor(){super("socket.polls.Poll",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"created_by",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"question",kind:"scalar",T:9},{no:5,name:"options",kind:"message",repeat:1,T:()=>aw},{no:6,name:"hide_votes",kind:"scalar",T:8},{no:7,name:"anonymous",kind:"scalar",T:8},{no:8,name:"votes",kind:"scalar",repeat:2,T:9}])}},aw=new class extends me{constructor(){super("socket.polls.PollOption",[{no:1,name:"text",kind:"scalar",T:9},{no:2,name:"count",kind:"scalar",opt:!0,T:4,L:2},{no:3,name:"votes",kind:"message",repeat:1,T:()=>cw}])}},cw=new class extends me{constructor(){super("socket.polls.PollVote",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}])}},dw=new class extends me{constructor(){super("socket.polls.NewPollRequest",[{no:1,name:"question",kind:"scalar",T:9},{no:2,name:"options",kind:"scalar",repeat:2,T:9},{no:3,name:"anonymous",kind:"scalar",T:8},{no:4,name:"hide_votes",kind:"scalar",T:8},{no:5,name:"created_by",kind:"scalar",opt:!0,T:9},{no:6,name:"created_by_user_id",kind:"scalar",opt:!0,T:9}])}},lw=new class extends me{constructor(){super("socket.polls.VotePollRequest",[{no:1,name:"poll_id",kind:"scalar",T:9},{no:2,name:"index",kind:"scalar",T:4,L:2}])}},uw=new class extends me{constructor(){super("socket.polls.UpdatePollResponse",[{no:1,name:"poll",kind:"message",T:()=>ow}])}},hw=new class extends me{constructor(){super("socket.polls.GetPollsResponse",[{no:1,name:"polls",kind:"message",repeat:1,T:()=>ow}])}},pw=new class extends me{constructor(){super("socket.recording.RecordingEvent",[{no:1,name:"recording_id",kind:"scalar",T:9},{no:2,name:"err_message",kind:"scalar",T:9},{no:3,name:"recording_type",kind:"enum",T:()=>["common.RecordingType",qE]}])}};var mw,fw;!function(e){e[e.ACTION=0]="ACTION",e[e.RESPONSE=1]="RESPONSE",e[e.EVENT=2]="EVENT"}(mw||(mw={})),function(e){e[e.SERVICE_NOT_FOUND=0]="SERVICE_NOT_FOUND",e[e.PARAMETER_VALIDATION_ERROR=1]="PARAMETER_VALIDATION_ERROR",e[e.TIMEOUT_ERROR=2]="TIMEOUT_ERROR",e[e.APPLICATION_ERROR=3]="APPLICATION_ERROR"}(fw||(fw={})),new class extends me{constructor(){super("bridge.BridgeMessage",[{no:1,name:"type",kind:"enum",T:()=>["bridge.BridgeMessageType",mw]},{no:2,name:"action",kind:"message",oneof:"data",T:()=>gw},{no:3,name:"response",kind:"message",oneof:"data",T:()=>vw},{no:4,name:"event",kind:"message",oneof:"data",T:()=>_w}])}};const gw=new class extends me{constructor(){super("bridge.BridgeAction",[{no:1,name:"action",kind:"scalar",T:9},{no:2,name:"params",kind:"scalar",T:9}])}},vw=new class extends me{constructor(){super("bridge.BridgeResponse",[{no:1,name:"success",kind:"scalar",T:8},{no:2,name:"response",kind:"scalar",T:12},{no:3,name:"error",kind:"message",T:()=>yw}])}},yw=new class extends me{constructor(){super("bridge.BridgeError",[{no:1,name:"type",kind:"enum",T:()=>["bridge.ErrorType",fw]},{no:2,name:"message",kind:"scalar",T:9}])}},_w=new class extends me{constructor(){super("bridge.BridgeEvent",[{no:1,name:"event",kind:"scalar",T:9},{no:2,name:"params",kind:"scalar",T:9}])}};new class extends me{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3,L:0},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),t=Date.now();return e.seconds=W.from(Math.floor(t/1e3)).toBigInt(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*W.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){const t=this.create(),r=e.getTime();return t.seconds=W.from(Math.floor(r/1e3)).toBigInt(),t.nanos=r%1e3*1e6,t}internalJsonWrite(e,t){let r=1e3*W.from(e.seconds).toNumber();if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);n="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(r).toISOString().replace(".000Z",n)}internalJsonRead(e,t,r){if("string"!=typeof e)throw new Error("Unable to parse Timestamp from JSON "+k(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return r||(r=this.create()),r.seconds=W.from(i/1e3).toBigInt(),r.nanos=0,n[7]&&(r.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),r}};const Sw={isV2AuthToken:!1,meetingId:null,overrides:{},roomNodeOptions:void 0},Tw={baseURL:"http://localhost:5000",createdAt:"2021-08-05T10:49:56.602Z",description:"Develop plugins locally",id:"09259e3b-7be8-46f6-9801-106bf1866e1c",name:"Localhost Dev",organizationId:"4ad15a19-80e2-4105-bf43-48039fd2963e",picture:"https://dyte-uploads.s3.ap-south-1.amazonaws.com/dyte.png",private:!1,published:!0,staggered:!1,tags:["#localhost","#dev"],type:"self_hosted",updatedAt:"2021-08-05T10:50:07.681Z"};function Ew(e){return!(!Sw.overrides||!Sw.overrides[e])&&Sw.overrides[e]}function bw(e){Sw.roomNodeOptions=e}function ww(e,t){return!!function(e,t){return!!(Sw.isV2AuthToken&&(In.hasFeature(DS.CONNECTED_MEETINGS)||e===vn.Livestream||e===vn.Chat)||t.includes("HIVE"))}(e,t)||"socket-service"===(In.getValue(DS.CHAT_SOCKET_SERVER)||Ew(DS.CHAT_SOCKET_SERVER)||"socket-service")}function kw(e,t){return!(e!==vn.Livestream&&e!==vn.Chat&&!t.includes("HIVE"))||"socket-service"===(In.getValue(DS.POLL_SOCKET_SERVER)||"socket-service")}function Rw(e,t){return!!t.includes("HIVE")||"socket-service"===(In.getValue(DS.PLUGIN_SOCKET_SERVER)||"socket-service")}function Cw(e,t){return ww(e,t)||kw(e,t)||Rw(0,t)}const Iw=3,Aw=30,Pw=8e3;class Dw{constructor(e){Kt(this,"ipInfo"),Kt(this,"axios"),Kt(this,"requests"),Kt(this,"roomName"),Kt(this,"roomUUID"),Kt(this,"peerId"),Kt(this,"authToken"),Kt(this,"organizationId"),Kt(this,"iceServers"),Kt(this,"pluginInformation"),Kt(this,"userDetails"),Kt(this,"roomDetails");const{timeout:t=Pw,retry:r=Iw,retryDelay:n=Aw,baseURL:i="https://api.cluster.dyte.in",authToken:s,cachedUserDetails:o}=e||{};this.iceServers=null==o?void 0:o.iceServers,this.pluginInformation=null==o?void 0:o.pluginInformation,this.userDetails=null==o?void 0:o.userDetails,this.roomDetails=null==o?void 0:o.roomDetails,this.requests=p().create({baseURL:i,responseType:"json",timeout:t,retry:r,retryDelay:n}),this.axios=p(),this.setAuthToken(s,{bearer:!0}),this.requests.interceptors.request.use((e=>(VS.injectContext(this.requests.defaults.headers.common),e)),(e=>tr(this,null,(function*(){BS.error("xhr::axios",{debuggingHint:"otelRequestInterceptor failed.",error:e})})))),this.requests.interceptors.response.use((e=>{try{e.config.url!==VS.logsEndpoint&&BS.debug("xhr::axios",{networkCall:{status:e.status,statusText:e.statusText,baseURL:e.config.baseURL,url:e.config.url,method:e.config.method}})}catch(t){console.error("xhr::dyte",{error:"responseInterceptorFailed",err:t,response:e})}return e}),(e=>tr(this,null,(function*(){var t;try{if(!e)return Promise.reject(new Error("Unknown error occurred"));e&&e.config&&(null==(t=e.config)?void 0:t.url)!==VS.logsEndpoint&&BS.error("xhr::axios",{error:e,networkCall:{status:e.status,statusText:e.statusText,baseURL:e.config.baseURL,url:e.config.url,retries:e.config.retry,method:e.config.method,isOnline:navigator.onLine?"online":"offline"}});const{config:r,message:n}=e;return r&&n&&void 0!==r.retry&&r.retry>0&&(n.includes("timeout")||n.includes("Network Error"))?(r.retry-=1,this.requests(r)):Promise.reject(e)}catch(t){return console.error("xhr::dyte",{error:"responseInterceptorFailed",err:t,responseError:e}),Promise.reject(t)}}))))}setAuthToken(e,t){const{bearer:r}=t||{};this.authToken=e,this.requests.defaults.headers.common.Authorization=r?`Bearer ${e}`:e}setHeader(e,t){this.requests.defaults.headers.common[e]=t}setRoomName(e){this.roomName=e}setRoomUUID(e){this.roomUUID=e}setPeerId(e){this.peerId=e}setOrganizationId(e){this.organizationId=e}}function Ow(){return{location:sd({servicePrefix:"location",apiBase:td.apiBase,baseURI:td.baseURI}),locationLegacy:sd({servicePrefix:"location-legacy",apiBase:td.apiBase,baseURI:td.baseURI}),daCollector:sd({servicePrefix:"da-collector",apiBase:td.apiBase,baseURI:td.baseURI})}}var Mw=Object.defineProperty,Nw=Object.getOwnPropertyDescriptor,xw=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?Nw(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&Mw(t,r,s),s};class Lw extends Dw{constructor(e){super(e),this.setHeader("x-dyte-web-core-version",nd)}getIPDetails(e){return tr(this,arguments,(function*({peerId:e}){var t;try{const r=yield en.getIPDetails({peerId:e,apiHostnames:Ow()});if(BS.log("ipInfo",{ipInfo:r}),(null==(t=r.loc)?void 0:t.length)>5)return r;throw Error("Insufficient data")}catch(e){return void BS.warn("ApiClient.getRoomNodeLinkAndTitleV1 Failed to get ip details",{error:{name:e.name,message:e.message}})}}))}getICEServers(){return tr(this,null,(function*(){if(this.iceServers)return this.iceServers;const{success:e,iceServers:t}=(yield this.requests.get("/iceservers")).data;return e?t:void 0}))}getPlugins(e){return tr(this,null,(function*(){var t,r,n,i,s,o,a;if(this.pluginInformation)return this.pluginInformation;let{plugins:c}=(yield this.requests.get("/v2/plugins/user")).data.data;const d=(null==(r=null==(t=In.getValue(DS.V1_PLUGINS))?void 0:t.toString())?void 0:r.split(","))||[],l=c.reduce(((e,t)=>(e[d.includes(t.id)?"v1":"v2"].push(t),e)),{v1:[],v2:[]});return c=e?l.v2:l.v1,null!=(s=null==(i=null==(n=td.modules)?void 0:n.devTools)?void 0:i.plugins)&&s.length&&(null==(a=null==(o=td.modules)?void 0:o.devTools)||a.plugins.forEach((e=>{var t,r,n;const i=zt($t({},Tw),{tags:[...Tw.tags]});i.baseURL=`http://localhost:${e.port}`,i.name=e.name,i.picture=null!=(t=e.picture)?t:Tw.picture,i.description=null!=(r=e.description)?r:Tw.description,i.staggered=null!=(n=e.staggered)?n:Tw.staggered,i.createdAt=(new Date).toISOString(),i.updatedAt=(new Date).toISOString(),i.id=e.id,i.organizationId=this.organizationId,c.push(i)}))),c}))}getPluginDetails(e){return tr(this,null,(function*(){const{plugin:t}=(yield this.requests.get(`/v2/plugins/view/${e}`)).data.data;return t}))}getPluginConfig(e){return tr(this,null,(function*(){return(yield this.axios.get(`${e}/dyte-config.json`)).data}))}authorizePlugin(e){return tr(this,null,(function*(){const t={peerId:this.peerId};Sw.isV2AuthToken||(t.roomName=this.roomName);const{token:r}=(yield this.requests.post(`/v2/plugins/authorize/${e}`,t)).data.data;return r}))}getPresignedUrls(e,t){return tr(this,null,(function*(){const r={roomUUID:this.roomUUID,filename:e};In.hasFeature(DS.FEAT_CHAT_SDK)&&(r.viewType=t);const{getLocation:n,putLocation:i}=(yield this.requests.post("/v1/meetings/genPreSignedUploadUrl",r)).data.data;return{getLocation:n,putLocation:i}}))}uploadFile(e,t){return tr(this,null,(function*(){if(navigator.isReactNative&&"uri"in e)try{yield fetch(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:{uri:e.uri,name:e.name}})}catch(e){BS.error(`sendFileMessage::${e}`)}else yield this.axios.put(t,e,{headers:{"Content-Type":e.type}})}))}}xw([VS.trace("APIClient.getIPDetails")],Lw.prototype,"getIPDetails",1),xw([VS.trace("APIClient.getICEServers")],Lw.prototype,"getICEServers",1);var Uw=Object.defineProperty,jw=Object.getOwnPropertyDescriptor,Fw=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?jw(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&Uw(t,r,s),s};class Vw extends Lw{startLivestreaming(){return tr(this,null,(function*(){var e,t;return null==(t=null==(e=(yield this.requests.post(`/v2/meetings/${Sw.meetingId}/livestreams`)).data)?void 0:e.data)?void 0:t.playback_url}))}stopLivestreaming(){return tr(this,null,(function*(){return this.requests.post(`/v2/meetings/${Sw.meetingId}/active-livestream/stop`)}))}getActiveLivestream(){return tr(this,null,(function*(){const{playbackUrl:e,status:t}=CS((yield this.requests.get(`/v2/meetings/${Sw.meetingId}/active-livestream`)).data.data);return{status:t,playbackUrl:e}}))}getUserDetails(){return tr(this,null,(function*(){return this.userDetails?this.userDetails:CS((yield this.requests.get("v2/internals/participant-details")).data.data)}))}getUserPreset(){throw new Error("getUserPreset does not exist for v2")}startRecording(e,t){return tr(this,null,(function*(){return(yield this.requests.post("/v2/recordings",zt($t({},IS(e)),{meeting_id:Sw.meetingId,allow_multiple_recordings:!!t}))).data.data.id}))}updateRecording(e,t){return tr(this,null,(function*(){return this.requests.put(`v2/recordings/${e}`,{action:t})}))}getActiveRecording(){return tr(this,null,(function*(){const{status:e,id:t}=(yield this.requests.get(`v2/recordings/active-recording/${Sw.meetingId}`)).data.data;return{status:e,id:t}}))}getActiveTranscript(){return tr(this,null,(function*(){const{transcript_download_url:e}=(yield this.requests.get(`v2/meetings/${Sw.meetingId}/active-transcript`)).data.data;try{return{transcript:(yield this.axios.get(e)).data}}catch(e){throw new $S("Cant fetch transcript s3 url")}}))}getRoomNodeData(e){return tr(this,arguments,(function*({peerId:e}){if(this.roomDetails)return this.roomDetails;const t=yield this.getIPDetails({peerId:e});this.ipInfo=t;const{roomNodeLink:r,title:n,useHiveMedia:i}=CS((yield this.requests.post("v2/internals/rooms",{ip_information:t})).data.data);return{roomNodeUrl:r,meetingTitle:n,useHiveMedia:null!=i&&i}}))}}Fw([VS.trace("APIClient.startLivestreaming")],Vw.prototype,"startLivestreaming",1),Fw([VS.trace("APIClient.stopLivestreaming")],Vw.prototype,"stopLivestreaming",1),Fw([VS.trace("APIClient.getActiveLivestream")],Vw.prototype,"getActiveLivestream",1),Fw([VS.trace("APIClient.getUserDetails")],Vw.prototype,"getUserDetails",1),Fw([VS.trace("APIClient.getUserPreset")],Vw.prototype,"getUserPreset",1),Fw([VS.trace("APIClient.startRecording")],Vw.prototype,"startRecording",1),Fw([VS.trace("APIClient.stopRecording")],Vw.prototype,"updateRecording",1),Fw([VS.trace("APIClient.getActiveRecording")],Vw.prototype,"getActiveRecording",1),Fw([VS.trace("APIClient.getActiveTranscript")],Vw.prototype,"getActiveTranscript",1),Fw([VS.trace("APIClient.getRoomNodeData")],Vw.prototype,"getRoomNodeData",1);var Bw=Object.defineProperty,Hw=Object.getOwnPropertyDescriptor,Ww=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?Hw(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&Bw(t,r,s),s};class Gw extends Lw{startLivestreaming(){throw new Error("Method not implemented.")}stopLivestreaming(){throw new Error("Method not implemented.")}getActiveLivestream(){throw new Error("Method not implemented.")}getUserDetails(){return tr(this,null,(function*(){const{user:e}=(yield this.requests.get("/auth/basicUserDetails")).data;return e}))}getUserPreset(e){return tr(this,null,(function*(){const{preset:t}=(yield this.requests.post("/v1/userpreset",{roomName:e,authToken:this.authToken,clientType:"CLIENT_APP",version:"0.5.0"})).data.data;return CS(t)}))}startRecording(e){return tr(this,null,(function*(){const t=yield this.requests.post(`/v1/organizations/${this.organizationId}/rooms/${this.roomName}/recording`,e);if(201!==t.status)throw new Error("Recording failed to start");return t.data.data.recording.id}))}updateRecording(e,t){return tr(this,null,(function*(){if("stop"===t&&201!==(yield this.requests.put(`/v1/organizations/${this.organizationId}/rooms/${this.roomName}/recordings/${e}`,{recordingAction:"stop"})).status)throw new Error("Recording failed to stop")}))}getActiveRecording(){return tr(this,null,(function*(){return this.organizationId?(yield this.requests.get(`/v1/organizations/${this.organizationId}/rooms/${this.roomName}/active-recording?limit=50`)).data.data.recording:{}}))}getActiveTranscript(){return tr(this,null,(function*(){return BS.error("getActiveTranscript does not work in v1 meeting"),{transcript:""}}))}getRoomNodeData(e){return tr(this,arguments,(function*({roomName:e,peerId:t}){const r=yield this.getIPDetails({peerId:t});this.ipInfo=r;const{roomNodeLink:n,title:i,useHiveMedia:s}=(yield this.requests.post("/graphql",{query:"\n\t\t\t\tquery Session($roomName: String!, $password: String, $ipInformation: String) {\n\t\t\t\t\t\tsession(roomName: $roomName, password: $password) {\n\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\troomNodeLink(ipInformation: $ipInformation),\n\t\t\t\t\t\t\tuseHiveMedia,\n\t\t\t\t\t\t\troomName,\n\t\t\t\t\t\t\tpassword\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t",variables:{roomName:e,ipInformation:JSON.stringify(r)}})).data.data.session;return{roomNodeUrl:n,meetingTitle:i,useHiveMedia:null!=s&&s}}))}}let qw;function $w(){return qw}function zw(e,t){return Object.keys(t).reduce(((r,n)=>(r[n]=(e<<16)+t[n],r)),{})}Ww([VS.trace("APIClientV1.getUserDetails")],Gw.prototype,"getUserDetails",1),Ww([VS.trace("APIClientV1.getUserPreset")],Gw.prototype,"getUserPreset",1),Ww([VS.trace("APIClientV1.startRecording")],Gw.prototype,"startRecording",1),Ww([VS.trace("APIClientV1.updateRecording")],Gw.prototype,"updateRecording",1),Ww([VS.trace("APIClientV1.getActiveRecording")],Gw.prototype,"getActiveRecording",1),Ww([VS.trace("APIClient.getActiveTranscript")],Gw.prototype,"getActiveTranscript",1),Ww([VS.trace("APIClientV1.getRoomNodeData")],Gw.prototype,"getRoomNodeData",1);const Jw=zw(0,{getPeerInfo:0,updatePeerInfo:1,getRoomPeersInfo:2,joinRoom:3,leaveRoom:4,getRoomInfo:5,updateRoomInfo:6,closeRoom:7,startedLivestream:8,stoppedLivestream:9,erroredLivestream:10,getStagePeers:11,getStageRequests:12,requestStageAccess:13,cancelStageRequest:14,grantStageAccess:15,denyStageAccess:16,roomPeerCount:17,joinStage:18,leaveStage:19,getConnectedRoomsDump:20,createConnectedRooms:21,deleteConnectedRooms:22,movePeers:23,transferPeer:24,movedPeer:25,connectedRoomsUpdated:26,connectedRoomsDeleted:27,getAllAddedParticipants:28,broadcastMessage:29,kick:30,kickAll:31,transcript:32,getWaitingRoomRequests:33,acceptWaitingRoomRequests:34,waitingRoomRequestAccepted:35,denyWaitingRoomRequests:36,waitingRoomRequestDenied:37,peerStageStatusUpdate:38,broadcastToPeers:39,recordingStarted:40,recordingStopped:41,recordingPaused:42,getRoomStageState:43}),Kw=zw(1,{getMessages:0,sendMessageToRoom:1,sendMessageToPeers:2,editMessage:3,deleteMessage:4,getPaginatedMessages:5,sendMessageToChannel:6,searchChannelMessages:7,getAllChatChannels:8,markChannelIndexAsRead:9,pinMessage:10}),Qw=zw(2,{getPlugins:0,addPlugin:1,enablePluginForRoom:2,disablePluginForPeers:3,enablePluginForPeers:4,disablePluginForRoom:5,removePlugin:6,customPluginEventToRoom:7,customPluginEventToPeers:8,storeInsertKeys:9,storeGetKeys:10,storeDeleteKeys:11,storeDelete:12}),Yw=zw(3,{createPoll:0,getPolls:1,votePoll:2,updatePoll:3}),Xw=zw(4,{createChatChannel:0,getChatChannel:1,deprecatedGetAllChatChannels:2,getChannelMembers:3,updateChatChannel:4}),Zw=function(e){return Object.keys(e).reduce(((t,r)=>(t[r]=16777216|e[r],t)),{})}({unknown:0,createWebRTCTransport:1,produce:2,consume:3,toggleProducer:4,toggleConsumer:5,closeProducer:6,closeConsumer:7,joinRoom:16,leaveRoom:17,selectedPeer:18,globalPinPeer:19,selfJoinComplete:20,peerJoinedBroadcast:25,peerLeaveBroadcast:26,peerProducerCreateBroadcast:27,peerProducerToggleBroadcast:28,peerProducerCloseBroadcast:29,globalPeerPinBroadcast:30,recordingStartedBroadcast:31,recordingStoppedBroadcast:32,peerDisplayNameEditBroadcast:33,mediaRoomTerminationBroadcastResponse:36,selectedPeerDiff:40,renegotiateSessionDescription:50,errorResponse:60,kickPeer:90,kickAll:91,changeDisplayName:92,hostControlPeer:93,hostControlAllPeers:94}),ek=zw(5,{getUserPresets:0,updateUserPreset:1});var tk;class rk{constructor(){Kt(this,"meetingTitle"),Kt(this,"roomName"),Kt(this,"roomUUID"),Kt(this,"isDisconnected"),Kt(this,"roomJoined"),Xt(this,tk,void 0),Kt(this,"peerId"),Kt(this,"authToken"),Kt(this,"maxPreferredStreams"),Kt(this,"mediaConnected")}get sfuHandler(){return Yt(this,tk)}reconnect(){throw new $S("Method not implemented.")}joinRoom(e,t,r,n){return tr(this,arguments,(function*(e,t,r,n,i={}){throw new $S("Method not implemented.")}))}leaveRoom(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}handleSocketCallbacks(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}handleSockets(e,t){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}shareMic(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}shareWebcam(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}shareScreen(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}unmuteSelf(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}muteSelf(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}pauseWebcam(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}disableScreenShare(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}acceptWaitingRequest(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}rejectWaitingRequest(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}muteAll(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}muteAllVideo(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}disableAudio(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}disableVideo(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}kickAll(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}kick(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}pinPeer(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}getChatMessages(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}requestRemoteControl(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}acceptRemoteControl(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}terminateRemoteControl(e,t){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}sendEventRemoteControl(e,t,r){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}getPolls(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}newPoll(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}votePoll(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}getPage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}getConsumers(){throw new $S("Method not implemented.")}sendMessage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}getRoomState(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}addRoomPlugin(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}removeRoomPlugin(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}unpinChatMessage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}pinChatMessage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}sendChatMessage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}broadcastMessage(e,t){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}acceptAllRequestToJoinStage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}grantStageAccess(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}stopPresenting(){return tr(this,null,(function*(){}))}startPresenting(){return tr(this,null,(function*(){}))}requestToJoinStage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}rejectRequestToJoinStage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}denyStageAccess(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}withdrawRequestToJoinStage(){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}removePeerFromStage(e,t){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}kickPeerFromStage(e){return tr(this,null,(function*(){throw new $S("Method not implemented.")}))}stopAllProducers(){throw new $S("Method not implemented.")}}tk=new WeakMap;var nk,ik,sk,ok,ak,ck,dk,lk,uk,hk,pk,mk,fk,gk,vk,yk,_k=(e=>(e.INITIALIZING="INITIALIZING",e.INITIALIZED="INITIALIZED",e.NOT_INITIALIZED="NOT_INITIALIZED",e))(_k||{});class Sk extends nr.EventEmitter{}class Tk extends nr.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return BS.error(`EnhancedEventEmitter:: safeEmit() | event listener ${e} threw an error`,{error:t}),Boolean(r)}}safeEmitAsPromise(e,...t){return tr(this,null,(function*(){const r={}.EVENT_PROMISE_TIMEOUT?parseInt({}.EVENT_PROMISE_TIMEOUT,10):1e4;return this.safeEmitAsPromiseWithTimeout(e,r,...t)}))}safeEmitAsPromiseWithTimeout(e,t,...r){return tr(this,null,(function*(){return new Promise(((n,i)=>{setTimeout(i,t,"event request timeout");try{this.emit(e,...r,n,i)}catch(t){BS.error(`EnhancedEventEmitter:: safeEmitAsPromise() | event listener for event ${e} threw an error [event:%s]:%o`,{error:t}),i(t)}}))}))}}class Ek extends Tk{constructor(){super(),Kt(this,"_mapMidTransceiver",new Map),Kt(this,"_enableHighBitrate",!1),Kt(this,"_enableStereo",!1),this._mapMidTransceiver=new Map,this._enableHighBitrate=!1}get midTransceiverMap(){return this._mapMidTransceiver}}class bk extends Ek{constructor(){super(),Kt(this,"_direction"),Kt(this,"_pc"),Kt(this,"_sendWebStream",new MediaStream),Kt(this,"_sendScreenShareStream",new MediaStream),Kt(this,"_transportReady",!1)}static createFactory(){return()=>new bk}get name(){return"Chrome74"}get pc(){return this._pc}close(){if(BS.debug("close()"),this._pc)try{this._pc.close()}catch(e){BS.error("pc.close()",e)}}init({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:i,onTrackHandler:s}){this._direction=e,this._pc=new RTCPeerConnection($t({iceServers:t||[],iceTransportPolicy:r||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},n),i),s&&this._pc.addEventListener("track",(e=>{s(e)})),this._addEventListeners()}connect(){return tr(this,null,(function*(){const e=this._pc.createDataChannel("dyte"),t=yield this._pc.createOffer();return BS.info(`connect offer: ${JSON.stringify(t)}`),yield this._pc.setLocalDescription(t),{offerSdp:t,callback:t=>tr(this,null,(function*(){BS.debug(`Chrome74::connect() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),e.close()}))}}))}updateIceServers(e){return tr(this,null,(function*(){BS.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(){return tr(this,null,(function*(){BS.debug("restartIce()");const e=yield this.pc.createOffer({iceRestart:!0});return BS.debug(`restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:e=>tr(this,null,(function*(){BS.info(`restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOption:r,screenShare:n}){var i;this._assertSendDirection(),BS.debug(`send() [kind:${e.kind}, track.id:${e.id}]`);const s=this._pc.addTransceiver(e,{direction:"sendonly",streams:[n?this._sendScreenShareStream:this._sendWebStream],sendEncodings:t});if(!navigator.isReactNative){BS.debug("creating new transceiver");const t=RTCRtpSender.getCapabilities(e.kind);BS.info(`senders available params: ${JSON.stringify(t)}`);const n=[];if(r){const e=t.codecs.find((e=>e.mimeType.includes(r.name)));if(r.parameters){BS.info(`codecOption.parameters:${JSON.stringify(r.parameters)}`);const t=(null==(i=e.sdpFmtpLine)?void 0:i.split(";"))||[];t.push(...r.parameters);const n=Array.from(new Set(t).values());e.sdpFmtpLine=n.join(";")}n.push(e)}BS.info(`selected codecs: ${JSON.stringify(n)}`),s.setCodecPreferences(n)}const o=yield this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(yield this._pc.setLocalDescription(o),r&&"opus"===r.name){const e=this._enableStereo,t=this._enableHighBitrate?e?128e3:64e3:e?64e3:32e3;o.sdp=o.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${e?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${t}`),o.sdp+="a=rtcp-fb:111 nack\r\n"}return{offerSdp:o,callback:e=>tr(this,null,(function*(){return BS.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e),this.midTransceiverMap.set(s.mid,s),s.mid}))}}))}stopSending(e){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`stopSending() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}replaceTrack(e,t){return tr(this,null,(function*(){this._assertSendDirection(),t?BS.debug(`replaceTrack() [localId:${e}, track.id:${t.id}]`):BS.debug(`replaceTrack() [localId:${e}, no track]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${t}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(n)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(t)}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n)}))}getSenderStats(e){this._assertSendDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}stopReceiving(e){return tr(this,null,(function*(){throw this._assertRecvDirection(),BS.debug(`stopReceiving() [localId:${e}]`),Error("method not implemented")}))}pauseReceiving(e){return tr(this,null,(function*(){throw this._assertRecvDirection(),BS.debug(`pauseReceiving() [localId:${e}]`),Error("method not implemented")}))}resumeReceiving(e){return tr(this,null,(function*(){throw this._assertRecvDirection(),BS.debug(`resumeReceiving() [localId:${e}]`),Error("method not implemented")}))}getReceiverStats(e){return tr(this,null,(function*(){this._assertRecvDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}_generateOffer(){return tr(this,null,(function*(){const e=yield this._pc.createOffer();return yield this._pc.setLocalDescription(e),e}))}_setAnswer(e){return tr(this,null,(function*(){BS.debug(`setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}_addEventListeners(){this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidate",(e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})})),this._pc.addEventListener("negotiationneeded",(()=>{this.emit("@negotiationneeded",{}),BS.debug("negotiationneeded")})),this._pc.addEventListener("icegatheringstatechange",(()=>{switch(this._pc.iceGatheringState){case"gathering":BS.debug("icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":BS.debug("icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidateerror",(e=>{BS.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})})),this._pc.addEventListener("datachannel",(e=>{BS.info("data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:t}=e;t.onopen=()=>{BS.info("data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel.label)},t.onclose=()=>{BS.warn("data channel closed: ",{rtcChannel:{label:e.channel.label}})},t.onerror=()=>{BS.error("data channel error: ",{rtcChannel:{label:e.channel.label}})},t.onmessage=t=>{this.safeEmit("datachannel",e.channel,String.fromCharCode(...new Uint8Array(t.data)))}}))}}class wk extends Ek{constructor(e){super(),Kt(this,"_direction"),Kt(this,"_pc"),Kt(this,"_sendWebStream",new MediaStream),Kt(this,"_sendScreenShareStream",new MediaStream),Kt(this,"_transportReady",!1),Kt(this,"supportsSendEncodings",!1),this.supportsSendEncodings=e.supportsSendEncodings}static createFactory(e){return()=>new wk(e)}get name(){return"Firefox60"}get pc(){return this._pc}close(){if(BS.debug("Firefox60::close()"),this._pc)try{this._pc.close()}catch(e){BS.error("Firefox60::pc.close()",{error:e})}}init({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:i,onTrackHandler:s}){BS.debug("Firefox60::init()"),this._direction=e,this._pc=new RTCPeerConnection($t({iceServers:t||[],iceTransportPolicy:r||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},n),i),s&&this._pc.addEventListener("track",(e=>{s(e)})),this._addEventListeners()}connect(){return tr(this,null,(function*(){const e=this._pc.createDataChannel("dyte"),t=yield this._pc.createOffer();return BS.info(`Firefox60::connect offer: ${JSON.stringify(t)}`),yield this._pc.setLocalDescription(t),{offerSdp:t,callback:t=>tr(this,null,(function*(){BS.debug(`Firefox60::connect() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),e.close()}))}}))}updateIceServers(e){return tr(this,null,(function*(){throw BS.debug("Firefox60::updateIceServers()"),new Error("not supported")}))}restartIce(){return tr(this,null,(function*(){BS.debug("Firefox60::restartIce()");const e=yield this.pc.createOffer({iceRestart:!0});return BS.debug(`Firefox60::restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:e=>tr(this,null,(function*(){BS.info(`Firefox60::restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,screenShare:r}){this._assertSendDirection(),BS.debug(`Firefox60::send() [kind:${e.kind}, track.id:${e.id}]`),BS.debug("Firefox60::creating new transceiver");const n=this.supportsSendEncodings&&void 0!==t?{sendEncodings:t}:{},i=this._pc.addTransceiver(e,$t({direction:"sendonly",streams:[r?this._sendScreenShareStream:this._sendWebStream]},n));if(!this.supportsSendEncodings&&t){t.reverse();const e=i.sender.getParameters();e.encodings=t,yield i.sender.setParameters(e)}const s=yield this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(yield this._pc.setLocalDescription(s),"audio"===e.kind){const e=this._enableStereo,t=this._enableHighBitrate?e?128e3:64e3:e?64e3:32e3;s.sdp=s.sdp.replace("minptime=10;useinbandfec=1","minptime=10;useinbandfec=1;usedtx=1"+(this.supportsSendEncodings?"":`${e?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${t}`))}return{offerSdp:s,callback:e=>tr(this,null,(function*(){return BS.debug(`send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e),this.midTransceiverMap.set(i.mid,i),i.mid}))}}))}stopSending(e){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`Firefox60::stopSending() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}replaceTrack(e,t){return tr(this,null,(function*(){this._assertSendDirection(),t?BS.debug(`replaceTrack() [localId:${e}, track.id:${t.id}]`):BS.debug(`Firefox60::replaceTrack() [localId:${e}, no track]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${t}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters(),i=n.encodings.length-1-t;n.encodings.forEach(((e,t)=>{e.active=t>=i})),yield r.sender.setParameters(n)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(t)}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n)}))}getSenderStats(e){this._assertSendDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}stopReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Firefox60::stopReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",BS.info(`Firefox60::active transcievers: ${JSON.stringify(this._pc.getTransceivers())}`);const r=yield this._pc.createOffer();return BS.debug(`Firefox60::stopRecieving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`Firefox60::stopRecieving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}pauseReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Firefox60::pauseReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`pauseReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`pauseReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}resumeReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Firefox60::resumeReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r=yield this._generateOffer();return BS.debug(`resumeReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`resumeReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getReceiverStats(e){return tr(this,null,(function*(){this._assertRecvDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}_generateOffer(){return tr(this,null,(function*(){const e=yield this._pc.createOffer();return yield this._pc.setLocalDescription(e),e}))}_setAnswer(e){return tr(this,null,(function*(){BS.debug(`_setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}_addEventListeners(){this._pc.addEventListener("datachannel",(e=>{BS.info("Firefox60::data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:t}=e;t.onopen=()=>{BS.info("Firefox60::data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel.label)},t.onclose=()=>{BS.warn("data channel closed: ",{rtcChannel:{label:e.channel.label}})},t.onerror=()=>{BS.error("Firefox60::data channel error: ",{rtcChannel:{label:e.channel.label}})},t.onmessage=t=>tr(this,null,(function*(){const r=yield t.data.arrayBuffer();this.safeEmit("datachannel",e.channel,String.fromCharCode(...new Uint8Array(r)))}))})),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidate",(e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})})),this._pc.addEventListener("negotiationneeded",(()=>{this.emit("@negotiationneeded",{}),BS.debug("Firefox60::negotiationneeded")})),this._pc.addEventListener("icegatheringstatechange",(()=>{switch(this._pc.iceGatheringState){case"gathering":BS.debug("Firefox60::icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":BS.debug("Firefox60::icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:BS.warn("unknown state")}})),this._pc.addEventListener("icecandidateerror",(e=>{BS.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})}))}}class kk extends Ek{constructor(){super(),Kt(this,"_direction"),Kt(this,"_pc"),Kt(this,"_sendWebStream",new MediaStream),Kt(this,"_sendScreenShareStream",new MediaStream),Kt(this,"_transportReady",!1)}static createFactory(){return()=>new kk}get name(){return"Chrome74"}get pc(){return this._pc}close(){if(BS.debug("Safari12::close()"),this._pc)try{this._pc.close()}catch(e){BS.error("Safari12::pc.close()",e)}}init({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:i,onTrackHandler:s}){BS.debug("Safari12::init()"),this._direction=e,this._pc=new RTCPeerConnection($t({iceServers:t||[],iceTransportPolicy:r||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},n),i),s&&this._pc.addEventListener("track",(e=>{s(e)})),this._addEventListeners()}connect(){return tr(this,null,(function*(){const e=this._pc.createDataChannel("dyte"),t=yield this._pc.createOffer();return BS.info(`Safari12::connect offer: ${JSON.stringify(t)}`),yield this._pc.setLocalDescription(t),{offerSdp:t,callback:t=>tr(this,null,(function*(){BS.debug(`Safari12::connect() | calling pc.setRemoteDescription() [answer: ${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),e.close()}))}}))}updateIceServers(e){return tr(this,null,(function*(){BS.debug("Safari12::updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}))}restartIce(){return tr(this,null,(function*(){BS.debug("Safari12::restartIce()");const e=yield this.pc.createOffer({iceRestart:!0});return BS.debug(`restartIce() | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),{offerSdp:e,callback:e=>tr(this,null,(function*(){BS.info(`restartIce() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getTransportStats(){return tr(this,null,(function*(){return this._pc.getStats()}))}send(e){return tr(this,arguments,(function*({track:e,encodings:t,codecOption:r,screenShare:n}){var i;this._assertSendDirection(),BS.debug(`Safari12::send() [kind: ${e.kind}, track.id: ${e.id}]`),BS.debug("Safari12::creating new transceiver");const s=this._pc.addTransceiver(e,{direction:"sendonly",streams:[n?this._sendScreenShareStream:this._sendWebStream],sendEncodings:t}),o=RTCRtpSender.getCapabilities(e.kind);BS.info(`Safari12::senders available params: ${JSON.stringify(o)}`);const a=[];if(r){const e=o.codecs.find((e=>e.mimeType.includes(r.name)));if(r.parameters){BS.info(`Safari12::codecOption.parameters:, ${JSON.stringify(r.parameters)}`);const t=(null==(i=e.sdpFmtpLine)?void 0:i.split(";"))||[];t.push(...r.parameters);const n=[...new Set(t).values()];e.sdpFmtpLine=n.join(";")}a.push(e)}BS.info(`Safari12::selected codecs: ${JSON.stringify(a)}`),s.setCodecPreferences(a);const c=yield this._pc.createOffer();if(!this._transportReady)throw new Error("webrtc transport not connected");if(yield this._pc.setLocalDescription(c),"audio"===e.kind){const e=this._enableStereo,t=this._enableHighBitrate?e?128e3:64e3:e?64e3:32e3;c.sdp=c.sdp.replace("minptime=10;useinbandfec=1",`minptime=10;useinbandfec=1;usedtx=1${e?"":";stereo=1;sprop-stereo=1"};maxaveragebitrate=${t}`)}return{offerSdp:c,callback:e=>tr(this,null,(function*(){return BS.debug(`Safari12::send() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e),this.midTransceiverMap.set(s.mid,s),s.mid}))}}))}stopSending(e){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`Safari12::stopSending() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`Safari12::stopSending() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`Safari12::stopSending() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}replaceTrack(e,t){return tr(this,null,(function*(){this._assertSendDirection(),t?BS.debug(`Safari12::replaceTrack() [localId:${e}, track.id:${t.id}]`):BS.debug(`Safari12::replaceTrack() [localId:${e}, no track]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");yield r.sender.replaceTrack(t)}))}setMaxSpatialLayer(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setMaxSpatialLayer() [localId:${e}, spatialLayer:${t}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),yield r.sender.setParameters(n)}))}setRtpEncodingParameters(e,t){return tr(this,null,(function*(){this._assertSendDirection(),BS.debug(`setRtpEncodingParameters() [localId:${e}, params:${JSON.stringify(t)}]`);const r=this.midTransceiverMap.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=$t($t({},e),t)})),yield r.sender.setParameters(n)}))}getSenderStats(e){this._assertSendDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}receive(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`recieve() | calling pc.setLocalDescription() [answer:${JSON.stringify(e)}]`);const t=this._pc.getTransceivers().at(-1);return BS.info("Safari12::Transceiver is now receiving"),this.midTransceiverMap.set(t.mid,t),{track:t.receiver.track,localId:t.mid}}))}stopReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Safari12::stopReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",BS.info(`Safari12::active transcievers: ${JSON.stringify(this._pc.getTransceivers())}`);const r=yield this._pc.createOffer();return BS.debug(`stopRecieving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:t=>tr(this,null,(function*(){BS.debug(`stopRecieving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(t)}]`),yield this._pc.setRemoteDescription(t),this.midTransceiverMap.delete(e)}))}}))}pauseReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Safari12::pauseReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive";const r=yield this._pc.createOffer();return BS.debug(`pauseReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),yield this._pc.setLocalDescription(r),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`pauseReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}resumeReceiving(e){return tr(this,null,(function*(){this._assertRecvDirection(),BS.debug(`Safari12::resumeReceiving() [localId:${e}]`);const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly";const r=yield this._generateOffer();return BS.debug(`Safari12::resumeReceiving() | calling pc.setLocalDescription() [offer:${JSON.stringify(r)}]`),{offerSdp:r,callback:e=>tr(this,null,(function*(){BS.debug(`Safari12::resumeReceiving() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}}))}getReceiverStats(e){return tr(this,null,(function*(){this._assertRecvDirection();const t=this.midTransceiverMap.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}))}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}_generateOffer(){return tr(this,null,(function*(){const e=yield this._pc.createOffer();return yield this._pc.setLocalDescription(e),e}))}_setAnswer(e){return tr(this,null,(function*(){BS.debug(`Safari12::_setAnswer() | calling pc.setRemoteDescription() [answer:${JSON.stringify(e)}]`),yield this._pc.setRemoteDescription(e)}))}_addEventListeners(){this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this._transportReady=!0;break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break;default:BS.warn("Safari12::unknown state")}})),this._pc.addEventListener("icecandidate",(e=>{e.candidate&&this.emit("@icecandidate",{candidate:e.candidate})})),this._pc.addEventListener("negotiationneeded",(()=>{this.emit("@negotiationneeded",{}),BS.debug("Safari12::negotiationneeded")})),this._pc.addEventListener("icegatheringstatechange",(()=>{switch(this._pc.iceGatheringState){case"gathering":BS.debug("Safari12::icegatheringstatechange | gathering"),this.emit("@icegatheringstatechange","gathering");break;case"complete":BS.debug("Safari12::icegatheringstatechange | complete"),this.emit("@icegatheringstatechange","complete");break;default:BS.warn("Safari12::unknown state")}})),this._pc.addEventListener("icecandidateerror",(e=>{BS.error("icecandidateerror",{error:{code:e.errorCode,message:e.errorText}})})),this._pc.ondatachannel=e=>{BS.info("Safari12::data channel created: ",{rtcChannel:{label:e.channel.label}});const{channel:t}=e;t.onopen=()=>{BS.info("Safari12::data channel open: ",{rtcChannel:{label:e.channel.label}}),this.safeEmit("dc_open",e.channel.label)},t.onclose=()=>{BS.warn("Safari12::data channel closed: ",{rtcChannel:{label:e.channel.label}})},t.onerror=()=>{BS.error("Safari12::data channel error: ",{rtcChannel:{label:e.channel.label}})},t.onmessage=t=>tr(this,null,(function*(){const r=String.fromCharCode(...new Uint8Array(t.data));this.safeEmit("datachannel",e.channel,r)}))}}}class Rk extends $S{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Rk):this.stack=new Error(e).stack}}class Ck extends $S{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Ck):this.stack=new Error(e).stack}}class Ik extends Tk{constructor({id:e,localId:t,track:r,stopTracks:n,disableTrackOnPause:i,zeroRtpOnPause:s,handler:o,appData:a}){super(),Kt(this,"_id"),Kt(this,"_localId"),Kt(this,"_closed",!1),Kt(this,"_handler"),Kt(this,"_track"),Kt(this,"_kind"),Kt(this,"_paused"),Kt(this,"_maxSpatialLayer"),Kt(this,"_stopTracks"),Kt(this,"_disableTrackOnPause"),Kt(this,"_zeroRtpOnPause"),Kt(this,"_appData"),Kt(this,"observer"),this._id=e,this._localId=t,this._track=r,this._kind=r.kind,this._paused=!!i&&!r.enabled,this._maxSpatialLayer=void 0,this._stopTracks=n,this._disableTrackOnPause=i,this._zeroRtpOnPause=s,this._appData=a||{},this._onTrackEnded=this._onTrackEnded.bind(this),this._handler=o,this.observer=new Tk,this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get track(){return this._track}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}close(e){return tr(this,null,(function*(){if(this._closed)return;if(BS.debug("Producer::close() with reason:"),this._closed=!0,this._destroyTrack(),e===Mk)return void this.observer.emit("close");const{offerSdp:t,callback:r}=yield this._handler.stopSending(this.localId);this.observer.emit("close");const{answer:n}=yield this.safeEmitAsPromise("close",{offer:t,reason:e});r(n)}))}getStats(){return tr(this,null,(function*(){if(this._closed)throw new Ck("closed");return this._handler.getSenderStats(this.localId)}))}pause(){BS.debug("Producer::pause()",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._closed&&BS.error("Producer::pause() | Producer closed",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this._handler.replaceTrack(this.localId,null),this.observer.emit("pause")}resume(){BS.debug("Producer::resume()",{producer:{id:this.id,appData:this.appData,kind:this.kind}}),this._closed?BS.error("Producer::resume() | Producer closed",{producer:{id:this.id,appData:this.appData,kind:this.kind}}):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this._handler.replaceTrack(this.localId,this._track),this.observer.emit("resume"))}replaceTrack(e){return tr(this,arguments,(function*({track:e}){if(BS.debug("Producer::replaceTrack()",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==e?void 0:e.id}}),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(t){BS.error("Producer::replaceTrack",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==e?void 0:e.id},error:t})}throw new Ck("closed")}if(e&&"ended"===e.readyState)throw new Ck("track ended");e!==this._track?((!this._zeroRtpOnPause||!this._paused)&&(yield this._handler.replaceTrack(this.localId,e)),this._destroyTrack(),this._track=e,this._handleTrack()):BS.debug("replaceTrack() | same track, ignored",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==e?void 0:e.id}})}))}setMaxSpatialLayer(e){return tr(this,null,(function*(){if(this._closed)throw new Ck("closed");if("video"!==this._kind)throw new Rk("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");yield this._handler.setMaxSpatialLayer(this.localId,e),this._maxSpatialLayer=e}))}setRtpEncodingParameters(e){return tr(this,null,(function*(){if(this._closed)throw new Ck("closed");if("object"!=typeof e)throw new TypeError("invalid params");yield this._handler.setRtpEncodingParameters(this.localId,e)}))}_onTrackEnded(){BS.debug('Producer::track "ended" event',{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:this.track.id}}),this.observer.emit("trackended"),this.safeEmit("trackended",this.track.id)}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){var e;if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(t){BS.error("Producer::_destroyTrack",{producer:{id:this.id,appData:this.appData,kind:this.kind,trackId:null==(e=this._track)?void 0:e.id},error:t})}}}class Ak extends Tk{constructor({id:e,localId:t,producerId:r,producingPeerId:n,handler:i,track:s,appData:o,paused:a,reuseTrack:c}){super(),Xt(this,pk),Xt(this,fk),Xt(this,vk),Kt(this,"observer"),Xt(this,nk,void 0),Xt(this,ik,void 0),Xt(this,sk,void 0),Xt(this,ok,void 0),Xt(this,ak,void 0),Xt(this,ck,void 0),Xt(this,dk,void 0),Xt(this,lk,void 0),Xt(this,uk,void 0),Xt(this,hk,void 0),Zt(this,nk,e),Zt(this,ik,t),Zt(this,ck,i),Zt(this,hk,o),Zt(this,uk,n),Zt(this,ok,!1),Zt(this,sk,r),Zt(this,dk,s),Zt(this,lk,null!=a&&a),Zt(this,ak,c),this.observer=new Tk,er(this,fk,gk).call(this)}get id(){return Yt(this,nk)}get peerId(){return Yt(this,uk)}get localId(){return Yt(this,ik)}get producerId(){return Yt(this,sk)}get closed(){return Yt(this,ok)}get kind(){return Yt(this,dk).kind}get track(){return Yt(this,dk)}get paused(){return Yt(this,lk)}get remotelyPaused(){return this.paused}get appData(){return Yt(this,hk)}close(e){Yt(this,ok)||(BS.debug("Consumer::close() with reason:",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,closureReason:e,kind:this.kind}}),Zt(this,ok,!0),Yt(this,ak)||er(this,vk,yk).call(this),this.emit("close",e),this.observer.safeEmit("close",e))}getStats(){return tr(this,null,(function*(){if(Yt(this,ok))throw new Ck("closed");return Yt(this,ck).getReceiverStats(this.localId)}))}pause(){BS.debug("consumer::pause()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),Yt(this,ok)?BS.error("consumer::pause() | Consumer closed",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}):(Zt(this,lk,!0),Yt(this,dk).enabled=!1,this.observer.safeEmit("pause"))}resume(){BS.debug("consumer::resume()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),Yt(this,ok)?BS.error("Consumer::resume() | Consumer closed",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}):(Zt(this,lk,!1),Yt(this,dk).enabled=!0,this.observer.safeEmit("resume"))}}nk=new WeakMap,ik=new WeakMap,sk=new WeakMap,ok=new WeakMap,ak=new WeakMap,ck=new WeakMap,dk=new WeakMap,lk=new WeakMap,uk=new WeakMap,hk=new WeakMap,pk=new WeakSet,mk=function(){BS.debug('Consumer::track "ended" event',{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind}}),this.safeEmit("trackended"),this.observer.safeEmit("trackended")},fk=new WeakSet,gk=function(){Yt(this,dk).addEventListener("ended",er(this,pk,mk).bind(this))},vk=new WeakSet,yk=function(){try{Yt(this,dk).removeEventListener("ended",er(this,pk,mk)),Yt(this,dk).stop()}catch(e){BS.error("Consumer::destroyTrack()",{consumer:{id:this.id,appData:this.appData,peerId:this.peerId,kind:this.kind},error:e})}};const Pk=e=>new Promise((t=>setTimeout(t,e)));function Dk(e,t){return tr(this,null,(function*(){return new Promise(((r,n)=>tr(this,null,(function*(){const{strategy:i,maxRetryCount:s,delayTime:o}=$t({strategy:"linear",maxRetryCount:3,delayTime:10},t);let a,c=0,d=!1;const l=e=>{d=!0,n(e)};for(;c<s;){try{const t=yield e(c,l);return r(t)}catch(e){if(a=e,d)break;if(!(c<s))break;"linear"===i?yield Pk(o*(c+1)):"exponential"===i&&(yield Pk(o*(c+Math.max(0,c-1))))}c+=1}return n(a)}))))}))}function Ok(e){if(Promise.allSettled)return Promise.allSettled(e);const t=e.map((e=>e.then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))));return Promise.all(t)}const Mk="transport closed";var Nk,xk,Lk,Uk,jk,Fk,Vk,Bk,Hk,Wk,Gk,qk,$k,zk,Jk,Kk,Qk,Yk,Xk,Zk,eR,tR,rR,nR,iR;class sR extends Tk{constructor({id:e,direction:t,handlerFactory:r,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:s,additionalSettings:o,appData:a,config:c}){var d,l;super(),Xt(this,Xk),Xt(this,eR),Xt(this,rR),Kt(this,"awaitQueue"),Kt(this,"observer"),Xt(this,Nk,void 0),Xt(this,xk,void 0),Xt(this,Lk,!1),Xt(this,Uk,void 0),Xt(this,jk,void 0),Xt(this,Fk,void 0),Xt(this,Vk,"new"),Xt(this,Bk,void 0),Xt(this,Hk,void 0),Xt(this,Wk,void 0),Xt(this,Gk,!1),Xt(this,qk,null),Xt(this,$k,void 0),Xt(this,zk,void 0),Xt(this,Jk,void 0),Xt(this,Kk,void 0),Xt(this,Qk,void 0),Xt(this,Yk,new Map),BS.debug(`constructor() [id: ${e}, direction: ${t}]`),Zt(this,Nk,e),Zt(this,Uk,t);const u=function(e,t){return void 0===e?{}:"undefined"!=typeof window&&Object.getOwnPropertyDescriptor(window,"structuredClone")?structuredClone(e):JSON.parse(JSON.stringify(e))}(o);delete u.iceServers,delete u.iceTransportPolicy,delete u.bundlePolicy,delete u.rtcpMuxPolicy,delete u.sdpSemantics,Zt(this,Bk,new Map),Zt(this,Hk,new Map),Zt(this,Wk,new Map),Zt(this,zk,new Map),Zt(this,Kk,new Map),Zt(this,Jk,new Map),this.awaitQueue=new rc,this.observer=new Tk,Zt(this,Fk,r()),Yt(this,Fk)._enableHighBitrate=null!=(d=null==c?void 0:c.enableHighBitrate)&&d,Yt(this,Fk)._enableStereo=null!=(l=null==c?void 0:c.enableStereo)&&l,Yt(this,Fk).init({onTrackHandler:this._ontrack.bind(this),direction:t,iceServers:n,iceTransportPolicy:i,additionalSettings:o,proprietaryConstraints:s}),Zt(this,Qk,a||{}),Zt(this,$k,new Promise((e=>{this.observer.once("connected",(()=>{e(!0)})),this.observer.once("disconnect",(()=>{e(!1)})),this.observer.once("close",(()=>{e(!1)}))}))),Yt(this,Fk).on("@connectionstatechange",(e=>{e!==Yt(this,Vk)&&(BS.debug(`connection state changed to ${e}`),Zt(this,Vk,e),"connected"===e&&(Zt(this,Gk,!0),this.observer.emit("connected")),"disconnected"===e&&(Zt(this,Gk,!1),this.observer.emit("disconnect")),("failed"===e||"closed"===e)&&(Zt(this,Gk,!1),this.observer.emit("close")),Yt(this,Lk)||this.safeEmit("connectionstatechange",e))})),Yt(this,Fk).on("@icecandidate",(({candidate:e})=>{Yt(this,Lk)||this.safeEmit("icecandidate",e)})),Yt(this,Fk).on("dc_open",(e=>{Zt(this,qk,!1),setTimeout((()=>{"events"===e&&!Yt(this,qk)&&this.safeEmit("dc_error",e)}),5e3)})),Yt(this,Fk).on("datachannel",((e,t)=>{var r,n;"events"===e.label&&Zt(this,qk,!0),Yt(this,Wk).has(e.label)||Yt(this,Wk).set(e.label,e);const i=JSON.parse(t);if(Yt(this,Yk).has(i.id)||Yt(this,Yk).set(i.id,[]),null==(r=Yt(this,Yk).get(i.id))||r.push(i),(null==(n=Yt(this,Yk).get(i.id))?void 0:n.length)===i.count){const t=Yt(this,Yk).get(i.id),r=null==t?void 0:t.reduce(((e,t)=>e+t.chunk),"");Yt(this,Yk).delete(i.id);try{const t=JSON.parse(r);this.safeEmit(`datachannel:${e.label}`,e,t)}catch(e){BS.error("error parsing message",{error:e})}}}))}get id(){return Yt(this,Nk)}get serverId(){return Yt(this,xk)}get connected(){return Yt(this,Gk)}get isConnected(){return Yt(this,$k)}get datachannels(){return Yt(this,Wk)}get eventsDCReady(){return Yt(this,qk)}get closed(){return Yt(this,Lk)}get direction(){return Yt(this,Uk)}get handler(){return Yt(this,Fk)}get connectionState(){return Yt(this,Vk)}get appData(){return Yt(this,Qk)}setServerId(e){Zt(this,xk,e)}getDatachannel(e){return Yt(this,Wk).get(e)}close(){Yt(this,Lk)||(BS.debug("close()"),Zt(this,Gk,!1),Zt(this,Lk,!0),Yt(this,Fk).close(),Array.from(Yt(this,Bk).values()).forEach((e=>{e.close(Mk).catch((()=>{}))})),Yt(this,Bk).clear(),Array.from(Yt(this,Hk).values()).forEach((e=>{e.close(Mk)})),Yt(this,Hk).clear(),Yt(this,Kk).clear(),Yt(this,zk).clear(),this.emit("close"),this.observer.emit("close"))}getStats(){return tr(this,null,(function*(){if(Yt(this,Lk))throw new Ck("closed");return Yt(this,Fk).getTransportStats()}))}connect(){return tr(this,null,(function*(){try{const{offerSdp:e,callback:t}=yield Yt(this,Fk).connect(),{answer:r}=yield this.safeEmitAsPromise("connect",{offer:e});if(yield t(r),!(yield this.isConnected))throw new Error("ice connection failed")}catch(e){throw BS.error("transport failed to connect:",e),e}}))}restartIce(){return tr(this,null,(function*(){if(BS.debug("restartIce()"),Yt(this,Lk))throw new Ck("closed");return Yt(this,Fk).restartIce()}))}updateIceServers(){return tr(this,arguments,(function*({iceServers:e}={}){if(BS.debug("updateIceServers()"),Yt(this,Lk))throw new Ck("closed");return Yt(this,Fk).updateIceServers(e)}))}produce(){return tr(this,arguments,(function*({track:e,encodings:t,codecOptions:r,stopTracks:n=!0,disableTrackOnPause:i=!0,zeroRtpOnPause:s=!1,appData:o={}}={}){if(BS.debug(`produce() [track:${e.id}]`),!e)throw new TypeError("missing track");if("send"!==Yt(this,Uk))throw new Rk("not a sending Transport");if("ended"===e.readyState)throw new Ck("track ended");if(0===this.listenerCount("connect")&&"new"===Yt(this,Vk))throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");if(!(yield this.isConnected))return Promise.reject(new Error("Transport not connected"));const{producerId:a,localId:c}=yield this.awaitQueue.push((()=>tr(this,null,(function*(){const{offerSdp:n,callback:s}=yield Yt(this,Fk).send({track:e,encodings:t,codecOption:r,screenShare:null==o?void 0:o.screenShare}),{answer:a,producerId:c}=yield this.safeEmitAsPromise("produce",{offer:n,kind:e.kind,paused:!!i&&!e.enabled,appData:o});return{producerId:c,localId:yield s(a)}}))),"producer"),d=new Ik({id:a,localId:c,track:e,stopTracks:n,disableTrackOnPause:i,zeroRtpOnPause:s,appData:o,handler:this.handler});return Yt(this,Bk).set(a,d),d.observer.on("close",(()=>{Yt(this,Bk).delete(d.id)})),this.emit("newproducer",d),this.observer.emit("newproducer",d),d}))}consumePeer(e){return tr(this,arguments,(function*(e,t={}){if(BS.debug(`consumePeer() producingPeerId: ${e}`),Yt(this,Lk))throw new Ck("closed");if("recv"!==Yt(this,Uk))throw new Rk("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing producingPeerId");if(0===this.listenerCount("connect")&&"new"===Yt(this,Vk))throw new TypeError('no "connect" listener set into this transport');if(t&&"object"!=typeof t)throw new TypeError("if given, appData must be an object");if(!(yield this.isConnected))return Promise.reject(new Error("Transport not connected"));const r=[],{consumersMap:n}=yield this.safeEmitAsPromise("consume_peer",{producingPeerId:e});return n.forEach(((n,i)=>{const{consumerId:s,trackId:o,screenShare:a,paused:c,streamId:d,kind:l}=n;r.push(Dk((r=>tr(this,null,(function*(){return r>0&&BS.warn("retrying consumer creation task:",{consumer:{id:s,kind:l,appData:{screenShare:a}}}),er(this,Xk,Zk).call(this,{consumerId:s,trackId:o,streamId:d,kind:l,producerId:i,producingPeerId:e,paused:c,screenShare:a,appData:t})})))))})),Ok(r)}))}consume(e){return tr(this,arguments,(function*({producerId:e,producingPeerId:t,appData:r={}}){if(BS.debug("consume()"),Yt(this,Lk))throw new Ck("closed");if("recv"!==Yt(this,Uk))throw new Rk("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing producerId");if(0===this.listenerCount("connect")&&"new"===Yt(this,Vk))throw new TypeError('no "connect" listener set into this transport');if(r&&"object"!=typeof r)throw new TypeError("if given, appData must be an object");if(!(yield this.isConnected))return Promise.reject(new Error("Transport not connected"));try{const{consumerId:n,screenShare:i,trackId:s,paused:o,streamId:a,kind:c}=yield this.safeEmitAsPromise("consume",{producerId:e,producingPeerId:t});return yield Dk((d=>tr(this,null,(function*(){return d>0&&BS.warn("retrying consumer creation task:",{consumer:{id:n,kind:c,appData:{screenShare:i}}}),er(this,Xk,Zk).call(this,{consumerId:n,screenShare:i,trackId:s,streamId:a,kind:c,paused:o,producerId:e,producingPeerId:t,appData:r})}))))}catch(e){throw BS.error("consume failed:",e),e}}))}setRemoteOffer(e){return tr(this,null,(function*(){yield er(this,eR,tR).call(this,e);const t=yield Yt(this,Fk).pc.createAnswer(),r=g.qg(t.sdp);return r.media=r.media.map((e=>{if("audio"===e.type){const t=$t({},e),r=t.fmtp.find((e=>111===e.payload));return r&&(r.config+=";stereo=1;sprop-stereo=1"),t.rtcpFb||(t.rtcpFb=[]),t.rtcpFb.some((e=>"nack"===e.type))||t.rtcpFb.push({payload:parseInt(t.payloads,10),type:"nack"}),t}return e})),t.sdp=g.M9(r),yield er(this,rR,nR).call(this,t),t}))}retryFailedConsumerCreationTasks(e){return tr(this,null,(function*(){return Ok(e.map((e=>tr(this,null,(function*(){return Dk((t=>tr(this,null,(function*(){return t>0&&BS.warn(`retrying failed consumer creation task: ${JSON.stringify(e)}`),er(this,Xk,Zk).call(this,$t({},e))}))))})))))}))}_ontrack(e){const{track:t,transceiver:r,streams:n}=e;BS.info(`track event received [trackId: ${t.id}]`);const i=`${n[0].id}:${t.kind}`;t.addEventListener("ended",(()=>{BS.info(`rtc consumer track ended [trackId: ${t.id}]`),Yt(this,Kk).delete(t.id),Yt(this,Jk).delete(i)})),Yt(this,Kk).set(t.id,[t,r]);const s=Yt(this,zk).get(i);s?(s(t,r),Yt(this,zk).delete(i)):(BS.warn(`track event handler not found ${i}`),Yt(this,Jk).set(i,e))}}Nk=new WeakMap,xk=new WeakMap,Lk=new WeakMap,Uk=new WeakMap,jk=new WeakMap,Fk=new WeakMap,Vk=new WeakMap,Bk=new WeakMap,Hk=new WeakMap,Wk=new WeakMap,Gk=new WeakMap,qk=new WeakMap,$k=new WeakMap,zk=new WeakMap,Jk=new WeakMap,Kk=new WeakMap,Qk=new WeakMap,Yk=new WeakMap,Xk=new WeakSet,Zk=function(e){return tr(this,arguments,(function*({consumerId:e,producerId:t,producingPeerId:r,streamId:n,trackId:i,paused:s,screenShare:o,appData:a,kind:c}){const d=`${n}:${c}`,l={consumerId:e,producerId:t,producingPeerId:r,streamId:n,trackId:i,appData:a,kind:c,paused:s,screenShare:o,name:"consumer creation task error",message:"consumer creation failed"};return new Promise(((n,i)=>{const u=setTimeout((()=>{Yt(this,zk).delete(d),l.isTimedout=!0,i(l)}),5e3),h=(d,h)=>{try{if("ended"===d.readyState)clearTimeout(u),i(l);else{const i=d;i.enabled=!0,this.handler.midTransceiverMap.set(h.mid,h);const l=new Ak({id:e,localId:h.mid,track:i,paused:s,producerId:t,producingPeerId:r,handler:Yt(this,Fk),appData:zt($t({},a),{screenShare:o}),reuseTrack:!0});Yt(this,Hk).set(e,l),l.once("close",(()=>{Yt(this,Hk).delete(l.id),this.handler.midTransceiverMap.delete(h.mid)})),BS.info("consumer created for ",{consumer:{id:e,kind:c,appData:{screenShare:o},peerId:r,producerId:t}}),this.observer.emit("newconsumer",l),clearTimeout(u),n(l)}}catch(e){BS.warn("error while creating consumer:",e),clearTimeout(u),i(l)}},p=Yt(this,Kk).get(e);if(2===(null==p?void 0:p.length))return void h(p[0],p[1]);const m=Yt(this,Jk).get(d);m?(Yt(this,Jk).delete(d),h(m.track,m.transceiver)):Yt(this,zk).set(d,h)}))}))},eR=new WeakSet,tR=function(e){return tr(this,null,(function*(){yield Yt(this,Fk).pc.setRemoteDescription(e)}))},rR=new WeakSet,nR=function(e){return tr(this,null,(function*(){BS.debug(`${this.direction}() {transportId: ${Yt(this,xk)}} | calling pc.setLocalDescription() [offer:${JSON.stringify(e)}]`),yield Yt(this,Fk).pc.setLocalDescription(e)}))};class oR{constructor({handlerName:e,handlerFactory:t}={}){if(Kt(this,"_handlerFactory"),Kt(this,"_handlerName"),Kt(this,"_observer"),BS.debug("constructor()"),e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)BS.debug(`Device::constructor() | handler given: ${e}`);else{if(e=function(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void BS.warn("Device::this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(BS.debug("Device::this._detectDevice() | ReactNative handler chosen"),"Chrome74");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)BS.warn("Device::this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=f().getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=110"}))return"Firefox110";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}})||t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}BS.warn("Device::this._detectDevice() | browser not supported")}}(),!e)throw new Error("device not supported");BS.debug(`Device::constructor() | detected handler: ${e}`)}switch(e){case"Chrome74":this._handlerFactory=bk.createFactory();break;case"Safari12":this._handlerFactory=kk.createFactory();break;case"Firefox60":this._handlerFactory=wk.createFactory({supportsSendEncodings:!1});break;case"Firefox110":this._handlerFactory=wk.createFactory({supportsSendEncodings:!0});break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const r=this._handlerFactory();this._handlerName=r.name,r.close(),this._observer=new nr}get handlerName(){return this._handlerName}createSendTransport({iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:n,appData:i,config:s}){return BS.debug("Device::createSendTransport()"),this._createTransport({direction:"send",iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:n,appData:i,config:s})}createRecvTransport({iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:n,appData:i}){return BS.debug("Device::createRecvTransport()"),this._createTransport({direction:"recv",iceServers:e,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:n,appData:i})}_createTransport({direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:i,appData:s,config:o}){const a=u(),c=new sR({id:a,direction:e,iceServers:t,iceTransportPolicy:r,additionalSettings:n,proprietaryConstraints:i,appData:s,handlerFactory:this._handlerFactory,config:o});return this._observer.emit("newtransport",c),c}}class aR{constructor(e){Xt(this,iR,void 0),Zt(this,iR,e)}joinRoom(e,t,r=!1,n=null){return tr(this,null,(function*(){const i={roomUuid:e,displayName:t,prejoined:r};return n&&(i.location=n),(yield Yt(this,iR).sendMessagePromiseWithTimeout({event:Zw.joinRoom,protobuf:TT.toBinary(i),timeout:5e3})).payload}))}connectTransport(e){return tr(this,null,(function*(){const t=(yield Yt(this,iR).sendMessagePromise(Zw.createWebRTCTransport,hT.toBinary(e))).payload,{transportId:r,description:n}=pT.fromBinary(t);return{transportId:r,answer:{sdp:null==n?void 0:n.sdp,type:n.type}}}))}produce(e){return tr(this,null,(function*(){var t,r;const n=(yield Yt(this,iR).sendMessagePromise(Zw.produce,kT.toBinary(e))).payload,i=qT.fromBinary(n);return{answer:{sdp:null==(t=null==i?void 0:i.description)?void 0:t.sdp,type:null==(r=null==i?void 0:i.description)?void 0:r.type},producerId:i.producerId}}))}consume(e){return tr(this,null,(function*(){const t=(yield Yt(this,iR).sendMessagePromise(Zw.consume,wT.toBinary(e))).payload,{consumerIdsMap:{map:r}}=GT.fromBinary(t);return r}))}closeProducer(e){return tr(this,null,(function*(){const t=(yield Yt(this,iR).sendMessagePromise(Zw.closeProducer,AT.toBinary(e))).payload,{description:r}=$T.fromBinary(t);return r}))}closeConsumer(e){return tr(this,null,(function*(){return(yield Yt(this,iR).sendMessagePromise(Zw.closeConsumer,PT.toBinary(e))).payload}))}hostControlForPeer(e,t){return tr(this,null,(function*(){const r={audio:"audio"===t,screeShare:!1,video:"video"===t,participantId:e},n=(yield Yt(this,iR).sendMessagePromise(Zw.hostControlPeer,NT.toBinary(r))).payload;if(!n)return!1;const{status:i}=KT.fromBinary(n);return"success"===i}))}hostControlForAll(e){return tr(this,null,(function*(){const t={audio:"audio"===e,screenShare:!1,video:"video"===e},r=(yield Yt(this,iR).sendMessagePromise(Zw.hostControlAllPeers,xT.toBinary(t))).payload;if(!r)return!1;const{status:n}=QT.fromBinary(r);return"success"===n}))}kickAll(){return tr(this,null,(function*(){const e=(yield Yt(this,iR).sendMessagePromise(Zw.kickAll,OT.toBinary({}))).payload;if(!e)return!1;const{status:t}=JT.fromBinary(e);return"success"===t}))}kickPeer(e){return tr(this,null,(function*(){const t=(yield Yt(this,iR).sendMessagePromise(Zw.kickPeer,DT.toBinary(e))).payload;if(!t)return!1;const{status:r}=zT.fromBinary(t);return"success"===r}))}changeDisplayName(e){return tr(this,null,(function*(){const t=(yield Yt(this,iR).sendMessagePromise(Zw.changeDisplayName,MT.toBinary(e))).payload;if(!t)return!1;const{status:r}=YT.fromBinary(t);return"success"===r}))}notifySelfJoinComplete(){return tr(this,null,(function*(){const e=(yield Yt(this,iR).sendMessagePromise(Zw.selfJoinComplete,ET.toBinary({}))).payload;return HT.fromBinary(e)}))}}iR=new WeakMap;const cR=Error("task execution aborted");class dR{constructor(e,t){Kt(this,"id"),Kt(this,"executor"),Kt(this,"cancel"),this.id=e,this.executor=t}execute(){return tr(this,null,(function*(){return new Promise(((e,t)=>{this.cancel=()=>t(cR),this.executor.then((t=>e(t)))}))}))}}let lR=0;const uR=new Map;class hR{static execute(e){const t=lR;lR+=1;const r=new dR(t,e);return uR.set(t,r),{id:t,value:r.execute().finally((()=>uR.delete(t)))}}static stop(e){const t=uR.get(e);t&&(t.cancel(),uR.delete(e))}}class pR extends Sk{constructor(e){super(),Kt(this,"_device"),Kt(this,"_sendTransport"),Kt(this,"_recvTransport"),Kt(this,"_consumers"),Kt(this,"_producers"),Kt(this,"_producerStatus"),Kt(this,"_producerIdToConsumerIdMap"),Kt(this,"_socket"),Kt(this,"_socketHandler"),Kt(this,"_totalTransportReconnectionCount"),Kt(this,"_transportReconnectFailureCount"),Kt(this,"_consumerCreationFailureCount"),Kt(this,"_producerNotReadyFailureCount"),Kt(this,"_consumerNotBoundFailureCount"),Kt(this,"_transportDisconnectedTimer"),Kt(this,"transportConnectionStatus"),this._device=new oR({}),this._socket=e,this._socketHandler=new aR(e),this.reset()}get socket(){return this._socket}get producers(){return this._producers}get consumers(){return this._consumers}get producerIdToConsumerIdMap(){return this._producerIdToConsumerIdMap}get hiveSocketHandler(){return this._socketHandler}get sendTransport(){return this._sendTransport}get recvTransport(){return this._recvTransport}reset(){this._producers=new Map,this._consumers=new Map,this._producerStatus=new Map,this._producerIdToConsumerIdMap=new Map,this.transportConnectionStatus=new Map,this._transportReconnectFailureCount=0,this._consumerCreationFailureCount=0,this._totalTransportReconnectionCount=0,this._producerNotReadyFailureCount=0,this._consumerNotBoundFailureCount=0,this._transportDisconnectedTimer={consuming:void 0,producing:void 0}}setupTransports(e,t){return tr(this,null,(function*(){const r=yield $w().getICEServers().catch((e=>(BS.warn(`failed to get iceservers from server: ${e.message}`),[]))),n=e.map((e=>{var n,i,s,o,a,c;const d=this.transportConnectionStatus.get(e);if(d&&!t)return d;switch(d&&t&&hR.stop(d.id),e){case"send":{const t=hR.execute(this.createSendTransport({iceServers:r,config:{enableHighBitrate:null!=(s=null==(i=null==(n=td.defaults.mediaConfiguration)?void 0:n.audio)?void 0:i.enableHighBitrate)&&s,enableStereo:null!=(c=null==(a=null==(o=td.defaults.mediaConfiguration)?void 0:o.audio)?void 0:a.enableStereo)&&c}}));return this.transportConnectionStatus.set(e,t),t.value}case"recv":{const t=hR.execute(this.createRecvTransport({iceServers:r}));return this.transportConnectionStatus.set(e,t),t.value}default:return BS.warn(`What are you thinking when passing this transportType: ${e}?`,{transport:{type:e}}),Promise.reject(Error("TYPE_OF_TRANSPORT_UNKNOWN"))}}));return Promise.all(n).finally((()=>{e.forEach((e=>{this.transportConnectionStatus.delete(e)}))}))}))}stopAllTransports(){var e,t,r,n;BS.info(" closing all the transports"),null==(e=this._sendTransport)||e.close(),null==(t=this._sendTransport)||t.removeAllListeners(),null==(r=this._recvTransport)||r.close(),null==(n=this._recvTransport)||n.removeAllListeners(),this._sendTransport=void 0,this._recvTransport=void 0,this.reset()}createSendTransport(e){return tr(this,null,(function*(){var t,r,n,i,s,o,a;if(this._sendTransport&&this._sendTransport.connected)return void BS.info("sendTransport::already_exists_in_connected_state",{transport:{id:null==(t=this._sendTransport)?void 0:t.id,type:"send"}});BS.info("sendTransport::initializing_transport",{transport:{id:null==(r=this._sendTransport)?void 0:r.id,type:"send"}});const c=this._device.createSendTransport(e);this._transportDisconnectedTimer.producing=void 0,BS.info("sendTransport::initialized_transport",{transport:{id:null==(n=this._sendTransport)?void 0:n.id,type:"send"}}),this.handleTransport(c,!1),BS.info("sendTransport::connecting_transport",{transport:{id:null==(i=this._sendTransport)?void 0:i.id,type:"send"}});try{yield Dk(((e,t)=>tr(this,null,(function*(){this.socket.isConnected||t(new Error("socket is not connected")),"closed"===c.connectionState&&t(new Error("transport is closed")),e>0&&BS.debug(`retrying transport connect, count: ${e}`,{transport:{id:c.id,type:"send"}});try{yield c.connect()}catch(e){throw BS.error(`failed to connect send transport: ${c.id}`,{error:e,transport:{id:c.id,type:"send"}}),"ice connection failed"===e.message&&t(e),e}}))),{delayTime:100,strategy:"exponential",maxRetryCount:In.hasFeature(DS.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),BS.info("sendTransport::connected_transport",{transport:{id:null==(s=this._sendTransport)?void 0:s.id,serverId:null==(o=this._sendTransport)?void 0:o.serverId,type:"send"}}),this._transportReconnectFailureCount=Math.max(0,this._transportReconnectFailureCount-1),this._producerNotReadyFailureCount=0,this._sendTransport=c,gn.onSafeInitialization((()=>{gn.configureSendTransport(c)}))}catch(e){throw BS.error(`failed to connect send transport after retry:${c.id}`,{error:e,transport:{id:null==(a=this._sendTransport)?void 0:a.id,type:"send"}}),c.close(),c.removeAllListeners(),this._transportReconnectFailureCount+=1,this.handleFailure(),e}}))}createRecvTransport(e){return tr(this,null,(function*(){var t,r;if(this._recvTransport&&this._recvTransport.connected)return void BS.info("recvTransport::already_exists_in_connected_state",{transport:{id:null==(t=this._recvTransport)?void 0:t.id,type:"recv"}});BS.info("recvTransport::initializing_transport",{transport:{id:null==(r=this._recvTransport)?void 0:r.id,type:"recv"}});const n=this._device.createRecvTransport(zt($t({},e),{additionalSettings:{rtcAudioJitterBufferMaxPackets:25,rtcAudioJitterBufferFastAccelerate:!0,rtcAudioJitterBufferMinDelayMs:20}}));this._transportDisconnectedTimer.consuming=void 0,BS.info("recvTransport::initialized_transport",{transport:{id:null==n?void 0:n.id,type:"recv"}}),this.handleTransport(n,!0),BS.info("recvTransport::connecting_transport",{transport:{id:null==n?void 0:n.id,type:"recv"}});try{yield Dk(((e,t)=>tr(this,null,(function*(){this.socket.isConnected||t(new Error("socket is not connected")),"closed"===n.connectionState&&t(new Error("transport is closed")),e>0&&BS.debug(`retrying transport connect, count: ${e}`,{transport:{id:null==n?void 0:n.id,type:"recv"}});try{yield n.connect()}catch(e){throw BS.error(`fail to connect recv transport: ${n.id}`,{error:e,transport:{id:null==n?void 0:n.id,type:"recv"}}),"ice connection failed"===e.message&&t(e),e}}))),{delayTime:100,strategy:"exponential",maxRetryCount:In.hasFeature(DS.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),BS.info("recvTransport::connected_transport",{transport:{id:null==n?void 0:n.id,serverId:null==n?void 0:n.serverId,type:"recv"}}),this._transportReconnectFailureCount=Math.max(0,this._transportReconnectFailureCount-1),this._consumerCreationFailureCount=0,this._consumerNotBoundFailureCount=0,this.producerIdToConsumerIdMap.clear(),this._recvTransport=n,gn.onSafeInitialization((()=>{gn.configureRecvTransport(n)}))}catch(e){throw BS.error(`failed to connect recv transport after retry:${n.id}`,{error:e,transport:{id:null==n?void 0:n.id,type:"recv"}}),n.close(),n.removeAllListeners(),this._transportReconnectFailureCount+=1,this.handleFailure(),e}}))}handleTransport(e,t){e.on("connect",((r,n,i)=>tr(this,[r,n,i],(function*({offer:r},n,i){try{const i={consuming:t,description:{sdp:r.sdp,type:r.type,target:t?dT.SUBSCRIBER:dT.PUBLISHER}},{transportId:s,answer:o}=yield this._socketHandler.connectTransport(i);e.setServerId(s),n({answer:o})}catch(r){BS.error((t?"consumer":"producer")+" transport connection error:",{error:r,transport:{id:null==e?void 0:e.id,type:t?"recv":"send"}}),i(r)}})))),e.on("connectionstatechange",(r=>tr(this,null,(function*(){BS.info((t?"consumer":"producer")+" transport connectionState:",{transport:{id:null==e?void 0:e.id,type:t?"recv":"send",status:r}});const n=()=>{void 0!==this._transportDisconnectedTimer[t?"consuming":"producing"]&&(clearTimeout(this._transportDisconnectedTimer[t?"consuming":"producing"]),this._transportDisconnectedTimer[t?"consuming":"producing"]=void 0)};switch(r){case"connected":n();break;case"disconnected":this._transportDisconnectedTimer[t?"consuming":"producing"]=setTimeout((()=>{this.triggerTransportReconnection(e,t)&&tT.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:r,transportDirection:t?"recv":"send"})}),2e3);break;case"failed":if(e.closed)return;n(),this.triggerTransportReconnection(e,t)||tT.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:r,transportDirection:t?"recv":"send"});break;case"new":case"closed":break;default:tT.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:r,transportDirection:t?"recv":"send"})}})))),e.on("icecandidate",(e=>tr(this,null,(function*(){BS.debug("sending icecandidate:",{iceCandidate:e})})))),e.on("datachannel:events",((t,r)=>tr(this,null,(function*(){var n,i;BS.debug("got data channel message on event:",{rtcChannel:{label:t.label,message:r}});try{switch(r.type){case"offer":this.negotiateOverDC(r.payload,t,e);break;case"handshake":t.send(JSON.stringify({type:"handshake",payload:{message:"pong"}}));break;case"consumer_toggle":this.handleConsumerToggle(r.payload);break;case"hub-disconnect":BS.debug(`media hub disconnected, full_reconnect: ${null==(n=r.payload)?void 0:n.full_reconnect}`),!0===(null==(i=r.payload)?void 0:i.full_reconnect)&&this.emit("rejoin");break;case"error":this.handleErrorOverDC(r.payload);break;default:BS.warn(`unknown event received from hive node, event: ${r.type}`)}}catch(e){BS.error(`Unable to handle the incoming datachannel message on channel ${t.label}`)}})))),e.on("dc_error",(()=>{"recv"===e.direction&&(BS.warn("events datachannel did not open in 5s"),this.handleFailure())})),e.on("negotiate",((t,r,n)=>tr(this,[t,r,n],(function*({description:t},r,n){try{const n={sdp:null==t?void 0:t.sdp,type:null==t?void 0:t.type};r({answer:yield this.negotiate(e,n)})}catch(t){BS.error("negotiate error:",{transport:{id:e.id,type:e.direction},error:t}),n(t)}})))),t?(e.on("datachannel:negotiation",((t,r)=>tr(this,null,(function*(){try{BS.info("datachannel message recieved:",{rtcChannel:{label:t.label,messageStringified:r}});const n={sdp:r,type:"offer"},i=yield e.setRemoteOffer(n);BS.info("datachannel answer:",{transport:{id:e.id,status:e.connectionState,remoteOfferAnswer:i}}),t.send(i.sdp)}catch(e){BS.error("datachannel:negotiation::Error:",{error:e})}})))),e.on("consume_peer",((e,t,r)=>tr(this,[e,t,r],(function*({producingPeerId:e},t,r){BS.info("consumePeer:",e);const n={producingPeerId:e};try{const r=yield this._socketHandler.consume(n);BS.debug(`consumePeer response for ${e}:`,{consumerStateMap:r});const i=new Map;Object.entries(r).forEach((([e,t])=>{var r,n,s;i.set(e,{consumerId:t.consumerId,trackId:null==(r=t.producerTrack)?void 0:r.trackId,streamId:t.producerTrack.streamId,kind:t.producerState.kind===lT.VIDEO?"video":"audio",screenShare:null==(n=t.producerState)?void 0:n.screenShare,paused:null==(s=t.producerState)?void 0:s.pause})})),t({consumersMap:i})}catch(e){BS.error("consumePeer error:",{error:e}),r(e)}})))),e.on("consume",((e,t,r)=>tr(this,[e,t,r],(function*({producerId:e,producingPeerId:t},r,n){var i,s,o,a,c,d,l,u;const h={producingPeerId:t,producerId:e};try{const t=(yield this._socketHandler.consume(h))[e];BS.info("consumer create response:",{consumer:{remotelyPaused:null==(i=t.producerState)?void 0:i.pause,producerId:null==(s=t.producerState)?void 0:s.producerId,kind:null==(a=null==(o=t.producerState)?void 0:o.kind)?void 0:a.toString(),appData:{screenShare:null==(c=t.producerState)?void 0:c.screenShare},id:t.consumerId},consumerState:t}),r({consumerId:t.consumerId,screenShare:null==(d=t.producerState)?void 0:d.screenShare,trackId:null==(l=t.producerTrack)?void 0:l.trackId,streamId:t.producerTrack.streamId,kind:t.producerState.kind===lT.VIDEO?"video":"audio",paused:null==(u=t.producerState)?void 0:u.pause})}catch(e){BS.error("error during consuming on server:",e),n(e)}}))))):e.on("produce",((e,t,r)=>tr(this,[e,t,r],(function*({offer:e,kind:t,paused:r,appData:n},i,s){var o;const a=g.qg(e.sdp).media.filter((e=>"video"===t?"video"===e.type:"audio"===e.type)).at(-1).msid,c={description:{sdp:e.sdp,type:e.type,target:dT.PUBLISHER},paused:r,kind:t,msid:a,screenShare:null!=(o=n.screenShare)&&o};try{const{answer:e,producerId:t}=yield this._socketHandler.produce(c);i({answer:e,producerId:t})}catch(e){BS.error("create producer error:",e),s(e)}}))))}createProducer(e,t,r){return tr(this,null,(function*(){if(void 0===this._sendTransport||this._sendTransport.closed)return null;BS.info("createProducer::initializing_producer",{producer:{id:"TO_BE_CREATED",kind:e,status:"initializing",appData:null==t?void 0:t.appData}});const n=this._producerStatus.get(e);if((null==n?void 0:n.trackId)===t.track.id&&(null==n?void 0:n.status)===_k.INITIALIZING)return BS.info("createProducer::producer getting initializing",{producer:{id:"GETTING_CREATED",status:"initializing",kind:e,appData:null==t?void 0:t.appData}}),null;this._producerStatus.set(e,{trackId:t.track.id,status:_k.INITIALIZING});try{const n=yield this._sendTransport.produce(t);return BS.info("createProducer::initialized_producer",{producer:{id:null==n?void 0:n.id,kind:e,status:"producing",appData:null==t?void 0:t.appData}}),n.on("close",((i,s)=>tr(this,[i,s],(function*({offer:i,reason:s},o){BS.info("producer::closing",{debuggingHint:s,producer:{id:null==n?void 0:n.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}});const a={producerId:n.id,description:{sdp:i.sdp,type:i.type,target:dT.PUBLISHER}};try{const e=yield this._socketHandler.closeProducer(a);o({answer:{sdp:null==e?void 0:e.sdp,type:null==e?void 0:e.type}})}catch(e){BS.error("producer close error",e)}BS.info("producer::closed",{producer:{id:null==n?void 0:n.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),this._producerStatus.delete(e),this._producers.delete(e),r(),this.reconfigureWebcamLayers()})))),n.on("trackended",(()=>{BS.info("producer::trackended",{producer:{id:null==n?void 0:n.id,kind:e,status:"UNKNOWN",appData:null==n?void 0:n.appData}}),[RS.MIC,RS.WEBCAM].includes(e)||r()})),this._producers.set(e,n),this._producerStatus.set(e,{trackId:t.track.id,status:_k.INITIALIZED}),this.reconfigureWebcamLayers(),n.track}catch(r){throw this._producerStatus.set(e,{status:_k.NOT_INITIALIZED,trackId:t.track.id}),BS.error("createProducer::transport_initialization_failed",{producer:{id:"FAILED_TO_CREATE",kind:e,status:"failed",appData:null==t?void 0:t.appData}}),r}}))}reconfigureWebcamLayers(){return tr(this,null,(function*(){if(!In.hasFeature(DS.DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE))return;const e=this.producers.get(RS.WEBCAM);e&&(yield this._switchProducerSpatialLayer(e,this.producers.get(RS.SCREENSHARE_VIDEO)?0:3))}))}_switchProducerSpatialLayer(e,t){return tr(this,null,(function*(){try{BS.debug("switching layer of webcam producer to:",{media:{video:{layer:t}},producer:{id:e.id,kind:e.kind,appData:e.appData}}),yield e.setMaxSpatialLayer(t)}catch(e){BS.error("failed to switch spatial layer",{error:e})}}))}_initConsumer(e){e&&(e.observer.on("close",(t=>tr(this,null,(function*(){BS.debug("consumer closed",{consumer:{closureReason:t,id:e.id,kind:e.kind,appData:e.appData}}),this._consumers.delete(e.id),tT.emit(XS.CONSUMER_CLOSED,{id:e.id})})))),this._consumers.set(e.id,e),this.producerIdToConsumerIdMap.set(e.producerId,e.id),tT.emit(XS.NEW_CONSUMER,{id:e.id}))}consumePeer(e){return tr(this,null,(function*(){if(void 0===this._recvTransport||this._recvTransport.closed||!this._recvTransport.connected)throw Error("Receiving transport not connected");yield Dk((t=>tr(this,null,(function*(){t>0&&BS.debug(`retrying consumePeer call, retryCount: ${t}`);try{const t=yield this._recvTransport.consumePeer(e),r=[];t.forEach((e=>{"rejected"===e.status?r.push(e.reason):this._initConsumer(e.value)})),this._recvTransport.retryFailedConsumerCreationTasks(r).then((e=>{e.forEach((e=>{"rejected"===e.status?(BS.error("consumer creation task is failing",e.reason),this._consumerCreationFailureCount+=1,setTimeout(this.handleFailure.bind(this),0)):this._initConsumer(e.value)}))}))}catch(e){throw BS.error("got error in consumePeer",e),e}})))).catch((e=>{BS.error("consumePeer failed after retries",e),this._consumerCreationFailureCount+=1,this.handleFailure()}))}))}createConsumer(e){return tr(this,null,(function*(){if(void 0===this._recvTransport||this._recvTransport.closed||!this._recvTransport.connected)return;const{producerId:t,producingPeerId:r,appData:n}=e,i=this.getProducer(t);i?BS.warn("why are you creating a consumer for local producer?"):yield Dk((e=>tr(this,null,(function*(){e>0&&BS.debug(`retrying createConsumer call, retryCount: ${e}`);const i=yield this._recvTransport.consume({producerId:t,producingPeerId:r,appData:zt($t({},n),{peerId:r})});this._initConsumer(i)})))).catch((e=>{BS.error("createConsumer failed after retries",{producer:{id:t,kind:null==i?void 0:i.kind,appData:n},error:e}),this._consumerCreationFailureCount+=1,this.handleFailure()}))}))}pauseProducer(e){return tr(this,null,(function*(){const t=this._producers.get(e);t?(t.pause(),BS.info(`Paused the producer of type: ${t.kind}`,{producer:{id:t.id,kind:t.kind,appData:t.appData}})):BS.warn(`producer type: ${e} not found`)}))}resumeProducer(e){return tr(this,null,(function*(){const t=this._producers.get(e);t?(t.resume(),BS.info(`Resumed the producer of type: ${t.kind}`,{producer:{id:t.id,kind:t.kind,appData:t.appData}})):BS.warn(`producer type: ${e} not found`)}))}replaceTrack(e,t){return tr(this,null,(function*(){const r=this._producers.get(e);r?(yield r.replaceTrack({track:t}),BS.info(`Replaced track for the producer of type: ${r.kind}`,{producer:{id:r.id,kind:r.kind,appData:r.appData,trackId:t.id}})):BS.warn(`producer type: ${e} not found`)}))}removeProducer(e,t){return tr(this,null,(function*(){const r=this._producers.get(e);r?(t&&r.track.stop(),yield this.sendTransport.awaitQueue.push(r.close.bind(r),"producer").catch((e=>{BS.error("failed to close producer on server",e)}))):BS.warn(`producer type: ${e} not found`)}))}pauseConsumer(e){return tr(this,null,(function*(){const t=this._consumers.get(e);t?(this.toggleConsumerOverDC(e,!0),BS.info(`Paused the consumer of type: ${t.kind}`,{consumer:{id:t.id,kind:t.kind,appData:t.appData}})):BS.warn(`consumer with id: ${e} not found`)}))}pauseConsumerOverSocket(e){return tr(this,null,(function*(){try{const t={consumerId:e.id,pause:!0};yield this.socket.sendMessagePromise(Zw.toggleConsumer,IT.toBinary(t)),e.pause(),tT.emit(XS.CONSUMER_PAUSED,{id:e.id}),BS.info(`Paused the consumer of type: ${e.kind} over socket`,{consumer:{id:e.id,kind:e.kind,appData:e.appData}})}catch(t){BS.error("error on pausing consumer",{error:t,consumer:{id:e.id,kind:e.kind,appData:e.appData}})}}))}toggleConsumerOverDC(e,t){return tr(this,null,(function*(){const r={type:"consumer_toggle",payload:{consumerId:e,mute:t}},n=this._recvTransport.getDatachannel("events");n?n.send(JSON.stringify(r)):BS.warn("recvTransport:: events datachannel not found")}))}resumeConsumer(e){return tr(this,null,(function*(){const t=this._consumers.get(e);if(t)if(t.paused)try{const r={consumerId:e,pause:!1};yield this.socket.sendMessagePromise(Zw.toggleConsumer,IT.toBinary(r)),t.resume(),tT.emit(XS.CONSUMER_RESUMED,{id:t.id}),BS.info(`Resumed the consumer of type: ${t.kind}`,{consumer:{id:t.id,kind:t.kind,appData:t.appData}})}catch(e){BS.error("error on resuming consumer",e)}else BS.warn(`consumer with id:${e} is not paused so not resuming`);else BS.warn(`consumer with id: ${e} not found`)}))}closeConsumer(e,t){return tr(this,null,(function*(){return this.closeConsumers([e],t)}))}closeConsumers(e,t=!1){return tr(this,null,(function*(){BS.info(`Closing consumers: ${JSON.stringify(e)} with force: ${t}`);let r=!0;const n=e.filter((e=>!!this._consumers.get(e)||(BS.warn(`consumer with id: ${e} not found`),!1))),i={consumerIds:n},s=()=>tr(this,null,(function*(){var e;return null==(e=this._recvTransport)?void 0:e.awaitQueue.push((()=>tr(this,null,(function*(){yield this._socketHandler.closeConsumer(i)}))),"close_consumer").catch((e=>{BS.warn("error on closing consumer:",{error:e}),r=t}))}));t?s():yield s(),r&&n.forEach((e=>{const r=this.consumers.get(e);this.producerIdToConsumerIdMap.delete(r.producerId),r.close(t?"force closed":void 0)}))}))}cleanupConsumers(e){return tr(this,null,(function*(){BS.debug("cleaning up all consumers");const t=[];this._consumers.forEach((r=>{e?r.peerId===e&&t.push(r.id):t.push(r.id)})),this.closeConsumers(t,!0)}))}stopAllProducers(){return tr(this,null,(function*(){BS.info("stopping all available producers"),this._producers.forEach(((e,t)=>{BS.debug(`closing producer type: ${t}`,{producer:{id:null==e?void 0:e.id,kind:e.kind,appData:e.appData}}),e.close()}))}))}getProducer(e){return Array.from(this.producers.values()).filter((t=>t.id===e)).at(0)}hasProducer(e){return void 0!==this.getProducer(e)}negotiate(e,t){return tr(this,null,(function*(){BS.debug(`setting remote offer : ${JSON.stringify(t)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}});const r=yield e.setRemoteOffer(t),n={transportId:e.serverId,description:{sdp:r.sdp,type:r.type,target:dT.SUBSCRIBER}};return BS.debug(`sending renegotiate request: ${JSON.stringify(n)} on ${e.direction} transport`,{transport:{id:e.id,serverId:e.serverId,type:e.direction}}),yield this.socket.sendMessagePromise(Zw.renegotiateSessionDescription,mT.toBinary(n)),BS.info("renegotiation done",{transport:{serverId:e.serverId}}),r}))}negotiateOverDC(e,t,r){return tr(this,null,(function*(){const n={sdp:e.sdp,type:"offer"};let i;try{const e=yield r.setRemoteOffer(n);i={type:"answer",payload:{type:e.type,sdp:e.sdp}}}catch(e){BS.error("datachannel:events::Error:",e),i={type:"error",payload:{error:e.message}}}BS.debug(`datachannel answer: ${JSON.stringify(i)}`),t.send(JSON.stringify(i))}))}handleConsumerToggle(e){const{mute:t,trackId:r}=e;BS.info(`consumer toggled for trackId: ${r} muted: ${t}`);const n=this.consumers.get(r);n?n.paused!==t&&(BS.debug("consumer state is not same",{consumer:{id:n.id,remotelyPaused:n.paused}}),t?(n.pause(),tT.emit(XS.CONSUMER_PAUSED,{id:n.id})):(n.resume(),tT.emit(XS.CONSUMER_RESUMED,{id:n.id}))):BS.warn(`consumer with trackId: ${r} not found`)}handleErrorOverDC(e){return tr(this,null,(function*(){BS.error(`got error over dc: ${JSON.stringify(e)}`);const{type:t,error:r,id:n}=e;if("consumer"===t){if("bind-fail"===r){if(this._consumerNotBoundFailureCount>=2)return void this.handleFailure();this._consumerNotBoundFailureCount+=1;const e=this.consumers.get(n);if(!e)return;try{yield this.closeConsumer(e.id),yield this.createConsumer({producerId:e.producerId,producingPeerId:e.peerId,appData:e.appData})}catch(t){BS.error("failed to recreate consumer on downtrack bound failure,",{consumer:{id:e.id,producerId:e.producerId,kind:e.kind,appData:e.appData}})}}}else if("producer"===t)if("ready-fail"===r){if(this._producerNotReadyFailureCount>=2)return void this.handleFailure();this._producerNotReadyFailureCount+=1;const[e]=Array.from(this.producers.entries()).find((e=>e[1].id===n));if(!e)return;yield this.removeProducer(e).catch((t=>{BS.error("failed to remove ready-fail producer:",{error:t,producer:{id:n,kind:e,appData:null}})}))}else"general-failure"===r&&this.emit("reconnect_transport",this._sendTransport)}))}handleFailure(){return tr(this,null,(function*(){var e;if(this._transportReconnectFailureCount>0||!1===(null==(e=this._recvTransport)?void 0:e.eventsDCReady)||this._totalTransportReconnectionCount>3)return BS.warn("transport failure detected"),void(In.hasFeature(DS.ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY)&&(BS.debug("rejoining room"),this.emit("rejoin")));(this._consumerCreationFailureCount>0||this._consumerNotBoundFailureCount>=2)&&(BS.warn("consumer creation failure detected or consumer not bound failure increased"),In.hasFeature(DS.ENABLE_HIVE_EXPERIMENTAL_FAIL_RECOVERY)&&(BS.debug("reconnecting recv transport"),this._totalTransportReconnectionCount+=1,this.emit("reconnect_transport",this._recvTransport))),this._producerNotReadyFailureCount>=2&&(BS.warn("producer receiver not getting added needs to reconnect send transport"),this._totalTransportReconnectionCount+=1,this.emit("reconnect_transport",this._sendTransport))}))}triggerTransportReconnection(e,t){return BS.info("triggerTransportReconnection:: reconnecting transport",{transport:{type:e.direction,id:e.id,serverId:e.serverId}}),!!In.hasFeature(DS.ENABLE_HIVE_TRANSPORT_RECONNECTION_ON_ICE_FAILED)&&(tT.emit(XS.HIVE_TRANSPORT_STATE_CHANGED,{state:"reconnecting",transportDirection:t?"recv":"send"}),this.emit("reconnect_transport",e),!0)}switchConsumersToLayer(e,t){return tr(this,null,(function*(){const r=this._recvTransport.getDatachannel("events");if(!r)return void BS.warn("events datachannel not found");const n={type:"switch_consumer_layer",payload:{consumerIds:e,layer:t}};r.send(JSON.stringify(n))}))}}var mR=Object.defineProperty,fR=Object.getOwnPropertyDescriptor,gR=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?fR(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&mR(t,r,s),s};const vR={joinAttempted:!1};var yR,_R,SR,TR,ER,bR,wR,kR,RR,CR,IR,AR,PR;const DR=(PR=class extends rk{constructor(e){super(),Xt(this,yR,void 0),Xt(this,_R,void 0),Xt(this,SR,void 0),Xt(this,TR,void 0),Xt(this,ER,void 0),Xt(this,bR,void 0),Xt(this,wR,void 0),Xt(this,kR,void 0),Xt(this,RR,void 0),Xt(this,CR,void 0),Xt(this,IR,void 0),Xt(this,AR,void 0),Kt(this,"legacyMode"),Kt(this,"roomNodeUrl"),Kt(this,"peerDisplayName"),Kt(this,"activatedProducingPeerIds");const{roomName:t,peerId:r,authToken:n,legacyMode:i,socketClient:s,meetingTitle:o}=e;this.roomName=t,this.peerId=r,this.authToken=n,this.legacyMode=i,this.roomJoined=!1,this.mediaConnected=!!s.isConnected,this.meetingTitle=o,Zt(this,TR,!1),Zt(this,yR,s),Zt(this,_R,new pR(s)),this.maxPreferredStreams=6,this.activatedProducingPeerIds=new Set,Zt(this,IR,new Set),Zt(this,ER,!1),Zt(this,bR,0),Zt(this,wR,new rc),gn.legacySwitch(i),this.handleSocketEvents(),this.handleSFUEvents(),this.handleCallstatsEvents(),Zt(this,SR,(()=>{BS.info("HiveNodeClient::noop reconnection handler")})),Zt(this,kR,Qp((()=>{Zt(this,TR,!0),this.reset(),Yt(this,wR).push((()=>this._joinRoom(this.peerDisplayName,this.roomUUID,{},!0,Yt(this,AR))),"joinRoom").then((()=>{tT.emit(XS.HIVE_ROOM_REJOINED)})).catch((()=>{tT.emit(XS.HIVE_ROOM_REJOIN_FAILED)}))}),5e3,{leading:!0,maxWait:1e3})),Zt(this,RR,Qp((e=>tr(this,null,(function*(){e.close(),e.removeAllListeners(),yield this.sfuHandler.setupTransports(["send"]),BS.info("send transport reconected!"),tT.emit(XS.RESET_PRODUCER_STATE)}))),1e3)),Zt(this,CR,Qp((e=>tr(this,null,(function*(){e.close(),e.removeAllListeners(),yield this.sfuHandler.setupTransports(["recv"]),BS.info("recv transport reconnected!"),this.activatedProducingPeerIds=new Set,tT.emit(XS.REFRESH_GRID,!0)}))),1e3))}static init(e){return tr(this,null,(function*(){const{legacyMode:t=!0,roomName:r,peerId:n,authToken:i,meetingTitle:s,socket:o}=e,a=new DR({legacyMode:t,authToken:i,socketClient:o,peerId:n,roomName:r,meetingTitle:s});o.onStateEvent("disconnected",(e=>{var t;a.isDisconnected=!0,null==(t=Yt(a,_R))||t.cleanupConsumers(),a.mediaConnected=o.isConnected,tT.emit(XS.ROOM_NODE_DISCONNECTED,e),a.roomJoined=!1,a.activatedProducingPeerIds=new Set,BS.info("HiveNodeClient::HIVE_NODE_DISCONNECTED")})),o.onStateEvent("reconnected",(()=>tr(this,null,(function*(){a.mediaConnected=o.isConnected}))));const c=e=>{a.mediaConnected=o.isConnected,tT.emit(XS.ROOM_NODE_CONNECTED,zt($t({},e),{wasDisconnected:a.isDisconnected,wasJoinAttempted:vR.joinAttempted})),a.isDisconnected=!1,BS.info("HiveNodeClient::HIVE_NODE_CONNECTED")};return o.onStateEvent("connected",(e=>tr(this,null,(function*(){c(e)})))),o.isConnected&&c({}),a}))}get sfuHandler(){return Yt(this,_R)}set onSocketReconnection(e){Zt(this,SR,e)}get rejoinRoom(){return Yt(this,kR)}reset(){Yt(this,IR).clear(),this.activatedProducingPeerIds.clear(),Yt(this,wR).stop(),this.sfuHandler.stopAllTransports(),this.sfuHandler.reset(),Zt(this,wR,new rc)}reconnectTransport(e){return tr(this,null,(function*(){BS.info(`HiveNodeClient::Room joining state: ${Yt(this,TR)}`),e&&!Yt(this,TR)&&("send"===e.direction?yield Yt(this,RR).call(this,e):yield Yt(this,CR).call(this,e))}))}setupTransports(e=!1){return tr(this,null,(function*(){yield Yt(this,_R).setupTransports(["recv","send"],e)}))}joinRoom(e,t,r,n){return tr(this,arguments,(function*(e,t,r,n,i={}){vR.joinAttempted=!0,Zt(this,TR,!0),this.reset();const s=$w().ipInfo;if(null!=s&&s.loc){const e=s.loc.split(",");Zt(this,AR,{latitude:parseFloat(e[0]),longitude:parseFloat(e[1])})}return Yt(this,wR).push((()=>this._joinRoom(e,r,i,!1,Yt(this,AR))),"joinRoom")}))}_joinRoom(e,t){return tr(this,arguments,(function*(e,t,r={},n=!1,i=null){this.peerDisplayName=e;try{return yield Dk(((r,s)=>(Yt(this,yR).isConnected||s(new Error("socket is not connected")),r>0&&BS.warn(`retrying sending join room request, count: ${r}`),this.sfuHandler.hiveSocketHandler.joinRoom(t,e,n,i).catch((e=>{throw BS.error("failed to send join room request, error:",{error:e}),e})))),{delayTime:1e3,strategy:"exponential",maxRetryCount:In.hasFeature(DS.ENABLE_HIVE_INFINITE_RETRIES)?1/0:3}),yield this.setupTransports(!0),In.hasFeature(DS.INTERNAL_CALL_STATS)&&"ReactNative"!==navigator.product&&setTimeout((()=>tr(this,null,(function*(){var n;const i=yield $w().getUserDetails(),s=Sw.isV2AuthToken?i.participant:i,o={userId:null!=(n=s.id)?n:s.participant.id,peerId:this.peerId,displayName:e,roomUUID:t,roomViewType:"groupCall",roomName:this.roomName,deviceInfo:zt($t({},_S.getDeviceInfo()),{userAgent:navigator.userAgent,memory:navigator.deviceMemory,cpus:navigator.hardwareConcurrency}),sdkName:id,sdkVersion:nd,metaData:{},permissions:{}};gn.roomJoined(o),null!=r&&r.audio?gn.audioOn():gn.audioOff(),null!=r&&r.video?gn.videoOn():gn.videoOff()})))),{roomJoined:yield this.completeJoinRoom()}}catch(e){return BS.error("error on sending join room request",{error:e}),{roomJoined:!1}}}))}completeJoinRoom(){return tr(this,null,(function*(){try{let e=Mb.create();try{const t=yield Yt(this,yR).sendMessagePromise(Jw.getRoomStageState);t.payload&&(e=Mb.fromBinary(t.payload))}catch(e){throw BS.error("getRoomStageState::binary_decode_error",{error:e}),new $S("Unable to get stage status of participants")}const{maxPreferredStreams:t,participants:r,roomState:n,selectedPeers:i}=yield this.sfuHandler.hiveSocketHandler.notifySelfJoinComplete();this.roomUUID=n.roomUuid,this.maxPreferredStreams=null!=t?t:6;const s=r.map((t=>{const r=t.producerStates,n={id:t.peerId,isHost:!1,displayName:t.displayName,flags:{},userId:t.userId,audioMuted:!0,videoEnabled:!1,audioTrack:null,videoTrack:null,producers:[]};let i=MA.OFF_STAGE;return e.approvedStagePeers.includes(n.userId)&&(i=MA.ACCEPTED_TO_JOIN_STAGE),e.requestedStagePeers.includes(n.userId)&&(i=MA.REQUESTED_TO_JOIN_STAGE),e.onStagePeers.includes(n.userId)&&(i=MA.ON_STAGE),n.stageStatus=i,r.forEach((e=>{e.kind!==lT.AUDIO||e.screenShare?e.kind===lT.VIDEO&&!e.screenShare&&(n.videoEnabled=!e.pause):n.audioMuted=e.pause,n.producers.push({producerId:e.producerId,kind:e.kind===lT.AUDIO?"audio":"video",pause:e.pause,screenShare:e.screenShare})})),n})),{audioPeers:o,compulsoryPeers:a}=null!=i?i:{},c=s.filter((e=>e.id!==this.peerId));return Zt(this,TR,!1),Zt(this,ER,!0),this.roomJoined=!0,this.mediaConnected=Yt(this,yR).isConnected,BS.info("HiveNodeClient::joinRoom::pre_emitasync_room_joined"),yield tT.emitAsync(XS.ROOM_JOINED,{peers:c}),0!==n.pinnedPeerIds.length&&tT.emit(XS.PEER_PINNED,{peerId:n.pinnedPeerIds[0]}),BS.info("HiveNodeClient::joinRoom::post_emitasync_room_joined"),tT.emit(XS.SELF_ROOM_JOINED),tT.emit(XS.SELECTED_PEERS,{peerIds:null!=o?o:[],compulsoryPeers:a}),tT.emit(XS.REFRESH_GRID,!0),!0}catch(e){return BS.error("error on completing join room:",{error:e}),!1}}))}leaveRoom(){return tr(this,null,(function*(){Yt(this,_R).stopAllTransports(),Zt(this,ER,!1),vR.joinAttempted=!1,Yt(this,yR).sendMessagePromise(Zw.leaveRoom,bT.toBinary({closeRoom:!1})).then((e=>{var t;(null==(t=WT.fromBinary(e.payload))?void 0:t.closed)||BS.warn("weird state on peer closed and should not happen")})).catch((e=>{BS.error("error on sending leave room request",{error:e})})),gn.callEnded(),VS.destruct()}))}getConsumers(){return Yt(this,_R).consumers}activatePeers(e){return tr(this,null,(function*(){const t=e.map((({peerId:e,producers:t,force:r})=>{if(0===t.length)return Promise.resolve();if(r)return this.consumePeer(e,r);const n=[];return t.every((e=>{const t=this.sfuHandler.producerIdToConsumerIdMap.get(e.producerId);if(!t)return!1;const r=this.sfuHandler.consumers.get(t);return r&&!e.pause&&r.paused&&n.push(t),!0}))?n.length>0?this.resumeConsumers(n):Promise.resolve():this.consumePeer(e)}));yield Promise.all(t)}))}deactivatePeers(e){return tr(this,null,(function*(){BS.info("deactivating producers"),e.producers.some((e=>e.screenShare&&"video"===e.kind))?BS.debug("peer is screensharing can't deactivate"):(e.producers.forEach((({producerId:e,kind:t})=>{if("audio"===t)return void BS.debug("we don't want to deactive audio consumers");const r=this.sfuHandler.producerIdToConsumerIdMap.get(e);r?this.sfuHandler.closeConsumer(r):BS.warn(`consumer not found in deactivate producers: ${e}`)})),this.activatedProducingPeerIds.delete(e.peerId))}))}createConsumer(e){return tr(this,arguments,(function*({producerId:e,producingPeerId:t,screenShare:r}){return this.sfuHandler.createConsumer({producerId:e,producingPeerId:t,appData:{screenShare:r}})}))}pauseConsumers(e){return tr(this,null,(function*(){e.forEach((e=>{this.sfuHandler.pauseConsumer(e)}))}))}resumeConsumers(e){return tr(this,null,(function*(){e.forEach((e=>{this.sfuHandler.resumeConsumer(e)}))}))}closeConsumers(e){return tr(this,null,(function*(){const t=Array.from(this.getConsumers().values()).filter((t=>e.includes(t.peerId))).map((e=>e.id));return e.forEach((e=>{this.activatedProducingPeerIds.delete(e)})),this.sfuHandler.closeConsumers(t)}))}consumePeer(e,t){return tr(this,null,(function*(){if(BS.info(`current activated Peer ids: ${JSON.stringify(Array.from(this.activatedProducingPeerIds.values()))}, forced?:${t}`),!this.activatedProducingPeerIds.has(e)||t)try{yield Yt(this,_R).consumePeer(e),this.activatedProducingPeerIds.add(e)}catch(e){BS.error("consumePeer failed in HiveNodeClient.ts",{error:e})}else BS.info(`not creating consumer for this peerId: ${e}`)}))}shareWebcam(e){return tr(this,null,(function*(){if(void 0===e)return null;if(Yt(this,_R).producers.has(RS.WEBCAM)){const t=Yt(this,_R).producers.get(RS.WEBCAM);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),yield this.resumeWebcam(),e;yield Yt(this,_R).removeProducer(RS.WEBCAM)}const t={track:e,codecOptions:{name:"VP8"},appData:{screenShare:!1},stopTracks:!1};if(In.hasFeature(DS.ENABLE_HIVE_SIMULCAST)){let r=e.getConstraints().width;r in wS||(r=320),t.encodings=wS[r]}return Yt(this,_R).createProducer(RS.WEBCAM,t,(()=>{this.disableWebcam()}))}))}shareScreen(e){return tr(this,null,(function*(){const{video:t,audio:r}=e;if(void 0===t)return;const n={track:t,codecOptions:{name:"VP8"},appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},stopTracks:!1};let i=()=>{this.disableScreenShare()};if(gn.screenShareRequested(),yield Yt(this,_R).createProducer(RS.SCREENSHARE_VIDEO,n,i),r){const e={track:r,codecOptions:{name:"opus"},appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},stopTracks:!1,zeroRtpOnPause:!0};i=()=>{},yield Yt(this,_R).createProducer(RS.SCREENSHARE_AUDIO,e,i)}}))}shareMic(e){return tr(this,null,(function*(){try{if(void 0===e)throw new Ck("track undefined");if(Yt(this,_R).producers.has(RS.MIC)){const t=Yt(this,_R).producers.get(RS.MIC);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),void(yield this.resumeMic());yield Yt(this,_R).removeProducer(RS.MIC,!1)}const t={track:e,encodings:[{priority:"high"}],codecOptions:{name:"opus"},stopTracks:!1,zeroRtpOnPause:!0},r=()=>{this.disableMic()};yield Yt(this,_R).createProducer(RS.MIC,t,r)}catch(e){throw new $S(e)}}))}pauseMic(){const e=Yt(this,_R).producers.get(RS.MIC);if(!e)return void BS.error("pauseMic::could_not_find_mic_producer");if(e.paused)return void BS.info("pauseMic::mic_producer_already_paused");e.pause();const t={producerId:e.id,pause:!0};Yt(this,yR).sendMessage(Zw.toggleProducer,CT.toBinary(t))}pauseWebcam(){return tr(this,null,(function*(){const e=Yt(this,_R).producers.get(RS.WEBCAM);if(!e)return void BS.error("pauseWebcam::could_not_find_webcam_producer");e.pause();const t={producerId:e.id,pause:!0};Yt(this,yR).sendMessage(Zw.toggleProducer,CT.toBinary(t))}))}resumeMic(){return tr(this,null,(function*(){const e=Yt(this,_R).producers.get(RS.MIC);if(!e)return void BS.error("resumeMic::could_not_find_mic_producer");if(!e.pause)return void BS.info("resumeMic::mic_producer_already_resumed");e.resume();const t={producerId:e.id,pause:!1};Yt(this,yR).sendMessage(Zw.toggleProducer,CT.toBinary(t))}))}resumeWebcam(){return tr(this,null,(function*(){const e=Yt(this,_R).producers.get(RS.WEBCAM);if(!e)return void BS.error("resumeWebcam::could_not_find_webcam_producer");e.resume();const t={producerId:e.id,pause:!1};Yt(this,yR).sendMessage(Zw.toggleProducer,CT.toBinary(t))}))}disableWebcam(){return tr(this,null,(function*(){yield Yt(this,_R).removeProducer(RS.WEBCAM)}))}disableMic(){return tr(this,null,(function*(){yield Yt(this,_R).removeProducer(RS.MIC)}))}disableScreenShare(){return tr(this,null,(function*(){BS.info("screen_sharing_stopped"),yield Yt(this,_R).removeProducer(RS.SCREENSHARE_VIDEO),yield Yt(this,_R).removeProducer(RS.SCREENSHARE_AUDIO),Yt(this,IR).clear()}))}muteSelf(){return tr(this,null,(function*(){this.pauseMic()}))}unmuteSelf(){return tr(this,null,(function*(){}))}resetVideoProducers(e,t){return tr(this,null,(function*(){e&&(yield Yt(this,_R).removeProducer(RS.WEBCAM,!1),this.shareWebcam(e)),t&&(yield Yt(this,_R).removeProducer(RS.SCREENSHARE_VIDEO,!1),this.shareScreen({video:t}))}))}getPolls(){return tr(this,null,(function*(){return{payload:{polls:{}}}}))}changeDisplayName(e,t){return tr(this,null,(function*(){const r={displayName:e,participantId:null!=t?t:this.peerId};if(!(yield this.sfuHandler.hiveSocketHandler.changeDisplayName(r)))throw new Error("failed to change display name!")}))}kick(e){return tr(this,null,(function*(){const t={participantId:e};if(!(yield this.sfuHandler.hiveSocketHandler.kickPeer(t)))throw new Error("failed to kickout the participant!")}))}kickAll(){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.kickAll()))throw new Error("failed to kickout all participant!")}))}muteAll(e){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForAll("audio")))throw new Error("failed to mute all participant")}))}muteAllVideo(){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForAll("video")))throw new Error("failed to mute all video participant")}))}disableAudio(e){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForPeer(e,"audio")))throw new Error("failed to mute given participant")}))}disableVideo(e){return tr(this,null,(function*(){if(!(yield this.sfuHandler.hiveSocketHandler.hostControlForPeer(e,"video")))throw new Error("failed to mute video of given participant")}))}pinPeer(e){return tr(this,null,(function*(){const t={participantId:null!=e?e:""};try{yield Yt(this,yR).sendMessagePromise(Zw.globalPinPeer,RT.toBinary(t))}catch(e){BS.error("Error in pinning peer:",{error:e})}}))}validateScreenShare(e){return this.peerId===e.peerId&&this.sfuHandler.hasProducer(e.producerId)&&Yt(this,IR).add(e.consumerPeerId),Yt(this,IR).size}handleSocketEvents(){return tr(this,null,(function*(){Yt(this,yR).on(Zw.peerJoinedBroadcast,(({id:e,payload:t})=>{if(this.roomJoined)try{const{participant:{peerId:e,displayName:r,producerStates:n,userId:i}}=XT.fromBinary(t);if(e===this.peerId)return;const s={id:e,isHost:!1,displayName:r,flags:{},userId:i,audioMuted:!0,videoEnabled:!1,audioTrack:null,videoTrack:null,producers:[]};n.forEach((e=>{e.kind!==lT.AUDIO||e.screenShare?e.kind===lT.VIDEO&&!e.screenShare&&(s.videoEnabled=!e.pause):s.audioMuted=e.pause,s.producers.push({producerId:e.producerId,kind:e.kind===lT.AUDIO?"audio":"video",pause:e.pause,screenShare:e.screenShare})})),tT.emit(XS.PEER_JOINED,s)}catch(e){BS.error("error in peer-joined-broadcast",{error:e})}})),Yt(this,yR).on(Zw.peerProducerCreateBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t,producerState:r}=ZT.fromBinary(e);if(t===this.peerId)return;BS.info(`producer created broadcast: ${t}, producer state: ${r}`),tT.emit(XS.NEW_PRODUCER,{peerId:t,producer:{producerId:r.producerId,kind:r.kind===lT.AUDIO?"audio":"video",pause:r.pause,screenShare:r.screenShare}})}catch(e){BS.error("error in peer-producer-create-broadcast",{error:e})}})),Yt(this,yR).on(Zw.peerProducerToggleBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t,producerState:{kind:r,pause:n,producerId:i}}=eE.fromBinary(e),s=r===lT.AUDIO?"audio":"video";if(BS.info(`producer toggle broadcast: ${t}, producerId: ${i}, kind:${s}, paused:${n}`),t===this.peerId&&n)return void tT.emit("audio"===s?XS.MUTE_ALL:XS.MUTE_ALL_VIDEO);tT.emit(XS.PRODUCER_TOGGLE,{peerId:t,producerId:i,paused:n,kind:s}),[...this.getConsumers().values()].filter((e=>e.producerId===i)).forEach((e=>{e.paused!==n&&(BS.debug(`consumer state mismatched for ${e.id}. updating consumer pause state ${e.paused} to ${n}`),n?(e.pause(),tT.emit(XS.CONSUMER_PAUSED,{id:e.id})):(e.resume(),tT.emit(XS.CONSUMER_RESUMED,{id:e.id})))}))}catch(e){BS.error("error in producer toggle broadcast handler",{error:e})}})),Yt(this,yR).on(Zw.selectedPeer,(({payload:e})=>{if(this.roomJoined)try{const{audioPeers:t,compulsoryPeers:r}=FT.fromBinary(e);tT.emit(XS.SELECTED_PEERS,{peerIds:r.concat(t)})}catch(e){BS.error("error in selected-peer",{error:e})}})),Yt(this,yR).on(Zw.selectedPeerDiff,(({payload:e})=>{if(this.roomJoined)try{const{entries:t}=BT.fromBinary(e),r=t.map((e=>({peerId:e.peerId,priority:e.priority})));tT.emit(XS.SELECTED_PEERS_DIFF,{entries:r})}catch(e){BS.error("error in selected-peer-diff",{error:e})}})),Yt(this,yR).on(Zw.peerLeaveBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t}=rE.fromBinary(e);if(t===this.peerId)return;BS.info(`peer left broadcast:${t}`),Yt(this,IR).delete(t),this.sfuHandler.cleanupConsumers(t),tT.emit(XS.PEER_CLOSED,{id:t})}catch(e){BS.error("error in peer left broadcast",{error:e})}})),Yt(this,yR).on(Zw.peerProducerCloseBroadcast,(({payload:e})=>{if(this.roomJoined)try{const{participantId:t,producerState:{producerId:r}}=tE.fromBinary(e);if(t===this.peerId)return;BS.info(`producer closed broadcast:${t}`),tT.emit(XS.PRODUCER_CLOSED,{peerId:t,producerId:r});const n=this.sfuHandler.producerIdToConsumerIdMap.get(r);if(!n)return void BS.warn(`no consumer found for producer:${r}`);BS.info(`closing consumer ${n}, producer id: ${r}`),this.sfuHandler.closeConsumer(n).then((()=>{BS.info(`closed consumer: ${n}`),this.sfuHandler.producerIdToConsumerIdMap.delete(r),tT.emit(XS.CONSUMER_CLOSED,{id:n})})).catch((e=>{BS.error("error closing consumer",{error:e})}))}catch(e){BS.error("error on producer close broadcast",{error:e})}})),Yt(this,yR).on(Zw.globalPeerPinBroadcast,(({payload:e})=>{if(this.roomJoined)try{let t;if(e){const r=nE.fromBinary(e);BS.info("pinning peerId: data.participantId"),t=r.participantId}tT.emit(XS.PEER_PINNED,{peerId:t})}catch(e){BS.error("error on global peer pin broadcast",{error:e})}})),Yt(this,yR).on(Zw.peerDisplayNameEditBroadcast,(({payload:e})=>{if(this.roomJoined)try{const t=iE.fromBinary(e);BS.debug(`peer display name changed to: ${t.displayName}`),tT.emit(XS.PEER_DISPLAY_NAME_CHANGED,t.participantId)}catch(e){BS.error("failed to handle peerDisplayNameEditBroadcast:",{error:e})}})),Yt(this,yR).on(Zw.mediaRoomTerminationBroadcastResponse,(()=>{!this.roomJoined&&!Yt(this,TR)&&!Yt(this,ER)||(BS.warn("media hub termination broadcast received, rejoining room"),this.rejoinRoom())}))}))}handleSFUEvents(){Yt(this,_R).on("reconnect_transport",(e=>tr(this,null,(function*(){try{tT.emit(XS.HIVE_TRANPSORT_RECONNECTING),yield this.reconnectTransport(e),BS.info(`transport reconnected [id:${e.id}]`)}catch(e){BS.error("error on reconnection transports",{error:e})}})))),Yt(this,_R).on("rejoin",(e=>{Yt(this,bR)>3&&!e?BS.warn("cannot rejoin more already rejoined 3 times"):!Yt(this,TR)||e?(Zt(this,bR,Yt(this,bR)+1),BS.warn(`rejoining the room because transports are failing. [rejoinCount: ${Yt(this,bR)}]`),tT.emit(XS.HIVE_ROOM_REJOINING),this.rejoinRoom()):BS.warn("room joining in progress, cannot start rejoining")}))}handleCallstatsEvents(){gn.onSafeInitialization((()=>{gn.onConsumerScore((e=>{e.forEach(((e,t)=>{const r=this.sfuHandler.consumers.get(t);r&&tT.emit(XS.CONSUMER_SCORE_UPDATE,{id:t,kind:r.kind,peerId:r.peerId,score:+(10*e).toFixed()})}))})),gn.onProducerScore((e=>{e.forEach(((e,t)=>{const r=[...this.sfuHandler.producers.values()].find((e=>e.id===t));r&&tT.emit(XS.PRODUCER_SCORE_UPDATE,{id:t,kind:r.kind,appData:r.appData,score:+(10*e).toFixed()})}))}))}))}},yR=new WeakMap,_R=new WeakMap,SR=new WeakMap,TR=new WeakMap,ER=new WeakMap,bR=new WeakMap,wR=new WeakMap,kR=new WeakMap,RR=new WeakMap,CR=new WeakMap,IR=new WeakMap,AR=new WeakMap,PR);let OR=DR;gR([VS.trace("HiveNodeClient.reset")],OR.prototype,"reset",1),gR([VS.trace("HiveNodeClient.reconnect")],OR.prototype,"reconnectTransport",1),gR([VS.trace("HiveNodeClient.setupTransport")],OR.prototype,"setupTransports",1),gR([VS.trace("HiveNodeClient.joinRoom")],OR.prototype,"joinRoom",1),gR([VS.trace("HiveNodeClient.completeJoinRoom")],OR.prototype,"completeJoinRoom",1),gR([VS.trace("HiveNodeClient.leaveRoom")],OR.prototype,"leaveRoom",1),gR([VS.trace("HiveNodeClient.activatePeers")],OR.prototype,"activatePeers",1),gR([VS.trace("HiveNodeClient.deactivatePeers")],OR.prototype,"deactivatePeers",1),gR([VS.trace("HiveNodeClient.createConsumer")],OR.prototype,"createConsumer",1),gR([VS.trace("HiveNodeClient.pauseConsumers")],OR.prototype,"pauseConsumers",1),gR([VS.trace("HiveNodeClient.resumeConsumers")],OR.prototype,"resumeConsumers",1),gR([VS.trace("HiveNodeClient.closeConsumers")],OR.prototype,"closeConsumers",1),gR([VS.trace("HiveNodeClient.consumePeer")],OR.prototype,"consumePeer",1),gR([VS.trace("HiveNodeClient.shareWebcam")],OR.prototype,"shareWebcam",1),gR([VS.trace("HiveNodeClient.shareScreen")],OR.prototype,"shareScreen",1),gR([VS.trace("HiveNodeClient.shareMic")],OR.prototype,"shareMic",1),gR([VS.trace("HiveNodeClient.pauseMic")],OR.prototype,"pauseMic",1),gR([VS.trace("HiveNodeClient.pauseWebcam")],OR.prototype,"pauseWebcam",1),gR([VS.trace("HiveNodeClient.resumeMic")],OR.prototype,"resumeMic",1),gR([VS.trace("HiveNodeClient.resumeWebcam")],OR.prototype,"resumeWebcam",1),gR([VS.trace("HiveNodeClient.disableWebcam")],OR.prototype,"disableWebcam",1),gR([VS.trace("HiveClient.disableMic")],OR.prototype,"disableMic",1),gR([VS.trace("HiveClient.disableScreenShare")],OR.prototype,"disableScreenShare",1),gR([VS.trace("HiveNodeClient.muteSelf")],OR.prototype,"muteSelf",1),gR([VS.trace("HiveNodeClient.resetVideoProducers")],OR.prototype,"resetVideoProducers",1),gR([VS.trace("HiveNodeClient.getPolls")],OR.prototype,"getPolls",1),gR([VS.trace("HiveNodeClient.changeDisplayName")],OR.prototype,"changeDisplayName",1),gR([VS.trace("HiveNodeClient.kickPeer")],OR.prototype,"kick",1),gR([VS.trace("HiveNodeClient.kickAllPeers")],OR.prototype,"kickAll",1),gR([VS.trace("HiveNodeClient.muteAll")],OR.prototype,"muteAll",1),gR([VS.trace("HiveNodeClient.muteAllVideo")],OR.prototype,"muteAllVideo",1),gR([VS.trace("HiveNodeClient.disableAudio")],OR.prototype,"disableAudio",1),gR([VS.trace("HiveNodeClient.disableVideo")],OR.prototype,"disableVideo",1),gR([VS.trace("HiveNodeClient.pinPeer")],OR.prototype,"pinPeer",1),gR([VS.trace("HiveNodeClient.validateScreenShare")],OR.prototype,"validateScreenShare",1),gR([VS.trace("HiveNodeClient.init")],OR,"init",1);var MR,NR,xR,LR,UR,jR,FR=(e=>(e.SOCKET_CONNECTED="SOCKET_CONNECTED",e.SOCKET_DISCONNECTED="SOCKET_DISCONNECTED",e.SOCKET_CONNECTION_ERROR="SOCKET_CONNECTION_ERROR",e.SOCKET_MESSAGE="SOCKET_MESSAGE",e))(FR||{}),VR=(e=>(e[e.NOT_STARTED=0]="NOT_STARTED",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e[e.ERRORED=3]="ERRORED",e))(VR||{}),BR=Object.defineProperty,HR=Object.getOwnPropertyDescriptor,WR=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?HR(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&BR(t,r,s),s};class GR extends nr{constructor(e){super(),Kt(this,"socket"),Kt(this,"socketState"),Kt(this,"callbackHandler",null),this.socketState=VR.NOT_STARTED,e.callbackHandler&&(this.callbackHandler=e.callbackHandler)}connect(e){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect()),this.socket=Pt(e,{closeOnBeforeunload:!1}),this.setupSocket()}disconnect(){this.socket.disconnect()}reconnect(){this.socket.connect()}setupSocket(){this.socket.on("disconnect",(e=>{this.socketState=VR.DISCONNECTED,BS.warn("SocketClient::socket_disconnected",{error:{reason:e}}),this.emit(FR.SOCKET_DISCONNECTED,{reason:e})})),this.socket.on("connect_error",(e=>{this.socketState=VR.ERRORED,In.hasFeature(DS.SOCKET_POLLING)&&(this.socket.io.opts.transports=["polling","websocket"]),BS.error("SocketClient::socket_connection_errored",{error:e}),null!=e&&e.message.includes("not found")&&tT.emit(XS.KICKED),this.emit(FR.SOCKET_CONNECTION_ERROR,{err:e})})),this.socket.on("connect",(()=>{this.socketState=VR.CONNECTED,BS.info("SocketClient::socket_connected"),this.emit(FR.SOCKET_CONNECTED)})),this.socket.on("event://server-simple-message",((e,t)=>tr(this,null,(function*(){const r=JSON.parse(e);if((!VS.logExclusionList.includes(null==r?void 0:r.type)||In.hasFeature(DS.BYPASS_LOG_EXCLUSION_LIST))&&BS.info(`SocketClient::SIMPLE_SERVER_MESSAGE_EVENT::${null==r?void 0:r.type}`),t){let e="OK";this.callbackHandler&&(e=yield this.callbackHandler(r)),t(e)}else this.emit(FR.SOCKET_MESSAGE,r);Object.values(XS).find((e=>e===r.type))&&tT.emit(r.type,r.payload)}))))}sendMessage(e){return tr(this,null,(function*(){return(!VS.logExclusionList.includes(null==e?void 0:e.type)||In.hasFeature(DS.BYPASS_LOG_EXCLUSION_LIST))&&BS.info(`SocketClient::sendMessage::${null==e?void 0:e.type}`),Object.assign(e,{metadata:e.metadata||{}}),VS.injectContext(e.metadata),new Promise((t=>{this.socket.emit("event://send-message",JSON.stringify(e),(e=>{if(!e)return void t(void 0);const r=JSON.parse(e);t(r)}))}))}))}}WR([VS.trace("SocketClient.connect")],GR.prototype,"connect",1),WR([VS.trace("SocketClient.disconnect")],GR.prototype,"disconnect",1),WR([VS.trace("SocketClient.reconnect")],GR.prototype,"reconnect",1),WR([VS.trace("SocketClient.setupSocket")],GR.prototype,"setupSocket",1);const qR=class{constructor(e=1e3){Xt(this,MR),Xt(this,xR),Kt(this,"sendTransport"),Kt(this,"recvTransport"),Kt(this,"collectStpStats"),Kt(this,"collectRtpStats"),Kt(this,"pingInterval"),this.pingInterval=e}initSendTransport(e){this.sendTransport=e,tT.emit(XS.SEND_TRANSPORT_CREATED)}initRecvTransport(e){this.recvTransport=e,tT.emit(XS.RECV_TRANSPORT_CREATED)}collectSendTransportStats(){return!(!this.sendTransport||this.collectStpStats||(this.collectStpStats=setInterval(er(this,MR,NR).bind(this),this.pingInterval),0))}collectRecvTransportStats(){return!(!this.recvTransport||this.collectRtpStats||(this.collectRtpStats=setInterval(er(this,xR,LR).bind(this),this.pingInterval),0))}stopStatsCollection(e){return"send"===e?(clearInterval(this.collectStpStats),this.collectStpStats=void 0,!0):"receive"===e&&(clearInterval(this.collectRtpStats),this.collectRtpStats=void 0,!0)}cleanup(e){this.stopStatsCollection(e),"send"===e?(this.sendTransport=void 0,this.collectStpStats=void 0,tT.emit(XS.SEND_TRANSPORT_CLOSED)):(this.recvTransport=void 0,this.collectRtpStats=void 0,tT.emit(XS.RECV_TRANSPORT_CLOSED))}};let $R=qR;MR=new WeakSet,NR=function(){this.sendTransport||this.stopStatsCollection("send"),this.sendTransport.getStats().then((e=>{var t;return er(t=qR,UR,jR).call(t,e,"send")}))},xR=new WeakSet,LR=function(){this.recvTransport||this.stopStatsCollection("receive"),this.recvTransport.getStats().then((e=>{var t;return er(t=qR,UR,jR).call(t,e,"receive")}))},UR=new WeakSet,jR=function(e,t){e.forEach((e=>{"candidate-pair"===e.type&&tT.emit(XS.CANDIDATE_PEER_UPDATE,zt($t({},e),{transport:t})),"inbound-rtp"===e.type&&tT.emit(XS.INBOUND_RTP_UPDATE,zt($t({},e),{transport:t})),"outbound-rtp"===e.type&&tT.emit(XS.OUTBOUND_RTP_UPDATE,zt($t({},e),{transport:t}))}))},Xt($R,UR);const zR=new $R;var JR=Object.defineProperty,KR=Object.getOwnPropertyDescriptor,QR=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?KR(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&JR(t,r,s),s};class YR extends nr{constructor(e,t){super(),Kt(this,"device"),Kt(this,"sendTransport"),Kt(this,"recvTransport"),Kt(this,"sendTransportIceStateDisconnectTime"),Kt(this,"recvTransportIceStateDisconnectTime"),Kt(this,"producerCreationStatus"),Kt(this,"consumers"),Kt(this,"producers"),Kt(this,"socketClient"),Kt(this,"iceRestartInProgress"),this.producers=new Map,this.consumers=new Map,this.producerCreationStatus=new Map,this.iceRestartInProgress={sendTransport:!1,recvTransport:!1},this.device=void 0!==t?t:new ed,this.socketClient=e}setupTransports(){return tr(this,null,(function*(){const e=yield $w().getICEServers();yield this.loadRouter(),yield Promise.all([this.createRecvTransport(e),this.createSendTransport(e)])}))}loadRouter(){return tr(this,null,(function*(){(this.recvTransport||this.sendTransport)&&(yield this.stopAllTransports())}))}getRTPCapabilities(){return this.device.rtpCapabilities}createRecvTransport(e){return tr(this,null,(function*(){if(!this.socketClient)return;const t=(yield this.socketClient.sendMessage({type:"createWebRtcTransport",payload:{forceTcp:!1,producing:!1,consuming:!0}})).payload;if(BS.info("recvTransport::initializing_transport"),this.recvTransport=this.device.createRecvTransport(zt($t({},t),{iceServers:e,proprietaryConstraints:TS})),zR.initRecvTransport(this.recvTransport),BS.info("recvTransport::initialized_transport"),gn.onSafeInitialization((()=>{gn.configureRecvTransport(this.recvTransport)})),this.recvTransport.on("connect",((e,t,r)=>tr(this,[e,t,r],(function*({dtlsParameters:e},t,r){var n,i,s,o;const a=yield this.socketClient.sendMessage({type:"connectWebRtcTransport",payload:{transportId:this.recvTransport.id,dtlsParameters:e}});null!=(n=a.payload)&&n.error?(BS.error("recvTransport::transport_status",{error:null==(s=a.payload)?void 0:s.error,transport:{id:null==(o=null==this?void 0:this.recvTransport)?void 0:o.id,status:"failed",type:"recv"}}),r(new Error("failed"))):(t(),BS.info("recvTransport::transport_status",{transport:{id:null==(i=null==this?void 0:this.recvTransport)?void 0:i.id,status:"connected",type:"recv"}}))})))),In.hasFeature(DS.ENABLE_ICE_STATE_LOGGING)){let e;BS.info("enabling_ice_state_logging_for_recv_transport"),this.recvTransport.on("connectionstatechange",(t=>tr(this,null,(function*(){var r,n,i,s,o,a,c,d;switch(BS.info("recvTransport::connection_state_change",{transport:{id:null==(r=null==this?void 0:this.recvTransport)?void 0:r.id,status:t,type:"recv"}}),t){case"failed":if(tT.emit(XS.ICE_FAILED,{transport:"recv"}),BS.warn("recvTransport::ice_state_failed"),In.hasFeature(DS.ICE_RESTART_ON_FAILED_STATE))try{yield this.restartIceTillSuccess(this.recvTransport)}catch(e){BS.error("recvTransport::ice_restart_failed",{error:e,transport:{id:null==(n=null==this?void 0:this.recvTransport)?void 0:n.id,status:"failed",type:"recv"}})}break;case"disconnected":tT.emit(XS.ICE_DISCONNECTED,{transport:"recv"}),BS.warn("recvTransport::ice_state_disconnected"),this.recvTransportIceStateDisconnectTime&&BS.warn("recvTransport::ice_state_disconnected_again",{transport:{id:null==(i=null==this?void 0:this.recvTransport)?void 0:i.id,status:"disconnected",type:"recv",lastDisconnectedTime:null==(s=this.recvTransportIceStateDisconnectTime)?void 0:s.toISOString(),lastDisconnectedTimeOffset:null==(o=this.recvTransportIceStateDisconnectTime)?void 0:o.getTimezoneOffset(),durationPassed:(new Date).getTime()-this.recvTransportIceStateDisconnectTime.getTime()}}),this.recvTransportIceStateDisconnectTime=new Date;try{e=In.getValue(DS.ICE_RESTART_ON_DISCONNECTED_STATE),"number"!=typeof e&&(e=void 0)}catch(t){e=void 0}e&&setTimeout((()=>tr(this,null,(function*(){var e,t,r,n,i;if(void 0!==this.recvTransportIceStateDisconnectTime){tT.emit(XS.ICE_RECONNECTING,{transport:"recv"}),BS.info("recvTransport::attempting_ice_restart",{transport:{id:null==(e=null==this?void 0:this.recvTransport)?void 0:e.id,type:"recv",status:"reconnecting",lastDisconnectedTime:null==(t=this.recvTransportIceStateDisconnectTime)?void 0:t.toISOString(),lastDisconnectedTimeOffset:null==(r=this.recvTransportIceStateDisconnectTime)?void 0:r.getTimezoneOffset()},iceRestart:{isSendTransport:null==(n=null==this?void 0:this.iceRestartInProgress)?void 0:n.sendTransport,isRecvTransport:null==(i=null==this?void 0:this.iceRestartInProgress)?void 0:i.recvTransport}});try{yield this.restartIceTillSuccess(this.recvTransport)}catch(e){BS.info("SFUHandler.disconnected.restartIceFailed",{error:e,iceRestart:{status:"failed",isRecvTransport:!0}})}}}))),e);break;case"connected":tT.emit(XS.ICE_CONNECTED,{transport:"recv"}),BS.info("recvTransport::ice_state_connected",{transport:{id:null==(a=null==this?void 0:this.recvTransport)?void 0:a.id,type:"recv",status:"connected",lastDisconnectedTime:null==(c=this.recvTransportIceStateDisconnectTime)?void 0:c.toISOString(),lastDisconnectedTimeOffset:null==(d=this.recvTransportIceStateDisconnectTime)?void 0:d.getTimezoneOffset(),durationPassed:this.recvTransportIceStateDisconnectTime?(new Date).getTime()-this.recvTransportIceStateDisconnectTime.getTime():null}}),this.recvTransportIceStateDisconnectTime=void 0}}))))}this.recvTransport.observer.on("close",(()=>{this.recvTransport=void 0,zR.cleanup("receive"),BS.warn("recvTransport_closed")}))}))}createSendTransport(e){return tr(this,null,(function*(){const t=(yield this.socketClient.sendMessage({type:"createWebRtcTransport",payload:{forceTcp:!1,producing:!0,consuming:!1}})).payload;if(BS.info("sendTransport::initializing_transport"),this.sendTransport=this.device.createSendTransport(zt($t({},t),{iceServers:e,proprietaryConstraints:TS})),zR.initSendTransport(this.sendTransport),BS.info("sendTransport::initialized_transport"),gn.onSafeInitialization((()=>{gn.configureSendTransport(this.sendTransport)})),this.sendTransport.on("connect",((e,t,r)=>tr(this,[e,t,r],(function*({dtlsParameters:e},t,r){var n,i,s,o;null!=(i=(yield this.socketClient.sendMessage({type:"connectWebRtcTransport",payload:{transportId:null==(n=this.sendTransport)?void 0:n.id,dtlsParameters:e}})).payload)&&i.error?(BS.error("sendTransport::transport_status",{transport:{id:null==(o=null==this?void 0:this.sendTransport)?void 0:o.id,status:"failed",type:"send"}}),r(new Error("failed"))):(BS.info("sendTransport::transport_status",{transport:{id:null==(s=null==this?void 0:this.sendTransport)?void 0:s.id,status:"connected",type:"send"}}),t())})))),this.sendTransport.on("produce",((e,t,r)=>tr(this,[e,t,r],(function*({kind:e,rtpParameters:t,appData:r},n,i){var s,o,a,c,d,l;const u=yield this.socketClient.sendMessage({type:"produce",payload:{transportId:null==(s=this.sendTransport)?void 0:s.id,kind:e,rtpParameters:t,appData:r}});null!=(o=u.payload)&&o.error?(BS.info("sendTransport::producer_status::failed",{producer:{kind:e,appData:r,status:"failed",id:null==(d=null==u?void 0:u.payload)?void 0:d.id}}),i(null==(l=u.payload)?void 0:l.error)):(BS.info("sendTransport::producer_status::producing",{producer:{kind:e,appData:r,status:"producing",id:null==(a=null==u?void 0:u.payload)?void 0:a.id}}),n({id:null==(c=u.payload)?void 0:c.id}))})))),In.hasFeature(DS.ENABLE_ICE_STATE_LOGGING)){let e;BS.info("Enabling ice state logging for send transport"),this.sendTransport.on("connectionstatechange",(t=>tr(this,null,(function*(){var r,n,i,s;switch(BS.info("sendTransport::connection_state_change",{transport:{id:null==(r=null==this?void 0:this.sendTransport)?void 0:r.id,status:t,type:"send"}}),t){case"failed":if(tT.emit(XS.ICE_FAILED,{transport:"send"}),BS.warn("sendTransport::ice_state_failed"),In.hasFeature(DS.ICE_RESTART_ON_FAILED_STATE))try{yield this.restartIceTillSuccess(this.sendTransport)}catch(e){BS.error("sendTransport::ice_restart_failed",{error:e})}break;case"disconnected":tT.emit(XS.ICE_DISCONNECTED,{transport:"send"}),BS.warn("sendTransport::ice_state_disconnected"),this.sendTransportIceStateDisconnectTime&&BS.warn("sendTransport::ice_state_disconnected_again",{transport:{id:null==(n=null==this?void 0:this.sendTransport)?void 0:n.id,status:"disconnected",lastDisconnectedTime:this.sendTransportIceStateDisconnectTime.toLocaleTimeString(),durationPassed:(new Date).getTime()-this.sendTransportIceStateDisconnectTime.getTime(),type:"send"}}),this.sendTransportIceStateDisconnectTime=new Date;try{e=In.getValue(DS.ICE_RESTART_ON_DISCONNECTED_STATE),"number"!=typeof e&&(e=void 0)}catch(t){e=void 0}e&&setTimeout((()=>tr(this,null,(function*(){var e,t,r,n;if(void 0!==this.sendTransportIceStateDisconnectTime){tT.emit(XS.ICE_RECONNECTING,{transport:"send"}),BS.info("sendTransport::attempting_ice_restart",{transport:{id:null==(e=null==this?void 0:this.sendTransport)?void 0:e.id,status:"reconnecting",type:"send",lastDisconnectedTime:null==(t=this.sendTransportIceStateDisconnectTime)?void 0:t.toISOString(),lastDisconnectedTimeOffset:null==(r=this.sendTransportIceStateDisconnectTime)?void 0:r.getTimezoneOffset()},iceRestart:{status:"connecting"}});try{yield this.restartIceTillSuccess(this.sendTransport)}catch(e){BS.info("SFUHandler.disconnected.restartIceFailed",{error:e,transport:{id:null==(n=null==this?void 0:this.sendTransport)?void 0:n.id,type:"send",status:"failed"}})}}}))),e);break;case"connected":tT.emit(XS.ICE_CONNECTED,{transport:"send"}),BS.info("sendTransport::ice_state_connected",{transport:{id:null==(i=null==this?void 0:this.sendTransport)?void 0:i.id,type:"send",status:"connected",lastDisconnectedTime:null==(s=this.sendTransportIceStateDisconnectTime)?void 0:s.toLocaleTimeString(),durationPassed:this.sendTransportIceStateDisconnectTime?(new Date).getTime()-this.sendTransportIceStateDisconnectTime.getTime():null}}),this.sendTransportIceStateDisconnectTime=void 0}}))))}this.sendTransport.observer.on("close",(()=>{this.sendTransport=void 0,zR.cleanup("send"),BS.warn("sendTransport_closed")}))}))}restartIce(e){return tr(this,null,(function*(){const{direction:t}=e;if(!("recv"===t?this.iceRestartInProgress.recvTransport:this.iceRestartInProgress.sendTransport)){"recv"===t?this.iceRestartInProgress.recvTransport=!0:this.iceRestartInProgress.sendTransport=!0;try{const t=(yield this.socketClient.sendMessage({type:"restartIce",payload:{transportId:e.id}})).payload;yield e.restartIce(t)}catch(r){BS.error("SFUHandler.restartIce.Failed",{error:r,iceRestart:{status:"failed"},transport:{id:null==e?void 0:e.id,status:"failed",type:t}})}"recv"===t?this.iceRestartInProgress.recvTransport=!1:this.iceRestartInProgress.sendTransport=!1}}))}createConsumer(e){return tr(this,null,(function*(){if(void 0===this.recvTransport||this.recvTransport.closed)return;const{peerId:t,producerId:r,id:n,kind:i,rtpParameters:s,appData:o,remotelyPaused:a}=e;BS.info("createConsumer::initializing_consumer",{consumer:{id:n,peerId:t,kind:i,appData:o,remotelyPaused:a,producerId:r}});const c=yield this.recvTransport.consume({id:n,producerId:r,kind:i,rtpParameters:s,appData:zt($t({},o),{peerId:t})});BS.info("createConsumer::initialized_consumer",{consumer:{id:c.id,peerId:t,kind:i,appData:o,remotelyPaused:a,producerId:r}});const d=c;d.peerId=t,d.remotelyPaused=a,d.score=10,this.consumers.set(c.id,d)}))}closeConsumer(e){return tr(this,null,(function*(){const{id:t}=e,r=this.consumers.get(t);r&&(BS.info("SFUHandler::close_consumer",{consumer:r}),r.close(),this.consumers.delete(t))}))}cleanupConsumers(){return tr(this,null,(function*(){var e;null==(e=this.consumers)||e.forEach((e=>{tT.emit(XS.CONSUMER_CLOSED,{id:e.id}),this.closeConsumer({id:e.id})}))}))}pauseConsumer(e){return tr(this,null,(function*(){const{id:t}=e,r=this.consumers.get(t);r&&r.pause()}))}resumeConsumer(e){return tr(this,null,(function*(){const{id:t}=e,r=this.consumers.get(t);r&&r.resume()}))}createProducer(e,t,r){return tr(this,null,(function*(){if(void 0===this.sendTransport||this.sendTransport.closed)return null;if(BS.info("createProducer::initializing_producer",{producer:{id:"TO_BE_CREATED",kind:e,status:"initializing",appData:null==t?void 0:t.appData}}),this.producerCreationStatus.get(e)&&this.producerCreationStatus.get(e)===_k.INITIALIZING)return BS.info("createProducer::producer getting initializing",{producer:{id:"GETTING_CREATED",status:"initializing",kind:e,appData:null==t?void 0:t.appData}}),null;this.producerCreationStatus.set(e,_k.INITIALIZING);const n=yield Promise.race([this.sendTransport.produce(t),new Promise((e=>setTimeout((()=>e(void 0)),6e3)))]);if(!n)return BS.error("createProducer::transport_initialization_timed_out",{producer:{id:"FAILED_TO_CREATE",kind:e,status:"failed",appData:null==t?void 0:t.appData}}),this.producerCreationStatus.set(e,_k.NOT_INITIALIZED),null;this.producerCreationStatus.set(e,_k.INITIALIZED),BS.info("createProducer::initialized_producer",{producer:{id:null==n?void 0:n.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),n.on("transportclose",(()=>{BS.info("producer::transportclose",{producer:{id:null==n?void 0:n.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),this.producerCreationStatus.set(e,_k.NOT_INITIALIZED),this.producers.delete(e)})),n.on("trackended",(()=>{tT.emit(XS.PRODUCER_TRACK_ENDED,{kind:e}),BS.info("producer::trackended",{producer:{id:null==n?void 0:n.id,kind:e,status:"UNKNOWN",appData:null==t?void 0:t.appData}}),[RS.MIC,RS.WEBCAM].includes(e)||r()}));const i=n;return i.score=10,this.producers.set(e,i),yield this.reconfigureWebcamLayers(),yield this.reconfigureSafariScreenshareLayers(),n.track}))}removeProducer(e,t=!0){return tr(this,null,(function*(){const r=this.producers.get(e);!r||r.closed||(BS.info("SFUHandler::remove_producer",{producer:{id:null==r?void 0:r.id,kind:e,status:"UNKNOWN",appData:null==r?void 0:r.appData},debuggingHint:`stopTrack was ${t}`}),t&&r.track.stop(),r.close(),yield this.socketClient.sendMessage({type:"closeProducer",payload:{producerId:r.id}}),this.producerCreationStatus.set(e,_k.NOT_INITIALIZED),this.producers.delete(e),yield this.reconfigureWebcamLayers())}))}stopAllProducers(){Array.from(this.producers.keys()).forEach((e=>{this.removeProducer(e)}))}stopAllTransports(){return tr(this,null,(function*(){if(this.sendTransport){try{this.sendTransport.close()}catch(e){BS.error("stopAllTransports",{error:e})}this.sendTransport=void 0}if(this.recvTransport){try{this.recvTransport.close()}catch(e){BS.error("SFUHandler::stopAllTransports::error",e)}this.recvTransport=void 0}}))}reconfigureWebcamLayers(){return tr(this,null,(function*(){if(!In.hasFeature(DS.DISABLE_WEBCAM_LAYERS_ON_SCREENSHARE))return;const e=this.producers.get(RS.WEBCAM);e&&(yield e.setMaxSpatialLayer(this.producers.get(RS.SCREENSHARE_VIDEO)?0:1))}))}reconfigureSafariScreenshareLayers(){return tr(this,null,(function*(){if(!In.hasFeature(DS.SCREENSHARE_SIMULCAST)||!_S.isSafari())return;const e=this.producers.get(RS.SCREENSHARE_VIDEO);if(!e)return;const t=e.rtpSender.getParameters();t.encodings=bS,e.rtpSender.setParameters(t)}))}restartIceTillSuccess(e,t=3){return tr(this,null,(function*(){let r=!1,n=0;for(;!r&&n<t;)try{BS.info("SFUHandler.restartIceTillSuccess.AttemptRestart",{iceRestart:{currentAttempt:n,isSendTransport:"send"===e.direction,isRecvTransport:"recv"===e.direction}}),yield this.restartIce(e),r=!0}catch(e){n+=1}if(!r)throw new $S("Failed to restart Ice")}))}}QR([VS.trace("SFUHandler.setupTransports")],YR.prototype,"setupTransports",1),QR([VS.trace("SFUHandler.loadRouter")],YR.prototype,"loadRouter",1),QR([VS.trace("SFUHandler.createRecvTransport")],YR.prototype,"createRecvTransport",1),QR([VS.trace("SFUHandler.createSendTransport")],YR.prototype,"createSendTransport",1),QR([VS.trace("SFUHandler.restartIce")],YR.prototype,"restartIce",1),QR([VS.trace("SFUHandler.createConsumer")],YR.prototype,"createConsumer",1),QR([VS.trace("SFUHandler.closeConsumer")],YR.prototype,"closeConsumer",1),QR([VS.trace("SFUHandler.cleanupConsumers")],YR.prototype,"cleanupConsumers",1),QR([VS.trace("SFUHandler.pauseConsumer")],YR.prototype,"pauseConsumer",1),QR([VS.trace("SFUHandler.resumeConsumer")],YR.prototype,"resumeConsumer",1),QR([VS.trace("SFUHandler.createProducer")],YR.prototype,"createProducer",1),QR([VS.trace("SFUHandler.removeProducer")],YR.prototype,"removeProducer",1),QR([VS.trace("SFUHandler.stopAllProducers")],YR.prototype,"stopAllProducers",1),QR([VS.trace("SFUHandler.stopAllTransports")],YR.prototype,"stopAllTransports",1);Object.defineProperty,Object.getOwnPropertyDescriptor;var XR=(e=>(e.REQUEST="REQUEST",e.ACCEPT="ACCEPT",e.REJECT="REJECT",e.END="END",e.EVENT="EVENT",e))(XR||{}),ZR=(e=>(e.PENDING="PENDING",e.ACCEPTED="ACCEPTED",e.REJECTED="REJECTED",e.ENDED="ENDED",e))(ZR||{}),eC=(e=>(e.KEYBOARD="KEYBOARD",e.MOUSE="MOUSE",e))(eC||{}),tC=(e=>(e.LEFT_CLICK="click",e.RIGHT_CLICK="contextmenu",e.MOVE="mousemove",e))(tC||{}),rC=(e=>(e.REQUEST_RECEIVED="REQUEST_RECEIVED",e.REQUEST_SENT="REQUEST_SENT",e.INCOMING_REQUEST_ACCEPTED="INCOMING_REQUEST_ACCEPTED",e.OUTGOING_REQUEST_ACCEPTED="OUTGOING_REQUEST_ACCEPTED",e.INCOMING_REQUEST_ENDED="INCOMING_REQUEST_ENDED",e.OUTGOING_REQUEST_ENDED="OUTGOING_REQUEST_ENDED",e))(rC||{});let nC=class extends HS{constructor(e){super(),Kt(this,"id"),Kt(this,"remotePeerId"),Kt(this,"hostPeerId"),Kt(this,"state");const{remotePeerId:t,requestId:r,hostPeerId:n,state:i}=e;this.id=r,this.remotePeerId=t,this.hostPeerId=n,this.state=i}};nC=((e,t,r,n)=>{for(var i,s=t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(s)||s);return s})([KS((e=>{throw new $S(e.message,"1400")}))],nC);var iC=(e=>(e.REQUESTED_BY_PARTICIPANT="REQUESTED_BY_PARTICIPANT",e.REQUESTED_BY_MODERATOR="REQUESTED_BY_MODERATOR",e))(iC||{}),sC=(e=>(e.PRESENT="REQUEST_TO_PRESENT",e))(sC||{}),oC=Object.defineProperty,aC=Object.getOwnPropertyDescriptor,cC=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?aC(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&oC(t,r,s),s};const dC={joinAttempted:!1};var lC,uC,hC;const pC=(hC=class extends rk{constructor(e){super(),Xt(this,lC,void 0),Kt(this,"isV2AuthToken"),Xt(this,uC,void 0),Kt(this,"legacyMode"),Kt(this,"roomNodeUrl"),Kt(this,"peerDisplayName");const{roomName:t,roomNodeUrl:r,peerId:n,authToken:i,legacyMode:s,socketClient:o,meetingTitle:a,viewType:c}=e;this.roomName=t,this.roomNodeUrl=r,this.peerId=n,this.authToken=i,this.legacyMode=s,Zt(this,lC,o),this.roomJoined=!1,this.mediaConnected=!1,this.meetingTitle=a,this.isV2AuthToken=Sw.isV2AuthToken,Zt(this,uC,new YR(o,e.device)),gn.legacySwitch(s);let d=0;const l=e=>tr(this,[e],(function*({err:e}){var r;this.isDisconnected=!0,null==(r=this.sfuHandler)||r.cleanupConsumers(),this.mediaConnected=!1,tT.emit(XS.ROOM_NODE_CONNECTION_ERROR,e),this.roomJoined=!1,BS.error("RoomNodeClient::ROOM_NODE_CONNECTION_ERROR",{error:e});const s=Sw.isV2AuthToken?Sw.meetingId:t,o=$w(),{roomNodeUrl:a}=yield o.getRoomNodeData({roomName:s,peerId:n}),c=`${a}?roomURL=${t}&peerId=${n}&authToken=${i}&version=0.5.0`;d+=1,!(d>3)&&(BS.log("RoomNodeClient::SocketReconnection",{socket:{retryAttempt:d}}),Yt(this,lC).connect(c),bw(zt($t({},Sw.roomNodeOptions),{roomNodeUrl:a})),this.roomNodeUrl=a)}));c===vn.Livestream&&(o.removeListener(FR.SOCKET_CONNECTION_ERROR,l.bind(this)),o.on(FR.SOCKET_CONNECTION_ERROR,l.bind(this)))}static init(e){return tr(this,null,(function*(){const{legacyMode:t=!0,roomName:r,peerId:n,authToken:i,meetingTitle:s,device:o,viewType:a}=e;let c;const d=`${e.roomNodeUrl}?roomURL=${r}&peerId=${n}&authToken=${i}&version=0.5.0`,l=new GR({callbackHandler:e=>tr(this,null,(function*(){yield c.handleSocketCallbacks(e)}))});return l.on(FR.SOCKET_MESSAGE,((e,t)=>tr(this,null,(function*(){yield c.handleSockets(e,t)})))),l.connect(d),c=new pC({legacyMode:t,authToken:i,peerId:n,roomName:r,roomNodeUrl:d,socketClient:l,meetingTitle:s,device:o,viewType:a}),l.on(FR.SOCKET_DISCONNECTED,(e=>{var t,r;c.isDisconnected=!0,null==(t=c.sfuHandler)||t.cleanupConsumers(),null==(r=c.sfuHandler)||r.stopAllTransports(),c.mediaConnected=!1,tT.emit(XS.ROOM_NODE_DISCONNECTED,e),c.roomJoined=!1,BS.info("RoomNodeClient::ROOM_NODE_DISCONNECTED")})),l.on(FR.SOCKET_CONNECTED,(e=>tr(this,null,(function*(){c.mediaConnected=!0,tT.emit(XS.ROOM_NODE_CONNECTED,zt($t({},e),{wasDisconnected:c.isDisconnected,wasJoinAttempted:dC.joinAttempted})),c.isDisconnected=!1,BS.info("RoomNodeClient::ROOM_NODE_CONNECTED")})))),c}))}get sfuHandler(){return Yt(this,uC)}reconnect(){Yt(this,lC).reconnect()}setupTransports(){return tr(this,null,(function*(){yield this.sfuHandler.setupTransports()}))}handleSocketCallbacks(e){return tr(this,null,(function*(){return e.type===XS.NEW_CONSUMER?this.sfuHandler.createConsumer(e.payload):null}))}handleSockets(e,t){return tr(this,null,(function*(){if(e){switch((!VS.logExclusionList.includes(null==e?void 0:e.type)||In.hasFeature(DS.BYPASS_LOG_EXCLUSION_LIST))&&BS.info(`RoomNodeClient::handleSockets::${null==e?void 0:e.type}`),e.type){case XS.CONSUMER_CLOSED:this.sfuHandler.closeConsumer(e.payload);break;case XS.CONSUMER_PAUSED:this.sfuHandler.pauseConsumer(e.payload);break;case XS.CONSUMER_RESUMED:this.sfuHandler.resumeConsumer(e.payload);break;case XS.CONSUMER_SCORE:this.handleConsumerScore(e.payload);break;case XS.PRODUCER_SCORE:this.handleProducerScore(e.payload);break;case XS.PRODUCER_CLOSED:this.handleProducerClosed(e.payload)}"function"==typeof t&&t()}}))}joinRoom(e,t,r,n){return tr(this,arguments,(function*(e,t,r,n,i={}){var s,o,a;dC.joinAttempted=!0,this.peerDisplayName=e,this.roomUUID=r;const c=yield Yt(this,lC).sendMessage({type:"joinRoom",payload:{device:_S.getDeviceInfo(),displayName:e,rtpCapabilities:this.sfuHandler.getRTPCapabilities(),isLegacy:this.legacyMode,audioMuted:t}});if(null!=(s=c.payload)&&s.waitlisted)return tT.emit(XS.WAITLISTED),{roomJoined:!1};this.roomJoined=!0,this.mediaConnected=!0,null==(a=null==(o=c.payload)?void 0:o.waitlistedPeers)||a.forEach((e=>{tT.emit(XS.WAITLIST_PEER_ADDED,e)})),this.legacyMode=c.payload.legacyMode||this.legacyMode,n&&""!==n&&(yield this.changeRoomDisplayTitle(n)),this.maxPreferredStreams=c.payload.maxPreferredStreams;const d=$w();BS.info("RoomNodeClient::joinRoom::pre emitasync room_joined");try{yield tT.emitAsync(XS.ROOM_JOINED,c.payload)}catch(e){BS.error("RoomNodeClient::joinRoom::emitAsync",{error:e})}return BS.info("RoomNodeClient::joinRoom::post emitasync room_joined"),tT.emit(XS.SELF_ROOM_JOINED),In.hasFeature(DS.INTERNAL_CALL_STATS)&&"ReactNative"!==navigator.product&&setTimeout((()=>tr(this,null,(function*(){const t=yield d.getUserDetails(),r={userId:Sw.isV2AuthToken?t.participant.id:t.id,peerId:this.peerId,displayName:e,roomUUID:this.roomUUID,roomViewType:"groupCall",roomName:this.roomName,deviceInfo:zt($t({},_S.getDeviceInfo()),{userAgent:navigator.userAgent,memory:navigator.deviceMemory,cpus:navigator.hardwareConcurrency}),sdkName:id,sdkVersion:nd,metaData:{},permissions:{}};gn.roomJoined(r),null!=i&&i.audio?gn.audioOn():gn.audioOff(),null!=i&&i.video?gn.videoOn():gn.videoOff()})))),{roomJoined:!0}}))}leaveRoom(){return tr(this,null,(function*(){dC.joinAttempted=!1,this.sfuHandler.stopAllProducers(),yield this.sfuHandler.stopAllTransports(),Yt(this,lC).disconnect(),gn.callEnded(),VS.destruct()}))}handleProducerClosed({id:e}){this.sfuHandler.producers.forEach(((t,r)=>{t.id===e&&this.sfuHandler.removeProducer(r)}))}getConsumers(){return this.sfuHandler.consumers}static getComputedScore(e){var t,r;let n=0;try{n=Array.isArray(e)?1===e.length?e[0].score:e.map((({score:e})=>null!=e?e:10)).filter((e=>e>0)).reduce(((e,t)=>e+t),0)/e.length:null!=(t=null==e?void 0:e.score)?t:10}catch(t){n=null!=(r=null==e?void 0:e.score)?r:10}return n}handleConsumerScore({id:e,score:t}){var r;const n=Yt(this,uC).consumers.get(e);n&&(n.score=t&&void 0!==t.producerScore&&t.producerScore>=0?t.producerScore:null!=(r=null==t?void 0:t.score)?r:10,tT.emit(XS.CONSUMER_SCORE_UPDATE,{id:n.id,kind:n.kind,peerId:n.peerId,score:n.score}))}handleProducerScore({id:e,score:t}){const r=Array.from(Yt(this,uC).producers.values()).find((t=>t.id===e));if(!r)return void BS.error(`RoomNodeClient::producer_not_found. ProducerId: ${e}`);if(!r)return;const n=pC.getComputedScore(t);void 0!==n&&n!==r.score&&(r.score=n,tT.emit(XS.PRODUCER_SCORE_UPDATE,{id:r.id,kind:r.kind,appData:r.appData,score:r.score}))}shareWebcam(e){return tr(this,null,(function*(){if(void 0===e)return null;if(this.sfuHandler.producers.has(RS.WEBCAM)){const t=this.sfuHandler.producers.get(RS.WEBCAM);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),yield this.resumeWebcam(),t.track;yield this.sfuHandler.removeProducer(RS.WEBCAM,!1)}let t=e.getConstraints().width;t in wS||(t=320);let r=wS[t];const n=this.sfuHandler.getRTPCapabilities().codecs.find((e=>"video/vp9"===e.mimeType.toLowerCase()))||void 0,i=this.sfuHandler.getRTPCapabilities().codecs.find((e=>"video/vp8"===e.mimeType.toLowerCase()))||void 0,s=In.getValue(DS.OVERRIDE_WEBCAM_SIMULCAST);if(n&&!this.legacyMode)r=kS;else if(void 0!==s)try{r=JSON.parse(s)}catch(e){BS.error("Failed to parse flagsmith simulcast")}const o={track:e,encodings:In.hasFeature(DS.DISABLE_WEBCAM_SIMULCAST)?void 0:r,codecOptions:{videoGoogleStartBitrate:1e3},codec:(()=>this.legacyMode?i:n)(),appData:{screenShare:!1},stopTracks:!1};return this.sfuHandler.createProducer(RS.WEBCAM,o,(()=>{this.disableWebcam()}))}))}shareScreen(e){return tr(this,null,(function*(){var t,r;const{video:n,audio:i}=e;if(void 0===n)return;let s;In.hasFeature(DS.SCREENSHARE_SIMULCAST)&&(s=ES);const o={track:n,appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},encodings:s,stopTracks:!1};let a=()=>{this.disableScreenShare()};gn.screenShareRequested(),yield this.sfuHandler.createProducer(RS.SCREENSHARE_VIDEO,o,a);const c={opusDtx:!1,opusStereo:!1,opusFec:!0,forceGoogConference:!1};if(In.hasFeature(DS.SCREENSHARE_FORCE_GOOG_CONFERENCE)&&(c.forceGoogConference=!0),i){const e={track:i,codecOptions:c,appData:{screenShare:!0,supportsRemoteControl:_S.isElectron()},stopTracks:!1};a=()=>{},yield this.sfuHandler.createProducer(RS.SCREENSHARE_AUDIO,e,a)}gn.screenShareStart(null==(r=null==(t=this.sfuHandler.producers.get(RS.SCREENSHARE_VIDEO))?void 0:t.rtpParameters.encodings[0])?void 0:r.ssrc)}))}shareMic(e){return tr(this,null,(function*(){try{if(void 0===e)throw new $S("track undefined");if(this.sfuHandler.producers.has(RS.MIC)){const t=this.sfuHandler.producers.get(RS.MIC);if(!t.closed&&!navigator.isReactNative)return yield t.replaceTrack({track:e}),void(yield this.resumeMic());yield this.sfuHandler.removeProducer(RS.MIC,!1)}const t={track:e,codecOptions:{opusDtx:!1,opusStereo:!1,opusFec:!0,opusMaxAverageBitrate:16e3},stopTracks:!1},r=()=>{this.disableMic()};yield this.sfuHandler.createProducer(RS.MIC,t,r)}catch(e){throw new $S(e)}}))}pauseMic(){const e=this.sfuHandler.producers.get(RS.MIC);e?(e.pause(),Yt(this,lC).sendMessage({type:"pauseProducer",payload:{producerId:e.id}})):BS.error("pauseMic::could_not_find_mic_producer")}pauseWebcam(){return tr(this,null,(function*(){const e=this.sfuHandler.producers.get(RS.WEBCAM);e?(e.pause(),yield Yt(this,lC).sendMessage({type:"pauseProducer",payload:{producerId:e.id}})):BS.error("pauseWebcam::could_not_find_webcam_producer")}))}resumeMic(){return tr(this,null,(function*(){const e=this.sfuHandler.producers.get(RS.MIC);e?(e.resume(),yield Yt(this,lC).sendMessage({type:"resumeProducer",payload:{producerId:e.id}})):BS.error("resumeMic::could_not_find_mic_producer")}))}resumeWebcam(){return tr(this,null,(function*(){const e=this.sfuHandler.producers.get(RS.WEBCAM);e?(e.resume(),yield Yt(this,lC).sendMessage({type:"resumeProducer",payload:{producerId:e.id}})):BS.error("resumeWebcam::could_not_find_webcam_producer")}))}disableWebcam(){return tr(this,null,(function*(){yield this.sfuHandler.removeProducer(RS.WEBCAM)}))}disableMic(){return tr(this,null,(function*(){yield this.sfuHandler.removeProducer(RS.MIC)}))}disableScreenShare(){return tr(this,null,(function*(){var e,t;BS.info("screen_sharing_stopped"),gn.screenShareStop(null==(t=null==(e=this.sfuHandler.producers.get(RS.SCREENSHARE_VIDEO))?void 0:e.rtpParameters.encodings[0])?void 0:t.ssrc),yield this.sfuHandler.removeProducer(RS.SCREENSHARE_VIDEO),yield this.sfuHandler.removeProducer(RS.SCREENSHARE_AUDIO)}))}resetVideoProducers(e,t){return tr(this,null,(function*(){e&&(yield this.sfuHandler.removeProducer(RS.WEBCAM,!1),this.shareWebcam(e)),t&&(yield this.sfuHandler.removeProducer(RS.SCREENSHARE_VIDEO,!1),this.shareScreen({video:t}))}))}getRoomState(){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"getRoomState"})}))}changeRoomDisplayTitle(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"changeDisplayTitle",payload:{displayTitle:e}})}))}sendMessage(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage(e)}))}broadcastMessage(e,t){return tr(this,null,(function*(){const r={payload:t,type:e};return Yt(this,lC).sendMessage({type:"roomMessage",payload:r})}))}sendChatMessage(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"chatMessage",payload:e})}))}getChatMessages(){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"getChatMessages"})}))}pinChatMessage(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"pinChatMessage",payload:e})}))}unpinChatMessage(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"unpinChatMessage",payload:e})}))}getPolls(){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"getPolls"})}))}newPoll(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"newPoll",payload:e})}))}votePoll(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"votePoll",payload:e})}))}acceptWaitingRequest(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"acceptWaitingRequest",payload:{id:e}})}))}rejectWaitingRequest(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"rejectWaitingRequest",payload:{id:e}})}))}muteAll(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"muteAllNew",payload:{allowUnMute:e}})}))}muteAllVideo(){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"muteAllVideo"})}))}pinPeer(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"pinPeer",payload:{id:e}})}))}unpinPeer(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"unpinPeer",payload:{id:e}})}))}disableAudio(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"disableAudioPeerNew",payload:{id:e}})}))}disableVideo(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"disableVideoPeer",payload:{id:e}})}))}kickAll(){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"kickAll"})}))}kick(e){return tr(this,null,(function*(){yield Yt(this,lC).sendMessage({type:"kick",payload:{id:e}})}))}getPage(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"getPage",payload:{pageNum:e}})}))}muteSelf(){return tr(this,null,(function*(){this.pauseMic(),yield Yt(this,lC).sendMessage({type:"muteSelf"})}))}unmuteSelf(){return tr(this,null,(function*(){yield this.resumeMic(),yield Yt(this,lC).sendMessage({type:"unmuteSelf"})}))}addRoomPlugin(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"addPlugin",payload:e})}))}removeRoomPlugin(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"removePlugin",payload:e})}))}remoteControlMessage(e){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:"message",payload:e})}))}requestRemoteControl(e){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e.hostPeerId,remoteRequestId:e.id,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,remoteRequestType:XR.REQUEST})}))}acceptRemoteControl(e){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e.remotePeerId,remoteRequestId:e.id,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,remoteRequestType:XR.ACCEPT})}))}terminateRemoteControl(e,t){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e,remoteRequestId:t.id,hostPeerId:t.hostPeerId,remotePeerId:t.remotePeerId,remoteRequestType:XR.END})}))}sendEventRemoteControl(e,t,r){return tr(this,null,(function*(){return this.remoteControlMessage({peerId:e,remoteRequestId:t,remoteEvent:r,hostPeerId:this.peerId,remotePeerId:e,remoteRequestType:XR.EVENT})}))}assertSpotlight(e,t){return tr(this,null,(function*(){return Yt(this,lC).sendMessage({type:e,payload:zt($t({},t),{roomMessageType:"spotlight"})})}))}assertSpotlightToRoom(e){return tr(this,null,(function*(){return this.assertSpotlight("roomMessage",e)}))}assertSpotlightToPeer(e){return tr(this,null,(function*(){return this.assertSpotlight("message",e)}))}requestToJoinStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"requestToJoinStage",payload:e})}))}withdrawRequestToJoinStage(){return tr(this,null,(function*(){yield this.sendMessage({type:"withdrawRequestToJoinStage"})}))}acceptAllRequestToJoinStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"acceptAllRequestToJoinStage",payload:e.map((e=>zt($t({},e),{type:iC.REQUESTED_BY_MODERATOR})))})}))}grantStageAccess(e){return tr(this,null,(function*(){yield this.sendMessage({type:"grantStageAccess",payload:{userIDs:e}})}))}removePeerFromStage(e,t){return tr(this,null,(function*(){yield this.sendMessage({type:"removePeerFromStage",payload:{id:e,type:t}})}))}kickPeerFromStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"kickPeerFromStage",payload:{userIDs:e}})}))}stopAllProducers(){Yt(this,uC).stopAllProducers()}startPresenting(){return tr(this,null,(function*(){yield this.sendMessage({type:"startPresenting"})}))}stopPresenting(){return tr(this,null,(function*(){this.stopAllProducers(),yield this.sendMessage({type:"stopPresenting"})}))}rejectRequestToJoinStage(e){return tr(this,null,(function*(){yield this.sendMessage({type:"rejectRequestToJoinStage",payload:{id:e}})}))}denyStageAccess(e){return tr(this,null,(function*(){yield this.sendMessage({type:"denyStageAccess",payload:{userIDs:e}})}))}},lC=new WeakMap,uC=new WeakMap,hC);let mC,fC=pC;function gC(e){return tr(this,null,(function*(){if(null!=mC&&mC.roomJoined)throw new Error("Room Node Client already setup");mC&&(mC=void 0),mC=yield OR.init(e)}))}function vC(e){return tr(this,null,(function*(){if(null!=mC&&mC.roomJoined)throw new Error("Room Node Client already setup");mC&&(mC=void 0),mC=yield fC.init(e)}))}function yC(){try{null==mC||mC.leaveRoom()}catch(e){BS.error("roomNodeClient::cleanupRoomNodeClient")}mC=void 0}function _C(){return mC}function SC(e){var t,r,n,i,s,o,a,c,d,l,u,h,p;return e?{media:{audio:{enabled:e.audioEnabled,trackId:null==(t=e.audioTrack)?void 0:t.id,permission:"mediaPermissions"in e?null==(r=e.mediaPermissions)?void 0:r.audio:null},video:{enabled:e.videoEnabled,trackId:null==(n=e.videoTrack)?void 0:n.id,permission:"mediaPermissions"in e?null==(i=e.mediaPermissions)?void 0:i.video:null},screenshare:{enabled:e.screenShareEnabled,permission:"mediaPermissions"in e?null==(s=e.mediaPermissions)?void 0:s.screenshare:null,audio:{enabled:null==(a=null==(o=e.screenShareTracks)?void 0:o.audio)?void 0:a.enabled,trackId:null==(d=null==(c=e.screenShareTracks)?void 0:c.audio)?void 0:d.id},video:{enabled:null==(u=null==(l=e.screenShareTracks)?void 0:l.video)?void 0:u.enabled,trackId:null==(p=null==(h=e.screenShareTracks)?void 0:h.video)?void 0:p.id}}}}:{}}cC([VS.trace("RoomNodeClient.reconnect")],fC.prototype,"reconnect",1),cC([VS.trace("RoomNodeClient.joinRoom")],fC.prototype,"joinRoom",1),cC([VS.trace("RoomNodeClient.leaveRoom")],fC.prototype,"leaveRoom",1),cC([VS.trace("RoomNodeClient.shareWebcam")],fC.prototype,"shareWebcam",1),cC([VS.trace("RoomNodeClient.shareScreen")],fC.prototype,"shareScreen",1),cC([VS.trace("RoomNodeClient.shareMic")],fC.prototype,"shareMic",1),cC([VS.trace("RoomNodeClient.pauseMic")],fC.prototype,"pauseMic",1),cC([VS.trace("RoomNodeClient.pauseWebcam")],fC.prototype,"pauseWebcam",1),cC([VS.trace("RoomNodeClient.resumeMic")],fC.prototype,"resumeMic",1),cC([VS.trace("RoomNodeClient.resumeWebcam")],fC.prototype,"resumeWebcam",1),cC([VS.trace("RoomNodeClient.disableWebcam")],fC.prototype,"disableWebcam",1),cC([VS.trace("RoomNodeClient.disableMic")],fC.prototype,"disableMic",1),cC([VS.trace("RoomNodeClient.disableScreenShare")],fC.prototype,"disableScreenShare",1),cC([VS.trace("RoomNodeClient.resetVideoProducers")],fC.prototype,"resetVideoProducers",1);class TC extends Error{constructor(e,t){super(e),Kt(this,"code"),this.code=t}}class EC extends Error{constructor(e,t,r){super(t),Kt(this,"constraints"),Kt(this,"name"),this.name=e,this.constraints=r}}var bC=Object.defineProperty,wC=Object.getOwnPropertyDescriptor,kC=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?wC(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&bC(t,r,s),s};const RC={port:void 0},CC=["virtual","emulator","krisp","solstice conference","teams","manycam","blackHole"];function IC(e){const t=e.label.toLowerCase();return"macOS"===_S._bowser.getOSName()&&t.includes("iphone")?(BS.log("isVirtualDevice::ignore_macos_continuity"),!0):CC.some((e=>t.includes(e)))}var AC,PC,DC;const OC=(DC=class{constructor(e){Xt(this,AC,void 0),Xt(this,PC,void 0),Zt(this,AC,e),Zt(this,PC,new AbortController)}static init(){return tr(this,null,(function*(){let e=[];return OC.isDeviceListAvailable()?(e=yield OC.enumerateDevices(),BS.info("initial_full_device_list",{devices:JSON.stringify(e)})):BS.error("UnsupportedMediaAPI::navigator.mediaDevices.enumerateDevices",{debuggingHint:"Try checking meetingMetadata.visitedUrl. It should be running on localhost/127.0.0.1 or HTTPS, if not, there would be issues."}),new OC(e)}))}destruct(){return tr(this,null,(function*(){var e;null==(e=Yt(this,PC))||e.abort()}))}static isDeviceListAvailable(){return!(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)}static enumerateDevices(){try{return navigator.mediaDevices.enumerateDevices()}catch(e){return BS.error("enumerate_devices_failed",{error:e}),Promise.resolve([])}}static getAudioConstraints(e){const t={},{disableAP:r=!1,disableAEC:n=!1,disableNS:i=!1,disableAGC:s=!1,disableHPF:o=!1}=e.audioOptions||{};if(_S.isFirefox()||_S.isWebKitBased())t.audio={deviceId:e.audioDeviceId,autoGainControl:!s&&!r,echoCancellation:!n&&!r,noiseSuppression:!i&&!r};else{if("boolean"==typeof t.audio)return t;t.audio={},t.audio.optional=[e.audioDeviceId?{sourceId:e.audioDeviceId}:{sourceId:"default"},{echoCancellation:!n&&!r},{googEchoCancellation:!n&&!r},{googAutoGainControl:!s&&!r},{googNoiseSuppression:!i&&!r},{googHighpassFilter:!o&&!r},{googNoiseSuppression2:!i&&!r},{googEchoCancellation2:!n&&!r},{googAutoGainControl2:!s&&!r}]}return t}static getVideoConstraints(e){const t={},{videoDeviceId:r,videoTrackConstraints:n,facingMode:i="user",frameRate:s={ideal:24,max:30}}=e;return t.video=n||SS.vga,"boolean"==typeof t.video||(r&&(t.video.deviceId={exact:r}),t.video.facingMode=i,t.video.frameRate=s),t}static getUserMediaWithTimeout(){return tr(this,arguments,(function*(e={},t=0){try{if(BS.info("getUserMediaWithTimeout::requesting_user_media",{timeout:t,constraints:JSON.stringify(e)}),!t){const r=yield navigator.mediaDevices.getUserMedia(e);return BS.info("getUserMediaWithTimeout::received_user_media",{timeout:t,constraints:JSON.stringify(e)}),r}const r=yield Promise.race([navigator.mediaDevices.getUserMedia(e),new Promise(((e,r)=>{setTimeout((()=>r(new TC("Get user media timed out","ERR_GUM_TIMEOUT"))),t)}))]);return BS.info("getUserMediaWithTimeout::received_user_media",{timeout:t,constraints:JSON.stringify(e)}),r}catch(t){throw BS.error("getUserMediaWithTimeout::failed_to_access_local_media",{error:t,constraints:JSON.stringify(e)}),BS.error("Failed to get access to local media.",{error:t,constraints:JSON.stringify(e)}),new EC(t.name,t.message,e)}}))}static getAudioTrack(e){return tr(this,null,(function*(){return(yield OC.getUserMediaWithTimeout(e)).getAudioTracks()[0]}))}static getVideoTrack(e){return tr(this,null,(function*(){return(yield OC.getUserMediaWithTimeout(e)).getVideoTracks()[0]}))}static getScreenShareTracks(e){return tr(this,null,(function*(){var t,r;let n,i=In.hasFeature(DS.EXTENSION_HACK),s=null;if(i)try{RC.port=window.chrome.runtime.connect("nkeimhogjdpnpccoofpliimaahmaaome",{name:"chooseDesktopMedia"})}catch(e){VS.addLogInCurrentSpan("error","Extension connect error"),i=!1}return i&&(s=yield new Promise((e=>{const t=setTimeout((()=>e(void 0)),12e3);RC.port.onMessage.addListener((r=>tr(this,null,(function*(){if(r.value.streamId){const{streamId:n}=r.value;clearTimeout(t),e(n)}})))),RC.port.postMessage({method:"chooseDesktopMedia",sources:["screen"]})}))),s?(VS.addLogInCurrentSpan("error","Acquiring extension screenshare track"),n=yield navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{maxWidth:1920,maxHeight:1080,chromeMediaSource:"desktop",chromeMediaSourceId:s},optional:[{maxFrameRate:parseInt(null!=(t=In.getValue(DS.VAL_MAX_FRAMERATE_EXT))?t:"12",10)},{minFrameRate:parseInt(null!=(r=In.getValue(DS.VAL_MIN_FRAMERATE_EXT))?r:"8",10)}]}}),VS.addLogInCurrentSpan("error","Acquired extension screenshare track")):n=yield navigator.mediaDevices.getDisplayMedia(e),{video:n.getVideoTracks()[0],audio:n.getAudioTracks()[0]}}))}static getAudioAndVideoTrack(e){return tr(this,null,(function*(){const t=yield OC.getUserMediaWithTimeout(e);return{audioTrack:t.getAudioTracks()[0],videoTrack:t.getVideoTracks()[0]}}))}onDeviceChange(e){_S.supportsDeviceChangeEvent()&&navigator.mediaDevices.addEventListener("devicechange",Qp((t=>tr(this,null,(function*(){const r=this.availableDevices,n=new Set(r.map((e=>e.deviceId)));yield this.repopulateAvailableDevices();const i=this.availableDevices,s=new Set(i.map((e=>e.deviceId))),o={added:i.filter((e=>!n.has(e.deviceId))),removed:r.filter((e=>!s.has(e.deviceId)))};this.repopulateAvailableDevices().then((()=>e(t,o)))}))),100),{signal:Yt(this,PC).signal})}repopulateAvailableDevices(){return tr(this,null,(function*(){let e=yield OC.enumerateDevices();e=e.map((e=>e.toJSON())),!sg(x_(e,Yt(this,AC),og))&&(Zt(this,AC,e),gn.devices("AUDIO",this.getAudioDevices()),gn.devices("VIDEO",this.getVideoDevices()),gn.devices("SPEAKER",this.getSpeakerDevices()),BS.info("repopulated_full_device_list",{devices:JSON.stringify(e)}))}))}get availableDevices(){return Yt(this,AC)}getAvailableDevicesByKind(e){return Yt(this,AC).filter((t=>t.kind===e))}getDeviceById(e,t){return Yt(this,AC).find((r=>r.deviceId===e&&r.kind===t))}getAudioDevices(){return this.getAvailableDevicesByKind("audioinput").sort(((e,t)=>{const r=IC(e)?0:1;return(IC(t)?0:1)-r}))}getVideoDevices(){return this.getAvailableDevicesByKind("videoinput").sort(((e,t)=>{const r=IC(e)?0:1;return(IC(t)?0:1)-r}))}getSpeakerDevices(){return this.getAvailableDevicesByKind("audiooutput").sort(((e,t)=>{const r=IC(e)?0:1;return(IC(t)?0:1)-r}))}},AC=new WeakMap,PC=new WeakMap,DC);let MC=OC;kC([VS.trace("LocalMediaUtils.onDeviceChange")],MC.prototype,"onDeviceChange",1),kC([VS.trace("LocalMediaUtils.repopulateAvailableDevices")],MC.prototype,"repopulateAvailableDevices",1),kC([VS.trace("LocalMediaUtils.isDeviceListAvailable")],MC,"isDeviceListAvailable",1),kC([VS.trace("LocalMediaUtils.enumerateDevices")],MC,"enumerateDevices",1),kC([VS.trace("LocalMediaUtils.getUserMediaWithTimeout")],MC,"getUserMediaWithTimeout",1),kC([VS.trace("LocalMediaUtils.getAudioTrack")],MC,"getAudioTrack",1),kC([VS.trace("LocalMediaUtils.getVideoTrack")],MC,"getVideoTrack",1),kC([VS.trace("LocalMediaUtils.getScreenShareTracks")],MC,"getScreenShareTracks",1),kC([VS.trace("LocalMediaUtils.getAudioAndVideoTrack")],MC,"getAudioAndVideoTrack",1);const NC=(e,t)=>{try{localStorage.setItem(e,t)}catch(r){BS.error("LocalStorage::setItem::crashed",{error:r,localStorage:{key:e,value:t}})}},xC=e=>{try{return localStorage.getItem(e)}catch(t){BS.error("LocalStorage::getItem::crashed",{error:t,localStorage:{key:e}})}return null},LC="undefined"!=typeof AudioContext?AudioContext:null;class UC{constructor(e){Kt(this,"_AudioContext"),Kt(this,"audioContext"),Kt(this,"_audioContextRefContainers");const t=$t({AudioContext:LC},e);Object.defineProperties(this,{_AudioContext:{value:t.AudioContext},audioContext:{value:null,writable:!0},_audioContextRefContainers:{value:new Set},AudioContextProvider:{enumerable:!0,value:UC}})}getOrCreate(e){if(!this._audioContextRefContainers.has(e)&&(this._audioContextRefContainers.add(e),this._AudioContext&&!this.audioContext))try{this.audioContext=new this._AudioContext}catch(e){}return this.audioContext}release(e){this._audioContextRefContainers.has(e)&&(this._audioContextRefContainers.delete(e),!this._audioContextRefContainers.size&&this.audioContext&&(this.audioContext.close(),this.audioContext=null))}}const jC=new UC;function FC(e){return tr(this,null,(function*(){const t=new Audio,r=new MediaStream;r.addTrack(e),t.srcObject=r;let n=!1;try{const e=t.play();e&&(yield e),n=yield function(e){const t={},r=jC.getOrCreate(t);let n=3;return function t(){return n-=1,((e,t,r)=>{const n="number"==typeof r?r:250,i=e.createMediaStreamSource(t),s=e.createAnalyser();s.fftSize=2048,i.connect(s);const o=new Uint8Array(s.fftSize);let a=!1;return setTimeout((()=>{a=!0}),n),function e(){return a?Promise.resolve(!0):(s.getByteTimeDomainData(o),o.some((e=>128!==e&&0!==e))?Promise.resolve(!1):((e=0)=>new Promise((t=>setTimeout(t,e))))().then(e))}().then((e=>(i.disconnect(),e)),(e=>{throw i.disconnect(),e}))})(r,e.srcObject,250).then((e=>!!e&&(!(n>0)||t()))).catch((()=>!0))}().finally((()=>{jC.release(t)}))}(t),n&&BS.info("checkIfAudioTrackIsSilent::silence_detected")}catch(e){BS.error("checkIfAudioTrackIsSilent::failed_to_detect_silence",{error:e})}finally{t.pause(),t.remove()}return n}))}Object.defineProperty,Object.getOwnPropertyDescriptor;let VC=class extends HS{constructor(e,t,r){super(),Kt(this,"constructorName",this.constructor.name),Kt(this,"userSelectedDevice"),Kt(this,"mediaInterface"),Kt(this,"isNonPreferredDevice"),Kt(this,"_mediaTrack"),Kt(this,"transformedMediaTrack"),Kt(this,"middlewares",[]),Kt(this,"currentDevice"),this.mediaInterface=e,t&&this.setMediaTrack(t),this.userSelectedDevice=void 0,this.isNonPreferredDevice=r,this.onTrackEnded=this.onTrackEnded.bind(this),this.onTrackMuted=this.onTrackMuted.bind(this)}disableTrack(){var e,t;this.removeMediaTrackListeners(),null==(e=this._mediaTrack)||e.stop(),this._mediaTrack=void 0,null==(t=this.transformedMediaTrack)||t.stop(),this.transformedMediaTrack=void 0}get mediaTrack(){return this._mediaTrack}setMediaTrack(e){return tr(this,null,(function*(){const t=e=>{BS.error(`${this.constructorName}.setMediaTrack.error`,{error:e})};try{this.disableTrack()}catch(e){t(e)}this._mediaTrack=yield this.conditionallyChangeTrack(e),yield this.setTransformedTrack();try{this.addMediaTrackListeners(),yield this.setCurrentDevice()}catch(e){t(e)}}))}get trackEnabled(){return!!this.mediaTrack&&"live"===this.mediaTrack.readyState&&this.mediaTrack.enabled}muteTrack(){this.mediaTrack?(this.transformedMediaTrack&&(this.transformedMediaTrack.enabled=!1),this.mediaTrack.enabled=!1):BS.warn("BaseMediaHandler.muteTrack Tried muting with no track present")}unmuteTrack(){return tr(this,null,(function*(){try{this.mediaTrack?this.mediaTrack.enabled=!0:yield this.enableTrack(!1)}catch(e){throw BS.error(`${this.constructorName}.unmuteTrack.error`,{error:e}),this.disableTrack(),new $S("Failed to unmute track")}}))}setCurrentDevice(){return tr(this,null,(function*(){var e;this.mediaTrack?(null==(e=this.currentDevice)?void 0:e.deviceId)!==this.mediaTrack.getSettings().deviceId&&(this.currentDevice=yield this.mediaInterface.getDevice(this.mediaTrack.getSettings().deviceId)):this.currentDevice=void 0}))}addMiddleware(e){return tr(this,null,(function*(){if(_S.isWebKitBased()&&!In.hasFeature(DS.ALLOW_SAFARI_MEDIA_MIDDLEWARES))return{success:!1,message:"Middlewares are not supported in this WebKit engine based browser."};if(this.middlewares.includes(e))return{success:!1,message:"This middleware has been applied, already. Skipping."};try{return this.middlewares.push(e),this.trackEnabled&&(yield this.setTransformedTrack()),{success:!0,message:"Successfully added the middleware."}}catch(t){return BS.error("While adding middleware",{error:t}),this.removeMiddleware(e),{success:!1,message:null==t?void 0:t.message}}}))}removeMiddleware(e){return tr(this,null,(function*(){const t=this.middlewares.indexOf(e,0);if(t>-1)try{return this.middlewares.splice(t,1),yield this.setTransformedTrack(!0),{success:!0,message:"Successfully removed the middleware."}}catch(e){return BS.error("While removing middleware",{error:e}),{success:!1,message:null==e?void 0:e.message}}return{success:!1,message:"No such middleware was found. Skipping."}}))}addMediaTrackListeners(){var e,t,r;this.mediaTrack&&(BS.info(`${this.constructorName}.addMediaTrackListeners for deviceId ${null==(t=null==(e=this.mediaTrack)?void 0:e.getSettings())?void 0:t.deviceId} of type ${null==(r=this.mediaTrack)?void 0:r.kind}`),this.mediaTrack.addEventListener("ended",this.onTrackEnded),this.mediaTrack.addEventListener("mute",this.onTrackMuted))}removeMediaTrackListeners(){var e,t,r;this.mediaTrack&&(BS.info(`${this.constructorName}.removeMediaTrackListeners for deviceId ${null==(t=null==(e=this.mediaTrack)?void 0:e.getSettings())?void 0:t.deviceId} of type ${null==(r=this.mediaTrack)?void 0:r.kind}`),BS.info(`${this.constructorName}.removeMediaTrackListeners`),this.mediaTrack.removeEventListener("ended",this.onTrackEnded),this.mediaTrack.removeEventListener("mute",this.onTrackMuted))}};VC=((e,t,r,n)=>{for(var i,s=t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(s)||s);return s})([KS((e=>{throw new $S(e.message,"1600")}))],VC);const BC=VC;var HC=Object.defineProperty,WC=Object.getOwnPropertyDescriptor,GC=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?WC(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&HC(t,r,s),s};const qC="[Dyte]nonSilentDeviceLabels";class $C extends BC{setDevice(e){return tr(this,null,(function*(){if(!e)throw BS.warn("AudioMediaHandler.setDevice No device received"),new $S("No device received!","1603");if("audioinput"!==e.kind)throw BS.warn("AudioMediaHandler.setDevice Received non audio device"),new $S("Non audio device received while setting device!","1603");try{const t=this.trackEnabled;this.userSelectedDevice=e.deviceId,yield this.setMediaTrack(yield this.mediaInterface.getAudioTrack(!t,e.deviceId))}catch(e){throw BS.error("AudioMediaHandler.setDevice.error",{error:e}),this.disableTrack(),new $S(e.message,"1604")}}))}enableTrack(e){return tr(this,null,(function*(){if(this.trackEnabled)return void BS.warn("AudioMediaHandler.enableTrack Track already enabled!");const t=yield this.mediaInterface.getAudioTrack(e,this.userSelectedDevice);yield this.setMediaTrack(t)}))}setTransformedTrack(e){return tr(this,null,(function*(){var t;if(e||null!=(t=this.middlewares)&&t.length)try{this.transformedMediaTrack=yield function(e,t){return tr(this,null,(function*(){if(null==e||!e.length)return t;const r=new AudioContext,n=yield Promise.all(null==e?void 0:e.map((e=>e(r)))),i=r.createMediaStreamSource(new MediaStream([t])),s=r.createMediaStreamDestination();try{let e=i;for(let t=0;t<n.length;t+=1)e.connect(n[t]),e=n[t];e.connect(s)}catch(e){return BS.error("getTransformedAudioTrack::middleware_execution_failed",{error:e}),t}return s.stream.getAudioTracks()[0]}))}(this.middlewares,this.mediaTrack),this.emit("trackChanged")}catch(e){BS.error("AudioMediaHandler.setTransformedTrack",{error:e}),this.transformedMediaTrack=this.mediaTrack}else this.transformedMediaTrack=this.mediaTrack}))}onTrackEnded(){return tr(this,null,(function*(){BS.info("AudioMediaHandler.TrackEnded"),this.emit("trackEnded");const e=this.mediaTrack.enabled;this.disableTrack(),yield this.enableTrack(!e),yield this.setTransformedTrack(),this.emit("trackChanged")}))}onTrackMuted(){BS.info("AudioMediaHandler.TrackMuted"),this.emit("trackMuted")}conditionallyChangeTrack(e){return tr(this,null,(function*(){var t;if(!e||this.userSelectedDevice)return e;let r=e;const n=yield this.mediaInterface.getAudioInputDevices(),i=this.isNonPreferredDevice?n.filter((e=>e&&!this.isNonPreferredDevice(e))):n;if(null==i||!i.length)return r;i.find((t=>t.deviceId===e.getSettings().deviceId))||(r.stop(),BS.info("localmediahandler::setupstreams::found_audio_non_preferred"),r=yield this.mediaInterface.getAudioTrack(!1,i[0].deviceId));const s=JSON.parse(xC(qC));if(null!=s&&s.devices.some((e=>e.label===r.label)))return r;if(!(yield FC(r))){const e=null!=(t=null==s?void 0:s.devices.concat({label:r.label}))?t:[{label:r.label}];return NC(qC,JSON.stringify({devices:e})),r}BS.info("AudioMediaHandler.conditionallyChangeTrack.DetectedSilentTrack");const o=r.getSettings().deviceId;return i.filter((e=>e.deviceId!==o)).some((e=>tr(this,null,(function*(){if(r=yield this.mediaInterface.getAudioTrack(!1,e.deviceId),!(yield FC(r))){const e=s.devices.concat({label:r.label});return NC(qC,JSON.stringify({devices:e})),BS.info("AudioMediaHandler.conditionallyChangeTrack.SuccesfullyChangedTrack"),!0}return BS.info("AudioMediaHandler.conditionallyChangeTrack.AnotherSilentTrackFound"),!1})))),r}))}}function zC(e,t,r){if(_S.isChromiumBased()){if("NotAllowedError"===t)return r.indexOf("by system")>0?"SYSTEM_DENIED":"screenshare"===e?"CANCELED":"DENIED";if("NotReadableError"===t)return"COULD_NOT_START"}else if(_S.isSafari()){if("NotAllowedError"===t)return"DENIED"}else if(_S.isFirefox()){if("NotFoundError"===t||"NotReadableError"===t)return"SYSTEM_DENIED";if("NotAllowedError"===t)return"DENIED";if("AbortError"===t)return"COULD_NOT_START"}return"COULD_NOT_START"}function JC(e){return e===2..toString()?Lr.DENIED:e===4..toString()?Lr.SYS_DENIED:e===1..toString()?Lr.ACCEPTED:Lr.FAILED}GC([VS.trace("AudioMediaHandler.setTransformedTrack")],$C.prototype,"setTransformedTrack",1),GC([VS.trace("AudioMediaHandler.onTrackEnded")],$C.prototype,"onTrackEnded",1),GC([VS.trace("AudioMediaHandler.conditionallyChangeTrack")],$C.prototype,"conditionallyChangeTrack",1);class KC{constructor(){Kt(this,"permissions"),this.permissions={audio:"NOT_REQUESTED",video:"NOT_REQUESTED",screenshare:"NOT_REQUESTED"}}getAudioInputDevices(){return tr(this,null,(function*(){return(yield this.getAvailableDevices()).filter((e=>"audioinput"===e.kind))}))}getVideoInputDevices(){return tr(this,null,(function*(){return(yield this.getAvailableDevices()).filter((e=>"videoinput"===e.kind))}))}getAudioOutputDevices(){return tr(this,null,(function*(){return(yield this.getAvailableDevices()).filter((e=>"audiooutput"===e.kind))}))}}var QC,YC,XC,ZC,eI=Object.defineProperty,tI=Object.getOwnPropertyDescriptor,rI=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?tI(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&eI(t,r,s),s};let nI=(ZC=class extends KC{constructor(e){super(),Xt(this,QC,void 0),Xt(this,YC,void 0),Xt(this,XC,void 0),Zt(this,XC,new NS(e)),Zt(this,YC,new AbortController),this.getAvailableDevices()}get constraintsBuilder(){return Yt(this,XC)}destruct(){return tr(this,null,(function*(){var e;null==(e=Yt(this,YC))||e.abort()}))}handlePermissionErrors(e,t){const r=zC(e,t.name,t.message);this.permissions[e]=r,tT.emit(XS.MEDIA_PERMISSION_ERROR,{message:r,constraints:t.constraints,kind:e})}getAudioAndVideoTrack(){return tr(this,null,(function*(){const e={audio:Yt(this,XC).getAudioConstraints().audio,video:Yt(this,XC).getVideoConstraints().video};try{BS.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(e)});const t=yield navigator.mediaDevices.getUserMedia(e);BS.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(e)});const r=t.getAudioTracks()[0];let n=t.getVideoTracks()[0];if(this.permissions.audio="ACCEPTED",this.permissions.video="ACCEPTED",In.hasFeature(DS.OBS_QUALITY)&&n.label.includes("OBS Virtual")){const e=(yield this.getVideoInputDevices()).find((e=>e.label.includes("OBS Virtual")));n=yield this.getVideoTrack(e.deviceId)}return tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),{audioTrack:r,videoTrack:n}}catch(e){throw BS.error("WebMediaInterface.getAudioAndVideoTrack",{error:e}),new $S("Couldnt fetch audio and video track")}}))}getAudioTrack(e,t){return tr(this,null,(function*(){const r=Yt(this,XC).getAudioConstraints(t);try{BS.info("getUserMediaWithoutTimeout::requesting_user_media",{constraints:JSON.stringify(r)});const t=(yield navigator.mediaDevices.getUserMedia(r)).getAudioTracks()[0];return BS.info("getUserMediaWithoutTimeout::received_user_media",{constraints:JSON.stringify(r)}),t.enabled=!e,this.permissions.audio="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),t}catch(e){throw this.handlePermissionErrors("audio",new EC(e.name,e.message,r)),new $S(e.message,"1601")}}))}getScreenShareTracks(){return tr(this,null,(function*(){const e=Yt(this,XC).getScreenShareConstraints();try{BS.info("getDisplayMediaWithoutTimeout::requesting_display_media",{constraints:JSON.stringify(e)});const t=yield navigator.mediaDevices.getDisplayMedia(e);return BS.info("getDisplayMediaWithoutTimeout::received_display_media",{constraints:JSON.stringify(e)}),this.permissions.screenshare="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.screenshare,kind:"screenshare"}),{audioTrack:t.getAudioTracks()[0],videoTrack:t.getVideoTracks()[0]}}catch(t){throw this.handlePermissionErrors("screenshare",new EC(t.name,t.message,e)),BS.error("WebMediaInterface.getScreenShareTracks Error while fetching screenshare tracks",{error:t}),new $S("Couldnt fetch screen share tracks")}}))}getCurrentDeviceLabel(e){return tr(this,null,(function*(){const t=yield this.getDevice(e||"default");return null==t?void 0:t.label}))}getVideoTrack(e){return tr(this,null,(function*(){const t=In.hasFeature(DS.OBS_QUALITY),r=yield this.getCurrentDeviceLabel(e),n=r&&r.includes("OBS Virtual"),{video:i}=Yt(this,XC).getVideoConstraints(e);let s={};s=t&&n&&"boolean"!=typeof i?{deviceId:i.deviceId}:i;try{const e=(yield navigator.mediaDevices.getUserMedia({video:s})).getVideoTracks()[0];if(t&&n&&"boolean"!=typeof i&&"object"==typeof i.width){const{width:t,height:r}=e.getSettings(),{ideal:n}=i.width;e.applyConstraints({width:{ideal:n},height:{ideal:Math.floor(r*n/t)},frameRate:i.frameRate})}return this.permissions.video="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),e}catch(e){throw this.handlePermissionErrors("video",new EC(e.name,e.message,s)),BS.error("WebMediaInterface.getVideoTrack Error while fetching video track",{error:e}),new $S("Couldnt fetch video track")}}))}getAvailableDevices(){return tr(this,null,(function*(){try{return yield navigator.mediaDevices.enumerateDevices()}catch(e){throw BS.error("enumerate_devices_failed",{error:e}),new $S("Failed to get available devices")}}))}getAvailableDevicesByKind(e){return tr(this,null,(function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((({kind:t})=>e===t))}catch(e){throw BS.error("enumerate_devices_failed",{error:e}),new $S("Failed to get available devices by kind")}}))}getDevice(e){return tr(this,null,(function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((t=>t.deviceId===e))[0]}catch(e){throw BS.error("enumerate_devices_failed",{error:e}),new $S("Failed to get device")}}))}onDeviceChange(e){return tr(this,null,(function*(){var t;if(null==(t=Yt(this,QC))||!t.length){const t=yield this.getAvailableDevices();null!=t&&t.length&&(Zt(this,QC,t),e(null,{added:t,removed:[]},!0))}_S.supportsDeviceChangeEvent()&&navigator.mediaDevices.addEventListener("devicechange",Qp((t=>tr(this,null,(function*(){var r,n;const i=Yt(this,QC),s=new Set(i.map((e=>e.deviceId))),o=yield this.getAvailableDevices(),a=new Set(o.map((e=>e.deviceId))),c={added:o.filter((e=>!s.has(e.deviceId))),removed:i.filter((e=>!a.has(e.deviceId)))};Zt(this,QC,o),(null!=(r=c.added)&&r.length||null!=(n=c.removed)&&n.length)&&e(t,c,!1)}))),100),{signal:Yt(this,YC).signal})}))}},QC=new WeakMap,YC=new WeakMap,XC=new WeakMap,ZC);rI([VS.trace("WebMediaInterface.destruct")],nI.prototype,"destruct",1),rI([VS.trace("WebMediaInterface.handlePermissionErrors")],nI.prototype,"handlePermissionErrors",1),rI([VS.trace("WebMediaInterface.getAudioAndVideoTrack")],nI.prototype,"getAudioAndVideoTrack",1),rI([VS.trace("WebMediaInterface.getAudioTrack")],nI.prototype,"getAudioTrack",1),rI([VS.trace("WebMediaInterface.getScreenShareTracks")],nI.prototype,"getScreenShareTracks",1),rI([VS.trace("WebMediaInterface.getVideoTrack")],nI.prototype,"getVideoTrack",1),rI([VS.trace("WebMediaInterface.getAvailableDevices")],nI.prototype,"getAvailableDevices",1),rI([VS.trace("WebMediaInterface.getAvailableDevicesByKind")],nI.prototype,"getAvailableDevicesByKind",1),rI([VS.trace("WebMediaInterface.getDevice")],nI.prototype,"getDevice",1),rI([VS.trace("WebMediaInterface.onDeviceChange")],nI.prototype,"onDeviceChange",1),nI=rI([KS((e=>{throw new $S(e.message,"1600")}))],nI);const iI=nI;var sI,oI;class aI{constructor(e){Xt(this,sI,void 0),Kt(this,"currentDevice"),Zt(this,sI,e)}setupSpeaker(e){return tr(this,null,(function*(){var t;if(!(Yt(this,sI)instanceof iI))return;let r=e;if(e||([r]=yield Yt(this,sI).getAvailableDevicesByKind("audiooutput")),!r)throw new $S("No speaker found");(null==(t=this.currentDevice)?void 0:t.deviceId)!==r.deviceId&&(null!=this.currentDevice||(this.currentDevice=r),document.querySelectorAll("audio").forEach((e=>tr(this,null,(function*(){if(void 0!==e.sinkId&&this.currentDevice.deviceId&&e.sinkId!==this.currentDevice.deviceId)try{yield e.setSinkId(this.currentDevice.deviceId)}catch(e){}})))))}))}}sI=new WeakMap;class cI extends HS{constructor(e){super(),Kt(this,"mediaInterface"),Kt(this,"audioMediaTrack"),Kt(this,"videoMediaTrack"),this.mediaInterface=e}get trackEnabled(){return!!this.videoMediaTrack}enableScreenShare(){return tr(this,null,(function*(){var e,t;const{audioTrack:r,videoTrack:n}=yield this.mediaInterface.getScreenShareTracks();this.audioMediaTrack=r,this.videoMediaTrack=n,this.addMediaTrackListeners(),"ACCEPTED"!==(null==(t=null==(e=this.mediaInterface)?void 0:e.permissions)?void 0:t.screenshare)&&this.mediaInterface.permissions&&(this.mediaInterface.permissions.screenshare="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.mediaInterface.permissions.screenshare,kind:"screenshare"}))}))}disableScreenShare(){var e,t;this.removeMediaTrackListeners(),null==(e=this.audioMediaTrack)||e.stop(),null==(t=this.videoMediaTrack)||t.stop(),this.videoMediaTrack=void 0,this.audioMediaTrack=void 0}updateConstraints(e){return tr(this,null,(function*(){if(!this.videoMediaTrack)throw new $S("No media track enabled!");const t=this.mediaInterface;if(!t.constraintsBuilder)throw new $S("update constraints not supported for non web clients","1100");try{this.videoMediaTrack.applyConstraints(t.constraintsBuilder.getUpdatedVideoConstraints(e)),this.addMediaTrackListeners()}catch(e){BS.error("ScreenShareHandler.updateConstraints.error",{error:e})}}))}addMediaTrackListeners(){var e;null==(e=this.videoMediaTrack)||e.addEventListener("ended",this.onTrackEnded.bind(this))}removeMediaTrackListeners(){var e;null==(e=this.videoMediaTrack)||e.removeEventListener("ended",this.onTrackEnded)}onTrackEnded(){this.emit("trackEnded")}}class dI{constructor(){Xt(this,oI,void 0)}terminateMiddlewareWebWorker(){if(Yt(this,oI))try{Mt(Yt(this,oI)),Zt(this,oI,void 0)}catch(e){BS.debug("WorkerTimers::terminateMiddlewareWebWorker::failed")}}getTransformedVideoTrack(e,t){return tr(this,null,(function*(){if(null==e||!e.length)return t;const r=yield Promise.all(null==e?void 0:e.map((e=>e()))),n=new MediaStream;n.addTrack(t);const i=document.createElement("canvas"),s=i.getContext("2d"),o=document.createElement("video");o.srcObject=n,o.autoplay=!0,this.terminateMiddlewareWebWorker();const a=()=>tr(this,null,(function*(){if(!1===t.enabled||"ended"===t.readyState)return this.terminateMiddlewareWebWorker(),o.remove(),void i.remove();try{s.drawImage(o,0,0);for(let e=0;e<r.length;e+=1)yield r[e](i,s)}catch(e){BS.error("getTransformedVideoTrack::middleware_execution_failed",{error:e})}}));try{o.play()}catch(e){}return o.addEventListener("play",(()=>{i.width=o.width||t.getSettings().width,i.height=o.width||t.getSettings().height,Zt(this,oI,Nt(a,50))}),!1),i.captureStream().getVideoTracks()[0]}))}}oI=new WeakMap;var lI,uI=Object.defineProperty,hI=Object.getOwnPropertyDescriptor,pI=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?hI(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&uI(t,r,s),s};class mI extends BC{constructor(e,t,r){super(e,t,r),Xt(this,lI,void 0),Zt(this,lI,new dI)}setDevice(e){return tr(this,null,(function*(){if(!e)throw BS.warn("VideoMediaHandler.setDevice No device received"),new $S("No device received!");if("videoinput"!==e.kind)throw BS.warn("VideoMediaHandler.setDevice Received non video device",{devices:[e]}),new $S("Non video device received while setting video device!");if(this.userSelectedDevice=e.deviceId,!this.mediaTrack||!this.mediaTrack.enabled)return BS.warn("VideoMediaHandler.setDevice Tried switching device with video disabled",{devices:[e]}),void(this.currentDevice=e);try{yield this.setMediaTrack(yield this.mediaInterface.getVideoTrack(this.userSelectedDevice))}catch(e){throw BS.error("VideoMediaHandler.setDevice.error",{error:e}),this.disableTrack(),new $S("Failed to change device")}}))}enableTrack(){return tr(this,null,(function*(){this.trackEnabled?BS.warn("VideoMediaHandler.enableTrack Track already enabled!"):yield this.setMediaTrack(yield this.mediaInterface.getVideoTrack(this.userSelectedDevice))}))}setTransformedTrack(e){return tr(this,null,(function*(){var t;if(e||null!=(t=this.middlewares)&&t.length)try{this.transformedMediaTrack=yield Yt(this,lI).getTransformedVideoTrack(this.middlewares,this.mediaTrack),this.emit("trackChanged")}catch(e){BS.error("VideoMediaHandler.setTransformedTrack",{error:e}),this.transformedMediaTrack=this.mediaTrack}else this.transformedMediaTrack=this.mediaTrack}))}updateConstraints(e){return tr(this,null,(function*(){if(!this._mediaTrack)throw new $S("No media track enabled!");const t=this.mediaInterface;if(!t.constraintsBuilder)throw new $S("update constraints not supported for non web clients","1100");try{this._mediaTrack.applyConstraints(t.constraintsBuilder.getUpdatedVideoConstraints(e)),yield this.setTransformedTrack(),this.addMediaTrackListeners(),yield this.setCurrentDevice()}catch(e){BS.error("VideoMediaHandler.updateConstraints.error",{error:e})}}))}terminateMiddlewareWebWorker(){Yt(this,lI).terminateMiddlewareWebWorker()}onTrackEnded(){return tr(this,null,(function*(){BS.info("VideoMediaHandler.TrackEnded"),this.disableTrack(),this.emit("trackEnded")}))}onTrackMuted(){BS.info("VideoMediaHandler.TrackMuted"),this.emit("trackMuted")}conditionallyChangeTrack(e){return tr(this,null,(function*(){if(!e||this.userSelectedDevice)return e;let t=e;const r=yield this.mediaInterface.getVideoInputDevices(),n=this.isNonPreferredDevice?r.filter((e=>!this.isNonPreferredDevice(e))):r;return!(null!=n&&n.length)||window.FAST_DYTE||n.find((t=>t.deviceId===e.getSettings().deviceId))||(t.stop(),BS.info("localmediahandler::setupstreams::found_video_non_preferred"),t=yield this.mediaInterface.getVideoTrack(n[0].deviceId)),t}))}}lI=new WeakMap,pI([VS.trace("VideoMediaHandler.setTransformedTrack")],mI.prototype,"setTransformedTrack",1),pI([VS.trace("VideoMediaHandler.onTrackEnded")],mI.prototype,"onTrackEnded",1),pI([VS.trace("VideoMediaHandler.conditionallyChangeTrack")],mI.prototype,"conditionallyChangeTrack",1);var fI,gI,vI,yI,_I,SI,TI=Object.defineProperty,EI=Object.getOwnPropertyDescriptor,bI=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?EI(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&TI(t,r,s),s};class wI extends HS{constructor(e,t=IC,r=!0){super(),Xt(this,fI,void 0),Xt(this,gI,void 0),Xt(this,vI,void 0),Xt(this,yI,void 0),Xt(this,_I,void 0),Xt(this,SI,void 0),Kt(this,"audioUpdateInProgress"),Kt(this,"videoUpdateInProgress"),this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,Zt(this,fI,new iI(e)),Zt(this,gI,new $C(Yt(this,fI),void 0,t)),Zt(this,vI,new mI(Yt(this,fI),void 0,t)),Zt(this,_I,new cI(Yt(this,fI))),Zt(this,yI,new aI(Yt(this,fI))),Zt(this,SI,r),Yt(this,gI).on("trackMuted",this.onAudioTrackMuted.bind(this)),Yt(this,gI).on("trackChanged",this.onAudioTrackChanged.bind(this)),Yt(this,vI).on("trackChanged",this.onVideoTrackChanged.bind(this)),Yt(this,vI).on("trackEnded",this.onVideoTrackEnded.bind(this)),Yt(this,_I).on("trackEnded",this.onScreenShareEnded.bind(this)),this.onVisibilityChange=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){gn.tabChanged("visible"===document.visibilityState),"visible"!==document.visibilityState?gn.browserBackgrounded():gn.browserForegrounded()}repopulateAvailableDevices(){return tr(this,null,(function*(){return!0}))}setupStreams(e){return tr(this,arguments,(function*({audio:e,video:t}){let r,n;if(e&&t)try{const e=yield Yt(this,fI).getAudioAndVideoTrack();r=e.audioTrack,n=e.videoTrack}catch(e){BS.error("LocalMediaHandler::init::Failed to get audio video tracks",{error:e})}if(!r&&e)try{r=yield Yt(this,fI).getAudioTrack(!1)}catch(e){BS.error("LocalMediaHandler::init::Failed to get audio track",{error:e})}if(!n&&t)try{n=yield Yt(this,fI).getVideoTrack()}catch(e){BS.error("LocalMediaHandler::init::Failed to get video track",{error:e})}yield Yt(this,gI).setMediaTrack(r),yield Yt(this,vI).setMediaTrack(n);try{yield Yt(this,yI).setupSpeaker()}catch(e){}Yt(this,fI).onDeviceChange(((e,t,r)=>{this.onDeviceChange(t,r)}))}))}getCurrentDevices(){return{audio:Yt(this,gI).currentDevice,video:Yt(this,vI).currentDevice,speaker:Yt(this,yI).currentDevice}}get permissions(){return Yt(this,fI).permissions}getAllDevices(){return Yt(this,fI).getAvailableDevices()}getDeviceById(e,t){return Yt(this,fI).getDevice(e)}onAudioTrackMuted(){this.emit("AUDIO_TRACK_SILENT")}onAudioTrackChanged(){this.emit("AUDIO_TRACK_CHANGE")}get rawAudioTrack(){return Yt(this,gI).mediaTrack}get audioTrack(){return Yt(this,gI).transformedMediaTrack}get audioEnabled(){return Yt(this,gI).trackEnabled}enableAudio(){return tr(this,null,(function*(){if(!this.audioUpdateInProgress){this.audioUpdateInProgress=!0;try{yield Yt(this,gI).unmuteTrack()}finally{this.audioUpdateInProgress=!1}}}))}disableAudio(){Yt(this,gI).muteTrack()}getAudioDevices(){return Yt(this,fI).getAudioInputDevices()}setAudioDevice(e){return tr(this,null,(function*(){yield Yt(this,gI).setDevice(e),this.emit("AUDIO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:e})}))}setupSpeaker(){return Yt(this,yI).setupSpeaker()}setSpeakerDevice(e){return tr(this,null,(function*(){yield Yt(this,yI).setupSpeaker(e),this.emit("DEVICE_CHANGE",{device:e})}))}onVideoTrackChanged(){this.emit("VIDEO_TRACK_CHANGE")}onVideoTrackEnded(){this.emit("VIDEO_TRACK_CHANGE")}get rawVideoTrack(){return Yt(this,vI).mediaTrack}get videoTrack(){return Yt(this,vI).transformedMediaTrack}get videoEnabled(){return Yt(this,vI).trackEnabled}enableVideo(){return tr(this,null,(function*(){if(!this.videoUpdateInProgress){this.videoUpdateInProgress=!0;try{yield Yt(this,vI).unmuteTrack()}finally{this.videoUpdateInProgress=!1}}}))}disableVideo(){Yt(this,vI).disableTrack()}getVideoDevices(){return Yt(this,fI).getVideoInputDevices()}setVideoDevice(e){return tr(this,null,(function*(){yield Yt(this,vI).setDevice(e),this.emit("VIDEO_TRACK_CHANGE"),this.emit("DEVICE_CHANGE",{device:e})}))}updateVideoConstraints(e){return tr(this,null,(function*(){yield Yt(this,vI).updateConstraints(e)}))}onScreenShareEnded(){this.emit("SCREENSHARE_ENDED")}get screenShareTracks(){return{audio:Yt(this,_I).audioMediaTrack,video:Yt(this,_I).videoMediaTrack}}get screenShareEnabled(){return Yt(this,_I).trackEnabled}enableScreenShare(){return tr(this,null,(function*(){yield Yt(this,_I).enableScreenShare()}))}disableScreenShare(){return tr(this,null,(function*(){Yt(this,_I).disableScreenShare()}))}updateScreenshareConstraints(e){return tr(this,null,(function*(){yield Yt(this,_I).updateConstraints(e)}))}getSpeakerDevices(){return Yt(this,fI).getAudioOutputDevices()}addAudioMiddleware(e){return Yt(this,gI).addMiddleware(e)}removeAudioMiddleware(e){return Yt(this,gI).removeMiddleware(e)}addVideoMiddleware(e){return Yt(this,vI).addMiddleware(e)}removeVideoMiddleware(e){return Yt(this,vI).removeMiddleware(e)}destruct(){Yt(this,gI).disableTrack(),Yt(this,vI).disableTrack(),Yt(this,vI).terminateMiddlewareWebWorker(),Yt(this,_I).disableScreenShare(),Yt(this,fI).destruct()}onDeviceChange(e,t){return tr(this,null,(function*(){var r;const n=yield Yt(this,fI).getAvailableDevices();BS.info("repopulated_full_device_list",{devices:JSON.stringify(n)}),gn.onSafeInitialization((()=>tr(this,null,(function*(){gn.devices("AUDIO",null==n?void 0:n.filter((e=>"audioinput"===e.kind))),gn.devices("VIDEO",null==n?void 0:n.filter((e=>"videoinput"===e.kind))),gn.devices("SPEAKER",null==n?void 0:n.filter((e=>"audiooutput"===e.kind)))})))),this.emit("DEVICE_LIST_UPDATED",e),!t&&Yt(this,SI)&&(null==(r=null==e?void 0:e.added)||r.forEach((e=>tr(this,null,(function*(){var t;e&&!IC(e)&&("audioinput"===e.kind&&!0===(null==(t=this.audioTrack)?void 0:t.enabled)?yield this.setAudioDevice(e):"audiooutput"===e.kind&&(yield this.setSpeakerDevice(e)))})))))}))}removeAllTracks(){this.destruct()}removeDocumentEventListeners(){return tr(this,null,(function*(){document.removeEventListener("visibilitychange",this.onVisibilityChange)}))}}fI=new WeakMap,gI=new WeakMap,vI=new WeakMap,yI=new WeakMap,_I=new WeakMap,SI=new WeakMap,bI([VS.trace("MediaHandler.setupStreams")],wI.prototype,"setupStreams",1),bI([VS.trace("MediaHandler.enableAudio")],wI.prototype,"enableAudio",1),bI([VS.trace("MediaHandler.disableAudio")],wI.prototype,"disableAudio",1),bI([VS.trace("MediaHandler.setAudioDevice")],wI.prototype,"setAudioDevice",1),bI([VS.trace("MediaHandler.enableVideo")],wI.prototype,"enableVideo",1),bI([VS.trace("MediaHandler.disableVideo")],wI.prototype,"disableVideo",1),bI([VS.trace("MediaHandler.setVideoDevice")],wI.prototype,"setVideoDevice",1),bI([VS.trace("MediaHandler.updateVideoConstraints")],wI.prototype,"updateVideoConstraints",1),bI([VS.trace("MediaHandler.enableScreenShare")],wI.prototype,"enableScreenShare",1),bI([VS.trace("MediaHandler.disableScreenShare")],wI.prototype,"disableScreenShare",1),bI([VS.trace("MediaHandler.updateScreenshareConstraints")],wI.prototype,"updateScreenshareConstraints",1),bI([VS.trace("MediaHandler.destruct")],wI.prototype,"destruct",1),bI([VS.trace("MediaHandler.onDeviceChange")],wI.prototype,"onDeviceChange",1);var kI,RI,CI=Object.defineProperty,II=Object.getOwnPropertyDescriptor,AI=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?II(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&CI(t,r,s),s};class PI{constructor(e){Xt(this,kI,void 0),Kt(this,"audioMiddlewares",[]),Kt(this,"videoMiddlewares",[]),Xt(this,RI,void 0),Zt(this,kI,e)}terminateMiddlewareWebWorker(){if(Yt(this,RI))try{Mt(Yt(this,RI)),Zt(this,RI,void 0)}catch(e){BS.debug("WorkerTimers::terminateMiddlewareWebWorker::failed")}}getTransformedVideoTrack(e){return tr(this,null,(function*(){var t,r;if(null==(t=this.videoMiddlewares)||!t.length)return e;const n=yield Promise.all(null==(r=this.videoMiddlewares)?void 0:r.map((e=>e()))),i=new MediaStream;i.addTrack(e);const s=document.createElement("canvas"),o=s.getContext("2d"),a=document.createElement("video");a.srcObject=i,a.autoplay=!0,this.terminateMiddlewareWebWorker();const c=()=>tr(this,null,(function*(){if(!Yt(this,kI).videoEnabled||"ended"===e.readyState)return this.terminateMiddlewareWebWorker(),a.remove(),void s.remove();try{o.drawImage(a,0,0);for(let e=0;e<n.length;e+=1)yield n[e](s,o)}catch(e){BS.error("getTransformedVideoTrack::middleware_execution_failed",{error:e})}}));try{a.play()}catch(e){}return a.addEventListener("play",(()=>{s.width=a.width||e.getSettings().width,s.height=a.width||e.getSettings().height,Zt(this,RI,Nt(c,50))}),!1),s.captureStream().getVideoTracks()[0]}))}addVideoMiddleware(e){return tr(this,null,(function*(){return _S.isWebKitBased()&&!In.hasFeature(DS.ALLOW_SAFARI_MEDIA_MIDDLEWARES)?{success:!1,message:"Video middlewares are not supported in this WebKit engine based browser."}:this.videoMiddlewares.includes(e)?{success:!0,message:"This video middleware has been applied, already. Skipping."}:(this.videoMiddlewares.push(e),Yt(this,kI).videoEnabled?(Yt(this,kI).setVideoTrack(yield this.getTransformedVideoTrack(Yt(this,kI).rawVideoTrack)),Yt(this,kI).emit("VIDEO_TRACK_CHANGE"),{success:!0,message:"Successfully applied the video middleware."}):{success:!0,message:"Successfully added the video middleware. It will be applied automatically once webcam is turned on."})}))}removeVideoMiddleware(e){return tr(this,null,(function*(){const t=this.videoMiddlewares.indexOf(e,0);return t>-1?(this.videoMiddlewares.splice(t,1),Yt(this,kI).videoEnabled&&(Yt(this,kI).setVideoTrack(yield this.getTransformedVideoTrack(Yt(this,kI).rawVideoTrack)),Yt(this,kI).emit("VIDEO_TRACK_CHANGE")),{success:!0,message:"Successfully removed the video middleware."}):{success:!0,message:"No such video middleware was found. Skipping."}}))}getTransformedAudioTrack(e){return tr(this,null,(function*(){var t,r;if(null==(t=this.audioMiddlewares)||!t.length)return e;const n=new AudioContext,i=yield Promise.all(null==(r=this.audioMiddlewares)?void 0:r.map((e=>e(n)))),s=n.createMediaStreamSource(new MediaStream([e])),o=n.createMediaStreamDestination();try{let e=s;for(let t=0;t<i.length;t+=1)e.connect(i[t]),e=i[t];e.connect(o)}catch(t){return BS.error("getTransformedAudioTrack::middleware_execution_failed",{error:t}),e}return o.stream.getAudioTracks()[0]}))}addAudioMiddleware(e){return tr(this,null,(function*(){return _S.isWebKitBased()&&!In.hasFeature(DS.ALLOW_SAFARI_MEDIA_MIDDLEWARES)?{success:!1,message:"Audio middlewares are not supported in this WebKit engine based browser."}:this.audioMiddlewares.includes(e)?{success:!0,message:"This audio middleware has been applied, already. Skipping."}:(this.audioMiddlewares.push(e),Yt(this,kI).audioEnabled?(Yt(this,kI).setAudioTrack(yield this.getTransformedAudioTrack(Yt(this,kI).rawAudioTrack)),Yt(this,kI).emit("AUDIO_TRACK_CHANGE"),{success:!0,message:"Successfully applied the audio middleware."}):{success:!0,message:"Successfully added the audio middleware. It will be applied automatically once mic is turned on."})}))}removeAudioMiddleware(e){return tr(this,null,(function*(){const t=this.audioMiddlewares.indexOf(e,0);return t>-1?(this.audioMiddlewares.splice(t,1),Yt(this,kI).audioEnabled&&(Yt(this,kI).setAudioTrack(yield this.getTransformedAudioTrack(Yt(this,kI).rawAudioTrack)),Yt(this,kI).emit("AUDIO_TRACK_CHANGE")),{success:!0,message:"Successfully removed the audio middleware."}):{success:!0,message:"No such audio middleware was found. Skipping."}}))}}kI=new WeakMap,RI=new WeakMap,AI([VS.trace("MediaMiddlewareUtils.getTransformedVideoTrack")],PI.prototype,"getTransformedVideoTrack",1),AI([VS.trace("MediaMiddlewareUtils.addVideoMiddleware")],PI.prototype,"addVideoMiddleware",1),AI([VS.trace("MediaMiddlewareUtils.removeVideoMiddleware")],PI.prototype,"removeVideoMiddleware",1),AI([VS.trace("MediaMiddlewareUtils.getTransformedAudioTrack")],PI.prototype,"getTransformedAudioTrack",1),AI([VS.trace("MediaMiddlewareUtils.addAudioMiddleware")],PI.prototype,"addAudioMiddleware",1),AI([VS.trace("MediaMiddlewareUtils.removeAudioMiddleware")],PI.prototype,"removeAudioMiddleware",1);const DI=class{constructor(){Kt(this,"mediaPermissionEvent"),this.mediaPermissionEvent=!0}static getInstance(){return DI.instance||(DI.instance=new DI),DI.instance}get shouldEmitMediaPermissionEvent(){return this.mediaPermissionEvent}setEmitMediaPermissionEvent(e){this.mediaPermissionEvent=e}};let OI=DI;Kt(OI,"instance");const MI=OI.getInstance(),NI={lowVolumeThreshold:-40,clipThreshold:1,silentThreshold:1/1987,delay:500,media:"audio"};var xI,LI,UI,jI,FI,VI;const BI=class{constructor(e){Xt(this,UI),Xt(this,FI),Kt(this,"analyser"),Kt(this,"silentThreshold"),Kt(this,"lowVolumeThreshold"),Kt(this,"clipThreshold"),Kt(this,"delay"),Kt(this,"audioContext"),Kt(this,"audioSource"),Kt(this,"metadata",{}),Kt(this,"analysing"),Kt(this,"track"),Xt(this,xI,void 0),Xt(this,LI,void 0);const{lowVolumeThreshold:t,silentThreshold:r,clipThreshold:n,delay:i,media:s}=$t($t({},NI),e);this.lowVolumeThreshold=t,this.silentThreshold=r,this.clipThreshold=n,this.delay=i,this.analysing=!1,Zt(this,LI,s)}setTrack(e){if(!e)return;this.track=e.clone();const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.analyser=this.audioContext.createAnalyser(),"screenshare"!==Yt(this,LI)?tT.emit(XS.AUDIO_TRACK_CREATED):tT.emit(XS.SCREENSHARE_AUDIO_TRACK_CREATED)}getTrackMetadata(){if(!this.track)return null;switch(this.metadata.label=this.track.label,this.metadata.channelCountMode=this.analyser.channelCountMode,this.metadata.channelCount=this.analyser.channelCount,this.metadata.channelInterpretation=this.analyser.channelInterpretation,this.metadata.outputs=this.analyser.numberOfOutputs,this.analyser.numberOfOutputs){case 1:this.metadata.channelType="MONO";break;case 2:this.metadata.channelType="STEREO";break;case 4:this.metadata.channelType="QUAD"}return this.metadata}startTrackAnalysis(){return tr(this,null,(function*(){if(!this.track||this.analysing)return!1;try{return yield this.audioContext.resume(),yield er(this,UI,jI).call(this),this.analysing=!0,!0}catch(e){return BS.error(e),!1}}))}stopTrackAnalysis(){this.analysing&&(this.analysing=!1,clearTimeout(Yt(this,xI)))}cleanup(){var e,t,r,n,i;this.stopTrackAnalysis(),null==(e=this.analyser)||e.disconnect(),null==(t=this.audioSource)||t.disconnect(this.analyser),null==(r=this.audioSource)||r.disconnect(),null==(n=this.audioContext)||n.close(),this.audioContext=void 0,this.analyser=void 0,this.audioSource=void 0,null==(i=this.track)||i.stop(),this.track=void 0,"screenshare"!==Yt(this,LI)?tT.emit(XS.AUDIO_TRACK_CLOSED):tT.emit(XS.SCREENSHARE_AUDIO_TRACK_CLOSED)}static dbFS(e){const t=Math.log(e)/Math.log(10)*20;return Math.round(10*t)/10}};let HI=BI;xI=new WeakMap,LI=new WeakMap,UI=new WeakSet,jI=function(){return tr(this,null,(function*(){try{const e=new MediaStream;e.addTrack(this.track),this.audioSource=this.audioContext.createMediaStreamSource(e),this.audioSource.connect(this.analyser),yield new Promise((e=>{window.requestAnimationFrame((()=>{er(this,FI,VI).call(this),e(!0)}))}))}catch(e){BS.error(e)}}))},FI=new WeakSet,VI=function(){const e=new Float32Array(this.analyser.fftSize);this.analyser.getFloatTimeDomainData(e);let t=0;for(const r of e)t+=r*r;const r=Math.sqrt(t/e.length),n={volume:r,lowVolume:BI.dbFS(r)<this.lowVolumeThreshold,silence:r<this.silentThreshold,clip:r>this.clipThreshold,timestamp:(new Date).getTime()};"screenshare"===Yt(this,LI)?tT.emit(XS.SCREENSHARE_AUDIO_TRACK_ANALYSIS,n):tT.emit(XS.AUDIO_TRACK_ANALYSIS,n),Zt(this,xI,setTimeout((()=>{window.requestAnimationFrame(er(this,FI,VI).bind(this))}),this.delay))};const WI=new HI,GI=new HI({media:"screenshare"}),qI={},$I=({methodName:e,lockName:t,timeout:r})=>(n,i,s)=>{const o=s.value;return s.value=function(...n){if(qI[t]){const r=new Error(`Unsupported concurrent calls on Dyte method: ${e}.`);throw r.name="UnsupportedConcurrentMethodExecution",BS.error("DyteLocker::UnsupportedConcurrentMethodExecution",{error:{stack:r.stack},dyteLocker:{methodName:e,lockName:t}}),r}qI[t]=!0;const i=setTimeout((()=>delete qI[t]),r),s=o.apply(this,n);return Promise.resolve(s).then((()=>{delete qI[t],clearTimeout(i)})).catch((()=>{delete qI[t],clearTimeout(i)})),s},s};var zI,JI,KI,QI=Object.defineProperty,YI=Object.getOwnPropertyDescriptor,XI=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?YI(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&QI(t,r,s),s};const ZI=(KI=class extends nr.EventEmitter{constructor(e,t){super(),Xt(this,zI,void 0),Xt(this,JI,void 0),Kt(this,"mediaMiddlewareUtils"),Kt(this,"audioTrack"),Kt(this,"rawAudioTrack"),Kt(this,"videoTrack"),Kt(this,"rawVideoTrack"),Kt(this,"screenShareTracks"),Kt(this,"audioEnabled"),Kt(this,"videoEnabled"),Kt(this,"screenShareEnabled"),Kt(this,"currentDevices"),Kt(this,"permissions"),Kt(this,"audioUpdateInProgress"),Kt(this,"videoUpdateInProgress"),Kt(this,"screenShareUpdateInProgress"),Kt(this,"initialSetupComplete",!1),Kt(this,"isDeprecated",(()=>!0)),Zt(this,zI,e),Zt(this,JI,new NS(t)),this.audioEnabled=!0,this.videoEnabled=!0,this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,this.screenShareUpdateInProgress=!1,this.screenShareEnabled=!1,this.permissions={audio:"NOT_REQUESTED",video:"NOT_REQUESTED",screenshare:"NOT_REQUESTED"},this.screenShareTracks={audio:void 0,video:void 0},this.currentDevices={audio:void 0,video:void 0,speaker:void 0},Yt(this,zI).onDeviceChange(((e,t)=>{this.onDeviceChange(t,!1),this.emit("DEVICE_LIST_UPDATED",t)})),this.conditionallyRestartAudio=this.conditionallyRestartAudio.bind(this),this.conditionallyRestartVideo=this.conditionallyRestartVideo.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.onVisibilityChange),this.on("AUDIO_TRACK_CHANGE",(()=>{this.notifyIfTrackSilent()})),tT.on(XS.PRODUCER_TRACK_ENDED,(({kind:e})=>{"mic"===e&&this.conditionallyRestartAudio(),"webcam"===e&&this.conditionallyRestartVideo()}))}handlePermissionErrors(e,t){const r=zC(e,t.name,t.message);this.permissions[e]=r,tT.emit(XS.MEDIA_PERMISSION_ERROR,{message:r,constraints:t.constraints,kind:e})}repopulateAvailableDevices(){return tr(this,null,(function*(){return Yt(this,zI).repopulateAvailableDevices()}))}onVisibilityChange(e){"visible"===document.visibilityState&&(_S.isMobile()&&this.conditionallyRestartAudio(),this.conditionallyRestartVideo()),gn.tabChanged("visible"===document.visibilityState),"visible"!==document.visibilityState?gn.browserBackgrounded():gn.browserForegrounded()}conditionallyRestartAudio(e){return tr(this,null,(function*(){var t,r;yield new Promise((e=>setTimeout(e,50))),BS.info("performingCheck::shouldReacquireAudioTrack",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}});const n=yield this.shouldReacquireTrack("audio");BS.info("performedCheck::shouldReacquireAudioTrack",{actions:{trackRobustness:{reacquireTrack:n}}}),n&&(BS.info("reacquiring_audio_track"),this.removeMediaStreamTrackListeners(this.rawAudioTrack),_S.isChromiumBased()&&(yield Yt(this,zI).repopulateAvailableDevices()),yield this.setupAudioStream(null==(r=null==(t=this.currentDevices)?void 0:t.audio)?void 0:r.deviceId),this.addMediaStreamTrackListeners(this.rawAudioTrack),this.emit("AUDIO_TRACK_CHANGE"))}))}conditionallyRestartVideo(e){return tr(this,null,(function*(){var t,r;yield new Promise((e=>setTimeout(e,50))),BS.info("performingCheck::shouldReacquireVideoTrack",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}});const n=yield this.shouldReacquireTrack("video");BS.info("performedCheck::shouldReacquireVideoTrack",{actions:{trackRobustness:{reacquireTrack:n}}}),n&&(BS.info("reacquiring_video_track"),this.removeMediaStreamTrackListeners(this.rawVideoTrack),yield Yt(this,zI).repopulateAvailableDevices(),yield this.setupVideoStream(null==(r=null==(t=this.currentDevices)?void 0:t.video)?void 0:r.deviceId),this.addMediaStreamTrackListeners(this.rawVideoTrack),this.emit("VIDEO_TRACK_CHANGE"))}))}shouldReacquireTrack(e){return tr(this,null,(function*(){if("audio"===e){if(this.audioUpdateInProgress||!this.audioEnabled)return!1;if(!this.rawAudioTrack||!this.audioTrack)return!0;const e=this.rawAudioTrack.muted||this.audioTrack.muted;return("ended"===this.rawAudioTrack.readyState||"ended"===this.audioTrack.readyState)&&this.audioEnabled||e}if(this.videoUpdateInProgress||!this.videoEnabled)return!1;if(!this.rawVideoTrack||!this.videoTrack)return!0;const t=this.rawVideoTrack.muted||this.videoTrack.muted,r=("ended"===this.rawVideoTrack.readyState||"ended"===this.videoTrack.readyState)&&this.videoEnabled;return"visible"===document.visibilityState&&(r||t)}))}onAudioUnmute(e){BS.info("audio_track_unmuted",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}})}onVideoUnmute(e){BS.info("video_track_unmuted",{actions:{trackRobustness:{eventType:null==e?void 0:e.type}}})}removeMediaStreamTrackListeners(e){if(BS.info(`Removing ${e.kind} listerners`),!e)return;const t="audio"===e.kind?this.conditionallyRestartAudio:this.conditionallyRestartVideo;return e.removeEventListener("ended",t),e.removeEventListener("mute",t),e.removeEventListener("unmute","audio"===e.kind?this.onAudioUnmute:this.onVideoUnmute),e}addMediaStreamTrackListeners(e){if(!e)return null;BS.info(`adding_${e.kind}_stream_listerners`);const t="audio"===e.kind,r=t?this.conditionallyRestartAudio:this.conditionallyRestartVideo;return e.addEventListener("ended",(()=>tr(this,null,(function*(){yield r();const n=t?this.audioEnabled:this.videoEnabled,i=t?this.audioTrack:this.videoTrack,s=t?"FORCE_MUTE_AUDIO":"FORCE_MUTE_VIDEO";n&&(!i||"live"!==i.readyState||!i.enabled)&&(BS.info(`LocalMediaHandler::trackEnded::Failed to restart ${e.kind} track`),this.emit(s))})))),e.addEventListener("mute",r),e.addEventListener("unmute",t?this.onAudioUnmute:this.onVideoUnmute),e}notifyIfTrackSilent(){return tr(this,null,(function*(){var e,t,r,n,i,s;this.audioEnabled&&this.audioTrack&&"ended"!==this.audioTrack.readyState&&this.audioTrack.enabled&&!0===(yield FC(this.audioTrack))&&(BS.info("LocalMediaHandler:notifyIfTrackSilent:TrackSilent",{media:{audio:{enabled:this.audioEnabled,deviceId:null==(t=null==(e=this.audioTrack)?void 0:e.getSettings())?void 0:t.deviceId,permission:null==(r=this.permissions)?void 0:r.audio,deviceName:null==(i=null==(n=this.currentDevices)?void 0:n.audio)?void 0:i.label,trackId:null==(s=this.audioTrack)?void 0:s.id}}}),this.emit("AUDIO_TRACK_SILENT"))}))}setupAudioStream(e,t=!0){return tr(this,null,(function*(){var r,n,i;if(!this.audioUpdateInProgress)try{this.audioUpdateInProgress=!0;const s=Yt(this,zI).getAudioDevices();if(!s.length)throw this.audioEnabled=!1,new EC("COULD_NOT_START","No audio devices",{});let o=e;(!o||!s.find((e=>e.deviceId===o)))&&(o=yield this.getPreferredDeviceId("AUDIO"),BS.debug("setupAudioStream::AUDIO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:o,kind:"audio"}}));const a=MC.getAudioConstraints({audioDeviceId:o});t&&(null==(r=this.rawAudioTrack)||r.stop(),null==(n=this.audioTrack)||n.stop()),this.rawAudioTrack=yield MC.getAudioTrack(a),o=this.rawAudioTrack.getSettings().deviceId,(null==(i=this.currentDevices.audio)?void 0:i.deviceId)!==o&&(this.currentDevices.audio=Yt(this,zI).getDeviceById(o,"audioinput"),this.emit("DEVICE_CHANGE",{device:this.currentDevices.audio})),this.rawAudioTrack.enabled=this.audioEnabled,this.setAudioTrack(yield this.mediaMiddlewareUtils.getTransformedAudioTrack(this.rawAudioTrack)),this.addMediaStreamTrackListeners(this.rawAudioTrack),yield Yt(this,zI).repopulateAvailableDevices(),this.permissions.audio="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),gn.mediaPermission("AUDIO",Lr.ACCEPTED),gn.selectedDevice("AUDIO",this.currentDevices.audio),o&&NC("lastUsedAudioDeviceId",o)}catch(e){this.handlePermissionErrors("audio",e)}finally{this.audioUpdateInProgress=!1}}))}getPreferredDeviceId(e){return tr(this,null,(function*(){var t,r;let n;if("AUDIO"===e){const e=Yt(this,zI).getAudioDevices(),r=xC("lastUsedAudioDeviceId");let i;BS.debug("getPreferredDeviceId::lastUsedAudioDeviceId",{preferredDevice:{lastUsedPreferredDeviceId:r,kind:"audio"}}),r&&(i=e.find((e=>e.deviceId===r))),i?n=r:In.hasFeature(DS.REMOVE_OPERATIONAL_MIC)||(n=(yield this.getOperationalMicDeviceId()).deviceId),n||(n=null==(t=e[0])?void 0:t.deviceId)}if("VIDEO"===e){const e=xC("lastUsedVideoDeviceId");BS.debug("getPreferredDeviceId::lastUsedVideoDeviceId",{preferredDevice:{kind:"video",lastUsedPreferredDeviceId:e}});const t=Yt(this,zI).getVideoDevices();let i;e&&(i=t.find((t=>t.deviceId===e))),n=i?e:(yield this.getOperationalWebcamDeviceId()).deviceId,n||(n=null==(r=t[0])?void 0:r.deviceId)}return n}))}setupVideoStream(e,t=!0){return tr(this,null,(function*(){var r,n;if(!this.videoUpdateInProgress)try{this.videoUpdateInProgress=!0;const i=Yt(this,zI).getVideoDevices();if(!i.length)throw this.videoEnabled=!1,new EC("COULD_NOT_START","No video devices",{});let s=e;if((!s||!i.find((e=>e.deviceId===s)))&&(s=yield this.getPreferredDeviceId("VIDEO"),BS.debug("setupVideoStream::VIDEO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:s,kind:"video"}})),t&&(null==(r=this.videoTrack)||r.stop()),this.videoEnabled){const e=Yt(this,JI).getVideoConstraints(s);this.rawVideoTrack=yield MC.getVideoTrack(e),s=this.rawVideoTrack.getSettings().deviceId,this.setVideoTrack(yield this.mediaMiddlewareUtils.getTransformedVideoTrack(this.rawVideoTrack)),this.addMediaStreamTrackListeners(this.rawVideoTrack)}yield Yt(this,zI).repopulateAvailableDevices(),(null==(n=this.currentDevices.video)?void 0:n.deviceId)!==s&&(this.currentDevices.video=Yt(this,zI).getDeviceById(s,"videoinput"),this.emit("DEVICE_CHANGE",{device:this.currentDevices.video})),this.permissions.video="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),gn.mediaPermission("VIDEO",Lr.ACCEPTED),gn.selectedDevice("VIDEO",this.currentDevices.video),s&&NC("lastUsedVideoDeviceId",s)}catch(e){this.handlePermissionErrors("video",e)}finally{this.videoUpdateInProgress=!1}}))}setupScreenShareStreams(){return tr(this,null,(function*(){if(this.screenShareUpdateInProgress)return;const e=Yt(this,JI).getScreenShareConstraints();In.hasFeature(DS.SCREENSHARE_MAX_DIMENSIONS)&&(e.video.width.max=window.screen.width,e.video.height.max=window.screen.height);try{this.screenShareUpdateInProgress=!0;const t=yield MC.getScreenShareTracks(e);this.setScreenShareTracks(t)}catch(t){throw this.handlePermissionErrors("screenshare",new EC(t.name,t.message,e)),new $S(t.message)}finally{this.screenShareUpdateInProgress=!1}}))}setupSpeaker(e){return tr(this,null,(function*(){var t;const r=Yt(this,zI).getSpeakerDevices();if(!r.length)return;const n=null!=e?e:r[0].deviceId;(null==(t=this.currentDevices.speaker)?void 0:t.deviceId)!==n&&(this.currentDevices.speaker=Yt(this,zI).getDeviceById(n,"audiooutput"),gn.selectedDevice("SPEAKER",this.currentDevices.speaker),this.emit("DEVICE_CHANGE",{device:this.currentDevices.speaker})),document.querySelectorAll("audio").forEach((e=>tr(this,null,(function*(){if(void 0!==e.sinkId&&this.currentDevices.speaker.deviceId&&e.sinkId!==this.currentDevices.speaker.deviceId)try{yield e.setSinkId(this.currentDevices.speaker.deviceId)}catch(e){}}))))}))}getOperationalWebcamDeviceId(){return tr(this,null,(function*(){const e=Yt(this,zI).getVideoDevices();if(!e.length)return{isOperational:!1,deviceId:null};MI.setEmitMediaPermissionEvent(!1);const t=[],r=yield e.reduce(((e,r)=>tr(this,null,(function*(){const n=yield e;if(null!==n)return n;const i=Yt(this,JI).getVideoConstraints(r.deviceId);try{return(yield MC.getVideoTrack(i)).stop(),r.deviceId}catch(e){BS.error("getOperationalWebcamDeviceId::could_not_acquire_video_device",{error:e,constraints:i}),t.push({exception:e,constraints:i})}return n}))),Promise.resolve(null));if(MI.setEmitMediaPermissionEvent(!0),!r&&t.length>0&&t.length===e.length){const{exception:e,constraints:r}=t[0];throw new EC(e.name,e.message,r)}return r?{isOperational:!0,deviceId:r}:{isOperational:!1,deviceId:e[0].deviceId}}))}getOperationalMicDeviceId(){return tr(this,null,(function*(){const e=Yt(this,zI).getAudioDevices();if(!e.length)return{isOperational:!1,deviceId:null};const t=[];MI.setEmitMediaPermissionEvent(!1);const r=yield e.reduce(((e,r)=>tr(this,null,(function*(){const n=yield e;if(null!==n)return n;const i=MC.getAudioConstraints({audioDeviceId:r.deviceId});try{const e=yield MC.getAudioTrack(i),t=yield FC(e);if(null==e||e.stop(),!t)return r}catch(e){BS.error("getOperationalMicDeviceId::could_not_acquire_audio_device",{error:e,constraints:i}),t.push({exception:e,constraints:i})}return n}))),Promise.resolve(null));if(MI.setEmitMediaPermissionEvent(!0),!r&&t.length>0&&t.length===e.length){const{exception:e,constraints:r}=t[0];throw new EC(e.name,e.message,r)}return r?{isOperational:!0,deviceId:r.deviceId}:{isOperational:!1,deviceId:e[0].deviceId}}))}setupStreams(e){return tr(this,arguments,(function*({audio:e,video:t}){var r;const n={};this.currentDevices||(this.currentDevices={audio:void 0,video:void 0,speaker:void 0});try{if(e&&!this.audioUpdateInProgress&&0!==Yt(this,zI).getAudioDevices().length){const e=yield this.getPreferredDeviceId("AUDIO");BS.info("setupStreams::AUDIO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:e,kind:"audio"}});const t=MC.getAudioConstraints({audioDeviceId:e});n.audio=t.audio}if(t&&!this.videoUpdateInProgress&&0!==Yt(this,zI).getVideoDevices().length){const e=yield this.getPreferredDeviceId("VIDEO");BS.info("setupStreams::VIDEO::getPreferredDeviceId",{preferredDevice:{preferredDeviceId:e,kind:"video"}});const t=Yt(this,JI).getVideoConstraints(e);n.video=t.video}if(0===(null==(r=Object.keys(n))?void 0:r.length))return this.audioEnabled=null!=e?e:this.audioEnabled,this.videoEnabled=null!=t?t:this.videoEnabled,this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,void(this.initialSetupComplete=!0);const{audioTrack:i,videoTrack:s}=yield MC.getAudioAndVideoTrack(n);e&&i&&(this.audioTrack=i,this.rawAudioTrack=i,this.permissions.audio="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}),this.currentDevices.audio=Yt(this,zI).getDeviceById(i.getSettings().deviceId,"audioinput"),NC("lastUsedAudioDeviceId",i.getSettings().deviceId)),t&&s&&(this.videoTrack=s,this.rawVideoTrack=s,this.permissions.video="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}),this.currentDevices.video=Yt(this,zI).getDeviceById(s.getSettings().deviceId,"videoinput"),NC("lastUsedVideoDeviceId",s.getSettings().deviceId)),yield Yt(this,zI).repopulateAvailableDevices()}catch(r){"NotAllowedError"===r.name&&(e&&(yield this.setupAudioStream()),t&&(yield this.setupVideoStream()))}this.audioEnabled=!!this.audioTrack,this.videoEnabled=!!this.videoTrack,this.screenShareEnabled=!1,this.audioUpdateInProgress=!1,this.videoUpdateInProgress=!1,this.initialSetupComplete=!0,yield this.setupSpeaker()}))}stopAudioTrack(){var e,t;this.audioUpdateInProgress||(this.audioUpdateInProgress=!0,null==(e=this.audioTrack)||e.stop(),null==(t=this.rawAudioTrack)||t.stop(),this.audioEnabled=!1,this.audioUpdateInProgress=!1)}stopVideoTrack(){var e,t;this.videoUpdateInProgress||(this.videoUpdateInProgress=!0,null==(e=this.videoTrack)||e.stop(),null==(t=this.rawVideoTrack)||t.stop(),this.videoEnabled=!1,this.videoUpdateInProgress=!1)}stopScreenShareTracks(e={}){var t,r,n,i;if(this.screenShareUpdateInProgress)return;this.screenShareUpdateInProgress=!0;const{audio:s=!0,video:o=!0}=e;s&&(null==(r=null==(t=this.screenShareTracks)?void 0:t.audio)||r.stop()),o&&(null==(i=null==(n=this.screenShareTracks)?void 0:n.video)||i.stop()),this.screenShareEnabled=!1,this.screenShareUpdateInProgress=!1}removeAudioTrack(){this.stopAudioTrack(),this.audioTrack=void 0,this.rawAudioTrack=void 0,In.hasFeature(DS.TROUBLESHOOTING)&&WI.cleanup()}removeVideoTrack(){this.stopVideoTrack(),this.videoTrack=void 0,this.rawVideoTrack=void 0}removeScreenShareTracks(e){var t;null==(t=this.screenShareTracks.video)||t.removeEventListener("ended",this.onScreenShareEnded),this.stopScreenShareTracks(e),this.screenShareTracks={audio:void 0,video:void 0}}removeAllTracks(){this.removeAudioTrack(),this.removeVideoTrack(),this.removeScreenShareTracks({audio:!!this.screenShareTracks.audio,video:!!this.screenShareTracks.video})}setAudioTrack(e){e!==this.audioTrack&&(void 0===e&&this.stopAudioTrack(),this.audioTrack=e,this.audioTrack&&(this.audioTrack.enabled=this.audioEnabled))}setVideoTrack(e){e!==this.videoTrack&&(void 0===e&&this.stopVideoTrack(),this.videoTrack=e)}setScreenShareTracks(e){var t;const{audio:r,video:n}=e;(!r||!n)&&this.stopScreenShareTracks({audio:!!r,video:!!n}),this.screenShareTracks=e,null==(t=this.screenShareTracks.video)||t.addEventListener("ended",this.onScreenShareEnded.bind(this))}onScreenShareEnded(){this.emit("SCREENSHARE_ENDED")}disableAudio(){this.audioEnabled=!1,this.audioTrack&&(this.audioTrack.enabled=this.audioEnabled),this.rawAudioTrack&&(this.rawAudioTrack.enabled=this.audioEnabled)}enableAudio(){return tr(this,null,(function*(){var e;if("DENIED"!==this.permissions.audio){try{if((!this.audioTrack||"ended"===this.audioTrack.readyState)&&(yield this.setupAudioStream(null==(e=this.currentDevices.audio)?void 0:e.deviceId)),!this.audioTrack||!this.rawAudioTrack)return this.audioEnabled=!1,void BS.error("LocalMediaHandler::enableAudio:Setting up audio stream failed while enabling audio",{debuggingHint:"Refer to SelfController::mediaPermissionError log."});this.audioEnabled=!0}catch(e){this.audioEnabled=!1,this.audioTrack=void 0,this.rawAudioTrack=void 0,BS.error("LocalMediaHandler::enableAudio",{error:e},!0)}this.audioTrack&&(this.audioTrack.enabled=!0),this.rawAudioTrack&&(this.rawAudioTrack.enabled=!0),"ACCEPTED"!==this.permissions.audio&&this.audioEnabled&&(this.permissions.audio="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.audio,kind:"audio"}))}else this.audioEnabled=!1}))}toggleAudio(){return tr(this,null,(function*(){var e;if("DENIED"!==this.permissions.audio){try{if((!this.audioTrack||"ended"===this.audioTrack.readyState)&&(yield this.setupAudioStream(null==(e=this.currentDevices.audio)?void 0:e.deviceId)),!this.audioTrack||!this.rawAudioTrack)return void(this.audioEnabled=!1);this.audioEnabled=!this.audioEnabled}catch(e){this.audioEnabled=!1,BS.error("LocalMediaHandler::toggleAudio",{error:e},!0)}this.audioTrack&&(this.audioTrack.enabled=this.audioEnabled),this.rawAudioTrack&&(this.rawAudioTrack.enabled=this.audioEnabled)}else this.audioEnabled=!1}))}toggleVideo(){return tr(this,null,(function*(){var e;if("DENIED"!==this.permissions.video)if(this.videoEnabled)this.removeVideoTrack();else{this.videoEnabled=!0;try{yield this.setupVideoStream(null==(e=this.currentDevices.video)?void 0:e.deviceId)}catch(e){this.videoEnabled=!1}this.videoTrack&&(this.videoTrack.enabled=this.videoEnabled),this.rawVideoTrack&&(this.rawVideoTrack.enabled=this.videoEnabled),"ACCEPTED"!==this.permissions.video&&this.videoEnabled&&(this.permissions.video="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.video,kind:"video"}))}else this.videoEnabled=!1}))}toggleScreenShare(){return tr(this,null,(function*(){if(this.screenShareEnabled)this.removeScreenShareTracks({audio:!!this.screenShareTracks.audio,video:!!this.screenShareTracks.video});else try{if(yield this.setupScreenShareStreams(),this.screenShareEnabled=!0,"ACCEPTED"===this.permissions.screenshare)return;this.permissions.screenshare="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:this.permissions.screenshare,kind:"screenshare"})}catch(e){this.screenShareEnabled=!1}}))}getAllDevices(){return Yt(this,zI).availableDevices}getDeviceById(e,t){return Yt(this,zI).getDeviceById(e,t)}getAudioDevices(){return Yt(this,zI).getAudioDevices()}getVideoDevices(){return Yt(this,zI).getVideoDevices()}getSpeakerDevices(){return Yt(this,zI).getSpeakerDevices()}onDeviceChange(e,t){return tr(this,null,(function*(){var r,n;this.initialSetupComplete&&(null==(r=null==e?void 0:e.added)||r.forEach((e=>tr(this,null,(function*(){e&&(t||!IC(e))&&("audioinput"===e.kind?(yield this.setupAudioStream(e.deviceId),this.emit("AUDIO_TRACK_CHANGE")):"videoinput"===e.kind&&this.videoEnabled?(yield this.setupVideoStream(e.deviceId),this.emit("VIDEO_TRACK_CHANGE")):"audiooutput"===e.kind&&(yield this.setupSpeaker(e.deviceId)))})))),null==(n=null==e?void 0:e.removed)||n.forEach((e=>tr(this,null,(function*(){var t,r,n;e&&(("audioinput"===e.kind&&!this.audioEnabled||"videoinput"===e.kind&&!this.videoEnabled||In.hasFeature(DS.DEVICE_REMOVE_EXP)||!_S.isChromiumBased())&&("audioinput"===e.kind&&e.deviceId===(null==(t=this.currentDevices.audio)?void 0:t.deviceId)?(yield this.setupAudioStream(),this.emit("AUDIO_TRACK_CHANGE")):"videoinput"===e.kind&&e.deviceId===(null==(r=this.currentDevices.video)?void 0:r.deviceId)&&(yield this.setupVideoStream(),this.emit("VIDEO_TRACK_CHANGE"))),"audiooutput"===e.kind&&e.deviceId===(null==(n=this.currentDevices.speaker)?void 0:n.deviceId)&&(yield this.setupSpeaker()))})))))}))}static init(e){return tr(this,null,(function*(){const t=yield MC.init(),r=new ZI(t,e),n=new PI(r);return r.mediaMiddlewareUtils=n,r}))}emit(e,...t){return super.emit(e,...t)}on(e,t){return super.on(e,t)}removeDocumentEventListeners(){return tr(this,null,(function*(){document.removeEventListener("visibilitychange",this.onVisibilityChange)}))}addAudioMiddleware(e){return this.mediaMiddlewareUtils.addAudioMiddleware(e)}removeAudioMiddleware(e){return this.mediaMiddlewareUtils.removeAudioMiddleware(e)}addVideoMiddleware(e){return this.mediaMiddlewareUtils.addVideoMiddleware(e)}removeVideoMiddleware(e){return this.mediaMiddlewareUtils.removeVideoMiddleware(e)}enableVideo(){return tr(this,null,(function*(){yield this.toggleVideo()}))}disableVideo(){return tr(this,null,(function*(){yield this.toggleVideo()}))}enableScreenShare(){return tr(this,null,(function*(){yield this.toggleScreenShare()}))}disableScreenShare(){return tr(this,null,(function*(){yield this.toggleScreenShare()}))}getCurrentDevices(){return this.currentDevices}destruct(){this.mediaMiddlewareUtils.terminateMiddlewareWebWorker(),Yt(this,zI).destruct(),this.removeAllTracks(),this.removeAllListeners()}},zI=new WeakMap,JI=new WeakMap,KI);let eA=ZI;XI([$I({methodName:"oldLocalMediaHandler.conditionallyRestartAudio",lockName:"oldLocalMediaHandler.conditionallyRestartAudio",timeout:3e3})],eA.prototype,"conditionallyRestartAudio",1),XI([$I({methodName:"oldLocalMediaHandler.conditionallyRestartVideo",lockName:"oldLocalMediaHandler.conditionallyRestartVideo",timeout:3e3})],eA.prototype,"conditionallyRestartVideo",1),XI([VS.trace("OldMediaHandler.shouldReacquireTrack")],eA.prototype,"shouldReacquireTrack",1),XI([VS.trace("OldMediaHandler.removeMediaStreamTrackListeners")],eA.prototype,"removeMediaStreamTrackListeners",1),XI([VS.trace("OldMediaHandler.addMediaStreamTrackListeners")],eA.prototype,"addMediaStreamTrackListeners",1),XI([VS.trace("OldMediaHandler.setupAudioStream")],eA.prototype,"setupAudioStream",1),XI([VS.trace("OldMediaHandler.getPreferredDeviceId")],eA.prototype,"getPreferredDeviceId",1),XI([VS.trace("OldMediaHandler.setupVideoStream")],eA.prototype,"setupVideoStream",1),XI([VS.trace("OldMediaHandler.setupScreenShareStreams")],eA.prototype,"setupScreenShareStreams",1),XI([VS.trace("OldMediaHandler.setupSpeaker")],eA.prototype,"setupSpeaker",1),XI([VS.trace("OldMediaHandler.getOperationalWebcamDeviceId")],eA.prototype,"getOperationalWebcamDeviceId",1),XI([VS.trace("OldMediaHandler.getOperationalMicDeviceId")],eA.prototype,"getOperationalMicDeviceId",1),XI([VS.trace("OldMediaHandler.setupStreams")],eA.prototype,"setupStreams",1),XI([VS.trace("OldMediaHandler.stopAudioTrack")],eA.prototype,"stopAudioTrack",1),XI([VS.trace("OldMediaHandler.stopVideoTrack")],eA.prototype,"stopVideoTrack",1),XI([VS.trace("OldMediaHandler.stopScreenShareTracks")],eA.prototype,"stopScreenShareTracks",1),XI([VS.trace("OldMediaHandler.removeAudioTrack")],eA.prototype,"removeAudioTrack",1),XI([VS.trace("OldMediaHandler.removeVideoTrack")],eA.prototype,"removeVideoTrack",1),XI([VS.trace("OldMediaHandler.removeScreenShareTracks")],eA.prototype,"removeScreenShareTracks",1),XI([VS.trace("OldMediaHandler.removeAllTracks")],eA.prototype,"removeAllTracks",1),XI([VS.trace("OldMediaHandler.setAudioTrack")],eA.prototype,"setAudioTrack",1),XI([VS.trace("OldMediaHandler.setVideoTrack")],eA.prototype,"setVideoTrack",1),XI([VS.trace("OldMediaHandler.setScreenShareTracks")],eA.prototype,"setScreenShareTracks",1),XI([VS.trace("OldMediaHandler::disableAudio")],eA.prototype,"disableAudio",1),XI([VS.trace("OldMediaHandler::enableAudio")],eA.prototype,"enableAudio",1),XI([VS.trace("OldMediaHandler.toggleAudio")],eA.prototype,"toggleAudio",1),XI([VS.trace("OldMediaHandler.toggleVideo")],eA.prototype,"toggleVideo",1),XI([VS.trace("OldMediaHandler.toggleScreenShare")],eA.prototype,"toggleScreenShare",1);class tA extends WS{constructor(){super(...arguments),Kt(this,"localMediaHandler")}updatePermission(){return tr(this,null,(function*(){var e,t;const r=(e,t)=>{this.mediaPermissions[e]=t;const r={message:this.mediaPermissions[e],kind:e};"DENIED"===t?tT.emit(XS.MEDIA_PERMISSION_ERROR,r):tT.emit(XS.MEDIA_PERMISSION_UPDATE,r)};if("firefox"===_S.getName())return;const n=yield null==(e=null==navigator?void 0:navigator.permissions)?void 0:e.query({name:"microphone"}),i=yield null==(t=null==navigator?void 0:navigator.permissions)?void 0:t.query({name:"camera"}),s=(e,t)=>{switch(t){case"granted":r(e,"ACCEPTED");break;case"denied":r(e,"DENIED")}this.localMediaHandler.repopulateAvailableDevices()};n&&(n.onchange=()=>s("audio",n.state)),i&&(i.onchange=()=>s("video",i.state))}))}init(){return tr(this,arguments,(function*(e={},t=!1){var r,n,i,s;if(_S.init(),!this.localMediaHandler){this.updatePermission();try{let o=!0;if(td.defaults.mediaHandler)o=!1,this.localMediaHandler=td.defaults.mediaHandler.localMediaHandler;else if(navigator.RNLocalMediaHandlerImpl){const{RNLocalMediaHandlerImpl:e}=navigator;this.localMediaHandler=yield e.init()}else In.hasFeature(DS.NEW_LOCAL_MEDIA_HANDLER)||window.FAST_DYTE?this.localMediaHandler=new wI(e.constraints,null==(r=null==td?void 0:td.defaults)?void 0:r.isNonPreferredDevice,null==(n=null==td?void 0:td.defaults)?void 0:n.autoSwitchAudioDevice):this.localMediaHandler=yield eA.init(e.constraints);if(tT.on(XS.MEDIA_PERMISSION_UPDATE,(e=>tr(this,null,(function*(){var t,r,n;if("ACCEPTED"===e.message){const i=this.getCurrentDevices(),s=yield this.getAudioDevices(),o=yield this.getVideoDevices(),a=yield this.getSpeakerDevices(),c=In.hasFeature(DS.NEW_LOCAL_MEDIA_HANDLER);switch(null==e?void 0:e.kind){case"audio":!i.audio&&s.length>0&&(c||this.setDevice(s[0]),gn.mediaPermission("AUDIO",Lr.ACCEPTED),gn.selectedDevice("AUDIO",null==(t=this.getCurrentDevices())?void 0:t.audio)),!i.speaker&&a.length>0&&(c||this.setDevice(a[0]),gn.mediaPermission("SPEAKER",Lr.ACCEPTED),gn.selectedDevice("SPEAKER",null==(r=this.getCurrentDevices())?void 0:r.speaker));break;case"video":!i.video&&o.length>0&&(c||this.setDevice(o[0]),gn.mediaPermission("VIDEO",Lr.ACCEPTED),gn.selectedDevice("VIDEO",null==(n=this.getCurrentDevices())?void 0:n.video))}}this.emit("mediaPermissionUpdate",e)})))),tT.on(XS.MEDIA_PERMISSION_ERROR,(e=>tr(this,null,(function*(){const{kind:t,message:r}=e;"audio"===t?(gn.mediaPermission("AUDIO",JC(r)),this.disableAudio()):"video"===t?(gn.mediaPermission("VIDEO",JC(r)),this.disableVideo()):"screenshare"===t&&(gn.mediaPermission("VIDEO",JC(r)),this.disableScreenShare()),BS.error("SelfController::mediaPermissionError",{error:{message:e.message},constraints:e.constraints,mediaPermissionsErrors:{kind:t,message:r}}),this.emit("mediaPermissionError",e),this.emit("mediaPermissionUpdate",{message:r,kind:t})})))),o){const r=this.localMediaHandler.setupStreams({video:null==(i=null==e?void 0:e.video)||i,audio:null==(s=null==e?void 0:e.audio)||s});t||(yield r)}}catch(e){BS.error("DyteSelf::init::Failed To Setup Streams",{error:{name:e.name,message:e.message}})}}}))}get audioTrack(){return this.localMediaHandler.audioTrack}get rawAudioTrack(){return this.localMediaHandler.rawAudioTrack}get mediaPermissions(){return this.localMediaHandler.permissions}addAudioMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.addAudioMiddleware(e)}))}removeAudioMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.removeAudioMiddleware(e)}))}get videoTrack(){return this.localMediaHandler.videoTrack}get rawVideoTrack(){return this.localMediaHandler.rawVideoTrack}addVideoMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.addVideoMiddleware(e)}))}removeVideoMiddleware(e){return tr(this,null,(function*(){return this.localMediaHandler.removeVideoMiddleware(e)}))}get screenShareTracks(){return this.localMediaHandler.screenShareTracks}get audioEnabled(){return this.localMediaHandler.audioEnabled}get videoEnabled(){return this.localMediaHandler.videoEnabled}get screenShareEnabled(){return this.localMediaHandler.screenShareEnabled}enableAudio(){return tr(this,null,(function*(){yield this.localMediaHandler.enableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}))}enableVideo(){return tr(this,null,(function*(){yield this.localMediaHandler.enableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}))}disableAudio(){return tr(this,null,(function*(){this.localMediaHandler.disableAudio(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}))}disableVideo(){return tr(this,null,(function*(){yield this.localMediaHandler.disableVideo(),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}))}disableScreenShare(){return tr(this,null,(function*(){}))}getCurrentDevices(){return this.localMediaHandler.getCurrentDevices()}getAudioDevices(){return tr(this,null,(function*(){return yield this.localMediaHandler.getAudioDevices()}))}getVideoDevices(){return tr(this,null,(function*(){return yield this.localMediaHandler.getVideoDevices()}))}getSpeakerDevices(){return tr(this,null,(function*(){return yield this.localMediaHandler.getSpeakerDevices()}))}getDeviceById(e,t){let r;return"audio"===t?r="audioinput":"video"===t?r="videoinput":"speaker"===t&&(r="audiooutput"),this.localMediaHandler.getDeviceById(e,r)}setDevice(e){return tr(this,null,(function*(){const t={added:[e],removed:[]};if("isDeprecated"in this.localMediaHandler)yield this.localMediaHandler.onDeviceChange(t,!0);else{switch(e.kind){case"audioinput":try{yield this.localMediaHandler.setAudioDevice(e)}catch(e){}finally{this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":yield this.localMediaHandler.setSpeakerDevice(e);break;case"videoinput":try{yield this.localMediaHandler.setVideoDevice(e)}catch(e){}finally{this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}}this.emit("deviceUpdate",{device:e})}}))}}const rA={nonBlackPixelLumaThreshold:20,identicalFrameSsimThreshold:.985,media:"video"};var nA,iA,sA,oA,aA,cA,dA,lA,uA,hA,pA,mA,fA,gA,vA;const yA=class{constructor(e){Xt(this,oA),Xt(this,cA),Xt(this,lA),Kt(this,"metadata",{}),Kt(this,"video"),Kt(this,"canvas"),Kt(this,"nonBlackPixelLumaThreshold"),Kt(this,"identicalFrameSsimThreshold"),Kt(this,"previousFrame",new Uint8ClampedArray),Xt(this,nA,void 0),Kt(this,"track"),Kt(this,"analysing"),Xt(this,iA,void 0),Xt(this,sA,void 0),Kt(this,"preview");const{nonBlackPixelLumaThreshold:t,identicalFrameSsimThreshold:r,media:n}=$t($t({},rA),e);this.nonBlackPixelLumaThreshold=t,this.identicalFrameSsimThreshold=r,this.analysing=!1,Zt(this,iA,n),this.preview=!1}setTrack(e){var t,r,n;null==(t=this.track)||t.stop(),this.track=e;const{height:i,width:s}=null!=(n=null==(r=this.track)?void 0:r.getConstraints())?n:{};this.metadata.resolution=[s,i],"screenshare"!==Yt(this,iA)?tT.emit(XS.VIDEO_TRACK_CREATED):tT.emit(XS.SCREENSHARE_VIDEO_TRACK_CREATED)}getTrackMetadata(){return this.track?(this.metadata.label=this.track.label,this.metadata):null}startTrackAnalysis(){return tr(this,null,(function*(){var e;return!(!this.track||this.analysing||(!this.video&&!(null!=(e=this.video)&&e.src)&&(Zt(this,sA,new MediaStream),Yt(this,sA).addTrack(this.track),this.video=document.createElement("video"),this.canvas=document.createElement("canvas"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),[this.video.width,this.video.height]=this.metadata.resolution,this.video.srcObject=Yt(this,sA)),window.requestAnimationFrame(er(this,oA,aA).bind(this)),this.analysing=!0,0))}))}stopTrackAnalysis(){this.analysing&&(this.analysing=!1,clearTimeout(Yt(this,nA)))}cleanup(){var e;this.stopTrackAnalysis(),null==(e=this.track)||e.stop(),this.track=void 0,Zt(this,sA,void 0),this.video&&(this.video.srcObject=void 0,this.video=void 0),this.canvas=void 0,this.previousFrame=new Uint8ClampedArray,"screenshare"!==Yt(this,iA)?tT.emit(XS.VIDEO_TRACK_CLOSED):tT.emit(XS.SCREENSHARE_VIDEO_TRACK_CLOSED)}};let _A=yA;nA=new WeakMap,iA=new WeakMap,sA=new WeakMap,oA=new WeakSet,aA=function(){var e;try{const t=er(this,cA,dA).call(this),r=er(this,lA,uA).call(this,t.data,t.data.length),n=er(e=yA,hA,pA).call(e,this.previousFrame,t.data);this.previousFrame=t.data;const i={isBlackFrame:r,videoScore:n,isFrozenFrame:n>this.identicalFrameSsimThreshold,timestamp:(new Date).getTime()};"screenshare"===Yt(this,iA)?tT.emit(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS,i):tT.emit(XS.VIDEO_TRACK_ANALYSIS,i),Zt(this,nA,setTimeout((()=>{this.track&&window.requestAnimationFrame(er(this,oA,aA).bind(this))}),3e3))}catch(e){"screenshare"===Yt(this,iA)?tT.emit(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR):tT.emit(XS.VIDEO_TRACK_ANALYSIS_ERROR)}},cA=new WeakSet,dA=function(){var e,t;this.canvas.width=null==(e=this.video)?void 0:e.width,this.canvas.height=null==(t=this.video)?void 0:t.height;const r=this.canvas.getContext("2d",{willReadFrequently:!0});return r.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),r.getImageData(0,0,this.canvas.width,this.canvas.height)},lA=new WeakSet,uA=function(e,t){const r=this.nonBlackPixelLumaThreshold;let n=0;for(let i=4;i<t;i+=4)if(n+=.21*e[i]+.72*e[i+1]+.07*e[i+2],n>r*(i/4))return!1;return!0},hA=new WeakSet,pA=function(e,t){var r,n,i;if(e.length!==t.length)return 0;const s=255,o=.01*s*(.01*s),a=.03*s*(.03*s),c=a/2,d=er(r=yA,mA,fA).call(r,e),l=d.mean,u=d.variance,h=Math.sqrt(u),p=er(n=yA,mA,fA).call(n,t),m=p.mean,f=p.variance,g=Math.sqrt(f);return(2*l*m+o)/(l*l+m*m+o)*((2*h*g+a)/(u+f+a))*((er(i=yA,gA,vA).call(i,e,t,l,m)+c)/(h*g+c))},mA=new WeakSet,fA=function(e){let t,r=0;for(t=0;t<e.length;t++)r+=e[t];const n=r/(e.length-1);let i=0;for(t=1;t<e.length;t++)i=e[t-1]-n,r+=e[t]+i*i;return{mean:n,variance:r/e.length}},gA=new WeakSet,vA=function(e,t,r,n){let i=0;for(let s=0;s<e.length;s+=1)i+=(e[s]-r)*(t[s]-n);return i/e.length},Xt(_A,hA),Xt(_A,mA),Xt(_A,gA);const SA=new _A,TA=new _A({media:"screenshare"});function EA(e){return!("LIVESTREAM"===e.viewType||"CHAT"===e.viewType)}var bA,wA,kA,RA,CA,IA,AA,PA=Object.defineProperty,DA=Object.getOwnPropertyDescriptor,OA=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?DA(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&PA(t,r,s),s},MA=(e=>(e.OFF_STAGE="OFF_STAGE",e.REQUESTED_TO_JOIN_STAGE="REQUESTED_TO_JOIN_STAGE",e.ACCEPTED_TO_JOIN_STAGE="ACCEPTED_TO_JOIN_STAGE",e.ON_STAGE="ON_STAGE",e))(MA||{});let NA,xA=(AA=class extends tA{constructor(e,t,r,n,i){var s;super(),Xt(this,CA),Kt(this,"id"),Kt(this,"name"),Kt(this,"picture"),Kt(this,"customParticipantId"),Kt(this,"waitlistStatus"),Xt(this,bA,void 0),Xt(this,wA,void 0),Xt(this,kA,void 0),Kt(this,"role"),Kt(this,"userId"),Kt(this,"organizationId"),Kt(this,"supportsRemoteControl",!1),Kt(this,"device"),Xt(this,RA,void 0),Kt(this,"presetName"),Kt(this,"roomState","init"),this.id=e,this.userId=t.id,this.name=t.name,this.picture=t.picture,this.customParticipantId=null!=(s=t.customParticipantId)?s:t.clientSpecificId,this.waitlistStatus="none",Zt(this,wA,r),Zt(this,bA,n),Zt(this,kA,!1),this.organizationId=t.organizationId,this.supportsRemoteControl=_S.isElectron(),this.device=_S.getDeviceInfo(),this.presetName=i,n.viewType!==vn.Chat&&this.updatePermission()}get clientSpecificId(){return this.customParticipantId}get stageStatus(){return Yt(this,RA)}static __init__(e,t,r,n,i,s=!1){return tr(this,null,(function*(){var o,a,c,d,l;let u=null==(a=null==(o=td.defaults)?void 0:o.audio)||a,h=null==(d=null==(c=td.defaults)?void 0:c.video)||d;"ALLOWED"!==r.canProduceAudio&&(u=!1),"ALLOWED"!==r.canProduceVideo&&(h=!1);const p=new xA(e,t,r,n,i);if(n.viewType===vn.Chat)return p;const m=function(e){var t,r;const n={};return e.audio&&(n.audio={enableStereo:null!=(t=e.audio.enableStereo)&&t,enableHighBitrate:null!=(r=e.audio.enableHighBitrate)&&r}),n.video=e.video.quality,n}(n.mediaConstraints);return Mg(m,null==(l=td.defaults)?void 0:l.mediaConfiguration),yield p.init({audio:u,video:h,constraints:m},s),p.setupEvents(),p}))}setupEvents(){tT.on(XS.ROOM_NODE_CONNECTED,(e=>tr(this,[e],(function*({wasDisconnected:e,wasJoinAttempted:t}){e&&(yield this.resetSelf(t))})))),tT.onAsync(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){switch(Zt(this,RA,e),e){case"ACCEPTED_TO_JOIN_STAGE":this.emit("joinStageRequestAccepted");break;case"REQUESTED_TO_JOIN_STAGE":this.emit("peerRequestToJoinStage");break;case"OFF_STAGE":this.emit("stageLeft")}})))),tT.on(XS.RESET_PRODUCER_STATE,(()=>tr(this,null,(function*(){if(this.roomJoined&&Yt(this,CA,IA)instanceof OR){if(this.localMediaHandler.videoEnabled&&(yield Yt(this,CA,IA).shareWebcam(this.localMediaHandler.videoTrack)),this.localMediaHandler.audioEnabled)try{yield Yt(this,CA,IA).shareMic(this.localMediaHandler.audioTrack)}catch(e){this.localMediaHandler.disableAudio()}this.localMediaHandler.screenShareEnabled&&(yield Yt(this,CA,IA).shareScreen({video:this.localMediaHandler.screenShareTracks.video,audio:this.localMediaHandler.screenShareTracks.audio}))}})))),tT.on(XS.STOPPED_PRESENTING,(()=>{this.localMediaHandler.destruct(),this.setWebinarStageStatus("OFF_STAGE"),this.emit("stageLeft")})),this.localMediaHandler.on("AUDIO_TRACK_CHANGE",(()=>tr(this,null,(function*(){if(tT.emit(XS.AUDIO_TRACK_CHANGED),BS.info("DyteSelf::setupEvents::AUDIO_TRACK_CHANGE",$t({},SC(this))),this.roomJoined&&this.audioEnabled)try{yield Yt(this,CA,IA).shareMic(this.audioTrack)}catch(e){BS.error("DyteSelf::setupEvents::Error while sharing mic",{error:e}),this.localMediaHandler.disableAudio()}this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})})))),this.localMediaHandler.on("VIDEO_TRACK_CHANGE",(()=>tr(this,null,(function*(){if(tT.emit(XS.VIDEO_TRACK_CHANGED),BS.info("DyteSelf::setupEvents::VIDEO_TRACK_CHANGE",$t({},SC(this))),this.roomJoined&&void 0===this.rawVideoTrack)BS.info("DyteSelf::VIDEO_TRACK_CHANGE::Forcing_disable_video"),this.disableVideo();else if(this.videoEnabled&&this.roomJoined)try{const e=yield Yt(this,CA,IA).shareWebcam(this.videoTrack);e&&e.id!==this.videoTrack.id&&In.hasFeature(DS.EXP_RESHARE)&&(yield Yt(this,CA,IA).shareWebcam(this.videoTrack))}catch(e){BS.error("DyteSelf::setupEvents::failed shareWebcam",{error:e}),this.videoEnabled&&(yield this.localMediaHandler.disableVideo())}this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})})))),this.localMediaHandler.on("DEVICE_CHANGE",(e=>tr(this,[e],(function*({device:e}){this.emit("deviceUpdate",{device:e})})))),this.localMediaHandler.on("DEVICE_LIST_UPDATED",(e=>{this.emit("deviceListUpdate",e)})),this.localMediaHandler.on("SCREENSHARE_TRACK_CHANGE",(()=>tr(this,null,(function*(){if(tT.emit(XS.SCREENSHARE_TRACK_CHANGED),this.roomJoined){if(this.screenShareEnabled)try{yield Yt(this,CA,IA).shareScreen(this.screenShareTracks)}catch(e){BS.error("DyteSelf::setupEvents::Error while sharing screen",{error:e}),this.screenShareEnabled&&(yield this.localMediaHandler.disableScreenShare())}BS.info("DyteSelf::setupEvents::SCREENSHARE_TRACK_CHANGE",$t({},SC(this))),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}else BS.error("DyteSelf.SCREENSHARE_TRACK_CHANGE.LocalMediaInitialized_WithoutRoomNode")})))),this.localMediaHandler.on("SCREENSHARE_ENDED",(()=>tr(this,null,(function*(){yield this.disableScreenShare(),BS.info("DyteSelf::setupEvents::SCREENSHARE_ENDED",$t({},SC(this)))})))),this.localMediaHandler.on("AUDIO_TRACK_SILENT",(()=>{gn.mediaTrackMuted("AUDIO")})),this.localMediaHandler.on("FORCE_MUTE_AUDIO",(()=>{this.disableAudio()})),this.localMediaHandler.on("FORCE_MUTE_VIDEO",(()=>tr(this,null,(function*(){this.roomJoined&&(yield Yt(this,CA,IA).pauseWebcam()),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),gn.videoOff()}))))}get permissions(){return Yt(this,wA)}get suggestedTheme(){return Yt(this,bA)}get config(){return Yt(this,bA)}get roomJoined(){var e;return!0===(null==(e=Yt(this,CA,IA))?void 0:e.roomJoined)}setName(e){if(!e)throw new $S("Name cannot be empty.");this.name=e}setupTracks(){return tr(this,arguments,(function*(e={}){var t,r;return e.forceReset&&(Yt(this,CA,IA).stopAllProducers(),this.localMediaHandler.removeAllTracks()),this.localMediaHandler.setupStreams({video:null==(t=e.video)||t,audio:null==(r=e.audio)||r})}))}resetSelf(e){return tr(this,null,(function*(){var t,r,n,i,s,o,a,c,d,l;if(gn.callEnded(),null==(n=null==(r=null==(t=Yt(this,CA,IA))?void 0:t.sfuHandler)?void 0:r.cleanupConsumers)||n.call(r),Yt(this,CA,IA)instanceof fC&&(yield null==(o=null==(s=null==(i=Yt(this,CA,IA))?void 0:i.sfuHandler)?void 0:s.setupTransports)?void 0:o.call(s)),e){if(EA(this.config)&&(yield null==(a=Yt(this,CA,IA))?void 0:a.joinRoom(this.name,!this.localMediaHandler.audioEnabled,Yt(this,CA,IA).roomUUID,Yt(this,CA,IA).meetingTitle,{audio:this.localMediaHandler.audioEnabled,video:this.localMediaHandler.videoEnabled,screen:this.localMediaHandler.screenShareEnabled})),this.localMediaHandler.videoEnabled&&(yield null==(c=Yt(this,CA,IA))?void 0:c.shareWebcam(this.localMediaHandler.videoTrack)),this.localMediaHandler.audioEnabled)try{yield null==(d=Yt(this,CA,IA))?void 0:d.shareMic(this.localMediaHandler.audioTrack)}catch(e){this.localMediaHandler.disableAudio()}this.localMediaHandler.screenShareEnabled&&(yield null==(l=Yt(this,CA,IA))?void 0:l.shareScreen({video:this.localMediaHandler.screenShareTracks.video,audio:this.localMediaHandler.screenShareTracks.audio}))}}))}destructMediaHandler(){return tr(this,null,(function*(){return this.localMediaHandler.destruct()}))}removeDocumentEventListeners(){return tr(this,null,(function*(){return this.localMediaHandler.removeDocumentEventListeners()}))}enableAudio(){return tr(this,null,(function*(){if(this.permissions.canProduceAudio!==rT.notAllowed&&(Yt(this,wA).canProduceAudio!==rT.canRequest||"OFF_STAGE"!==this.stageStatus&&"REQUESTED_TO_JOIN_STAGE"!==this.stageStatus)&&!this.audioEnabled){if(yield this.localMediaHandler.enableAudio(),this.roomJoined&&("HIVE"!==this.permissions.mediaRoomType||"ON_STAGE"===this.stageStatus)){if(this.audioTrack)try{yield Yt(this,CA,IA).shareMic(this.audioTrack)}catch(e){BS.error("DyteSelf::enableAudio::Error while sharing mic",{error:e}),this.localMediaHandler.disableAudio()}if(!this.audioEnabled)return;Yt(this,CA,IA).unmuteSelf()}if(this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}),gn.audioOn(),In.hasFeature(DS.TROUBLESHOOTING))try{WI.setTrack(this.rawAudioTrack)}catch(e){BS.error("Troubleshooter::micTest::Error while setting track",{error:e})}}}))}enableVideo(){return tr(this,null,(function*(){var e;if(Yt(this,wA).canProduceVideo!==rT.notAllowed&&(Yt(this,wA).canProduceVideo!==rT.canRequest||"OFF_STAGE"!==this.stageStatus&&"REQUESTED_TO_JOIN_STAGE"!==this.stageStatus)&&!this.videoEnabled){if(yield this.localMediaHandler.enableVideo(),this.roomJoined&&("HIVE"!==this.permissions.mediaRoomType||"ON_STAGE"===this.stageStatus))try{yield Yt(this,CA,IA).shareWebcam(this.videoTrack)}catch(e){BS.error("DyteSelf::enableVideo::Error while sharing video",{error:e}),this.videoEnabled&&(yield this.localMediaHandler.disableVideo())}if(this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),BS.info("DyteSelf.enableVideo",$t({},SC(this))),gn.videoOn(),In.hasFeature(DS.TROUBLESHOOTING))try{SA.setTrack(null==(e=this.videoTrack)?void 0:e.clone())}catch(e){BS.error("Troubleshooter::camTest::Error while setting track",{error:e})}}}))}updateVideoConstraints(e){return tr(this,null,(function*(){if(!this.localMediaHandler.updateVideoConstraints)throw new $S("Unsupported");yield this.localMediaHandler.updateVideoConstraints(e)}))}enableScreenShare(){return tr(this,null,(function*(){var e;if(!this.roomJoined)throw new $S("Can`t enable screenshare without joining room");if(Yt(this,wA).canProduceScreenshare===rT.notAllowed||Yt(this,wA).canProduceScreenshare===rT.canRequest&&("OFF_STAGE"===this.stageStatus||"REQUESTED_TO_JOIN_STAGE"===this.stageStatus)||this.screenShareEnabled)return;if(yield this.localMediaHandler.enableScreenShare(),this.screenShareTracks.audio||this.screenShareTracks.video)try{yield Yt(this,CA,IA).shareScreen(this.screenShareTracks)}catch(e){BS.error("DyteSelf::enableScreenShare::Error while sharing screen",{error:e}),this.screenShareEnabled&&(yield this.localMediaHandler.disableScreenShare())}this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks});const t=In.hasFeature(DS.TROUBLESHOOTING);if(t&&this.screenShareTracks.audio)try{GI.setTrack(this.screenShareTracks.audio)}catch(e){BS.error("Troubleshooter::screenshareMicTest::Error while setting track",{error:e})}if(t&&this.screenShareTracks.video)try{TA.setTrack(null==(e=this.screenShareTracks.video)?void 0:e.clone())}catch(e){BS.error("Troubleshooter::screenshareCamTest::Error while setting track",{error:e})}}))}updateScreenshareConstraints(e){return tr(this,null,(function*(){if(!this.localMediaHandler.updateScreenshareConstraints)throw new $S("Unsupported");yield this.localMediaHandler.updateScreenshareConstraints(e)}))}disableAudio(){return tr(this,null,(function*(){this.audioEnabled&&(this.localMediaHandler.disableAudio(),this.roomJoined&&Yt(this,CA,IA).muteSelf(),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}),gn.audioOff())}))}disableVideo(){return tr(this,null,(function*(){this.videoEnabled&&(yield this.localMediaHandler.disableVideo(),this.roomJoined&&(yield Yt(this,CA,IA).pauseWebcam()),"ACCEPTED"===this.mediaPermissions.video)&&(this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}),gn.videoOff(),In.hasFeature(DS.TROUBLESHOOTING)&&!SA.preview&&SA.cleanup())}))}disableScreenShare(){return tr(this,null,(function*(){this.screenShareEnabled&&(yield this.localMediaHandler.disableScreenShare(),this.roomJoined&&(yield Yt(this,CA,IA).disableScreenShare()),this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks}),In.hasFeature(DS.TROUBLESHOOTING)&&(TA.cleanup(),GI.cleanup()))}))}getAllDevices(){return this.localMediaHandler.getAllDevices()}setIsPinned(e,t=!0){Zt(this,kA,e);const r=e?"pinned":"unpinned";t&&this.emit(r,this)}get isPinned(){return Yt(this,kA)}get webinarStageStatus(){return Yt(this,RA)}pin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new $S("Can`t pin participants without joining room");return Yt(this,CA,IA).pinPeer(this.id)}))}unpin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new $S("Can`t unpin participants without joining room");return Yt(this,CA,IA).pinPeer(null)}))}setDevice(e){return tr(this,null,(function*(){var t,r,n;if(!e)throw new $S("No device selected");const i={added:[e],removed:[]},s=this.getCurrentDevices();if(e.deviceId&&((null==(t=null==s?void 0:s.audio)?void 0:t.deviceId)===e.deviceId||(null==(r=null==s?void 0:s.video)?void 0:r.deviceId)===e.deviceId||(null==(n=null==s?void 0:s.speaker)?void 0:n.deviceId)===e.deviceId)&&(BS.warn("DyteSelf.setDevice.setting_to_in_use_device",{devices:[e]}),In.hasFeature(DS.SKIP_SETTING_IN_USE_DEVICE)))throw new $S("Cannot set device currently in use");if("isDeprecated"in this.localMediaHandler)yield this.localMediaHandler.onDeviceChange(i,!0);else switch(e.kind){case"audioinput":try{yield this.localMediaHandler.setAudioDevice(e)}catch(e){this.roomJoined&&(yield Yt(this,CA,IA).muteSelf()),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack})}break;case"audiooutput":yield this.localMediaHandler.setSpeakerDevice(e);break;case"videoinput":try{yield this.localMediaHandler.setVideoDevice(e)}catch(e){this.roomJoined&&(yield Yt(this,CA,IA).pauseWebcam()),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack})}}}))}cleanUpTracks(){var e,t,r,n;null==(e=this.audioTrack)||e.stop(),null==(t=this.rawAudioTrack)||t.stop(),null==(r=this.videoTrack)||r.stop(),null==(n=this.rawVideoTrack)||n.stop()}requestToJoinStage(){return tr(this,null,(function*(){tT.emitAsync(XS.REQUEST_TO_JOIN_STAGE)}))}withdrawRequestToJoinStage(){return tr(this,null,(function*(){tT.emitAsync(XS.WITHDRAW_REQUEST_TO_JOIN_STAGE)}))}leaveStage(){return tr(this,null,(function*(){tT.emitAsync(XS.LEAVE_STAGE)}))}joinStage(){return tr(this,null,(function*(){tT.emitAsync(XS.JOIN_STAGE)}))}setWebinarStageStatus(e){switch(Zt(this,RA,e),tT.emit(XS.SET_WEBINAR_STAGE_STATUS,e),e){case"ACCEPTED_TO_JOIN_STAGE":this.emit("joinStageRequestAccepted");break;case"REQUESTED_TO_JOIN_STAGE":this.emit("peerRequestToJoinStage");break;case"OFF_STAGE":this.emit("stageLeft")}}disablePreview(){return tr(this,null,(function*(){return this}))}},bA=new WeakMap,wA=new WeakMap,kA=new WeakMap,RA=new WeakMap,CA=new WeakSet,IA=function(){return _C()},AA);OA([VS.trace("DyteSelf.setupEvents")],xA.prototype,"setupEvents",1),OA([VS.trace("DyteSelf.setupTracks")],xA.prototype,"setupTracks",1),OA([VS.trace("DyteSelf.resetSelf")],xA.prototype,"resetSelf",1),OA([VS.trace("DyteSelf.destructMediaHandler")],xA.prototype,"destructMediaHandler",1),OA([VS.trace("DyteSelf.removeDocumentEventListeners")],xA.prototype,"removeDocumentEventListeners",1),OA([$I({methodName:"meeting.self.enableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),VS.trace("DyteSelf.enableAudio")],xA.prototype,"enableAudio",1),OA([$I({methodName:"meeting.self.enableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),VS.trace("DyteSelf.enableVideo")],xA.prototype,"enableVideo",1),OA([VS.trace("DyteSelf.updateVideoConstraints")],xA.prototype,"updateVideoConstraints",1),OA([VS.trace("DyteSelf.enableScreenShare"),$I({methodName:"meeting.self.enableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3})],xA.prototype,"enableScreenShare",1),OA([VS.trace("DyteSelf.updateScreenshareConstraints")],xA.prototype,"updateScreenshareConstraints",1),OA([$I({methodName:"meeting.self.disableAudio",lockName:"DyteSelf.toggleAudio",timeout:3e3}),VS.trace("DyteSelf.disableAudio")],xA.prototype,"disableAudio",1),OA([$I({methodName:"meeting.self.disableVideo",lockName:"DyteSelf.toggleVideo",timeout:3e3}),VS.trace("DyteSelf.disableVideo")],xA.prototype,"disableVideo",1),OA([$I({methodName:"meeting.self.disableScreenShare",lockName:"DyteSelf.toggleScreenShare",timeout:3e3}),VS.trace("DyteSelf.disableScreenShare")],xA.prototype,"disableScreenShare",1),OA([VS.trace("DyteSelf.setDevice")],xA.prototype,"setDevice",1),OA([VS.trace("DyteSelf.requestToJoinStage")],xA.prototype,"requestToJoinStage",1),OA([VS.trace("DyteSelf.withdrawRequestToJoinStage")],xA.prototype,"withdrawRequestToJoinStage",1),OA([VS.trace("DyteSelf.leaveStage")],xA.prototype,"leaveStage",1),OA([VS.trace("DyteSelf.joinStage")],xA.prototype,"joinStage",1),OA([VS.trace("DyteSelf.deprecated.disablePreview")],xA.prototype,"disablePreview",1),xA=OA([KS((e=>{throw new $S(e.message,"1100")}))],xA);class LA{constructor(e){Kt(this,"socket"),this.socket=e,this.handleSocketEvents()}static create(e){return NA||(NA=new LA(e)),NA}static cleanup(){var e;try{null==(e=null==NA?void 0:NA.socket)||e.disconnect()}catch(e){BS.error("roomSocketHandler::cleanup")}NA=void 0}set onReconnect(e){this.socket.onStateEvent("reconnected",e)}joinRoom(e,t,r,n,i){return tr(this,null,(function*(){const s={capabilities:[],peer:{displayName:e,peerId:t,userId:r,waitlisted:!1},roomUuid:n},o=YE.fromBinary((yield this.socket.sendMessagePromise(Jw.joinRoom,ob.toBinary(s))).payload);yield tT.emitAsync(XS.SOCKET_SERVICE_ROOM_JOINED,o);try{const{room:e}=yield this.getRoomState();if(i===vn.GroupCall||i===vn.Webinar){const{peers:e}=yield this.getRoomPeersNonPaginated();yield tT.emitAsync(XS.SOCKET_PEERS,e)}tT.emit(XS.ROOM_STATE,e)}catch(e){BS.error("RoomSocketHandler.joinRoom.failedToGetRoomState",{error:e})}}))}getAllAddedParticipants(){return tr(this,null,(function*(){try{return kb.fromBinary((yield this.socket.sendMessagePromise(Jw.getAllAddedParticipants)).payload).participants.map((e=>{var t=e,{id:r}=t,n=Jt(t,["id"]);return zt($t({},n),{userId:r})}))}catch(e){return[]}}))}getRoomPeers(e,t,r){return tr(this,null,(function*(){let n;try{const i={seachQuery:e,limit:t,offset:r},s=yield this.socket.sendMessagePromise(Jw.getRoomPeersInfo,ZE.toBinary(i));n=eb.fromBinary(s.payload)}catch(e){BS.error("getRoomPeers::binary_decode_error",{error:e})}return n}))}getRoomPeersNonPaginated(){return tr(this,null,(function*(){let e;try{const t=yield this.socket.sendMessagePromise(Jw.getRoomPeersInfo);e=eb.fromBinary(t.payload)}catch(e){BS.error("getRoomJoinedPeers::binary_decode_error",{error:e})}return e}))}getPeerInfo(e){return tr(this,null,(function*(){let t;try{const r=yield this.socket.sendMessagePromise(Jw.getPeerInfo,sb.toBinary({peerId:e}));t=YE.fromBinary(r.payload)}catch(e){BS.error("getPeerInfo::binary_decode_error",{error:e})}return t}))}getRoomState(){return tr(this,null,(function*(){let e=ib.create();try{const t=yield this.socket.sendMessagePromise(Jw.getRoomInfo);e=ib.fromBinary(t.payload)}catch(e){BS.error("getRoomState::binary_decode_error",{error:e})}return e}))}getRoomStageState(){return tr(this,null,(function*(){let e=Mb.create();try{const t=yield this.socket.sendMessagePromise(Jw.getRoomStageState);e=Mb.fromBinary(t.payload)}catch(e){BS.error("getRoomStageState::binary_decode_error",{error:e})}return e}))}broadcastMessage(e,t){return tr(this,null,(function*(){const r={type:e,payload:(new TextEncoder).encode(JSON.stringify(t)),timestamp:Date.now(),peerIds:[]};return this.socket.sendMessagePromise(Jw.broadcastMessage,Ib.toBinary(r))}))}broadcastToPeers(e,t,r){return tr(this,null,(function*(){const n={type:e,payload:(new TextEncoder).encode(JSON.stringify(r)),timestamp:Date.now(),peerIds:t};return this.socket.sendMessagePromise(Jw.broadcastToPeers,Ib.toBinary(n))}))}leaveRoom(){this.socket.sendMessage(Jw.leaveRoom,ab.toBinary({}))}kick(e){return tr(this,null,(function*(){const t={peerIds:[e]};this.socket.sendMessage(Jw.kick,Cb.toBinary(t))}))}kickAll(){return tr(this,null,(function*(){this.socket.sendMessage(Jw.kickAll)}))}getWaitingRoomRequests(){this.socket.sendMessage(Jw.getWaitingRoomRequests)}acceptWaitingRoomRequest(e){const t={userIds:e};this.socket.sendMessage(Jw.acceptWaitingRoomRequests,Ab.toBinary(t))}rejectWaitingRoomRequest(e){const t={userIds:e};this.socket.sendMessage(Jw.denyWaitingRoomRequests,Pb.toBinary(t))}updatePermissions(e,t){return tr(this,null,(function*(){const r={updatePeersPresets:[]};return e.forEach((e=>{r.updatePeersPresets.push({userIds:e,patch:t})})),this.socket.sendMessagePromise(ek.updateUserPreset,vE.toBinary(r))}))}handleSocketEvents(){this.socket.on(Jw.broadcastMessage,(({payload:e})=>{try{const t=Ib.fromBinary(e);tT.emit(XS.ROOM_MESSAGE,{payload:JSON.parse((new TextDecoder).decode(t.payload)),type:t.type,timestamp:t.timestamp})}catch(e){BS.error("failed to decode broadcast message:",e)}})),this.socket.on(Jw.broadcastToPeers,(({payload:e})=>{try{const t=Ib.fromBinary(e);tT.emit(XS.MESSAGE,{payload:JSON.parse((new TextDecoder).decode(t.payload)),type:t.type,timestamp:t.timestamp})}catch(e){BS.error("failed to decode peer broadcast message:",e)}}))}on(e,t){let r,n;switch(e){case Jw.joinRoom:case Jw.leaveRoom:case Jw.kick:case Jw.kickAll:r=YE.fromBinary.bind(YE),n=YE.create();break;case Jw.getWaitingRoomRequests:r=(e,t)=>e?Ob.fromBinary(e,t):{requests:[]},n=Ob.create();break;case Jw.recordingPaused:case Jw.recordingStarted:case Jw.recordingStopped:r=pw.fromBinary.bind(pw);break;case ek.updateUserPreset:r=yE.fromBinary.bind(yE)}this.socket.on(e,(({payload:e})=>{let i=n;if(!r)return t(void 0);try{i=r(e)}catch(e){BS.error("roomSocketHandler::on::binary_decode_error",{error:e})}return t(i)}))}getUserPermissions(e){return tr(this,null,(function*(){const t={userIds:[e]};try{const e=yield this.socket.sendMessagePromise(ek.getUserPresets,pE.toBinary(t)),r=fE.fromBinary(e.payload).peerPresets[0],n=(new TextDecoder).decode(r.preset),i=JSON.parse(n).permissions;return{chat:i.chat,polls:i.polls,plugins:i.plugins}}catch(e){throw BS.error("Error in getting user preset",{error:e}),e}}))}}var UA,jA,FA,VA,BA,HA=Object.defineProperty,WA=Object.getOwnPropertyDescriptor,GA=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?WA(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&HA(t,r,s),s};const qA=(BA=class{constructor(e,t,r,n){var i,s,o,a;Xt(this,FA),Kt(this,"self"),Kt(this,"authToken"),Kt(this,"peerId"),Xt(this,UA,void 0),Kt(this,"roomNodeSetupInProgress",!1),Kt(this,"viewType"),Xt(this,jA,void 0),Zt(this,UA,e),Zt(this,jA,r),this.authToken=null!=(s=null==(i=_C())?void 0:i.authToken)?s:e.authToken,this.peerId=null!=(a=null==(o=_C())?void 0:o.peerId)?a:e.peerId,this.self=t,this.viewType=n,t.config.viewType!==vn.Chat&&this.setupEvents()}get roomJoined(){var e;return!0===(null==(e=Yt(this,FA,VA))?void 0:e.roomJoined)}static init(e,t,r,n,i,s,o=!1){return tr(this,null,(function*(){var a,c;const d=$w(),{isV2AuthToken:l}=Sw,u=yield xA.__init__(null!=(c=null==(a=_C())?void 0:a.peerId)?c:e.peerId,Sw.isV2AuthToken?r.participant:r,n,i,s,o),h=l?r.participant.organizationId:r.organizationId;if(VS.meetingMetadata.organizationId=h,In.hasFeature(DS.INTERNAL_CALL_STATS)&&"ReactNative"!==navigator.product){In.getValue(DS.CALLSTATS_INGESTION_LAYER);const t=!In.hasFeature(DS.PRECALL_BANDWIDTH_TEST);setTimeout((()=>tr(this,null,(function*(){var r,n;gn.initialize({peerId:null!=(n=null==(r=_C())?void 0:r.peerId)?n:e.peerId,engineName:_S.getDeviceInfo().engineName,env:td.env,iceServers:yield d.getICEServers(),apiBase:td.apiBase,flags:In.getAllFlags(),logger:BS,apiHostnames:Ow(),skipConnectivityChecks:t})}))))}return new qA(e,u,t,i.viewType)}))}shareMediaTracks(){return tr(this,null,(function*(){if(this.self.audioTrack&&this.self.audioEnabled)try{yield Yt(this,FA,VA).shareMic(this.self.audioTrack)}catch(e){this.self.disableAudio()}if(this.self.videoTrack)try{const e=yield Yt(this,FA,VA).shareWebcam(this.self.videoTrack);e&&e.id!==this.self.videoTrack.id&&In.hasFeature(DS.EXP_RESHARE)&&(yield Yt(this,FA,VA).shareWebcam(this.self.videoTrack))}catch(e){this.self.disableVideo()}}))}kickHandler(e){return tr(this,null,(function*(){let t="kicked";"kickAll"===(null==e?void 0:e.kickType)&&(t="ended"),this.leaveRoom(t)}))}waitlistedHandler(e){BS.info("SelController.waitlisted",{source:e}),this.self.waitlistStatus="waiting",this.self.roomState="waitlisted",this.self.emit("waitlisted")}waitlistAcceptHandler(e){BS.info("SelController.waitlistAccepted",{source:e}),"accepted"!==this.self.waitlistStatus?(this.self.waitlistStatus="accepted",this.joinRoom()):BS.warn("SelfController.WAITLIST_ACCEPTED.UserAlreadyAccepted")}waitlistRejectedHandler(e){BS.info("SelfController.waitlistRejected",{source:e}),"rejected"!==this.self.waitlistStatus?(this.self.waitlistStatus="rejected",this.leaveRoom("rejected")):BS.warn("SelfController.WAITLIST_REJECTED.UserAlreadyRejected")}setupEvents(){tT.on(XS.DISABLE_AUDIO,(()=>tr(this,null,(function*(){this.self.audioEnabled&&(yield this.self.disableAudio(),gn.audioOff())})))),tT.on(XS.DISABLE_VIDEO,(()=>tr(this,null,(function*(){this.self.videoEnabled&&(yield this.self.disableVideo(),gn.videoOff())})))),tT.on(XS.MUTE_ALL,(()=>tr(this,null,(function*(){this.self.audioEnabled&&(yield this.self.disableAudio(),gn.audioOff())})))),tT.on(XS.MUTE_ALL_VIDEO,(()=>tr(this,null,(function*(){this.self.videoEnabled&&(yield this.self.disableVideo(),gn.videoOff())})))),tT.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(e=>tr(this,null,(function*(){var t;null!=(t=null==e?void 0:e.peer)&&t.waitlisted&&Yt(this,FA,VA)instanceof OR&&this.waitlistedHandler("socketservice")})))),tT.on(XS.WAITLISTED,(()=>{this.waitlistedHandler("roomnode")})),tT.on(XS.WAITLIST_ACCEPTED,(()=>tr(this,null,(function*(){this.waitlistAcceptHandler("roomnode")})))),Yt(this,jA).on(Jw.waitingRoomRequestAccepted,(()=>{this.waitlistAcceptHandler("socketservice")})),Yt(this,jA).on(ek.updateUserPreset,(e=>{e.updatePeersPresets.forEach((e=>{e.userIds===this.self.userId&&tT.emit(XS.UPDATE_PERMISSIONS,e.patch)}))})),tT.on(XS.WAITLIST_REJECTED,(()=>tr(this,null,(function*(){this.waitlistRejectedHandler("roomnode")})))),Yt(this,jA).on(Jw.waitingRoomRequestDenied,(()=>{this.waitlistRejectedHandler("socketservice")})),tT.on(XS.KICKED,this.kickHandler.bind(this)),Yt(this,jA).on(Jw.kick,(()=>{this.kickHandler({kickType:"kick"})})),Yt(this,jA).on(Jw.kickAll,(()=>{this.kickHandler({kickType:"kickAll"})})),tT.on(XS.PRODUCER_SCORE_UPDATE,(({score:e,kind:t,appData:r})=>{var n;const i="video"===t&&null!=(n=null==r?void 0:r.screenShare)&&n;this.self.emit("mediaScoreUpdate",{kind:t,isScreenshare:i,score:e,participantId:this.self.id})})),tT.onAsync(XS.JOIN_MEDIA_ROOM,this.setupRoomNode.bind(this)),tT.onAsync(XS.LEAVE_MEDIA_ROOM,this.leaveMediaRoom.bind(this)),tT.on(XS.PIP_HANGUP,this.leaveRoom.bind(this)),tT.onAsync(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){"ON_STAGE"===e&&(yield this.shareMediaTracks())})))),tT.on(XS.HIVE_ROOM_REJOINED,(()=>{this.shareMediaTracks()}))}setupRoomNode(){return tr(this,null,(function*(){var e;if(this.roomNodeSetupInProgress)return void BS.warn("SelfController.roomNodeSetupInProgress");if(null!=(e=Yt(this,FA,VA))&&e.roomJoined)return void BS.warn("SelfController.roomNodeAlreadySetup");this.roomNodeSetupInProgress=!0;const t=()=>tr(this,null,(function*(){var e,t;let r="";if(Yt(this,FA,VA)instanceof fC){yield Yt(this,FA,VA).setupTransports();const n=yield Yt(this,FA,VA).getRoomState();({roomUUID:r}=null!=(t=null==(e=null==n?void 0:n.payload)?void 0:e.roomState)?t:{}),$w().setRoomUUID(r)}yield this.joinMediaRoom(r),this.roomNodeSetupInProgress=!1})),r=Sw.roomNodeOptions;r.useHiveMedia?yield gC(zt($t({},r),{roomName:r.roomName,peerId:r.peerId,socket:Yt(this,UA)})):yield vC(zt($t({},r),{roomName:r.roomName,peerId:r.peerId,viewType:this.viewType})),Yt(this,FA,VA).mediaConnected||Yt(this,UA).isConnected&&"HIVE"===this.self.permissions.mediaRoomType?t():tT.once(XS.ROOM_NODE_CONNECTED,(()=>tr(this,null,(function*(){t()}))))}))}joinRoom(){return tr(this,null,(function*(){var e,t;try{const r=$w();let n="";if(Yt(this,FA,VA)instanceof fC){const i=yield Yt(this,FA,VA).getRoomState();({roomUUID:n}=null!=(t=null==(e=null==i?void 0:i.payload)?void 0:e.roomState)?t:{}),r.setRoomUUID(n)}else r.setRoomUUID(Sw.meetingId);Cw(this.self.config.viewType,Yt(this,UA).capabilities)&&(yield Yt(this,jA).joinRoom(this.self.name,this.self.id,this.self.userId,n,this.self.config.viewType),Yt(this,jA).socket.flush(),Yt(this,jA).onReconnect=()=>tr(this,null,(function*(){yield Yt(this,jA).joinRoom(this.self.name,this.self.id,this.self.userId,n,this.self.config.viewType),Yt(this,jA).socket.flush()}))),EA(this.self.config)&&(yield this.joinMediaRoom(n))}catch(e){throw BS.error("Error in joinRoom",{error:e}),e}}))}leaveRoom(e="left"){return tr(this,null,(function*(){var t;const{roomJoined:r}=this;In.hasFeature(DS.LEAVE_STAGE_ON_END)&&this.self.permissions.stageEnabled&&"ON_STAGE"===this.self.stageStatus&&"left"===e&&(yield tT.emitAsync(XS.LEAVE_STAGE)),yield this.leaveMediaRoom();try{null==(t=Yt(this,UA))||t.disconnect()}catch(e){BS.error("SelfController::leaveRoom::socketDisconnect")}this.self.roomState=e,yC(),LA.cleanup(),("rejected"===e||"LIVESTREAM"===this.self.config.viewType||r)&&this.self.emit("roomLeft",{state:e})}))}joinMediaRoom(e){return tr(this,null,(function*(){var t,r,n,i;if(null!=(t=Yt(this,FA,VA))&&t.isDisconnected&&Yt(this,FA,VA)instanceof fC)return void(null==(r=Yt(this,FA,VA))||r.reconnect());if(Yt(this,FA,VA)instanceof OR&&"waiting"===this.self.waitlistStatus)return;const{roomJoined:s}=null!=(i=yield null==(n=Yt(this,FA,VA))?void 0:n.joinRoom(this.self.name,!this.self.audioEnabled,e,void 0,{audio:this.self.audioEnabled,video:this.self.videoEnabled,screen:this.self.screenShareEnabled}))?i:{};Yt(this,FA,VA)instanceof OR&&(Yt(this,FA,VA).onSocketReconnection=this.joinMediaRoom.bind(this,e)),s&&(this.self.roomState="joined",this.self.emit("roomJoined"),yield this.shareMediaTracks())}))}leaveMediaRoom(){return tr(this,null,(function*(){yield this.cleanupSelf(),Yt(this,FA,VA)&&this.roomJoined&&(yield Yt(this,FA,VA).leaveRoom(),Yt(this,FA,VA).roomJoined=!1)}))}cleanupSelf(){return tr(this,null,(function*(){yield this.self.disableAudio(),yield this.self.disableVideo(),yield this.self.disableScreenShare(),this.self.cleanUpTracks(),this.self.destructMediaHandler(),this.self.removeDocumentEventListeners()}))}},UA=new WeakMap,jA=new WeakMap,FA=new WeakSet,VA=function(){return _C()},BA);let $A=qA;GA([VS.trace("SelfController.setupEvents")],$A.prototype,"setupEvents",1),GA([VS.trace("SelfController.joinRoom")],$A.prototype,"joinRoom",1),GA([VS.trace("SelfController.leaveRoom")],$A.prototype,"leaveRoom",1),GA([VS.trace("SelfController.joinMediaRoom")],$A.prototype,"joinMediaRoom",1),GA([VS.trace("SelfController.leaveMediaRoom")],$A.prototype,"leaveMediaRoom",1);var zA,JA,KA,QA,YA,XA,ZA,eP=Object.defineProperty,tP=Object.getOwnPropertyDescriptor,rP=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?tP(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&eP(t,r,s),s};let nP=(ZA=class extends WS{constructor(e,t,r){super(),Xt(this,KA),Kt(this,"id"),Kt(this,"userId"),Kt(this,"name"),Kt(this,"picture"),Kt(this,"isHost"),Kt(this,"customParticipantId"),Kt(this,"flags"),Kt(this,"device"),Kt(this,"videoTrack"),Kt(this,"audioTrack"),Kt(this,"screenShareTracks"),Kt(this,"videoEnabled"),Kt(this,"audioEnabled"),Kt(this,"screenShareEnabled"),Kt(this,"producers"),Xt(this,zA,void 0),Kt(this,"supportsRemoteControl",!1),Xt(this,JA,void 0),Kt(this,"presetName"),Xt(this,YA,void 0),Xt(this,XA,void 0);const{id:n,userId:i,displayName:s,device:o,picture:a,isHost:c,flags:d,clientSpecificId:l,stageStatus:u,customParticipantId:h,audioMuted:p,audioTrack:m,videoEnabled:f=!1,videoTrack:g,producers:v,metadata:y}=e;this.id=n,this.userId=i,this.name=s,this.device=o,this.picture=a,this.isHost=c,this.flags=d,Zt(this,JA,null!=u?u:MA.ON_STAGE),this.customParticipantId=null!=h?h:l,this.audioEnabled=!p,this.audioTrack=m,this.videoEnabled=f,this.videoTrack=g,this.screenShareTracks={audio:void 0,video:void 0},this.producers=null!=v?v:[],this.presetName=null==y?void 0:y.preset_name,Zt(this,zA,!1),Zt(this,YA,t),Zt(this,XA,r),this.setupEvents()}get clientSpecificId(){return this.customParticipantId}get webinarStageStatus(){return Yt(this,JA)}get stageStatus(){return Yt(this,JA)}get roomJoined(){var e;return!0===(null==(e=Yt(this,KA,QA))?void 0:e.roomJoined)}setVideoEnabled(e,t=!0){this.videoEnabled=e,t&&(BS.info("DyteParticipant::setVideoEnabled::videoUpdate",$t({},SC(this))),this.emit("videoUpdate",{videoEnabled:this.videoEnabled,videoTrack:this.videoTrack}))}setAudioEnabled(e,t=!0){this.audioEnabled=e,t&&(BS.info("DyteParticipant::setAudioEnabled::audioUpdate",$t({},SC(this))),this.emit("audioUpdate",{audioEnabled:this.audioEnabled,audioTrack:this.audioTrack}))}setScreenShareEnabled(e,t=!0){this.screenShareEnabled=e,t&&this.emit("screenShareUpdate",{screenShareEnabled:this.screenShareEnabled,screenShareTracks:this.screenShareTracks})}setupEvents(){tT.onAsync(XS.UPDATE_PEER_STAGE_STATUS,(e=>tr(this,[e],(function*({id:e,status:t}){e===this.id&&t!==this.stageStatus&&this.setStageStatus(t)}))))}pin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new $S("Can`t pin participant without joining room");if(!Yt(this,YA).permissions.pinParticipant)throw new $S("You do not have permission to pin participants.");return Yt(this,KA,QA).pinPeer(this.id)}))}unpin(){return tr(this,null,(function*(){if(!this.roomJoined)throw new $S("Can`t unpin participant without joining room");if(!Yt(this,YA).permissions.pinParticipant)throw new $S("You do not have permission to unpin participants.");return Yt(this,KA,QA).pinPeer(null)}))}setIsPinned(e,t=!0){Zt(this,zA,e);const r=e?"pinned":"unpinned";t&&this.emit(r,this)}disableAudio(){return tr(this,null,(function*(){const e=this.id;if(BS.info("DyteParticipant::disable_audio",{dyteParticipant:{id:e}}),!this.roomJoined)throw new $S("Can`t disable participant audio without joining room");if(Yt(this,YA).permissions.canDisableParticipantAudio)return Yt(this,KA,QA).disableAudio(e);throw BS.error("DyteParticipant::unauthorized_disable_audio",{dyteParticipant:{id:e}}),new $S("Unauthorized: User does not have permission to disable participant audio.")}))}kick(){return tr(this,null,(function*(){const e=this.id;if(BS.info("DyteParticipant::kick",{dyteParticipant:{id:e}}),!this.roomJoined)throw new $S("Can`t kick participant without joining room");if(!Yt(this,YA).permissions.kickParticipant)throw BS.error("DyteParticipant::unauthorized_kick",{dyteParticipant:{id:e}}),new $S("Unauthorized: User does not have permission to kick participants.");yield tT.emitAsync(XS.KICK_PEER,{peerId:e})}))}disableVideo(){return tr(this,null,(function*(){const e=this.id;if(BS.info("DyteParticipant::disable_video",{dyteParticipant:{id:e}}),!this.roomJoined)throw new $S("Can`t disable participant video without joining room");if(Yt(this,YA).permissions.canDisableParticipantVideo)return Yt(this,KA,QA).disableVideo(e);throw BS.error("DyteParticipant::unauthorized_disable_video",{dyteParticipant:{id:e}}),new $S("Unauthorized: User does not have permission to disable participant video.")}))}acceptJoinStageRequest(){return tr(this,null,(function*(){tT.emitAsync(XS.ACCEPT_JOIN_STAGE_REQUEST,{userId:this.userId})}))}rejectRequestToJoinStage(){return tr(this,null,(function*(){tT.emitAsync(XS.REJECT_REQUEST_TO_JOIN_STAGE,{userId:this.userId})}))}getPermissions(){return tr(this,null,(function*(){return Yt(this,XA).getUserPermissions(this.userId)}))}removeFromStage(){return tr(this,null,(function*(){tT.emitAsync(XS.REMOVE_FROM_STAGE,{userId:this.userId})}))}setStageStatus(e){let t;Zt(this,JA,e),e===MA.OFF_STAGE&&(t="peerStoppedPresenting"),e===MA.ON_STAGE&&(t="peerStartedPresenting"),e===MA.ACCEPTED_TO_JOIN_STAGE&&(t="peerAcceptedToJoinStage"),e===MA.REQUESTED_TO_JOIN_STAGE&&(Yt(this,KA,QA)instanceof fC&&tT.emit(XS.NEW_STAGE_REQUEST,{count:1}),t="peerRequestToJoinStage"),t&&this.emit(t,this),this.emit("stageStatusUpdate",this)}setWebinarStageStatus(e){this.setStageStatus(e)}get isPinned(){return Yt(this,zA)}},zA=new WeakMap,JA=new WeakMap,KA=new WeakSet,QA=function(){return _C()},YA=new WeakMap,XA=new WeakMap,ZA);var iP,sP,oP;rP([VS.trace("DyteParticipant.disableAudio")],nP.prototype,"disableAudio",1),rP([VS.trace("DyteParticipant.kick")],nP.prototype,"kick",1),rP([VS.trace("DyteParticipant.disableVideo")],nP.prototype,"disableVideo",1),rP([VS.trace("DyteParticipant.acceptJoinStageRequest")],nP.prototype,"acceptJoinStageRequest",1),rP([VS.trace("DyteParticipant.rejectRequestToJoinStage")],nP.prototype,"rejectRequestToJoinStage",1),rP([VS.trace("DyteParticipant.getPermissions")],nP.prototype,"getPermissions",1),rP([VS.trace("DyteParticipant.removeFromStage")],nP.prototype,"removeFromStage",1),rP([VS.trace("DyteParticipant.setStageStatus")],nP.prototype,"setStageStatus",1),nP=rP([KS((e=>{throw new $S(e.message,"1200")}))],nP);class aP extends Map{constructor(e){const{onAddEvent:t,onDeleteEvent:r,onClearEvent:n}=e;super(),Xt(this,iP,void 0),Xt(this,sP,void 0),Kt(this,"onAddEvent"),Kt(this,"onDeleteEvent"),Kt(this,"onClearEvent"),Zt(this,iP,new HS),this.onAddEvent=t,this.onDeleteEvent=r,this.onClearEvent=n,Zt(this,sP,new Map)}emit(e,...t){return Yt(this,iP).emit(e,...t)}on(e,t){return Yt(this,iP).on(e,t)}addListener(e,t){return Yt(this,iP).addListener(e,t)}off(e,t){return Yt(this,iP).off(e,t)}once(e,t){return Yt(this,iP).once(e,t)}prependListener(e,t){return Yt(this,iP).prependListener(e,t)}prependOnceListener(e,t){return Yt(this,iP).prependOnceListener(e,t)}removeListener(e,t){return Yt(this,iP).removeListener(e,t)}removeAllListeners(e){return Yt(this,iP).removeAllListeners(e)}listeners(e){return Yt(this,iP).listeners(e)}listenerCount(e){return Yt(this,iP).listenerCount(e)}getMaxListeners(){return Yt(this,iP).getMaxListeners()}setMaxListeners(e){return Yt(this,iP).setMaxListeners(e)}eventNames(){return Yt(this,iP).eventNames()}add(e,t=!0){return this.set(e.id,e,t)}set(e,t,r=!0){const n=super.set(e,t),i=(e,...r)=>{this.emit(e,t,...r)};return Yt(this,sP).set(e,i),t.on("*",i),r&&Yt(this,iP).emit(this.onAddEvent,t),n}delete(e,t=!0,r=!1){const n=this.get(e);if(!n)return!1;n.removeListener("*",Yt(this,sP).get(e));const i=super.delete(e);return r&&n.removeAllListeners(),t&&Yt(this,iP).emit(this.onDeleteEvent,n),i}clear(e=!0,t=!1){this.forEach((e=>{e.removeListener("*",Yt(this,sP).get(e.id)),t&&e.removeAllListeners()}));const r=super.clear();return e&&Yt(this,iP).emit(this.onClearEvent),r}toArray(){return Array.from(this.values())}}iP=new WeakMap,sP=new WeakMap;class cP extends aP{constructor(e){const{onAddEvent:t="participantJoined",onDeleteEvent:r="participantLeft",onClearEvent:n="participantsCleared"}=null!=e?e:{};super({onAddEvent:t,onDeleteEvent:r,onClearEvent:n})}add(e,t=!0){return this.has(e.id)&&!1===Object.is(this.get(e.id),e)&&this.delete(e.id),super.add(e,t)}clear(e=!0,t=!1){return super.clear(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}class dP{constructor(){Kt(this,"_orderedArray"),Kt(this,"_map"),this._map=new Map,this._orderedArray=[]}add(e,t){if(!this._map.has(e))return this._map.set(e,{peerId:e,priority:t}),this._orderedArray.splice(Math.max(t-1,0),0,e),this.index(e);const r=this.index(e);this.delete(e);const n=this.add(e,t);return r!==n?(BS.info("DyteSelectedPeer::add()::new_position_for_active_speaker",{selectedPeer:{oldIndex:r,newIndex:n}}),n):-1}delete(e){if(this._map.has(e)){const t=this.index(e);this._map.delete(e),this._orderedArray.splice(t,1)}}index(e){return this._map.has(e)?this._orderedArray.indexOf(e):-1}[Symbol.iterator](){return this._orderedArray[Symbol.iterator]()}}class lP{constructor(){Kt(this,"_activeSpeakerPeers"),Kt(this,"_compulsoryPeers"),this._activeSpeakerPeers=new dP,this._compulsoryPeers=new Set}add(e,t){if(t<0)return this._compulsoryPeers.add(e),0;if(this.compulsoryPeers.includes(e)&&(t>0||246267631===t)){if(BS.info("DyteSelectedPeer::removing_compulsory_peer",{selectedPeer:{peerId:e}}),this._removeFromCompulsoryPeer(e),246267631===t)return-1}else if(229490415===t)return this.delete(e),-1;return this._activeSpeakerPeers.add(e,t)}delete(e){BS.info("DyteSelectedPeer::deleting_peer_from_selectedPeer",{selectedPeer:{peerId:e}}),this._removeFromCompulsoryPeer(e),this._activeSpeakerPeers.delete(e)}index(e){return this._activeSpeakerPeers.index(e)}get peers(){return Array.from(new Set(this.compulsoryPeers.concat(this.activeSpeakerPeers)))}get compulsoryPeers(){return Array.from(this._compulsoryPeers.values())}get peerPriorities(){return Array.from(this._activeSpeakerPeers).map(((e,t)=>t))}get activeSpeakerPeers(){return Array.from(this._activeSpeakerPeers)}_removeFromCompulsoryPeer(e){this._compulsoryPeers.delete(e)}}class uP extends HS{constructor(){super(),Xt(this,oP,void 0),Zt(this,oP,new Map)}__set(e,t){return Yt(this,oP).set(e,t)}__clear(){return Yt(this,oP).clear()}get(e){return Yt(this,oP).get(e)}toArray(){return Array.from(Yt(this,oP).values())}}oP=new WeakMap;const hP=CS({setup_screen:{is_enabled:!1},alone_here:{is_enabled:!1},waiting_room:{is_enabled:!1,enable_preview:!0},control_bar:{is_enabled:!0,elements:{plugins:!0,screenshare:!0,invite:!1,participants:!0,chat:!0,reactions:!1,polls:!0,fullscreen:!0,layout:!0}},header:{is_enabled:!0,elements:{logo:"",timer:!0,title:!0,participant_count:!0,change_layout:!0}},pip_mode:!0,auto_tune:!0,grid:{multi:{max_video_count:9,video_fit:"cover"},single:{max_video_count:6,video_fit:"cover"},default_view:"MULTI"},colors:{primary:"#2160FD",secondary:"#1A1A1A",text:"#EEEEEE",background:"#1A1A1A",text_primary:"#EEEEEE",video_background:"#1A1A1A"},controls:{pip_toggle:!1},plugins:[]});var pP,mP,fP,gP,vP;const yP=class{constructor(e){if(Xt(this,pP,void 0),Xt(this,mP,void 0),Xt(this,fP,void 0),Xt(this,gP,void 0),Xt(this,vP,[]),!e)throw new $S("Could not load preset theme.");Zt(this,pP,e),Zt(this,mP,1),Zt(this,fP,vn.GroupCall)}static fromResponse(e){return new yP(e)}static default(){return new yP(hP)}configFromPermissions(e){var t,r,n,i,s,o,a,c,d,l,u,h;Zt(this,mP,e.maxScreenshareCount||1),Zt(this,fP,e.viewType),Zt(this,gP,{audio:{enableHighBitrate:!1,enableStereo:!1},video:{quality:null!=(n=null==(r=null==(t=null==e?void 0:e.produce)?void 0:t.video)?void 0:r.quality)?n:OS.video.quality,frameRate:null!=(o=null==(s=null==(i=null==e?void 0:e.produce)?void 0:i.video)?void 0:s.frameRate)?o:OS.video.frameRate},screenshare:{quality:null!=(d=null==(c=null==(a=null==e?void 0:e.produce)?void 0:a.screenshare)?void 0:c.quality)?d:OS.screenshare.quality,frameRate:null!=(h=null==(u=null==(l=null==e?void 0:e.produce)?void 0:l.screenshare)?void 0:u.frameRate)?h:OS.screenshare.frameRate}})}setDisabledPlugins(e){const t=Yt(this,pP).plugins;t&&t.length>0&&Zt(this,vP,e.filter((e=>!t.includes(e))))}get setupScreen(){return Yt(this,pP).setupScreen}get aloneHere(){return Yt(this,pP).aloneHere}get waitingRoom(){return Yt(this,pP).waitingRoom}get controlBar(){return Yt(this,pP).controlBar}get header(){return Yt(this,pP).header}get pipMode(){var e;return(null==(e=Yt(this,pP).controls)?void 0:e.pipToggle)||Yt(this,pP).pipMode}get viewType(){return Yt(this,fP)}get autoTune(){return Yt(this,pP).autoTune}get grid(){return Yt(this,pP).grid}get maxVideoStreams(){return{mobile:this.grid.multi.maxVideoCount>6?6:this.grid.multi.maxVideoCount,desktop:this.grid.multi.maxVideoCount}}get maxScreenShareCount(){return Yt(this,mP)}get colors(){return Yt(this,pP).colors}get controls(){return Yt(this,pP).controls}get plugins(){return Yt(this,pP).plugins}get disabledPlugins(){return Yt(this,vP)}get mediaConstraints(){return Yt(this,gP)}get isV2(){return!1}};let _P=yP;function SP(e,t=2){return e.replace(/[^\u00BF-\u1FFF\u2C00-\uD7FF\w\s]/g,"").trim().split(/\s+/).slice(0,t).map((e=>e.charAt(0))).join("").toUpperCase()}pP=new WeakMap,mP=new WeakMap,fP=new WeakMap,gP=new WeakMap,vP=new WeakMap;const TP=(e,t,r,n,i,s)=>{const o=i,a=s,c=Math.min(r/o,n/a);let d,l,u,h,p=o*c,m=a*c,f=1;return p<r&&(f=r/p),Math.abs(f-1)<1e-14&&m<n&&(f=n/m),p*=f,m*=f,u=o/(p/r),h=a/(m/n),d=.5*(o-u),l=.5*(a-h),d<0&&(d=0),l<0&&(l=0),u>o&&(u=o),h>a&&(h=a),[d,l,u,h,e,t,r,n]};var EP,bP,wP,kP,RP,CP,IP,AP;class PP extends WS{constructor(e){var t,r,n,i,s,o,a,c;if(super(),Xt(this,EP,void 0),Xt(this,bP,void 0),Xt(this,wP,void 0),Xt(this,kP,{height:1080,width:1920}),Xt(this,RP,{brand:"#2160FD",background:"#141414",videoBackground:"#191919",textOnBrand:"#EEEEEE"}),Xt(this,CP,void 0),Xt(this,IP,{}),Xt(this,AP,void 0),Kt(this,"cleanupEventListeners",(()=>{Yt(this,AP).removeListener("stageJoined",this.enablePipMediaControls),Yt(this,AP).removeListener("stageLeft",this.unmountEvents),Yt(this,AP).removeListener("videoUpdate",this.onSelfVideoUpdateListener),Yt(this,AP).removeListener("audioUpdate",this.onSelfAudioUpdateListener),Yt(this,AP).removeListener("roomLeft",this.disable)})),Kt(this,"enablePipMediaControls",(()=>{this.mountAudioEvents(),this.mountVideoEvents()})),Kt(this,"onSelfVideoUpdateListener",(({videoEnabled:e})=>{this.updateMediaSession("CAMERA",e)})),Kt(this,"onSelfAudioUpdateListener",(({audioEnabled:e})=>{this.updateMediaSession("MIC",e)})),Kt(this,"eventCallback",(e=>{"CAMERA"===e&&(Yt(this,AP).videoEnabled?Yt(this,AP).disableVideo():Yt(this,AP).enableVideo(),this.emit("cameraToggled")),"MIC"===e&&(Yt(this,AP).audioEnabled?Yt(this,AP).disableAudio():Yt(this,AP).enableAudio(),this.emit("micToggled")),"END"===e&&(tT.emit(XS.PIP_HANGUP),this.cleanupEventListeners(),this.emit("hangup"),this.cleanup())})),Kt(this,"unmountEvents",(()=>{void 0===navigator.mediaSession||void 0===navigator.mediaSession.setCameraActive||(navigator.mediaSession.setActionHandler("togglemicrophone",void 0),navigator.mediaSession.setActionHandler("togglecamera",void 0))})),Kt(this,"animate",(()=>{void 0!==Yt(this,IP)&&this.paintCanvas(),void 0!==Yt(this,CP)&&Zt(this,CP,requestAnimationFrame((()=>this.animate())))})),Kt(this,"disable",(()=>{this.cleanupEventListeners(),cancelAnimationFrame(Yt(this,CP)),document.body.removeChild(Yt(this,bP)),Zt(this,CP,void 0),document.exitPictureInPicture()})),Zt(this,AP,e),!0===e.config.isV2)Zt(this,RP,{brand:e.config.designTokens.colors.brand[500],background:e.config.designTokens.colors.background[1e3],videoBackground:e.config.designTokens.colors.videoBg,textOnBrand:e.config.designTokens.colors.textOnBrand});else if(!1===e.config.isV2){const d=_P.default();Zt(this,RP,{brand:null!=(r=null==(t=e.config.colors)?void 0:t.primary)?r:d.colors.primary,background:null!=(i=null==(n=e.config.colors)?void 0:n.background)?i:d.colors.background,videoBackground:null!=(o=null==(s=e.config.colors)?void 0:s.videoBackground)?o:d.colors.videoBackground,textOnBrand:null!=(c=null==(a=e.config.colors)?void 0:a.textPrimary)?c:d.colors.textPrimary})}}createVideoContainer(){Zt(this,bP,document.createElement("div")),Yt(this,bP).style.width="0.1px",Yt(this,bP).style.height="0.1px",Yt(this,bP).style.overflow="hidden",Yt(this,bP).style.position="absolute",Yt(this,bP).style.bottom="0",Yt(this,bP).style.right="0",Yt(this,bP).style.opacity="0",Yt(this,bP).appendChild(Yt(this,wP))}setupEventListeners(){Yt(this,AP).addListener("stageJoined",this.enablePipMediaControls),Yt(this,AP).addListener("stageLeft",this.unmountEvents),Yt(this,AP).addListener("videoUpdate",this.onSelfVideoUpdateListener),Yt(this,AP).addListener("audioUpdate",this.onSelfAudioUpdateListener),Yt(this,AP).addListener("roomLeft",this.disable)}createCanvas(){const e=document.createElement("canvas");e.height=Yt(this,kP).height,e.width=Yt(this,kP).width,Zt(this,EP,e)}setupMediaSessionEvents(){void 0===navigator.mediaSession||void 0===navigator.mediaSession.setCameraActive||(navigator.mediaSession.setActionHandler("hangup",(()=>{this.eventCallback("END")})),this.mountAudioEvents(),this.mountVideoEvents())}mountAudioEvents(){void 0===navigator.mediaSession||void 0===navigator.mediaSession.setMicrophoneActive||Yt(this,AP).permissions.canProduceAudio&&navigator.mediaSession.setActionHandler("togglemicrophone",(()=>{this.eventCallback("MIC")}))}mountVideoEvents(){void 0===navigator.mediaSession||void 0===navigator.mediaSession.setCameraActive||Yt(this,AP).permissions.canProduceVideo&&navigator.mediaSession.setActionHandler("togglecamera",(()=>{this.eventCallback("CAMERA")}))}getSources(){const e=Object.values(Yt(this,IP)),t=e.filter((e=>e.pinned));return 1===t.length?t:e}drawEmptyTile(e,t,r,n,i){if(void 0===Yt(this,EP))return;const s=Yt(this,EP).getContext("2d"),o=Yt(this,EP).width,a=t-8,c=r-8,d=Math.floor(o/a),l=e%d*(a+4)+4,u=Math.floor(e/d)*(c+4)+4;s.fillStyle=Yt(this,RP).videoBackground,s.strokeStyle=Yt(this,RP).brand,s.beginPath(),s.moveTo(l+4,u),s.arcTo(l+a,u,l+a,u+4,4),s.arcTo(l+a,u+c,l+a-4,u+c,4),s.arcTo(l,u+c,l,u+c-4,4),s.arcTo(l,u,l+4,u,4),s.closePath(),s.fill(),s.stroke();const h=a/6,p=a/2+l,m=c/2+u;if(s.save(),(n||i)&&(s.beginPath(),s.arc(p,m,h,0,2*Math.PI),s.fillStyle=Yt(this,RP).brand,s.fill()),n&&(s.fillStyle=Yt(this,RP).textOnBrand,s.font=h/2+"px sans-serif",s.textAlign="center",s.textBaseline="middle",s.fillText(n,p,m)),i){const e=new Image;e.src=i,e.onload=()=>{s.drawImage(e,p-h,m-h,2*h,2*h),s.restore()}}}drawGrid(e,t,r){if(void 0===Yt(this,EP))return;const n=Yt(this,EP).getContext("2d");n.fillStyle=Yt(this,RP).background,n.fillRect(0,0,Yt(this,kP).width,Yt(this,kP).height);const i=this.getSources();let s=0,o=0;for(;s<Yt(this,kP).height-5;){let a=0;for(;a<Yt(this,kP).width-5&&o<r;){const r=i[o].element;if(i[o].enabled){const[i,o,c,d,l,u,h,p]=TP(a,s,e,t,r.videoWidth,r.videoHeight);n.drawImage(r,i,o,c,d,l,u,h,p)}else this.drawEmptyTile(o,e,t,i[o].displayText);o+=1,a+=e}s+=t}}calcGridElemSize(e){switch(e){case 0:case 1:return[Yt(this,kP).width,Yt(this,kP).height];case 2:return[Math.floor(Yt(this,kP).width/2),Yt(this,kP).height];case 3:case 4:return[Math.floor(Yt(this,kP).width/2),Math.floor(Yt(this,kP).height/2)];case 5:case 6:default:return[Math.floor(Yt(this,kP).width/3),Math.floor(Yt(this,kP).height/2)];case 7:case 8:case 9:return[Math.floor(Yt(this,kP).width/3),Math.floor(Yt(this,kP).height/3)]}}paintCanvas(){const e=this.getSources().length,[t,r]=this.calcGridElemSize(e);this.drawGrid(t,r,e)}isSupported(){return!!window.chrome&&document.pictureInPictureEnabled}get isActive(){return null!==document.pictureInPictureElement}cleanup(){if(this.isSupported()&&void 0!==document.exitPictureInPicture&&null!==document.pictureInPictureElement&&document.exitPictureInPicture(),Yt(this,bP))try{document.body.removeChild(Yt(this,bP))}catch(e){}this.removeAllSources(),Zt(this,EP,void 0),Zt(this,wP,void 0),Zt(this,CP,void 0)}init({height:e,width:t}={}){this.createCanvas(),this.setupMediaSessionEvents();const r=document.createElement("video");Zt(this,kP,{height:null!=e?e:1080,width:null!=t?t:1920}),r.height=Yt(this,kP).height,r.width=Yt(this,kP).width,r.autoplay=!0,r.muted=!0,r.srcObject=Yt(this,EP).captureStream(24),Zt(this,wP,r),Yt(this,wP).onloadedmetadata=()=>{try{this.emit("pipStarted"),Yt(this,wP).onleavepictureinpicture=()=>{this.emit("pipEnded")}}catch(e){this.emit("pipEnded")}},this.createVideoContainer(),this.paintCanvas()}updateMediaSession(e,t){void 0!==navigator.mediaSession&&("CAMERA"===e&&void 0!==navigator.mediaSession.setCameraActive&&navigator.mediaSession.setCameraActive(t),"MIC"===e&&void 0!==navigator.mediaSession.setMicrophoneActive&&navigator.mediaSession.setMicrophoneActive(t))}enableSource(e){void 0!==Yt(this,IP)[e]&&(Yt(this,IP)[e].enabled=!0)}disableSource(e){void 0!==Yt(this,IP)[e]&&(Yt(this,IP)[e].enabled=!1)}addSource(e,t,r,n=!1,i=void 0){n&&this.removePinnedSource(),Yt(this,IP)[e]={id:e,element:t,enabled:r,pinned:n,displayText:i?SP(i):void 0}}removeSource(e){delete Yt(this,IP)[e]}removePinnedSource(){const[e]=this.getSources();e&&this.removeSource(e.id)}removeAllSources(){Zt(this,IP,{})}enable(){this.setupEventListeners(),this.updateMediaSession("CAMERA",Yt(this,AP).videoEnabled),this.updateMediaSession("MIC",Yt(this,AP).audioEnabled),document.body.appendChild(Yt(this,bP)),Zt(this,CP,requestAnimationFrame((()=>this.animate()))),Yt(this,wP).requestPictureInPicture()}}EP=new WeakMap,bP=new WeakMap,wP=new WeakMap,kP=new WeakMap,RP=new WeakMap,CP=new WeakMap,IP=new WeakMap,AP=new WeakMap;var DP,OP,MP,NP,xP,LP=Object.defineProperty,UP=Object.getOwnPropertyDescriptor,jP=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?UP(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&LP(t,r,s),s};let FP=(xP=class extends WS{constructor(e,t,r){var n;super(),Xt(this,DP),Kt(this,"waitlisted"),Kt(this,"joined"),Kt(this,"active"),Kt(this,"pinned"),Kt(this,"all"),Kt(this,"pip"),Xt(this,MP,void 0),Xt(this,NP,void 0),Kt(this,"viewMode"),Kt(this,"currentPage"),Kt(this,"lastActiveSpeaker"),Kt(this,"selectedPeers"),Zt(this,MP,e),Zt(this,NP,t),this.waitlisted=new cP,this.joined=new cP,this.active=new cP,this.pinned=new cP,this.all=new uP,this.selectedPeers=new lP,this.viewMode="ACTIVE_GRID",this.currentPage=0,(null==(n=null==r?void 0:r.pip)||n)&&(this.pip=new PP(e))}get roomJoined(){var e;return!0===(null==(e=Yt(this,DP,OP))?void 0:e.roomJoined)}get count(){return this.joined.size}get maxActiveParticipantsCount(){return Yt(this,DP,OP).maxPreferredStreams}get pageCount(){if("PAGINATED"===this.viewMode){const e=this.joined.toArray().filter((e=>"ON_STAGE"===e.stageStatus));return Math.ceil(e.length/this.maxActiveParticipantsCount)}return 0}acceptWaitingRoomRequest(e){var t,r;if(Yt(this,DP,OP)instanceof fC){if(!this.roomJoined)throw new $S("Can`t accept waiting room request without joining room");return Yt(this,DP,OP).acceptWaitingRequest(e)}const n=null!=(r=null==(t=this.waitlisted.get(e))?void 0:t.userId)?r:e;return Yt(this,NP).acceptWaitingRoomRequest([n])}acceptAllWaitingRoomRequest(e){return tr(this,null,(function*(){if(Yt(this,DP,OP)instanceof fC){const t=e.map((e=>this.acceptWaitingRoomRequest(e)));return Promise.all(t)}const t=e.map((e=>{var t,r;return null!=(r=null==(t=this.waitlisted.get(e))?void 0:t.userId)?r:e}));return Yt(this,NP).acceptWaitingRoomRequest(t)}))}rejectWaitingRoomRequest(e){return tr(this,null,(function*(){var t,r;if(Yt(this,DP,OP)instanceof fC){if(!this.roomJoined)throw new $S("Can`t reject waiting room request without joining room");yield Yt(this,DP,OP).rejectWaitingRequest(e),this.waitlisted.delete(e)}const n=null!=(r=null==(t=this.waitlisted.get(e))?void 0:t.userId)?r:e;Yt(this,NP).rejectWaitingRoomRequest([n])}))}setViewMode(e){return tr(this,null,(function*(){if(BS.info("DyteParticipants::set_view_mode",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),!["ACTIVE_GRID","PAGINATED"].includes(e))throw BS.error("DyteParticipants::setViewMode::invalid_view_mode",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new $S(`Invalid view mode: ${e}. Try ACTIVE_GRID or PAGINATED.`);if(this.viewMode!==e){if(this.viewMode=e,"PAGINATED"===e){this.currentPage=1;let e=[];Yt(this,DP,OP)instanceof fC?({peerIds:e}=(yield Yt(this,DP,OP).getPage(this.currentPage)).payload):e=this.getPeerIdsForCurrentPage(),tT.emit(XS.GET_PAGE,{peerIds:e})}else"ACTIVE_GRID"===e&&(this.currentPage=0,Yt(this,DP,OP)instanceof fC?Yt(this,DP,OP).getPage(this.currentPage):tT.emit(XS.REFRESH_GRID));this.emit("viewModeChanged",{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount})}else BS.info("DyteParticipants::setViewMode::view_mode_same_as_previous",{pageNavigation:{viewMode:e,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}})}))}getPeerIdsForCurrentPage(){BS.info("DyteParticipants::getPeerIdsForCurrentPage()",{pageNavigation:{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}});const{compulsoryPeers:e}=this.selectedPeers,t=e.filter((e=>this.joined.has(e))),r=Array.from(this.pinned.keys()).filter((e=>!t.includes(e))),n=Array.from(this.joined.toArray().filter((e=>"ON_STAGE"===e.stageStatus)).map((e=>e.id))),i=Math.max((this.currentPage-1)*(this.maxActiveParticipantsCount-t.length-r.length)),s=this.currentPage*(this.maxActiveParticipantsCount-t.length-r.length);return t.concat(r,n.slice(i,s))}setPage(e){return tr(this,null,(function*(){if(BS.info("DyteParticipants::set_page",{pageNavigation:{settingPage:e,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),"PAGINATED"!==this.viewMode)return;if(!Number.isInteger(e))throw BS.error("DyteParticipants::invalid_page_number",{pageNavigation:{settingPage:e,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new $S(`Invalid page: ${e}. Page must be an integer.`);if(e<1||e>this.pageCount)throw BS.error("DyteParticipants::invalid_page_number",{pageNavigation:{settingPage:e,viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount,maxActiveParticipantsCount:this.maxActiveParticipantsCount}}),new $S(`Invalid page: ${e}. Page must be greater than 0 and less than or equal to ${this.pageCount}.`);this.currentPage=e;let t=[];Yt(this,DP,OP)instanceof fC?({peerIds:t}=(yield Yt(this,DP,OP).getPage(e)).payload):t=this.getPeerIdsForCurrentPage(),tT.emit(XS.GET_PAGE,{peerIds:t}),this.emit("pageChanged",{viewMode:this.viewMode,currentPage:this.currentPage,pageCount:this.pageCount})}))}disableAllAudio(e){return tr(this,null,(function*(){if(BS.info("DyteParticipants::disable_all_audio",{actions:{disableAllAudio:{allowUnmute:e}}}),!this.roomJoined)throw new $S("Can`t disable all audio without joining room");if(Yt(this,MP).permissions.canAllowParticipantAudio)return Yt(this,DP,OP).muteAll(e);throw BS.error("DyteParticipants::unauthorized_disable_all_audio",{actions:{disableAllAudio:{allowUnmute:e}}}),new $S("Unauthorized: User does not have permission to disable peer audio.")}))}disableAllVideo(){return tr(this,null,(function*(){if(BS.info("DyteParticipants::disable_all_video"),!this.roomJoined)throw new $S("Can`t disable all video without joining room");if(Yt(this,MP).permissions.canAllowParticipantVideo)return Yt(this,DP,OP).muteAllVideo();throw BS.error("DyteParticipants::unauthorized_disable_all_video"),new $S("Unauthorized: User does not have permission to disable peer video.")}))}disableAudio(e){return tr(this,null,(function*(){this.joined.get(e).disableAudio()}))}disableVideo(e){return tr(this,null,(function*(){this.joined.get(e).disableVideo()}))}kick(e){return tr(this,null,(function*(){yield tT.emitAsync(XS.KICK_PEER,{peerId:e})}))}kickAll(){return tr(this,null,(function*(){if(BS.info("DyteParticipants::kick_all"),!this.roomJoined)throw new $S("Can`t kick all without joining room");if(!Yt(this,MP).permissions.kickParticipant)throw BS.error("DyteParticipants::unauthorized_kick_all"),new $S("Unauthorized: User does not have permission to kick peers.");Yt(this,DP,OP).kickAll(),Yt(this,NP).kickAll()}))}broadcastMessage(e,t,r){return tr(this,null,(function*(){if(BS.info("DyteParticipants::broadcastMessage"),!this.roomJoined)throw new $S("Can`t broadcast message without joining room");if(null==e||!e.trim())throw new $S("`type` must be a non-empty string.");if(Yt(this,DP,OP)instanceof fC&&"LIVESTREAM"!==Yt(this,MP).config.viewType&&"CHAT"!==Yt(this,MP).config.viewType)Yt(this,DP,OP).broadcastMessage(e,t);else if(r){let n=[];n="participantIds"in r?r.participantIds:this.joined.toArray().filter((e=>{var t;return null==(t=r.presetNames)?void 0:t.includes(e.presetName)})).map((e=>e.id)),Yt(this,NP).broadcastToPeers(e,n,t)}else Yt(this,NP).broadcastMessage(e,t)}))}acceptAllRequestToJoinStageRequests(e){return tr(this,null,(function*(){tT.emitAsync(XS.ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE,{data:e})}))}getAllJoinedPeers(e,t,r){return tr(this,null,(function*(){return(yield Yt(this,NP).getRoomPeers(e,t,r)).peers.map(ZP.formatSocketServiceMessage)}))}updatePermissions(e,t){return tr(this,null,(function*(){const r=this.joined.toArray().filter((t=>e.includes(t.id))).map((e=>e.userId)),n=[...new Set(r)];Yt(this,NP).updatePermissions(n,t)}))}getAllPeersInRoom(){return tr(this,null,(function*(){return Yt(this,NP).getRoomPeersNonPaginated()}))}},DP=new WeakSet,OP=function(){return _C()},MP=new WeakMap,NP=new WeakMap,xP);jP([VS.trace("DyteParticipants.setViewMode")],FP.prototype,"setViewMode",1),jP([VS.trace("DyteParticipants.setPage")],FP.prototype,"setPage",1),jP([VS.trace("DyteParticipants.disableAllAudio")],FP.prototype,"disableAllAudio",1),jP([VS.trace("DyteParticipants.disableAllVideo")],FP.prototype,"disableAllVideo",1),jP([VS.trace("DyteParticipants.disablePeerAudio")],FP.prototype,"disableAudio",1),jP([VS.trace("DyteParticipants.disablePeerVideo")],FP.prototype,"disableVideo",1),jP([VS.trace("DyteParticipants.kickPeer")],FP.prototype,"kick",1),jP([VS.trace("DyteParticipants.kickAll")],FP.prototype,"kickAll",1),jP([VS.trace("DyteParticipants.broadcastMessage")],FP.prototype,"broadcastMessage",1),jP([VS.trace("DyteParticipants.acceptAllRequestToJoinStageRequests")],FP.prototype,"acceptAllRequestToJoinStageRequests",1),jP([VS.trace("DyteParticipants.getAllJoinedPeers")],FP.prototype,"getAllJoinedPeers",1),jP([VS.trace("DyteParticipant.updatePermissions")],FP.prototype,"updatePermissions",1),jP([VS.trace("DyteParticipants.getAllPeersInRoom")],FP.prototype,"getAllPeersInRoom",1),FP=jP([KS((e=>{throw new $S(e.message,"1200")}))],FP);var VP,BP,HP,WP,GP,qP,$P,zP,JP,KP=Object.defineProperty,QP=Object.getOwnPropertyDescriptor,YP=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?QP(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&KP(t,r,s),s};const XP=(JP=class{constructor(e,t,r,n){Xt(this,$P),Kt(this,"participants"),Xt(this,VP,void 0),Xt(this,BP,void 0),Xt(this,HP,new Set),Xt(this,WP,new Map),Xt(this,GP,void 0),Xt(this,qP,void 0),Kt(this,"syncMembers",(()=>tr(this,null,(function*(){const e=yield Yt(this,qP).getAllAddedParticipants();this.participants.all.__clear(),e.forEach((e=>this.participants.all.__set(e.userId,e))),this.participants.all.emit("participantsUpdate")})))),Kt(this,"chatRoomJoinHandler",(e=>tr(this,null,(function*(){e.peer&&e.peer.userId!==Yt(this,VP).userId&&(yield this.syncMembers())})))),Kt(this,"updateSelfVideoConstraints",Qp((()=>tr(this,null,(function*(){var e,t,r,n,i,s,o;if(!In.hasFeature(DS.DYNAMIC_VIDEO_QUALITY))return;const a=this.participants.active.size;let c="vga";c=Yt(this,VP).isPinned||a<4?"hd":a<9?"vga":"pvga";try{if(Yt(this,VP).videoEnabled){const o={height:null==(e=SS[c])?void 0:e.height.ideal,width:null==(t=SS[c])?void 0:t.width.ideal},a=(null==(n=null==(r=Yt(this,VP).videoTrack)?void 0:r.getSettings())?void 0:n.width)!==o.width,d=(null==(s=null==(i=Yt(this,VP).videoTrack)?void 0:i.getSettings())?void 0:s.height)!==o.height;if(!a&&!d)return;yield Yt(this,VP).updateVideoConstraints({height:{ideal:o.height},width:{ideal:o.width}})}}catch(e){null!=(o=e.message)&&o.includes("Unsupported")||BS.error("Failure in setOptimalViewerBasedVideoConstraints::updateVideoConstraints",{error:e})}}))),1e3)),Zt(this,qP,t),this.participants=new FP(e,Yt(this,qP),n),Zt(this,BP,new Map),Zt(this,VP,e),Zt(this,GP,ww(e.config.viewType,r)?"socket-service":"room-node"),"socket-service"===Yt(this,GP)&&"CHAT"===e.config.viewType?this.setupChatEvents():this.setupEvents()}get roomJoined(){var e;return!0===(null==(e=Yt(this,$P,zP))?void 0:e.roomJoined)}updatePageParticipants(e){const t=new Set(e),r=new Map(this.participants.active);if(this.participants.active.forEach(((e,r)=>{this.participants.active.delete(r,!t.has(r))})),t.forEach((e=>{this.participants.joined.get(e)?this.participants.active.add(this.participants.joined.get(e),!r.get(e)):BS.warn("updatePageParticipants::participant_not_in_joined_list",{dyteParticipant:{id:e}})})),Yt(this,$P,zP)instanceof OR){Zt(this,HP,new Set(this.participants.active.keys())),Array.from(r.keys()).forEach((e=>{if(t.has(e))return;const r=this.participants.joined.get(e);if(!r)return;const n={producers:r.producers,peerId:r.id};Yt(this,$P,zP).deactivatePeers(n)}));const e=[];this.participants.active.forEach((t=>{const r={peerId:t.id,producers:t.producers};e.push(r)})),Yt(this,$P,zP).activatePeers(e)}this.updateSelfVideoConstraints()}updatePinnedParticipants(){this.participants.pinned.forEach((e=>{e.setIsPinned(!1),this.participants.pinned.delete(e.id)}))}refreshGridParticipants(e=!1){const t=new Map,r=Array.from(this.participants.joined.toArray().filter((e=>"ON_STAGE"===e.stageStatus)).map((e=>(t.set(e.id,!0),e.id)))),n=this.participants.selectedPeers.peers,i=this.participants.pinned.toArray().reduce(((e,t)=>("ON_STAGE"!==t.stageStatus?this.participants.pinned.delete(t.id):e.push(t.id),e)),[]);if("ACTIVE_GRID"!==this.participants.viewMode)return void BS.warn("ParticipantController::refreshGridParticipants::not_refreshing_grid_in_not_active_grid_mode");const s="ON_STAGE"===Yt(this,VP).stageStatus?1:0,o=this.participants.maxActiveParticipantsCount-s,a=new Set(n.concat(i).filter((e=>e!==Yt(this,VP).id&&t.has(e))));let c=Array.from(a);const d=o-a.size;if(d>=0){const e=r.filter((e=>!a.has(e)&&e!==Yt(this,VP).id)).slice(0,d);c=Array.from(a).concat(e)}else c=c.slice(0,o);this.updateActiveParticipantsHiveNode(c,e)}updateActiveParticipantsHiveNode(e,t=!1){if(!this.roomJoined)return void BS.warn("Skipped::ParticipantController::updateActiveParticipants",{roomJoined:this.roomJoined});const r=Array.from(this.participants.active.keys()),n=new Map(this.participants.active),i={};e.forEach((e=>{i[e]=!0}));const s=[];r.forEach(((e,t)=>{(!i[e]||!this.participants.joined.get(e))&&s.push(t)})),e.forEach((t=>{n.get(t)||(r.length<e.length?r.push(t):r[s.shift()]=t)})),r.forEach(((e,t)=>{i[e]||r.splice(t,1)})),Array.from(this.participants.active.keys()).forEach((e=>{this.participants.active.delete(e,!i[e])})),r.forEach((e=>{this.participants.joined.get(e)?this.participants.active.add(this.participants.joined.get(e),!n.get(e)):BS.warn("updateActiveParticipants::participant_not_in_joined_list",{dyteParticipant:{id:e}})})),this.participants.active.emit("participantsUpdate"),BS.info("ParticipantController::updateActiveParticipants::updating_current_selected_peers",{debuggingHint:t?"Forcefully updating currentActiveGridParticipants set":null}),t&&Zt(this,HP,new Set);const o=new Set(e),a=[],c=[];if(Yt(this,HP).forEach((e=>{o.has(e)||a.push(e)})),o.forEach((e=>{Yt(this,HP).has(e)||c.push(e)})),Zt(this,HP,o),0!==c.length||0!==a.length){if(Yt(this,$P,zP)instanceof OR){const e=[];a.forEach((t=>{const r=this.participants.joined.get(t);if(!r)return;const n={producers:r.producers,peerId:r.id};e.push(Yt(this,$P,zP).deactivatePeers(n))})),Promise.all(e).then((()=>{const e=[];c.forEach((r=>{const n=this.participants.active.get(r);if(!n)return void BS.warn("peer is not in active map which is going to activate, should not happen",{dyteParticipant:{id:r}});const i={peerId:n.id,producers:n.producers,force:t};e.push(i)})),Yt(this,$P,zP).activatePeers(e)})).catch((e=>{BS.info("Error on deactivating peers",e)}))}this.updateSelfVideoConstraints()}else BS.info("ParticipantController::updateActiveParticipants::current_selected_peers_is_same")}updateActiveParticipants(e){if(!this.roomJoined)return void BS.warn("Skipped::ParticipantController::updateActiveParticipants",{roomJoined:this.roomJoined});const t=Array.from(this.participants.active.keys()),r=new Map(this.participants.active),n={};e.forEach((e=>{n[e]=!0}));const i=[];t.forEach(((e,t)=>{(!n[e]||!this.participants.joined.get(e))&&i.push(t)})),e.forEach((n=>{r.get(n)||(t.length<e.length?t.push(n):t[i.shift()]=n)})),t.forEach(((e,r)=>{n[e]||t.splice(r,1)})),Array.from(this.participants.active.keys()).forEach((e=>{this.participants.active.delete(e,!n[e])})),t.forEach((e=>{this.participants.joined.get(e)?this.participants.active.add(this.participants.joined.get(e),!r.get(e)):BS.warn("updateActiveParticipants::participant_not_in_joined_list",{dyteParticipant:{id:e}})})),this.participants.active.emit("participantsUpdate"),this.updateSelfVideoConstraints()}updateActiveParticipantsWithPriorities(e,t=!1){if(!this.roomJoined)return void BS.warn("Skipped::ParticipantController::updateActiveParticipantsWithPriorities",{roomJoined:this.roomJoined});let r=null;e.forEach((e=>{this.participants.selectedPeers.add(e.peerId,e.priority),(null===r||e.priority>r.priority)&&(r=e)})),r&&r.peerId!==this.participants.lastActiveSpeaker&&(this.participants.lastActiveSpeaker=r.peerId,this.participants.emit("activeSpeaker",{peerId:r.peerId,volume:r.priority})),t&&this.refreshGridParticipants()}setupChatEvents(){tT.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,this.syncMembers),Yt(this,qP).on(Jw.joinRoom,this.chatRoomJoinHandler)}waitingRoomRequestHandler(e){if(Yt(this,$P,zP)instanceof fC)return;const t=e.requests.filter((e=>!this.participants.waitlisted.toArray().find((t=>t.userId===e.userId)))),r=this.participants.waitlisted.toArray().filter((t=>!e.requests.find((e=>e.userId===t.userId))));t.forEach((e=>this.participants.waitlisted.add(new nP({id:e.peerId,displayName:e.displayName,audioMuted:!0,videoEnabled:!1,audioTrack:void 0,videoTrack:void 0,stageStatus:MA.OFF_STAGE,userId:e.userId,flags:{},isHost:!1},Yt(this,VP),Yt(this,qP))))),r.forEach((e=>this.participants.waitlisted.delete(e.id)))}setupEvents(){tT.on(XS.PEER_JOINED,(e=>tr(this,null,(function*(){var t,r,n;let i;if(Yt(this,$P,zP)instanceof OR){if(i=XP.formatSocketServiceMessage(Yt(this,WP).get(e.id)),!i){const{peer:t}=yield Yt(this,qP).getPeerInfo(e.id);i=XP.formatSocketServiceMessage(t)}i.stageStatus||BS.warn("peerJoined::stageStatus is undefined.")}else e.stageStatus||BS.warn("peerJoined::stageStatus is undefined.");const s=new nP($t($t({},e),i),Yt(this,VP),Yt(this,qP));if(!(Yt(this,VP).id===s.id||null!=(t=e.flags)&&t.recorder||null!=(r=s.flags)&&r.hidden_participant||null!=(n=s.flags)&&n.hiddenParticipant)){if(this.participants.active.delete(s.id),this.participants.joined.add(s),this.participants.waitlisted.delete(s.id),s.stageStatus===MA.REQUESTED_TO_JOIN_STAGE&&tT.emit(XS.STAGE_REQUESTS_UPDATED,{request:{displayName:s.name,userId:s.userId,peerId:s.id},add:!0}),Yt(this,VP).config.viewType===vn.Webinar&&s.stageStatus!==MA.ON_STAGE)return;this.participants.currentPage===this.participants.pageCount&&Yt(this,$P,zP)instanceof fC&&tT.emit(XS.GET_PAGE,(yield Yt(this,$P,zP).getPage(this.participants.currentPage)).payload),"ACTIVE_GRID"===this.participants.viewMode&&tT.emit(XS.REFRESH_GRID)}"ACTIVE_GRID"===this.participants.viewMode&&"HIVE"===Yt(this,VP).permissions.mediaRoomType&&tT.emit(XS.REFRESH_GRID),this.updateSelfVideoConstraints()})))),Yt(this,qP).on(Jw.getWaitingRoomRequests,this.waitingRoomRequestHandler.bind(this)),tT.on(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>{Yt(this,$P,zP)instanceof fC||Yt(this,VP).permissions.acceptWaitingRequests&&Yt(this,qP).getWaitingRoomRequests()})),Yt(this,qP).on(Jw.joinRoom,(({peer:e})=>{Yt(this,WP).set(e.peerId,e)})),tT.onAsync(XS.SOCKET_PEERS,(e=>tr(this,null,(function*(){null==e||e.forEach((e=>Yt(this,WP).set(e.peerId,e)))})))),tT.on(XS.WAITLIST_PEER_ADDED,(({id:e,name:t,picture:r,metadata:n,clientSpecificId:i})=>{this.participants.waitlisted.add(new nP({id:e,displayName:t,audioMuted:!0,videoEnabled:!1,audioTrack:void 0,videoTrack:void 0,stageStatus:MA.OFF_STAGE,userId:void 0,flags:{},isHost:!1,picture:r,metadata:n,customParticipantId:i},Yt(this,VP),Yt(this,qP)))})),tT.on(XS.WAITLIST_PEER_REMOVED,(({id:e})=>{this.participants.waitlisted.delete(e)})),Yt(this,VP).on("videoUpdate",(()=>this.updateSelfVideoConstraints())),tT.on(XS.ROOM_JOINED,(e=>tr(this,[e],(function*({peers:e,pinnedPeerId:t,requestToJoinPeersList:r}){Yt(this,$P,zP)instanceof OR&&(this.participants.active.clear(),this.participants.joined.clear()),e.forEach((e=>tr(this,null,(function*(){var r,n,i;if(null!=(r=e.flags)&&r.recorder||null!=(n=e.flags)&&n.hidden_participant||null!=(i=e.flags)&&i.hiddenParticipant)return;let s;if(Yt(this,$P,zP)instanceof OR){if(s=XP.formatSocketServiceMessage(Yt(this,WP).get(e.id)),!s){const{peer:t}=yield Yt(this,qP).getPeerInfo(e.id);s=XP.formatSocketServiceMessage(t),s.stageStatus||BS.warn("peerJoined::stageStatus is undefined.")}}else e.stageStatus||BS.warn("peerJoined::stageStatus is undefined.");const o=new nP($t($t({},e),s),Yt(this,VP),Yt(this,qP));o.id===t&&(o.setIsPinned(!0,!1),this.participants.pinned.add(o)),this.participants.joined.add(o)})))),r&&r.forEach((({id:e})=>{tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.REQUESTED_TO_JOIN_STAGE})})),Yt(this,$P,zP)instanceof fC&&Yt(this,$P,zP).getPage(this.participants.currentPage)})))),tT.on(XS.PEER_CLOSED,(e=>tr(this,[e],(function*({id:e}){const t=this.participants.joined.get(e);if(t&&"REQUESTED_TO_JOIN_STAGE"===t.stageStatus&&tT.emit(XS.STAGE_REQUESTS_UPDATED,{request:{displayName:t.name,userId:t.userId,peerId:t.id},add:!1}),this.participants.joined.delete(e,!0,!0),this.participants.pinned.delete(e,!0,!0),this.participants.waitlisted.delete(e,!0,!0),Yt(this,$P,zP)instanceof OR&&(this.participants.selectedPeers.delete(e),this.participants.active.get(e)&&0===this.participants.currentPage))return void this.refreshGridParticipants();const{currentPage:r}=this.participants,n=Yt(this,VP).config.maxVideoStreams,i=(_S.isMobile()?n.mobile:n.desktop)*(r-1),s=this.participants.active.get(e);if(0===i)this.participants.setViewMode("ACTIVE_GRID");else if(this.participants.joined.size<=i)2===r?this.participants.setViewMode("ACTIVE_GRID"):this.participants.setPage(r-1);else if(s){let e=[];Yt(this,$P,zP)instanceof fC?({peerIds:e}=(yield Yt(this,$P,zP).getPage(r)).payload):e=this.participants.getPeerIdsForCurrentPage(),tT.emit(XS.GET_PAGE,{peerIds:e})}this.updateSelfVideoConstraints()})))),tT.on(XS.ROOM_NODE_DISCONNECTED,(()=>{Array.from(this.participants.joined.keys()).forEach((e=>{this.participants.joined.delete(e)})),Array.from(this.participants.active.keys()).forEach((e=>{this.participants.active.delete(e)})),Array.from(this.participants.pinned.keys()).forEach((e=>{this.participants.pinned.delete(e)})),this.participants.currentPage=0,this.participants.viewMode="ACTIVE_GRID",this.participants.emit("viewModeChanged",{viewMode:"ACTIVE_GRID",currentPage:this.participants.currentPage,pageCount:this.participants.pageCount}),Zt(this,HP,new Set)})),tT.on(XS.PEER_MUTED,(({peerId:e})=>{const t=this.participants.joined.get(e);t&&t.setAudioEnabled(!1)})),tT.on(XS.PEER_UNMUTED,(({peerId:e})=>{const t=this.participants.joined.get(e);t&&t.setAudioEnabled(!0)})),tT.on(XS.CONSUMER_PAUSED,(({id:e})=>{this.processConsumerPaused(e)})),tT.on(XS.CONSUMER_RESUMED,(({id:e})=>{this.processConsumerResumed(e)})),tT.on(XS.NEW_CONSUMER,(({id:e})=>{this.processNewConsumer(e)})),tT.on(XS.CONSUMER_CLOSED,(({id:e})=>{this.processConsumerClosed(e)})),tT.on(XS.GET_PAGE,(({peerIds:e})=>{"PAGINATED"===this.participants.viewMode&&this.updatePageParticipants(e)})),tT.on(XS.SELECTED_PEERS,(({peerIds:e,compulsoryPeers:t})=>{if("ACTIVE_GRID"!==this.participants.viewMode)return;if(Yt(this,$P,zP)instanceof fC)return void this.updateActiveParticipants(e);const r=e.map(((e,t)=>({peerId:e,priority:t+1}))),n=null==t?void 0:t.map(((e,t)=>({peerId:e,priority:-(t+1)})));r.push(...null!=n?n:[]),r.length>0&&this.updateActiveParticipantsWithPriorities(r)})),tT.on(XS.SELECTED_PEERS_DIFF,(({entries:e})=>{"ACTIVE_GRID"===this.participants.viewMode&&this.updateActiveParticipantsWithPriorities(e,!0)})),tT.on(XS.REFRESH_GRID,((e=!1)=>{"ACTIVE_GRID"===this.participants.viewMode&&Qp((()=>{this.refreshGridParticipants(e)}),500,{maxWait:1e3,leading:!0})()})),tT.on(XS.NEW_PRODUCER,(({peerId:e,producer:t})=>{const r=this.participants.joined.get(e);r?(r.producers.push(t),BS.info("ParticipantController::NEW_PRODUCER::producer_added_to_participant",{producer:{id:null==t?void 0:t.producerId,peerId:e,kind:null==t?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:null==t?void 0:t.screenShare}}}),"audio"===(null==t?void 0:t.kind)||null!=t&&t.screenShare||Yt(this,HP).has(e)?Yt(this,$P,zP).createConsumer({producingPeerId:e,producerId:t.producerId,screenShare:t.screenShare}):BS.info("ParticipantController::NEW_PRODUCER::not_consuming_producer",{producer:{id:null==t?void 0:t.producerId,peerId:e,kind:null==t?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:null==t?void 0:t.screenShare}}})):BS.warn("ParticipantController::NEW_PRODUCER::participant not found",{producer:{id:null==t?void 0:t.producerId,kind:null==t?void 0:t.kind,status:"UNKNOWN",appData:{screenShare:null==t?void 0:t.screenShare}},dyteParticipant:{id:e}})})),tT.on(XS.PRODUCER_CLOSED,(({peerId:e,producerId:t})=>{const r=this.participants.joined.get(e);r?r.producers=r.producers.filter((e=>e.producerId!==t)):BS.warn("ParticipantController::NEW_PRODUCER::participant not found",{dyteParticipant:{id:e}})})),tT.on(XS.PRODUCER_TOGGLE,(({peerId:e,producerId:t,paused:r,kind:n})=>{const i=this.participants.joined.get(e);if(i){"audio"===n&&i.setAudioEnabled(!r);const e=i.producers.find((e=>e.producerId===t));e&&(e.pause=r)}})),tT.on(XS.ACTIVE_SPEAKER,(({peerId:e,volume:t})=>{this.participants.lastActiveSpeaker=e,this.participants.emit("activeSpeaker",{peerId:e,volume:t})})),tT.on(XS.ROOM_MESSAGE,(e=>tr(this,[e],(function*({payload:e,type:t,timestamp:r}){this.participants.emit("broadcastedMessage",{type:t,payload:e,timestamp:r})})))),tT.on(XS.MESSAGE,(e=>tr(this,[e],(function*({payload:e,type:t,timestamp:r}){"spotlight"!==t&&this.participants.emit("broadcastedMessage",{type:t,payload:e,timestamp:r})})))),tT.on(XS.LOW_CONSUMER_SCORE,(({peerId:e,score:t,kind:r})=>{const n=this.participants.joined.get(e);n&&(n.emit("poorConnection",{score:t,kind:r}),this.participants.emit("poorConnection",{participantId:e,score:t,kind:r}))})),tT.on(XS.CONSUMER_SCORE_UPDATE,(({score:e,kind:t,appData:r,peerId:n})=>{var i;const s="video"===t&&null!=(i=null==r?void 0:r.screenShare)&&i,o=this.participants.joined.get(n);o&&(o.emit("mediaScoreUpdate",{kind:t,isScreenshare:s,score:e,participantId:n}),this.participants.emit("mediaScoreUpdate",{kind:t,isScreenshare:s,score:e,participantId:n}))})),tT.on(XS.PEER_PINNED,(({peerId:e})=>{if(!e)return Yt(this,VP).isPinned&&Yt(this,VP).setIsPinned(!1),0!==this.participants.pinned.size&&this.updatePinnedParticipants(),void this.updateSelfVideoConstraints();if(e===Yt(this,VP).id)return 0!==this.participants.pinned.size&&this.updatePinnedParticipants(),Yt(this,VP).setIsPinned(!0),void this.updateSelfVideoConstraints();const t=this.participants.joined.get(e);Yt(this,VP).isPinned&&Yt(this,VP).setIsPinned(!1),this.updatePinnedParticipants(),t.setIsPinned(!0),this.participants.pinned.add(t),Yt(this,$P,zP)instanceof OR&&Yt(this,$P,zP).activatePeers([{peerId:t.id,producers:t.producers}]).catch((e=>{BS.error("unable to create consumers",{error:e})})),this.updateSelfVideoConstraints()})),tT.onAsync(XS.KICK_PEER,(e=>tr(this,[e],(function*({peerId:e}){const t=this.participants.joined.get(e);yield Yt(this,$P,zP).kick(e),yield Yt(this,qP).kick(e),t?t.emit("kicked"):this.participants.joined.emit("kicked",{id:e})}))))}processMedia(e){var t;const r=Yt(this,$P,zP).getConsumers(),{peerId:n,kind:i,appData:s,remotelyPaused:o,track:a,producerId:c}=null!=(t=r.get(e))?t:{};if(!n)return BS.warn("processMedia::Peer ID is undefined",{consumer:{id:e,kind:i,peerId:n,appData:{supportsRemoteControl:null==s?void 0:s.supportsRemoteControl,screenShare:null==s?void 0:s.screenShare},remotelyPaused:o,producerId:c}}),{};const d=s;return BS.info("ParticipantController::processMedia",{consumer:{id:e,peerId:n,kind:i,appData:d,remotelyPaused:o,producerId:c}}),Yt(this,BP).set(e,{type:i,peerId:n,appData:d,remotelyPaused:o,producerId:c}),{peerId:n,kind:i,appData:d,remotelyPaused:o,track:a,producerId:c}}processConsumerClosed(e){const{peerId:t,type:r,appData:n,remotelyPaused:i,producerId:s}=Yt(this,BP).get(e)||{},o=this.participants.joined.get(t);if(BS.info("ParticipantController::processConsumerClosed",{consumer:{id:e,peerId:t,appData:n,kind:r,remotelyPaused:i,producerId:s}}),Yt(this,BP).delete(e),o){if(n&&n.screenShare)return o.setScreenShareEnabled(!1),gn.consumerSharedMediaState(e,{screen:!1}),void(o.screenShareTracks={audio:void 0,video:void 0});"audio"===r?(o.setAudioEnabled(!1),gn.consumerSharedMediaState(e,{audio:!1}),o.audioTrack=void 0):"video"===r&&(o.setVideoEnabled(!1),gn.consumerSharedMediaState(e,{video:!1}),o.videoTrack=void 0)}}processConsumerResumed(e){const{peerId:t,kind:r,appData:n,track:i,remotelyPaused:s,producerId:o}=this.processMedia(e);if(!t)return;BS.info("ParticipantController::processConsumerResumed",{consumer:{id:e,peerId:t,kind:r,appData:n,remotelyPaused:s,producerId:o}});const a=this.participants.joined.get(t);if(a){if(n.screenShare)return"video"===r?a.screenShareTracks.video=i:"audio"===r&&(a.screenShareTracks.audio=i),a.setScreenShareEnabled(!0),void gn.consumerSharedMediaState(e,{screen:!0});"video"===r?(a.videoTrack=i,a.setVideoEnabled(!0),gn.consumerSharedMediaState(e,{video:!0})):"audio"===r&&(a.audioTrack=i,a.setAudioEnabled(a.audioEnabled),gn.consumerSharedMediaState(e,{audio:a.audioEnabled}))}}processConsumerPaused(e){BS.info(`ParticipantController::processConsumerPaused called for consumerId: ${e}`);const{peerId:t,kind:r,track:n,appData:i,remotelyPaused:s,producerId:o}=this.processMedia(e);if(!t)return;BS.info("ParticipantController::processConsumerPaused",{consumer:{id:e,peerId:t,kind:r,appData:i,remotelyPaused:s,producerId:o}});const a=this.participants.joined.get(t);a&&("video"===r?(a.videoTrack=n,a.setVideoEnabled(!1),gn.consumerSharedMediaState(e,{video:!1})):"audio"===r&&(a.audioTrack=n,a.setAudioEnabled(a.audioEnabled),gn.consumerSharedMediaState(e,{audio:a.audioEnabled})))}processNewConsumer(e){const{peerId:t,kind:r,remotelyPaused:n,track:i,appData:s,producerId:o}=this.processMedia(e);if(!t)return;BS.info("ParticipantController::processNewConsumer",{consumer:{id:e,peerId:t,kind:r,remotelyPaused:n,appData:s,producerId:o}});const a=this.participants.joined.get(t);if(a){if(s.screenShare)return"video"===r?a.screenShareTracks.video=i:"audio"===r&&(a.screenShareTracks.audio=i),(!n||Yt(this,VP).permissions.isRecorder||In.hasFeature(DS.SCREEENSHARE_ERR_HACK))&&a.setScreenShareEnabled(!0),s.supportsRemoteControl&&(a.supportsRemoteControl=!0),this.participants.broadcastMessage("screenshareConsumerCreated",{producerId:o,peerId:t,screenShare:!0,consumerId:e,consumerPeerId:Yt(this,VP).id}),void BS.info("ParticipantController::newScreenshareConsumer::screenshareConsumerCreated",{consumer:{id:e,peerId:t,kind:r,remotelyPaused:n,appData:s,producerId:o}});"video"===r?(a.videoTrack=i,n||a.setVideoEnabled(!0),gn.consumerSharedMediaState(e,{video:!n})):"audio"===r&&Yt(this,$P,zP)instanceof OR&&(a.audioTrack=i,n||a.setAudioEnabled(!0),gn.consumerSharedMediaState(e,{audio:!n}))}}static getStageStatusFromStageType(e){switch(e){case $E.UNSPECIFIED:return"OFF_STAGE";case $E.REQUESTED_STAGE:return"REQUESTED_TO_JOIN_STAGE";case $E.APPROVED_STAGE:return"ACCEPTED_TO_JOIN_STAGE";case $E.OFF_STAGE:return"OFF_STAGE";case $E.ON_STAGE:return"ON_STAGE";default:return"OFF_STAGE"}}static formatSocketServiceMessage(e){var t,r,n,i;if(!e)return;const s=XP.getStageStatusFromStageType(e.stageType);return{id:e.peerId,userId:e.userId,name:e.displayName,stageType:s,customParticipantId:e.customParticipantId,presetId:e.presetId,picture:e.displayPictureUrl,waitlisted:e.waitlisted,stageStatus:s,metadata:{preset_name:null==(t=e.flags)?void 0:t.presetName},recorderType:null==(r=e.flags)?void 0:r.recorderType,flags:{hiddenParticipant:null==(n=e.flags)?void 0:n.hiddenParticipant,recorder:!(null==(i=e.flags)||!i.recorderType)}}}},VP=new WeakMap,BP=new WeakMap,HP=new WeakMap,WP=new WeakMap,GP=new WeakMap,qP=new WeakMap,$P=new WeakSet,zP=function(){return _C()},JP);let ZP=XP;YP([VS.trace("ParticipantController.updatePageParticipants")],ZP.prototype,"updatePageParticipants",1),YP([VS.trace("ParticipantController.setupChatEvents")],ZP.prototype,"setupChatEvents",1),YP([VS.trace("ParticipantController.setupEvents")],ZP.prototype,"setupEvents",1),YP([VS.trace("ParticipantController.processMedia")],ZP.prototype,"processMedia",1),YP([VS.trace("ParticipantController.processConsumerClosed")],ZP.prototype,"processConsumerClosed",1),YP([VS.trace("ParticipantController.processConsumerResumed")],ZP.prototype,"processConsumerResumed",1),YP([VS.trace("ParticipantController.processConsumerPaused")],ZP.prototype,"processConsumerPaused",1),YP([VS.trace("ParticipantController.processNewConsumer")],ZP.prototype,"processNewConsumer",1);Object.defineProperty,Object.getOwnPropertyDescriptor;var eD,tD,rD,nD,iD,sD=(e=>(e[e.User=0]="User",e[e.Meeting=1]="Meeting",e))(sD||{});let oD=(iD=class extends WS{constructor(e,t,r,n){super(),Xt(this,eD),Kt(this,"selfActiveTab"),Kt(this,"broadcastTabChanges"),Xt(this,rD,void 0),Xt(this,nD,void 0),Kt(this,"viewType"),Kt(this,"meetingStartedTimestamp"),Kt(this,"meetingTitle"),Zt(this,rD,e),this.viewType=t,Zt(this,nD,r),this.meetingTitle=n,this.broadcastTabChanges=e.permissions.canSpotlight}get joined(){var e;return null==(e=Yt(this,eD,tD))?void 0:e.roomJoined}get roomName(){return this.meetingId}get meetingId(){var e;return null==(e=Yt(this,eD,tD))?void 0:e.roomName}get mediaConnected(){var e,t;return Yt(this,eD,tD)instanceof fC?null!=(t=null==(e=Yt(this,eD,tD))?void 0:e.mediaConnected)&&t:Yt(this,nD).socket.isConnected}get socketConnected(){return Yt(this,nD).socket.isConnected}setBroadcastTabChanges(e){if(!Yt(this,rD).permissions.canSpotlight)throw BS.error("DyteSpotlight::setSpotlighted::permission_denied"),new $S("User does not have permission to toggle spotlight");this.broadcastTabChanges=e,this.emit("broadcastTabChangesUpdate",this.broadcastTabChanges),this.broadcastTabChanges&&this.assertActiveTabToRoom()}setSelfActiveTab(e,t){var r;BS.info("DyteSpotlight::setActiveTab",{spotlight:{currentTab:{id:e.id,type:e.type}}}),this.selfActiveTab=e,0===t&&this.emit("selfTabUpdate",e),null!=(r=Yt(this,rD).permissions)&&r.canSpotlight&&this.broadcastTabChanges&&0===t&&this.assertActiveTabToRoom()}assertActiveTabToRoom(){Yt(this,eD,tD)instanceof fC&&this.selfActiveTab?Yt(this,eD,tD).assertSpotlightToRoom({userId:Yt(this,rD).userId,currentTab:this.selfActiveTab,peerId:void 0}):Yt(this,nD).broadcastMessage("spotlight",{userId:Yt(this,rD).userId,currentTab:this.selfActiveTab})}},eD=new WeakSet,tD=function(){return _C()},rD=new WeakMap,nD=new WeakMap,iD);oD=((e,t,r,n)=>{for(var i,s=t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(s)||s);return s})([KS((e=>{throw new $S(e.message,"0800")}))],oD);var aD=Object.defineProperty,cD=Object.getOwnPropertyDescriptor,dD=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?cD(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&aD(t,r,s),s};let lD=class extends WS{constructor(){super(),Kt(this,"transcripts"),this.transcripts=[]}static init(e){return tr(this,null,(function*(){const t=new lD;try{e&&(yield t.getActiveTranscript())}catch(e){BS.error("Error fetching active transcriptions ",e)}return t}))}static parseTranscript(e){try{if(!e)return;const[[t,r,n,i,s,o]]=function(e){let t="",r=[""];const n=[r];let i,s=0,o=0,a=!0;for(i of e)'"'===i?(a&&i===t&&(r[s]+=i),a=!a):","===i&&a?i=r[++s]="":"\n"===i&&a?("\r"===t&&(r[s]=r[s].slice(0,-1)),r=n[++o]=[i=""],s=0):r[s]+=i,t=i;return n}(e);return{id:u(),name:s,peerId:r,userId:n,customParticipantId:i,transcript:o,isPartialTranscript:!1,date:new Date(1e3*parseInt(t,10))}}catch(t){return void BS.error(`Failed to parse transcript: ${e}`,t)}}static parseTranscripts(e){return e?e.split("\n").map(lD.parseTranscript).filter(Boolean):[]}getActiveTranscript(){return tr(this,null,(function*(){try{const e=$w(),{transcript:t}=yield e.getActiveTranscript();this.transcripts=lD.parseTranscripts(t)}catch(e){}}))}onTranscript(e){return tr(this,null,(function*(){this.transcripts.push(e),this.emit("transcript",e)}))}};dD([VS.trace("DyteAi.getActiveTranscript")],lD.prototype,"getActiveTranscript",1),dD([VS.trace("DyteAi.onTranscript")],lD.prototype,"onTranscript",1),lD=dD([KS((e=>{throw new $S(e.message,"0000")}))],lD);var uD,hD,pD,mD,fD,gD=Object.defineProperty,vD=Object.getOwnPropertyDescriptor;const yD=(fD=class{constructor(e,t,r,n,i){Xt(this,pD),Kt(this,"meta"),Kt(this,"ai"),Xt(this,uD,void 0),Xt(this,hD,void 0),Kt(this,"aiSocketHandler"),this.meta=new oD(e,Sw.isV2AuthToken?e.config.viewType:e.permissions.viewType,t,i),this.ai=r,Zt(this,uD,e),Zt(this,hD,t),this.aiSocketHandler=n,e.config.viewType!==vn.Chat&&this.setupEvents()}static init(e,t,r,n){return tr(this,null,(function*(){const i=yield lD.init(e.permissions.transcriptionEnabled);return new yD(e,t,i,r,n)}))}get roomName(){return this.meta.roomName}conditionallySetActiveTab(e){var t;null!=e&&e.currentTab&&(null==(t=this.meta.selfActiveTab)?void 0:t.id)!==e.currentTab.id&&(this.meta.setSelfActiveTab(e.currentTab,sD.Meeting),this.meta.emit("activeTabUpdate",e.currentTab))}setupEvents(){tT.on(XS.ROOM_JOINED,(e=>{e.startedAt&&(this.meta.meetingStartedTimestamp=new Date(e.startedAt),this.meta.emit("meetingStartTimeUpdate",{meetingStartedTimestamp:this.meta.meetingStartedTimestamp}))})),tT.on(XS.ROOM_STATE,(({createdAt:e})=>{const t=this.meta.meetingStartedTimestamp;if(e&&!t){const t=new Date(1e3*e);this.meta.meetingStartedTimestamp=t,this.meta.emit("meetingStartTimeUpdate",{meetingStartedTimestamp:this.meta.meetingStartedTimestamp})}})),tT.on(XS.ROOM_NODE_CONNECTED,(()=>{this.meta.emit("connected")})),tT.on(XS.ROOM_NODE_DISCONNECTED,(()=>{this.meta.emit("disconnected")})),tT.on(XS.ICE_CONNECTED,(({transport:e})=>{this.meta.emit("iceConnected",{transport:e})})),tT.on(XS.ICE_DISCONNECTED,(({transport:e})=>{this.meta.emit("iceDisconnected",{transport:e})})),tT.on(XS.ICE_RECONNECTING,(({transport:e})=>{this.meta.emit("iceReconnecting",{transport:e})})),tT.on(XS.ICE_FAILED,(({transport:e})=>{this.meta.emit("iceFailed",{transport:e})})),tT.on(XS.PRODUCER_SCORE_UPDATE,(({score:e})=>{e<5&&this.meta.emit("poorConnection",{score:e})})),tT.on(XS.SOCKET_SERVICE_CONNECTED,(()=>{this.meta.emit("socketConnected")})),tT.on(XS.SOCKET_SERVICE_DISCONNECTED,(()=>{this.meta.emit("socketDisconnected")})),tT.on(XS.SOCKET_SERVICE_RECONNECTING,(()=>{this.meta.emit("socketReconnecting")})),tT.on(XS.SOCKET_SERVICE_RECONNECTION_ATTEMPT,(({attempt:e})=>{this.meta.emit("socketReconnectAttempt",{attempt:e})})),tT.on(XS.SOCKET_SERVICE_RECONNECT_FAILURE,(({attempt:e})=>{this.meta.emit("socketReconnectFailure",{attempt:e})})),tT.on(XS.SOCKET_SERVICE_RECONNECTED,(()=>{this.meta.emit("socketReconnected")})),tT.on(XS.SOCKET_SERVICE_FAILED,(()=>{this.meta.emit("socketFailure")})),tT.on(XS.ROOM_NODE_CONNECTION_ERROR,(e=>{const{message:t}=e;t.match(/room '([a-z0-9-]+)' not found/i)&&this.meta.emit("connectionError",{reason:"ROOM_NOT_FOUND"})})),Yt(this,uD).permissions.canSpotlight&&(BS.info("DyteMetaController::Asserting Spotlight"),this.meta.selfActiveTab&&(Yt(this,pD,mD)instanceof fC?Yt(this,pD,mD).assertSpotlightToRoom({userId:Yt(this,uD).userId,currentTab:this.meta.selfActiveTab,peerId:void 0}):Yt(this,hD).broadcastMessage("spotlight",{userId:Yt(this,uD).userId,currentTab:this.meta.selfActiveTab}))),tT.on(XS.PEER_JOINED,(e=>tr(this,null,(function*(){Yt(this,uD).permissions.canSpotlight&&this.meta.selfActiveTab&&(Yt(this,pD,mD)instanceof fC?Yt(this,pD,mD).assertSpotlightToPeer({userId:Yt(this,uD).userId,currentTab:this.meta.selfActiveTab,peerId:e.id}):Yt(this,hD).broadcastToPeers("spotlight",[e.id],{userId:Yt(this,uD).userId,currentTab:this.meta.selfActiveTab}))})))),tT.on(XS.ROOM_MESSAGE,(e=>{var t,r;let n;if("type"in e){if("spotlight"!==e.type)return;n=$t($t({},e),e.payload)}else{if(!("roomMessageType"in e))return;if("spotlight"!==e.roomMessageType)return;n=e}BS.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:n.userId},currentTab:{id:null==(t=n.currentTab)?void 0:t.id,type:null==(r=n.currentTab)?void 0:r.type}}}),this.conditionallySetActiveTab(n)})),tT.on(XS.MESSAGE,(e=>{var t,r;let n;if("type"in e){if("spotlight"!==e.type)return;n=$t($t({},e),e.payload)}else{if(!("roomMessageType"in e))return;if("spotlight"!==e.roomMessageType)return;n=e}BS.info("Spotlight Assertion Received",{spotlight:{spotlighter:{id:n.userId},currentTab:{id:null==(t=n.currentTab)?void 0:t.id,type:null==(r=n.currentTab)?void 0:r.type}}}),this.conditionallySetActiveTab(n)})),this.aiSocketHandler.on(Jw.transcript,(e=>{const{meetingId:t,transcript:r}=e,n=lD.parseTranscript(r);if(!n)return void BS.warn("Received empty transcript data");this.ai.onTranscript(n),this.meta.emit("transcript",n);const{peerId:i,name:s,transcript:o}=n;BS.debug(`${t} Received transcript for peer ${i} - ${s}: ${o}`)}))}},uD=new WeakMap,hD=new WeakMap,pD=new WeakSet,mD=function(){return _C()},fD);let _D=yD;((e,t,r,n)=>{for(var i,s=vD(t,r),o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(t,r,s)||s);s&&gD(t,r,s)})([VS.trace("MetaController.setupEvents")],_D.prototype,"setupEvents");var SD=Object.defineProperty,TD=Object.getOwnPropertyDescriptor,ED=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?TD(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&SD(t,r,s),s};const bD=16;var wD,kD,RD,CD,ID,AD,PD,DD,OD,MD;let ND=(MD=class extends WS{constructor({baseURL:e,createdAt:t,description:r,id:n,name:i,organizationId:s,picture:o,private:a,published:c,staggered:d,tags:l,type:u,updatedAt:h},p,m,f,g,v){super(),Xt(this,DD),Xt(this,wD,void 0),Xt(this,kD,void 0),Kt(this,"baseURL"),Kt(this,"createdAt"),Kt(this,"description"),Kt(this,"id"),Kt(this,"name"),Xt(this,RD,void 0),Xt(this,CD,void 0),Xt(this,ID,void 0),Kt(this,"organizationId"),Kt(this,"picture"),Kt(this,"private"),Kt(this,"published"),Kt(this,"staggered"),Kt(this,"tags"),Kt(this,"type"),Kt(this,"updatedAt"),Xt(this,AD,void 0),Kt(this,"config"),Xt(this,PD,void 0),Kt(this,"active"),Kt(this,"iframes"),Kt(this,"enabledBy"),this.baseURL=e,this.createdAt=new Date(t),this.description=r,this.id=n,this.name=i,Zt(this,RD,f),this.organizationId=s,this.picture=o,this.private=a,this.published=c,this.staggered=d,this.tags=l,this.type=u,this.updatedAt=new Date(h),this.active=!1,this.iframes=new Map,Zt(this,wD,p),Zt(this,kD,m),Zt(this,CD,g),Zt(this,ID,v),this.enabledBy=""}get roomJoined(){var e;return!0===(null==(e=Yt(this,DD,OD))?void 0:e.roomJoined)}sendIframeEvent(e){this.iframes.size&&this.iframes.forEach((t=>{const{iframe:r}=t;r&&(navigator.isReactNative?r.postMessage(JSON.stringify(e)):r.contentWindow.postMessage(e,"*"))}))}handleIframeMessage(e){return tr(this,null,(function*(){var t,r,n,i;let s;if("socket-service"===Yt(this,kD)){const r=e,{payload:n,uuid:i,type:s}=r;switch(s){case Qw.customPluginEventToRoom:Yt(this,wD).customPluginEventToRoom(this.id,n,i);break;case Qw.customPluginEventToPeers:Yt(this,wD).customPluginEventToPeers(this.id,n.peerIds,n,i);break;case Qw.enablePluginForRoom:Yt(this,wD).enablePluginForRoom(this.id,i);break;case Qw.enablePluginForPeers:Yt(this,wD).enablePluginForPeers(this.id,n.peerIds,i);break;case Qw.disablePluginForRoom:Yt(this,wD).disablePluginForRoom(this.id,i);break;case Qw.disablePluginForPeers:Yt(this,wD).disablePluginForPeers(this.id,n.peerIds,i);break;case Qw.storeInsertKeys:Yt(this,wD).storeInsertKeys(this.id,n.store,n.insertKeys,i);break;case Qw.storeGetKeys:Yt(this,wD).storeGetKeys(this.id,n.store,n.getKeys,i);break;case Qw.storeDeleteKeys:Yt(this,wD).storeDeleteKeys(this.id,n.store,n.deleteKeys,i);break;case Qw.storeDelete:Yt(this,wD).storeDelete(this.id,n.store,i);break;case bD:{const{messagePayload:e,peerIds:t}=n;if(!Yt(this,ID))return void this.sendIframeEvent({type:bD,uuid:r.uuid,payload:{error:"Chat is disabled for this room."}});try{yield Yt(this,ID).sendMessage(e,t),this.sendIframeEvent({type:bD,uuid:r.uuid,payload:{success:!0}})}catch(e){this.sendIframeEvent({type:bD,uuid:r.uuid,payload:{error:e}})}break}case 14:{let e;const{peerId:i}=n,s=zt($t({},Yt(this,RD)),{isRecorder:null==(t=Yt(this,RD).permissions)?void 0:t.isRecorder,isHidden:Yt(this,RD).permissions.hiddenParticipant,stageStatus:Yt(this,RD).stageStatus});i?(e=Yt(this,CD).joined.get(n.peerId),Yt(this,RD).id===i&&(e=s)):e=s,this.sendIframeEvent({type:14,payload:{peer:e&&AS(e)},uuid:r.uuid});break}case 15:{const e=Yt(this,CD).joined.toArray().map((e=>AS(e)));this.sendIframeEvent({type:15,payload:{peers:e},uuid:r.uuid});break}case 19:this.sendIframeEvent({type:19,payload:{enabledBy:this.enabledBy},uuid:r.uuid});break;case 18:this.sendIframeEvent({type:18,payload:{displayTitle:Yt(this,DD,OD).meetingTitle},uuid:r.uuid});break;case 17:this.sendIframeEvent({type:17,payload:{roomName:Yt(this,DD,OD).roomName},uuid:r.uuid});break;case 20:this.emit(r.payload.eventName,r.payload.data)}return}const o=(e,t)=>{if(Yt(this,RD).userId===e)return Yt(this,RD).id;let r;return t.forEach((t=>{t.userId===e&&(r=t.id)})),r},a=e;switch(a.type){case"pluginEvent":case"storePluginData":case"getPluginData":case"enablePluginForAll":case"enablePluginForUser":case"disablePluginForUser":case"chatMessage":s=yield Yt(this,DD,OD).sendMessage(a),this.sendIframeEvent(s);break;case"getJoinedPeers":s=yield Yt(this,DD,OD).getRoomState(),this.sendIframeEvent({type:"websocket/get-joined-peers",payload:zt($t({},a.payload),{peers:s.payload.roomState.peers})});break;case"getPeerInfo":s=yield Yt(this,DD,OD).sendMessage({type:a.type,payload:zt($t({},a.payload),{peerId:null!=(n=null==(r=a.payload)?void 0:r.peerId)?n:Yt(this,RD).id})}),this.sendIframeEvent(s);break;case"getRoomState":{s=yield Yt(this,DD,OD).getRoomState();const{plugins:e,peers:t}=s.payload.roomState,{enabledBy:r}=e.find((e=>e.id===this.id)),n=o(r,t);this.sendIframeEvent({type:"websocket/get-room-state",payload:zt($t({},a.payload),{roomName:s.payload.roomState.roomName,pluginInitiatorPeerId:n,pluginInitiatorUserId:r,peers:s.payload.roomState.peers,displayTitle:s.payload.roomState.displayTitle,roomUUID:s.payload.roomState.roomUUID,currentPeer:Yt(this,RD).id,isRecorder:null==(i=Yt(this,RD).permissions)?void 0:i.isRecorder})});break}case"getPluginInitiatorId":{s=yield Yt(this,DD,OD).getRoomState();const{plugins:e,peers:t}=s.payload.roomState,{enabledBy:r}=e.find((e=>e.id===this.id)),n=o(r,t);this.sendIframeEvent({type:"websocket/get-plugin-initiator-peer-id",payload:zt($t({},a.payload),{pluginInitiatorPeerId:n})});break}case"getPluginInitiatorUserId":{s=yield Yt(this,DD,OD).getRoomState();const{plugins:e}=s.payload.roomState,{enabledBy:t}=e.find((e=>e.id===this.id));this.sendIframeEvent({type:"websocket/get-plugin-initiator-user-id",payload:zt($t({},a.payload),{pluginInitiatorUserId:t})});break}case"pluginEventToParent":this.emit(a.payload.eventName,a.payload.data);break;case"toggleViewMode":this.emit("toggleViewMode",a.payload.data)}}))}sendData(e){"socket-service"!==Yt(this,kD)?this.sendIframeEvent({type:XS.PLUGIN_INTERNAL_DATA,payload:{pluginId:this.id,data:e}}):this.sendIframeEvent({type:24,uuid:"",payload:e})}removePluginView(e="default"){var t;const{iframe:r,listener:n}=null!=(t=this.iframes.get(e))?t:{};(r||n)&&(navigator.isReactNative?r.props.onMessage=void 0:window.removeEventListener("message",n),this.iframes.delete(e))}addPluginView(e,t="default"){var r;if(!Yt(this,PD))throw BS.error("DytePlugin::addPluginView::no_auth_token_set_for_plugin"),new $S("No auth token set for plugin.");if(!e)throw BS.error("DytePlugin::addPluginView::iframe_was_not_provided"),new $S("Iframe was not provided.");this.removePluginView(t);const n=e,i=new URL(this.baseURL),s={auth:Yt(this,PD),parent:navigator.isReactNative?this.baseURL:window.location.origin,backend:td.apiBase,pluginId:this.id,roomName:null!=(r=Yt(this,DD,OD).roomName)?r:"",displayTitle:Yt(this,DD,OD).meetingTitle};if(Object.keys(s).forEach((e=>{i.searchParams.set(e,s[e])})),n.src=i.href,n.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",n.title=t,navigator.isReactNative)n.props.onMessage=e=>{this.handleIframeMessage(JSON.parse(e.nativeEvent.data))},this.iframes.set(t,{iframe:n});else{const r=t=>tr(this,null,(function*(){t.source===e.contentWindow&&(yield this.handleIframeMessage(t.data))}));window.addEventListener("message",r),this.iframes.set(t,{iframe:n,listener:r})}}setActive(e){var t,r;this.active=e,e?this.emit("stateUpdate",{active:this.active,pluginId:this.id,bind:this.addPluginView.bind(this),views:null==(t=this.config)?void 0:t.views}):(this.active=!1,this.emit("stateUpdate",{active:this.active,pluginId:this.id,views:null==(r=this.config)?void 0:r.views}))}activateForSelf(){return tr(this,null,(function*(){const e=$w(),t=yield e.authorizePlugin(this.id);Zt(this,PD,t),Zt(this,AD,new Date);try{const t=yield e.getPluginConfig(this.baseURL);this.config=t}catch(e){BS.error("DytePlugin::activateForSelf",{error:e})}this.setActive(!0),this.emit("enabled")}))}deactivateForSelf(){Array.from(this.iframes.keys()).forEach((e=>{this.removePluginView(e)})),Zt(this,AD,void 0),this.iframes.clear(),this.setActive(!1),this.emit("closed")}enable(){return tr(this,null,(function*(){return this.activateForSelf()}))}disable(){return this.deactivateForSelf()}activate(){return tr(this,null,(function*(){var e,t;this.active||null!=(t=null==(e=Yt(this,RD).permissions)?void 0:e.plugins)&&t.canStart&&("socket-service"===Yt(this,kD)?Yt(this,wD).addPlugin(this.id,this.staggered):yield Yt(this,DD,OD).addRoomPlugin(this),Zt(this,AD,new Date),BS.info("plugin::activated",{plugin:{id:this.id,enabledBy:this.enabledBy,name:this.name}}))}))}deactivate(){return tr(this,null,(function*(){var e,t;this.activate&&null!=(t=null==(e=Yt(this,RD).permissions)?void 0:e.plugins)&&t.canClose&&("socket-service"===Yt(this,kD)?Yt(this,wD).removePlugin(this.id):yield Yt(this,DD,OD).removeRoomPlugin(this),BS.info("plugin::deactivated",{plugin:{id:this.id,name:this.name,duration:(new Date).getTime()-Yt(this,AD).getTime()}}),Zt(this,AD,void 0))}))}},wD=new WeakMap,kD=new WeakMap,RD=new WeakMap,CD=new WeakMap,ID=new WeakMap,AD=new WeakMap,PD=new WeakMap,DD=new WeakSet,OD=function(){return _C()},MD);ED([VS.trace("PluginController.activatePlugin")],ND.prototype,"activate",1),ED([VS.trace("PluginController.deactivatePlugin")],ND.prototype,"deactivate",1),ND=ED([KS((e=>{throw new $S(e.message,"0600")}))],ND);class xD extends aP{constructor(){super({onAddEvent:"pluginAdded",onDeleteEvent:"pluginDeleted"})}add(e,t=!0){return super.add(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}Object.defineProperty,Object.getOwnPropertyDescriptor;let LD=class{constructor(){Kt(this,"all"),Kt(this,"active"),this.all=new xD,this.active=new xD}};LD=((e,t,r,n)=>{for(var i,s=t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(s)||s);return s})([KS((e=>{throw new $S(e.message,"0600")}))],LD);var UD,jD,FD=Object.defineProperty,VD=Object.getOwnPropertyDescriptor,BD=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?VD(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&FD(t,r,s),s};const HD=(jD=class{constructor(e){Xt(this,UD,void 0),Zt(this,UD,e)}createChannel(e,t,r,n="public",i=!1){return tr(this,null,(function*(){const s={displayName:e,targetUserIds:t,displayPictureUrl:r,visibility:n,isDirectMessage:i};i&&(s.visibility="private");const o=yield Yt(this,UD).sendMessagePromise(Xw.createChatChannel,UE.toBinary(s)),a=HE.fromBinary(o.payload).chatChannels;return HD.formatChannel(a[0])}))}updateChannel(e,t){return tr(this,null,(function*(){const r=yield Yt(this,UD).sendMessagePromise(Xw.updateChatChannel,jE.toBinary({chatChannelId:e,targetUserIds:t.memberIds,displayName:t.displayName,displayPictureUrl:t.displayPictureUrl,visibility:t.visibility})),n=HE.fromBinary(r.payload).chatChannels;return HD.formatChannel(n[0])}))}static formatChannel(e){var t;const{latestMessageAndUnreadCount:r}=e,n=zt($t({},e),{id:e.chatChannelId,memberIds:e.targetUserIds,unreadCount:null!=(t=null==r?void 0:r.unreadCount)?t:0});return null!=r&&r.message&&(n.latestMessage=gO.formatSocketServiceMessage(r.message)),delete n.chatChannelId,delete n.targetUserIds,delete n.latestMessageAndUnreadCount,n}getChannelMembers(e){return tr(this,null,(function*(){try{const t=yield Yt(this,UD).sendMessagePromise(Xw.getChannelMembers,FE.toBinary({chatChannelId:e}));return GE.fromBinary(t.payload).channelMembers.map((e=>{var t=e,{id:r}=t,n=Jt(t,["id"]);return zt($t({},n),{userId:r})}))}catch(e){return[]}}))}on(e,t){let r,n;switch(e){case Xw.createChatChannel:case Xw.updateChatChannel:r=HE.fromBinary.bind(HE),n=HE.create()}r?Yt(this,UD).on(e,(({payload:e})=>{let i=n;try{i=r(e)}catch(e){BS.error("ChatChannelSocketHandler::on::binary_decode_error",{error:e})}return t(i)})):BS.warn(`ChatChannelSocketHandler::Event ${e} is not recognized`)}},UD=new WeakMap,jD);let WD=HD;BD([VS.trace("ChatChannelHandler.createChannel")],WD.prototype,"createChannel",1),BD([VS.trace("ChatChannelHandler.updateChannel")],WD.prototype,"updateChannel",1),BD([VS.trace("ChatChannelHandler.getChannelMembers")],WD.prototype,"getChannelMembers",1);var GD,qD=Object.defineProperty,$D=Object.getOwnPropertyDescriptor,zD=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?$D(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&qD(t,r,s),s},JD=(e=>(e[e.TEXT=0]="TEXT",e[e.IMAGE=1]="IMAGE",e[e.FILE=2]="FILE",e[e.CUSTOM=3]="CUSTOM",e))(JD||{});class KD{constructor(e){Xt(this,GD,void 0),Zt(this,GD,e)}getChatMessages(){return Yt(this,GD).sendMessagePromise(Kw.getMessages)}getChatMessagesPaginated(e,t,r,n=0,i=""){return tr(this,null,(function*(){const s={timeStamp:e,size:t,from:n,reversed:r,channelId:i},o=yield Yt(this,GD).sendMessagePromise(Kw.getPaginatedMessages,SE.toBinary(s));return o.payload?TE.fromBinary(o.payload):{messages:[],next:!1}}))}sendMessageToRoom(e,t){const r={payloadType:t,payload:e};Yt(this,GD).sendMessage(Kw.sendMessageToRoom,bE.toBinary(r))}sendMessageToPeers(e,t,r){const n={payloadType:t,peerIds:r,payload:e};Yt(this,GD).sendMessage(Kw.sendMessageToPeers,kE.toBinary(n))}sendMessageToChannel(e,t,r){const n={payloadType:t,channelId:r,payload:e};Yt(this,GD).sendMessage(Kw.sendMessageToChannel,CE.toBinary(n))}sendMessage(e,t,r,n){n&&this.sendMessageToChannel(e,t,n),r&&r.length>0?this.sendMessageToPeers(e,t,r):this.sendMessageToRoom(e,t)}editMessage(e,t,r,n,i){return tr(this,null,(function*(){const s={chatId:e,payloadType:r,payload:t};n&&(s.channelId=n),void 0!==i&&(s.pinned=i);const o=yield Yt(this,GD).sendMessagePromise(Kw.editMessage,IE.toBinary(s));return DE.fromBinary(o.payload).message}))}deleteMessage(e,t){return tr(this,null,(function*(){const r={chatId:e};t&&(r.channelId=t);const n=yield Yt(this,GD).sendMessagePromise(Kw.deleteMessage,OE.toBinary(r)),i=ME.fromBinary(n.payload);return $t({id:i.chatId},i.channelId?{channelId:i.channelId}:{})}))}searchMessages(e,t){return tr(this,null,(function*(){var r,n,i;const s={searchTerm:e,timeStamp:null!=(r=t.timestamp)?r:Date.now(),size:null!=(n=t.size)?n:75,from:0,reversed:null==(i=t.reversed)||i};t.channelId&&(s.channelId=t.channelId);try{const e=yield Yt(this,GD).sendMessagePromise(Kw.searchChannelMessages,NE.toBinary(s));return EE.fromBinary(e.payload).messages}catch(e){return[]}}))}getAllChannels(){return tr(this,null,(function*(){try{const e=yield Yt(this,GD).sendMessagePromise(Kw.getAllChatChannels);return HE.fromBinary(e.payload).chatChannels.map(WD.formatChannel)}catch(e){return[]}}))}markLastReadMessage(e,t){return tr(this,null,(function*(){const r=yield Yt(this,GD).sendMessagePromise(Kw.markChannelIndexAsRead,xE.toBinary({channelId:e,userId:t.userId,channelIndex:t.channelIndex}));return LE.fromBinary(r.payload).channelIndex}))}setPinState(e,t){return tr(this,null,(function*(){const r={chatId:e.id,pinned:t,channelId:e.channelId},n=yield Yt(this,GD).sendMessagePromise(Kw.pinMessage,AE.toBinary(r));return PE.fromBinary(n.payload)}))}on(e,t){let r,n;switch(e){case Kw.sendMessageToRoom:r=wE.fromBinary.bind(wE),n=wE.create();break;case Kw.sendMessageToPeers:r=RE.fromBinary.bind(RE),n=RE.create();break;case Kw.editMessage:r=DE.fromBinary.bind(DE),n=DE.create();break;case Kw.pinMessage:r=PE.fromBinary.bind(PE),n=PE.create();break;case Kw.deleteMessage:r=ME.fromBinary.bind(ME),n=ME.create()}r?Yt(this,GD).on(e,(({payload:e})=>{let i=n;try{i=r(e)}catch(e){BS.error("chatSocketHandler::on::binary_decode_error",{error:e})}return t(i)})):BS.warn(`ChatSocketHandler::Event ${e} is not recognized`)}}GD=new WeakMap,zD([VS.trace("SocketService.getChatMessages")],KD.prototype,"getChatMessages",1),zD([VS.trace("SocketService.getChatMessagesPaginated")],KD.prototype,"getChatMessagesPaginated",1),zD([VS.trace("SocketService.sendMessageToRoom")],KD.prototype,"sendMessageToRoom",1),zD([VS.trace("SocketService.sendMessageToPeers")],KD.prototype,"sendMessageToPeers",1),zD([VS.trace("SocketService.sendMessageToChannel")],KD.prototype,"sendMessageToChannel",1),zD([VS.trace("SocketService.sendMessage")],KD.prototype,"sendMessage",1),zD([VS.trace("SocketService.editMessage")],KD.prototype,"editMessage",1),zD([VS.trace("SocketService.deleteMessage")],KD.prototype,"deleteMessage",1),zD([VS.trace("SocketService.searchMessages")],KD.prototype,"searchMessages",1),zD([VS.trace("SocketService.getAllChannels")],KD.prototype,"getAllChannels",1),zD([VS.trace("SocketService.markLastReadMessage")],KD.prototype,"markLastReadMessage",1);var QD=Object.defineProperty,YD=Object.getOwnPropertyDescriptor,XD=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?YD(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&QD(t,r,s),s};const ZD=["text","image","file","custom","poll"];var eO,tO,rO,nO,iO,sO,oO,aO;let cO=(aO=class extends WS{constructor(e,t,r,n,i){super(),Xt(this,sO),Kt(this,"messages"),Kt(this,"channels",[]),Xt(this,eO,void 0),Xt(this,tO,void 0),Xt(this,rO,void 0),Xt(this,nO,void 0),Xt(this,iO,void 0),Zt(this,rO,e),Zt(this,nO,t),Zt(this,iO,r),Zt(this,eO,n),Zt(this,tO,i),this.messages=[]}get roomJoined(){var e;return!0===(null==(e=Yt(this,sO,oO))?void 0:e.roomJoined)}sendMessageInternal(e,t,r){return tr(this,arguments,(function*(e,t,r,n={}){switch(e.type){case"text":{const i=n.replyTo&&"text"===n.replyTo.type?function(e,t){return`<blockquote>${t.replace(/<blockquote>[.\s\S]*<\/blockquote>\n\n/m,"")}</blockquote>\n\n${e}`}(e.message,n.replyTo.message):e.message;yield this.sendTextMessageInternal(i,t,r);break}case"image":yield this.sendImageMessageInternal(e.image,t,r);break;case"file":yield this.sendFileMessageInternal(e.file,t,r);break;default:BS.error("sendMessage::message_type_not_supported",{dyteChat:{messageType:e.type}})}}))}sendTextMessageInternal(e,t,r){return tr(this,null,(function*(){var n,i,s,o,a,c;if(t&&t.length>0){if(null==(n=Yt(this,eO).permissions)||!n.chatPrivate.canSend||null==(i=Yt(this,eO).permissions)||!i.chatPrivate.text)throw BS.error("sendTextMessage::private_chat_permission_denied"),new $S("Could not send message to private chat.","0501")}else if(null==(o=null==(s=Yt(this,eO).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Yt(this,eO).permissions)?void 0:a.chatPublic)||!c.text)throw BS.error("sendTextMessage::public_chat_permission_denied"),new $S("Could not send message to public chat.","0501");if(!e)throw BS.error("sendTextMessage::message_can_not_be_empty"),new $S("Message can not be empty.","0502");if(r){if("socket-service"!==Yt(this,iO))throw new Error("Socket service required for channel support");return void Yt(this,rO).sendMessageToChannel(e,JD.TEXT,r)}if("socket-service"===Yt(this,iO)){let r=[];return t&&t.length>0&&(t.push(Yt(this,eO).id),r=Yt(this,tO).joined.toArray().filter((e=>t.includes(e.id))).map((e=>e.userId)),r.push(Yt(this,eO).userId)),void Yt(this,rO).sendMessage(e,JD.TEXT,t)}if(void 0!==t&&t.length>0)return void BS.error("sendTextMessage::private_chat_unsupported");const d={userId:Yt(this,eO).userId,displayName:Yt(this,eO).name,message:e,type:ZD.indexOf("text"),time:+new Date};if(!this.roomJoined)throw BS.error("DyteChat.sendTextMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new $S("Can`t sendTextMessage without joining room");yield Yt(this,sO,oO).sendChatMessage(d)}))}sendImageMessageInternal(e,t,r){return tr(this,null,(function*(){var n,i,s,o,a,c;if(t&&t.length>0){if(null==(n=Yt(this,eO).permissions)||!n.chatPrivate.canSend||null==(i=Yt(this,eO).permissions)||!i.chatPrivate.files)return void BS.error("sendImageMessage::private_chat_permission_denied")}else if(null==(o=null==(s=Yt(this,eO).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Yt(this,eO).permissions)?void 0:a.chatPublic)||!c.files)return void BS.error("sendImageMessage::permission_denied");if(e)if(["image/gif","image/jpeg","image/png"].includes(e.type))try{const n=$w(),{getLocation:i,putLocation:s}=yield n.getPresignedUrls(e.name,Yt(this,eO).config.viewType);if(yield n.uploadFile(e,s),r){if("socket-service"!==Yt(this,iO))throw new Error("Socket service required for channel support");return void Yt(this,rO).sendMessageToChannel(i,JD.IMAGE,r)}if("socket-service"===Yt(this,iO)){let e=[];return t&&t.length>0&&(t.push(Yt(this,eO).id),e=Yt(this,tO).joined.toArray().filter((e=>t.includes(e.id))).map((e=>e.userId)),e.push(Yt(this,eO).userId)),void Yt(this,rO).sendMessage(i,JD.IMAGE,t)}if(void 0!==t&&t.length>0)return void BS.error("sendImageMessage::private_chat_unsupported");const o={userId:Yt(this,eO).userId,displayName:Yt(this,eO).name,type:ZD.indexOf("image"),link:i,time:+new Date};if(!this.roomJoined)throw BS.error("DyteChat.sendImageMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new $S("Can`t sendImageMessage without joining room");yield Yt(this,sO,oO).sendChatMessage(o)}catch(e){throw new $S("Error sending image message.")}else BS.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:e.type}});else BS.error("sendImageMessage::required_argument_image_can_not_be_empty")}))}sendFileMessageInternal(e,t,r){return tr(this,null,(function*(){var n,i,s,o,a,c;if(t&&t.length>0){if(null==(n=Yt(this,eO).permissions)||!n.chatPrivate.canSend||null==(i=Yt(this,eO).permissions)||!i.chatPrivate.files)return void BS.error("sendFileMessage::private_chat_permission_denied")}else if(null==(o=null==(s=Yt(this,eO).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Yt(this,eO).permissions)?void 0:a.chatPublic)||!c.files)return void BS.error("sendFileMessage::permission_denied");if(e)try{const n=$w(),{getLocation:i,putLocation:s}=yield n.getPresignedUrls(e.name,Yt(this,eO).config.viewType);if(yield n.uploadFile(e,s),r){if("socket-service"!==Yt(this,iO))throw new Error("Socket service required for channel support");return void Yt(this,rO).sendMessageToChannel(JSON.stringify({link:i,name:e.name,size:"size"in e?e.size:0}),JD.FILE,r)}if("socket-service"===Yt(this,iO)){let r=[];t&&t.length>0&&(t.push(Yt(this,eO).id),r=Yt(this,tO).joined.toArray().filter((e=>t.includes(e.id))).map((e=>e.userId)),r.push(Yt(this,eO).userId));const n=JSON.stringify({link:i,name:e.name,size:"size"in e?e.size:0});return void Yt(this,rO).sendMessage(n,JD.FILE,t)}if(void 0!==t&&t.length>0)return void BS.error("sendFileMessage::private_chat_unsupported");const o={userId:Yt(this,eO).userId,displayName:Yt(this,eO).name,type:ZD.indexOf("file"),link:i,name:e.name,size:"size"in e?e.size:0,time:+new Date};if(!this.roomJoined)throw BS.error("DyteChat.sendFileMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new $S("Can`t sendFileMessage without joining room");yield Yt(this,sO,oO).sendChatMessage(o)}catch(e){throw new $S("Error sending file message.")}else BS.error("sendFileMessage::required_argument_file_can_not_be_empty")}))}sendTextMessage(e,t){return tr(this,null,(function*(){return this.sendTextMessageInternal(e,t)}))}sendCustomMessage(e,t){return tr(this,null,(function*(){var r,n,i,s,o,a,c,d,l,u,h,p,m,f,g;if(t&&t.length>0){if(null==(r=Yt(this,eO).permissions)||!r.chatPrivate.canSend||null==(n=Yt(this,eO).permissions)||!n.chatPrivate.files||null==(i=Yt(this,eO).permissions)||!i.chatPrivate.text)return void BS.error("sendCustomMessage::private_chat_permission_denied")}else if(null==(o=null==(s=Yt(this,eO).permissions)?void 0:s.chatPublic)||!o.canSend||null==(c=null==(a=Yt(this,eO).permissions)?void 0:a.chatPublic)||!c.files||null==(l=null==(d=Yt(this,eO).permissions)?void 0:d.chatPublic)||!l.text)return void BS.error("sendCustomMessage::permission_denied");const v=e=>tr(this,null,(function*(){try{if("string"==typeof e)return e;const t=$w(),{getLocation:r,putLocation:n}=yield t.getPresignedUrls(e.name,Yt(this,eO).config.viewType);return yield t.uploadFile(e,n),r}catch(e){throw new $S("Error sending image message.")}})),y=zt($t({},e),{files:yield Promise.all(null==(h=null!=(u=e.files)?u:[])?void 0:h.map((e=>v(e)))),images:yield Promise.all(null==(m=null!=(p=e.images)?p:[])?void 0:m.map((e=>tr(this,null,(function*(){return v(e)}))))),videos:yield Promise.all(null==(g=null!=(f=e.videos)?f:[])?void 0:g.map((e=>tr(this,null,(function*(){return v(e)})))))});if("socket-service"===Yt(this,iO))return void Yt(this,rO).sendMessage(JSON.stringify(y),JD.CUSTOM,t);if(void 0!==t&&t.length>0)return void BS.error("sendCustomMessage::private_chat_unsupported");if(!this.roomJoined)throw BS.error("DyteChat.sendCustomMessage.RoomNodeClientSocketUsed_WithoutRoomJoin"),new $S("Can`t sendCustomMessage without joining room");const _=zt($t({userId:Yt(this,eO).userId,displayName:Yt(this,eO).name},y),{type:ZD.indexOf("custom"),time:+new Date});yield Yt(this,sO,oO).sendChatMessage(_)}))}sendImageMessage(e,t){return tr(this,null,(function*(){return this.sendImageMessageInternal(e,t)}))}sendFileMessage(e,t){return tr(this,null,(function*(){return this.sendFileMessageInternal(e,t)}))}sendMessage(e,t){return tr(this,null,(function*(){return this.sendMessageInternal(e,t)}))}editTextMessage(e,t,r){return tr(this,null,(function*(){var n,i,s,o,a,c;if("socket-service"===Yt(this,iO)){if("NONE"===(null==(i=null==(n=Yt(this,eO).permissions)?void 0:n.chatMessage)?void 0:i.canEdit))throw new $S("Not permitted to edit messages","0501");null!=(o=null==(s=Yt(this,eO).permissions)?void 0:s.chatPublic)&&o.canSend&&null!=(c=null==(a=Yt(this,eO).permissions)?void 0:a.chatPublic)&&c.text?t?Yt(this,rO).editMessage(e,t,JD.TEXT,r):BS.error("editTextMessage::message_can_not_be_empty"):BS.error("editTextMessage::permission_denied")}else BS.warn("editTextMessage::Coming soon!")}))}editImageMessage(e,t,r){return tr(this,null,(function*(){var n,i,s,o;if("socket-service"===Yt(this,iO))if(null!=(i=null==(n=Yt(this,eO).permissions)?void 0:n.chatPublic)&&i.canSend&&null!=(o=null==(s=Yt(this,eO).permissions)?void 0:s.chatPublic)&&o.files)if(t)if(["image/gif","image/jpeg","image/png"].includes(t.type))try{const n=$w(),{getLocation:i,putLocation:s}=yield n.getPresignedUrls(t.name,Yt(this,eO).config.viewType);yield n.uploadFile(t,s),Yt(this,rO).editMessage(e,i,JD.IMAGE,r)}catch(e){throw new $S("Error editing image message.")}else BS.error("sendImageMessage::image_type_not_supported",{dyteChat:{imageType:t.type}});else BS.error("editImageMessage::required_argument_image_can_not_be_empty");else BS.error("editImageMessage::permission_denied");else BS.warn("editImageMessage::Coming soon!")}))}editFileMessage(e,t,r){return tr(this,null,(function*(){var n,i,s,o;if("socket-service"===Yt(this,iO))if(null!=(i=null==(n=Yt(this,eO).permissions)?void 0:n.chatPublic)&&i.canSend&&null!=(o=null==(s=Yt(this,eO).permissions)?void 0:s.chatPublic)&&o.files)if(t)try{const n=$w(),{getLocation:i,putLocation:s}=yield n.getPresignedUrls(t.name,Yt(this,eO).config.viewType);yield n.uploadFile(t,s),Yt(this,rO).editMessage(e,JSON.stringify({link:i,name:t.name,size:"size"in t?t.size:0}),JD.FILE,r)}catch(e){throw new $S("Error editing file message.")}else BS.error("sendFileMessage::required_argument_file_can_not_be_empty");else BS.error("sendFileMessage::permission_denied");else BS.warn("editFileMessage::Coming soon!")}))}editMessage(e,t,r){return tr(this,null,(function*(){if("socket-service"===Yt(this,iO))switch(t.type){case"text":this.editTextMessage(e,t.message,r);break;case"image":this.editImageMessage(e,t.image,r);break;case"file":this.editFileMessage(e,t.file,r);break;default:BS.error("editMessage::message_type_not_supported",{dyteChat:{messageType:t.type}})}else BS.warn("editMessage::Coming soon!")}))}deleteMessage(e,t){return tr(this,null,(function*(){var r,n;if("socket-service"===Yt(this,iO)){if("NONE"===(null==(n=null==(r=Yt(this,eO).permissions)?void 0:r.chatMessage)?void 0:n.canDelete))throw new $S("Not permitted to delete messages","0501");Yt(this,rO).deleteMessage(e,t)}else BS.warn("editMessage::Coming soon!")}))}getMessagesByUser(e){return this.messages.filter((t=>t.userId===e))}getMessagesByType(e){return this.messages.filter((t=>t.type===e))}pin(e){return tr(this,null,(function*(){if(!this.roomJoined)throw new $S("Can`t pin message without joining room");if(!Yt(this,eO).permissions.pinParticipant)throw new $S("You do not have permission to pin messages.");if("socket-service"===Yt(this,iO)){const t=this.messages.find((t=>t.id===e));if(t)return void Yt(this,rO).setPinState(t,!0);throw new $S(`No message found with id: ${e}`)}yield Yt(this,sO,oO).pinChatMessage({id:e})}))}unpin(e){return tr(this,null,(function*(){if(!this.roomJoined)throw new $S("Can`t unpin message without joining room");if(!Yt(this,eO).permissions.pinParticipant)throw new $S("You do not have permission to unpin messages.");if("socket-service"===Yt(this,iO)){const t=this.messages.find((t=>t.id===e));if(t)return void Yt(this,rO).setPinState(t,!1);throw new $S(`No message found with id: ${e}`)}yield Yt(this,sO,oO).unpinChatMessage({id:e})}))}getMessages(e,t,r,n=0,i=void 0){return tr(this,null,(function*(){const s=yield Yt(this,rO).getChatMessagesPaginated(e,t,r,n,i);return{messages:s.messages.map((e=>gO.formatSocketServiceMessage(e))),next:s.next}}))}createChannel(e,t){return tr(this,arguments,(function*(e,t,r={}){var n;const i=null==(n=Yt(this,eO).permissions)?void 0:n.chatChannel;if(i){if("NONE"===i.canCreate)throw new $S("Not permitted to create channels","0501");if("public"===r.visibility&&"PUBLIC"!==i.canCreate&&"ALL"!==i.canCreate)throw new $S("Not permitted to create public channels","0501");if("private"===r.visibility&&"PRIVATE"!==i.canCreate&&"ALL"!==i.canCreate)throw new $S("Not permitted to create private channels","0501")}if(!e||0===e.trim().length)throw new $S("channel name cannot be empty.","0510");const s=[...new Set([...t,Yt(this,eO).userId])];return yield Yt(this,nO).createChannel(e.trim(),s,r.displayPictureUrl,r.visibility,r.isDirectMessage)}))}updateChannel(e,t){var r,n,i,s,o;const a=this.channels.find((t=>t.id===e)),c=null==(r=Yt(this,eO).permissions)?void 0:r.chatChannel;if(c){if("NONE"===c.canUpdate)throw new $S("Not permitted to update channels","0501");if("public"===a.visibility&&"PUBLIC"!==c.canUpdate&&"ALL"!==c.canUpdate)throw new $S("Not permitted to update public channels","0501");if("private"===a.visibility&&"PRIVATE"!==c.canUpdate&&"ALL"!==c.canUpdate)throw new $S("Not permitted to update private channels","0501")}const d={memberIds:null!=(n=t.memberIds)?n:a.memberIds,displayName:null!=(i=t.displayName)?i:a.displayName,displayPictureUrl:null!=(s=t.displayPictureUrl)?s:a.displayPictureUrl,visibility:null!=(o=t.visibility)?o:a.visibility};return Yt(this,nO).updateChannel(e,d)}sendMessageToChannel(e,t){return tr(this,arguments,(function*(e,t,r={}){return this.sendMessageInternal(e,null,t,r)}))}getChannelMembers(e){return tr(this,null,(function*(){return Yt(this,nO).getChannelMembers(e)}))}searchMessages(e){return tr(this,arguments,(function*(e,t={}){if(!In.hasFeature(DS.FEAT_CHAT_SDK_SEARCH))throw new $S("searchMessages is temporarily disabled!");return(yield Yt(this,rO).searchMessages(e,t)).map(gO.formatSocketServiceMessage)}))}markLastReadMessage(e,t){return tr(this,null,(function*(){yield Yt(this,rO).markLastReadMessage(e,t);const r=this.channels.find((t=>t.id===e));if(r){const t=zt($t({},r),{unreadCount:0});this.channels=this.channels.map((r=>r.id===e?t:r)),this.emit("channelMessageUpdate",t)}}))}get pinned(){return this.messages.filter((e=>e.pinned))}},eO=new WeakMap,tO=new WeakMap,rO=new WeakMap,nO=new WeakMap,iO=new WeakMap,sO=new WeakSet,oO=function(){return _C()},aO);XD([VS.trace("DyteChat.sendTextMessage")],cO.prototype,"sendTextMessage",1),XD([VS.trace("DyteChat.sendImageMessage")],cO.prototype,"sendImageMessage",1),XD([VS.trace("DyteChat.sendFileMessage")],cO.prototype,"sendFileMessage",1),XD([VS.trace("DyteChat.sendMessage")],cO.prototype,"sendMessage",1),XD([VS.trace("DyteChat.editTextMessage")],cO.prototype,"editTextMessage",1),XD([VS.trace("DyteChat.editImageMessage")],cO.prototype,"editImageMessage",1),XD([VS.trace("DyteChat.editFileMessage")],cO.prototype,"editFileMessage",1),XD([VS.trace("DyteChat.editMessage")],cO.prototype,"editMessage",1),XD([VS.trace("DyteChat.deleteMessage")],cO.prototype,"deleteMessage",1),XD([VS.trace("DyteChat.createChannel")],cO.prototype,"createChannel",1),XD([VS.trace("DyteChat.updateChannel")],cO.prototype,"updateChannel",1),XD([VS.trace("DyteChat.sendMessageToChannel")],cO.prototype,"sendMessageToChannel",1),XD([VS.trace("DyteChat.getChannelMembers")],cO.prototype,"getChannelMembers",1),XD([VS.trace("DyteChat.searchMessages")],cO.prototype,"searchMessages",1),XD([VS.trace("DyteChat.markLastReadMessage")],cO.prototype,"markLastReadMessage",1),cO=XD([KS((e=>{throw new $S(e.message,"0500")}))],cO);var dO,lO,uO,hO,pO=Object.defineProperty,mO=Object.getOwnPropertyDescriptor;const fO=(hO=class{constructor(e,t,r,n,i,s=!1){Xt(this,dO),Kt(this,"chat"),Kt(this,"chatSocketHandler"),Kt(this,"chatChannelSocketHandler"),Kt(this,"self"),Xt(this,uO,void 0),this.chatSocketHandler=e,this.chatChannelSocketHandler=t,Zt(this,uO,r),this.chat=new cO(e,t,r,n,i),this.self=n,this.setupEvents(s)}get roomJoined(){var e;return!0===(null==(e=Yt(this,dO,lO))?void 0:e.roomJoined)}static init(e,t,r,n,i,s=!1){return tr(this,null,(function*(){const o=ww(r.config.viewType,i)?"socket-service":"room-node";return BS.info(`Using socket server :: ${o} for chat`),new fO(e,t,o,r,n,s)}))}static formatMessage(e){return zt($t({},e),{time:new Date(e.time),type:ZD[e.type]})}static formatSocketServiceMessage(e){const t=1e3*e.createdAt,r={displayName:e.displayName,id:e.chatId,time:t,timeMs:e.createdAtMs,type:e.payloadType,isEdited:e.isEdited,userId:e.userId,targetUserIds:e.targetUserIds,channelId:e.channelId,channelIndex:e.channelIndex,message:"",link:"",name:"",html:"",images:[],videos:[],files:[],size:0,pinned:e.pinned};switch(r.type){case JD.TEXT:r.message=e.payload;break;case JD.IMAGE:r.link=e.payload;break;case JD.FILE:{const{link:t,name:n,size:i}=JSON.parse(e.payload);r.link=t,r.name=n,r.size=i;break}case JD.CUSTOM:{const{html:t,images:n,message:i,videos:s,files:o}=JSON.parse(e.payload);r.message=i,r.html=t,r.images=n,r.videos=s,r.files=o;break}}return fO.formatMessage(r)}getChatMessages(){return tr(this,null,(function*(){if("LIVESTREAM"===this.self.config.viewType||"CHAT"===this.self.config.viewType||In.hasFeature(DS.FEAT_PAGINATED_CHAT))return;if("socket-service"===Yt(this,uO)){const e=yield this.chatSocketHandler.getChatMessages();if(null==e||!e.payload)return;const t=EE.fromBinary(e.payload).messages;return void(this.chat.messages=t.map((e=>fO.formatSocketServiceMessage(e))))}if(!this.roomJoined)return void BS.error("ChatController.getChatMessages.RoomNodeClientSocketUsed_WithoutRoomJoin");const{messages:e}=(yield Yt(this,dO,lO).getChatMessages()).payload;this.chat.messages=e.filter((e=>"poll"!==ZD[e.type])).map(fO.formatMessage)}))}getAllChannels(){return tr(this,null,(function*(){"CHAT"===this.self.config.viewType&&(this.chat.channels=yield this.chatSocketHandler.getAllChannels(),this.chat.emit("channelUpdate"))}))}setupEvents(e=!1){"socket-service"===Yt(this,uO)?tT.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>tr(this,null,(function*(){this.getChatMessages(),yield this.getAllChannels()})))):tT.onAsync(XS.ROOM_JOINED,(()=>tr(this,null,(function*(){const t=this.getChatMessages();e||(yield t)})))),this.chatSocketHandler.on(Kw.sendMessageToRoom,(e=>{const t=fO.formatSocketServiceMessage(e.message);if(t.channelId){const e=this.chat.channels.find((e=>e.id===t.channelId));e&&(e.latestMessage=t,e.unreadCount+=1,this.chat.emit("channelMessageUpdate",e))}else this.chat.messages=[...this.chat.messages,t];this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})})),this.chatSocketHandler.on(Kw.sendMessageToPeers,(e=>{const t=fO.formatSocketServiceMessage(e.message);this.chat.messages=[...this.chat.messages,t],this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})})),this.chatSocketHandler.on(Kw.editMessage,(e=>{const t=fO.formatSocketServiceMessage(e.message);if(t.channelId)return void this.chat.emit("chatUpdate",{action:"edit",message:t,messages:this.chat.messages});const r=this.chat.messages.findIndex((e=>e.id===t.id));-1!==r&&(this.chat.messages[r]=t,this.chat.emit("chatUpdate",{action:"edit",message:t,messages:this.chat.messages}))})),this.chatSocketHandler.on(Kw.deleteMessage,(e=>{if(e.channelId)return void this.chat.emit("chatUpdate",{action:"delete",message:{id:e.chatId,channelId:e.channelId},messages:this.chat.messages});const t=this.chat.messages.findIndex((t=>t.id===e.chatId));if(-1===t)return;const[r]=this.chat.messages.splice(t,1);this.chat.emit("chatUpdate",{action:"delete",message:r,messages:this.chat.messages})})),this.chatChannelSocketHandler.on(Xw.createChatChannel,(e=>{const[t]=e.chatChannels,r=WD.formatChannel(t);this.chat.channels.push(r),this.chat.emit("channelCreate",r)})),this.chatSocketHandler.on(Kw.pinMessage,(e=>{const t=this.chat.messages.findIndex((t=>t.id===e.chatId));if(-1===t)return;const r=this.chat.messages[t];r.pinned=e.pinned,this.chat.messages[t]=r,this.chat.emit("chatUpdate",{action:"edit",message:r,messages:this.chat.messages})})),this.chatChannelSocketHandler.on(Xw.updateChatChannel,(e=>{const[t]=e.chatChannels,r=WD.formatChannel(t);this.chat.channels=this.chat.channels.map((e=>e.id===r.id?r:e)),this.chat.emit("channelUpdate",r)})),tT.on(XS.NEW_CHAT_MESSAGE,(e=>{if("poll"===ZD[null==e?void 0:e.type])return;const t=fO.formatMessage(e);this.chat.messages=[...this.chat.messages,t],this.chat.emit("chatUpdate",{action:"add",message:t,messages:this.chat.messages})})),tT.on(XS.PIN_CHAT_MESSAGE,(e=>tr(this,null,(function*(){const t=fO.formatMessage(e),r=this.chat.messages.findIndex((e=>e.id===t.id));this.chat.messages[r]=t,this.chat.emit("pinMessage",{message:t,messages:this.chat.messages})})))),tT.on(XS.UNPIN_CHAT_MESSAGE,(e=>tr(this,null,(function*(){const t=fO.formatMessage(e),r=this.chat.messages.findIndex((e=>e.id===t.id));this.chat.messages[r]=t,this.chat.emit("unpinMessage",{message:t,messages:this.chat.messages})}))))}},dO=new WeakSet,lO=function(){return _C()},uO=new WeakMap,hO);let gO=fO;((e,t,r,n)=>{for(var i,s=mO(t,r),o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(t,r,s)||s);s&&pO(t,r,s)})([VS.trace("ChatController.setupEvents")],gO.prototype,"setupEvents");var vO,yO,_O,SO,TO,EO,bO=Object.defineProperty,wO=Object.getOwnPropertyDescriptor,kO=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?wO(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&bO(t,r,s),s};const RO=(EO=class{constructor(e,t,r,n){Xt(this,SO),Kt(this,"plugins"),Xt(this,vO,void 0),Xt(this,yO,void 0),Xt(this,_O,void 0),Zt(this,vO,e),Zt(this,_O,t),Zt(this,yO,r),this.plugins=n,this.setupEvents()}get roomJoined(){var e;return!0===(null==(e=Yt(this,SO,TO))?void 0:e.roomJoined)}static init(e,t,r,n,i,s,o){return tr(this,null,(function*(){const a=Rw(i.config.viewType,o)?"socket-service":"room-node";BS.info(`Using socket server ${a} for plugin`);const c=new LD;return e.forEach((e=>{const r=new ND(e,t,a,i,s,n);c.all.add(r)})),!1===i.config.isV2&&i.config.setDisabledPlugins(c.all.toArray().map((e=>e.id))),new RO(t,r,a,c)}))}getRoomPlugins(){return tr(this,null,(function*(){if("socket-service"===Yt(this,yO)){const{plugins:e}=yield Yt(this,vO).getActivePlugins();return void(yield Promise.all(e.map((e=>this.enablePlugin({id:e.pluginId,enabledBy:e.enabledBy})))))}if(!this.roomJoined)return void BS.error("PluginController.getRoomPlugins.RoomNodeClientSocketUsed_WithoutRoomJoin");const{payload:e}=yield Yt(this,SO,TO).getRoomState();yield Promise.all(e.roomState.plugins.map((e=>this.enablePlugin(e))))}))}enablePlugin(e){return tr(this,arguments,(function*({id:e,enabledBy:t}){const r=this.plugins.all.get(e);r&&(yield r.activateForSelf(),r.enabledBy=t)}))}disablePlugin(e){return tr(this,arguments,(function*({id:e}){const t=this.plugins.all.get(e);t&&t.deactivateForSelf()}))}sendIframeEventOld(e,t){const{id:r}=t,n=this.plugins.all.get(r);n&&n.sendIframeEvent({type:e,payload:t})}sendIframeEvent(e,t,r,n){const i=this.plugins.all.get(t);t&&i.sendIframeEvent({type:e,uuid:r,payload:n})}broadcastIframeEventOld(e,t){this.plugins.active.forEach((r=>{this.sendIframeEventOld(e,zt($t({},t),{id:r.id}))}))}broadcastIframeEvent(e,t){this.plugins.active.forEach((r=>{this.sendIframeEvent(e,r.id,"",t)}))}setupEvents(){if(this.plugins.all.on("stateUpdate",(({active:e,id:t})=>{e?this.plugins.active.add(this.plugins.all.get(t)):this.plugins.active.delete(t)})),tT.onAsync(XS.ROOM_JOINED,(()=>tr(this,null,(function*(){yield this.getRoomPlugins(),BS.debug("[ROOM_JOINED] resolved request to fetch plugins.")})))),"socket-service"===Yt(this,yO))return Yt(this,vO).on(Qw.addPlugin,(e=>tr(this,null,(function*(){var t;const r=e.pluginId;null!=(t=this.plugins.all.get(r))&&t.active||(yield this.enablePlugin({id:r,enabledBy:e.enabledBy}))})))),Yt(this,vO).on(Qw.removePlugin,(e=>tr(this,null,(function*(){var t;const r=e.pluginId;null!=(t=this.plugins.all.get(r))&&t.active&&(yield this.disablePlugin({id:r}))})))),[Qw.enablePluginForPeers,Qw.enablePluginForRoom].forEach((e=>{Yt(this,vO).on(e,((t,r)=>tr(this,null,(function*(){this.sendIframeEvent(e,t.pluginId,r,{enabledBy:t.enabledBy})}))))})),[Qw.disablePluginForPeers,Qw.disablePluginForRoom].forEach((e=>{Yt(this,vO).on(e,((t,r)=>tr(this,null,(function*(){this.sendIframeEvent(e,t.pluginId,r,{disabledBy:t.disabledBy})}))))})),[Qw.customPluginEventToPeers,Qw.customPluginEventToRoom].forEach((e=>{Yt(this,vO).on(e,((t,r)=>tr(this,null,(function*(){this.sendIframeEvent(e,t.pluginId,r,{data:JSON.parse((new TextDecoder).decode(t.pluginData))})}))))})),[Qw.storeInsertKeys,Qw.storeGetKeys,Qw.storeDeleteKeys].forEach((e=>{Yt(this,vO).on(e,((t,r)=>tr(this,null,(function*(){var n;const i=null==(n=t.storeItems)?void 0:n.map((e=>{var t;return{timestamp:e.timestamp,peerId:e.peerId,payload:JSON.parse(null!=(t=e.payload)&&t.length?(new TextDecoder).decode(e.payload):"{}"),key:e.storeKey}}));this.sendIframeEvent(e,t.pluginId,r,{storeName:t.storeName,storeItems:i})}))))})),Yt(this,vO).on(Qw.storeDelete,((e,t)=>tr(this,null,(function*(){this.sendIframeEvent(Qw.storeDelete,e.pluginId,t,{storeName:e.storeName})})))),Yt(this,_O).on(Kw.sendMessageToPeers,(e=>{const t=null==gO?void 0:gO.formatSocketServiceMessage(e.message);this.broadcastIframeEvent(bD,{message:t})})),Yt(this,_O).on(Kw.sendMessageToRoom,(e=>{const t=null==gO?void 0:gO.formatSocketServiceMessage(e.message);this.broadcastIframeEvent(bD,{message:t})})),tT.on(XS.PEER_JOINED,(e=>{this.broadcastIframeEvent(22,e)})),tT.on(XS.PEER_CLOSED,(e=>{this.broadcastIframeEvent(23,e)})),tT.on(XS.SET_STAGE_STATUS,(e=>tr(this,null,(function*(){this.broadcastIframeEvent(25,e)})))),tT.on(XS.SET_WEBINAR_STAGE_STATUS,(e=>{this.broadcastIframeEvent(25,e)})),void tT.on(XS.UPDATE_PEER_STAGE_STATUS,(e=>{this.broadcastIframeEvent(26,e)}));tT.on(XS.ENABLE_PLUGIN,(e=>tr(this,[e],(function*({id:e,enabledBy:t}){yield this.enablePlugin({id:e,enabledBy:t})})))),tT.on(XS.DISABLE_PLUGIN,(e=>tr(this,[e],(function*({id:e}){yield this.disablePlugin({id:e})})))),[XS.PLUGIN_DATA,XS.PLUGIN_EVENT].forEach((e=>{tT.on(e,(t=>{this.sendIframeEventOld(e,t)}))})),[XS.PEER_JOINED,XS.PEER_CLOSED,XS.NEW_CHAT_MESSAGE].forEach((e=>{tT.on(e,(t=>{this.broadcastIframeEventOld(e,t)}))}))}},vO=new WeakMap,yO=new WeakMap,_O=new WeakMap,SO=new WeakSet,TO=function(){return _C()},EO);let CO=RO;kO([VS.trace("PluginController.getRoomPlugins")],CO.prototype,"getRoomPlugins",1),kO([VS.trace("PluginController.enableForSelf")],CO.prototype,"enablePlugin",1),kO([VS.trace("PluginController.disableForSelf")],CO.prototype,"disablePlugin",1),kO([VS.trace("PluginController.setupEvents")],CO.prototype,"setupEvents",1);var IO,AO,PO,DO,OO,MO;Object.defineProperty,Object.getOwnPropertyDescriptor;let NO=(MO=class extends WS{constructor(e,t,r){super(),Xt(this,IO),Kt(this,"items"),Xt(this,PO,void 0),Xt(this,DO,void 0),Xt(this,OO,void 0),Zt(this,PO,e),Zt(this,DO,t),Zt(this,OO,r),this.items=[]}get roomJoined(){var e;return!0===(null==(e=Yt(this,IO,AO))?void 0:e.roomJoined)}create(e,t,r=!1,n=!1){return tr(this,null,(function*(){if("LIVESTREAM"!==Yt(this,PO).config.viewType&&!this.roomJoined)throw new $S("Can't create polls without joining room");if(!Yt(this,PO).permissions.polls.canCreate)return void BS.error("DytePolls::create::permission_denied");if(!e||!t)return void BS.error("DytePolls::question_and_options_can_not_be_empty",{dytePolls:{hasQuestion:!!e,optionsLength:null==t?void 0:t.length}});if(t.length<2)return void BS.error("DytePolls::there_must_be_at_least_two_options",{dytePolls:{hasQuestion:!!e,optionsLength:t.length}});if("socket-service"===Yt(this,OO))return void(yield Yt(this,DO).createPoll(e,t,r,n));const i={question:e,options:t,anonymous:r,hideVotes:n,createdBy:Yt(this,PO).name,createdByUserId:Yt(this,PO).userId};yield Yt(this,IO,AO).newPoll(i)}))}vote(e,t){return tr(this,null,(function*(){if(!Yt(this,PO).permissions.polls.canVote)return void BS.error("DytePolls::vote::permission_denied");if("socket-service"===Yt(this,OO))return void(yield Yt(this,DO).votePoll(e,t));const r={pollId:e,index:t};yield Yt(this,IO,AO).votePoll(r)}))}},IO=new WeakSet,AO=function(){return _C()},PO=new WeakMap,DO=new WeakMap,OO=new WeakMap,MO);NO=((e,t,r,n)=>{for(var i,s=t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(s)||s);return s})([KS((e=>{throw new $S(e.message,"0700")}))],NO);var xO,LO,UO,jO,FO,VO,BO=Object.defineProperty,HO=Object.getOwnPropertyDescriptor;const WO=(VO=class{constructor(e,t,r){Xt(this,jO),Kt(this,"polls"),Xt(this,xO,void 0),Xt(this,LO,void 0),Xt(this,UO,void 0),this.polls=new NO(e,t,r),Zt(this,xO,e),Zt(this,LO,t),Zt(this,UO,r),this.setupEvents()}static init(e,t,r){return tr(this,null,(function*(){const n=kw(e.config.viewType,r)?"socket-service":"room-node";return BS.info(`Using socket server ${n} for polls`),new WO(e,t,n)}))}canViewPolls(){return Yt(this,xO).permissions.polls.canView}setupEvents(){if(tT.on(XS.UPDATE_PERMISSIONS,(e=>{var t;null!=(t=e.polls)&&t.canView&&this.getPolls()})),"socket-service"===Yt(this,UO)){if(!this.canViewPolls())return;tT.on(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>{this.getPolls()})),Yt(this,LO).on(Yw.createPoll,(e=>{e.poll&&this.updatePoll(WO.formatSocketServicePoll(e.poll))})),Yt(this,LO).on(Yw.updatePoll,(e=>{e.poll&&this.updatePoll(WO.formatSocketServicePoll(e.poll))})),Yt(this,LO).on(Yw.votePoll,(e=>{e.poll&&this.updatePoll(WO.formatSocketServicePoll(e.poll))}))}else tT.onAsync(XS.ROOM_JOINED,(()=>tr(this,null,(function*(){this.canViewPolls()&&this.getPolls()}))));tT.on(XS.UPDATE_POLL,(e=>tr(this,[e],(function*({poll:e}){this.updatePoll(e)}))))}updatePoll(e){if(!this.canViewPolls())return;const t=this.polls.items.findIndex((t=>t.id===e.id));if(t>-1){const r=JSON.stringify(this.polls.items[t]);return this.polls.items[t]=e,void(r!==JSON.stringify(e)&&this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!1}))}this.polls.items=[...this.polls.items,e],this.polls.emit("pollsUpdate",{polls:this.polls.items,newPoll:!0})}getPolls(){return tr(this,null,(function*(){if("socket-service"!==Yt(this,UO)){if(Yt(this,jO,FO)instanceof fC){const{polls:e}=(yield Yt(this,jO,FO).getPolls()).payload;this.polls.items=Object.values(e)}}else{const e=yield Yt(this,LO).getPolls();if(null==e||!e.payload)return;const{polls:t}=hw.fromBinary(e.payload);this.polls.items=t.map((e=>WO.formatSocketServicePoll(e)))}}))}static formatSocketServicePoll(e){const t=e.options.map((e=>({count:e.count,text:e.text,votes:e.votes.map((e=>({id:e.userId,name:e.name})))})));return{anonymous:e.anonymous,createdBy:e.createdBy,createdByUserId:e.createdByUserId,hideVotes:e.hideVotes,id:e.pollId,options:t,question:e.question,voted:e.votes}}},xO=new WeakMap,LO=new WeakMap,UO=new WeakMap,jO=new WeakSet,FO=function(){return _C()},VO);let GO=WO;((e,t,r,n)=>{for(var i,s=HO(t,r),o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(t,r,s)||s);s&&BO(t,r,s)})([VS.trace("PollController.setupEvents")],GO.prototype,"setupEvents");class qO extends aP{constructor(){super({onAddEvent:"remoteRequestAdd",onDeleteEvent:"remoteRequestRemove"})}add(e,t=!0){return super.add(e,t)}delete(e,t=!0,r=!1){return super.delete(e,t,r)}}var $O,zO,JO,KO;const QO=class extends WS{constructor(e,t){super(),Xt(this,$O),Kt(this,"incomingRequests"),Kt(this,"outgoingRequests"),Kt(this,"active"),Xt(this,JO,void 0),Xt(this,KO,void 0),Zt(this,KO,t),Zt(this,JO,e),this.incomingRequests=new qO,this.outgoingRequests=new qO,this.active=null,this.mouseEvent=this.mouseEvent.bind(this),this.keyboardEvent=this.keyboardEvent.bind(this)}requestControl(e){return tr(this,null,(function*(){var t;if(!Yt(this,KO).joined.get(e))throw new $S("Invalid peer.");const r=null==(t=this.outgoingRequests)?void 0:t.toArray().find((t=>t.hostPeerId===e));if(r)return r.id;const n=u(),i=new nC({requestId:n,hostPeerId:e,remotePeerId:Yt(this,JO).id,state:ZR.PENDING});return this.outgoingRequests.add(i),yield Yt(this,$O,zO).requestRemoteControl(i),this.emit("remoteUpdate",{payload:{request:{id:i.id,hostPeerId:i.hostPeerId,remotePeerId:i.remotePeerId}},type:rC.REQUEST_SENT}),n}))}acceptControl(e){return tr(this,null,(function*(){var t;if((null==(t=this.active)?void 0:t.id)===e)return;const r=this.incomingRequests.get(e);if(!r)throw new $S("No request found.");r.state=ZR.ACCEPTED,this.endControl(),this.active=r,Yt(this,$O,zO).acceptRemoteControl(r),this.emit("remoteUpdate",{payload:{request:{id:this.active.id,hostPeerId:this.active.hostPeerId,remotePeerId:this.active.remotePeerId}},type:rC.INCOMING_REQUEST_ACCEPTED})}))}endControl(){return tr(this,null,(function*(){if(!this.active)return;const e=$t({},this.active);Yt(this,$O,zO).terminateRemoteControl(this.active.hostPeerId===Yt(this,JO).id?this.active.remotePeerId:this.active.hostPeerId,this.active),this.active=null,this.emit("remoteUpdate",{payload:{request:{id:e.id,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:e.hostPeerId===Yt(this,JO).id?rC.INCOMING_REQUEST_ENDED:rC.OUTGOING_REQUEST_ENDED})}))}keyboardEvent(e){return tr(this,null,(function*(){if(!this.active)return;const t=QO.getFormattedKeyboardEvent(e);if(t){const e={eventType:eC.KEYBOARD,keyboardEvent:t};Yt(this,$O,zO).sendEventRemoteControl(this.active.hostPeerId,this.active.id,e)}}))}mouseEvent(e,t){return tr(this,null,(function*(){if(!this.active)return;const r=QO.getFormattedRemoteMouseEvent(e,t);if(r){const e={eventType:eC.MOUSE,mouseEvent:r};Yt(this,$O,zO).sendEventRemoteControl(this.active.hostPeerId,this.active.id,e)}}))}static getFormattedRemoteMouseEvent(e,t){const r=t.getBoundingClientRect();return{type:e.type,position:{x:Math.floor(e.x-r.left),y:Math.floor(e.y-r.top)},boundingRect:{width:r.width,height:r.height}}}static getFormattedKeyboardEvent(e){return"keydown"===e.type?{type:e.type,key:e.key}:null}};let YO=QO;var XO,ZO;$O=new WeakSet,zO=function(){return _C()},JO=new WeakMap,KO=new WeakMap;const eM=class{constructor(e,t){Kt(this,"remote"),Kt(this,"hostPeetId"),Kt(this,"remotePeetId"),Kt(this,"remoteRequestTokens"),Kt(this,"activeRemoteToken"),Xt(this,XO,void 0),Xt(this,ZO,void 0),Zt(this,XO,e),Zt(this,ZO,t),this.hostPeetId=e.id,this.remote=new YO(e,t),this.setupEvents()}setupEvents(){tT.on(XS.MESSAGE,(e=>{var t;if(e.remoteRequestType===XR.REQUEST&&(this.remote.incomingRequests.add(new nC({requestId:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,state:ZR.PENDING})),this.remote.emit("remoteUpdate",{payload:{request:{id:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:rC.REQUEST_RECEIVED})),e.remoteRequestType===XR.ACCEPT){const t=this.remote.outgoingRequests.get(e.remoteRequestId);if(!t)throw new $S("There is no pending remote control request to accept.");this.remote.endControl(),t.state=ZR.ACCEPTED,this.remote.active=new nC({requestId:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId,state:ZR.ACCEPTED}),this.remote.emit("remoteUpdate",{payload:{request:{id:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:rC.OUTGOING_REQUEST_ACCEPTED})}e.remoteRequestType===XR.END&&((null==(t=this.remote.active)?void 0:t.id)===e.remoteRequestId&&(this.remote.active=null),this.remote.emit("remoteUpdate",{payload:{request:{id:e.remoteRequestId,hostPeerId:e.hostPeerId,remotePeerId:e.remotePeerId}},type:e.hostPeerId===Yt(this,XO).id?rC.INCOMING_REQUEST_ENDED:rC.OUTGOING_REQUEST_ENDED})),e.remoteRequestType===XR.EVENT&&this.remote.active&&this.remote.active.id===e.remoteRequestId&&window.DyteRobot&&(e.remoteEvent.eventType===eC.MOUSE?eM.executeMouseEvent(e.remoteEvent.mouseEvent):e.remoteEvent.eventType===eC.KEYBOARD&&eM.executeKeyboardEvent(e.remoteEvent.keyboardEvent))})),tT.on(XS.PEER_CLOSED,(({id:e})=>{var t,r,n,i,s,o,a,c;[null==(r=null==(t=this.remote)?void 0:t.active)?void 0:r.hostPeerId,null==(i=null==(n=this.remote)?void 0:n.active)?void 0:i.remotePeerId].includes(e)&&this.remote.endControl(),null==(o=null==(s=this.remote)?void 0:s.incomingRequests)||o.toArray().forEach((t=>{[t.hostPeerId,t.remotePeerId].includes(e)&&this.remote.incomingRequests.delete(t.id)})),null==(c=null==(a=this.remote)?void 0:a.outgoingRequests)||c.toArray().forEach((t=>{[t.hostPeerId,t.remotePeerId].includes(e)&&this.remote.outgoingRequests.delete(t.id)}))}))}static executeMouseEvent(e){const t=window.screen.width*e.position.x/e.boundingRect.width,r=window.screen.height*e.position.y/e.boundingRect.height,n={width:window.screen.width,height:window.screen.height};switch(e.type){case tC.LEFT_CLICK:window.DyteRobot.mouse.leftClick(t,r,n);break;case tC.RIGHT_CLICK:window.DyteRobot.mouse.rightClick(t,r,n);break;case tC.MOVE:window.DyteRobot.mouse.moveTo(t,r,n)}}static executeKeyboardEvent(e){"keydown"===e.type&&window.DyteRobot.keyboard.press(e.key)}};let tM=eM;XO=new WeakMap,ZO=new WeakMap;var rM,nM,iM,sM,oM,aM,cM,dM,lM,uM,hM,pM,mM,fM,gM,vM,yM,_M,SM,TM,EM,bM,wM,kM,RM,CM,IM,AM,PM,DM,OM,MM,NM=Object.defineProperty,xM=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},LM=(e,t,r)=>(xM(e,t,"read from private field"),r?r.call(e):t.get(e)),UM=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},jM=(e,t,r,n)=>(xM(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),FM=(e,t,r)=>(xM(e,t,"access private method"),r),VM={exports:{}},BM="object"==typeof Reflect?Reflect:null,HM=BM&&"function"==typeof BM.apply?BM.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};MM=BM&&"function"==typeof BM.ownKeys?BM.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var WM=Number.isNaN||function(e){return e!=e};function GM(){GM.init.call(this)}VM.exports=GM,VM.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}eN(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&eN(e,"error",t,{once:!0})}(e,i)}))},GM.EventEmitter=GM,GM.prototype._events=void 0,GM.prototype._eventsCount=0,GM.prototype._maxListeners=void 0;var qM=10;function $M(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function zM(e){return void 0===e._maxListeners?GM.defaultMaxListeners:e._maxListeners}function JM(e,t,r,n){var i,s,o;if($M(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=zM(e))>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,function(e){console&&console.warn&&console.warn(e)}(a)}return e}function KM(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function QM(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=KM.bind(n);return i.listener=r,n.wrapFn=i,i}function YM(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):ZM(i,i.length)}function XM(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function ZM(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function eN(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){n.once&&e.removeEventListener(t,i),r(s)}))}}Object.defineProperty(GM,"defaultMaxListeners",{enumerable:!0,get:function(){return qM},set:function(e){if("number"!=typeof e||e<0||WM(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");qM=e}}),GM.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},GM.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||WM(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},GM.prototype.getMaxListeners=function(){return zM(this)},GM.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)HM(a,this,t);else{var c=a.length,d=ZM(a,c);for(r=0;r<c;++r)HM(d[r],this,t)}return!0},GM.prototype.addListener=function(e,t){return JM(this,e,t,!1)},GM.prototype.on=GM.prototype.addListener,GM.prototype.prependListener=function(e,t){return JM(this,e,t,!0)},GM.prototype.once=function(e,t){return $M(t),this.on(e,QM(this,e,t)),this},GM.prototype.prependOnceListener=function(e,t){return $M(t),this.prependListener(e,QM(this,e,t)),this},GM.prototype.removeListener=function(e,t){var r,n,i,s,o;if($M(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},GM.prototype.off=GM.prototype.removeListener,GM.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},GM.prototype.listeners=function(e){return YM(this,e,!0)},GM.prototype.rawListeners=function(e){return YM(this,e,!1)},GM.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):XM.call(e,t)},GM.prototype.listenerCount=XM,GM.prototype.eventNames=function(){return this._eventsCount>0?MM(this._events):[]};var tN=VM.exports;const rN=new class extends me{constructor(){super("message.v1.SocketMessage",[{no:1,name:"event",kind:"scalar",T:13},{no:2,name:"id",kind:"scalar",opt:!0,T:9},{no:3,name:"payload",kind:"scalar",opt:!0,T:12},{no:4,name:"metadata",kind:"scalar",opt:!0,T:12}])}};class nN{static encode(e){return rN.toBinary(e)}static decode(e){return rN.fromBinary(new Uint8Array(e))}}class iN{constructor(e={}){((e,t,r)=>{((e,t,r)=>{t in e?NM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r)})(this,"opts"),UM(this,rM,void 0),this.opts={initialTimeout:e.initialTimeout||1e3,maxTimeout:e.maxTimeout||1e4,factor:e.factor||2},jM(this,rM,0)}wait(){return tr(this,null,(function*(){jM(this,rM,LM(this,rM)+1);const e=function(e,t){return Math.floor(Math.random()*(t-0+1)+0)}(0,Math.min(this.opts.maxTimeout,this.opts.initialTimeout*Gt(2,LM(this,rM))));yield new Promise((t=>{setTimeout(t,e)}))}))}getAttempts(){return LM(this,rM)}reset(){jM(this,rM,0)}}rM=new WeakMap;const sN={debug:0,info:1,warn:2,error:3};class oN{constructor(e){UM(this,nM,void 0),UM(this,iM,void 0),jM(this,nM,console),jM(this,iM,e)}debug(...e){sN[LM(this,iM)]>sN.debug||LM(this,nM).debug("[Sockrates]:",...e)}info(...e){sN[LM(this,iM)]>sN.info||LM(this,nM).info("[Sockrates]:",...e)}warn(...e){sN[LM(this,iM)]>sN.warn||LM(this,nM).warn("[Sockrates]:",...e)}error(...e){sN[LM(this,iM)]>sN.error||LM(this,nM).error("[Sockrates]:",...e)}}nM=new WeakMap,iM=new WeakMap;var aN=(e=>(e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED",e))(aN||{});class cN{constructor(e,t){var r,n,i,s,o,a,c,d,l,u;UM(this,fM),UM(this,vM),UM(this,_M),UM(this,TM),UM(this,bM),UM(this,kM),UM(this,CM),UM(this,AM),UM(this,DM),UM(this,sM,void 0),UM(this,oM,void 0),UM(this,aM,void 0),UM(this,cM,void 0),UM(this,dM,void 0),UM(this,lM,void 0),UM(this,uM,void 0),UM(this,hM,void 0),UM(this,pM,void 0),UM(this,mM,void 0),jM(this,oM,e),jM(this,dM,[]),jM(this,lM,new tN),jM(this,uM,!0),jM(this,hM,!1),jM(this,aM,null!=t?t:{}),null!=(r=LM(this,aM)).autoReconnect||(r.autoReconnect=!0),null!=(n=LM(this,aM)).retryConnectionInterval||(n.retryConnectionInterval=1e3),null!=(i=LM(this,aM)).pingTimeout||(i.pingTimeout=3e4),null!=(s=LM(this,aM)).connectionTimeout||(s.connectionTimeout=5e3),null!=(o=LM(this,aM)).debug||(o.debug=!0),null!=(a=LM(this,aM)).maxReconnectionAttempts||(a.maxReconnectionAttempts=10),null!=(c=LM(this,aM)).disconnectOnPingTimeout||(c.disconnectOnPingTimeout=!0),null!=(d=LM(this,aM)).queueOnDisconnect||(d.queueOnDisconnect=!1),null!=(l=LM(this,aM)).flushOnReconnect||(l.flushOnReconnect=!1),jM(this,cM,null!=(u=LM(this,aM).logger)?u:new oN(LM(this,aM).debug?"debug":"info")),jM(this,mM,new iN)}get readyState(){var e;return null==(e=LM(this,sM))?void 0:e.readyState}get url(){return LM(this,oM)}get config(){return LM(this,aM)}get sendQueue(){return LM(this,dM)}flush(){if(!LM(this,aM).queueOnDisconnect)return!1;const e=[];return LM(this,dM).forEach((t=>{this.send(t.event,t.id,t.payload,t.metadata)||e.push(t)})),jM(this,dM,e),LM(this,dM)}connect(e=!1){return tr(this,null,(function*(){if(e||![0,1].includes(this.readyState))return!1!==LM(this,uM)?new Promise(((e,t)=>{FM(this,AM,PM).call(this),FM(this,DM,OM).call(this);try{jM(this,sM,new WebSocket(FM(this,fM,gM).call(this,LM(this,oM)))),LM(this,sM).binaryType="arraybuffer",LM(this,cM).debug("Connecting to",LM(this,oM));const r=setTimeout((()=>{LM(this,cM).debug("Connection timeout. Closing socket"),jM(this,uM,!0),FM(this,DM,OM).call(this),LM(this,sM).close(3001,"Connection Timeout"),LM(this,aM).autoReconnect&&!LM(this,hM)&&(LM(this,lM).emit("reconnecting"),FM(this,bM,wM).call(this)),t(new Error("Connection timed out!"))}),LM(this,aM).connectionTimeout);LM(this,sM).onopen=()=>{LM(this,cM).debug(`Ready State: ${aN[LM(this,sM).readyState]}`),r&&clearTimeout(r),FM(this,CM,IM).call(this),LM(this,lM).emit("connected"),LM(this,aM).flushOnReconnect&&this.flush(),e()},LM(this,sM).onclose=e=>{try{r&&clearTimeout(r);const{code:n,reason:i}=e;if(t(i),LM(this,cM).debug("Socket closed. Close event:",e),LM(this,cM).debug("Connection closed code:",n),LM(this,cM).debug("Connection closed reason:",i),LM(this,hM)||LM(this,lM).emit("disconnected",{code:n,reason:i}),LM(this,uM)&&1e3!==n&&LM(this,aM).autoReconnect&&!LM(this,hM))return LM(this,lM).emit("reconnecting"),void FM(this,bM,wM).call(this)}catch(e){FM(this,vM,yM).call(this,e)}},LM(this,sM).onerror=e=>{FM(this,vM,yM).call(this,e)},LM(this,sM).onmessage=e=>FM(this,_M,SM).call(this,e)}catch(e){FM(this,vM,yM).call(this,e,t)}})):void 0;LM(this,cM).debug("Websocket was already connecting or connected.")}))}send(e,t,r,n){const i={event:e,id:t,payload:r,metadata:n};if(LM(this,aM).queueOnDisconnect&&(!LM(this,sM)||1!==LM(this,sM).readyState))return LM(this,cM).debug("Queuing message since socket is not connected!",i),LM(this,dM).push(i),!1;const s=nN.encode(i);return FM(this,kM,RM).call(this,s)}emit(e,t,r,n){return this.send(e,t,r,n)}sendRaw(e){return FM(this,kM,RM).call(this,e)}receive(e,t){return LM(this,lM).on(e.toString(),t)}on(e,t){"string"!=typeof e||"connected"!==e&&"disconnected"!==e&&"errored"!==e&&"reconnected"!==e&&"reconnecting"!==e&&"reconnectAttempt"!==e&&"reconnectFailure"!==e&&"failed"!==e?this.receive(e,t):LM(this,lM).on(e,t)}removeAllListeners(){LM(this,lM).removeAllListeners()}removeReceiver(e,t){this.removeListener(e,t)}removeListener(e,t){LM(this,lM).removeListener(e.toString(),t)}removeReceivers(e){this.removeListeners(e)}removeListeners(e){LM(this,lM).listeners(e.toString()).map((t=>this.removeListener(e,t)))}disconnect(){jM(this,uM,!1),FM(this,AM,PM).call(this),this.removeAllListeners(),LM(this,sM).close(1e3,"Sockrates disconnect method called.")}}sM=new WeakMap,oM=new WeakMap,aM=new WeakMap,cM=new WeakMap,dM=new WeakMap,lM=new WeakMap,uM=new WeakMap,hM=new WeakMap,pM=new WeakMap,mM=new WeakMap,fM=new WeakSet,gM=function(e){if(e.startsWith("ws://")||e.startsWith("wss://"))return e;if(e.startsWith("https://"))return`wss://${e.substring(8)}`;if(e.startsWith("http://"))return`ws://${e.substring(7)}`;throw new Error("Invalid URL. URL must start with http(s):// or ws(s)://.")},vM=new WeakSet,yM=function(e,t){LM(this,cM).error("Error:",e),LM(this,lM).emit("errored",{error:e}),null==t||t(e)},_M=new WeakSet,SM=function(e){if("2"===e.data)return LM(this,cM).debug("Received ping from server"),FM(this,CM,IM).call(this),void FM(this,kM,RM).call(this,"3");LM(this,cM).debug("Received data:",e.data);const t=nN.decode(e.data),{id:r,payload:n}=t;LM(this,lM).emit(t.event.toString(),{id:r,payload:n})},TM=new WeakSet,EM=function(){return 1===LM(this,sM).readyState},bM=new WeakSet,wM=function(e=!0){return tr(this,null,(function*(){if(e&&LM(this,hM))LM(this,cM).debug("Reconnect called when already in a reconnect loop. Ignoring.");else{if(LM(this,hM)||LM(this,mM).reset(),null!==LM(this,aM).maxReconnectionAttempts&&LM(this,mM).getAttempts()>=LM(this,aM).maxReconnectionAttempts)return LM(this,lM).emit("failed"),void jM(this,hM,!1);jM(this,hM,!0),FM(this,DM,OM).call(this),FM(this,AM,PM).call(this);try{if(yield LM(this,mM).wait(),!1===LM(this,uM))return;if(LM(this,cM).debug(`Reconnection attempt ${LM(this,mM).getAttempts()}`),LM(this,lM).emit("reconnectAttempt",{attempt:LM(this,mM).getAttempts()}),yield this.connect(),!FM(this,TM,EM).call(this))throw Error("Reconnect Failed");jM(this,hM,!1),LM(this,lM).emit("reconnected")}catch(e){LM(this,cM).debug("Failed to reconnect."),LM(this,lM).emit("reconnectFailure",{attempt:LM(this,mM).getAttempts()}),FM(this,bM,wM).call(this,!1)}}}))},kM=new WeakSet,RM=function(e){try{return LM(this,sM).send(e),!0}catch(e){return LM(this,cM).error(e.message),!1}},CM=new WeakSet,IM=function(){this.config.disconnectOnPingTimeout&&(LM(this,cM).debug("Resetting ping timeout"),FM(this,AM,PM).call(this),jM(this,pM,setTimeout((()=>{var e;LM(this,cM).debug("Disconnecting the socket due to ping timeout"),jM(this,uM,!0);const t="Ping timeout";null==(e=LM(this,sM))||e.close(3002,t),LM(this,lM).emit("disconnected",{code:3002,reason:t}),LM(this,aM).autoReconnect&&!LM(this,hM)&&(LM(this,cM).debug("Triggering reconnection due to ping timeout"),LM(this,lM).emit("reconnecting"),FM(this,bM,wM).call(this))}),LM(this,aM).pingTimeout)))},AM=new WeakSet,PM=function(){LM(this,pM)&&(clearTimeout(LM(this,pM)),jM(this,pM,void 0))},DM=new WeakSet,OM=function(){LM(this,sM)&&(LM(this,sM).onopen=void 0,LM(this,sM).onerror=void 0,LM(this,sM).onmessage=void 0,LM(this,sM).onclose=void 0)};var dN,lN,uN,hN,pN,mN,fN=Object.defineProperty,gN=Object.getOwnPropertyDescriptor,vN=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?gN(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&fN(t,r,s),s};const yN=(mN=class{constructor({peerId:e,roomName:t,authToken:r,capabilities:n}){var i;if(Xt(this,hN),Xt(this,dN,void 0),Xt(this,lN,void 0),Xt(this,uN,void 0),Kt(this,"roomName"),Kt(this,"peerId"),Kt(this,"authToken"),Kt(this,"capabilities"),!e||!t||!r)throw new $S("peerId, roomName, or authToken can not be empty");const{apiBase:s,baseURI:o}=td;let a=yN.getSocketEdgeDomain(s,o);"string"==typeof Ew("socket_server_base")&&(a=Ew("socket_server_base"));const c=`wss://${a}`;this.roomName=t,this.peerId=e,this.authToken=r,this.capabilities=n;const d=new URL(`${c}/ws`),l={roomID:t,peerID:e,authToken:r,useMediaV2:n.includes("HIVE"),ping:n.includes("PING"),capabilities:n.map((e=>JE[e])).join(" ")};Object.entries(l).forEach((([e,t])=>{d.searchParams.append(e,t.toString())})),Zt(this,dN,d.href),Zt(this,uN,e),Zt(this,lN,new cN(Yt(this,dN),{autoReconnect:!0,disconnectOnPingTimeout:null!=(i=n.includes("PING"))&&i,queueOnDisconnect:!0,flushOnReconnect:!1,logger:BS}))}static getSocketEdgeDomain(e,t){return sd({servicePrefix:"socket-edge",apiBase:e,baseURI:t})}get url(){return Yt(this,dN)}connect(){return tr(this,null,(function*(){this.onStateEvent("connected",(()=>{BS.info("SocketService::connect::Connected to socket-edge"),tT.emit(XS.SOCKET_SERVICE_CONNECTED)})),this.onStateEvent("disconnected",(({reason:e,code:t})=>{BS.info("SocketService::connect::Disconnected from socket-edge",{error:{code:t,reason:e}}),tT.emit(XS.SOCKET_SERVICE_DISCONNECTED),!(t<4e3||t>4002)&&(4e3===t?BS.error("SocketService::connect::Bad Request",{error:{code:t,reason:e}}):4001===t?BS.error("SocketService::connect::Unauthorized",{error:{code:t,reason:e}}):4002===t?BS.error("SocketService::connect::Internal Error",{error:{code:t,reason:e}}):BS.error("SocketService::connect::Unknown Error",{error:{code:t,reason:e}}))})),this.onStateEvent("reconnecting",(()=>{BS.info("SocketService::connect::Reconnecting to socket-edge"),tT.emit(XS.SOCKET_SERVICE_RECONNECTING)})),this.onStateEvent("reconnectAttempt",(({attempt:e})=>{BS.info("SocketService::connect::Attempting reconnect to socket-edge"),tT.emit(XS.SOCKET_SERVICE_RECONNECTION_ATTEMPT,{attempt:e})})),this.onStateEvent("reconnectFailure",(({attempt:e})=>{BS.info("SocketService::connect::Reconnect attempt failed"),tT.emit(XS.SOCKET_SERVICE_RECONNECT_FAILURE,{attempt:e})})),this.onStateEvent("reconnected",(()=>{BS.info("SocketService::connect::Reconnected to socket-edge"),tT.emit(XS.SOCKET_SERVICE_RECONNECTED)})),this.onStateEvent("failed",(()=>{BS.info("SocketService::connect::Socket-edge reconnects failed"),tT.emit(XS.SOCKET_SERVICE_FAILED)})),yield Yt(this,lN).connect()}))}disconnect(){return Yt(this,lN).disconnect()}get isConnected(){try{return 1===Yt(this,lN).readyState}catch(e){return!1}}sendMessage(e,t,r){const n={};return VS.injectContext(n),Yt(this,lN).send(e,null!=r?r:er(this,hN,pN).call(this),t,(new TextEncoder).encode(JSON.stringify(n)))}sendMessagePromise(e,t,r){const n=parseInt({}.SOCKET_SERVICE_MESSAGE_REQUEST_TIMEOUT,10)||2e4;return this.sendMessagePromiseWithTimeout({event:e,timeout:n,protobuf:t,messageId:r})}sendMessagePromiseWithTimeout({event:e,timeout:t,protobuf:r,messageId:n}){return new Promise(((i,s)=>{const o=(t,r)=>{Yt(this,lN).removeListener(e,t),Yt(this,lN).removeListener(65535,r),Yt(this,lN).removeListener(Zw.errorResponse,r)},a=null!=n?n:er(this,hN,pN).call(this),c={};VS.injectContext(c);const d=({id:e,payload:t})=>{if(a===e){let e;try{const r=UT.fromBinary(t);e=new Error(r.errorMessage)}catch(r){e=new Error("failed to parse error message",{cause:r});try{const r=oE.fromBinary(t);e=new Error(r.message)}catch(t){e=new Error("failed to parse error message",{cause:t})}}s(e),o(l,d)}},l=({id:e,payload:t})=>{a===e&&(i({id:e,payload:t}),o(l,d))};Yt(this,lN).on(e,l),Yt(this,lN).on(65535,d),Yt(this,lN).on(Zw.errorResponse,d),setTimeout((()=>{o(l,d),s(new Error("request timeout for callback"))}),t),Yt(this,lN).send(e,a,r,(new TextEncoder).encode(JSON.stringify(c)))}))}on(e,t){Yt(this,lN).on(e,t)}onStateEvent(e,t){Yt(this,lN).on(e,t)}flush(){return Yt(this,lN).flush()}},dN=new WeakMap,lN=new WeakMap,uN=new WeakMap,hN=new WeakSet,pN=function(){return`${Yt(this,uN)}-${(Math.random()+1).toString(36).substring(7)}`},mN);let _N=yN;var SN;vN([VS.trace("SocketService.connect")],_N.prototype,"connect",1),vN([VS.trace("SocketService.disconnect")],_N.prototype,"disconnect",1),vN([VS.trace("SocketService.sendMessagePromise")],_N.prototype,"sendMessagePromise",1),vN([VS.trace("SocketService.sendMessagePromiseWithTimeout")],_N.prototype,"sendMessagePromiseWithTimeout",1);class TN{constructor(e){Xt(this,SN,void 0),Zt(this,SN,e)}addPlugin(e,t){Yt(this,SN).sendMessage(Qw.addPlugin,Nb.toBinary({pluginId:e,staggered:t}))}removePlugin(e){Yt(this,SN).sendMessage(Qw.removePlugin,xb.toBinary({pluginId:e,staggered:!1}))}getActivePlugins(){return tr(this,null,(function*(){const{payload:e}=yield Yt(this,SN).sendMessagePromise(Qw.getPlugins);return e?Jb.fromBinary(e):{plugins:[]}}))}customPluginEventToRoom(e,t,r){const n={pluginId:e,pluginData:(new TextEncoder).encode(JSON.stringify(t))};Yt(this,SN).sendMessage(Qw.customPluginEventToRoom,Vb.toBinary(n),r)}customPluginEventToPeers(e,t,r,n){const i={pluginId:e,peerIds:t,pluginData:(new TextEncoder).encode(JSON.stringify(r))};Yt(this,SN).sendMessage(Qw.customPluginEventToPeers,Bb.toBinary(i),n)}enablePluginForRoom(e,t){Yt(this,SN).sendMessage(Qw.enablePluginForRoom,Lb.toBinary({pluginId:e}),t)}enablePluginForPeers(e,t,r){Yt(this,SN).sendMessage(Qw.enablePluginForPeers,jb.toBinary({pluginId:e,peerIds:t}),r)}disablePluginForRoom(e,t){Yt(this,SN).sendMessage(Qw.disablePluginForRoom,Ub.toBinary({pluginId:e}),t)}disablePluginForPeers(e,t,r){Yt(this,SN).sendMessage(Qw.disablePluginForPeers,Fb.toBinary({pluginId:e,peerIds:t}),r)}storeInsertKeys(e,t,r,n){const i={pluginId:e,storeName:t,insertKeys:r.map((e=>({storeKey:e.key,payload:(new TextEncoder).encode(JSON.stringify(e.payload))})))};Yt(this,SN).sendMessage(Qw.storeInsertKeys,Wb.toBinary(i),n)}storeGetKeys(e,t,r,n){const i={pluginId:e,storeName:t,getKeys:r.map((e=>({storeKey:e.key})))};Yt(this,SN).sendMessage(Qw.storeGetKeys,Gb.toBinary(i),n)}storeDeleteKeys(e,t,r,n){const i={pluginId:e,storeName:t,deleteKeys:r.map((e=>({storeKey:e.key})))};Yt(this,SN).sendMessage(Qw.storeDeleteKeys,qb.toBinary(i),n)}storeDelete(e,t,r){Yt(this,SN).sendMessage(Qw.storeDelete,$b.toBinary({pluginId:e,storeName:t}),r)}getPluginDataOld(e,t){BS.info("getPluginDataOld",{plugin:{id:e,storeName:t}})}storePluginDataOld(e,t,r){const n={pluginId:e,storeName:t,insertKeys:[{storeKey:r.key,payload:(new TextEncoder).encode(JSON.stringify(r))}]};Yt(this,SN).sendMessage(Qw.storeInsertKeys,Wb.toBinary(n))}on(e,t){let r;switch(e){case Qw.addPlugin:case Qw.enablePluginForPeers:case Qw.enablePluginForRoom:r=zb.fromBinary.bind(zb);break;case Qw.removePlugin:case Qw.disablePluginForPeers:case Qw.disablePluginForRoom:r=Kb.fromBinary.bind(Kb);break;case Qw.customPluginEventToPeers:case Qw.customPluginEventToRoom:r=Xb.fromBinary.bind(Xb);break;case Qw.storeInsertKeys:case Qw.storeGetKeys:case Qw.storeDeleteKeys:case Qw.storeDelete:r=Yb.fromBinary.bind(Yb)}Yt(this,SN).on(e,(({payload:e,id:n})=>{const i=r(e);return t(i,n)}))}}SN=new WeakMap;var EN,bN,wN,kN,RN=Object.defineProperty,CN=Object.getOwnPropertyDescriptor,IN=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?CN(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&RN(t,r,s),s};let AN=(kN=class extends WS{constructor(e){super(),Xt(this,bN),Xt(this,EN,void 0),Kt(this,"recordingPeerIds",[]),Kt(this,"recordings",[]),Zt(this,EN,e)}get recordingState(){return this.recordings.some((e=>"RECORDING"===e.state))?"RECORDING":this.recordings.some((e=>"PAUSED"===e.state))?"PAUSED":this.recordings.some((e=>"STARTING"===e.state))?"STARTING":this.recordings.some((e=>"STOPPING"===e.state))?"STOPPING":"IDLE"}updateRecordings(e){this.recordings=e,this.emit("recordingUpdate",this.recordingState)}start(e){return tr(this,null,(function*(){if(!Yt(this,EN).permissions.canRecord)throw BS.error("DyteRecording::start::permission_denied"),new $S("User does not have permission to start recording");if(!0!==(null==e?void 0:e.allowMultiple)&&("STARTING"===this.recordingState||"RECORDING"===this.recordingState||"STOPPING"===this.recordingState))throw BS.error("DyteRecording::start::recording_in_progress",{recording:{state:this.recordingState}}),new $S(`Cant start recording, recordingState irregular: ${this.recordingState}`);try{const t=$w(),{recording:r={}}=td.defaults,n=yield t.startRecording(r,null==e?void 0:e.allowMultiple);this.updateRecordings([...this.recordings,{id:n,state:"STARTING"}])}catch(e){throw BS.error("DyteRecording::stop::recording_failed_to_start",{error:e}),new $S("Error while starting recording")}}))}stop(e){return tr(this,null,(function*(){yield er(this,bN,wN).call(this,"stop",["RECORDING","PAUSED"],e)}))}pause(e){return tr(this,null,(function*(){yield er(this,bN,wN).call(this,"pause",["RECORDING"],e)}))}resume(e){return tr(this,null,(function*(){yield er(this,bN,wN).call(this,"resume",["PAUSED"],e)}))}},EN=new WeakMap,bN=new WeakSet,wN=function(e,t,r){return tr(this,null,(function*(){if(!Yt(this,EN).permissions.canRecord)throw BS.error("DyteRecording::stop::permission_denied"),new $S("User does not have permission to stop recording");let n=[];if(void 0!==r){const e=this.recordings.find((e=>e.id===r));if(void 0===e)throw new $S("Could not find the specified recording");if(t.includes(e.state))return void BS.error("DyteRecording::stop::recording_not_in_expected_state",{recording:{state:e.state}});n.push(e)}else n=this.recordings.filter((e=>t.includes(e.state)));n.forEach((t=>tr(this,null,(function*(){const r=t.state;"stop"===e&&(t.state="STOPPING",this.emit("recordingUpdate","STOPPING"));try{yield $w().updateRecording(t.id,e)}catch(e){throw BS.error("DyteRecording::stop::recording_failed_to_stop",{error:e}),t.state!==r&&(t.state=r,this.emit("recordingUpdate",r)),new $S("Error while stopping recording")}}))))}))},kN);IN([VS.trace("DyteRecording.start")],AN.prototype,"start",1),IN([VS.trace("DyteRecording.stop")],AN.prototype,"stop",1),IN([VS.trace("DyteRecording.stop")],AN.prototype,"pause",1),IN([VS.trace("DyteRecording.stop")],AN.prototype,"resume",1),AN=IN([KS((e=>{throw new $S(e.message,"1000")}))],AN);var PN=Object.defineProperty,DN=Object.getOwnPropertyDescriptor;class ON{constructor(e,t,r){Kt(this,"recording"),Kt(this,"room"),Kt(this,"shouldConnectToSocketService"),this.recording=new AN(e),this.room=t,this.shouldConnectToSocketService=r,this.setupEvents()}setupEvents(){tT.on(XS.ROOM_STATE,(e=>{0!==e.activeRecordings.length&&this.recording.updateRecordings(e.activeRecordings.map((e=>({id:e.recordingId,state:e.recordingStatus}))))})),this.room.on(Jw.recordingStarted,(e=>{let t=!1;const r=[...this.recording.recordings];r.forEach((r=>{r.id===e.recordingId&&(t=!0,r.state="RECORDING")})),!1===t&&r.push({id:e.recordingId,state:"RECORDING"}),this.recording.updateRecordings(r)})),this.room.on(Jw.recordingPaused,(e=>{const t=[...this.recording.recordings];t.forEach((t=>{t.id===e.recordingId&&(t.state="PAUSED")})),this.recording.updateRecordings(t)})),this.room.on(Jw.recordingStopped,(e=>{const t=[...this.recording.recordings.filter((t=>t.id!==e.recordingId))];this.recording.updateRecordings(t)})),this.shouldConnectToSocketService||this.setupLegacyEvents()}setupLegacyEvents(){tT.onAsync(XS.ROOM_JOINED,(e=>tr(this,null,(function*(){var t;BS.debug("[ROOM_JOINED] resolved request to fetch recordings.");const r=null==(t=e.peers)?void 0:t.filter((e=>{var t;return!(null==(t=e.flags)||!t.recorder)}));if(0!==r.length){r.forEach((e=>this.recording.recordingPeerIds.push(e.id)));const e=yield $w().getActiveRecording();this.recording.updateRecordings([{id:e.id,state:e.status}])}})))),tT.on(XS.PEER_JOINED,(e=>{var t;null!=(t=e.flags)&&t.recorder&&1===this.recording.recordings.length&&"STARTING"===this.recording.recordings[0].state&&(this.recording.recordingPeerIds.push(e.id),this.recording.updateRecordings([{id:this.recording.recordings[0].id,state:"RECORDING"}]))})),tT.on(XS.PEER_CLOSED,(e=>{this.recording.recordingPeerIds.includes(e.id)&&1===this.recording.recordings.length&&(this.recording.updateRecordings([]),this.recording.recordingPeerIds=this.recording.recordingPeerIds.filter((t=>t!==e.id)))})),tT.on(XS.LEAVE_MEDIA_ROOM,(()=>{this.recording.updateRecordings([]),this.recording.recordingPeerIds=[]}))}}((e,t,r,n)=>{for(var i,s=DN(t,r),o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(t,r,s)||s);s&&PN(t,r,s)})([VS.trace("RecordingController.setupEvents")],ON.prototype,"setupEvents");class MN{static hasFeature(e){var t;return null!=(t=In.hasFeature(e))&&t}static getFeatureValue(e){return In.getValue(e)}static getAllFeatures(){return In.getAllFlags()}}class NN{constructor(e,t,r){Kt(this,"logger"),Kt(this,"features"),Kt(this,"browserSpecs"),Kt(this,"callStats"),this.logger=e,this.features=t,this.browserSpecs=_S,this.callStats=r}static init(e){return new NN(BS,MN,e)}}class xN{constructor(e){Kt(this,"internals"),this.internals=e}static init(){return tr(this,null,(function*(){const e=NN.init(gn);return new xN(e)}))}}var LN,UN=Object.defineProperty,jN=Object.getOwnPropertyDescriptor,FN=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?jN(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&UN(t,r,s),s};class VN extends WS{constructor(e){super(),Xt(this,LN,void 0),Kt(this,"state","IDLE"),Kt(this,"playbackUrl"),Kt(this,"viewerCount"),Zt(this,LN,e),this.viewerCount=0}setLivestreamState(e){const t=this.state;this.state=e,t!==e&&this.emitCurrentLivestreamState()}emitCurrentLivestreamState(){this.emit("livestreamUpdate",this.state)}start(){return tr(this,null,(function*(){if(!Yt(this,LN).permissions.canLivestream)throw BS.error("DyteLivestream::start::permission_denied"),new $S("User does not have permission to start livestreaming");this.setLivestreamState("STARTING");try{const e=yield $w().startLivestreaming();this.playbackUrl=e}catch(e){throw BS.error("DyteRecording::stop::livestream_failed_to_start",{error:e}),this.setLivestreamState("IDLE"),new $S("Error while starting livestream")}}))}stop(){return tr(this,null,(function*(){if(!Yt(this,LN).permissions.canLivestream)throw BS.error("DyteLivestream::stop::permission_denied"),new $S("User does not have permission to stop livestreaming");if("LIVESTREAMING"!==this.state)throw BS.error("DyteLivestream::stop::inconsistent_state"),new $S("Livestream not started yet");try{this.setLivestreamState("STOPPING"),yield $w().stopLivestreaming()}catch(e){throw BS.error("DyteLivestream::stop::livestream_failed_to_stop",{error:e}),this.setLivestreamState("STOPPING"),new $S("Error while stopping livestream")}}))}}LN=new WeakMap,FN([VS.trace("livestream.start")],VN.prototype,"start",1),FN([VS.trace("livestream.stop")],VN.prototype,"stop",1);var BN,HN,WN=Object.defineProperty,GN=Object.getOwnPropertyDescriptor;class qN{constructor(e,t){Kt(this,"livestream"),Xt(this,BN,void 0),Xt(this,HN,void 0),this.livestream=new VN(e),Zt(this,HN,t),this.setupEvents()}fetchInitialLivestreamingState(){return tr(this,null,(function*(){const e=$w(),{status:t,playbackUrl:r}=yield e.getActiveLivestream();this.livestream.playbackUrl=r,"LIVE"===t&&this.livestream.setLivestreamState("LIVESTREAMING")}))}setupEvents(){Yt(this,HN).on(Jw.startedLivestream,(e=>{this.livestream.playbackUrl=e.playbackUrl,this.livestream.setLivestreamState("LIVESTREAMING")})),Yt(this,HN).on(Jw.stoppedLivestream,(()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0})),Yt(this,HN).on(Jw.erroredLivestream,(()=>{this.livestream.setLivestreamState("IDLE"),this.livestream.playbackUrl=void 0})),Yt(this,HN).on(Jw.roomPeerCount,(e=>{this.livestream.viewerCount=e.count,this.livestream.emit("viewerCountUpdate",e.count)})),tT.on(XS.PEER_JOINED,(e=>tr(this,null,(function*(){var t;!0===(null==(t=e.flags)?void 0:t.hiddenParticipant)&&"LIVESTREAMER"===e.recorderType&&(Zt(this,BN,e.id),this.livestream.setLivestreamState("LIVESTREAMING"))})))),tT.on(XS.PEER_CLOSED,(e=>{e.id===Yt(this,BN)&&(Zt(this,BN,void 0),this.livestream.setLivestreamState("IDLE"))})),tT.onAsync(XS.ROOM_JOINED,(e=>tr(this,null,(function*(){var t,r;BS.debug("[ROOM_JOINED] resolved request to fetch livestream.");const n=null==(t=e.peers)?void 0:t.filter((e=>{var t;return!0===(null==(t=e.flags)?void 0:t.hiddenParticipant)&&"LIVESTREAMER"===e.recorderType}));n.length?(Zt(this,BN,n&&(null==(r=n[0])?void 0:r.id)),this.livestream.setLivestreamState("LIVESTREAMING")):(Zt(this,BN,void 0),this.livestream.setLivestreamState("IDLE"))})))),tT.onAsync(XS.LEAVE_MEDIA_ROOM,(()=>tr(this,null,(function*(){if(!this.livestream.playbackUrl){BS.info("Fetching livestreaming state on leave stage");try{yield this.fetchInitialLivestreamingState()}catch(e){}}})))),tT.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(()=>tr(this,null,(function*(){try{yield this.fetchInitialLivestreamingState()}catch(e){}}))))}}BN=new WeakMap,HN=new WeakMap,((e,t,r,n)=>{for(var i,s=GN(t,r),o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(t,r,s)||s);s&&WN(t,r,s)})([VS.trace("LivestreamController.setupEvents")],qN.prototype,"setupEvents");const $N=CS(wa().permissions);var zN,JN,KN,QN,YN;const XN=class extends WS{constructor(e,t,r,n=!1){if(super(),Xt(this,zN,void 0),Xt(this,JN,void 0),Xt(this,KN,void 0),Xt(this,QN,void 0),Xt(this,YN,(e=>{e.chat&&(e.chat.private&&Jd.merge(Yt(this,zN).chat.private,e.chat.private),e.chat.public&&Jd.merge(Yt(this,zN).chat.public,e.chat.public),this.emit("chatUpdate")),e.polls&&(Jd.merge(Yt(this,zN).polls,e.polls),this.emit("pollsUpdate")),e.plugins&&(Jd.merge(Yt(this,zN).plugins,e.plugins),this.emit("pluginsUpdate"))})),!e)throw BS.error("DytePermissionsPreset::load_preset_permissions_failed"),new $S("Could not load preset permissions.");Zt(this,KN,r),Zt(this,JN,t),Zt(this,zN,e),n&&this.setupEvents()}setupEvents(){tT.onAsync(XS.SET_STAGE_STATUS,function(e){return tr(this,null,(function*(){Zt(this,QN,e),this.stageStatus=e}))}.bind(this)),tT.on(XS.UPDATE_PERMISSIONS,Yt(this,YN))}static fromResponse(e,t,r){return new XN(e,t,r,!0)}static default(e,t){return new XN($N,e,t)}get mediaRoomType(){return Yt(this,KN)?"HIVE":"ROOM_NODE"}get stageEnabled(){var e;return(null==(e=Yt(this,zN))?void 0:e.stageEnabled)||Yt(this,JN)===vn.Webinar||Yt(this,JN)===vn.Livestream}get acceptStageRequests(){var e,t;return!!this.stageEnabled&&((null==(e=Yt(this,zN))?void 0:e.acceptStageRequests)||(null==(t=Yt(this,zN))?void 0:t.canAcceptProductionRequests))}get stageAccess(){var e,t,r;return(null==(e=Yt(this,zN))?void 0:e.stageAccess)===_n.NotAllowed?_n.NotAllowed:(null==(t=Yt(this,zN))?void 0:t.stageAccess)===_n.CanRequest?_n.CanRequest:(null==(r=Yt(this,zN))?void 0:r.stageAccess)===_n.Allowed||Yt(this,zN).media.audio.canProduce===_n.Allowed||Yt(this,zN).media.video.canProduce===_n.Allowed||Yt(this,zN).media.screenshare.canProduce===_n.Allowed?_n.Allowed:Yt(this,zN).media.audio.canProduce===_n.CanRequest||Yt(this,zN).media.video.canProduce===_n.CanRequest||Yt(this,zN).media.screenshare.canProduce===_n.CanRequest?_n.CanRequest:_n.NotAllowed}get acceptWaitingRequests(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.acceptWaitingRequests)?t:$N.acceptWaitingRequests}get requestProduceVideo(){var e,t,r;return(null==(r=null==(t=null==(e=Yt(this,zN))?void 0:e.media)?void 0:t.video)?void 0:r.canProduce)===_n.CanRequest}get requestProduceAudio(){var e,t,r;return(null==(r=null==(t=null==(e=Yt(this,zN))?void 0:e.media)?void 0:t.audio)?void 0:r.canProduce)===_n.CanRequest}get requestProduceScreenshare(){var e,t,r;return(null==(r=null==(t=null==(e=Yt(this,zN))?void 0:e.media)?void 0:t.screenshare)?void 0:r.canProduce)===_n.CanRequest}get canAllowParticipantAudio(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.disableParticipantAudio)?t:$N.disableParticipantAudio}get canAllowParticipantScreensharing(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.canAcceptProductionRequests)?t:$N.canAcceptProductionRequests}get canAllowParticipantVideo(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.disableParticipantVideo)?t:$N.disableParticipantVideo}get canDisableParticipantAudio(){return this.canAllowParticipantAudio}get canDisableParticipantVideo(){return this.canAllowParticipantVideo}get kickParticipant(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.kickParticipant)?t:$N.kickParticipant}get pinParticipant(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.pinParticipant)?t:$N.pinParticipant}get canRecord(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.canRecord)?t:$N.canRecord}get waitingRoomType(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.waitingRoomType)?t:$N.waitingRoomType}get waitingRoomBehaviour(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.waitingRoomType)?t:$N.waitingRoomType}get plugins(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.plugins)?t:$N.plugins}get polls(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.polls)?t:$N.polls}get produceVideo(){return this.canProduceVideo}get requestProduce(){return Yt(this,zN).media.audio.canProduce===_n.CanRequest||Yt(this,zN).media.video.canProduce===_n.CanRequest||Yt(this,zN).media.screenshare.canProduce===_n.CanRequest}get canProduceVideo(){var e;const t=null!=(e=Yt(this,zN).media.video.canProduce)?e:$N.media.video.canProduce;return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Yt(this,QN)&&"ON_STAGE"!==Yt(this,QN)||t!==_n.CanRequest?!this.stageEnabled||"OFF_STAGE"!==Yt(this,QN)&&"REQUESTED_TO_JOIN_STAGE"!==Yt(this,QN)||t!==_n.Allowed?t:_n.NotAllowed:_n.Allowed}get produceScreenshare(){return this.canProduceScreenshare}get canProduceScreenshare(){var e;const t=null!=(e=Yt(this,zN).media.screenshare.canProduce)?e:$N.media.screenshare.canProduce;return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Yt(this,QN)&&"ON_STAGE"!==Yt(this,QN)||t!==_n.CanRequest?!this.stageEnabled||"OFF_STAGE"!==Yt(this,QN)&&"REQUESTED_TO_JOIN_STAGE"!==Yt(this,QN)||t!==_n.Allowed?t:_n.NotAllowed:_n.Allowed}get produceAudio(){return this.canProduceAudio}get canProduceAudio(){var e;const t=null!=(e=Yt(this,zN).media.audio.canProduce)?e:$N.media.audio.canProduce;return!this.stageEnabled||"ACCEPTED_TO_JOIN_STAGE"!==Yt(this,QN)&&"ON_STAGE"!==Yt(this,QN)||t!==_n.CanRequest?!this.stageEnabled||"OFF_STAGE"!==Yt(this,QN)&&"REQUESTED_TO_JOIN_STAGE"!==Yt(this,QN)||t!==_n.Allowed?t:_n.NotAllowed:_n.Allowed}get chatPublic(){var e,t,r;return null!=(r=null==(t=null==(e=Yt(this,zN))?void 0:e.chat)?void 0:t.public)?r:$N.chat.public}get chatPrivate(){var e,t,r;return null!=(r=null==(t=null==(e=Yt(this,zN))?void 0:e.chat)?void 0:t.private)?r:$N.chat.private}get chatChannel(){var e,t,r;return null!=(r=null==(t=null==(e=Yt(this,zN))?void 0:e.chat)?void 0:t.channel)?r:$N.chat.channel}get chatMessage(){var e,t,r;return null!=(r=null==(t=null==(e=Yt(this,zN))?void 0:e.chat)?void 0:t.message)?r:$N.chat.message}get connectedMeetings(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.connectedMeetings)?t:null==$N?void 0:$N.connectedMeetings}get hiddenParticipant(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.hiddenParticipant)?t:$N.hiddenParticipant}get showParticipantList(){var e;return null!=(e=Yt(this,zN).showParticipantList)?e:$N.showParticipantList}get canChangeParticipantRole(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.canChangeParticipantPermissions)?t:$N.canChangeParticipantPermissions}get canChangeParticipantPermissions(){var e,t;return null!=(t=null==(e=Yt(this,zN))?void 0:e.canChangeParticipantPermissions)?t:$N.canChangeParticipantPermissions}get canChangeTheme(){return!1}get canPresent(){return Yt(this,zN).media.audio.canProduce===_n.Allowed||Yt(this,zN).media.video.canProduce===_n.Allowed||Yt(this,zN).media.screenshare.canProduce===_n.Allowed}get acceptPresentRequests(){return this.acceptStageRequests}get canEditDisplayName(){var e;return null!=(e=Yt(this,zN).canEditDisplayName)&&e}get maxScreenShareCount(){return 1}get isRecorder(){return Yt(this,zN).isRecorder}get canSpotlight(){return Yt(this,zN).canSpotlight}get canLivestream(){return Yt(this,zN).canLivestream}get transcriptionEnabled(){return Yt(this,zN).transcriptionEnabled}get isV2(){return!0}};let ZN=XN;zN=new WeakMap,JN=new WeakMap,KN=new WeakMap,QN=new WeakMap,YN=new WeakMap;const ex=CS(wa());var tx,rx,nx;const ix=class{constructor(e){if(Xt(this,tx,void 0),Xt(this,rx,void 0),Xt(this,nx,void 0),!e)throw new $S("Could not load preset.");Zt(this,tx,e.config),Zt(this,rx,e.ui||CS(wa().ui)),Zt(this,nx,e.permissions.plugins.config)}static fromResponse(e){return new ix(e)}static default(){return new ix(ex)}get setupScreen(){return{isEnabled:!0}}get waitingRoom(){return{isEnabled:!0}}get controlBar(){return{isEnabled:!0,elements:{chat:!0,fullscreen:!0,invite:!1,layout:!1,participants:!0,plugins:!0,polls:!0,reactions:!1,screenshare:!0}}}get header(){return{isEnabled:!0,elements:{logo:Yt(this,rx).designTokens.logo,timer:!0,title:!0,participantCount:!0,changeLayout:!1}}}get pipMode(){return!0}get viewType(){return Yt(this,tx).viewType}get maxVideoStreams(){return Yt(this,tx).maxVideoStreams}get maxScreenShareCount(){return Yt(this,tx).maxScreenshareCount}get plugins(){return[]}get disabledPlugins(){return Object.keys(Yt(this,nx)).filter((e=>Yt(this,nx)[e].disabled))}get designTokens(){return Yt(this,rx).designTokens}get configDiff(){return Yt(this,rx).configDiff}get mediaConstraints(){var e,t,r,n,i,s,o,a,c,d,l,u,h,p,m,f,g,v,y,_,S,T,E,b;return{audio:{enableStereo:null!=(n=null==(r=null==(t=null==(e=Yt(this,tx))?void 0:e.media)?void 0:t.audio)?void 0:r.enableStereo)?n:OS.audio.enableStereo,enableHighBitrate:null!=(a=null==(o=null==(s=null==(i=Yt(this,tx))?void 0:i.media)?void 0:s.audio)?void 0:o.enableHighBitrate)?a:OS.audio.enableHighBitrate},video:{quality:null!=(u=null==(l=null==(d=null==(c=Yt(this,tx))?void 0:c.media)?void 0:d.video)?void 0:l.quality)?u:OS.video.quality,frameRate:null!=(f=null==(m=null==(p=null==(h=Yt(this,tx))?void 0:h.media)?void 0:p.video)?void 0:m.frameRate)?f:OS.video.frameRate},screenshare:{quality:null!=(_=null==(y=null==(v=null==(g=Yt(this,tx))?void 0:g.media)?void 0:v.screenshare)?void 0:y.quality)?_:OS.screenshare.quality,frameRate:null!=(b=null==(E=null==(T=null==(S=Yt(this,tx))?void 0:S.media)?void 0:T.screenshare)?void 0:E.frameRate)?b:OS.screenshare.frameRate}}}get isV2(){return!0}};let sx=ix;var ox,ax;tx=new WeakMap,rx=new WeakMap,nx=new WeakMap;class cx{constructor(e){Xt(this,ox,void 0),Zt(this,ox,e)}on(e,t){let r;r=e===Jw.roomPeerCount?tb.fromBinary.bind(tb):Zb.fromBinary.bind(Zb),Yt(this,ox).on(e,(({payload:e})=>{const n=r(e);return t(n)}))}}ox=new WeakMap;class dx{constructor(e){Xt(this,ax,void 0),Zt(this,ax,e)}getStageRequests(){return tr(this,null,(function*(){const{payload:e}=yield Yt(this,ax).sendMessagePromise(Jw.getStageRequests);return e?rw.fromBinary(e):{stageRequests:[]}}))}requestAccess(){Yt(this,ax).sendMessage(Jw.requestStageAccess)}cancelRequestAccess(){Yt(this,ax).sendMessage(Jw.cancelStageRequest)}grantAccess(e){return tr(this,null,(function*(){const t={userIds:e};Yt(this,ax).sendMessage(Jw.grantStageAccess,nw.toBinary(t))}))}denyAccess(e){return tr(this,null,(function*(){const t={userIds:e};Yt(this,ax).sendMessage(Jw.denyStageAccess,iw.toBinary(t))}))}joinStage(){return Yt(this,ax).sendMessage(Jw.joinStage)}leaveStage(e){const t={userIds:[e]};return Yt(this,ax).sendMessage(Jw.leaveStage,sw.toBinary(t))}kick(e){const t={userIds:e};return Yt(this,ax).sendMessagePromise(Jw.leaveStage,sw.toBinary(t))}on(e,t){let r;switch(e){case Jw.grantStageAccess:case Jw.denyStageAccess:r=void 0;break;case Jw.getStagePeers:r=ew.fromBinary.bind(ew);break;case Jw.getStageRequests:case Jw.requestStageAccess:case Jw.cancelStageRequest:r=rw.fromBinary.bind(rw);break;case Jw.peerStageStatusUpdate:r=XE.fromBinary.bind(XE)}Yt(this,ax).on(e,(({payload:e,id:n})=>{if(!e||!r)return t(void 0,n);const i=r(e);return t(i,n)}))}}ax=new WeakMap;var lx,ux,hx,px,mx,fx,gx,vx,yx,_x,Sx=Object.defineProperty,Tx=Object.getOwnPropertyDescriptor,Ex=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?Tx(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&Sx(t,r,s),s};class bx extends WS{constructor(e,t,r,n,i){super(),Xt(this,gx),Xt(this,yx),Xt(this,lx,void 0),Xt(this,ux,void 0),Xt(this,hx,void 0),Xt(this,px,void 0),Xt(this,mx,void 0),Xt(this,fx,void 0),Kt(this,"status"),Kt(this,"getSocketStageRequests",(()=>tr(this,null,(function*(){if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if(!Yt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::get_access_request::permission_denied"),new $S("You do not have permission to perform this action/");const{stageRequests:e}=yield Yt(this,lx).getStageRequests();Zt(this,fx,e)})))),Zt(this,lx,r),Zt(this,ux,e),Zt(this,hx,t),Zt(this,mx,i),Zt(this,px,n),Zt(this,fx,[]),this.setupEvents()}setupEvents(){Yt(this,ux).permissions.acceptStageRequests&&Yt(this,ux).permissions.stageEnabled&&this.getSocketStageRequests(),tT.onAsync(XS.GET_STAGE_REQUESTS,(e=>tr(this,null,(function*(){Zt(this,fx,e)})))),tT.onAsync(XS.UPDATE_STAGE_REQUESTS,(e=>tr(this,[e],(function*({request:e,add:t}){Zt(this,fx,t?[...Yt(this,fx),e]:Yt(this,fx).filter((t=>t.peerId!==e.peerId)))}))))}getAccessRequests(){if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if(!Yt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::get_access_request::permission_denied"),new $S("You do not have permission to perform this action/");return er(this,yx,_x).call(this)?{stageRequests:Yt(this,fx)}:{stageRequests:Yt(this,hx).joined.toArray().filter((e=>e.stageStatus===MA.REQUESTED_TO_JOIN_STAGE)).map((e=>({displayName:e.name,userId:e.userId,peerId:e.id})))}}requestAccess(){return tr(this,null,(function*(){if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if("OFF_STAGE"!==this.status)throw new $S(`Unable to request access you are currently ${this.status}`);if(er(this,yx,_x).call(this)){if(Yt(this,ux).permissions.stageAccess===_n.Allowed)return void er(this,gx,vx).call(this,"ACCEPTED_TO_JOIN_STAGE");Yt(this,lx).requestAccess(),er(this,gx,vx).call(this,"REQUESTED_TO_JOIN_STAGE")}else{if(!Yt(this,ux).roomJoined)throw new $S("Can`t request to join stage without joining room");if(Yt(this,ux).permissions.stageAccess===_n.Allowed)return void er(this,gx,vx).call(this,"ACCEPTED_TO_JOIN_STAGE");if(Yt(this,ux).permissions.stageAccess===_n.NotAllowed)throw BS.error("DyteStage::requestGoToStage::permission_denied"),new $S("User does not have permission to go on stage");if("OFF_STAGE"!==this.status)return;try{er(this,gx,vx).call(this,"REQUESTED_TO_JOIN_STAGE"),yield Yt(this,mx).requestToJoinStage(sC.PRESENT)}catch(e){er(this,gx,vx).call(this,"OFF_STAGE")}}}))}cancelRequestAccess(){return tr(this,null,(function*(){if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if(er(this,yx,_x).call(this))Yt(this,lx).cancelRequestAccess();else{if(!Yt(this,ux).roomJoined)throw new $S("Can`t request to join stage without joining room");if(Yt(this,ux).stageStatus!==MA.REQUESTED_TO_JOIN_STAGE)return;yield Yt(this,mx).withdrawRequestToJoinStage()}er(this,gx,vx).call(this,"OFF_STAGE")}))}grantAccess(e){if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if(!Yt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::grant_access::permission_denied"),new $S("You do not have permission to perform this action/");if(er(this,yx,_x).call(this))return Yt(this,lx).grantAccess(e);if(!Yt(this,ux).roomJoined)throw new $S("Can`t rejectRequestToJoinStage for participant without joining room");return Yt(this,mx).grantStageAccess(e)}denyAccess(e){if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if(!Yt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::deny_access::permission_denied"),new $S("You do not have permission to perform this action/");if(er(this,yx,_x).call(this))return Yt(this,lx).denyAccess(e);if(!Yt(this,ux).roomJoined)throw new $S("Can`t rejectRequestToJoinStage for participant without joining room");return Yt(this,mx).denyStageAccess(e)}join(){return tr(this,null,(function*(){if("ON_STAGE"===this.status)throw new $S("You are already on stage.");if(Yt(this,ux).permissions.stageAccess!==_n.Allowed&&"ACCEPTED_TO_JOIN_STAGE"!==this.status)throw new $S(`Unable to join stage you are currently ${this.status}`);if(er(this,yx,_x).call(this))Yt(this,lx).joinStage(),Yt(this,px)===vn.Livestream?yield tT.emitAsync(XS.JOIN_MEDIA_ROOM):(Yt(this,ux).emit("stageJoined"),er(this,gx,vx).call(this,"ON_STAGE"));else{if(!Yt(this,ux).roomJoined)throw new $S("Can`t join stage without joining room");yield Yt(this,mx).startPresenting(),Yt(this,ux).emit("stageJoined"),er(this,gx,vx).call(this,"ON_STAGE")}}))}leave(){return tr(this,null,(function*(){var e;if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if(er(this,yx,_x).call(this)){if("ON_STAGE"!==this.status&&"ACCEPTED_TO_JOIN_STAGE"!==this.status)throw new $S(`Unable to leave stage you are currently ${this.status}`);Yt(this,ux).setIsPinned(!1),er(this,gx,vx).call(this,"OFF_STAGE"),null!=(e=_C())&&e.roomJoined&&Yt(this,px)===vn.Livestream&&(yield tT.emitAsync(XS.LEAVE_MEDIA_ROOM));try{yield Yt(this,ux).disableScreenShare(),yield Yt(this,ux).disableVideo(),yield Yt(this,ux).disableAudio(),Yt(this,ux).destructMediaHandler()}catch(e){BS.error("DyteStage.leaveStage.DisableMediaError",{error:e})}Yt(this,lx).leaveStage(Yt(this,ux).userId)}else{if(!Yt(this,ux).roomJoined)throw new $S("Can`t leave stage without joining room");yield Yt(this,ux).disableScreenShare(),yield Yt(this,ux).disableAudio(),yield Yt(this,ux).disableVideo(),yield Yt(this,mx).stopPresenting(),er(this,gx,vx).call(this,"OFF_STAGE")}}))}kick(e){return tr(this,null,(function*(){if(!Yt(this,ux).permissions.stageEnabled)throw BS.error("DyteStage::stage_disabled"),new $S("Stage is disabled");if(!Yt(this,ux).permissions.acceptStageRequests)throw BS.error("DyteStage::kick::permission_denied"),new $S("You do not have permissions for kick");if(er(this,yx,_x).call(this))return Yt(this,lx).kick(e);if(!Yt(this,ux).roomJoined)throw new $S("Can`t kick participant without joining room");return Yt(this,mx).kickPeerFromStage(e)}))}}lx=new WeakMap,ux=new WeakMap,hx=new WeakMap,px=new WeakMap,mx=new WeakMap,fx=new WeakMap,gx=new WeakSet,vx=function(e){return tr(this,null,(function*(){this.status!==e&&(this.status=e,yield tT.emitAsync(XS.SET_STAGE_STATUS,e),this.emit("stageStatusUpdate",e))}))},yx=new WeakSet,_x=function(){return Yt(this,px)===vn.Livestream||"HIVE"===Yt(this,ux).permissions.mediaRoomType},Ex([VS.trace("DyteStage.getStageRequests")],bx.prototype,"getAccessRequests",1),Ex([VS.trace("DyteStage.requestAccess")],bx.prototype,"requestAccess",1),Ex([VS.trace("DyteStage.cancelRequestAccess")],bx.prototype,"cancelRequestAccess",1),Ex([VS.trace("DyteStage.grantAccess")],bx.prototype,"grantAccess",1),Ex([VS.trace("DyteStage.denyAccess")],bx.prototype,"denyAccess",1),Ex([VS.trace("DyteStage.joinStage")],bx.prototype,"join",1),Ex([VS.trace("DyteStage.leaveStage")],bx.prototype,"leave",1);var wx,kx,Rx,Cx,Ix,Ax=Object.defineProperty,Px=Object.getOwnPropertyDescriptor;class Dx{constructor(e,t,r,n,i){Kt(this,"stage"),Xt(this,wx,void 0),Xt(this,kx,void 0),Xt(this,Rx,void 0),Xt(this,Cx,0),Xt(this,Ix,void 0),this.stage=new bx(t,r,e,n,i),Zt(this,Rx,e),Zt(this,Ix,n),Zt(this,wx,t),Zt(this,Ix,n),Zt(this,kx,r),this.setupEvents(),this.setupWebinarMigrationEvents()}setupEvents(){Yt(this,Rx).on(Jw.grantStageAccess,(()=>{Yt(this,wx).permissions.stageAccess!==_n.Allowed&&(this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE"))})),Yt(this,Rx).on(Jw.peerStageStatusUpdate,(e=>{if(void 0===e||e.peerId===Yt(this,wx).id)return;const t=Yt(this,kx).joined.get(e.peerId),r="ACTIVE_GRID"===Yt(this,kx).viewMode&&"HIVE"===Yt(this,wx).permissions.mediaRoomType;if(t||Yt(this,Ix)===vn.Livestream){switch(e.stageType){case 1:t.setStageStatus("ON_STAGE"),r&&tT.emit(XS.REFRESH_GRID);break;case 2:t.setStageStatus("ACCEPTED_TO_JOIN_STAGE");break;case 3:t.setStageStatus("REQUESTED_TO_JOIN_STAGE");break;default:t.setStageStatus("OFF_STAGE"),r&&tT.emit(XS.REFRESH_GRID)}this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests())}else BS.warn("err::peerStageStatusUpdate: participant not found")})),Yt(this,Rx).on(Jw.denyStageAccess,(()=>{Yt(this,wx).permissions.stageAccess!==_n.Allowed&&(this.stage.emit("stageRequestRejected"),this.setStageStatus("OFF_STAGE"),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})),Yt(this,Rx).on(Jw.getStagePeers,(e=>{Yt(this,Ix)!==vn.Livestream&&"HIVE"!==Yt(this,wx).permissions.mediaRoomType||"ON_STAGE"===this.stage.status&&!e.stagePeers.includes(Yt(this,wx).userId)&&this.stage.leave()})),Yt(this,Rx).on(Jw.getStageRequests,(e=>tr(this,null,(function*(){var t;if(Yt(this,wx).permissions.stageAccess!==_n.Allowed)return;const r=null!=(t=null==e?void 0:e.stageRequests)?t:[];yield tT.emitAsync(XS.GET_STAGE_REQUESTS,r),Yt(this,Cx)<r.length&&r.length>0&&this.stage.emit("newStageRequest",{count:r.length}),Zt(this,Cx,r.length),this.stage.emit("stageAccessRequestUpdate",r)})))),tT.on(XS.NEW_STAGE_REQUEST,(()=>{Yt(this,wx).permissions.stageAccess===_n.Allowed&&this.stage.emit("newStageRequest",{count:-1})})),tT.onAsync(XS.SOCKET_SERVICE_ROOM_JOINED,(e=>tr(this,null,(function*(){var t;if(Yt(this,Ix)===vn.Livestream||"HIVE"===Yt(this,wx).permissions.mediaRoomType){switch(null==(t=e.peer)?void 0:t.stageType){case $E.OFF_STAGE:"ON_STAGE"===this.stage.status&&(yield this.stage.leave()),this.setStageStatus("OFF_STAGE");break;case $E.ON_STAGE:"LIVESTREAM"===Yt(this,wx).config.viewType&&(yield tT.emitAsync(XS.JOIN_MEDIA_ROOM)),"HIVE"===Yt(this,wx).permissions.mediaRoomType&&this.setStageStatus("ON_STAGE");break;case $E.APPROVED_STAGE:this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE");break;case $E.REQUESTED_STAGE:this.setStageStatus("REQUESTED_TO_JOIN_STAGE");break;default:this.setStageStatus("OFF_STAGE")}Yt(this,wx).emit("socketServiceRoomJoined")}})))),tT.onAsync(XS.ROOM_JOINED,(e=>tr(this,null,(function*(){e.stageStatus&&this.setStageStatus(e.stageStatus)})))),tT.on(XS.SELF_ROOM_JOINED,(()=>tr(this,null,(function*(){Yt(this,Ix)!==vn.Livestream?Yt(this,wx).permissions.stageEnabled&&Yt(this,wx).permissions.stageAccess===_n.Allowed&&"ON_STAGE"!==this.stage.status&&(yield this.stage.join()):this.setStageStatus("ON_STAGE")})))),tT.on(XS.REQUEST_TO_JOIN_STAGE_ACCEPTED,(()=>{this.stage.emit("stageRequestApproved"),this.setStageStatus("ACCEPTED_TO_JOIN_STAGE"),Yt(this,wx).emit("joinStageRequestAccepted")})),tT.on(XS.REQUEST_TO_JOIN_STAGE_REJECTED,(()=>{this.stage.emit("stageRequestRejected"),this.setStageStatus("OFF_STAGE"),Yt(this,wx).emit("joinStageRequestRejected")})),tT.on(XS.PEER_REJECTED_TO_JOIN_STAGE,(({id:e})=>{!e||e===Yt(this,wx).id||(tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.OFF_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})),tT.on(XS.PEER_ADDED_TO_STAGE,(({id:e})=>{!e||e===Yt(this,wx).id||(tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.ACCEPTED_TO_JOIN_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})),tT.on(XS.PEER_STARTED_PRESENTING,(({id:e})=>{!e||e===Yt(this,wx).id||tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.ON_STAGE})})),tT.on(XS.PEER_REMOVED_FROM_STAGE,(({id:e})=>{!e||e===Yt(this,wx).id||(tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.OFF_STAGE}),Yt(this,kx).pinned.delete(e))})),tT.on(XS.PEER_STOPPED_PRESENTING,(({id:e})=>{!e||e===Yt(this,wx).id||(tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.OFF_STAGE}),Yt(this,kx).pinned.delete(e))})),tT.on(XS.PEER_REQUESTED_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({id:e}){!e||e===Yt(this,wx).id||(yield tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.REQUESTED_TO_JOIN_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})))),tT.on(XS.STAGE_REQUESTS_UPDATED,(e=>tr(this,null,(function*(){yield tT.emitAsync(XS.UPDATE_STAGE_REQUESTS,e),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests())})))),tT.on(XS.PEER_WITHDRAWN_REQUEST_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({id:e}){!e||e===Yt(this,wx).id||(yield tT.emitAsync(XS.UPDATE_PEER_STAGE_STATUS,{id:e,status:MA.OFF_STAGE}),this.stage.emit("stageAccessRequestUpdate",this.getCurrentStageRequests()))})))),tT.on(XS.REMOVED_FROM_STAGE,(()=>tr(this,null,(function*(){this.setStageStatus("OFF_STAGE"),yield Yt(this,wx).disableScreenShare(),yield Yt(this,wx).disableVideo(),yield Yt(this,wx).disableAudio(),Yt(this,wx).destructMediaHandler(),Yt(this,wx).emit("removedFromStage")}))))}setupWebinarMigrationEvents(){tT.on(XS.SET_WEBINAR_STAGE_STATUS,(e=>tr(this,null,(function*(){this.stage.status!==e&&(this.stage.status=e,yield tT.emitAsync(XS.SET_STAGE_STATUS,e),this.stage.emit("stageStatusUpdate",e))})))),tT.onAsync(XS.REQUEST_TO_JOIN_STAGE,(()=>tr(this,null,(function*(){return this.stage.requestAccess()})))),tT.onAsync(XS.WITHDRAW_REQUEST_TO_JOIN_STAGE,(()=>tr(this,null,(function*(){return this.stage.cancelRequestAccess()})))),tT.onAsync(XS.LEAVE_STAGE,(()=>tr(this,null,(function*(){return this.stage.leave()})))),tT.onAsync(XS.JOIN_STAGE,(()=>tr(this,null,(function*(){return this.stage.join()})))),tT.onAsync(XS.ACCEPT_JOIN_STAGE_REQUEST,(e=>tr(this,[e],(function*({userId:e}){return this.stage.grantAccess([e])})))),tT.onAsync(XS.REMOVE_FROM_STAGE,(e=>tr(this,[e],(function*({userId:e}){this.stage.kick([e])})))),tT.onAsync(XS.REJECT_REQUEST_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({userId:e}){return this.stage.denyAccess([e])})))),tT.onAsync(XS.ACCEPT_ALL_REQUESTS_TO_JOIN_STAGE,(e=>tr(this,[e],(function*({data:e}){const t=e.map((({id:e})=>Yt(this,kx).joined.get(e).userId));this.stage.grantAccess(t)}))))}getCurrentStageRequests(){return Yt(this,kx).joined.toArray().filter((e=>"REQUESTED_TO_JOIN_STAGE"===e.stageStatus)).map((e=>({displayName:e.name,userId:e.userId,peerId:e.id})))}setStageStatus(e){return tr(this,null,(function*(){this.stage.status!==e&&(this.stage.status=e,yield tT.emitAsync(XS.SET_STAGE_STATUS,e),this.stage.emit("stageStatusUpdate",e))}))}}wx=new WeakMap,kx=new WeakMap,Rx=new WeakMap,Cx=new WeakMap,Ix=new WeakMap,((e,t,r,n)=>{for(var i,s=Px(t,r),o=e.length-1;o>=0;o--)(i=e[o])&&(s=i(t,r,s)||s);s&&Ax(t,r,s)})([VS.trace("DyteStage.setupEvents")],Dx.prototype,"setupEvents");var Ox,Mx=Object.defineProperty,Nx=Object.getOwnPropertyDescriptor,xx=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?Nx(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&Mx(t,r,s),s};class Lx{constructor(e){Xt(this,Ox,void 0),Zt(this,Ox,e)}getPolls(){return Yt(this,Ox).sendMessagePromise(Yw.getPolls)}createPoll(e,t,r=!1,n=!1){const i={anonymous:r,hideVotes:n,question:e,options:t};return Yt(this,Ox).sendMessage(Yw.createPoll,dw.toBinary(i))}votePoll(e,t){const r={index:t,pollId:e};return Yt(this,Ox).sendMessage(Yw.votePoll,lw.toBinary(r))}on(e,t){let r,n;switch(e){case Yw.updatePoll:case Yw.createPoll:case Yw.votePoll:r=uw.fromBinary.bind(uw),n=uw.create()}Yt(this,Ox).on(e,(({payload:e})=>{let i=n;try{i=r(e)}catch(e){BS.error("pollSocketHandler::on::binary_decode_error",{error:e})}return t(i)}))}}Ox=new WeakMap,xx([VS.trace("PollSocketHandler.getPolls")],Lx.prototype,"getPolls",1),xx([VS.trace("PollSocketHandler.createPoll")],Lx.prototype,"createPoll",1),xx([VS.trace("PollSocketHandler.votePoll")],Lx.prototype,"votePoll",1);const Ux=new class{constructor(){Kt(this,"battery"),Kt(this,"init",(()=>tr(this,null,(function*(){try{"getBattery"in navigator&&(this.battery=yield navigator.getBattery(),this.battery.addEventListener("chargingchange",this.updateChargeInfo),this.battery.addEventListener("levelchange",this.updateLevelInfo),this.updateLevelInfo(),this.updateChargeInfo())}catch(e){BS.error("Error getting battery",e)}})))),Kt(this,"updateChargeInfo",(()=>{var e;BS.log("Battery charging? "+(null!=(e=this.battery)&&e.charging?"Yes":"No"))})),Kt(this,"updateLevelInfo",(()=>{this.battery?BS.log(`Battery level: ${100*this.battery.level}%`):BS.log("Battery level: Not known")})),Kt(this,"cleanup",(()=>{var e,t;"getBattery"in navigator&&(null==(e=this.battery)||e.removeEventListener("chargingchange",this.updateChargeInfo),null==(t=this.battery)||t.removeEventListener("levelchange",this.updateLevelInfo))}))}};var jx,Fx,Vx,Bx,Hx,Wx,Gx,qx,$x,zx,Jx,Kx;class Qx extends HS{constructor(e){super(),Xt(this,Vx),Xt(this,jx,void 0),Xt(this,Fx,void 0),Zt(this,jx,e),Zt(this,Fx,!1)}get mediaPermission(){return Yt(this,jx).mediaPermissions.audio}getTrackMetadata(e=!1){return tr(this,null,(function*(){if(!WI.track){if(!e)return null;const t=yield er(this,Vx,Bx).call(this);WI.setTrack(t)}return WI.getTrackMetadata()}))}startTrackAnalysis(e=!1){return tr(this,null,(function*(){if(Yt(this,Fx))return!0;Zt(this,Fx,!0);let t=yield WI.startTrackAnalysis();if(!t&&e){const e=yield er(this,Vx,Bx).call(this);WI.setTrack(e),t=yield WI.startTrackAnalysis()}return t||Zt(this,Fx,!1),t}))}stopTrackAnalysis(){return Yt(this,Fx)&&(Zt(this,Fx,!1),WI.stopTrackAnalysis()),!0}}jx=new WeakMap,Fx=new WeakMap,Vx=new WeakSet,Bx=function(){return tr(this,null,(function*(){var e;try{const t=Yt(this,jx).getCurrentDevices(),r=null==(e=null==t?void 0:t.audio)?void 0:e.deviceId;let n={audio:!0};r&&(n=MC.getAudioConstraints({audioDeviceId:r}));const i=yield MC.getAudioTrack(n);return Yt(this,jx).mediaPermissions.audio="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:Yt(this,jx).mediaPermissions.audio,kind:"audio"}),i}catch(e){const t=zC("audio",e.name,e.message);throw Yt(this,jx).mediaPermissions.audio=t,tT.emit(XS.MEDIA_PERMISSION_ERROR,{message:t,constraints:e.constraints,kind:"audio"}),new $S("Failed to fetch audio track","1700")}}))};class Yx extends HS{constructor(){super(),Xt(this,Hx,void 0),Zt(this,Hx,!1)}getNetworkMetadata(){return tr(this,null,(function*(){return new Promise((e=>{gn.onSafeInitialization((()=>{gn.onPreCallTestResults((t=>{e(t.connectionInfo)})),gn.startPreCallTest()}))}))}))}startNetworkAnalysis(){return Zt(this,Hx,zR.collectSendTransportStats()&&zR.collectRecvTransportStats()),Yt(this,Hx)}stopNetworkAnalysis(){return Zt(this,Hx,!(zR.stopStatsCollection("send")&&zR.stopStatsCollection("receive"))),Yt(this,Hx)}}Hx=new WeakMap;class Xx extends HS{constructor(e){super(),Xt(this,Wx,void 0),Xt(this,Gx,void 0),Zt(this,Wx,e),Zt(this,Gx,{audio:!1,video:!1})}get mediaPermission(){return Yt(this,Wx).mediaPermissions.screenshare}getAudioTrackMetaData(){var e;return null!=(e=Yt(this,Wx).screenShareTracks)&&e.audio?GI.getTrackMetadata():null}getVideoTrackMetaData(){var e;return null!=(e=Yt(this,Wx).screenShareTracks)&&e.video?TA.getTrackMetadata():null}startAudioTrackAnalysis(){return tr(this,null,(function*(){if(Yt(this,Gx).audio)return!0;const e=yield GI.startTrackAnalysis();return Yt(this,Gx).audio=e,Yt(this,Gx).audio}))}startVideoTrackAnalysis(){return tr(this,null,(function*(){if(Yt(this,Gx).video)return!0;const e=yield TA.startTrackAnalysis();return Yt(this,Gx).video=e,Yt(this,Gx).video}))}stopAudioTrackAnalysis(){return Yt(this,Gx)&&(Yt(this,Gx).audio=!1,GI.stopTrackAnalysis()),!0}stopVideoTrackAnalysis(){return Yt(this,Gx)&&(Yt(this,Gx).video=!1,TA.stopTrackAnalysis()),!0}}Wx=new WeakMap,Gx=new WeakMap;class Zx extends HS{constructor(e){super(),Xt(this,Jx),Xt(this,qx,void 0),Xt(this,$x,void 0),Xt(this,zx,void 0),Kt(this,"preview"),Zt(this,qx,e),Zt(this,$x,!1),Zt(this,zx,!1)}get mediaPermission(){return Yt(this,qx).mediaPermissions.video}getTrackMetadata(){return Yt(this,qx).videoTrack?null:SA.getTrackMetadata()}startTrackAnalysis(){return tr(this,arguments,(function*({preview:e}={preview:!1}){return!!Yt(this,$x)||!!(yield SA.startTrackAnalysis())&&((e||this.preview)&&Zt(this,zx,!0),Zt(this,$x,!0),!0)}))}stopTrackAnalysis(){Yt(this,$x)&&(SA.stopTrackAnalysis(),Zt(this,$x,!1),Yt(this,zx)&&Zt(this,zx,!1))}startPreview(){return tr(this,null,(function*(){let{track:e}=SA;return e||(e=yield er(this,Jx,Kx).call(this)),this.preview||(SA.setTrack(e),this.preview=!0,SA.preview=!0),e}))}stopPreview(){Yt(this,$x)&&Yt(this,zx)&&this.stopTrackAnalysis(),this.preview=!1,SA.preview=!1,SA.cleanup()}cleanup(){Yt(this,$x)&&Yt(this,zx)&&this.stopTrackAnalysis(),this.preview=!1,SA.preview=!1}}qx=new WeakMap,$x=new WeakMap,zx=new WeakMap,Jx=new WeakSet,Kx=function(){return tr(this,null,(function*(){var e;try{const t=Yt(this,qx).getCurrentDevices(),r=null==(e=null==t?void 0:t.video)?void 0:e.deviceId;let n={video:{width:{ideal:1280},height:{ideal:720}}};r&&(n=MC.getVideoConstraints({videoDeviceId:r}));const i=yield MC.getVideoTrack(n);return Yt(this,qx).mediaPermissions.video="ACCEPTED",tT.emit(XS.MEDIA_PERMISSION_UPDATE,{message:Yt(this,qx).mediaPermissions.video,kind:"video"}),i}catch(e){const t=zC("video",e.name,e.message);throw Yt(this,qx).mediaPermissions.video=t,tT.emit(XS.MEDIA_PERMISSION_ERROR,{message:t,constraints:e.constraints,kind:"video"}),new $S("Failed to fetch video track","1700")}}))};class eL{constructor(e){Kt(this,"audio"),Kt(this,"video"),Kt(this,"screenshare"),Kt(this,"network"),this.audio=new Qx(e),this.video=new Zx(e),this.screenshare=new Xx(e),this.network=new Yx}}const tL=e=>{const{type:t,id:r,transport:n,timestamp:i,currentRoundTripTime:s,bytesSent:o,bytesReceived:a,kind:c,jitter:d,packetsLost:l,packetSendDelay:u}=e;switch(t){case"candidate-pair":return{type:t,id:r,transport:n,timestamp:i,rtt:s,bytesSent:o,bytesReceived:a};case"inbound-rtp":return{type:t,id:r,transport:n,timestamp:i,kind:c,jitter:d,packetsLost:l,bytesReceived:a};default:return{type:t,id:r,transport:n,timestamp:i,kind:c,packetSendDelay:u,bytesSent:o}}};class rL{constructor(e){Kt(this,"troubleshooter"),Kt(this,"self"),this.troubleshooter=new eL(e),this.self=e,this.setupEvents()}setupEvents(){tT.on(XS.AUDIO_TRACK_CHANGED,(()=>{var e;this.self.audioTrack&&null!=(e=this.self.audioTrack)&&e.enabled&&WI.setTrack(this.self.audioTrack)})),tT.on(XS.VIDEO_TRACK_CHANGED,(()=>{var e;this.self.videoTrack&&SA.setTrack(null==(e=this.self.videoTrack)?void 0:e.clone())})),tT.on(XS.SCREENSHARE_TRACK_CHANGED,(()=>{var e,t,r,n,i;null!=(e=this.self.screenShareTracks)&&e.audio&&this.self.screenShareTracks.audio.enabled?GI.setTrack(null==(t=this.self.screenShareTracks)?void 0:t.audio):GI.cleanup(),null!=(r=this.self.screenShareTracks)&&r.video?TA.setTrack(null==(i=null==(n=this.self.screenShareTracks)?void 0:n.video)?void 0:i.clone()):TA.cleanup()})),tT.on(XS.AUDIO_TRACK_ANALYSIS,(e=>{this.troubleshooter.audio.emit("audioTrackStats",e)})),tT.on(XS.AUDIO_TRACK_CLOSED,(()=>{this.troubleshooter.audio.emit("audioTrackUpdate",{status:"ended"})})),tT.on(XS.AUDIO_TRACK_CREATED,(()=>{this.troubleshooter.audio.emit("audioTrackUpdate",{status:"live"})})),tT.on(XS.SCREENSHARE_AUDIO_TRACK_ANALYSIS,(e=>{this.troubleshooter.screenshare.emit("audioTrackStats",e)})),tT.on(XS.SCREENSHARE_AUDIO_TRACK_CLOSED,(()=>{this.troubleshooter.screenshare.emit("audioTrackUpdate",{status:"ended"})})),tT.on(XS.SCREENSHARE_AUDIO_TRACK_CREATED,(()=>{this.troubleshooter.screenshare.emit("audioTrackUpdate",{status:"live"})})),tT.on(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS,(e=>{this.troubleshooter.screenshare.emit("videoTrackStats",e)})),tT.on(XS.SCREENSHARE_VIDEO_TRACK_ANALYSIS_ERROR,(()=>{this.troubleshooter.screenshare.stopVideoTrackAnalysis(),TA.cleanup()})),tT.on(XS.SCREENSHARE_VIDEO_TRACK_CLOSED,(()=>{this.troubleshooter.screenshare.emit("videoTrackUpdate",{status:"ended"})})),tT.on(XS.SCREENSHARE_VIDEO_TRACK_CREATED,(()=>{this.troubleshooter.screenshare.emit("videoTrackUpdate",{status:"live"})})),tT.on(XS.VIDEO_TRACK_ANALYSIS,(e=>{this.troubleshooter.video.emit("videoTrackStats",e)})),tT.on(XS.VIDEO_TRACK_ANALYSIS_ERROR,(()=>{this.troubleshooter.video.stopTrackAnalysis(),this.troubleshooter.video.startTrackAnalysis(),this.troubleshooter.video.stopPreview()})),tT.on(XS.VIDEO_TRACK_CLOSED,(()=>{this.troubleshooter.video.cleanup(),this.troubleshooter.video.emit("videoTrackUpdate",{status:"ended"})})),tT.on(XS.VIDEO_TRACK_CREATED,(()=>{this.troubleshooter.video.emit("videoTrackUpdate",{status:"live"})})),tT.on(XS.CANDIDATE_PEER_UPDATE,(e=>{this.troubleshooter.network.emit("connectionDelayStats",tL(e))})),tT.on(XS.INBOUND_RTP_UPDATE,(e=>{this.troubleshooter.audio.emit("audioConsumptionStats",tL(e))})),tT.on(XS.OUTBOUND_RTP_UPDATE,(e=>{this.troubleshooter.audio.emit("audioProductionStats",tL(e))})),tT.on(XS.SEND_TRANSPORT_CLOSED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"send",status:"ended"})})),tT.on(XS.RECV_TRANSPORT_CLOSED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"receive",status:"ended"})})),tT.on(XS.SEND_TRANSPORT_CREATED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"send",status:"live"})})),tT.on(XS.RECV_TRANSPORT_CREATED,(()=>{this.troubleshooter.audio.emit("connectionUpdate",{transport:"receive",status:"live"})}))}}const nL=class{static handleConnectedRoomsDumpRaw({payload:e}){var t;const r=ub.fromBinary(e),n=r.meetings.map((e=>{var t;return{id:e.id,title:e.title,participants:null!=(t=e.participants)?t:[]}}));return{parentMeeting:{id:r.parentMeeting.id,title:r.parentMeeting.title,participants:null!=(t=r.parentMeeting.participants)?t:[]},meetings:n}}static handleTransferPeerRaw({payload:e}){const t=wb.fromBinary(e);return{authToken:t.authToken,meetingId:t.meetingId}}static handleMovedPeerRaw({payload:e}){const t=bb.fromBinary(e);return{meetingId:t.meetingId,customParticipantId:t.customParticipantId}}static handleConnectedRoomsUpdatedRaw({payload:e}){return fb.fromBinary(e).payloads.map((e=>({id:e.id,title:e.title})))}static handleConnectedRoomsDeletedRaw({payload:e}){return _b.fromBinary(e).payloads}static getConnectedRoomsDump(){return tr(this,null,(function*(){const e=yield nL.socketService.sendMessagePromise(Jw.getConnectedRoomsDump);return nL.handleConnectedRoomsDumpRaw(e)}))}static createConnectedRooms(e){return tr(this,null,(function*(){const{payload:t}=yield nL.socketService.sendMessagePromise(Jw.createConnectedRooms,pb.toBinary({payloads:e}));return fb.fromBinary(t).payloads.map((e=>({id:e.id,title:e.title})))}))}static updateConnectedRooms(e){return tr(this,null,(function*(){}))}static disableConnectedRooms(e){return tr(this,null,(function*(){const t=e.map((e=>({id:e}))),r=yield nL.socketService.sendMessagePromise(Jw.deleteConnectedRooms,yb.toBinary({payloads:t}));return nL.handleConnectedRoomsDeletedRaw(r)}))}static movePeersBetweenRooms(e){return tr(this,null,(function*(){try{const t=yield nL.socketService.sendMessagePromise(Jw.movePeers,Eb.toBinary({sourceMeetingId:e.sourceMeetingId,destinationMeetingId:e.destinationMeetingId,participants:e.participants}));return(new TextDecoder).decode(t.payload).includes("error")?{success:!1,error:"failed to move participants"}:{success:!0}}catch(e){return{success:!1,error:e}}}))}};let iL=nL;Kt(iL,"socketService"),Kt(iL,"currentMeetingId");const sL={codecs:[{kind:"audio",mimeType:"audio/opus",clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc",parameter:""}],parameters:{},preferredPayloadType:100},{kind:"video",mimeType:"video/VP8",clockRate:9e4,rtcpFeedback:[{type:"nack",parameter:""},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb",parameter:""},{type:"transport-cc",parameter:""}],parameters:{"x-google-start-bitrate":1e3},preferredPayloadType:101},{kind:"video",mimeType:"video/rtx",preferredPayloadType:102,clockRate:9e4,parameters:{apt:101},rtcpFeedback:[]},{kind:"video",mimeType:"video/VP9",clockRate:9e4,rtcpFeedback:[{type:"nack",parameter:""},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb",parameter:""},{type:"transport-cc",parameter:""}],parameters:{"profile-id":0,"x-google-start-bitrate":1e3},preferredPayloadType:103},{kind:"video",mimeType:"video/rtx",preferredPayloadType:104,clockRate:9e4,parameters:{apt:103},rtcpFeedback:[]},{kind:"video",mimeType:"video/H264",clockRate:9e4,parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f","x-google-start-bitrate":1e3},rtcpFeedback:[{type:"nack",parameter:""},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb",parameter:""},{type:"transport-cc",parameter:""}],preferredPayloadType:105},{kind:"video",mimeType:"video/rtx",preferredPayloadType:106,clockRate:9e4,parameters:{apt:105},rtcpFeedback:[]}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",preferredId:13,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",preferredId:13,preferredEncrypt:!1,direction:"sendrecv"}]};var oL;class aL{constructor(e){Xt(this,oL,void 0),Zt(this,oL,e)}on(e,t){let r,n;e===Jw.transcript?(r=sE.fromBinary.bind(sE),n=sE.create()):BS.debug("AISocketHandler switch case hit default, event not accounted for."),Yt(this,oL).on(e,(({payload:e})=>{let i=n;try{i=r(e)}catch(e){BS.error("chatSocketHandler::on::binary_decode_error",{error:e})}return t(i)}))}}oL=new WeakMap;var cL=Object.defineProperty,dL=Object.getOwnPropertyDescriptor,lL=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?dL(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&cL(t,r,s),s};const uL=class{constructor(e,t,r,n,i,s,o,a,c,d,l,u,h){Kt(this,"apiBase"),Kt(this,"chatController"),Kt(this,"metaController"),Kt(this,"participantController"),Kt(this,"pluginController"),Kt(this,"pollController"),Kt(this,"remoteController"),Kt(this,"selfController"),Kt(this,"recordingController"),Kt(this,"livestreamController"),Kt(this,"internalsController"),Kt(this,"stageController"),Kt(this,"troubleshooterController"),this.apiBase=e,this.metaController=t,this.selfController=r,this.pluginController=n,this.participantController=i,this.chatController=s,this.pollController=o,this.remoteController=a,this.recordingController=c,this.livestreamController=l,this.internalsController=d,this.stageController=u,this.troubleshooterController=h}static init(e,t){return tr(this,null,(function*(){var r,n,i,s,o,a,c,d,l,u,h,p,m,f,g,v,y;const{authToken:_}=e;let S="https://api.dyte.io";e.apiBase&&(S=e.apiBase),e.baseURI&&(S=`https://api.${e.baseURI}`);const T=$t({chat:!0,participant:!0,plugin:!0,poll:!0,self:!0,meta:!0,permissions:!0,theme:!0,tracing:!0,devTools:{logs:!1},internals:!0,stage:!0,pip:!0},null==e?void 0:e.modules);rd(zt($t({},e),{modules:T,apiBase:S})),tT.reset(),yC(),LA.cleanup();const E=function(e){return qw=Sw.isV2AuthToken?new Vw(e):new Gw(e),qw}({authToken:_,baseURL:S,cachedUserDetails:e.cachedUserDetails});E.setHeader("dyte-tracing-id",t),E.setPeerId(t),E.setRoomName(e.roomName);const{roomName:b}=e,w=Sw.isV2AuthToken?Sw.meetingId:b,k=new ed,R=k.load({routerRtpCapabilities:sL});if(e.cachedUserDetails&&!Sw.isV2AuthToken)throw new $S("Can only use cached user details with v2 auth tokens");const C=E.getRoomNodeData({roomName:w,peerId:t}),I=Sw.isV2AuthToken?void 0:E.getUserPreset(b),A=yield E.getUserDetails(),P=Sw.isV2AuthToken?A.participant.organizationId:A.organizationId;VS.meetingMetadata.userId=Sw.isV2AuthToken?A.participant.id:A.id,VS.meetingMetadata.organizationId=P;const D=function(e){let t,r,n=0;if(!e)return n;for(t=0;t<e.length;t+=1)r=e.charCodeAt(t),n=(n<<5)-n+r,n|=0;return Math.abs(n)%100+1}(w),O=null!=(r=e.overrides)&&r.whitelabelled_flags_endpoint?sd({servicePrefix:"flags",apiBase:S,baseURI:e.baseURI}):"edge.api.flagsmith.com";yield In.identify(`${PS.PEER}_${t}`,JSON.parse(JSON.stringify($t({entity:PS.PEER,clientId:P,isAnonUser:!P,sdkVersion:nd,meetingHash:D,roomName:w},_S.getDeviceInfo()))),!1,5e3,O),function(){_S.isElectron()&&window.dyteElectronGetDisplayMediaSource&&(navigator.mediaDevices.getDisplayMedia=()=>tr(this,null,(function*(){const e=yield window.dyteElectronGetDisplayMediaSource({types:["window","screen"]});let t=[];if(e&&(t=Array.isArray(e)?e:[e]),null==t||!t.length)throw new Error("Couldn't find any media source for screen share.");let r=t.find((e=>{var t;return null==(t=e.id)?void 0:t.includes("screen")}));r=null!=r?r:t[0];const n={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r.id}}};return yield navigator.mediaDevices.getUserMedia(n)})))}(),BS.info("flagsmith::allFlags",{flags:JSON.stringify(In.getAllFlags())},!0);const{roomNodeUrl:M,meetingTitle:N,useHiveMedia:x}=yield C;yield R,Ux.init();let L=Sw.isV2AuthToken?sx.default():_P.default(),U=Sw.isV2AuthToken?ZN.default(L.viewType,x):cT.default(x),j=Sw.isV2AuthToken?A.preset.name:void 0;if(rd(zt($t({},e),{modules:T,apiBase:S,organizationId:P,viewType:L.viewType})),T.permissions||T.theme){const e=yield I;e&&(j=e.presetName),T.theme&&(L=Sw.isV2AuthToken?sx.fromResponse(A.preset):_P.fromResponse(e.theme),Sw.isV2AuthToken||L.configFromPermissions(e.permissions)),T.permissions&&(U=Sw.isV2AuthToken?ZN.fromResponse(A.preset.permissions,L.viewType,x):cT.fromResponse(e.permissions,x))}const F=EA(L),V=In.hasFeature(DS.CUSTOM_PING_PONG),B=[];x&&B.push("HIVE"),V&&B.push("PING");const H=Rw(L.viewType,B),W=E.getPlugins(H),G=L.viewType!==vn.Chat;bw(zt($t({},e),{roomName:w,peerId:t,meetingTitle:N,roomNodeUrl:M,device:k,useHiveMedia:x})),td.defaults.mediaConfiguration||(td.defaults.mediaConfiguration={}),td.defaults.mediaConfiguration.audio||(td.defaults.mediaConfiguration.audio={}),td.defaults.mediaConfiguration.audio.enableHighBitrate=null!=(i=td.defaults.mediaConfiguration.audio.enableHighBitrate)?i:null==(n=L.mediaConstraints.audio)?void 0:n.enableHighBitrate,td.defaults.mediaConfiguration.audio.enableStereo=null!=(o=td.defaults.mediaConfiguration.audio.enableHighBitrate)?o:null==(s=L.mediaConstraints.audio)?void 0:s.enableStereo;const q=yield uL.createSocketServiceAndRoomNodeClient(zt($t({},e),{roomName:w,peerId:t,meetingTitle:N,roomNodeUrl:M,capabilities:B,shouldInitializeRoomNode:F,viewType:L.viewType,device:k})),$=_C();let z,J,K,Q,Y,X,Z,ee,te,re,ne,ie;const se=new KD(q),oe=new WD(q),ae=new Lx(q),ce=new TN(q),de=new cx(q),le=new dx(q),ue=new aL(q);iL.socketService=q;const he=LA.create(q);null==(a=T.self)||a?([Y]=yield Promise.all([$A.init(q,he,A,U,L,j,!!e.cachedUserDetails),$ instanceof fC?$.setupTransports():null]),E.setOrganizationId(Y.self.organizationId)):$ instanceof fC&&(yield $.setupTransports());const pe=In.hasFeature(DS.TROUBLESHOOTING);if(Y&&pe&&(ie=new rL(Y.self)),null==(c=T.participant)||c){if(!Y)throw new $S("The participant module cannot be initialized without the `self` module");J=new ZP(Y.self,he,B,T)}if(null==(d=T.chat)||d){if(!Y)throw new $S("The chat module cannot be initialized without the `self` module");z=yield gO.init(se,oe,Y.self,J.participants,B,!!e.cachedUserDetails)}if(G&&(null==(l=T.plugin)||l)){if(!Y)throw new $S("The plugin module cannot be initialized without the `self` module");if(!J)throw new $S("The plugin module cannot be initialized without the `participant` module");const e=yield W;K=yield CO.init(e,ce,se,null==z?void 0:z.chat,Y.self,J.participants,B)}if(G&&(null==(u=T.poll)||u)){if(!Y)throw new $S("The poll cannot be initialized without the `self` module");Q=yield GO.init(Y.self,ae,B)}if(null==(h=T.meta)||h){if(!Y)throw new $S("The meta module cannot be initialized without the `self` module");X=yield _D.init(Y.self,he,ue,N)}if(null==(p=T.remoteControl)||p){if(!Y)throw new $S("The remote controller cannot be initialized without the `self` module");Z=new tM(Y.self,J.participants)}if(G&&(null==(m=T.recording)||m)){if(!Y)throw new $S("The recording controller cannot be initialized without the `self` module");ee=new ON(Y.self,he,Cw(L.viewType,B))}if((null==(f=T.internals)||f)&&(re=yield xN.init()),L.viewType===vn.Livestream&&(null==(g=T.livestream)||g)){if(!Y)throw new $S("The livestream controller cannot be initialized without the `self` module");In.hasFeature(DS.LIVESTREAM)&&(te=new qN(Y.self,de))}if(G&&(null==(v=T.stage)||v)){if(!Y)throw new $S("The stage client cannot be initialized without the `self` module");ne=new Dx(le,Y.self,J.participants,X.meta.viewType,$)}if(Cw(L.viewType,B)||"socket-service"===(null==(y=e.overrides)?void 0:y.chat_socket_server))try{yield q.connect()}catch(e){BS.error("[Socket Service] Failed to connect to socket server:",{error:e})}return new uL(S,X,Y,K,J,z,Q,Z,ee,re,te,ne,ie)}))}static createSocketServiceAndRoomNodeClient(e){return tr(this,null,(function*(){const t=uL.createSocketService(e);return e.shouldInitializeRoomNode?e.capabilities.includes("HIVE")?(yield gC(zt($t({},e),{roomName:e.roomName,peerId:e.peerId,socket:t})),t):(yield vC(zt($t({},e),{roomName:e.roomName,peerId:e.peerId})),t):t}))}static createSocketService(e){const{peerId:t,roomName:r,authToken:n,capabilities:i}=e;return new _N({peerId:t,roomName:r,authToken:n,capabilities:i})}joinRoom(){return tr(this,null,(function*(){if(!this.selfController.self.roomJoined)return this.selfController.joinRoom()}))}leaveRoom(e="left"){return tr(this,null,(function*(){return Ux.cleanup(),this.selfController.leaveRoom(e)}))}};let hL=uL;var pL;lL([VS.trace("Controller.joinRoom")],hL.prototype,"joinRoom",1),lL([VS.trace("Controller.leaveRoom")],hL.prototype,"leaveRoom",1),lL([VS.trace("Controller.init")],hL,"init",1),lL([VS.trace("Controller.createSocketServiceAndRoomNodeClient")],hL,"createSocketServiceAndRoomNodeClient",1),lL([VS.trace("Controller.createSocketService")],hL,"createSocketService",1);class mL extends WS{constructor(e){super(),Xt(this,pL,void 0),Kt(this,"meetings",[]),Kt(this,"parentMeeting",null),Zt(this,pL,e.self)}get supportsConnectedMeetings(){return""!==Yt(this,pL).id&&Sw.isV2AuthToken&&In.hasFeature(DS.CONNECTED_MEETINGS)}get isActive(){return 0!==this.meetings.length}get currentMeetingId(){return iL.currentMeetingId}validateConnectedMeetingsAction(){if(!this.supportsConnectedMeetings)throw new Error("You are not allowed to perform this action.\n\t\t\t\t\t\tPlease connect with Dyte team to move you to V2 APIs & to enable connected meetings.")}getConnectedMeetings(){return tr(this,null,(function*(){return this.validateConnectedMeetingsAction(),yield iL.getConnectedRoomsDump()}))}createMeetings(e){return tr(this,null,(function*(){return this.validateConnectedMeetingsAction(),(yield iL.createConnectedRooms(e)).map((e=>({id:e.id,title:e.title})))}))}updateMeetings(e){return tr(this,null,(function*(){this.validateConnectedMeetingsAction(),yield iL.updateConnectedRooms(e.map((e=>({meetingId:e.id,title:e.title}))))}))}deleteMeetings(e){return tr(this,null,(function*(){this.validateConnectedMeetingsAction();const t=this.meetings.map((t=>e.includes(t.id)&&0!==t.participants.length?this.moveParticipants(t.id,this.parentMeeting.id,t.participants.map((e=>e.id))):Promise.resolve()));return yield Promise.all(t),yield iL.disableConnectedRooms(e)}))}moveParticipants(e,t,r){return tr(this,null,(function*(){this.validateConnectedMeetingsAction();const n=new Map;[...this.parentMeeting.participants,...this.meetings.flatMap((e=>e.participants))].forEach((e=>n.set(e.id,e)));const i=yield iL.movePeersBetweenRooms({sourceMeetingId:e,destinationMeetingId:t,participants:r.map((e=>({id:e})))});return i.success&&(t===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.concat(r.map((e=>n.get(e))))),e===this.parentMeeting.id&&(this.parentMeeting.participants=this.parentMeeting.participants.filter((e=>!r.includes(e.id)))),this.meetings=this.meetings.map((i=>{if(t===i.id){const e=i.participants.concat(r.map((e=>n.get(e))));return zt($t({},i),{participants:e})}if(e===i.id){const e=i.participants.filter((e=>!r.includes(e.id)));return zt($t({},i),{participants:e})}return i}))),i}))}}pL=new WeakMap;var fL,gL,vL,yL=Object.defineProperty,_L=Object.getOwnPropertyDescriptor,SL=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?_L(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&yL(t,r,s),s};const TL=(vL=class{constructor(e,t){Kt(this,"connectedMeetings"),Xt(this,fL,void 0),Xt(this,gL,void 0),Zt(this,fL,t),this.connectedMeetings=new mL(e),this.setCurrentMeeting(e)}static init(e,t){return TL.instance||(TL.instance=new TL(e,t)),TL.instance.connectedMeetings.supportsConnectedMeetings&&(TL.instance.setupEvents(),e.self.once("roomJoined",(()=>TL.instance.getConnectedMeetings()))),TL.instance}setCurrentMeeting(e){Zt(this,gL,e),iL.currentMeetingId=e.meta.roomName}getConnectedMeetings(){this.connectedMeetings.getConnectedMeetings()}setupEvents(){iL.socketService&&(iL.socketService.on(Jw.getConnectedRoomsDump,this.handleConnectedRoomsDump.bind(this)),iL.socketService.on(Jw.transferPeer,this.handleTransferPeer.bind(this)),iL.socketService.on(Jw.movedPeer,this.handleMovedPeer.bind(this)),iL.socketService.on(Jw.connectedRoomsUpdated,this.handleConnectedRoomsUpdated.bind(this)),iL.socketService.on(Jw.connectedRoomsDeleted,this.handleConnectedRoomsDeleted.bind(this)))}handleTransferPeer(e){const t=iL.handleTransferPeerRaw(e);return this.switchMeeting(t)}switchMeeting(e){return tr(this,arguments,(function*({authToken:e,meetingId:t}){if(!this.connectedMeetings.supportsConnectedMeetings)throw new Error("You are not allowed to perform this action.\n\t\t\t\t\t\t\t\tPlease connect with Dyte team to move you to V2 APIs & to enable connected meetings.");this.connectedMeetings.emit("changingMeeting",t);const r=Yt(this,gL).self.videoEnabled;yield Yt(this,gL).leave("connected-meeting"),iL.socketService=void 0;const n=yield OL.init({authToken:e,baseURI:Yt(this,fL).baseURI,defaults:zt($t({},Yt(this,fL).defaults),{video:r,audio:!1}),modules:Yt(this,fL).modules});n.self.setName(Yt(this,gL).self.name);try{yield n.join()}catch(e){VS.addLogInCurrentSpan("error","ConnectedMeetingsController.joinRoom",{error:e})}return this.connectedMeetings.emit("meetingChanged",n),this.setCurrentMeeting(n),n}))}handleConnectedRoomsDump(e){const t=iL.handleConnectedRoomsDumpRaw(e);this.connectedMeetings.meetings=t.meetings.map((e=>({id:e.id,title:e.title,participants:e.participants||[]}))),this.connectedMeetings.parentMeeting={id:t.parentMeeting.id,title:t.parentMeeting.title,participants:t.parentMeeting.participants},this.emitStateUpdate()}handleMovedPeer(e){return iL.handleMovedPeerRaw(e)}handleConnectedRoomsUpdated(e){const t=iL.handleConnectedRoomsUpdatedRaw(e),r=new Map;this.connectedMeetings.meetings.forEach((e=>{r.set(e.id,e)})),t.forEach((e=>{r.has(e.id)?r.get(e.id).title=e.title:r.set(e.id,zt($t({},e),{participants:[]}))})),this.connectedMeetings.meetings=Array.from(r.values()),this.emitStateUpdate()}handleConnectedRoomsDeleted(e){const t=iL.handleConnectedRoomsDeletedRaw(e).map((e=>e.id));this.connectedMeetings.meetings=this.connectedMeetings.meetings.filter((e=>!t.includes(e.id)))}emitStateUpdate(){this.connectedMeetings.emit("stateUpdate",{meetings:this.connectedMeetings.meetings,parentMeeting:this.connectedMeetings.parentMeeting})}},fL=new WeakMap,gL=new WeakMap,Kt(vL,"instance"),vL);let EL=TL;SL([VS.trace("ConnectedMeetingsController.getConnectedMeetings")],EL.prototype,"getConnectedMeetings",1),SL([VS.trace("ConnectedMeetingsController.setupEvents")],EL.prototype,"setupEvents",1),SL([VS.trace("ConnectedMeetingsController.switchMeeting")],EL.prototype,"switchMeeting",1);var bL,wL,kL,RL,CL,IL=Object.defineProperty,AL=Object.getOwnPropertyDescriptor,PL=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?AL(t,r):t,o=e.length-1;o>=0;o--)(i=e[o])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&IL(t,r,s),s};let DL=(CL=class{constructor(e){Xt(this,kL),Xt(this,bL,void 0),Xt(this,wL,void 0),Zt(this,bL,e)}static init(e){return tr(this,null,(function*(){var t,r,n,i,s,o;(function(e){Sw.overrides=e})(null!=(t=e.overrides)?t:{}),_S.init();const a=u();window.__zone_symbol__DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION=!0,VS.init(a,null==(n=null==(r=e.modules)?void 0:r.tracing)||n),BS.info("DyteClient::init::options",{dyteClientInitOptions:zt($t({},e),{authToken:`${null==(i=e.authToken)?void 0:i.slice(0,10)}...${null==(s=e.authToken)?void 0:s.slice(-10)}`})}),!navigator.isReactNative&&"undefined"!=typeof window&&(window.addEventListener("error",(e=>{var t;(null==(t=e.filename)||!t.includes("localhost"))&&0!==e.lineno&&BS.error("window::error",{error:e.error},!0)})),window.addEventListener("unhandledrejection",(e=>{var t,r,n,i,s,o,a,c;BS.error("window::unhandledrejection",{error:null==e?void 0:e.reason,networkCall:{url:null==(r=null==(t=null==e?void 0:e.reason)?void 0:t.config)?void 0:r.url,baseURL:null==(i=null==(n=null==e?void 0:e.reason)?void 0:n.config)?void 0:i.baseURL,method:null==(o=null==(s=null==e?void 0:e.reason)?void 0:s.config)?void 0:o.method,status:null==(a=null==e?void 0:e.reason)?void 0:a.status,statusText:null==(c=null==e?void 0:e.reason)?void 0:c.statusText}},!0)})),window.addEventListener("offline",(()=>{BS.info("window::offline")})),window.addEventListener("online",(()=>{BS.info("window::online")}))),function(e,t){if(t)Sw.isV2AuthToken=!1;else try{const{meetingId:t}=JSON.parse(atob(e.split(".")[1]));if(!t)throw Error(`Received V1 auth token ${e}`);Sw.isV2AuthToken=!0,Sw.meetingId=t}catch(t){throw BS.error("constants::setIsV2AuthToken",{error:t,debuggingHint:`Unable to decode auth token: ${e}`},!0),new $S("Invalid auth token")}}(e.authToken,e.roomName),VS.meetingMetadata.roomName=Sw.isV2AuthToken?Sw.meetingId:e.roomName;const c=yield hL.init(zt($t({},e),{cachedUserDetails:CS(e.cachedUserDetails)}),a),d=new DL(c);return er(o=d,kL,RL).call(o,e),d}))}joinRoom(){return tr(this,null,(function*(){return Yt(this,bL).joinRoom()}))}leaveRoom(e){return tr(this,null,(function*(){return Yt(this,bL).leaveRoom(e)}))}join(){return tr(this,null,(function*(){return Yt(this,bL).joinRoom()}))}leave(e){return tr(this,null,(function*(){return Yt(this,bL).leaveRoom(e)}))}get participants(){var e;return null==(e=Yt(this,bL).participantController)?void 0:e.participants}get self(){var e;return null==(e=Yt(this,bL).selfController)?void 0:e.self}get meta(){var e;return null==(e=Yt(this,bL).metaController)?void 0:e.meta}get ai(){var e;return null==(e=Yt(this,bL).metaController)?void 0:e.ai}get plugins(){var e;return null==(e=Yt(this,bL).pluginController)?void 0:e.plugins}get chat(){var e;return null==(e=Yt(this,bL).chatController)?void 0:e.chat}get polls(){var e;return null==(e=Yt(this,bL).pollController)?void 0:e.polls}get remote(){var e;return null==(e=Yt(this,bL).remoteController)?void 0:e.remote}get connectedMeetings(){var e;return null==(e=Yt(this,wL))?void 0:e.connectedMeetings}get recording(){var e;return null==(e=Yt(this,bL).recordingController)?void 0:e.recording}get livestream(){var e;return null==(e=Yt(this,bL).livestreamController)?void 0:e.livestream}get stage(){var e;return null==(e=Yt(this,bL).stageController)?void 0:e.stage}get troubleshoot(){var e;return null==(e=Yt(this,bL).troubleshooterController)?void 0:e.troubleshooter}get __internals__(){var e;return null==(e=Yt(this,bL).internalsController)?void 0:e.internals}},bL=new WeakMap,wL=new WeakMap,kL=new WeakSet,RL=function(e){Zt(this,wL,EL.init(this,e))},Kt(CL,"DyteSelfMedia",tA),CL);PL([KS((e=>{throw new $S(e.message,"0002")})),$I({methodName:"meeting.join",lockName:"DyteClient.join",timeout:3e3})],DL.prototype,"joinRoom",1),PL([KS((e=>{throw new $S(e.message,"0003")}))],DL.prototype,"leaveRoom",1),PL([KS((e=>{throw new $S(e.message,"0002")})),$I({methodName:"meeting.join",lockName:"DyteClient.join",timeout:3e3})],DL.prototype,"join",1),PL([KS((e=>{throw new $S(e.message,"0003")}))],DL.prototype,"leave",1),PL([KS((e=>{throw new $S(e.message,"0001")})),$I({methodName:"DyteClient.init",lockName:"DyteClient.init",timeout:3e3})],DL,"init",1),DL=PL([KS((e=>{throw new $S(e.message,"0000")}))],DL);const OL=DL},1726:(e,t,r)=>{e.exports=r(760)},9981:(e,t,r)=>{"use strict";var n=r(9395),i=r(6085),s=r(8887),o=r(1223),a=r(1838),c=r(5365),d=r(7337),l=r(1522),u=r(6694),h=r(1947);e.exports=function(e){return new Promise((function(t,r){var p,m=e.data,f=e.headers,g=e.responseType;function v(){e.cancelToken&&e.cancelToken.unsubscribe(p),e.signal&&e.signal.removeEventListener("abort",p)}n.isFormData(m)&&delete f["Content-Type"];var y=new XMLHttpRequest;if(e.auth){var _=e.auth.username||"",S=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";f.Authorization="Basic "+btoa(_+":"+S)}var T=a(e.baseURL,e.url);function E(){if(y){var n="getAllResponseHeaders"in y?c(y.getAllResponseHeaders()):null,s={data:g&&"text"!==g&&"json"!==g?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:n,config:e,request:y};i((function(e){t(e),v()}),(function(e){r(e),v()}),s),y=null}}if(y.open(e.method.toUpperCase(),o(T,e.params,e.paramsSerializer),!0),y.timeout=e.timeout,"onloadend"in y?y.onloadend=E:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(E)},y.onabort=function(){y&&(r(l("Request aborted",e,"ECONNABORTED",y)),y=null)},y.onerror=function(){r(l("Network Error",e,null,y)),y=null},y.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||u.transitional;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(l(t,e,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",y)),y=null},n.isStandardBrowserEnv()){var b=(e.withCredentials||d(T))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;b&&(f[e.xsrfHeaderName]=b)}"setRequestHeader"in y&&n.forEach(f,(function(e,t){void 0===m&&"content-type"===t.toLowerCase()?delete f[t]:y.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(y.withCredentials=!!e.withCredentials),g&&"json"!==g&&(y.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&y.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(p=function(e){y&&(r(!e||e&&e.type?new h("canceled"):e),y.abort(),y=null)},e.cancelToken&&e.cancelToken.subscribe(p),e.signal&&(e.signal.aborted?p():e.signal.addEventListener("abort",p))),m||(m=null),y.send(m)}))}},760:(e,t,r)=>{"use strict";var n=r(9395),i=r(1269),s=r(994),o=r(6654),a=function e(t){var r=new s(t),a=i(s.prototype.request,r);return n.extend(a,s.prototype,r),n.extend(a,r),a.create=function(r){return e(o(t,r))},a}(r(6694));a.Axios=s,a.Cancel=r(1947),a.CancelToken=r(4946),a.isCancel=r(8895),a.VERSION=r(6824).version,a.all=function(e){return Promise.all(e)},a.spread=r(7941),a.isAxiosError=r(442),e.exports=a,e.exports.default=a},1947:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4946:(e,t,r)=>{"use strict";var n=r(1947);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},i.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},8895:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},994:(e,t,r)=>{"use strict";var n=r(9395),i=r(1223),s=r(6976),o=r(2259),a=r(6654),c=r(8630),d=c.validators;function l(e){this.defaults=e,this.interceptors={request:new s,response:new s}}l.prototype.request=function(e,t){if("string"==typeof e?(t=t||{}).url=e:t=e||{},!t.url)throw new Error("Provided config url is not valid");(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&c.assertOptions(r,{silentJSONParsing:d.transitional(d.boolean),forcedJSONParsing:d.transitional(d.boolean),clarifyTimeoutError:d.transitional(d.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var s,l=[];if(this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)})),!i){var u=[o,void 0];for(Array.prototype.unshift.apply(u,n),u=u.concat(l),s=Promise.resolve(t);u.length;)s=s.then(u.shift(),u.shift());return s}for(var h=t;n.length;){var p=n.shift(),m=n.shift();try{h=p(h)}catch(e){m(e);break}}try{s=o(h)}catch(e){return Promise.reject(e)}for(;l.length;)s=s.then(l.shift(),l.shift());return s},l.prototype.getUri=function(e){if(!e.url)throw new Error("Provided config url is not valid");return e=a(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,r){return this.request(a(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,r,n){return this.request(a(n||{},{method:e,url:t,data:r}))}})),e.exports=l},6976:(e,t,r)=>{"use strict";var n=r(9395);function i(){this.handlers=[]}i.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},1838:(e,t,r)=>{"use strict";var n=r(1810),i=r(6091);e.exports=function(e,t){return e&&!n(t)?i(e,t):t}},1522:(e,t,r)=>{"use strict";var n=r(2062);e.exports=function(e,t,r,i,s){var o=new Error(e);return n(o,t,r,i,s)}},2259:(e,t,r)=>{"use strict";var n=r(9395),i=r(5752),s=r(8895),o=r(6694),a=r(1947);function c(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return c(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return c(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(c(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},2062:e=>{"use strict";e.exports=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},6654:(e,t,r)=>{"use strict";var n=r(9395);e.exports=function(e,t){t=t||{};var r={};function i(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function s(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:i(void 0,e[r]):i(e[r],t[r])}function o(e){if(!n.isUndefined(t[e]))return i(void 0,t[e])}function a(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:i(void 0,e[r]):i(void 0,t[r])}function c(r){return r in t?i(e[r],t[r]):r in e?i(void 0,e[r]):void 0}var d={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return n.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=d[e]||s,i=t(e);n.isUndefined(i)&&t!==c||(r[e]=i)})),r}},6085:(e,t,r)=>{"use strict";var n=r(1522);e.exports=function(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},5752:(e,t,r)=>{"use strict";var n=r(9395),i=r(6694);e.exports=function(e,t,r){var s=this||i;return n.forEach(r,(function(r){e=r.call(s,e,t)})),e}},6694:(e,t,r)=>{"use strict";var n=r(9395),i=r(9489),s=r(2062),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,d={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=r(9981)),c),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(a(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(0,JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||d.transitional,r=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,o=!r&&"json"===this.responseType;if(o||i&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw s(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){d.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){d.headers[e]=n.merge(o)})),e.exports=d},6824:e=>{e.exports={version:"0.25.0"}},1269:e=>{"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},1223:(e,t,r)=>{"use strict";var n=r(9395);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(n.isURLSearchParams(t))s=t.toString();else{var o=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))})))})),s=o.join("&")}if(s){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},6091:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},8887:(e,t,r)=>{"use strict";var n=r(9395);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,i,s,o){var a=[];a.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(i)&&a.push("path="+i),n.isString(s)&&a.push("domain="+s),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1810:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},442:(e,t,r)=>{"use strict";var n=r(9395);e.exports=function(e){return n.isObject(e)&&!0===e.isAxiosError}},7337:(e,t,r)=>{"use strict";var n=r(9395);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=n.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},9489:(e,t,r)=>{"use strict";var n=r(9395);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},5365:(e,t,r)=>{"use strict";var n=r(9395),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,s,o={};return e?(n.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=n.trim(e.substr(0,s)).toLowerCase(),r=n.trim(e.substr(s+1)),t){if(o[t]&&i.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o}},7941:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},8630:(e,t,r)=>{"use strict";var n=r(6824).version,i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var s={};i.transitional=function(e,t,r){function i(e,t){return"[Axios v"+n+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,o){if(!1===e)throw new Error(i(n," has been removed"+(t?" in "+t:"")));return t&&!s[n]&&(s[n]=!0,console.warn(i(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}},e.exports={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),i=n.length;i-- >0;){var s=n[i],o=t[s];if(o){var a=e[s],c=void 0===a||o(a,s,e);if(!0!==c)throw new TypeError("option "+s+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+s)}},validators:i}},9395:(e,t,r)=>{"use strict";var n=r(1269),i=Object.prototype.toString;function s(e){return Array.isArray(e)}function o(e){return void 0===e}function a(e){return"[object ArrayBuffer]"===i.call(e)}function c(e){return null!==e&&"object"==typeof e}function d(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===i.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:s,isArrayBuffer:a,isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===i.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&a(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:c,isPlainObject:d,isUndefined:o,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:l,isStream:function(e){return c(e)&&l(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===i.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,n){d(t[n])&&d(r)?t[n]=e(t[n],r):d(r)?t[n]=e({},r):s(r)?t[n]=r.slice():t[n]=r}for(var n=0,i=arguments.length;n<i;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,(function(t,i){e[i]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},4203:(e,t,r)=>{"use strict";var n;r.d(t,{m:()=>a}),function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(n||(n={}));const i=(()=>{let e=0;return()=>e++})(),s=(new Error("unknown message type"),new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first")),o=new Error("called FFmpeg.terminate()");new Error("failed to import ffmpeg-core.js");class a{#e=null;#t={};#r={};#n=[];#i=[];loaded=!1;#s=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:t,data:r}})=>{switch(t){case n.LOAD:this.loaded=!0,this.#t[e](r);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:this.#t[e](r);break;case n.LOG:this.#n.forEach((e=>e(r)));break;case n.PROGRESS:this.#i.forEach((e=>e(r)));break;case n.ERROR:this.#r[e](r)}delete this.#t[e],delete this.#r[e]})};#o=({type:e,data:t},r=[],n)=>this.#e?new Promise(((s,o)=>{const a=i();this.#e&&this.#e.postMessage({id:a,type:e,data:t},r),this.#t[a]=s,this.#r[a]=o,n?.addEventListener("abort",(()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))}),{once:!0})})):Promise.reject(s);on(e,t){"log"===e?this.#n.push(t):"progress"===e&&this.#i.push(t)}off(e,t){"log"===e?this.#n=this.#n.filter((e=>e!==t)):"progress"===e&&(this.#i=this.#i.filter((e=>e!==t)))}load=({classWorkerURL:e,...t}={},{signal:i}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,"file:///Users/saitarunwork/Documents/Work/PingBase/Repositories/pb-connect/node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(new URL(r.p+r.u(138),r.b),{type:void 0}),this.#s()),this.#o({type:n.LOAD,data:t},void 0,i));exec=(e,t=-1,{signal:r}={})=>this.#o({type:n.EXEC,data:{args:e,timeout:t}},void 0,r);terminate=()=>{const e=Object.keys(this.#r);for(const t of e)this.#r[t](o),delete this.#r[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,t,{signal:r}={})=>{const i=[];return t instanceof Uint8Array&&i.push(t.buffer),this.#o({type:n.WRITE_FILE,data:{path:e,data:t}},i,r)};mount=(e,t,r)=>this.#o({type:n.MOUNT,data:{fsType:e,options:t,mountPoint:r}},[]);unmount=e=>this.#o({type:n.UNMOUNT,data:{mountPoint:e}},[]);readFile=(e,t="binary",{signal:r}={})=>this.#o({type:n.READ_FILE,data:{path:e,encoding:t}},void 0,r);deleteFile=(e,{signal:t}={})=>this.#o({type:n.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:r}={})=>this.#o({type:n.RENAME,data:{oldPath:e,newPath:t}},void 0,r);createDir=(e,{signal:t}={})=>this.#o({type:n.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#o({type:n.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#o({type:n.DELETE_DIR,data:{path:e}},void 0,t)}},4856:(e,t,r)=>{"use strict";r.d(t,{X:()=>s});var n=r(8168),i=r(5419);function s(e,t,r){return void 0===e||(0,i.g)(e)?t:(0,n.A)({},t,{ownerState:(0,n.A)({},t.ownerState,r)})}},4718:(e,t,r)=>{"use strict";function n(e,t=[]){if(void 0===e)return{};const r={};return Object.keys(e).filter((r=>r.match(/^on[A-Z]/)&&"function"==typeof e[r]&&!t.includes(r))).forEach((t=>{r[t]=e[t]})),r}r.d(t,{h:()=>n})},5419:(e,t,r)=>{"use strict";function n(e){return"string"==typeof e}r.d(t,{g:()=>n})},3551:(e,t,r)=>{"use strict";r.d(t,{p:()=>a});var n=r(8168),i=r(4164),s=r(4718);function o(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"==typeof e[t]))).forEach((r=>{t[r]=e[r]})),t}function a(e){const{getSlotProps:t,additionalProps:r,externalSlotProps:a,externalForwardedProps:c,className:d}=e;if(!t){const e=(0,i.A)(null==r?void 0:r.className,d,null==c?void 0:c.className,null==a?void 0:a.className),t=(0,n.A)({},null==r?void 0:r.style,null==c?void 0:c.style,null==a?void 0:a.style),s=(0,n.A)({},r,c,a);return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const l=(0,s.h)((0,n.A)({},c,a)),u=o(a),h=o(c),p=t(l),m=(0,i.A)(null==p?void 0:p.className,null==r?void 0:r.className,d,null==c?void 0:c.className,null==a?void 0:a.className),f=(0,n.A)({},null==p?void 0:p.style,null==r?void 0:r.style,null==c?void 0:c.style,null==a?void 0:a.style),g=(0,n.A)({},p,r,h,u);return m.length>0&&(g.className=m),Object.keys(f).length>0&&(g.style=f),{props:g,internalRef:p.ref}}},5489:(e,t,r)=>{"use strict";function n(e,t,r){return"function"==typeof e?e(t,r):e}r.d(t,{Y:()=>n})},3753:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M20 3h-1V2c0-.55-.45-1-1-1s-1 .45-1 1v1H7V2c0-.55-.45-1-1-1s-1 .45-1 1v1H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-1 18H5c-.55 0-1-.45-1-1V8h16v12c0 .55-.45 1-1 1"}),"CalendarTodayRounded")},7195:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"m4.51 15.48 2-1.59c.48-.38.76-.96.76-1.57v-2.6c3.02-.98 6.29-.99 9.32 0v2.61c0 .61.28 1.19.76 1.57l1.99 1.58c.8.63 1.94.57 2.66-.15l1.22-1.22c.8-.8.8-2.13-.05-2.88-6.41-5.66-16.07-5.66-22.48 0-.85.75-.85 2.08-.05 2.88l1.22 1.22c.71.72 1.85.78 2.65.15"}),"CallEndRounded")},1031:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79zm9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75zM7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1"}),"CallOutlined")},1832:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"m19.23 15.26-2.54-.29c-.61-.07-1.21.14-1.64.57l-1.84 1.84c-2.83-1.44-5.15-3.75-6.59-6.59l1.85-1.85c.43-.43.64-1.03.57-1.64l-.29-2.52c-.12-1.01-.97-1.77-1.99-1.77H5.03c-1.13 0-2.07.94-2 2.07.53 8.54 7.36 15.36 15.89 15.89 1.13.07 2.07-.87 2.07-2v-1.73c.01-1.01-.75-1.86-1.76-1.98"}),"CallRounded")},4115:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M21.29 4.12 16.7 8.71l1.59 1.59c.63.63.18 1.71-.71 1.71H13c-.55 0-1-.45-1-1v-4.6c0-.89 1.08-1.34 1.71-.71l1.59 1.59 4.59-4.59c.39-.39 1.02-.39 1.41 0 .38.4.38 1.03-.01 1.42M4.12 21.29l4.59-4.59 1.59 1.59c.63.63 1.71.18 1.71-.71V13c0-.55-.45-1-1-1h-4.6c-.89 0-1.34 1.08-.71 1.71l1.59 1.59-4.59 4.59c-.39.39-.39 1.02 0 1.41.4.38 1.03.38 1.42-.01"}),"CloseFullscreenRounded")},9696:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M18.3 5.71a.9959.9959 0 0 0-1.41 0L12 10.59 7.11 5.7a.9959.9959 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"}),"CloseRounded")},6398:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M8 18c.55 0 1-.45 1-1V7c0-.55-.45-1-1-1s-1 .45-1 1v10c0 .55.45 1 1 1m4 4c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1s-1 .45-1 1v18c0 .55.45 1 1 1m-8-8c.55 0 1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1v2c0 .55.45 1 1 1m12 4c.55 0 1-.45 1-1V7c0-.55-.45-1-1-1s-1 .45-1 1v10c0 .55.45 1 1 1m3-7v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1"}),"GraphicEqRounded")},6862:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M8.12 9.29 12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7a.9959.9959 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"}),"KeyboardArrowDownRounded")},5979:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"m19.23 15.26-2.54-.29c-.61-.07-1.21.14-1.64.57l-1.84 1.84c-2.83-1.44-5.15-3.75-6.59-6.59l1.85-1.85c.43-.43.64-1.03.57-1.64l-.29-2.52c-.12-1.01-.97-1.77-1.99-1.77H5.03c-1.13 0-2.07.94-2 2.07.53 8.54 7.36 15.36 15.89 15.89 1.13.07 2.07-.87 2.07-2v-1.73c.01-1.01-.75-1.86-1.76-1.98"}),"LocalPhoneRounded")},2250:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic")},2862:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92z"}),"MicNoneOutlined")},1809:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff")},1783:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M15 10.6V5c0-1.66-1.34-3-3-3-1.54 0-2.79 1.16-2.96 2.65zm3.08.4c-.41 0-.77.3-.83.71-.05.32-.12.64-.22.93l1.27 1.27c.3-.6.52-1.25.63-1.94.07-.51-.33-.97-.85-.97M3.71 3.56c-.39.39-.39 1.02 0 1.41L9 10.27v.43c0 1.19.6 2.32 1.63 2.91.75.43 1.41.44 2.02.31l1.66 1.66c-.71.33-1.5.52-2.31.52-2.54 0-4.88-1.77-5.25-4.39-.06-.41-.42-.71-.83-.71-.52 0-.92.46-.85.97.46 2.96 2.96 5.3 5.93 5.75V20c0 .55.45 1 1 1s1-.45 1-1v-2.28c.91-.13 1.77-.45 2.55-.9l3.49 3.49c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L5.12 3.56a.9959.9959 0 0 0-1.41 0"}),"MicOffRounded")},2561:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14"}),"MicRounded")},3754:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M21 8.59V4c0-.55-.45-1-1-1h-4.59c-.89 0-1.34 1.08-.71 1.71l1.59 1.59-10 10-1.59-1.59c-.62-.63-1.7-.19-1.7.7V20c0 .55.45 1 1 1h4.59c.89 0 1.34-1.08.71-1.71L7.71 17.7l10-10 1.59 1.59c.62.63 1.7.19 1.7-.7"}),"OpenInFullRounded")},5024:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M10 16c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1s-1 .45-1 1v6c0 .55.45 1 1 1m2-14C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m2-4c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1s-1 .45-1 1v6c0 .55.45 1 1 1"}),"PauseCircleOutlineRounded")},6707:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M23.09 16.2c-6.33-5.59-15.86-5.59-22.18 0-.84.74-.84 2.05-.05 2.84l1.2 1.2c.71.71 1.84.77 2.62.15l1.97-1.57c.47-.37.75-.94.75-1.55V14.7c2.98-.97 6.21-.98 9.2 0v2.58c0 .6.28 1.17.75 1.55l1.96 1.56c.79.62 1.91.56 2.62-.15l1.2-1.2c.8-.79.79-2.1-.04-2.84M6 9c.55 0 1-.45 1-1V6.43l4.24 4.24c.39.39 1.02.39 1.41 0l5.66-5.66c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0l-4.95 4.95L8.4 5H10c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1"}),"PhoneMissedRounded")},9521:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18c.62-.39.62-1.29 0-1.69L9.54 5.98C8.87 5.55 8 6.03 8 6.82"}),"PlayArrowRounded")},8104:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"m10.8 15.9 4.67-3.5c.27-.2.27-.6 0-.8L10.8 8.1c-.33-.25-.8-.01-.8.4v7c0 .41.47.65.8.4M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"PlayCircleOutlineRounded")},2717:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonChecked")},3572:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"ReplayOutlined")},8636:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2zM4 16V6h16v10.01zm9-6.87c-3.89.54-5.44 3.2-6 5.87 1.39-1.87 3.22-2.72 6-2.72v2.19l4-3.74L13 7z"}),"ScreenShareOutlined")},6526:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"m3.4 20.4 17.45-7.48c.81-.35.81-1.49 0-1.84L3.4 3.6c-.66-.29-1.39.2-1.39.91L2 9.12c0 .5.37.93.87.99L17 12 2.87 13.88c-.5.07-.87.5-.87 1l.01 4.61c0 .71.73 1.2 1.39.91"}),"SendRounded")},8947:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m4-4H8V8h8z"}),"StopCircleOutlined")},1756:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"m9.56 8-2-2-4.15-4.14L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.55-.18L19.73 21l1.41-1.41-8.86-8.86zM5 16V8h1.73l8 8zm10-8v2.61l6 6V6.5l-4 4V7c0-.55-.45-1-1-1h-5.61l2 2z"}),"VideocamOffOutlined")},6493:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M15 8v8H5V8zm1-2H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4V7c0-.55-.45-1-1-1"}),"VideocamOutlined")},7149:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)((0,s.jsx)("path",{d:"M3 10v4c0 .55.45 1 1 1h3l3.29 3.29c.63.63 1.71.18 1.71-.71V6.41c0-.89-1.08-1.34-1.71-.71L7 9H4c-.55 0-1 .45-1 1m13.5 2c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 4.45v.2c0 .38.25.71.6.85C17.18 6.53 19 9.06 19 12s-1.82 5.47-4.4 6.5c-.36.14-.6.47-.6.85v.2c0 .63.63 1.07 1.21.85C18.6 19.11 21 15.84 21 12s-2.4-7.11-5.79-8.4c-.58-.23-1.21.22-1.21.85"}),"VolumeUpRounded")},2480:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)([(0,s.jsx)("path",{d:"M4 19V8h16v3.29c.72.22 1.4.54 2 .97V8c0-1.11-.89-2-2-2h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h7.68c-.3-.62-.5-1.29-.6-2zm6-15h4v2h-4z"},"0"),(0,s.jsx)("path",{d:"M18 13c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m1.65 7.35L17.5 18.2V15h1v2.79l1.85 1.85z"},"1")],"WorkHistoryOutlined")},4285:(e,t,r)=>{"use strict";var n=r(4994);t.A=void 0;var i=n(r(2032)),s=r(4848);t.A=(0,i.default)([(0,s.jsx)("path",{d:"M18 11c1.49 0 2.87.47 4 1.26V8c0-1.11-.89-2-2-2h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h7.68c-.43-.91-.68-1.92-.68-3 0-3.87 3.13-7 7-7m-8-7h4v2h-4z"},"0"),(0,s.jsx)("path",{d:"M18 13c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m1.65 7.35L17.5 18.2V15h1v2.79l1.85 1.85z"},"1")],"WorkHistoryRounded")},8393:(e,t,r)=>{"use strict";r.d(t,{A:()=>C});var n=r(8587),i=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(1848),d=r(3541),l=r(5003),u=r(4848);const h=(0,l.A)((0,u.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");var p=r(7553),m=r(7245);function f(e){return(0,m.Ay)("MuiAvatar",e)}(0,p.A)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var g=r(4871),v=r(5489),y=r(3551),_=r(4856);const S=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],T=["component","slots","slotProps"],E=["component"],b=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],w=(0,c.Ay)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],r.colorDefault&&t.colorDefault]}})((({theme:e})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(e.vars||e).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:(0,i.A)({color:(e.vars||e).palette.background.default},e.vars?{backgroundColor:e.vars.palette.Avatar.defaultBg}:(0,i.A)({backgroundColor:e.palette.grey[400]},e.applyStyles("dark",{backgroundColor:e.palette.grey[600]})))}]}))),k=(0,c.Ay)("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,t)=>t.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),R=(0,c.Ay)(h,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,t)=>t.fallback})({width:"75%",height:"75%"}),C=s.forwardRef((function(e,t){const r=(0,d.A)({props:e,name:"MuiAvatar"}),{alt:c,children:l,className:h,component:p="div",slots:m={},slotProps:C={},imgProps:I,sizes:A,src:P,srcSet:D,variant:O="circular"}=r,M=(0,n.A)(r,b);let N=null;const x=function({crossOrigin:e,referrerPolicy:t,src:r,srcSet:n}){const[i,o]=s.useState(!1);return s.useEffect((()=>{if(!r&&!n)return;o(!1);let i=!0;const s=new Image;return s.onload=()=>{i&&o("loaded")},s.onerror=()=>{i&&o("error")},s.crossOrigin=e,s.referrerPolicy=t,s.src=r,n&&(s.srcset=n),()=>{i=!1}}),[e,t,r,n]),i}((0,i.A)({},I,{src:P,srcSet:D})),L=P||D,U=L&&"error"!==x,j=(0,i.A)({},r,{colorDefault:!U,component:p,variant:O}),F=(e=>{const{classes:t,variant:r,colorDefault:n}=e,i={root:["root",r,n&&"colorDefault"],img:["img"],fallback:["fallback"]};return(0,a.A)(i,f,t)})(j),[V,B]=function(e,t){const{className:r,elementType:s,ownerState:o,externalForwardedProps:a,getSlotOwnerState:c,internalForwardedProps:d}=t,l=(0,n.A)(t,S),{component:u,slots:h={[e]:void 0},slotProps:p={[e]:void 0}}=a,m=(0,n.A)(a,T),f=h[e]||s,b=(0,v.Y)(p[e],o),w=(0,y.p)((0,i.A)({className:r},l,{externalForwardedProps:"root"===e?m:void 0,externalSlotProps:b})),{props:{component:k},internalRef:R}=w,C=(0,n.A)(w.props,E),I=(0,g.A)(R,null==b?void 0:b.ref,t.ref),A=c?c(C):{},P=(0,i.A)({},o,A),D="root"===e?k||u:k,O=(0,_.X)(f,(0,i.A)({},"root"===e&&!u&&!h[e]&&d,"root"!==e&&!h[e]&&d,C,D&&{as:D},{ref:I}),P);return Object.keys(A).forEach((e=>{delete O[e]})),[f,O]}("img",{className:F.img,elementType:k,externalForwardedProps:{slots:m,slotProps:{img:(0,i.A)({},I,C.img)}},additionalProps:{alt:c,src:P,srcSet:D,sizes:A},ownerState:j});return N=U?(0,u.jsx)(V,(0,i.A)({},B)):l||0===l?l:L&&c?c[0]:(0,u.jsx)(R,{ownerState:j,className:F.fallback}),(0,u.jsx)(w,(0,i.A)({as:p,ownerState:j,className:(0,o.A)(F.root,h),ref:t},M,{children:N}))}))},9067:(e,t,r)=>{"use strict";r.d(t,{A:()=>_});var n=r(8168),i=r(8587),s=r(6540),o=r(4164),a=r(4317),c=r(3571),d=r(9599),l=r(2858),u=r(4848);const h=["className","component"];var p=r(2067),m=r(3333),f=r(8312);const g=(0,r(7553).A)("MuiBox",["root"]),v=(0,m.A)(),y=function(e={}){const{themeId:t,defaultTheme:r,defaultClassName:p="MuiBox-root",generateClassName:m}=e,f=(0,a.Ay)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(c.A);return s.forwardRef((function(e,s){const a=(0,l.A)(r),c=(0,d.A)(e),{className:g,component:v="div"}=c,y=(0,i.A)(c,h);return(0,u.jsx)(f,(0,n.A)({as:v,ref:s,className:(0,o.A)(g,m?m(p):p),theme:t&&a[t]||a},y))}))}({themeId:f.A,defaultTheme:v,defaultClassName:g.root,generateClassName:p.A.generate}),_=y},6990:(e,t,r)=>{"use strict";r.d(t,{A:()=>R});var n=r(8587),i=r(8168),s=r(6540),o=r(4164),a=r(6311),c=r(4111),d=r(4279),l=r(1848),u=r(3541),h=r(8941),p=r(8466),m=r(7553),f=r(7245);function g(e){return(0,f.Ay)("MuiButton",e)}const v=(0,m.A)("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),y=s.createContext({}),_=s.createContext(void 0);var S=r(4848);const T=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],E=e=>(0,i.A)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),b=(0,l.Ay)(h.A,{shouldForwardProp:e=>(0,l.ep)(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`${r.variant}${(0,p.A)(r.color)}`],t[`size${(0,p.A)(r.size)}`],t[`${r.variant}Size${(0,p.A)(r.size)}`],"inherit"===r.color&&t.colorInherit,r.disableElevation&&t.disableElevation,r.fullWidth&&t.fullWidth]}})((({theme:e,ownerState:t})=>{var r,n;const s="light"===e.palette.mode?e.palette.grey[300]:e.palette.grey[800],o="light"===e.palette.mode?e.palette.grey.A100:e.palette.grey[700];return(0,i.A)({},e.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),"&:hover":(0,i.A)({textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,d.X4)(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===t.variant&&"inherit"!==t.color&&{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,d.X4)(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===t.variant&&"inherit"!==t.color&&{border:`1px solid ${(e.vars||e).palette[t.color].main}`,backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,d.X4)(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===t.variant&&{backgroundColor:e.vars?e.vars.palette.Button.inheritContainedHoverBg:o,boxShadow:(e.vars||e).shadows[4],"@media (hover: none)":{boxShadow:(e.vars||e).shadows[2],backgroundColor:(e.vars||e).palette.grey[300]}},"contained"===t.variant&&"inherit"!==t.color&&{backgroundColor:(e.vars||e).palette[t.color].dark,"@media (hover: none)":{backgroundColor:(e.vars||e).palette[t.color].main}}),"&:active":(0,i.A)({},"contained"===t.variant&&{boxShadow:(e.vars||e).shadows[8]}),[`&.${v.focusVisible}`]:(0,i.A)({},"contained"===t.variant&&{boxShadow:(e.vars||e).shadows[6]}),[`&.${v.disabled}`]:(0,i.A)({color:(e.vars||e).palette.action.disabled},"outlined"===t.variant&&{border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"contained"===t.variant&&{color:(e.vars||e).palette.action.disabled,boxShadow:(e.vars||e).shadows[0],backgroundColor:(e.vars||e).palette.action.disabledBackground})},"text"===t.variant&&{padding:"6px 8px"},"text"===t.variant&&"inherit"!==t.color&&{color:(e.vars||e).palette[t.color].main},"outlined"===t.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===t.variant&&"inherit"!==t.color&&{color:(e.vars||e).palette[t.color].main,border:e.vars?`1px solid rgba(${e.vars.palette[t.color].mainChannel} / 0.5)`:`1px solid ${(0,d.X4)(e.palette[t.color].main,.5)}`},"contained"===t.variant&&{color:e.vars?e.vars.palette.text.primary:null==(r=(n=e.palette).getContrastText)?void 0:r.call(n,e.palette.grey[300]),backgroundColor:e.vars?e.vars.palette.Button.inheritContainedBg:s,boxShadow:(e.vars||e).shadows[2]},"contained"===t.variant&&"inherit"!==t.color&&{color:(e.vars||e).palette[t.color].contrastText,backgroundColor:(e.vars||e).palette[t.color].main},"inherit"===t.color&&{color:"inherit",borderColor:"currentColor"},"small"===t.size&&"text"===t.variant&&{padding:"4px 5px",fontSize:e.typography.pxToRem(13)},"large"===t.size&&"text"===t.variant&&{padding:"8px 11px",fontSize:e.typography.pxToRem(15)},"small"===t.size&&"outlined"===t.variant&&{padding:"3px 9px",fontSize:e.typography.pxToRem(13)},"large"===t.size&&"outlined"===t.variant&&{padding:"7px 21px",fontSize:e.typography.pxToRem(15)},"small"===t.size&&"contained"===t.variant&&{padding:"4px 10px",fontSize:e.typography.pxToRem(13)},"large"===t.size&&"contained"===t.variant&&{padding:"8px 22px",fontSize:e.typography.pxToRem(15)},t.fullWidth&&{width:"100%"})}),(({ownerState:e})=>e.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${v.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${v.disabled}`]:{boxShadow:"none"}})),w=(0,l.Ay)("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.startIcon,t[`iconSize${(0,p.A)(r.size)}`]]}})((({ownerState:e})=>(0,i.A)({display:"inherit",marginRight:8,marginLeft:-4},"small"===e.size&&{marginLeft:-2},E(e)))),k=(0,l.Ay)("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.endIcon,t[`iconSize${(0,p.A)(r.size)}`]]}})((({ownerState:e})=>(0,i.A)({display:"inherit",marginRight:-4,marginLeft:8},"small"===e.size&&{marginRight:-2},E(e)))),R=s.forwardRef((function(e,t){const r=s.useContext(y),d=s.useContext(_),l=(0,a.A)(r,e),h=(0,u.A)({props:l,name:"MuiButton"}),{children:m,color:f="primary",component:v="button",className:E,disabled:R=!1,disableElevation:C=!1,disableFocusRipple:I=!1,endIcon:A,focusVisibleClassName:P,fullWidth:D=!1,size:O="medium",startIcon:M,type:N,variant:x="text"}=h,L=(0,n.A)(h,T),U=(0,i.A)({},h,{color:f,component:v,disabled:R,disableElevation:C,disableFocusRipple:I,fullWidth:D,size:O,type:N,variant:x}),j=(e=>{const{color:t,disableElevation:r,fullWidth:n,size:s,variant:o,classes:a}=e,d={root:["root",o,`${o}${(0,p.A)(t)}`,`size${(0,p.A)(s)}`,`${o}Size${(0,p.A)(s)}`,"inherit"===t&&"colorInherit",r&&"disableElevation",n&&"fullWidth"],label:["label"],startIcon:["startIcon",`iconSize${(0,p.A)(s)}`],endIcon:["endIcon",`iconSize${(0,p.A)(s)}`]},l=(0,c.A)(d,g,a);return(0,i.A)({},a,l)})(U),F=M&&(0,S.jsx)(w,{className:j.startIcon,ownerState:U,children:M}),V=A&&(0,S.jsx)(k,{className:j.endIcon,ownerState:U,children:A}),B=d||"";return(0,S.jsxs)(b,(0,i.A)({ownerState:U,className:(0,o.A)(r.className,j.root,E,B),component:v,disabled:R,focusRipple:!I,focusVisibleClassName:(0,o.A)(j.focusVisible,P),ref:t,type:N},L,{classes:j,children:[F,m,V]}))}))},538:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var n=r(8587),i=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(4279),d=r(1848);const l=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};var u=r(3541),h=r(7553),p=r(7245);function m(e){return(0,p.Ay)("MuiPaper",e)}(0,h.A)("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);var f=r(4848);const g=["className","component","elevation","square","variant"],v=(0,d.Ay)("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],!r.square&&t.rounded,"elevation"===r.variant&&t[`elevation${r.elevation}`]]}})((({theme:e,ownerState:t})=>{var r;return(0,i.A)({backgroundColor:(e.vars||e).palette.background.paper,color:(e.vars||e).palette.text.primary,transition:e.transitions.create("box-shadow")},!t.square&&{borderRadius:e.shape.borderRadius},"outlined"===t.variant&&{border:`1px solid ${(e.vars||e).palette.divider}`},"elevation"===t.variant&&(0,i.A)({boxShadow:(e.vars||e).shadows[t.elevation]},!e.vars&&"dark"===e.palette.mode&&{backgroundImage:`linear-gradient(${(0,c.X4)("#fff",l(t.elevation))}, ${(0,c.X4)("#fff",l(t.elevation))})`},e.vars&&{backgroundImage:null==(r=e.vars.overlays)?void 0:r[t.elevation]}))})),y=s.forwardRef((function(e,t){const r=(0,u.A)({props:e,name:"MuiPaper"}),{className:s,component:c="div",elevation:d=1,square:l=!1,variant:h="elevation"}=r,p=(0,n.A)(r,g),y=(0,i.A)({},r,{component:c,elevation:d,square:l,variant:h}),_=(e=>{const{square:t,elevation:r,variant:n,classes:i}=e,s={root:["root",n,!t&&"rounded","elevation"===n&&`elevation${r}`]};return(0,a.A)(s,m,i)})(y);return(0,f.jsx)(v,(0,i.A)({as:c,ownerState:y,className:(0,o.A)(_.root,s),ref:t},p))}))},7254:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var n=r(8587),i=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(3541),d=r(1848),l=r(4848);var u=r(7553),h=r(7245);function p(e){return(0,h.Ay)("MuiScopedCssBaseline",e)}(0,u.A)("MuiScopedCssBaseline",["root"]);const m=["className","component","enableColorScheme"],f=(0,d.Ay)("div",{name:"MuiScopedCssBaseline",slot:"Root",overridesResolver:(e,t)=>t.root})((({theme:e,ownerState:t})=>{const r={};return t.enableColorScheme&&e.colorSchemes&&Object.entries(e.colorSchemes).forEach((([t,n])=>{var i;r[`&${e.getColorSchemeSelector(t).replace(/\s*&/,"")}`]={colorScheme:null==(i=n.palette)?void 0:i.mode}})),(0,i.A)({},((e,t)=>(0,i.A)({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%"},t&&!e.vars&&{colorScheme:e.palette.mode}))(e,t.enableColorScheme),(e=>(0,i.A)({color:(e.vars||e).palette.text.primary},e.typography.body1,{backgroundColor:(e.vars||e).palette.background.default,"@media print":{backgroundColor:(e.vars||e).palette.common.white}}))(e),{"& *, & *::before, & *::after":{boxSizing:"inherit"},"& strong, & b":{fontWeight:e.typography.fontWeightBold}},r)})),g=s.forwardRef((function(e,t){const r=(0,c.A)({props:e,name:"MuiScopedCssBaseline"}),{className:s,component:d="div"}=r,u=(0,n.A)(r,m),h=(0,i.A)({},r,{component:d}),g=(e=>{const{classes:t}=e;return(0,a.A)({root:["root"]},p,t)})(h);return(0,l.jsx)(f,(0,i.A)({as:d,className:(0,o.A)(g.root,s),ref:t,ownerState:h},u))}))},1015:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>re});var n=r(8587),i=r(8168),s=r(6540),o=r(4164),a=r(4111),c=r(4871),d=r(4856),l=r(3551),u=r(5489);const h=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function p(e){var t;const{elementType:r,externalSlotProps:s,ownerState:o,skipResolvingSlotProps:a=!1}=e,p=(0,n.A)(e,h),m=a?{}:(0,u.Y)(s,o),{props:f,internalRef:g}=(0,l.p)((0,i.A)({},p,{externalSlotProps:m})),v=(0,c.A)(g,null==m?void 0:m.ref,null==(t=e.additionalProps)?void 0:t.ref);return(0,d.X)(r,(0,i.A)({},f,{ref:v}),o)}var m=r(5419),f=r(6249),g=r(3833),v=r(6937),y=r(7749),_=r(173),S=r(6111);const T={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:-1,overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};var E=r(4718);function b(e,t){return e-t}function w(e,t){var r;const{index:n}=null!=(r=e.reduce(((e,r,n)=>{const i=Math.abs(t-r);return null===e||i<e.distance||i===e.distance?{distance:i,index:n}:e}),null))?r:{};return n}function k(e,t){if(void 0!==t.current&&e.changedTouches){const r=e;for(let e=0;e<r.changedTouches.length;e+=1){const n=r.changedTouches[e];if(n.identifier===t.current)return{x:n.clientX,y:n.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function R(e,t,r){return 100*(e-t)/(r-t)}function C({values:e,newValue:t,index:r}){const n=e.slice();return n[r]=t,n.sort(b)}function I({sliderRef:e,activeIndex:t,setActive:r}){var n,i;const s=(0,f.A)(e.current);var o;null!=(n=e.current)&&n.contains(s.activeElement)&&Number(null==s||null==(i=s.activeElement)?void 0:i.getAttribute("data-index"))===t||null==(o=e.current)||o.querySelector(`[type="range"][data-index="${t}"]`).focus(),r&&r(t)}function A(e,t){return"number"==typeof e&&"number"==typeof t?e===t:"object"==typeof e&&"object"==typeof t&&function(e,t,r=((e,t)=>e===t)){return e.length===t.length&&e.every(((e,n)=>r(e,t[n])))}(e,t)}const P={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},D=e=>e;let O;function M(){return void 0===O&&(O="undefined"==typeof CSS||"function"!=typeof CSS.supports||CSS.supports("touch-action","none")),O}function N(e){const{"aria-labelledby":t,defaultValue:r,disabled:n=!1,disableSwap:o=!1,isRtl:a=!1,marks:d=!1,max:l=100,min:u=0,name:h,onChange:p,onChangeCommitted:m,orientation:O="horizontal",rootRef:N,scale:x=D,step:L=1,shiftStep:U=10,tabIndex:j,value:F}=e,V=s.useRef(),[B,H]=s.useState(-1),[W,G]=s.useState(-1),[q,$]=s.useState(!1),z=s.useRef(0),[J,K]=(0,g.A)({controlled:F,default:null!=r?r:u,name:"Slider"}),Q=p&&((e,t,r)=>{const n=e.nativeEvent||e,i=new n.constructor(n.type,n);Object.defineProperty(i,"target",{writable:!0,value:{value:t,name:h}}),p(i,t,r)}),Y=Array.isArray(J);let X=Y?J.slice().sort(b):[J];X=X.map((e=>null==e?u:(0,v.A)(e,u,l)));const Z=!0===d&&null!==L?[...Array(Math.floor((l-u)/L)+1)].map(((e,t)=>({value:u+L*t}))):d||[],ee=Z.map((e=>e.value)),{isFocusVisibleRef:te,onBlur:re,onFocus:ne,ref:ie}=(0,y.A)(),[se,oe]=s.useState(-1),ae=s.useRef(),ce=(0,c.A)(ie,ae),de=(0,c.A)(N,ce),le=e=>t=>{var r;const n=Number(t.currentTarget.getAttribute("data-index"));ne(t),!0===te.current&&oe(n),G(n),null==e||null==(r=e.onFocus)||r.call(e,t)},ue=e=>t=>{var r;re(t),!1===te.current&&oe(-1),G(-1),null==e||null==(r=e.onBlur)||r.call(e,t)},he=(e,t)=>{const r=Number(e.currentTarget.getAttribute("data-index")),n=X[r],i=ee.indexOf(n);let s=t;if(Z&&null==L){const e=ee[ee.length-1];s=s>e?e:s<ee[0]?ee[0]:s<n?ee[i-1]:ee[i+1]}if(s=(0,v.A)(s,u,l),Y){o&&(s=(0,v.A)(s,X[r-1]||-1/0,X[r+1]||1/0));const e=s;s=C({values:X,newValue:s,index:r});let t=r;o||(t=s.indexOf(e)),I({sliderRef:ae,activeIndex:t})}K(s),oe(r),Q&&!A(s,J)&&Q(e,s,r),m&&m(e,s)},pe=e=>t=>{var r;if(null!==L){const e=Number(t.currentTarget.getAttribute("data-index")),r=X[e];let n=null;("ArrowLeft"===t.key||"ArrowDown"===t.key)&&t.shiftKey||"PageDown"===t.key?n=Math.max(r-U,u):(("ArrowRight"===t.key||"ArrowUp"===t.key)&&t.shiftKey||"PageUp"===t.key)&&(n=Math.min(r+U,l)),null!==n&&(he(t,n),t.preventDefault())}null==e||null==(r=e.onKeyDown)||r.call(e,t)};(0,_.A)((()=>{var e;n&&ae.current.contains(document.activeElement)&&(null==(e=document.activeElement)||e.blur())}),[n]),n&&-1!==B&&H(-1),n&&-1!==se&&oe(-1);const me=s.useRef();let fe=O;a&&"horizontal"===O&&(fe+="-reverse");const ge=({finger:e,move:t=!1})=>{const{current:r}=ae,{width:n,height:i,bottom:s,left:a}=r.getBoundingClientRect();let c,d;if(c=0===fe.indexOf("vertical")?(s-e.y)/i:(e.x-a)/n,-1!==fe.indexOf("-reverse")&&(c=1-c),d=function(e,t,r){return(r-t)*e+t}(c,u,l),L)d=function(e,t,r){const n=Math.round((e-r)/t)*t+r;return Number(n.toFixed(function(e){if(Math.abs(e)<1){const t=e.toExponential().split("e-"),r=t[0].split(".")[1];return(r?r.length:0)+parseInt(t[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}(t)))}(d,L,u);else{const e=w(ee,d);d=ee[e]}d=(0,v.A)(d,u,l);let h=0;if(Y){h=t?me.current:w(X,d),o&&(d=(0,v.A)(d,X[h-1]||-1/0,X[h+1]||1/0));const e=d;d=C({values:X,newValue:d,index:h}),o&&t||(h=d.indexOf(e),me.current=h)}return{newValue:d,activeIndex:h}},ve=(0,S.A)((e=>{const t=k(e,V);if(!t)return;if(z.current+=1,"mousemove"===e.type&&0===e.buttons)return void ye(e);const{newValue:r,activeIndex:n}=ge({finger:t,move:!0});I({sliderRef:ae,activeIndex:n,setActive:H}),K(r),!q&&z.current>2&&$(!0),Q&&!A(r,J)&&Q(e,r,n)})),ye=(0,S.A)((e=>{const t=k(e,V);if($(!1),!t)return;const{newValue:r}=ge({finger:t,move:!0});H(-1),"touchend"===e.type&&G(-1),m&&m(e,r),V.current=void 0,Se()})),_e=(0,S.A)((e=>{if(n)return;M()||e.preventDefault();const t=e.changedTouches[0];null!=t&&(V.current=t.identifier);const r=k(e,V);if(!1!==r){const{newValue:t,activeIndex:n}=ge({finger:r});I({sliderRef:ae,activeIndex:n,setActive:H}),K(t),Q&&!A(t,J)&&Q(e,t,n)}z.current=0;const i=(0,f.A)(ae.current);i.addEventListener("touchmove",ve,{passive:!0}),i.addEventListener("touchend",ye,{passive:!0})})),Se=s.useCallback((()=>{const e=(0,f.A)(ae.current);e.removeEventListener("mousemove",ve),e.removeEventListener("mouseup",ye),e.removeEventListener("touchmove",ve),e.removeEventListener("touchend",ye)}),[ye,ve]);s.useEffect((()=>{const{current:e}=ae;return e.addEventListener("touchstart",_e,{passive:M()}),()=>{e.removeEventListener("touchstart",_e),Se()}}),[Se,_e]),s.useEffect((()=>{n&&Se()}),[n,Se]);const Te=R(Y?X[0]:u,u,l),Ee=R(X[X.length-1],u,l)-Te,be=e=>t=>{var r;null==(r=e.onMouseLeave)||r.call(e,t),G(-1)};return{active:B,axis:fe,axisProps:P,dragging:q,focusedThumbIndex:se,getHiddenInputProps:(r={})=>{var s;const o=(0,E.h)(r),c={onChange:(d=o||{},e=>{var t;null==(t=d.onChange)||t.call(d,e),he(e,e.target.valueAsNumber)}),onFocus:le(o||{}),onBlur:ue(o||{}),onKeyDown:pe(o||{})};var d;const p=(0,i.A)({},o,c);return(0,i.A)({tabIndex:j,"aria-labelledby":t,"aria-orientation":O,"aria-valuemax":x(l),"aria-valuemin":x(u),name:h,type:"range",min:e.min,max:e.max,step:null===e.step&&e.marks?"any":null!=(s=e.step)?s:void 0,disabled:n},r,p,{style:(0,i.A)({},T,{direction:a?"rtl":"ltr",width:"100%",height:"100%"})})},getRootProps:(e={})=>{const t=(0,E.h)(e),r={onMouseDown:(s=t||{},e=>{var t;if(null==(t=s.onMouseDown)||t.call(s,e),n)return;if(e.defaultPrevented)return;if(0!==e.button)return;e.preventDefault();const r=k(e,V);if(!1!==r){const{newValue:t,activeIndex:n}=ge({finger:r});I({sliderRef:ae,activeIndex:n,setActive:H}),K(t),Q&&!A(t,J)&&Q(e,t,n)}z.current=0;const i=(0,f.A)(ae.current);i.addEventListener("mousemove",ve,{passive:!0}),i.addEventListener("mouseup",ye)})};var s;const o=(0,i.A)({},t,r);return(0,i.A)({},e,{ref:de},o)},getThumbProps:(e={})=>{const t=(0,E.h)(e),r={onMouseOver:(n=t||{},e=>{var t;null==(t=n.onMouseOver)||t.call(n,e);const r=Number(e.currentTarget.getAttribute("data-index"));G(r)}),onMouseLeave:be(t||{})};var n;return(0,i.A)({},e,t,r)},marks:Z,open:W,range:Y,rootRef:de,trackLeap:Ee,trackOffset:Te,values:X,getThumbStyle:e=>({pointerEvents:-1!==B&&B!==e?"none":void 0})}}var x=r(4279),L=r(3541),U=r(1848),j=r(4675);var F=r(8466),V=r(7553),B=r(7245);function H(e){return(0,B.Ay)("MuiSlider",e)}const W=(0,V.A)("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]);var G=r(4848);const q=["aria-label","aria-valuetext","aria-labelledby","component","components","componentsProps","color","classes","className","disableSwap","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","orientation","shiftStep","size","step","scale","slotProps","slots","tabIndex","track","value","valueLabelDisplay","valueLabelFormat"];function $(e){return e}const z=(0,U.Ay)("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${(0,F.A)(r.color)}`],"medium"!==r.size&&t[`size${(0,F.A)(r.size)}`],r.marked&&t.marked,"vertical"===r.orientation&&t.vertical,"inverted"===r.track&&t.trackInverted,!1===r.track&&t.trackFalse]}})((({theme:e,ownerState:t})=>(0,i.A)({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:(e.vars||e).palette[t.color].main,WebkitTapHighlightColor:"transparent"},"horizontal"===t.orientation&&(0,i.A)({height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}},"small"===t.size&&{height:2},t.marked&&{marginBottom:20}),"vertical"===t.orientation&&(0,i.A)({height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}},"small"===t.size&&{width:2},t.marked&&{marginRight:44}),{"@media print":{colorAdjust:"exact"},[`&.${W.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${W.dragging}`]:{[`& .${W.thumb}, & .${W.track}`]:{transition:"none"}}}))),J=(0,U.Ay)("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})((({ownerState:e})=>(0,i.A)({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38},"horizontal"===e.orientation&&{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"},"vertical"===e.orientation&&{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"},"inverted"===e.track&&{opacity:1}))),K=(0,U.Ay)("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})((({theme:e,ownerState:t})=>{const r="light"===e.palette.mode?(0,x.a)(e.palette[t.color].main,.62):(0,x.e$)(e.palette[t.color].main,.5);return(0,i.A)({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest})},"small"===t.size&&{border:"none"},"horizontal"===t.orientation&&{height:"inherit",top:"50%",transform:"translateY(-50%)"},"vertical"===t.orientation&&{width:"inherit",left:"50%",transform:"translateX(-50%)"},!1===t.track&&{display:"none"},"inverted"===t.track&&{backgroundColor:e.vars?e.vars.palette.Slider[`${t.color}Track`]:r,borderColor:e.vars?e.vars.palette.Slider[`${t.color}Track`]:r})})),Q=(0,U.Ay)("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.thumb,t[`thumbColor${(0,F.A)(r.color)}`],"medium"!==r.size&&t[`thumbSize${(0,F.A)(r.size)}`]]}})((({theme:e,ownerState:t})=>(0,i.A)({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest})},"small"===t.size&&{width:12,height:12},"horizontal"===t.orientation&&{top:"50%",transform:"translate(-50%, -50%)"},"vertical"===t.orientation&&{left:"50%",transform:"translate(-50%, 50%)"},{"&::before":(0,i.A)({position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"small"===t.size&&{boxShadow:"none"}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&:hover, &.${W.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.16)`:(0,x.X4)(e.palette[t.color].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${W.active}`]:{boxShadow:`0px 0px 0px 14px ${e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.16)`:(0,x.X4)(e.palette[t.color].main,.16)}`},[`&.${W.disabled}`]:{"&:hover":{boxShadow:"none"}}}))),Y=(0,U.Ay)((function(e){const{children:t,className:r,value:n}=e,i=(e=>{const{open:t}=e;return{offset:(0,o.A)(t&&W.valueLabelOpen),circle:W.valueLabelCircle,label:W.valueLabelLabel}})(e);return t?s.cloneElement(t,{className:(0,o.A)(t.props.className)},(0,G.jsxs)(s.Fragment,{children:[t.props.children,(0,G.jsx)("span",{className:(0,o.A)(i.offset,r),"aria-hidden":!0,children:(0,G.jsx)("span",{className:i.circle,children:(0,G.jsx)("span",{className:i.label,children:n})})})]})):null}),{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})((({theme:e,ownerState:t})=>(0,i.A)({[`&.${W.valueLabelOpen}`]:{transform:("vertical"===t.orientation?"translateY(-50%)":"translateY(-100%)")+" scale(1)"},zIndex:1,whiteSpace:"nowrap"},e.typography.body2,{fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),transform:("vertical"===t.orientation?"translateY(-50%)":"translateY(-100%)")+" scale(0)",position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem"},"horizontal"===t.orientation&&{top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"}},"vertical"===t.orientation&&{right:"small"===t.size?"20px":"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"}},"small"===t.size&&{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}))),X=(0,U.Ay)("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>(0,U._n)(e)&&"markActive"!==e,overridesResolver:(e,t)=>{const{markActive:r}=e;return[t.mark,r&&t.markActive]}})((({theme:e,ownerState:t,markActive:r})=>(0,i.A)({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},"horizontal"===t.orientation&&{top:"50%",transform:"translate(-1px, -50%)"},"vertical"===t.orientation&&{left:"50%",transform:"translate(-50%, 1px)"},r&&{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}))),Z=(0,U.Ay)("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>(0,U._n)(e)&&"markLabelActive"!==e,overridesResolver:(e,t)=>t.markLabel})((({theme:e,ownerState:t,markLabelActive:r})=>(0,i.A)({},e.typography.body2,{color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap"},"horizontal"===t.orientation&&{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}},"vertical"===t.orientation&&{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}},r&&{color:(e.vars||e).palette.text.primary}))),ee=({children:e})=>e,te=s.forwardRef((function(e,t){var r,c,d,l,u,h,f,g,v,y,_,S,T,E,b,w,k,C,I,A,P,D,O,M;const x=(0,L.A)({props:e,name:"MuiSlider"}),U="rtl"===(0,j.A)().direction,{"aria-label":V,"aria-valuetext":B,"aria-labelledby":W,component:te="span",components:re={},componentsProps:ne={},color:ie="primary",classes:se,className:oe,disableSwap:ae=!1,disabled:ce=!1,getAriaLabel:de,getAriaValueText:le,marks:ue=!1,max:he=100,min:pe=0,orientation:me="horizontal",shiftStep:fe=10,size:ge="medium",step:ve=1,scale:ye=$,slotProps:_e,slots:Se,track:Te="normal",valueLabelDisplay:Ee="off",valueLabelFormat:be=$}=x,we=(0,n.A)(x,q),ke=(0,i.A)({},x,{isRtl:U,max:he,min:pe,classes:se,disabled:ce,disableSwap:ae,orientation:me,marks:ue,color:ie,size:ge,step:ve,shiftStep:fe,scale:ye,track:Te,valueLabelDisplay:Ee,valueLabelFormat:be}),{axisProps:Re,getRootProps:Ce,getHiddenInputProps:Ie,getThumbProps:Ae,open:Pe,active:De,axis:Oe,focusedThumbIndex:Me,range:Ne,dragging:xe,marks:Le,values:Ue,trackOffset:je,trackLeap:Fe,getThumbStyle:Ve}=N((0,i.A)({},ke,{rootRef:t}));ke.marked=Le.length>0&&Le.some((e=>e.label)),ke.dragging=xe,ke.focusedThumbIndex=Me;const Be=(e=>{const{disabled:t,dragging:r,marked:n,orientation:i,track:s,classes:o,color:c,size:d}=e,l={root:["root",t&&"disabled",r&&"dragging",n&&"marked","vertical"===i&&"vertical","inverted"===s&&"trackInverted",!1===s&&"trackFalse",c&&`color${(0,F.A)(c)}`,d&&`size${(0,F.A)(d)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",d&&`thumbSize${(0,F.A)(d)}`,c&&`thumbColor${(0,F.A)(c)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return(0,a.A)(l,H,o)})(ke),He=null!=(r=null!=(c=null==Se?void 0:Se.root)?c:re.Root)?r:z,We=null!=(d=null!=(l=null==Se?void 0:Se.rail)?l:re.Rail)?d:J,Ge=null!=(u=null!=(h=null==Se?void 0:Se.track)?h:re.Track)?u:K,qe=null!=(f=null!=(g=null==Se?void 0:Se.thumb)?g:re.Thumb)?f:Q,$e=null!=(v=null!=(y=null==Se?void 0:Se.valueLabel)?y:re.ValueLabel)?v:Y,ze=null!=(_=null!=(S=null==Se?void 0:Se.mark)?S:re.Mark)?_:X,Je=null!=(T=null!=(E=null==Se?void 0:Se.markLabel)?E:re.MarkLabel)?T:Z,Ke=null!=(b=null!=(w=null==Se?void 0:Se.input)?w:re.Input)?b:"input",Qe=null!=(k=null==_e?void 0:_e.root)?k:ne.root,Ye=null!=(C=null==_e?void 0:_e.rail)?C:ne.rail,Xe=null!=(I=null==_e?void 0:_e.track)?I:ne.track,Ze=null!=(A=null==_e?void 0:_e.thumb)?A:ne.thumb,et=null!=(P=null==_e?void 0:_e.valueLabel)?P:ne.valueLabel,tt=null!=(D=null==_e?void 0:_e.mark)?D:ne.mark,rt=null!=(O=null==_e?void 0:_e.markLabel)?O:ne.markLabel,nt=null!=(M=null==_e?void 0:_e.input)?M:ne.input,it=p({elementType:He,getSlotProps:Ce,externalSlotProps:Qe,externalForwardedProps:we,additionalProps:(0,i.A)({},(ht=He,(!ht||!(0,m.g)(ht))&&{as:te})),ownerState:(0,i.A)({},ke,null==Qe?void 0:Qe.ownerState),className:[Be.root,oe]}),st=p({elementType:We,externalSlotProps:Ye,ownerState:ke,className:Be.rail}),ot=p({elementType:Ge,externalSlotProps:Xe,additionalProps:{style:(0,i.A)({},Re[Oe].offset(je),Re[Oe].leap(Fe))},ownerState:(0,i.A)({},ke,null==Xe?void 0:Xe.ownerState),className:Be.track}),at=p({elementType:qe,getSlotProps:Ae,externalSlotProps:Ze,ownerState:(0,i.A)({},ke,null==Ze?void 0:Ze.ownerState),className:Be.thumb}),ct=p({elementType:$e,externalSlotProps:et,ownerState:(0,i.A)({},ke,null==et?void 0:et.ownerState),className:Be.valueLabel}),dt=p({elementType:ze,externalSlotProps:tt,ownerState:ke,className:Be.mark}),lt=p({elementType:Je,externalSlotProps:rt,ownerState:ke,className:Be.markLabel}),ut=p({elementType:Ke,getSlotProps:Ie,externalSlotProps:nt,ownerState:ke});var ht;return(0,G.jsxs)(He,(0,i.A)({},it,{children:[(0,G.jsx)(We,(0,i.A)({},st)),(0,G.jsx)(Ge,(0,i.A)({},ot)),Le.filter((e=>e.value>=pe&&e.value<=he)).map(((e,t)=>{const r=R(e.value,pe,he),n=Re[Oe].offset(r);let a;return a=!1===Te?-1!==Ue.indexOf(e.value):"normal"===Te&&(Ne?e.value>=Ue[0]&&e.value<=Ue[Ue.length-1]:e.value<=Ue[0])||"inverted"===Te&&(Ne?e.value<=Ue[0]||e.value>=Ue[Ue.length-1]:e.value>=Ue[0]),(0,G.jsxs)(s.Fragment,{children:[(0,G.jsx)(ze,(0,i.A)({"data-index":t},dt,!(0,m.g)(ze)&&{markActive:a},{style:(0,i.A)({},n,dt.style),className:(0,o.A)(dt.className,a&&Be.markActive)})),null!=e.label?(0,G.jsx)(Je,(0,i.A)({"aria-hidden":!0,"data-index":t},lt,!(0,m.g)(Je)&&{markLabelActive:a},{style:(0,i.A)({},n,lt.style),className:(0,o.A)(Be.markLabel,lt.className,a&&Be.markLabelActive),children:e.label})):null]},t)})),Ue.map(((e,t)=>{const r=R(e,pe,he),n=Re[Oe].offset(r),s="off"===Ee?ee:$e;return(0,G.jsx)(s,(0,i.A)({},!(0,m.g)(s)&&{valueLabelFormat:be,valueLabelDisplay:Ee,value:"function"==typeof be?be(ye(e),t):be,index:t,open:Pe===t||De===t||"on"===Ee,disabled:ce},ct,{children:(0,G.jsx)(qe,(0,i.A)({"data-index":t},at,{className:(0,o.A)(Be.thumb,at.className,De===t&&Be.active,Me===t&&Be.focusVisible),style:(0,i.A)({},n,Ve(t),at.style),children:(0,G.jsx)(Ke,(0,i.A)({"data-index":t,"aria-label":de?de(t):V,"aria-valuenow":ye(e),"aria-labelledby":W,"aria-valuetext":le?le(ye(e),t):B,value:Ue[t]},ut))}))}),t)}))]}))})),re=te},5793:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var n=r(8168),i=r(8587),s=r(6540);const o=s.createContext(null);function a(){return s.useContext(o)}const c="function"==typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__";var d=r(4848);const l=function(e){const{children:t,theme:r}=e,i=a(),l=s.useMemo((()=>{const e=null===i?r:function(e,t){return"function"==typeof t?t(e):(0,n.A)({},e,t)}(i,r);return null!=e&&(e[c]=null!==i),e}),[r,i]);return(0,d.jsx)(o.Provider,{value:l,children:t})};var u=r(5684),h=r(3951);const p={};function m(e,t,r,i=!1){return s.useMemo((()=>{const s=e&&t[e]||t;if("function"==typeof r){const o=r(s),a=e?(0,n.A)({},t,{[e]:o}):o;return i?()=>a:a}return e?(0,n.A)({},t,{[e]:r}):(0,n.A)({},t,r)}),[e,t,r,i])}const f=function(e){const{children:t,theme:r,themeId:n}=e,i=(0,h.A)(p),s=a()||p,o=m(n,i,r),c=m(n,s,r,!0);return(0,d.jsx)(l,{theme:c,children:(0,d.jsx)(u.T.Provider,{value:o,children:t})})};var g=r(8312);const v=["theme"];function y(e){let{theme:t}=e,r=(0,i.A)(e,v);const s=t[g.A];return(0,d.jsx)(f,(0,n.A)({},r,{themeId:s?g.A:void 0,theme:s||t}))}},1406:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(8168),i=r(5697);function s(e){return String(parseFloat(e)).length===String(e).length}function o(e){return parseFloat(e)}function a({lineHeight:e,pixels:t,htmlFontSize:r}){return t/(e*r)}function c(e,t={}){const{breakpoints:r=["sm","md","lg"],disableAlign:c=!1,factor:d=2,variants:l=["h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","caption","button","overline"]}=t,u=(0,n.A)({},e);u.typography=(0,n.A)({},u.typography);const h=u.typography,p=(f=h.htmlFontSize,(e,t)=>{const r=String(e).match(/[\d.\-+]*\s*(.*)/)[1]||"";if(r===t)return e;let n=o(e);"px"!==r&&("em"===r||"rem"===r)&&(n=o(e)*o(f));let i=n;if("px"!==t)if("em"===t)i=n/o(f);else{if("rem"!==t)return e;i=n/o(f)}return parseFloat(i.toFixed(5))+t}),m=r.map((e=>u.breakpoints.values[e]));var f;return l.forEach((e=>{const t=h[e],r=parseFloat(p(t.fontSize,"rem"));if(r<=1)return;const o=r,l=1+(o-1)/d;let{lineHeight:u}=t;if(!s(u)&&!c)throw new Error((0,i.A)(6));s(u)||(u=parseFloat(p(u,"rem"))/parseFloat(r));let f=null;c||(f=e=>function({size:e,grid:t}){const r=e-e%t,n=r+t;return e-r<n-e?r:n}({size:e,grid:a({pixels:4,lineHeight:u,htmlFontSize:h.htmlFontSize})})),h[e]=(0,n.A)({},t,function({cssProperty:e,min:t,max:r,unit:n="rem",breakpoints:i=[600,900,1200],transform:s=null}){const o={[e]:`${t}${n}`},a=(r-t)/i[i.length-1];return i.forEach((r=>{let i=t+a*r;null!==s&&(i=s(i)),o[`@media (min-width:${r}px)`]={[e]:`${Math.round(1e4*i)/1e4}${n}`}})),o}({cssProperty:"fontSize",min:l,max:o,unit:"rem",breakpoints:m,transform:f}))})),u}},6880:function(e){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),s=e.getVersionPrecision(r),o=Math.max(i,s),a=0,c=e.map([t,r],(function(t){var r=o-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(a=o-Math.min(i,s)),o-=1;o>=a;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===a)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var a=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=s.length;t<r;t+=1)a();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},s=r(18);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&o(t.prototype,null),r&&o(t,r),e}();t.default=a,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=c(r(92)),i=c(r(93)),s=c(r(94)),o=c(r(95)),a=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},s=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(i[t]=o,s+=1):"object"==typeof o&&(r[t]=o,n+=1)})),n>0){var o=Object.keys(r),c=a.default.find(o,(function(e){return t.isOS(e)}));if(c){var d=this.satisfies(r[c]);if(void 0!==d)return d}var l=a.default.find(o,(function(e){return t.isPlatform(e)}));if(l){var u=this.satisfies(r[l]);if(void 0!==u)return u}}if(s>0){var h=Object.keys(i),p=a.default.find(h,(function(e){return t.isBrowser(e,!0)}));if(void 0!==p)return this.compareVersion(i[p])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=a.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(a.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:s.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:s.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})},8389:function(e,t){!function(e){"use strict";var t,r=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,n=536870912,i=1073741824,s=new WeakMap,o=function(e,t){return function(s){var o=t.get(s),a=void 0===o?s.size:o<i?o+1:0;if(!s.has(a))return e(s,a);if(s.size<n){for(;s.has(a);)a=Math.floor(Math.random()*i);return e(s,a)}if(s.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;s.has(a);)a=Math.floor(Math.random()*r);return e(s,a)}}((t=s,function(e,r){return t.set(e,r),r}),s),a=function(e){return function(t){var r=e(t);return t.add(r),r}}(o);e.addUniqueNumber=a,e.generateUniqueNumber=o}(t)},6982:(e,t,r)=>{"use strict";var n=r(4976);t.A=function(e){return o.apply(this,arguments)};var i=n(r(5230)),s=n(r(6891));function o(){return(o=(0,s.default)(i.default.mark((function e(t){var r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.createElement("video"),n=new Promise((function(e,t){r.addEventListener("loadedmetadata",(function(){r.duration===1/0?(r.currentTime=Number.MAX_SAFE_INTEGER,r.ontimeupdate=function(){r.ontimeupdate=null,e(r.duration),r.currentTime=0}):e(r.duration)})),r.onerror=function(e){return t(e.target.error)}})),r.src="string"==typeof t||t instanceof String?t:window.URL.createObjectURL(t),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},6891:e=>{function t(e,t,r,n,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(i,s){var o=e.apply(r,n);function a(e){t(o,i,s,a,c,"next",e)}function c(e){t(o,i,s,a,c,"throw",e)}a(void 0)}))}}},4976:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},5230:(e,t,r)=>{e.exports=r(479)},479:e=>{var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var s=t&&t.prototype instanceof v?t:v,o=Object.create(s.prototype),a=new P(n||[]);return i(o,"_invoke",{value:R(e,r,a)}),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",m="executing",f="completed",g={};function v(){}function y(){}function _(){}var S={};d(S,o,(function(){return this}));var T=Object.getPrototypeOf,E=T&&T(T(D([])));E&&E!==r&&n.call(E,o)&&(S=E);var b=_.prototype=v.prototype=Object.create(S);function w(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(i,s,o,a){var c=u(e[i],e,s);if("throw"!==c.type){var d=c.arg,l=d.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,o,a)}),(function(e){r("throw",e,o,a)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return r("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return s=s?s.then(i,i):i()}})}function R(e,t,r){var n=h;return function(i,s){if(n===m)throw new Error("Generator is already running");if(n===f){if("throw"===i)throw s;return O()}for(r.method=i,r.arg=s;;){var o=r.delegate;if(o){var a=C(o,r);if(a){if(a===g)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=m;var c=u(e,t,r);if("normal"===c.type){if(n=r.done?f:p,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=f,r.method="throw",r.arg=c.arg)}}}function C(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var s=u(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,g;var o=s.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function D(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=_,i(b,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:y,configurable:!0}),y.displayName=d(_,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(k.prototype),d(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new k(l(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(b),d(b,c,"Generator"),d(b,o,(function(){return this})),d(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=D,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),d=n.call(o,"finallyLoc");if(c&&d){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:D(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},4196:(e,t,r)=>{var n;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||s;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||s;if(e=parseFloat(e),t.ctx||p(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,s.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||s;t.ctx||p(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,s.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},stop:function(){for(var e=this||s,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||s,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,p()),e},codecs:function(e){return(this||s)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||s;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||s,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var r=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator?e._navigator.userAgent:"",i=n.match(/OPR\/(\d+)/g),o=i&&parseInt(i[0].split("/")[1],10)<33,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),c=n.match(/Version\/(.*?) /),d=a&&c&&parseInt(c[1],10)<15;return e._codecs={mp3:!(o||!r&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||s;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(r){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(r){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var s=e._howls[i]._getSoundIds(),o=0;o<s.length;o++){var a=e._howls[i]._soundById(s[o]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var c=e.ctx.createBufferSource();c.buffer=e._scratchBuffer,c.connect(e.ctx.destination),void 0===c.start?c.noteOn(0):c.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),c.onended=function(){c.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var r=0;r<e._howls.length;r++)e._howls[r]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||s;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||s;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&s.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var r=0;r<e._howls[t]._sounds.length;r++)if(!e._howls[t]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&s.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var s=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return s.ctx||p(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=s.usingWebAudio&&!t._html5,void 0!==s.ctx&&s.ctx&&s.autoUnlock&&s._unlockAudio(),s._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(s.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var n,i;if(e._format&&e._format[r])n=e._format[r];else{if("string"!=typeof(i=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(i))||(n=/\.([^.]+)$/.exec(i.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&s.codecs(n)){t=e._src[r];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&d(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var r=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e&&(e="__default",!r._playLock)){for(var i=0,o=0;o<r._sounds.length;o++)r._sounds[o]._paused&&!r._sounds[o]._ended&&(i++,n=r._sounds[o]._id);1===i?e=null:n=null}}var a=n?r._soundById(n):r._inactiveSound();if(!a)return null;if(n&&!e&&(e=a._sprite||"__default"),"loaded"!==r._state){a._sprite=e,a._ended=!1;var c=a._id;return r._queue.push({event:"play",action:function(){r.play(c)}}),c}if(n&&!a._paused)return t||r._loadQueue("play"),a._id;r._webAudio&&s._autoResume();var d=Math.max(0,a._seek>0?a._seek:r._sprite[e][0]/1e3),l=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-d),u=1e3*l/Math.abs(a._rate),h=r._sprite[e][0]/1e3,p=(r._sprite[e][0]+r._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var m=function(){a._paused=!1,a._seek=d,a._start=h,a._stop=p,a._loop=!(!a._loop&&!r._sprite[e][2])};if(!(d>=p)){var f=a._node;if(r._webAudio){var g=function(){r._playLock=!1,m(),r._refreshBuffer(a);var e=a._muted||r._muted?0:a._volume;f.gain.setValueAtTime(e,s.ctx.currentTime),a._playStart=s.ctx.currentTime,void 0===f.bufferSource.start?a._loop?f.bufferSource.noteGrainOn(0,d,86400):f.bufferSource.noteGrainOn(0,d,l):a._loop?f.bufferSource.start(0,d,86400):f.bufferSource.start(0,d,l),u!==1/0&&(r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),u)),t||setTimeout((function(){r._emit("play",a._id),r._loadQueue()}),0)};"running"===s.state&&"interrupted"!==s.ctx.state?g():(r._playLock=!0,r.once("resume",g),r._clearTimer(a._id))}else{var v=function(){f.currentTime=d,f.muted=a._muted||r._muted||s._muted||f.muted,f.volume=a._volume*s.volume(),f.playbackRate=a._rate;try{var n=f.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(r._playLock=!0,m(),n.then((function(){r._playLock=!1,f._unlocked=!0,t?r._loadQueue():r._emit("play",a._id)})).catch((function(){r._playLock=!1,r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(r._playLock=!1,m(),r._emit("play",a._id)),f.playbackRate=a._rate,f.paused)return void r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),u):(r._endTimers[a._id]=function(){r._ended(a),f.removeEventListener("ended",r._endTimers[a._id],!1)},f.addEventListener("ended",r._endTimers[a._id],!1))}catch(e){r._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===f.src&&(f.src=r._src,f.load());var y=window&&window.ejecta||!f.readyState&&s._navigator.isCocoonJS;if(f.readyState>=3||y)v();else{r._playLock=!0,r._state="loading";var _=function(){r._state="loaded",v(),f.removeEventListener(s._canPlayEvent,_,!1)};f.addEventListener(s._canPlayEvent,_,!1),r._clearTimer(a._id)}}return a._id}r._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var r=t._getSoundIds(e),n=0;n<r.length;n++){t._clearTimer(r[n]);var i=t._soundById(r[n]);if(i&&!i._paused&&(i._seek=t.seek(r[n]),i._rateSeek=0,i._paused=!0,t._stopFade(r[n]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"stop",action:function(){r.stop(e)}}),r;for(var n=r._getSoundIds(e),i=0;i<n.length;i++){r._clearTimer(n[i]);var s=r._soundById(n[i]);s&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,r._stopFade(n[i]),s._node&&(r._webAudio?s._node.bufferSource&&(void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),r._cleanBuffer(s._node)):isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause(),s._node.duration===1/0&&r._clearSound(s._node))),t||r._emit("stop",s._id))}return r},mute:function(e,t){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(e,t)}}),r;if(void 0===t){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var n=r._getSoundIds(t),i=0;i<n.length;i++){var o=r._soundById(n[i]);o&&(o._muted=e,o._interval&&r._stopFade(o._id),r._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,s.ctx.currentTime):o._node&&(o._node.muted=!!s._muted||e),r._emit("mute",o._id))}return r},volume:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._volume;if(1===i.length||2===i.length&&void 0===i[1]?n._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0]):i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),!(void 0!==e&&e>=0&&e<=1))return(r=t?n._soundById(t):n._sounds[0])?r._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,i)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var o=0;o<t.length;o++)(r=n._soundById(t[o]))&&(r._volume=e,i[2]||n._stopFade(t[o]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,s.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*s.volume()),n._emit("volume",r._id));return n},fade:function(e,t,r,n){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,r,n)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),r=parseFloat(r),i.volume(e,n);for(var o=i._getSoundIds(n),a=0;a<o.length;a++){var c=i._soundById(o[a]);if(c){if(n||i._stopFade(o[a]),i._webAudio&&!c._muted){var d=s.ctx.currentTime,l=d+r/1e3;c._volume=e,c._node.gain.setValueAtTime(e,d),c._node.gain.linearRampToValueAtTime(t,l)}i._startFadeInterval(c,e,t,r,o[a],void 0===n)}}return i},_startFadeInterval:function(e,t,r,n,i,s){var o=this,a=t,c=r-t,d=Math.abs(c/.01),l=Math.max(4,d>0?n/d:n),u=Date.now();e._fadeTo=r,e._interval=setInterval((function(){var i=(Date.now()-u)/n;u=Date.now(),a+=c*i,a=Math.round(100*a)/100,a=c<0?Math.max(r,a):Math.min(r,a),o._webAudio?e._volume=a:o.volume(a,e._id,!0),s&&(o._volume=a),(r<t&&a<=r||r>t&&a>=r)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(r,e._id),o._emit("fade",e._id))}),l)},_stopFade:function(e){var t=this,r=t._soundById(e);return r&&r._interval&&(t._webAudio&&r._node.gain.cancelScheduledValues(s.ctx.currentTime),clearInterval(r._interval),r._interval=null,t.volume(r._fadeTo,e),r._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(r=n._soundById(parseInt(i[0],10)))&&r._loop;e=i[0],n._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var s=n._getSoundIds(t),o=0;o<s.length;o++)(r=n._soundById(s[o]))&&(r._loop=e,n._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=e,e&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop,n.playing(s[o])&&(n.pause(s[o],!0),n.play(s[o],!0)))));return n},rate:function(){var e,t,r,n=this,i=arguments;if(0===i.length?t=n._sounds[0]._id:1===i.length?n._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0]):2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),"number"!=typeof e)return(r=n._soundById(t))?r._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,i)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var o=0;o<t.length;o++)if(r=n._soundById(t[o])){n.playing(t[o])&&(r._rateSeek=n.seek(t[o]),r._playStart=n._webAudio?s.ctx.currentTime:r._playStart),r._rate=e,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,s.ctx.currentTime):r._node&&(r._node.playbackRate=e);var a=n.seek(t[o]),c=1e3*((n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-a)/Math.abs(r._rate);!n._endTimers[t[o]]&&r._paused||(n._clearTimer(t[o]),n._endTimers[t[o]]=setTimeout(n._ended.bind(n,r),c)),n._emit("rate",r._id)}return n},seek:function(){var e,t,r=this,n=arguments;if(0===n.length?r._sounds.length&&(t=r._sounds[0]._id):1===n.length?r._getSoundIds().indexOf(n[0])>=0?t=parseInt(n[0],10):r._sounds.length&&(t=r._sounds[0]._id,e=parseFloat(n[0])):2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10)),void 0===t)return 0;if("number"==typeof e&&("loaded"!==r._state||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,n)}}),r;var i=r._soundById(t);if(i){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var o=r.playing(t)?s.ctx.currentTime-i._playStart:0,a=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(a+o*Math.abs(i._rate))}return i._node.currentTime}var c=r.playing(t);c&&r.pause(t,!0),i._seek=e,i._ended=!1,r._clearTimer(t),r._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var d=function(){c&&r.play(t,!0),r._emit("seek",t)};if(c&&!r._webAudio){var l=function(){r._playLock?setTimeout(l,0):d()};setTimeout(l,0)}else d()}return r},playing:function(e){var t=this;if("number"==typeof e){var r=t._soundById(e);return!!r&&!r._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,r=t._duration,n=t._soundById(e);return n&&(r=t._sprite[n._sprite][1]/1e3),r},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,r=0;r<t.length;r++)t[r]._paused||e.stop(t[r]._id),e._webAudio||(e._clearSound(t[r]._node),t[r]._node.removeEventListener("error",t[r]._errorFn,!1),t[r]._node.removeEventListener(s._canPlayEvent,t[r]._loadFn,!1),t[r]._node.removeEventListener("ended",t[r]._endFn,!1),s._releaseHtml5Audio(t[r]._node)),delete t[r]._node,e._clearTimer(t[r]._id);var n=s._howls.indexOf(e);n>=0&&s._howls.splice(n,1);var i=!0;for(r=0;r<s._howls.length;r++)if(s._howls[r]._src===e._src||e._src.indexOf(s._howls[r]._src)>=0){i=!1;break}return c&&i&&delete c[e._src],s.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,r,n){var i=this["_on"+e];return"function"==typeof t&&i.push(n?{id:r,fn:t,once:n}:{id:r,fn:t}),this},off:function(e,t,r){var n=this,i=n["_on"+e],s=0;if("number"==typeof t&&(r=t,t=null),t||r)for(s=0;s<i.length;s++){var o=r===i[s].id;if(t===i[s].fn&&o||!t&&o){i.splice(s,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(s=0;s<a.length;s++)0===a[s].indexOf("_on")&&Array.isArray(n[a[s]])&&(n[a[s]]=[])}return n},once:function(e,t,r){return this.on(e,t,r,1),this},_emit:function(e,t,r){for(var n=this,i=n["_on"+e],s=i.length-1;s>=0;s--)i[s].id&&i[s].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,r)}.bind(n,i[s].fn),0),i[s].once&&n.off(e,i[s].fn,i[s].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var r=t._queue[0];r.event===e&&(t._queue.shift(),t._loadQueue()),e||r.action()}return t},_ended:function(e){var t=this,r=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var n=!(!e._loop&&!t._sprite[r][2]);if(t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=s.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),s._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var r=t._soundById(e);r&&r._node&&r._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,r=0;r<t._sounds.length;r++)if(e===t._sounds[r]._id)return t._sounds[r];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,r=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&r++;for(n=e._sounds.length-1;n>=0;n--){if(r<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),r--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],r=0;r<this._sounds.length;r++)t.push(this._sounds[r]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=s.ctx.createBufferSource(),e._node.bufferSource.buffer=c[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,s.ctx.currentTime),this},_cleanBuffer:function(e){var t=s._navigator&&s._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(s._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=s._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(s._navigator&&s._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++s._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,r=s._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===s.ctx.createGain?s.ctx.createGainNode():s.ctx.createGain(),e._node.gain.setValueAtTime(r,s.ctx.currentTime),e._node.paused=!0,e._node.connect(s.masterGain)):s.noAudio||(e._node=s._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(s._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=r*s.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++s._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(s._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var c={},d=function(e){var t=e._src;if(c[t])return e._duration=c[t].duration,void h(e);if(/^data:[^;]+;base64,/.test(t)){for(var r=atob(t.split(",")[1]),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);u(n.buffer,e)}else{var s=new XMLHttpRequest;s.open(e._xhr.method,t,!0),s.withCredentials=e._xhr.withCredentials,s.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){s.setRequestHeader(t,e._xhr.headers[t])})),s.onload=function(){var t=(s.status+"")[0];"0"===t||"2"===t||"3"===t?u(s.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".")},s.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete c[t],e.load())},l(s)}},l=function(e){try{e.send()}catch(t){e.onerror()}},u=function(e,t){var r=function(){t._emit("loaderror",null,"Decoding audio data failed.")},n=function(e){e&&t._sounds.length>0?(c[t._src]=e,h(t,e)):r()};"undefined"!=typeof Promise&&1===s.ctx.decodeAudioData.length?s.ctx.decodeAudioData(e).then(n).catch(r):s.ctx.decodeAudioData(e,n,r)},h=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},p=function(){if(s.usingWebAudio){try{"undefined"!=typeof AudioContext?s.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?s.ctx=new webkitAudioContext:s.usingWebAudio=!1}catch(e){s.usingWebAudio=!1}s.ctx||(s.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(s._navigator&&s._navigator.platform),t=s._navigator&&s._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=t?parseInt(t[1],10):null;if(e&&r&&r<9){var n=/safari/.test(s._navigator&&s._navigator.userAgent.toLowerCase());s._navigator&&!n&&(s.usingWebAudio=!1)}s.usingWebAudio&&(s.masterGain=void 0===s.ctx.createGain?s.ctx.createGainNode():s.ctx.createGain(),s.masterGain.gain.setValueAtTime(s._muted?0:s._volume,s.ctx.currentTime),s.masterGain.connect(s.ctx.destination)),s._setup()}};void 0===(n=function(){return{Howler:s,Howl:o}}.apply(t,[]))||(e.exports=n),t.Howler=s,t.Howl=o,void 0!==r.g?(r.g.HowlerGlobal=i,r.g.Howler=s,r.g.Howl=o,r.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=i,window.Howler=s,window.Howl=o,window.Sound=a)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var r=t._howls.length-1;r>=0;r--)t._howls[r].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,r){var n=this;return n.ctx&&n.ctx.listener?(t="number"!=typeof t?n._pos[1]:t,r="number"!=typeof r?n._pos[2]:r,"number"!=typeof e?n._pos:(n._pos=[e,t,r],void 0!==n.ctx.listener.positionX?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(e,t,r,n,i,s){var o=this;if(!o.ctx||!o.ctx.listener)return o;var a=o._orientation;return t="number"!=typeof t?a[1]:t,r="number"!=typeof r?a[2]:r,n="number"!=typeof n?a[3]:n,i="number"!=typeof i?a[4]:i,s="number"!=typeof s?a[5]:s,"number"!=typeof e?a:(o._orientation=[e,t,r,n,i,s],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(s,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(e,t,r,n,i,s),o)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var r=this;return r._orientation=t.orientation||[1,0,0],r._stereo=t.stereo||null,r._pos=t.pos||null,r._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},r._onstereo=t.onstereo?[{fn:t.onstereo}]:[],r._onpos=t.onpos?[{fn:t.onpos}]:[],r._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,r)}}),n;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===r){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var s=n._getSoundIds(r),o=0;o<s.length;o++){var a=n._soundById(s[o]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,i),"spatial"===i?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(e,r,n,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(e,r,n,i)}}),s;if(r="number"!=typeof r?0:r,n="number"!=typeof n?-.5:n,void 0===i){if("number"!=typeof e)return s._pos;s._pos=[e,r,n]}for(var o=s._getSoundIds(i),a=0;a<o.length;a++){var c=s._soundById(o[a]);if(c){if("number"!=typeof e)return c._pos;c._pos=[e,r,n],c._node&&(c._panner&&!c._panner.pan||t(c,"spatial"),void 0!==c._panner.positionX?(c._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):c._panner.setPosition(e,r,n)),s._emit("pos",c._id)}}return s},Howl.prototype.orientation=function(e,r,n,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(e,r,n,i)}}),s;if(r="number"!=typeof r?s._orientation[1]:r,n="number"!=typeof n?s._orientation[2]:n,void 0===i){if("number"!=typeof e)return s._orientation;s._orientation=[e,r,n]}for(var o=s._getSoundIds(i),a=0;a<o.length;a++){var c=s._soundById(o[a]);if(c){if("number"!=typeof e)return c._orientation;c._orientation=[e,r,n],c._node&&(c._panner||(c._pos||(c._pos=s._pos||[0,0,-.5]),t(c,"spatial")),void 0!==c._panner.orientationX?(c._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):c._panner.setOrientation(e,r,n)),s._emit("orientation",c._id)}}return s},Howl.prototype.pannerAttr=function(){var e,r,n,i=this,s=arguments;if(!i._webAudio)return i;if(0===s.length)return i._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return(n=i._soundById(parseInt(s[0],10)))?n._pannerAttr:i._pannerAttr;e=s[0],void 0===r&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===s.length&&(e=s[0],r=parseInt(s[1],10));for(var o=i._getSoundIds(r),a=0;a<o.length;a++)if(n=i._soundById(o[a])){var c=n._pannerAttr;c={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:c.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:c.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:c.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:c.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:c.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:c.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:c.panningModel};var d=n._panner;d||(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"),d=n._panner),d.coneInnerAngle=c.coneInnerAngle,d.coneOuterAngle=c.coneOuterAngle,d.coneOuterGain=c.coneOuterGain,d.distanceModel=c.distanceModel,d.maxDistance=c.maxDistance,d.refDistance=c.refDistance,d.rolloffFactor=c.rolloffFactor,d.panningModel=c.panningModel}return i},Sound.prototype.init=function(e){return function(){var t=this,r=t._parent;t._orientation=r._orientation,t._stereo=r._stereo,t._pos=r._pos,t._pannerAttr=r._pannerAttr,e.call(this),t._stereo?r.stereo(t._stereo):t._pos&&r.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,r=t._parent;return t._orientation=r._orientation,t._stereo=r._stereo,t._pos=r._pos,t._pannerAttr=r._pannerAttr,t._stereo?r.stereo(t._stereo):t._pos?r.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,r._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()},6479:e=>{var t;window,t=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=256,o=function(){function e(e){void 0===e&&(e="="),this._paddingCharacter=e}return e.prototype.encodedLength=function(e){return this._paddingCharacter?(e+2)/3*4|0:(8*e+5)/6|0},e.prototype.encode=function(e){for(var t="",r=0;r<e.length-2;r+=3){var n=e[r]<<16|e[r+1]<<8|e[r+2];t+=this._encodeByte(n>>>18&63),t+=this._encodeByte(n>>>12&63),t+=this._encodeByte(n>>>6&63),t+=this._encodeByte(n>>>0&63)}var i=e.length-r;return i>0&&(n=e[r]<<16|(2===i?e[r+1]<<8:0),t+=this._encodeByte(n>>>18&63),t+=this._encodeByte(n>>>12&63),t+=2===i?this._encodeByte(n>>>6&63):this._paddingCharacter||"",t+=this._paddingCharacter||""),t},e.prototype.maxDecodedLength=function(e){return this._paddingCharacter?e/4*3|0:(6*e+7)/8|0},e.prototype.decodedLength=function(e){return this.maxDecodedLength(e.length-this._getPaddingLength(e))},e.prototype.decode=function(e){if(0===e.length)return new Uint8Array(0);for(var t=this._getPaddingLength(e),r=e.length-t,n=new Uint8Array(this.maxDecodedLength(r)),i=0,o=0,a=0,c=0,d=0,l=0,u=0;o<r-4;o+=4)c=this._decodeChar(e.charCodeAt(o+0)),d=this._decodeChar(e.charCodeAt(o+1)),l=this._decodeChar(e.charCodeAt(o+2)),u=this._decodeChar(e.charCodeAt(o+3)),n[i++]=c<<2|d>>>4,n[i++]=d<<4|l>>>2,n[i++]=l<<6|u,a|=c&s,a|=d&s,a|=l&s,a|=u&s;if(o<r-1&&(c=this._decodeChar(e.charCodeAt(o)),d=this._decodeChar(e.charCodeAt(o+1)),n[i++]=c<<2|d>>>4,a|=c&s,a|=d&s),o<r-2&&(l=this._decodeChar(e.charCodeAt(o+2)),n[i++]=d<<4|l>>>2,a|=l&s),o<r-3&&(u=this._decodeChar(e.charCodeAt(o+3)),n[i++]=l<<6|u,a|=u&s),0!==a)throw new Error("Base64Coder: incorrect characters for decoding");return n},e.prototype._encodeByte=function(e){var t=e;return t+=65,t+=25-e>>>8&6,t+=51-e>>>8&-75,t+=61-e>>>8&-15,t+=62-e>>>8&3,String.fromCharCode(t)},e.prototype._decodeChar=function(e){var t=s;return t+=(42-e&e-44)>>>8&-256+e-43+62,t+=(46-e&e-48)>>>8&-256+e-47+63,t+=(47-e&e-58)>>>8&-256+e-48+52,(t+=(64-e&e-91)>>>8&-256+e-65+0)+((96-e&e-123)>>>8&-256+e-97+26)},e.prototype._getPaddingLength=function(e){var t=0;if(this._paddingCharacter){for(var r=e.length-1;r>=0&&e[r]===this._paddingCharacter;r--)t++;if(e.length<4||t>2)throw new Error("Base64Coder: incorrect padding")}return t},e}();t.Coder=o;var a=new o;t.encode=function(e){return a.encode(e)},t.decode=function(e){return a.decode(e)};var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._encodeByte=function(e){var t=e;return t+=65,t+=25-e>>>8&6,t+=51-e>>>8&-75,t+=61-e>>>8&-13,t+=62-e>>>8&49,String.fromCharCode(t)},t.prototype._decodeChar=function(e){var t=s;return t+=(44-e&e-46)>>>8&-256+e-45+62,t+=(94-e&e-96)>>>8&-256+e-95+63,t+=(47-e&e-58)>>>8&-256+e-48+52,(t+=(64-e&e-91)>>>8&-256+e-65+0)+((96-e&e-123)>>>8&-256+e-97+26)},t}(o);t.URLSafeCoder=c;var d=new c;t.encodeURLSafe=function(e){return d.encode(e)},t.decodeURLSafe=function(e){return d.decode(e)},t.encodedLength=function(e){return a.encodedLength(e)},t.maxDecodedLength=function(e){return a.maxDecodedLength(e)},t.decodedLength=function(e){return a.decodedLength(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="utf8: invalid string",i="utf8: invalid source encoding";function s(e){for(var t=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i<128)t+=1;else if(i<2048)t+=2;else if(i<55296)t+=3;else{if(!(i<=57343))throw new Error(n);if(r>=e.length-1)throw new Error(n);r++,t+=4}}return t}t.encode=function(e){for(var t=new Uint8Array(s(e)),r=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=192|i>>6,t[r++]=128|63&i):i<55296?(t[r++]=224|i>>12,t[r++]=128|i>>6&63,t[r++]=128|63&i):(n++,i=(1023&i)<<10,i|=1023&e.charCodeAt(n),i+=65536,t[r++]=240|i>>18,t[r++]=128|i>>12&63,t[r++]=128|i>>6&63,t[r++]=128|63&i)}return t},t.encodedLength=s,t.decode=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(128&n){var s=void 0;if(n<224){if(r>=e.length)throw new Error(i);if(128!=(192&(o=e[++r])))throw new Error(i);n=(31&n)<<6|63&o,s=128}else if(n<240){if(r>=e.length-1)throw new Error(i);var o=e[++r],a=e[++r];if(128!=(192&o)||128!=(192&a))throw new Error(i);n=(15&n)<<12|(63&o)<<6|63&a,s=2048}else{if(!(n<248))throw new Error(i);if(r>=e.length-2)throw new Error(i);o=e[++r],a=e[++r];var c=e[++r];if(128!=(192&o)||128!=(192&a)||128!=(192&c))throw new Error(i);n=(15&n)<<18|(63&o)<<12|(63&a)<<6|63&c,s=65536}if(n<s||n>=55296&&n<=57343)throw new Error(i);if(n>=65536){if(n>1114111)throw new Error(i);n-=65536,t.push(String.fromCharCode(55296|n>>10)),n=56320|1023&n}}t.push(String.fromCharCode(n))}return t.join("")}},function(e,t,r){e.exports=r(3).default},function(e,t,r){"use strict";r.r(t);class n{constructor(e,t){this.lastId=0,this.prefix=e,this.name=t}create(e){this.lastId++;var t=this.lastId,r=this.prefix+t,n=this.name+"["+t+"]",i=!1,s=function(){i||(e.apply(null,arguments),i=!0)};return this[t]=s,{number:t,id:r,name:n,callback:s}}remove(e){delete this[e.number]}}var i=new n("_pusher_script_","Pusher.ScriptReceivers"),s={VERSION:"8.4.0-rc2",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},o=new n("_pusher_dependencies","Pusher.DependenciesReceivers"),a=new class{constructor(e){this.options=e,this.receivers=e.receivers||i,this.loading={}}load(e,t,r){var n=this;if(n.loading[e]&&n.loading[e].length>0)n.loading[e].push(r);else{n.loading[e]=[r];var i=ot.createScriptRequest(n.getPath(e,t)),s=n.receivers.create((function(t){if(n.receivers.remove(s),n.loading[e]){var r=n.loading[e];delete n.loading[e];for(var o=function(e){e||i.cleanup()},a=0;a<r.length;a++)r[a](t,o)}}));i.send(s)}}getRoot(e){var t=ot.getDocument().location.protocol;return(e&&e.useTLS||"https:"===t?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version}getPath(e,t){return this.getRoot(t)+"/"+e+this.options.suffix+".js"}}({cdn_http:s.cdn_http,cdn_https:s.cdn_https,version:s.VERSION,suffix:s.dependency_suffix,receivers:o});const c={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};var d,l=function(e){const t=c.urls[e];if(!t)return"";let r;return t.fullUrl?r=t.fullUrl:t.path&&(r=c.baseUrl+t.path),r?`See: ${r}`:""};!function(e){e.UserAuthentication="user-authentication",e.ChannelAuthorization="channel-authorization"}(d||(d={}));class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class h extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class p extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class m extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class f extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class g extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class v extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class y extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class _ extends Error{constructor(e,t){super(t),this.status=e,Object.setPrototypeOf(this,new.target.prototype)}}for(var S=function(e,t,r,n,i){const s=ot.createXHR();for(var o in s.open("POST",r.endpoint,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.headers)s.setRequestHeader(o,r.headers[o]);if(null!=r.headersProvider){let e=r.headersProvider();for(var o in e)s.setRequestHeader(o,e[o])}return s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){let e,t=!1;try{e=JSON.parse(s.responseText),t=!0}catch(e){i(new _(200,`JSON returned from ${n.toString()} endpoint was invalid, yet status code was 200. Data was: ${s.responseText}`),null)}t&&i(null,e)}else{let e="";switch(n){case d.UserAuthentication:e=l("authenticationEndpoint");break;case d.ChannelAuthorization:e=`Clients must be authorized to join private or presence channels. ${l("authorizationEndpoint")}`}i(new _(s.status,`Unable to retrieve auth string from ${n.toString()} endpoint - received status: ${s.status} from ${r.endpoint}. ${e}`),null)}},s.send(t),s},T=String.fromCharCode,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b={},w=0;w<64;w++)b[E.charAt(w)]=w;var k=function(e){var t=e.charCodeAt(0);return t<128?e:t<2048?T(192|t>>>6)+T(128|63&t):T(224|t>>>12&15)+T(128|t>>>6&63)+T(128|63&t)},R=function(e){return e.replace(/[^\x00-\x7F]/g,k)},C=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[E.charAt(r>>>18),E.charAt(r>>>12&63),t>=2?"=":E.charAt(r>>>6&63),t>=1?"=":E.charAt(63&r)].join("")},I=window.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,C)},A=class{constructor(e,t,r,n){this.clear=t,this.timer=e((()=>{this.timer&&(this.timer=n(this.timer))}),r)}isRunning(){return null!==this.timer}ensureAborted(){this.timer&&(this.clear(this.timer),this.timer=null)}};function P(e){window.clearTimeout(e)}function D(e){window.clearInterval(e)}class O extends A{constructor(e,t){super(setTimeout,P,e,(function(e){return t(),null}))}}class M extends A{constructor(e,t){super(setInterval,D,e,(function(e){return t(),e}))}}var N={now:()=>Date.now?Date.now():(new Date).valueOf(),defer:e=>new O(0,e),method(e,...t){var r=Array.prototype.slice.call(arguments,1);return function(t){return t[e].apply(t,r.concat(arguments))}}},x=N;function L(e,...t){for(var r=0;r<t.length;r++){var n=t[r];for(var i in n)n[i]&&n[i].constructor&&n[i].constructor===Object?e[i]=L(e[i]||{},n[i]):e[i]=n[i]}return e}function U(){for(var e=["Pusher"],t=0;t<arguments.length;t++)"string"==typeof arguments[t]?e.push(arguments[t]):e.push(z(arguments[t]));return e.join(" : ")}function j(e,t){var r=Array.prototype.indexOf;if(null===e)return-1;if(r&&e.indexOf===r)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function F(e,t){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(e[r],r,e)}function V(e){var t=[];return F(e,(function(e,r){t.push(r)})),t}function B(e,t,r){for(var n=0;n<e.length;n++)t.call(r||window,e[n],n,e)}function H(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n,e,r));return r}function W(e,t){t=t||function(e){return!!e};for(var r=[],n=0;n<e.length;n++)t(e[n],n,e,r)&&r.push(e[n]);return r}function G(e,t){var r={};return F(e,(function(n,i){(t&&t(n,i,e,r)||Boolean(n))&&(r[i]=n)})),r}function q(e,t){for(var r=0;r<e.length;r++)if(t(e[r],r,e))return!0;return!1}function $(e){var t,r;return H((t=function(e){return t=function(e){return"object"==typeof e&&(e=z(e)),encodeURIComponent((t=e.toString(),I(R(t))));var t},r={},F(e,(function(e,n){r[n]=t(e)})),r;var t,r}(G(e,(function(e){return void 0!==e}))),r=[],F(t,(function(e,t){r.push([t,e])})),r),x.method("join","=")).join("&")}function z(e){try{return JSON.stringify(e)}catch(n){return JSON.stringify((t=[],r=[],function e(n,i){var s,o,a;switch(typeof n){case"object":if(!n)return null;for(s=0;s<t.length;s+=1)if(t[s]===n)return{$ref:r[s]};if(t.push(n),r.push(i),"[object Array]"===Object.prototype.toString.apply(n))for(a=[],s=0;s<n.length;s+=1)a[s]=e(n[s],i+"["+s+"]");else for(o in a={},n)Object.prototype.hasOwnProperty.call(n,o)&&(a[o]=e(n[o],i+"["+JSON.stringify(o)+"]"));return a;case"number":case"string":case"boolean":return n}}(e,"$")))}var t,r}var J=new class{constructor(){this.globalLog=e=>{window.console&&window.console.log&&window.console.log(e)}}debug(...e){this.log(this.globalLog,e)}warn(...e){this.log(this.globalLogWarn,e)}error(...e){this.log(this.globalLogError,e)}globalLogWarn(e){window.console&&window.console.warn?window.console.warn(e):this.globalLog(e)}globalLogError(e){window.console&&window.console.error?window.console.error(e):this.globalLogWarn(e)}log(e,...t){var r=U.apply(this,arguments);It.log?It.log(r):It.logToConsole&&e.bind(this)(r)}},K=function(e,t,r,n,i){void 0===r.headers&&null==r.headersProvider||J.warn(`To send headers with the ${n.toString()} request, you must use AJAX, rather than JSONP.`);var s=e.nextAuthCallbackID.toString();e.nextAuthCallbackID++;var o=e.getDocument(),a=o.createElement("script");e.auth_callbacks[s]=function(e){i(null,e)};var c="Pusher.auth_callbacks['"+s+"']";a.src=r.endpoint+"?callback="+encodeURIComponent(c)+"&"+t;var d=o.getElementsByTagName("head")[0]||o.documentElement;d.insertBefore(a,d.firstChild)};class Q{constructor(e){this.src=e}send(e){var t=this,r="Error loading "+t.src;t.script=document.createElement("script"),t.script.id=e.id,t.script.src=t.src,t.script.type="text/javascript",t.script.charset="UTF-8",t.script.addEventListener?(t.script.onerror=function(){e.callback(r)},t.script.onload=function(){e.callback(null)}):t.script.onreadystatechange=function(){"loaded"!==t.script.readyState&&"complete"!==t.script.readyState||e.callback(null)},void 0===t.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(t.errorScript=document.createElement("script"),t.errorScript.id=e.id+"_error",t.errorScript.text=e.name+"('"+r+"');",t.script.async=t.errorScript.async=!1):t.script.async=!0;var n=document.getElementsByTagName("head")[0];n.insertBefore(t.script,n.firstChild),t.errorScript&&n.insertBefore(t.errorScript,t.script.nextSibling)}cleanup(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null}}class Y{constructor(e,t){this.url=e,this.data=t}send(e){if(!this.request){var t=$(this.data),r=this.url+"/"+e.number+"?"+t;this.request=ot.createScriptRequest(r),this.request.send(e)}}cleanup(){this.request&&this.request.cleanup()}}var X={name:"jsonp",getAgent:function(e,t){return function(r,n){var s="http"+(t?"s":"")+"://"+(e.host||e.options.host)+e.options.path,o=ot.createJSONPRequest(s,r),a=ot.ScriptReceivers.create((function(t,r){i.remove(a),o.cleanup(),r&&r.host&&(e.host=r.host),n&&n(t,r)}));o.send(a)}}};function Z(e,t,r){return e+(t.useTLS?"s":"")+"://"+(t.useTLS?t.hostTLS:t.hostNonTLS)+r}function ee(e,t){return"/app/"+e+"?protocol="+s.PROTOCOL+"&client=js&version="+s.VERSION+(t?"&"+t:"")}var te={getInitial:function(e,t){return Z("ws",t,(t.httpPath||"")+ee(e,"flash=false"))}},re={getInitial:function(e,t){return Z("http",t,(t.httpPath||"/pusher")+ee(e))}},ne={getInitial:function(e,t){return Z("http",t,t.httpPath||"/pusher")},getPath:function(e,t){return ee(e)}};class ie{constructor(){this._callbacks={}}get(e){return this._callbacks[se(e)]}add(e,t,r){var n=se(e);this._callbacks[n]=this._callbacks[n]||[],this._callbacks[n].push({fn:t,context:r})}remove(e,t,r){if(e||t||r){var n=e?[se(e)]:V(this._callbacks);t||r?this.removeCallback(n,t,r):this.removeAllCallbacks(n)}else this._callbacks={}}removeCallback(e,t,r){B(e,(function(e){this._callbacks[e]=W(this._callbacks[e]||[],(function(e){return t&&t!==e.fn||r&&r!==e.context})),0===this._callbacks[e].length&&delete this._callbacks[e]}),this)}removeAllCallbacks(e){B(e,(function(e){delete this._callbacks[e]}),this)}}function se(e){return"_"+e}class oe{constructor(e){this.callbacks=new ie,this.global_callbacks=[],this.failThrough=e}bind(e,t,r){return this.callbacks.add(e,t,r),this}bind_global(e){return this.global_callbacks.push(e),this}unbind(e,t,r){return this.callbacks.remove(e,t,r),this}unbind_global(e){return e?(this.global_callbacks=W(this.global_callbacks||[],(t=>t!==e)),this):(this.global_callbacks=[],this)}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(e,t,r){for(var n=0;n<this.global_callbacks.length;n++)this.global_callbacks[n](e,t);var i=this.callbacks.get(e),s=[];if(r?s.push(t,r):t&&s.push(t),i&&i.length>0)for(n=0;n<i.length;n++)i[n].fn.apply(i[n].context||window,s);else this.failThrough&&this.failThrough(e,t);return this}}class ae extends oe{constructor(e,t,r,n,i){super(),this.initialize=ot.transportConnectionInitializer,this.hooks=e,this.name=t,this.priority=r,this.key=n,this.options=i,this.state="new",this.timeline=i.timeline,this.activityTimeout=i.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return Boolean(this.hooks.handlesActivityChecks)}supportsPing(){return Boolean(this.hooks.supportsPing)}connect(){if(this.socket||"initialized"!==this.state)return!1;var e=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(e,this.options)}catch(e){return x.defer((()=>{this.onError(e),this.changeState("closed")})),!1}return this.bindListeners(),J.debug("Connecting",{transport:this.name,url:e}),this.changeState("connecting"),!0}close(){return!!this.socket&&(this.socket.close(),!0)}send(e){return"open"===this.state&&(x.defer((()=>{this.socket&&this.socket.send(e)})),!0)}ping(){"open"===this.state&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0}onError(e){this.emit("error",{type:"WebSocketError",error:e}),this.timeline.error(this.buildTimelineMessage({error:e.toString()}))}onClose(e){e?this.changeState("closed",{code:e.code,reason:e.reason,wasClean:e.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0}onMessage(e){this.emit("message",e)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=e=>{this.onError(e)},this.socket.onclose=e=>{this.onClose(e)},this.socket.onmessage=e=>{this.onMessage(e)},this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))}changeState(e,t){this.state=e,this.timeline.info(this.buildTimelineMessage({state:e,params:t})),this.emit(e,t)}buildTimelineMessage(e){return L({cid:this.id},e)}}class ce{constructor(e){this.hooks=e}isSupported(e){return this.hooks.isSupported(e)}createConnection(e,t,r,n){return new ae(this.hooks,e,t,r,n)}}var de=new ce({urls:te,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(ot.getWebSocketAPI())},isSupported:function(){return Boolean(ot.getWebSocketAPI())},getSocket:function(e){return ot.createWebSocket(e)}}),le={urls:re,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},ue=L({getSocket:function(e){return ot.HTTPFactory.createStreamingSocket(e)}},le),he=L({getSocket:function(e){return ot.HTTPFactory.createPollingSocket(e)}},le),pe={isSupported:function(){return ot.isXHRSupported()}},me={ws:de,xhr_streaming:new ce(L({},ue,pe)),xhr_polling:new ce(L({},he,pe))},fe=new ce({file:"sockjs",urls:ne,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(e,t){return new window.SockJS(e,null,{js_path:a.getPath("sockjs",{useTLS:t.useTLS}),ignore_null_origin:t.ignoreNullOrigin})},beforeOpen:function(e,t){e.send(JSON.stringify({path:t}))}}),ge={isSupported:function(e){return ot.isXDRSupported(e.useTLS)}},ve=new ce(L({},ue,ge)),ye=new ce(L({},he,ge));me.xdr_streaming=ve,me.xdr_polling=ye,me.sockjs=fe;var _e=me,Se=new class extends oe{constructor(){super();var e=this;void 0!==window.addEventListener&&(window.addEventListener("online",(function(){e.emit("online")}),!1),window.addEventListener("offline",(function(){e.emit("offline")}),!1))}isOnline(){return void 0===window.navigator.onLine||window.navigator.onLine}};class Te{constructor(e,t,r){this.manager=e,this.transport=t,this.minPingDelay=r.minPingDelay,this.maxPingDelay=r.maxPingDelay,this.pingDelay=void 0}createConnection(e,t,r,n){n=L({},n,{activityTimeout:this.pingDelay});var i=this.transport.createConnection(e,t,r,n),s=null,o=function(){i.unbind("open",o),i.bind("closed",a),s=x.now()},a=e=>{if(i.unbind("closed",a),1002===e.code||1003===e.code)this.manager.reportDeath();else if(!e.wasClean&&s){var t=x.now()-s;t<2*this.maxPingDelay&&(this.manager.reportDeath(),this.pingDelay=Math.max(t/2,this.minPingDelay))}};return i.bind("open",o),i}isSupported(e){return this.manager.isAlive()&&this.transport.isSupported(e)}}const Ee={decodeMessage:function(e){try{var t=JSON.parse(e.data),r=t.data;if("string"==typeof r)try{r=JSON.parse(t.data)}catch(e){}var n={event:t.event,channel:t.channel,data:r};return t.user_id&&(n.user_id=t.user_id),n}catch(t){throw{type:"MessageParseError",error:t,data:e.data}}},encodeMessage:function(e){return JSON.stringify(e)},processHandshake:function(e){var t=Ee.decodeMessage(e);if("pusher:connection_established"===t.event){if(!t.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:t.data.socket_id,activityTimeout:1e3*t.data.activity_timeout}}if("pusher:error"===t.event)return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"},getCloseAction:function(e){return e.code<4e3?e.code>=1002&&e.code<=1004?"backoff":null:4e3===e.code?"tls_only":e.code<4100?"refused":e.code<4200?"backoff":e.code<4300?"retry":"refused"},getCloseError:function(e){return 1e3!==e.code&&1001!==e.code?{type:"PusherError",data:{code:e.code,message:e.reason||e.message}}:null}};var be=Ee;class we extends oe{constructor(e,t){super(),this.id=e,this.transport=t,this.activityTimeout=t.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(e){return this.transport.send(e)}send_event(e,t,r){var n={event:e,data:t};return r&&(n.channel=r),J.debug("Event sent",n),this.send(be.encodeMessage(n))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var e={message:e=>{var t;try{t=be.decodeMessage(e)}catch(t){this.emit("error",{type:"MessageParseError",error:t,data:e.data})}if(void 0!==t){switch(J.debug("Event recd",t),t.event){case"pusher:error":this.emit("error",{type:"PusherError",data:t.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong")}this.emit("message",t)}},activity:()=>{this.emit("activity")},error:e=>{this.emit("error",e)},closed:e=>{t(),e&&e.code&&this.handleCloseEvent(e),this.transport=null,this.emit("closed")}},t=()=>{F(e,((e,t)=>{this.transport.unbind(t,e)}))};F(e,((e,t)=>{this.transport.bind(t,e)}))}handleCloseEvent(e){var t=be.getCloseAction(e),r=be.getCloseError(e);r&&this.emit("error",r),t&&this.emit(t,{action:t,error:r})}}class ke{constructor(e,t){this.transport=e,this.callback=t,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=e=>{var t;this.unbindListeners();try{t=be.processHandshake(e)}catch(e){return this.finish("error",{error:e}),void this.transport.close()}"connected"===t.action?this.finish("connected",{connection:new we(t.id,this.transport),activityTimeout:t.activityTimeout}):(this.finish(t.action,{error:t.error}),this.transport.close())},this.onClosed=e=>{this.unbindListeners();var t=be.getCloseAction(e)||"backoff",r=be.getCloseError(e);this.finish(t,{error:r})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(e,t){this.callback(L({transport:this.transport,action:e},t))}}class Re{constructor(e,t){this.timeline=e,this.options=t||{}}send(e,t){this.timeline.isEmpty()||this.timeline.send(ot.TimelineTransport.getAgent(this,e),t)}}class Ce extends oe{constructor(e,t){super((function(t,r){J.debug("No callbacks on "+e+" for "+t)})),this.name=e,this.pusher=t,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}authorize(e,t){return t(null,{auth:""})}trigger(e,t){if(0!==e.indexOf("client-"))throw new u("Event '"+e+"' does not start with 'client-'");if(!this.subscribed){var r=l("triggeringClientEvents");J.warn(`Client event triggered before channel 'subscription_succeeded' event . ${r}`)}return this.pusher.send_event(e,t,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(e){var t=e.event,r=e.data;"pusher_internal:subscription_succeeded"===t?this.handleSubscriptionSucceededEvent(e):"pusher_internal:subscription_count"===t?this.handleSubscriptionCountEvent(e):0!==t.indexOf("pusher_internal:")&&this.emit(t,r,{})}handleSubscriptionSucceededEvent(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",e.data)}handleSubscriptionCountEvent(e){e.data.subscription_count&&(this.subscriptionCount=e.data.subscription_count),this.emit("pusher:subscription_count",e.data)}subscribe(){this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,((e,t)=>{e?(this.subscriptionPending=!1,J.error(e.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:e.message},e instanceof _?{status:e.status}:{}))):this.pusher.send_event("pusher:subscribe",{auth:t.auth,channel_data:t.channel_data,channel:this.name})})))}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class Ie extends Ce{authorize(e,t){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:e},t)}}class Ae{constructor(){this.reset()}get(e){return Object.prototype.hasOwnProperty.call(this.members,e)?{id:e,info:this.members[e]}:null}each(e){F(this.members,((t,r)=>{e(this.get(r))}))}setMyID(e){this.myID=e}onSubscription(e){this.members=e.presence.hash,this.count=e.presence.count,this.me=this.get(this.myID)}addMember(e){return null===this.get(e.user_id)&&this.count++,this.members[e.user_id]=e.user_info,this.get(e.user_id)}removeMember(e){var t=this.get(e.user_id);return t&&(delete this.members[e.user_id],this.count--),t}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}class Pe extends Ie{constructor(e,t){super(e,t),this.members=new Ae}authorize(e,t){super.authorize(e,((e,r)=>{return n=this,i=void 0,o=function*(){if(!e)if(null!=r.channel_data){var n=JSON.parse(r.channel_data);this.members.setMyID(n.user_id)}else{if(yield this.pusher.user.signinDonePromise,null==this.pusher.user.user_data){let e=l("authorizationEndpoint");return J.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${e}, or the user should be signed in.`),void t("Invalid auth response")}this.members.setMyID(this.pusher.user.user_data.id)}t(e,r)},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,a)}c((o=o.apply(n,i||[])).next())}));var n,i,s,o}))}handleEvent(e){var t=e.event;if(0===t.indexOf("pusher_internal:"))this.handleInternalEvent(e);else{var r=e.data,n={};e.user_id&&(n.user_id=e.user_id),this.emit(t,r,n)}}handleInternalEvent(e){var t=e.event,r=e.data;switch(t){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(e);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(e);break;case"pusher_internal:member_added":var n=this.members.addMember(r);this.emit("pusher:member_added",n);break;case"pusher_internal:member_removed":var i=this.members.removeMember(r);i&&this.emit("pusher:member_removed",i)}}handleSubscriptionSucceededEvent(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(e.data),this.emit("pusher:subscription_succeeded",this.members))}disconnect(){this.members.reset(),super.disconnect()}}var De=r(1),Oe=r(0);class Me extends Ie{constructor(e,t,r){super(e,t),this.key=null,this.nacl=r}authorize(e,t){super.authorize(e,((e,r)=>{if(e)return void t(e,r);let n=r.shared_secret;n?(this.key=Object(Oe.decode)(n),delete r.shared_secret,t(null,r)):t(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null)}))}trigger(e,t){throw new g("Client events are not currently supported for encrypted channels")}handleEvent(e){var t=e.event,r=e.data;0!==t.indexOf("pusher_internal:")&&0!==t.indexOf("pusher:")?this.handleEncryptedEvent(t,r):super.handleEvent(e)}handleEncryptedEvent(e,t){if(!this.key)return void J.debug("Received encrypted event before key has been retrieved from the authEndpoint");if(!t.ciphertext||!t.nonce)return void J.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+t);let r=Object(Oe.decode)(t.ciphertext);if(r.length<this.nacl.secretbox.overheadLength)return void J.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${r.length}`);let n=Object(Oe.decode)(t.nonce);if(n.length<this.nacl.secretbox.nonceLength)return void J.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${n.length}`);let i=this.nacl.secretbox.open(r,n,this.key);if(null===i)return J.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),void this.authorize(this.pusher.connection.socket_id,((t,s)=>{t?J.error(`Failed to make a request to the authEndpoint: ${s}. Unable to fetch new key, so dropping encrypted event`):(i=this.nacl.secretbox.open(r,n,this.key),null!==i?this.emit(e,this.getDataToEmit(i)):J.error("Failed to decrypt event with new key. Dropping encrypted event"))}));this.emit(e,this.getDataToEmit(i))}getDataToEmit(e){let t=Object(De.decode)(e);try{return JSON.parse(t)}catch(e){return t}}}class Ne extends oe{constructor(e,t){super(),this.state="initialized",this.connection=null,this.key=e,this.options=t,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var r=ot.getNetwork();r.bind("online",(()=>{this.timeline.info({netinfo:"online"}),"connecting"!==this.state&&"unavailable"!==this.state||this.retryIn(0)})),r.bind("offline",(()=>{this.timeline.info({netinfo:"offline"}),this.connection&&this.sendActivityCheck()})),this.updateStrategy()}switchCluster(e){this.key=e,this.updateStrategy(),this.retryIn(0)}connect(){this.connection||this.runner||(this.strategy.isSupported()?(this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()):this.updateState("failed"))}send(e){return!!this.connection&&this.connection.send(e)}send_event(e,t,r){return!!this.connection&&this.connection.send_event(e,t,r)}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var e=(t,r)=>{t?this.runner=this.strategy.connect(0,e):"error"===r.action?(this.emit("error",{type:"HandshakeError",error:r.error}),this.timeline.error({handshakeError:r.error})):(this.abortConnecting(),this.handshakeCallbacks[r.action](r))};this.runner=this.strategy.connect(0,e)}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection&&this.abandonConnection().close()}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(e){this.timeline.info({action:"retry",delay:e}),e>0&&this.emit("connecting_in",Math.round(e/1e3)),this.retryTimer=new O(e||0,(()=>{this.disconnectInternally(),this.connect()}))}clearRetryTimer(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)}setUnavailableTimer(){this.unavailableTimer=new O(this.options.unavailableTimeout,(()=>{this.updateState("unavailable")}))}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new O(this.options.pongTimeout,(()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)}))}resetActivityCheck(){this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new O(this.activityTimeout,(()=>{this.sendActivityCheck()})))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(e){return L({},e,{message:e=>{this.resetActivityCheck(),this.emit("message",e)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:e=>{this.emit("error",e)},closed:()=>{this.abandonConnection(),this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(e){return L({},e,{connected:e=>{this.activityTimeout=Math.min(this.options.activityTimeout,e.activityTimeout,e.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(e.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let e=e=>t=>{t.error&&this.emit("error",{type:"WebSocketError",error:t.error}),e(t)};return{tls_only:e((()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)})),refused:e((()=>{this.disconnect()})),backoff:e((()=>{this.retryIn(1e3)})),retry:e((()=>{this.retryIn(0)}))}}setConnection(e){for(var t in this.connection=e,this.connectionCallbacks)this.connection.bind(t,this.connectionCallbacks[t]);this.resetActivityCheck()}abandonConnection(){if(this.connection){for(var e in this.stopActivityCheck(),this.connectionCallbacks)this.connection.unbind(e,this.connectionCallbacks[e]);var t=this.connection;return this.connection=null,t}}updateState(e,t){var r=this.state;if(this.state=e,r!==e){var n=e;"connected"===n&&(n+=" with new socket ID "+t.socket_id),J.debug("State changed",r+" -> "+n),this.timeline.info({state:e,params:t}),this.emit("state_change",{previous:r,current:e}),this.emit(e,t)}}shouldRetry(){return"connecting"===this.state||"connected"===this.state}}class xe{constructor(){this.channels={}}add(e,t){return this.channels[e]||(this.channels[e]=function(e,t){if(0===e.indexOf("private-encrypted-")){if(t.config.nacl)return Le.createEncryptedChannel(e,t,t.config.nacl);let r="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",n=l("encryptedChannelSupport");throw new g(`${r}. ${n}`)}if(0===e.indexOf("private-"))return Le.createPrivateChannel(e,t);if(0===e.indexOf("presence-"))return Le.createPresenceChannel(e,t);if(0===e.indexOf("#"))throw new h('Cannot create a channel with name "'+e+'".');return Le.createChannel(e,t)}(e,t)),this.channels[e]}all(){return e=this.channels,t=[],F(e,(function(e){t.push(e)})),t;var e,t}find(e){return this.channels[e]}remove(e){var t=this.channels[e];return delete this.channels[e],t}disconnect(){F(this.channels,(function(e){e.disconnect()}))}}var Le={createChannels:()=>new xe,createConnectionManager:(e,t)=>new Ne(e,t),createChannel:(e,t)=>new Ce(e,t),createPrivateChannel:(e,t)=>new Ie(e,t),createPresenceChannel:(e,t)=>new Pe(e,t),createEncryptedChannel:(e,t,r)=>new Me(e,t,r),createTimelineSender:(e,t)=>new Re(e,t),createHandshake:(e,t)=>new ke(e,t),createAssistantToTheTransportManager:(e,t,r)=>new Te(e,t,r)};class Ue{constructor(e){this.options=e||{},this.livesLeft=this.options.lives||1/0}getAssistant(e){return Le.createAssistantToTheTransportManager(this,e,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class je{constructor(e,t){this.strategies=e,this.loop=Boolean(t.loop),this.failFast=Boolean(t.failFast),this.timeout=t.timeout,this.timeoutLimit=t.timeoutLimit}isSupported(){return q(this.strategies,x.method("isSupported"))}connect(e,t){var r=this.strategies,n=0,i=this.timeout,s=null,o=(a,c)=>{c?t(null,c):(n+=1,this.loop&&(n%=r.length),n<r.length?(i&&(i*=2,this.timeoutLimit&&(i=Math.min(i,this.timeoutLimit))),s=this.tryStrategy(r[n],e,{timeout:i,failFast:this.failFast},o)):t(!0))};return s=this.tryStrategy(r[n],e,{timeout:i,failFast:this.failFast},o),{abort:function(){s.abort()},forceMinPriority:function(t){e=t,s&&s.forceMinPriority(t)}}}tryStrategy(e,t,r,n){var i=null,s=null;return r.timeout>0&&(i=new O(r.timeout,(function(){s.abort(),n(!0)}))),s=e.connect(t,(function(e,t){e&&i&&i.isRunning()&&!r.failFast||(i&&i.ensureAborted(),n(e,t))})),{abort:function(){i&&i.ensureAborted(),s.abort()},forceMinPriority:function(e){s.forceMinPriority(e)}}}}class Fe{constructor(e){this.strategies=e}isSupported(){return q(this.strategies,x.method("isSupported"))}connect(e,t){return function(e,r,n){var i=H(e,(function(e,n,i,s){return e.connect(r,function(e,r){return function(n,i){r[e].error=n,n?function(e){return function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r,e))return!1;return!0}(e,(function(e){return Boolean(e.error)}))}(r)&&t(!0):(B(r,(function(e){e.forceMinPriority(i.transport.priority)})),t(null,i))}}(n,s))}));return{abort:function(){B(i,Ve)},forceMinPriority:function(e){B(i,(function(t){t.forceMinPriority(e)}))}}}(this.strategies,e)}}function Ve(e){e.error||e.aborted||(e.abort(),e.aborted=!0)}class Be{constructor(e,t,r){this.strategy=e,this.transports=t,this.ttl=r.ttl||18e5,this.usingTLS=r.useTLS,this.timeline=r.timeline}isSupported(){return this.strategy.isSupported()}connect(e,t){var r=this.usingTLS,n=function(e){var t=ot.getLocalStorage();if(t)try{var r=t[He(e)];if(r)return JSON.parse(r)}catch(t){We(e)}return null}(r),i=n&&n.cacheSkipCount?n.cacheSkipCount:0,s=[this.strategy];if(n&&n.timestamp+this.ttl>=x.now()){var o=this.transports[n.transport];o&&(["ws","wss"].includes(n.transport)||i>3?(this.timeline.info({cached:!0,transport:n.transport,latency:n.latency}),s.push(new je([o],{timeout:2*n.latency+1e3,failFast:!0}))):i++)}var a=x.now(),c=s.pop().connect(e,(function n(o,d){o?(We(r),s.length>0?(a=x.now(),c=s.pop().connect(e,n)):t(o)):(function(e,t,r,n){var i=ot.getLocalStorage();if(i)try{i[He(e)]=z({timestamp:x.now(),transport:t,latency:r,cacheSkipCount:n})}catch(e){}}(r,d.transport.name,x.now()-a,i),t(null,d))}));return{abort:function(){c.abort()},forceMinPriority:function(t){e=t,c&&c.forceMinPriority(t)}}}}function He(e){return"pusherTransport"+(e?"TLS":"NonTLS")}function We(e){var t=ot.getLocalStorage();if(t)try{delete t[He(e)]}catch(e){}}class Ge{constructor(e,{delay:t}){this.strategy=e,this.options={delay:t}}isSupported(){return this.strategy.isSupported()}connect(e,t){var r,n=this.strategy,i=new O(this.options.delay,(function(){r=n.connect(e,t)}));return{abort:function(){i.ensureAborted(),r&&r.abort()},forceMinPriority:function(t){e=t,r&&r.forceMinPriority(t)}}}}class qe{constructor(e,t,r){this.test=e,this.trueBranch=t,this.falseBranch=r}isSupported(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()}connect(e,t){return(this.test()?this.trueBranch:this.falseBranch).connect(e,t)}}class $e{constructor(e){this.strategy=e}isSupported(){return this.strategy.isSupported()}connect(e,t){var r=this.strategy.connect(e,(function(e,n){n&&r.abort(),t(e,n)}));return r}}function ze(e){return function(){return e.isSupported()}}var Je,Ke={getRequest:function(e){var t=new window.XDomainRequest;return t.ontimeout=function(){e.emit("error",new p),e.close()},t.onerror=function(t){e.emit("error",t),e.close()},t.onprogress=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText)},t.onload=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText),e.emit("finished",200),e.close()},t},abortRequest:function(e){e.ontimeout=e.onerror=e.onprogress=e.onload=null,e.abort()}};class Qe extends oe{constructor(e,t,r){super(),this.hooks=e,this.method=t,this.url=r}start(e){this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},ot.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(e)}close(){this.unloader&&(ot.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)}onChunk(e,t){for(;;){var r=this.advanceBuffer(t);if(!r)break;this.emit("chunk",{status:e,data:r})}this.isBufferTooLong(t)&&this.emit("buffer_too_long")}advanceBuffer(e){var t=e.slice(this.position),r=t.indexOf("\n");return-1!==r?(this.position+=r+1,t.slice(0,r)):null}isBufferTooLong(e){return this.position===e.length&&e.length>262144}}!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=3]="CLOSED"}(Je||(Je={}));var Ye=Je,Xe=1;function Ze(e){var t=-1===e.indexOf("?")?"?":"&";return e+t+"t="+ +new Date+"&n="+Xe++}function et(e){return ot.randomInt(e)}var tt,rt=class{constructor(e,t){this.hooks=e,this.session=et(1e3)+"/"+function(e){for(var t=[],r=0;r<8;r++)t.push(et(32).toString(32));return t.join("")}(),this.location=function(e){var t=/([^\?]*)\/*(\??.*)/.exec(e);return{base:t[1],queryString:t[2]}}(t),this.readyState=Ye.CONNECTING,this.openStream()}send(e){return this.sendRaw(JSON.stringify([e]))}ping(){this.hooks.sendHeartbeat(this)}close(e,t){this.onClose(e,t,!0)}sendRaw(e){if(this.readyState!==Ye.OPEN)return!1;try{return ot.createSocketRequest("POST",Ze((t=this.location,r=this.session,t.base+"/"+r+"/xhr_send"))).start(e),!0}catch(e){return!1}var t,r}reconnect(){this.closeStream(),this.openStream()}onClose(e,t,r){this.closeStream(),this.readyState=Ye.CLOSED,this.onclose&&this.onclose({code:e,reason:t,wasClean:r})}onChunk(e){var t;if(200===e.status)switch(this.readyState===Ye.OPEN&&this.onActivity(),e.data.slice(0,1)){case"o":t=JSON.parse(e.data.slice(1)||"{}"),this.onOpen(t);break;case"a":t=JSON.parse(e.data.slice(1)||"[]");for(var r=0;r<t.length;r++)this.onEvent(t[r]);break;case"m":t=JSON.parse(e.data.slice(1)||"null"),this.onEvent(t);break;case"h":this.hooks.onHeartbeat(this);break;case"c":t=JSON.parse(e.data.slice(1)||"[]"),this.onClose(t[0],t[1],!0)}}onOpen(e){var t,r,n;this.readyState===Ye.CONNECTING?(e&&e.hostname&&(this.location.base=(t=this.location.base,r=e.hostname,(n=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(t))[1]+r+n[3])),this.readyState=Ye.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)}onEvent(e){this.readyState===Ye.OPEN&&this.onmessage&&this.onmessage({data:e})}onActivity(){this.onactivity&&this.onactivity()}onError(e){this.onerror&&this.onerror(e)}openStream(){this.stream=ot.createSocketRequest("POST",Ze(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",(e=>{this.onChunk(e)})),this.stream.bind("finished",(e=>{this.hooks.onFinished(this,e)})),this.stream.bind("buffer_too_long",(()=>{this.reconnect()}));try{this.stream.start()}catch(e){x.defer((()=>{this.onError(e),this.onClose(1006,"Could not start streaming",!1)}))}}closeStream(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)}},nt={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr_streaming"+e.queryString},onHeartbeat:function(e){e.sendRaw("[]")},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){e.onClose(1006,"Connection interrupted ("+t+")",!1)}},it={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr"+e.queryString},onHeartbeat:function(){},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){200===t?e.reconnect():e.onClose(1006,"Connection interrupted ("+t+")",!1)}},st={getRequest:function(e){var t=new(ot.getXHRAPI());return t.onreadystatechange=t.onprogress=function(){switch(t.readyState){case 3:t.responseText&&t.responseText.length>0&&e.onChunk(t.status,t.responseText);break;case 4:t.responseText&&t.responseText.length>0&&e.onChunk(t.status,t.responseText),e.emit("finished",t.status),e.close()}},t},abortRequest:function(e){e.onreadystatechange=null,e.abort()}},ot={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:i,DependenciesReceivers:o,getDefaultStrategy:function(e,t,r){var n={};function i(t,i,s,o,a){var c=r(e,t,i,s,o,a);return n[t]=c,c}var s,o=Object.assign({},t,{hostNonTLS:e.wsHost+":"+e.wsPort,hostTLS:e.wsHost+":"+e.wssPort,httpPath:e.wsPath}),a=Object.assign({},o,{useTLS:!0}),c=Object.assign({},t,{hostNonTLS:e.httpHost+":"+e.httpPort,hostTLS:e.httpHost+":"+e.httpsPort,httpPath:e.httpPath}),d={loop:!0,timeout:15e3,timeoutLimit:6e4},l=new Ue({minPingDelay:1e4,maxPingDelay:e.activityTimeout}),u=new Ue({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout}),h=i("ws","ws",3,o,l),p=i("wss","ws",3,a,l),m=i("sockjs","sockjs",1,c),f=i("xhr_streaming","xhr_streaming",1,c,u),g=i("xdr_streaming","xdr_streaming",1,c,u),v=i("xhr_polling","xhr_polling",1,c),y=i("xdr_polling","xdr_polling",1,c),_=new je([h],d),S=new je([p],d),T=new je([m],d),E=new je([new qe(ze(f),f,g)],d),b=new je([new qe(ze(v),v,y)],d),w=new je([new qe(ze(E),new Fe([E,new Ge(b,{delay:4e3})]),b)],d),k=new qe(ze(w),w,T);return s=t.useTLS?new Fe([_,new Ge(k,{delay:2e3})]):new Fe([_,new Ge(S,{delay:2e3}),new Ge(k,{delay:5e3})]),new Be(new $e(new qe(ze(h),s,k)),n,{ttl:18e5,timeline:t.timeline,useTLS:t.useTLS})},Transports:_e,transportConnectionInitializer:function(){var e=this;e.timeline.info(e.buildTimelineMessage({transport:e.name+(e.options.useTLS?"s":"")})),e.hooks.isInitialized()?e.changeState("initialized"):e.hooks.file?(e.changeState("initializing"),a.load(e.hooks.file,{useTLS:e.options.useTLS},(function(t,r){e.hooks.isInitialized()?(e.changeState("initialized"),r(!0)):(t&&e.onError(t),e.onClose(),r(!1))}))):e.onClose()},HTTPFactory:{createStreamingSocket(e){return this.createSocket(nt,e)},createPollingSocket(e){return this.createSocket(it,e)},createSocket:(e,t)=>new rt(e,t),createXHR(e,t){return this.createRequest(st,e,t)},createRequest:(e,t,r)=>new Qe(e,t,r),createXDR:function(e,t){return this.createRequest(Ke,e,t)}},TimelineTransport:X,getXHRAPI:()=>window.XMLHttpRequest,getWebSocketAPI:()=>window.WebSocket||window.MozWebSocket,setup(e){window.Pusher=e;var t=()=>{this.onDocumentBody(e.ready)};window.JSON?t():a.load("json2",{},t)},getDocument:()=>document,getProtocol(){return this.getDocument().location.protocol},getAuthorizers:()=>({ajax:S,jsonp:K}),onDocumentBody(e){document.body?e():setTimeout((()=>{this.onDocumentBody(e)}),0)},createJSONPRequest:(e,t)=>new Y(e,t),createScriptRequest:e=>new Q(e),getLocalStorage(){try{return window.localStorage}catch(e){return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){return new(this.getXHRAPI())},createMicrosoftXHR:()=>new ActiveXObject("Microsoft.XMLHTTP"),getNetwork:()=>Se,createWebSocket(e){return new(this.getWebSocketAPI())(e)},createSocketRequest(e,t){if(this.isXHRSupported())return this.HTTPFactory.createXHR(e,t);if(this.isXDRSupported(0===t.indexOf("https:")))return this.HTTPFactory.createXDR(e,t);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var e=this.getXHRAPI();return Boolean(e)&&void 0!==(new e).withCredentials},isXDRSupported(e){var t=e?"https:":"http:",r=this.getProtocol();return Boolean(window.XDomainRequest)&&r===t},addUnloadListener(e){void 0!==window.addEventListener?window.addEventListener("unload",e,!1):void 0!==window.attachEvent&&window.attachEvent("onunload",e)},removeUnloadListener(e){void 0!==window.addEventListener?window.removeEventListener("unload",e,!1):void 0!==window.detachEvent&&window.detachEvent("onunload",e)},randomInt:e=>Math.floor((window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)*e)};!function(e){e[e.ERROR=3]="ERROR",e[e.INFO=6]="INFO",e[e.DEBUG=7]="DEBUG"}(tt||(tt={}));var at=tt;class ct{constructor(e,t,r){this.key=e,this.session=t,this.events=[],this.options=r||{},this.sent=0,this.uniqueID=0}log(e,t){e<=this.options.level&&(this.events.push(L({},t,{timestamp:x.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())}error(e){this.log(at.ERROR,e)}info(e){this.log(at.INFO,e)}debug(e){this.log(at.DEBUG,e)}isEmpty(){return 0===this.events.length}send(e,t){var r=L({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],e(r,((e,r)=>{e||this.sent++,t&&t(e,r)})),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class dt{constructor(e,t,r,n){this.name=e,this.priority=t,this.transport=r,this.options=n||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(e,t){if(!this.isSupported())return lt(new y,t);if(this.priority<e)return lt(new m,t);var r=!1,n=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),i=null,s=function(){n.unbind("initialized",s),n.connect()},o=function(){i=Le.createHandshake(n,(function(e){r=!0,d(),t(null,e)}))},a=function(e){d(),t(e)},c=function(){var e;d(),e=z(n),t(new f(e))},d=function(){n.unbind("initialized",s),n.unbind("open",o),n.unbind("error",a),n.unbind("closed",c)};return n.bind("initialized",s),n.bind("open",o),n.bind("error",a),n.bind("closed",c),n.initialize(),{abort:()=>{r||(d(),i?i.close():n.close())},forceMinPriority:e=>{r||this.priority<e&&(i?i.close():n.close())}}}}function lt(e,t){return x.defer((function(){t(e)})),{abort:function(){},forceMinPriority:function(){}}}const{Transports:ut}=ot;var ht=function(e,t,r,n,i,s){var o,a=ut[r];if(!a)throw new v(r);return e.enabledTransports&&-1===j(e.enabledTransports,t)||e.disabledTransports&&-1!==j(e.disabledTransports,t)?o=pt:(i=Object.assign({ignoreNullOrigin:e.ignoreNullOrigin},i),o=new dt(t,n,s?s.getAssistant(a):a,i)),o},pt={isSupported:function(){return!1},connect:function(e,t){var r=x.defer((function(){t(new y)}));return{abort:function(){r.ensureAborted()},forceMinPriority:function(){}}}},mt=e=>{if(void 0===ot.getAuthorizers()[e.transport])throw`'${e.transport}' is not a recognized auth transport`;return(t,r)=>{const n=((e,t)=>{var r="socket_id="+encodeURIComponent(e.socketId);for(var n in t.params)r+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t.params[n]);if(null!=t.paramsProvider){let e=t.paramsProvider();for(var n in e)r+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n])}return r})(t,e);ot.getAuthorizers()[e.transport](ot,n,e,d.UserAuthentication,r)}},ft=e=>{if(void 0===ot.getAuthorizers()[e.transport])throw`'${e.transport}' is not a recognized auth transport`;return(t,r)=>{const n=((e,t)=>{var r="socket_id="+encodeURIComponent(e.socketId);for(var n in r+="&channel_name="+encodeURIComponent(e.channelName),t.params)r+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t.params[n]);if(null!=t.paramsProvider){let e=t.paramsProvider();for(var n in e)r+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n])}return r})(t,e);ot.getAuthorizers()[e.transport](ot,n,e,d.ChannelAuthorization,r)}};const gt=(e,t,r)=>{const n={authTransport:t.transport,authEndpoint:t.endpoint,auth:{params:t.params,headers:t.headers}};return(t,i)=>{const s=e.channel(t.channelName);r(s,n).authorize(t.socketId,i)}};function vt(e,t){let r={activityTimeout:e.activityTimeout||s.activityTimeout,cluster:e.cluster,httpPath:e.httpPath||s.httpPath,httpPort:e.httpPort||s.httpPort,httpsPort:e.httpsPort||s.httpsPort,pongTimeout:e.pongTimeout||s.pongTimeout,statsHost:e.statsHost||s.stats_host,unavailableTimeout:e.unavailableTimeout||s.unavailableTimeout,wsPath:e.wsPath||s.wsPath,wsPort:e.wsPort||s.wsPort,wssPort:e.wssPort||s.wssPort,enableStats:Tt(e),httpHost:yt(e),useTLS:St(e),wsHost:_t(e),userAuthenticator:bt(e),channelAuthorizer:wt(e,t)};return"disabledTransports"in e&&(r.disabledTransports=e.disabledTransports),"enabledTransports"in e&&(r.enabledTransports=e.enabledTransports),"ignoreNullOrigin"in e&&(r.ignoreNullOrigin=e.ignoreNullOrigin),"timelineParams"in e&&(r.timelineParams=e.timelineParams),"nacl"in e&&(r.nacl=e.nacl),r}function yt(e){return e.httpHost?e.httpHost:e.cluster?`sockjs-${e.cluster}.pusher.com`:s.httpHost}function _t(e){return e.wsHost?e.wsHost:`ws-${e.cluster}.pusher.com`}function St(e){return"https:"===ot.getProtocol()||!1!==e.forceTLS}function Tt(e){return"enableStats"in e?e.enableStats:"disableStats"in e&&!e.disableStats}const Et=e=>"customHandler"in e&&null!=e.customHandler;function bt(e){const t=Object.assign(Object.assign({},s.userAuthentication),e.userAuthentication);return Et(t)?t.customHandler:mt(t)}function wt(e,t){const r=function(e,t){let r;if("channelAuthorization"in e)r=Object.assign(Object.assign({},s.channelAuthorization),e.channelAuthorization);else if(r={transport:e.authTransport||s.authTransport,endpoint:e.authEndpoint||s.authEndpoint},"auth"in e&&("params"in e.auth&&(r.params=e.auth.params),"headers"in e.auth&&(r.headers=e.auth.headers)),"authorizer"in e)return{customHandler:gt(t,r,e.authorizer)};return r}(e,t);return Et(r)?r.customHandler:ft(r)}class kt extends oe{constructor(e){super((function(e,t){J.debug(`No callbacks on watchlist events for ${e}`)})),this.pusher=e,this.bindWatchlistInternalEvent()}handleEvent(e){e.data.events.forEach((e=>{this.emit(e.name,e)}))}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",(e=>{"pusher_internal:watchlist_events"===e.event&&this.handleEvent(e)}))}}class Rt extends oe{constructor(e){super((function(e,t){J.debug("No callbacks on user for "+e)})),this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(e,t)=>{if(e)return J.warn(`Error during signin: ${e}`),void this._cleanup();this.pusher.send_event("pusher:signin",{auth:t.auth,user_data:t.user_data})},this.pusher=e,this.pusher.connection.bind("state_change",(({previous:e,current:t})=>{"connected"!==e&&"connected"===t&&this._signin(),"connected"===e&&"connected"!==t&&(this._cleanup(),this._newSigninPromiseIfNeeded())})),this.watchlist=new kt(e),this.pusher.connection.bind("message",(e=>{"pusher:signin_success"===e.event&&this._onSigninSuccess(e.data),this.serverToUserChannel&&this.serverToUserChannel.name===e.channel&&this.serverToUserChannel.handleEvent(e)}))}signin(){this.signin_requested||(this.signin_requested=!0,this._signin())}_signin(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),"connected"===this.pusher.connection.state&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))}_onSigninSuccess(e){try{this.user_data=JSON.parse(e.user_data)}catch(t){return J.error(`Failed parsing user data after signin: ${e.user_data}`),void this._cleanup()}if("string"!=typeof this.user_data.id||""===this.user_data.id)return J.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),void this._cleanup();this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){this.serverToUserChannel=new Ce(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global(((e,t)=>{0!==e.indexOf("pusher_internal:")&&0!==e.indexOf("pusher:")&&this.emit(e,t)})),(e=>{e.subscriptionPending&&e.subscriptionCancelled?e.reinstateSubscription():e.subscriptionPending||"connected"!==this.pusher.connection.state||e.subscribe()})(this.serverToUserChannel)}_cleanup(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested)return;if(this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:e,resolve:t,reject:r}=function(){let e,t;return{promise:new Promise(((r,n)=>{e=r,t=n})),resolve:e,reject:t}}();e.done=!1;const n=()=>{e.done=!0};e.then(n).catch(n),this.signinDonePromise=e,this._signinDoneResolve=t}}class Ct{static ready(){Ct.isReady=!0;for(var e=0,t=Ct.instances.length;e<t;e++)Ct.instances[e].connect()}static getClientFeatures(){return V(G({ws:ot.Transports.ws},(function(e){return e.isSupported({})})))}constructor(e,t){!function(e){if(null==e)throw"You must pass your app key when you instantiate Pusher."}(e),function(e){if(null==e)throw"You must pass an options object";if(null==e.cluster)throw"Options object must provide a cluster";"disableStats"in e&&J.warn("The disableStats option is deprecated in favor of enableStats")}(t),this.key=e,this.options=t,this.config=vt(this.options,this),this.channels=Le.createChannels(),this.global_emitter=new oe,this.sessionID=ot.randomInt(1e9),this.timeline=new ct(this.key,this.sessionID,{cluster:this.config.cluster,features:Ct.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:at.INFO,version:s.VERSION}),this.config.enableStats&&(this.timelineSender=Le.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+ot.TimelineTransport.name})),this.connection=Le.createConnectionManager(this.key,{getStrategy:e=>ot.getDefaultStrategy(this.config,e,ht),timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:Boolean(this.config.useTLS)}),this.connection.bind("connected",(()=>{this.subscribeAll(),this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())})),this.connection.bind("message",(e=>{var t=0===e.event.indexOf("pusher_internal:");if(e.channel){var r=this.channel(e.channel);r&&r.handleEvent(e)}t||this.global_emitter.emit(e.event,e.data)})),this.connection.bind("connecting",(()=>{this.channels.disconnect()})),this.connection.bind("disconnected",(()=>{this.channels.disconnect()})),this.connection.bind("error",(e=>{J.warn(e)})),Ct.instances.push(this),this.timeline.info({instances:Ct.instances.length}),this.user=new Rt(this),Ct.isReady&&this.connect()}switchCluster(e){const{appKey:t,cluster:r}=e;this.key=t,this.options=Object.assign(Object.assign({},this.options),{cluster:r}),this.config=vt(this.options,this),this.connection.switchCluster(this.key)}channel(e){return this.channels.find(e)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var e=this.connection.isUsingTLS(),t=this.timelineSender;this.timelineSenderTimer=new M(6e4,(function(){t.send(e)}))}}disconnect(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)}bind(e,t,r){return this.global_emitter.bind(e,t,r),this}unbind(e,t,r){return this.global_emitter.unbind(e,t,r),this}bind_global(e){return this.global_emitter.bind_global(e),this}unbind_global(e){return this.global_emitter.unbind_global(e),this}unbind_all(e){return this.global_emitter.unbind_all(),this}subscribeAll(){var e;for(e in this.channels.channels)this.channels.channels.hasOwnProperty(e)&&this.subscribe(e)}subscribe(e){var t=this.channels.add(e,this);return t.subscriptionPending&&t.subscriptionCancelled?t.reinstateSubscription():t.subscriptionPending||"connected"!==this.connection.state||t.subscribe(),t}unsubscribe(e){var t=this.channels.find(e);t&&t.subscriptionPending?t.cancelSubscription():(t=this.channels.remove(e))&&t.subscribed&&t.unsubscribe()}send_event(e,t,r){return this.connection.send_event(e,t,r)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}Ct.instances=[],Ct.isReady=!1,Ct.logToConsole=!1,Ct.Runtime=ot,Ct.ScriptReceivers=ot.ScriptReceivers,Ct.DependenciesReceivers=ot.DependenciesReceivers,Ct.auth_callbacks=ot.auth_callbacks;var It=t.default=Ct;ot.setup(Ct)}])},e.exports=t()},2598:(e,t,r)=>{"use strict";r.d(t,{r:()=>c});var n,i=r(6540),s={exports:{}},o={};s.exports=function(){if(n)return o;n=1;var e=i,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,n){var i,o={},d=null,l=null;for(i in void 0!==n&&(d=""+n),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(l=r.ref),r)s.call(r,i)&&!c.hasOwnProperty(i)&&(o[i]=r[i]);if(e&&e.defaultProps)for(i in r=e.defaultProps)void 0===o[i]&&(o[i]=r[i]);return{$$typeof:t,type:e,key:d,ref:l,props:o,_owner:a.current}}return o.Fragment=r,o.jsx=d,o.jsxs=d,o}();var a=s.exports;const c=({mediaRecorder:e,width:t="100%",height:r="100%",barWidth:n=2,gap:s=1,backgroundColor:o="transparent",barColor:c="rgb(160, 198, 255)",fftSize:d=1024,maxDecibels:l=-10,minDecibels:u=-90,smoothingTimeConstant:h=.4})=>{const[p]=(0,i.useState)((()=>new AudioContext)),[m,f]=(0,i.useState)(),g=(0,i.useRef)(null);(0,i.useEffect)((()=>{if(!e.stream)return;const t=p.createAnalyser();f(t),t.fftSize=d,t.minDecibels=u,t.maxDecibels=l,t.smoothingTimeConstant=h,p.createMediaStreamSource(e.stream).connect(t)}),[e.stream]),(0,i.useEffect)((()=>{m&&"recording"===e.state&&v()}),[m,e.state]);const v=(0,i.useCallback)((()=>{if(!m)return;const t=new Uint8Array(null==m?void 0:m.frequencyBinCount);"recording"===e.state?(null==m||m.getByteFrequencyData(t),y(t),requestAnimationFrame(v)):"paused"===e.state?y(t):"inactive"===e.state&&"closed"!==p.state&&p.close()}),[m,p.state]),y=e=>{if(!g.current)return;const t=((e,t,r,n)=>{let i=t/(r+n),s=Math.floor(e.length/i);i>e.length&&(i=e.length,s=1);const o=[];for(let t=0;t<i;t++){let r=0;for(let n=0;n<s&&t*s+n<e.length;n++)r+=e[t*s+n];o.push(r/s)}return o})(e,g.current.width,n,s);((e,t,r,n,i,s)=>{const o=t.height/2,a=t.getContext("2d");a&&(a.clearRect(0,0,t.width,t.height),"transparent"!==i&&(a.fillStyle=i,a.fillRect(0,0,t.width,t.height)),e.forEach(((e,t)=>{a.fillStyle=s;const i=t*(r+n),c=o-e/2,d=r,l=e||1;a.beginPath(),a.roundRect?(a.roundRect(i,c,d,l,50),a.fill()):a.fillRect(i,c,d,l)})))})(t,g.current,n,s,o,c)};return a.jsx("canvas",{ref:g,width:t,height:r,style:{aspectRatio:"unset"}})},d=(e,t,r,n,i,s,o,a=0,c=1)=>{const d=t.height/2,l=t.getContext("2d");if(!l)return;l.clearRect(0,0,t.width,t.height),"transparent"!==i&&(l.fillStyle=i,l.fillRect(0,0,t.width,t.height));const u=(a||0)/c;e.forEach(((t,i)=>{const a=i/e.length,c=u>a;l.fillStyle=c&&o?o:s;const h=i*(r+n),p=d+t.min,m=r,f=d+t.max-p;l.beginPath(),l.roundRect?(l.roundRect(h,p,m,f,50),l.fill()):l.fillRect(h,p,m,f)}))};(0,i.forwardRef)((({blob:e,width:t,height:r,barWidth:n=2,gap:s=1,currentTime:o,style:c,backgroundColor:l="transparent",barColor:u="rgb(184, 184, 184)",barPlayedColor:h="rgb(160, 198, 255)"},p)=>{const m=(0,i.useRef)(null),[f,g]=(0,i.useState)([]),[v,y]=(0,i.useState)(0);return(0,i.useImperativeHandle)(p,(()=>m.current),[]),(0,i.useEffect)((()=>{(async()=>{if(!m.current)return;if(!e){const e=Array.from({length:100},(()=>({max:0,min:0})));return void d(e,m.current,n,s,l,u,h)}const i=await e.arrayBuffer();await(new AudioContext).decodeAudioData(i,(e=>{if(!m.current)return;y(e.duration);const i=((e,t,r,n,i)=>{const s=e.getChannelData(0),o=r/(n+i),a=Math.floor(s.length/o),c=t/2;let d=[],l=0;for(let t=0;t<o;t++){const r=[];let n=0;const i=[];let o=0;for(let c=0;c<a&&t*a+c<e.length;c++){const e=s[t*a+c];e<=0&&(r.push(e),n++),e>0&&(i.push(e),o++)}const c=r.reduce(((e,t)=>e+t),0)/n,u={max:i.reduce(((e,t)=>e+t),0)/o,min:c};u.max>l&&(l=u.max),Math.abs(u.min)>l&&(l=Math.abs(u.min)),d.push(u)}if(.8*c>l*c){const e=.8*c/l;d=d.map((t=>({max:t.max*e,min:t.min*e})))}return d})(e,r,t,n,s);g(i),d(i,m.current,n,s,l,u,h)}))})()}),[e,m.current]),(0,i.useEffect)((()=>{m.current&&d(f,m.current,n,s,l,u,h,o,v)}),[o,v]),a.jsx("canvas",{ref:m,width:t,height:r,style:{...c}})})).displayName="AudioVisualizer"},5602:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},7363:(e,t,r)=>{var n=r(5020),i=r(3804);t.M9=i,t.qg=n.parse,t.Sl=n.parseParams,n.parseFmtpConfig,n.parsePayloads,n.parseRemoteCandidates,n.parseImageAttributes,t.hy=n.parseSimulcastStreamList},5020:(e,t,r)=>{var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var s=0;s<r.length;s+=1)null!=e[s+1]&&(t[r[s]]=n(e[s+1]))}(r.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=r(5602),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var c=s[t][a];if(c.reg.test(o))return i(c,n,o)}})),t.media=r,t};var a=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},3804:(e,t,r)=>{var n=r(5602),i=/%[sdv%]/g,s=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return s.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||a,i=t.innerOrder||c,s=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(o(t,r,e))}))}))})),e.media.forEach((function(e){s.push(o("m",n.m[0],e)),i.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(o(t,r,e))}))}))}))})),s.join("\r\n")+"\r\n"}},8971:(e,t,r)=>{"use strict";r.d(t,{C:()=>a});var n=r(6540);(e=>{try{if(typeof window>"u")return;var t=document.createElement("style");t.appendChild(document.createTextNode(".audio-recorder{background-color:#ebebeb;box-shadow:0 2px 5px #bebebe;border-radius:20px;box-sizing:border-box;color:#000;width:40px;display:flex;align-items:center;transition:all .2s ease-in;-webkit-tap-highlight-color:transparent}.audio-recorder-mic{box-sizing:content-box;cursor:pointer;height:16px;color:#000;padding:12px}.audio-recorder .audio-recorder-mic{border-radius:20px}.audio-recorder.recording .audio-recorder-mic{border-radius:0}.audio-recorder-timer,.audio-recorder-status{color:#000;margin-left:10px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;font-size:14px;font-weight:400;line-height:1}.audio-recorder-status{margin-left:15px;display:flex;align-items:baseline;flex-grow:1;animation-name:fading-ar-status;animation-duration:2s;animation-iteration-count:infinite}.audio-recorder-status-dot{background-color:#d00;border-radius:50%;height:10px;width:9px;margin-right:5px}.audio-recorder-options{box-sizing:content-box;height:16px;cursor:pointer;padding:12px 6px 12px 12px}.audio-recorder-options~.audio-recorder-options{padding:12px 12px 12px 6px;border-radius:0 5px 5px 0}.recording{border-radius:12px;width:300px;transition:all .2s ease-out}.display-none{display:none}.audio-recorder-visualizer{margin-left:15px;flex-grow:1;align-self:center;display:flex;align-items:center}@keyframes fading-ar-status{0%{opacity:1}50%{opacity:0}to{opacity:1}}")),document.head.appendChild(t)}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var i,s={exports:{}},o={};s.exports=function(){if(i)return o;i=1;var e=n,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,n){var i,o={},d=null,l=null;for(i in void 0!==n&&(d=""+n),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(l=r.ref),r)s.call(r,i)&&!c.hasOwnProperty(i)&&(o[i]=r[i]);if(e&&e.defaultProps)for(i in r=e.defaultProps)void 0===o[i]&&(o[i]=r[i]);return{$$typeof:t,type:e,key:d,ref:l,props:o,_owner:a.current}}return o.Fragment=r,o.jsx=d,o.jsxs=d,o}(),s.exports;const a=(e,t,r)=>{const[i,s]=(0,n.useState)(!1),[o,a]=(0,n.useState)(!1),[c,d]=(0,n.useState)(0),[l,u]=(0,n.useState)(),[h,p]=(0,n.useState)(),[m,f]=(0,n.useState)(),g=(0,n.useCallback)((()=>{const e=setInterval((()=>{d((e=>e+1))}),1e3);p(e)}),[d,p]),v=(0,n.useCallback)((()=>{null!=h&&clearInterval(h),p(void 0)}),[h,p]);return{startRecording:(0,n.useCallback)((()=>{null==h&&navigator.mediaDevices.getUserMedia({audio:e??!0}).then((e=>{s(!0);const t=new MediaRecorder(e,r);u(t),t.start(),g(),t.addEventListener("dataavailable",(e=>{f(e.data),t.stream.getTracks().forEach((e=>e.stop())),u(void 0)}))})).catch((e=>{console.log(e.name,e.message,e.cause),null==t||t(e)}))}),[h,s,u,g,f,t,r]),stopRecording:(0,n.useCallback)((()=>{null==l||l.stop(),v(),d(0),s(!1),a(!1)}),[l,d,s,a,v]),togglePauseResume:(0,n.useCallback)((()=>{o?(a(!1),null==l||l.resume(),g()):(a(!0),v(),null==l||l.pause())}),[l,a,g,v]),recordingBlob:m,isRecording:i,isPaused:o,recordingTime:c,mediaRecorder:l}};n.lazy((async()=>{const{LiveAudioVisualizer:e}=await r.e(198).then(r.bind(r,198));return{default:e}}))},7134:(e,t,r)=>{"use strict";r.d(t,{lt:()=>s});const n=new Map,i=e=>{const t=n.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},s=(e,t={})=>(r,s,a)=>{const{enabled:c,anonymousActionType:d,store:l,...u}=t;let h;try{h=(null==c||c)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!h)return c&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(r,s,a);const{connection:p,...m}=((e,t,r)=>{if(void 0===e)return{type:"untracked",connection:t.connect(r)};const i=n.get(r.name);if(i)return{type:"tracked",store:e,...i};const s={connection:t.connect(r),stores:{}};return n.set(r.name,s),{type:"tracked",store:e,...s}})(l,h,u);let f=!0;a.setState=(e,t,n)=>{const o=r(e,t);if(!f)return o;const c=void 0===n?{type:d||"anonymous"}:"string"==typeof n?{type:n}:n;return void 0===l?(null==p||p.send(c,s()),o):(null==p||p.send({...c,type:`${l}/${c.type}`},{...i(u.name),[l]:a.getState()}),o)};const g=(...e)=>{const t=f;f=!1,r(...e),f=t},v=e(a.setState,s,a);if("untracked"===m.type?null==p||p.init(v):(m.stores[m.store]=a,null==p||p.init(Object.fromEntries(Object.entries(m.stores).map((([e,t])=>[e,e===m.store?v:t.getState()]))))),a.dispatchFromDevtools&&"function"==typeof a.dispatch){let e=!1;const t=a.dispatch;a.dispatch=(...r)=>{"__setState"!==r[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...r)}}return p.subscribe((e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):o(e.payload,(e=>{if("__setState"!==e.type)a.dispatchFromDevtools&&"function"==typeof a.dispatch&&a.dispatch(e);else{if(void 0===l)return void g(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[l];if(null==t)return;JSON.stringify(a.getState())!==JSON.stringify(t)&&g(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return g(v),void 0===l?null==p?void 0:p.init(a.getState()):null==p?void 0:p.init(i(u.name));case"COMMIT":return void 0===l?void(null==p||p.init(a.getState())):null==p?void 0:p.init(i(u.name));case"ROLLBACK":return o(e.state,(e=>{if(void 0===l)return g(e),void(null==p||p.init(a.getState()));g(e[l]),null==p||p.init(i(u.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return o(e.state,(e=>{void 0!==l?JSON.stringify(a.getState())!==JSON.stringify(e[l])&&g(e[l]):g(e)}));case"IMPORT_STATE":{const{nextLiftedState:r}=e.payload,n=null==(t=r.computedStates.slice(-1)[0])?void 0:t.state;if(!n)return;return g(void 0===l?n:n[l]),void(null==p||p.send(null,r))}case"PAUSE_RECORDING":return f=!f}return}})),v},o=(e,t)=>{let r;try{r=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==r&&t(r)}}}]);